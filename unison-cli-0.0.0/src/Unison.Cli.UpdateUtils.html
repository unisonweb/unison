<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | This module contains functionality that is common to the general idea of &quot;updating&quot; a term in Unison, which is when</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- we reassign a name from one hash to another and then see if all dependents still typecheck.</span><span>
</span><span id="line-3"></span><span class="hs-comment">--</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- This occurs in the `pull`, `merge`, `update`, and `upgrade` commands.</span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Cli.UpdateUtils</span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Loading definitions</span></span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Unison.Cli.UpdateUtils.html#loadNamespaceDefinitions"><span class="hs-identifier">loadNamespaceDefinitions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Getting dependents in a namespace</span></span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Unison.Cli.UpdateUtils.html#getNamespaceDependentsOf"><span class="hs-identifier">getNamespaceDependentsOf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Unison.Cli.UpdateUtils.html#getNamespaceDependentsOf2"><span class="hs-identifier">getNamespaceDependentsOf2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Unison.Cli.UpdateUtils.html#getNamespaceDependentsOf3"><span class="hs-identifier">getNamespaceDependentsOf3</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Narrowing definitions</span></span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Unison.Cli.UpdateUtils.html#narrowDefns"><span class="hs-identifier">narrowDefns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Hydrating definitions</span></span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Unison.Cli.UpdateUtils.html#hydrateDefns"><span class="hs-identifier">hydrateDefns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Parsing and typechecking</span></span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Unison.Cli.UpdateUtils.html#parseAndTypecheck"><span class="hs-identifier">parseAndTypecheck</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">where</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ask</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifoldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">bifold</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">bifoldMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bitraversable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">bitraverse</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Foldable</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List.NonEmpty</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NESet</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set.NonEmpty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set.NonEmpty</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Branch</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Causal</span></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TypeReferenceId</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Referent</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.Operations</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Operations</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html"><span class="hs-identifier">Unison.Cli.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier">Cli</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier">Env</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html"><span class="hs-identifier">Unison.Cli.Monad</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cli</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Cli.TypeCheck.html"><span class="hs-identifier">Unison.Cli.TypeCheck</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Cli.TypeCheck.html#computeTypecheckingEnvironment"><span class="hs-identifier">computeTypecheckingEnvironment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Debug</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Debug</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.FileParsers</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FileParsers</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Hash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Hash</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Name</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NameSegment</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Names</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Names</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Names</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Names</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parsers</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Parsers</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Reference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TermReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TypeReference</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Reference</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Referent</span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Referent</span></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Result</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Result</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Sqlite</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Transaction</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.Parser</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Parser</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.UnisonFile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TypecheckedUnisonFile</span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.BiMultimap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">BiMultimap</span></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.BiMultimap</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BiMultimap</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Conflicted</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Conflicted</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Defn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Defn</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Defns</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">DefnsF</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">DefnsF2</span></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Nametree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Nametree</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">traverseNametreeWithName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unflattenNametrees</span></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Pretty</span></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Pretty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pretty</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Relation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Relation</span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Relation</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Relation</span></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unzip</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zip</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipWith</span></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-comment">------------------------------------------------------------------------------------------------------------------------</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- Loading definitions</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-comment">-- Load all &quot;namespace definitions&quot; of a branch, which are all terms and type declarations *except* those defined</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- in the &quot;lib&quot; namespace.</span><span>
</span><span id="line-82"></span><span class="hs-comment">--</span><span>
</span><span id="line-83"></span><span class="hs-comment">-- Fails if there is a conflicted name.</span><span>
</span><span id="line-84"></span><span class="annot"><a href="Unison.Cli.UpdateUtils.html#loadNamespaceDefinitions"><span class="hs-identifier hs-type">loadNamespaceDefinitions</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680909712"><span class="annot"><a href="#local-6989586621680909712"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680909712"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2.Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680909712"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">V2.Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621680909712"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-89"></span><span>  </span><span class="annot"><a href="#local-6989586621680909712"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span>
</span><span id="line-91"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Defn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Conflicted</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Conflicted</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Nametree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span id="loadNamespaceDefinitions"><span class="annot"><span class="annottext">loadNamespaceDefinitions :: forall (m :: * -&gt; *).
Monad m =&gt;
(Referent -&gt; m Referent)
-&gt; Branch m
-&gt; m (Either
        (Defn (Conflicted Name Referent) (Conflicted Name Reference))
        (Nametree (DefnsF (Map NameSegment) Referent Reference)))
</span><a href="Unison.Cli.UpdateUtils.html#loadNamespaceDefinitions"><span class="hs-identifier hs-var hs-var">loadNamespaceDefinitions</span></a></span></span><span> </span><span id="local-6989586621680910024"><span class="annot"><span class="annottext">Referent -&gt; m Referent
</span><a href="#local-6989586621680910024"><span class="hs-identifier hs-var">referent2to1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><span class="annottext">(Nametree (DefnsF2 (Map NameSegment) NESet Referent Reference)
 -&gt; Either
      (Defn (Conflicted Name Referent) (Conflicted Name Reference))
      (Nametree (DefnsF (Map NameSegment) Referent Reference)))
-&gt; m (Nametree
        (DefnsF2 (Map NameSegment) NESet Referent Reference))
-&gt; m (Either
        (Defn (Conflicted Name Referent) (Conflicted Name Reference))
        (Nametree (DefnsF (Map NameSegment) Referent Reference)))
forall a b. (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Nametree (DefnsF2 (Map NameSegment) NESet Referent Reference)
-&gt; Either
     (Defn (Conflicted Name Referent) (Conflicted Name Reference))
     (Nametree (DefnsF (Map NameSegment) Referent Reference))
</span><a href="Unison.Cli.UpdateUtils.html#assertNamespaceHasNoConflictedNames"><span class="hs-identifier hs-var">assertNamespaceHasNoConflictedNames</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Nametree (DefnsF2 (Map NameSegment) NESet Referent Reference))
 -&gt; m (Either
         (Defn (Conflicted Name Referent) (Conflicted Name Reference))
         (Nametree (DefnsF (Map NameSegment) Referent Reference))))
-&gt; (Branch m
    -&gt; m (Nametree
            (DefnsF2 (Map NameSegment) NESet Referent Reference)))
-&gt; Branch m
-&gt; m (Either
        (Defn (Conflicted Name Referent) (Conflicted Name Reference))
        (Nametree (DefnsF (Map NameSegment) Referent Reference)))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(forall x. Map NameSegment x -&gt; Map NameSegment x)
-&gt; Branch m
-&gt; m (Nametree
        (DefnsF2 (Map NameSegment) NESet Referent Reference))
</span><a href="#local-6989586621680910027"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSegment -&gt; Map NameSegment x -&gt; Map NameSegment x
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.delete</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-identifier hs-var">NameSegment.libSegment</span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-97"></span><span>    </span><span class="annot"><a href="#local-6989586621680910027"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-98"></span><span>      </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680909730"><span class="annot"><a href="#local-6989586621680909730"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="annot"><a href="#local-6989586621680909730"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="annot"><a href="#local-6989586621680909730"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-99"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">V2.Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621680909712"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-100"></span><span>      </span><span class="annot"><a href="#local-6989586621680909712"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Nametree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>    </span><span id="local-6989586621680910027"><span class="annot"><span class="annottext">go :: (forall x. Map NameSegment x -&gt; Map NameSegment x)
-&gt; Branch m
-&gt; m (Nametree
        (DefnsF2 (Map NameSegment) NESet Referent Reference))
</span><a href="#local-6989586621680910027"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680910032"><span class="annot"><span class="annottext">forall x. Map NameSegment x -&gt; Map NameSegment x
</span><a href="#local-6989586621680910032"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680910033"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621680910033"><span class="hs-identifier hs-var">branch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-102"></span><span>      </span><span id="local-6989586621680910034"><span class="annot"><span class="annottext">Map NameSegment (NESet Referent)
</span><a href="#local-6989586621680910034"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map NameSegment (Map Referent (m MdValues))
-&gt; (Map Referent (m MdValues) -&gt; m (NESet Referent))
-&gt; m (Map NameSegment (NESet Referent))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621680910033"><span class="hs-identifier hs-var">branch</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Referent] -&gt; NESet Referent)
-&gt; m [Referent] -&gt; m (NESet Referent)
forall a b. (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty Referent -&gt; NESet Referent
forall a. Ord a =&gt; NonEmpty a -&gt; NESet a
</span><span class="hs-identifier hs-var">Set.NonEmpty.fromList</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty Referent -&gt; NESet Referent)
-&gt; ([Referent] -&gt; NonEmpty Referent)
-&gt; [Referent]
-&gt; NESet Referent
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Referent] -&gt; NonEmpty Referent
forall a. HasCallStack =&gt; [a] -&gt; NonEmpty a
</span><span class="hs-identifier hs-var">List.NonEmpty.fromList</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m [Referent] -&gt; m (NESet Referent))
-&gt; (Map Referent (m MdValues) -&gt; m [Referent])
-&gt; Map Referent (m MdValues)
-&gt; m (NESet Referent)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; m Referent) -&gt; [Referent] -&gt; m [Referent]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; m Referent
</span><a href="#local-6989586621680910024"><span class="hs-identifier hs-var">referent2to1</span></a></span><span> </span><span class="annot"><span class="annottext">([Referent] -&gt; m [Referent])
-&gt; (Map Referent (m MdValues) -&gt; [Referent])
-&gt; Map Referent (m MdValues)
-&gt; m [Referent]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map Referent (m MdValues) -&gt; [Referent]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680910040"><span class="annot"><span class="annottext">types :: Map NameSegment (NESet Reference)
</span><a href="#local-6989586621680910040"><span class="hs-identifier hs-var hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map Reference (m MdValues) -&gt; NESet Reference)
-&gt; Map NameSegment (Map Reference (m MdValues))
-&gt; Map NameSegment (NESet Reference)
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; NESet Reference
forall a. Set a -&gt; NESet a
</span><span class="hs-identifier hs-var">Set.NonEmpty.unsafeFromSet</span></span><span> </span><span class="annot"><span class="annottext">(Set Reference -&gt; NESet Reference)
-&gt; (Map Reference (m MdValues) -&gt; Set Reference)
-&gt; Map Reference (m MdValues)
-&gt; NESet Reference
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map Reference (m MdValues) -&gt; Set Reference
forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621680910033"><span class="hs-identifier hs-var">branch</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span>
</span><span id="line-104"></span><span>      </span><span id="local-6989586621680910044"><span class="annot"><span class="annottext">Map
  NameSegment
  (Nametree (DefnsF2 (Map NameSegment) NESet Referent Reference))
</span><a href="#local-6989586621680910044"><span class="hs-identifier hs-var">children</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-105"></span><span>        </span><span class="annot"><span class="annottext">Map NameSegment (CausalBranch m)
-&gt; (CausalBranch m
    -&gt; m (Nametree
            (DefnsF2 (Map NameSegment) NESet Referent Reference)))
-&gt; m (Map
        NameSegment
        (Nametree (DefnsF2 (Map NameSegment) NESet Referent Reference)))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map NameSegment (CausalBranch m)
-&gt; Map NameSegment (CausalBranch m)
forall x. Map NameSegment x -&gt; Map NameSegment x
</span><a href="#local-6989586621680910032"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621680910033"><span class="hs-identifier hs-var">branch</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">children</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680910045"><span class="annot"><span class="annottext">CausalBranch m
</span><a href="#local-6989586621680910045"><span class="hs-identifier hs-var">childCausal</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-106"></span><span>          </span><span id="local-6989586621680910046"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621680910046"><span class="hs-identifier hs-var">child</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CausalBranch m
</span><a href="#local-6989586621680910045"><span class="hs-identifier hs-var">childCausal</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">value</span><span>
</span><span id="line-107"></span><span>          </span><span class="annot"><span class="annottext">(forall x. Map NameSegment x -&gt; Map NameSegment x)
-&gt; Branch m
-&gt; m (Nametree
        (DefnsF2 (Map NameSegment) NESet Referent Reference))
</span><a href="#local-6989586621680910027"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Map NameSegment x -&gt; Map NameSegment x
forall a. a -&gt; a
forall x. Map NameSegment x -&gt; Map NameSegment x
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621680910046"><span class="hs-identifier hs-var">child</span></a></span><span>
</span><span id="line-108"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nametree</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:value:Nametree :: DefnsF2 (Map NameSegment) NESet Referent Reference
</span><span class="hs-identifier hs-var">value</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Map NameSegment (NESet Referent)
terms :: Map NameSegment (NESet Referent)
$sel:terms:Defns :: Map NameSegment (NESet Referent)
</span><a href="#local-6989586621680910034"><span class="hs-identifier hs-var hs-var">terms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map NameSegment (NESet Reference)
types :: Map NameSegment (NESet Reference)
$sel:types:Defns :: Map NameSegment (NESet Reference)
</span><a href="#local-6989586621680910040"><span class="hs-identifier hs-var hs-var">types</span></a></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map
  NameSegment
  (Nametree (DefnsF2 (Map NameSegment) NESet Referent Reference))
children :: Map
  NameSegment
  (Nametree (DefnsF2 (Map NameSegment) NESet Referent Reference))
$sel:children:Nametree :: Map
  NameSegment
  (Nametree (DefnsF2 (Map NameSegment) NESet Referent Reference))
</span><a href="#local-6989586621680910044"><span class="hs-identifier hs-var hs-var">children</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="annot"><span class="hs-comment">-- | Assert that there are no unconflicted names in a namespace.</span></span><span>
</span><span id="line-111"></span><span class="annot"><a href="Unison.Cli.UpdateUtils.html#assertNamespaceHasNoConflictedNames"><span class="hs-identifier hs-type">assertNamespaceHasNoConflictedNames</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Nametree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-113"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Defn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Conflicted</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Conflicted</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Nametree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span id="assertNamespaceHasNoConflictedNames"><span class="annot"><span class="annottext">assertNamespaceHasNoConflictedNames :: Nametree (DefnsF2 (Map NameSegment) NESet Referent Reference)
-&gt; Either
     (Defn (Conflicted Name Referent) (Conflicted Name Reference))
     (Nametree (DefnsF (Map NameSegment) Referent Reference))
</span><a href="Unison.Cli.UpdateUtils.html#assertNamespaceHasNoConflictedNames"><span class="hs-identifier hs-var hs-var">assertNamespaceHasNoConflictedNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-117"></span><span>  </span><span class="annot"><span class="annottext">([NameSegment]
 -&gt; DefnsF2 (Map NameSegment) NESet Referent Reference
 -&gt; Either
      (Defn (Conflicted Name Referent) (Conflicted Name Reference))
      (DefnsF (Map NameSegment) Referent Reference))
-&gt; Nametree (DefnsF2 (Map NameSegment) NESet Referent Reference)
-&gt; Either
     (Defn (Conflicted Name Referent) (Conflicted Name Reference))
     (Nametree (DefnsF (Map NameSegment) Referent Reference))
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
([NameSegment] -&gt; a -&gt; f b) -&gt; Nametree a -&gt; f (Nametree b)
</span><span class="hs-identifier hs-var">traverseNametreeWithName</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680910054"><span class="annot"><span class="annottext">[NameSegment]
</span><a href="#local-6989586621680910054"><span class="hs-identifier hs-var">segments</span></a></span></span><span> </span><span id="local-6989586621680910055"><span class="annot"><span class="annottext">DefnsF2 (Map NameSegment) NESet Referent Reference
</span><a href="#local-6989586621680910055"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680910056"><span class="annot"><span class="annottext">toName :: NameSegment -&gt; Name
</span><a href="#local-6989586621680910056"><span class="hs-identifier hs-var hs-var">toName</span></a></span></span><span> </span><span id="local-6989586621680910057"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621680910057"><span class="hs-identifier hs-var">segment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-119"></span><span>          </span><span class="annot"><span class="annottext">NonEmpty NameSegment -&gt; Name
</span><span class="hs-identifier hs-var">Name.fromReverseSegments</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621680910057"><span class="hs-identifier hs-var">segment</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; [NameSegment] -&gt; NonEmpty NameSegment
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">List.NonEmpty.:|</span></span><span> </span><span class="annot"><span class="annottext">[NameSegment]
</span><a href="#local-6989586621680910054"><span class="hs-identifier hs-var">segments</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>    </span><span id="local-6989586621680910060"><span class="annot"><span class="annottext">Map NameSegment Referent
</span><a href="#local-6989586621680910060"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-121"></span><span>      </span><span class="annot"><span class="annottext">DefnsF2 (Map NameSegment) NESet Referent Reference
</span><a href="#local-6989586621680910055"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span> </span><span class="annot"><span class="annottext">Map NameSegment (NESet Referent)
-&gt; (Map NameSegment (NESet Referent)
    -&gt; Either
         (Defn (Conflicted Name Referent) (Conflicted Name Reference))
         (Map NameSegment Referent))
-&gt; Either
     (Defn (Conflicted Name Referent) (Conflicted Name Reference))
     (Map NameSegment Referent)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(NameSegment
 -&gt; NESet Referent
 -&gt; Either
      (Defn (Conflicted Name Referent) (Conflicted Name Reference))
      Referent)
-&gt; Map NameSegment (NESet Referent)
-&gt; Either
     (Defn (Conflicted Name Referent) (Conflicted Name Reference))
     (Map NameSegment Referent)
forall (t :: * -&gt; *) k a b.
Applicative t =&gt;
(k -&gt; a -&gt; t b) -&gt; Map k a -&gt; t (Map k b)
</span><span class="hs-identifier hs-var">Map.traverseWithKey</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680910063"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621680910063"><span class="hs-identifier hs-var">segment</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-122"></span><span>        </span><span class="annot"><span class="annottext">(NESet Referent
 -&gt; Defn (Conflicted Name Referent) (Conflicted Name Reference))
-&gt; NESet Referent
-&gt; Either
     (Defn (Conflicted Name Referent) (Conflicted Name Reference))
     Referent
forall ref x. (NESet ref -&gt; x) -&gt; NESet ref -&gt; Either x ref
</span><a href="#local-6989586621680910064"><span class="hs-identifier hs-var">assertUnconflicted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Conflicted Name Referent
-&gt; Defn (Conflicted Name Referent) (Conflicted Name Reference)
forall term typ. term -&gt; Defn term typ
</span><span class="hs-identifier hs-var">TermDefn</span></span><span> </span><span class="annot"><span class="annottext">(Conflicted Name Referent
 -&gt; Defn (Conflicted Name Referent) (Conflicted Name Reference))
-&gt; (NESet Referent -&gt; Conflicted Name Referent)
-&gt; NESet Referent
-&gt; Defn (Conflicted Name Referent) (Conflicted Name Reference)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NESet Referent -&gt; Conflicted Name Referent
forall n a. n -&gt; NESet a -&gt; Conflicted n a
</span><span class="hs-identifier hs-var">Conflicted</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSegment -&gt; Name
</span><a href="#local-6989586621680910056"><span class="hs-identifier hs-var">toName</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621680910063"><span class="hs-identifier hs-var">segment</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>    </span><span id="local-6989586621680910067"><span class="annot"><span class="annottext">Map NameSegment Reference
</span><a href="#local-6989586621680910067"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-124"></span><span>      </span><span class="annot"><span class="annottext">DefnsF2 (Map NameSegment) NESet Referent Reference
</span><a href="#local-6989586621680910055"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span> </span><span class="annot"><span class="annottext">Map NameSegment (NESet Reference)
-&gt; (Map NameSegment (NESet Reference)
    -&gt; Either
         (Defn (Conflicted Name Referent) (Conflicted Name Reference))
         (Map NameSegment Reference))
-&gt; Either
     (Defn (Conflicted Name Referent) (Conflicted Name Reference))
     (Map NameSegment Reference)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(NameSegment
 -&gt; NESet Reference
 -&gt; Either
      (Defn (Conflicted Name Referent) (Conflicted Name Reference))
      Reference)
-&gt; Map NameSegment (NESet Reference)
-&gt; Either
     (Defn (Conflicted Name Referent) (Conflicted Name Reference))
     (Map NameSegment Reference)
forall (t :: * -&gt; *) k a b.
Applicative t =&gt;
(k -&gt; a -&gt; t b) -&gt; Map k a -&gt; t (Map k b)
</span><span class="hs-identifier hs-var">Map.traverseWithKey</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680910068"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621680910068"><span class="hs-identifier hs-var">segment</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-125"></span><span>        </span><span class="annot"><span class="annottext">(NESet Reference
 -&gt; Defn (Conflicted Name Referent) (Conflicted Name Reference))
-&gt; NESet Reference
-&gt; Either
     (Defn (Conflicted Name Referent) (Conflicted Name Reference))
     Reference
forall ref x. (NESet ref -&gt; x) -&gt; NESet ref -&gt; Either x ref
</span><a href="#local-6989586621680910064"><span class="hs-identifier hs-var">assertUnconflicted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Conflicted Name Reference
-&gt; Defn (Conflicted Name Referent) (Conflicted Name Reference)
forall term typ. typ -&gt; Defn term typ
</span><span class="hs-identifier hs-var">TypeDefn</span></span><span> </span><span class="annot"><span class="annottext">(Conflicted Name Reference
 -&gt; Defn (Conflicted Name Referent) (Conflicted Name Reference))
-&gt; (NESet Reference -&gt; Conflicted Name Reference)
-&gt; NESet Reference
-&gt; Defn (Conflicted Name Referent) (Conflicted Name Reference)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NESet Reference -&gt; Conflicted Name Reference
forall n a. n -&gt; NESet a -&gt; Conflicted n a
</span><span class="hs-identifier hs-var">Conflicted</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSegment -&gt; Name
</span><a href="#local-6989586621680910056"><span class="hs-identifier hs-var">toName</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621680910068"><span class="hs-identifier hs-var">segment</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Map NameSegment Referent
$sel:terms:Defns :: Map NameSegment Referent
terms :: Map NameSegment Referent
</span><span class="hs-identifier hs-var hs-var">terms</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map NameSegment Reference
$sel:types:Defns :: Map NameSegment Reference
types :: Map NameSegment Reference
</span><span class="hs-identifier hs-var hs-var">types</span></span><span class="hs-special">}</span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-128"></span><span>    </span><span id="local-6989586621680909764"><span id="local-6989586621680909765"><span class="annot"><a href="#local-6989586621680910064"><span class="hs-identifier hs-type">assertUnconflicted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><a href="#local-6989586621680909764"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680909765"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><a href="#local-6989586621680909764"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621680909765"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680909764"><span class="hs-identifier hs-type">ref</span></a></span></span></span><span>
</span><span id="line-129"></span><span>    </span><span id="local-6989586621680910064"><span class="annot"><span class="annottext">assertUnconflicted :: forall ref x. (NESet ref -&gt; x) -&gt; NESet ref -&gt; Either x ref
</span><a href="#local-6989586621680910064"><span class="hs-identifier hs-var hs-var">assertUnconflicted</span></a></span></span><span> </span><span id="local-6989586621680910074"><span class="annot"><span class="annottext">NESet ref -&gt; x
</span><a href="#local-6989586621680910074"><span class="hs-identifier hs-var">conflicted</span></a></span></span><span> </span><span id="local-6989586621680910075"><span class="annot"><span class="annottext">NESet ref
</span><a href="#local-6989586621680910075"><span class="hs-identifier hs-var">refs</span></a></span></span><span>
</span><span id="line-130"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NESet ref -&gt; Int
forall a. NESet a -&gt; Int
</span><span class="hs-identifier hs-var">Set.NonEmpty.size</span></span><span> </span><span class="annot"><span class="annottext">NESet ref
</span><a href="#local-6989586621680910075"><span class="hs-identifier hs-var">refs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ref -&gt; Either x ref
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NESet ref -&gt; ref
forall a. NESet a -&gt; a
</span><span class="hs-identifier hs-var">Set.NonEmpty.findMin</span></span><span> </span><span class="annot"><span class="annottext">NESet ref
</span><a href="#local-6989586621680910075"><span class="hs-identifier hs-var">refs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">x -&gt; Either x ref
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NESet ref -&gt; x
</span><a href="#local-6989586621680910074"><span class="hs-identifier hs-var">conflicted</span></a></span><span> </span><span class="annot"><span class="annottext">NESet ref
</span><a href="#local-6989586621680910075"><span class="hs-identifier hs-var">refs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="hs-comment">------------------------------------------------------------------------------------------------------------------------</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- Getting dependents in a namespace</span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-comment">-- | Given a namespace and a set of dependencies, return the subset of the namespace that consists of only the</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- (transitive) dependents of the dependencies.</span><span>
</span><span id="line-138"></span><span class="annot"><a href="Unison.Cli.UpdateUtils.html#getNamespaceDependentsOf"><span class="hs-identifier hs-type">getNamespaceDependentsOf</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-139"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-140"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-141"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Relation</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span id="getNamespaceDependentsOf"><span class="annot"><span class="annottext">getNamespaceDependentsOf :: Names
-&gt; Set Reference -&gt; Transaction (DefnsF (Relation Name) Id Id)
</span><a href="Unison.Cli.UpdateUtils.html#getNamespaceDependentsOf"><span class="hs-identifier hs-var hs-var">getNamespaceDependentsOf</span></a></span></span><span> </span><span id="local-6989586621680910078"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621680910078"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span id="local-6989586621680910079"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621680910079"><span class="hs-identifier hs-var">dependencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-143"></span><span>  </span><span id="local-6989586621680910080"><span class="annot"><span class="annottext">DefnsF Set Id Id
</span><a href="#local-6989586621680910080"><span class="hs-identifier hs-var">dependents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set Id -&gt; Set Reference -&gt; Transaction (DefnsF Set Id Id)
</span><span class="hs-identifier hs-var">Operations.transitiveDependentsWithinScope</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Set Id
</span><span class="hs-identifier hs-var">Names.referenceIds</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621680910078"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621680910079"><span class="hs-identifier hs-var">dependencies</span></a></span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Set Id -&gt; Relation Name Id)
-&gt; (Set Id -&gt; Relation Name Id)
-&gt; DefnsF Set Id Id
-&gt; DefnsF (Relation Name) Id Id
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; Defns a c -&gt; Defns b d
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; Relation Name Id) -&gt; Set Id -&gt; Relation Name Id
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Set a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Relation Name Id
</span><a href="#local-6989586621680910085"><span class="hs-identifier hs-var">nameTerm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; Relation Name Id) -&gt; Set Id -&gt; Relation Name Id
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Set a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Relation Name Id
</span><a href="#local-6989586621680910086"><span class="hs-identifier hs-var">nameType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DefnsF Set Id Id
</span><a href="#local-6989586621680910080"><span class="hs-identifier hs-var">dependents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><a href="#local-6989586621680910085"><span class="hs-identifier hs-type">nameTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Relation</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span>
</span><span id="line-147"></span><span>    </span><span id="local-6989586621680910085"><span class="annot"><span class="annottext">nameTerm :: Id -&gt; Relation Name Id
</span><a href="#local-6989586621680910085"><span class="hs-identifier hs-var hs-var">nameTerm</span></a></span></span><span> </span><span id="local-6989586621680910087"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621680910087"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-148"></span><span>      </span><span class="annot"><span class="annottext">Set Name -&gt; Id -&gt; Relation Name Id
forall (f :: * -&gt; *) a b.
(Foldable f, Ord a, Ord b) =&gt;
f a -&gt; b -&gt; Relation a b
</span><span class="hs-identifier hs-var">Relation.fromManyDom</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Referent -&gt; Relation Name Referent -&gt; Set Name
forall b a. Ord b =&gt; b -&gt; Relation a b -&gt; Set a
</span><span class="hs-identifier hs-var">Relation.lookupRan</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.fromTermReferenceId</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621680910087"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Relation Name Referent
</span><span class="hs-identifier hs-var">Names.terms</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621680910078"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621680910087"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><a href="#local-6989586621680910086"><span class="hs-identifier hs-type">nameType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Relation</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span>
</span><span id="line-151"></span><span>    </span><span id="local-6989586621680910086"><span class="annot"><span class="annottext">nameType :: Id -&gt; Relation Name Id
</span><a href="#local-6989586621680910086"><span class="hs-identifier hs-var hs-var">nameType</span></a></span></span><span> </span><span id="local-6989586621680910092"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621680910092"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-152"></span><span>      </span><span class="annot"><span class="annottext">Set Name -&gt; Id -&gt; Relation Name Id
forall (f :: * -&gt; *) a b.
(Foldable f, Ord a, Ord b) =&gt;
f a -&gt; b -&gt; Relation a b
</span><span class="hs-identifier hs-var">Relation.fromManyDom</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Relation Name Reference -&gt; Set Name
forall b a. Ord b =&gt; b -&gt; Relation a b -&gt; Set a
</span><span class="hs-identifier hs-var">Relation.lookupRan</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Reference
</span><span class="hs-identifier hs-var">Reference.fromId</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621680910092"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Relation Name Reference
</span><span class="hs-identifier hs-var">Names.types</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621680910078"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621680910092"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">-- | Given a namespace and a set of dependencies, return the subset of the namespace that consists of only the</span><span>
</span><span id="line-155"></span><span class="hs-comment">-- (transitive) dependents of the dependencies.</span><span>
</span><span id="line-156"></span><span class="annot"><a href="Unison.Cli.UpdateUtils.html#getNamespaceDependentsOf2"><span class="hs-identifier hs-type">getNamespaceDependentsOf2</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-159"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span id="getNamespaceDependentsOf2"><span class="annot"><span class="annottext">getNamespaceDependentsOf2 :: Defns (BiMultimap Referent Name) (BiMultimap Reference Name)
-&gt; Set Reference -&gt; Transaction (DefnsF (Map Name) Id Id)
</span><a href="Unison.Cli.UpdateUtils.html#getNamespaceDependentsOf2"><span class="hs-identifier hs-var hs-var">getNamespaceDependentsOf2</span></a></span></span><span> </span><span id="local-6989586621680910095"><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap Reference Name)
</span><a href="#local-6989586621680910095"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span id="local-6989586621680910096"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621680910096"><span class="hs-identifier hs-var">dependencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680910099"><span class="annot"><span class="annottext">toTermScope :: BiMultimap Referent b -&gt; Set Id
</span><a href="#local-6989586621680910099"><span class="hs-identifier hs-var hs-var">toTermScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; Maybe Id) -&gt; Set Referent -&gt; Set Id
forall b a. Ord b =&gt; (a -&gt; Maybe b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Maybe Id
</span><span class="hs-identifier hs-var">Referent.toReferenceId</span></span><span> </span><span class="annot"><span class="annottext">(Set Referent -&gt; Set Id)
-&gt; (BiMultimap Referent b -&gt; Set Referent)
-&gt; BiMultimap Referent b
-&gt; Set Id
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap Referent b -&gt; Set Referent
forall a b. BiMultimap a b -&gt; Set a
</span><span class="hs-identifier hs-var">BiMultimap.dom</span></span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680910105"><span class="annot"><span class="annottext">toTypeScope :: BiMultimap Reference b -&gt; Set Id
</span><a href="#local-6989586621680910105"><span class="hs-identifier hs-var hs-var">toTypeScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Maybe Id) -&gt; Set Reference -&gt; Set Id
forall b a. Ord b =&gt; (a -&gt; Maybe b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Maybe Id
</span><span class="hs-identifier hs-var">Reference.toId</span></span><span> </span><span class="annot"><span class="annottext">(Set Reference -&gt; Set Id)
-&gt; (BiMultimap Reference b -&gt; Set Reference)
-&gt; BiMultimap Reference b
-&gt; Set Id
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap Reference b -&gt; Set Reference
forall a b. BiMultimap a b -&gt; Set a
</span><span class="hs-identifier hs-var">BiMultimap.dom</span></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680910107"><span class="annot"><span class="annottext">scope :: Set Id
</span><a href="#local-6989586621680910107"><span class="hs-identifier hs-var hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BiMultimap Referent Name -&gt; Set Id)
-&gt; (BiMultimap Reference Name -&gt; Set Id)
-&gt; Defns (BiMultimap Referent Name) (BiMultimap Reference Name)
-&gt; Set Id
forall m a b. Monoid m =&gt; (a -&gt; m) -&gt; (b -&gt; m) -&gt; Defns a b -&gt; m
forall (p :: * -&gt; * -&gt; *) m a b.
(Bifoldable p, Monoid m) =&gt;
(a -&gt; m) -&gt; (b -&gt; m) -&gt; p a b -&gt; m
</span><span class="hs-identifier hs-var">bifoldMap</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap Referent Name -&gt; Set Id
forall {b}. BiMultimap Referent b -&gt; Set Id
</span><a href="#local-6989586621680910099"><span class="hs-identifier hs-var">toTermScope</span></a></span><span> </span><span class="annot"><span class="annottext">BiMultimap Reference Name -&gt; Set Id
forall {b}. BiMultimap Reference b -&gt; Set Id
</span><a href="#local-6989586621680910105"><span class="hs-identifier hs-var">toTypeScope</span></a></span><span> </span><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap Reference Name)
</span><a href="#local-6989586621680910095"><span class="hs-identifier hs-var">defns</span></a></span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><span class="annottext">Set Id -&gt; Set Reference -&gt; Transaction (DefnsF Set Id Id)
</span><span class="hs-identifier hs-var">Operations.transitiveDependentsWithinScope</span></span><span> </span><span class="annot"><span class="annottext">Set Id
</span><a href="#local-6989586621680910107"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621680910096"><span class="hs-identifier hs-var">dependencies</span></a></span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><span class="annottext">Transaction (DefnsF Set Id Id)
-&gt; (DefnsF Set Id Id -&gt; DefnsF (Map Name) Id Id)
-&gt; Transaction (DefnsF (Map Name) Id Id)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Set Id -&gt; Map Name Id)
-&gt; (Set Id -&gt; Map Name Id)
-&gt; DefnsF Set Id Id
-&gt; DefnsF (Map Name) Id Id
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; Defns a c -&gt; Defns b d
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map Name Id -&gt; Id -&gt; Map Name Id)
-&gt; Map Name Id -&gt; Set Id -&gt; Map Name Id
forall a b. (a -&gt; b -&gt; a) -&gt; a -&gt; Set b -&gt; a
</span><span class="hs-identifier hs-var">Set.foldl'</span></span><span> </span><span class="annot"><span class="annottext">Map Name Id -&gt; Id -&gt; Map Name Id
</span><a href="#local-6989586621680910110"><span class="hs-identifier hs-var">addTerms</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Id
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map Name Id -&gt; Id -&gt; Map Name Id)
-&gt; Map Name Id -&gt; Set Id -&gt; Map Name Id
forall a b. (a -&gt; b -&gt; a) -&gt; a -&gt; Set b -&gt; a
</span><span class="hs-identifier hs-var">Set.foldl'</span></span><span> </span><span class="annot"><span class="annottext">Map Name Id -&gt; Id -&gt; Map Name Id
</span><a href="#local-6989586621680910112"><span class="hs-identifier hs-var">addTypes</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Id
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><a href="#local-6989586621680910110"><span class="hs-identifier hs-type">addTerms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span>
</span><span id="line-168"></span><span>    </span><span id="local-6989586621680910110"><span class="annot"><span class="annottext">addTerms :: Map Name Id -&gt; Id -&gt; Map Name Id
</span><a href="#local-6989586621680910110"><span class="hs-identifier hs-var hs-var">addTerms</span></a></span></span><span> </span><span id="local-6989586621680910113"><span class="annot"><span class="annottext">Map Name Id
</span><a href="#local-6989586621680910113"><span class="hs-identifier hs-var">acc0</span></a></span></span><span> </span><span id="local-6989586621680910114"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621680910114"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-169"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680910115"><span class="annot"><span class="annottext">names :: Set Name
</span><a href="#local-6989586621680910115"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Referent -&gt; BiMultimap Referent Name -&gt; Set Name
forall a b. Ord a =&gt; a -&gt; BiMultimap a b -&gt; Set b
</span><span class="hs-identifier hs-var">BiMultimap.lookupDom</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.fromTermReferenceId</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621680910114"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap Reference Name)
</span><a href="#local-6989586621680910095"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span>
</span><span id="line-170"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Map Name Id -&gt; Name -&gt; Map Name Id)
-&gt; Map Name Id -&gt; Set Name -&gt; Map Name Id
forall a b. (a -&gt; b -&gt; a) -&gt; a -&gt; Set b -&gt; a
</span><span class="hs-identifier hs-var">Set.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680910117"><span class="annot"><span class="annottext">Map Name Id
</span><a href="#local-6989586621680910117"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621680910118"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680910118"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Id -&gt; Map Name Id -&gt; Map Name Id
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680910118"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621680910114"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Id
</span><a href="#local-6989586621680910117"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Name Id
</span><a href="#local-6989586621680910113"><span class="hs-identifier hs-var">acc0</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621680910115"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span>    </span><span class="annot"><a href="#local-6989586621680910112"><span class="hs-identifier hs-type">addTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span>
</span><span id="line-173"></span><span>    </span><span id="local-6989586621680910112"><span class="annot"><span class="annottext">addTypes :: Map Name Id -&gt; Id -&gt; Map Name Id
</span><a href="#local-6989586621680910112"><span class="hs-identifier hs-var hs-var">addTypes</span></a></span></span><span> </span><span id="local-6989586621680910120"><span class="annot"><span class="annottext">Map Name Id
</span><a href="#local-6989586621680910120"><span class="hs-identifier hs-var">acc0</span></a></span></span><span> </span><span id="local-6989586621680910121"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621680910121"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-174"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680910122"><span class="annot"><span class="annottext">names :: Set Name
</span><a href="#local-6989586621680910122"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; BiMultimap Reference Name -&gt; Set Name
forall a b. Ord a =&gt; a -&gt; BiMultimap a b -&gt; Set b
</span><span class="hs-identifier hs-var">BiMultimap.lookupDom</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Reference
</span><span class="hs-identifier hs-var">Reference.fromId</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621680910121"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap Reference Name)
</span><a href="#local-6989586621680910095"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span>
</span><span id="line-175"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Map Name Id -&gt; Name -&gt; Map Name Id)
-&gt; Map Name Id -&gt; Set Name -&gt; Map Name Id
forall a b. (a -&gt; b -&gt; a) -&gt; a -&gt; Set b -&gt; a
</span><span class="hs-identifier hs-var">Set.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680910123"><span class="annot"><span class="annottext">Map Name Id
</span><a href="#local-6989586621680910123"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621680910124"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680910124"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Id -&gt; Map Name Id -&gt; Map Name Id
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680910124"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621680910121"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Id
</span><a href="#local-6989586621680910123"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Name Id
</span><a href="#local-6989586621680910120"><span class="hs-identifier hs-var">acc0</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621680910122"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-comment">-- | Given a namespace and a set of dependencies, return the subset of the namespace that consists of only the</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- (transitive) dependents of the dependencies.</span><span>
</span><span id="line-179"></span><span class="annot"><a href="Unison.Cli.UpdateUtils.html#getNamespaceDependentsOf3"><span class="hs-identifier hs-type">getNamespaceDependentsOf3</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-180"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-181"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span id="getNamespaceDependentsOf3"><span class="annot"><span class="annottext">getNamespaceDependentsOf3 :: Defns (BiMultimap Referent Name) (BiMultimap Reference Name)
-&gt; DefnsF Set Reference Reference -&gt; Transaction (DefnsF Set Id Id)
</span><a href="Unison.Cli.UpdateUtils.html#getNamespaceDependentsOf3"><span class="hs-identifier hs-var hs-var">getNamespaceDependentsOf3</span></a></span></span><span> </span><span id="local-6989586621680910125"><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap Reference Name)
</span><a href="#local-6989586621680910125"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span id="local-6989586621680910126"><span class="annot"><span class="annottext">DefnsF Set Reference Reference
</span><a href="#local-6989586621680910126"><span class="hs-identifier hs-var">dependencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680910129"><span class="annot"><span class="annottext">toTermScope :: BiMultimap Referent b -&gt; Set Id
</span><a href="#local-6989586621680910129"><span class="hs-identifier hs-var hs-var">toTermScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; Maybe Id) -&gt; Set Referent -&gt; Set Id
forall b a. Ord b =&gt; (a -&gt; Maybe b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Maybe Id
</span><span class="hs-identifier hs-var">Referent.toReferenceId</span></span><span> </span><span class="annot"><span class="annottext">(Set Referent -&gt; Set Id)
-&gt; (BiMultimap Referent b -&gt; Set Referent)
-&gt; BiMultimap Referent b
-&gt; Set Id
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap Referent b -&gt; Set Referent
forall a b. BiMultimap a b -&gt; Set a
</span><span class="hs-identifier hs-var">BiMultimap.dom</span></span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680910132"><span class="annot"><span class="annottext">toTypeScope :: BiMultimap Reference b -&gt; Set Id
</span><a href="#local-6989586621680910132"><span class="hs-identifier hs-var hs-var">toTypeScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Maybe Id) -&gt; Set Reference -&gt; Set Id
forall b a. Ord b =&gt; (a -&gt; Maybe b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Maybe Id
</span><span class="hs-identifier hs-var">Reference.toId</span></span><span> </span><span class="annot"><span class="annottext">(Set Reference -&gt; Set Id)
-&gt; (BiMultimap Reference b -&gt; Set Reference)
-&gt; BiMultimap Reference b
-&gt; Set Id
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap Reference b -&gt; Set Reference
forall a b. BiMultimap a b -&gt; Set a
</span><span class="hs-identifier hs-var">BiMultimap.dom</span></span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680910133"><span class="annot"><span class="annottext">scope :: Set Id
</span><a href="#local-6989586621680910133"><span class="hs-identifier hs-var hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BiMultimap Referent Name -&gt; Set Id)
-&gt; (BiMultimap Reference Name -&gt; Set Id)
-&gt; Defns (BiMultimap Referent Name) (BiMultimap Reference Name)
-&gt; Set Id
forall m a b. Monoid m =&gt; (a -&gt; m) -&gt; (b -&gt; m) -&gt; Defns a b -&gt; m
forall (p :: * -&gt; * -&gt; *) m a b.
(Bifoldable p, Monoid m) =&gt;
(a -&gt; m) -&gt; (b -&gt; m) -&gt; p a b -&gt; m
</span><span class="hs-identifier hs-var">bifoldMap</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap Referent Name -&gt; Set Id
forall {b}. BiMultimap Referent b -&gt; Set Id
</span><a href="#local-6989586621680910129"><span class="hs-identifier hs-var">toTermScope</span></a></span><span> </span><span class="annot"><span class="annottext">BiMultimap Reference Name -&gt; Set Id
forall {b}. BiMultimap Reference b -&gt; Set Id
</span><a href="#local-6989586621680910132"><span class="hs-identifier hs-var">toTypeScope</span></a></span><span> </span><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap Reference Name)
</span><a href="#local-6989586621680910125"><span class="hs-identifier hs-var">defns</span></a></span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><span class="annottext">Set Id -&gt; Set Reference -&gt; Transaction (DefnsF Set Id Id)
</span><span class="hs-identifier hs-var">Operations.transitiveDependentsWithinScope</span></span><span> </span><span class="annot"><span class="annottext">Set Id
</span><a href="#local-6989586621680910133"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefnsF Set Reference Reference -&gt; Set Reference
forall m. Monoid m =&gt; Defns m m -&gt; m
forall (p :: * -&gt; * -&gt; *) m. (Bifoldable p, Monoid m) =&gt; p m m -&gt; m
</span><span class="hs-identifier hs-var">bifold</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Set Reference Reference
</span><a href="#local-6989586621680910126"><span class="hs-identifier hs-var">dependencies</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-comment">------------------------------------------------------------------------------------------------------------------------</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- Narrowing definitions</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-comment">-- | &quot;Narrow&quot; a namespace that may contain conflicted names, resulting in either a failure (if we find a conflicted</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- name), or the narrowed nametree without conflicted names.</span><span>
</span><span id="line-194"></span><span class="annot"><a href="Unison.Cli.UpdateUtils.html#narrowDefns"><span class="hs-identifier hs-type">narrowDefns</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680909815"><span class="annot"><a href="#local-6989586621680909815"><span class="hs-identifier hs-type">term</span></a></span></span><span> </span><span id="local-6989586621680909816"><span class="annot"><a href="#local-6989586621680909816"><span class="hs-identifier hs-type">typ</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680909815"><span class="hs-identifier hs-type">term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680909816"><span class="hs-identifier hs-type">typ</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Relation</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680909815"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680909816"><span class="hs-identifier hs-type">typ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-198"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defn</span></span><span>
</span><span id="line-200"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Conflicted</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621680909815"><span class="hs-identifier hs-type">term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Conflicted</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621680909816"><span class="hs-identifier hs-type">typ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Nametree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680909815"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680909816"><span class="hs-identifier hs-type">typ</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span id="narrowDefns"><span class="annot"><span class="annottext">narrowDefns :: forall term typ.
(Ord term, Ord typ) =&gt;
DefnsF (Relation Name) term typ
-&gt; Either
     (Defn (Conflicted Name term) (Conflicted Name typ))
     (Nametree (DefnsF (Map NameSegment) term typ))
</span><a href="Unison.Cli.UpdateUtils.html#narrowDefns"><span class="hs-identifier hs-var hs-var">narrowDefns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-205"></span><span>  </span><span class="annot"><span class="annottext">(DefnsF (Map Name) term typ
 -&gt; Nametree (DefnsF (Map NameSegment) term typ))
-&gt; Either
     (Defn (Conflicted Name term) (Conflicted Name typ))
     (DefnsF (Map Name) term typ)
-&gt; Either
     (Defn (Conflicted Name term) (Conflicted Name typ))
     (Nametree (DefnsF (Map NameSegment) term typ))
forall a b.
(a -&gt; b)
-&gt; Either (Defn (Conflicted Name term) (Conflicted Name typ)) a
-&gt; Either (Defn (Conflicted Name term) (Conflicted Name typ)) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) term typ
-&gt; Nametree (DefnsF (Map NameSegment) term typ)
forall term typ.
(Ord term, Ord typ) =&gt;
DefnsF (Map Name) term typ
-&gt; Nametree (DefnsF (Map NameSegment) term typ)
</span><span class="hs-identifier hs-var">unflattenNametrees</span></span><span>
</span><span id="line-206"></span><span>    </span><span class="annot"><span class="annottext">(Either
   (Defn (Conflicted Name term) (Conflicted Name typ))
   (DefnsF (Map Name) term typ)
 -&gt; Either
      (Defn (Conflicted Name term) (Conflicted Name typ))
      (Nametree (DefnsF (Map NameSegment) term typ)))
-&gt; (DefnsF (Relation Name) term typ
    -&gt; Either
         (Defn (Conflicted Name term) (Conflicted Name typ))
         (DefnsF (Map Name) term typ))
-&gt; DefnsF (Relation Name) term typ
-&gt; Either
     (Defn (Conflicted Name term) (Conflicted Name typ))
     (Nametree (DefnsF (Map NameSegment) term typ))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Relation Name term
 -&gt; Either
      (Defn (Conflicted Name term) (Conflicted Name typ))
      (Map Name term))
-&gt; (Relation Name typ
    -&gt; Either
         (Defn (Conflicted Name term) (Conflicted Name typ)) (Map Name typ))
-&gt; DefnsF (Relation Name) term typ
-&gt; Either
     (Defn (Conflicted Name term) (Conflicted Name typ))
     (DefnsF (Map Name) term typ)
forall (f :: * -&gt; *) a c b d.
Applicative f =&gt;
(a -&gt; f c) -&gt; (b -&gt; f d) -&gt; Defns a b -&gt; f (Defns c d)
forall (t :: * -&gt; * -&gt; *) (f :: * -&gt; *) a c b d.
(Bitraversable t, Applicative f) =&gt;
(a -&gt; f c) -&gt; (b -&gt; f d) -&gt; t a b -&gt; f (t c d)
</span><span class="hs-identifier hs-var">bitraverse</span></span><span>
</span><span id="line-207"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name
 -&gt; NESet term -&gt; Defn (Conflicted Name term) (Conflicted Name typ))
-&gt; Relation Name term
-&gt; Either
     (Defn (Conflicted Name term) (Conflicted Name typ)) (Map Name term)
forall ref x.
Ord ref =&gt;
(Name -&gt; NESet ref -&gt; x)
-&gt; Relation Name ref -&gt; Either x (Map Name ref)
</span><a href="#local-6989586621680910144"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680910145"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680910145"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Conflicted Name term
-&gt; Defn (Conflicted Name term) (Conflicted Name typ)
forall term typ. term -&gt; Defn term typ
</span><span class="hs-identifier hs-var">TermDefn</span></span><span> </span><span class="annot"><span class="annottext">(Conflicted Name term
 -&gt; Defn (Conflicted Name term) (Conflicted Name typ))
-&gt; (NESet term -&gt; Conflicted Name term)
-&gt; NESet term
-&gt; Defn (Conflicted Name term) (Conflicted Name typ)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NESet term -&gt; Conflicted Name term
forall n a. n -&gt; NESet a -&gt; Conflicted n a
</span><span class="hs-identifier hs-var">Conflicted</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680910145"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name
 -&gt; NESet typ -&gt; Defn (Conflicted Name term) (Conflicted Name typ))
-&gt; Relation Name typ
-&gt; Either
     (Defn (Conflicted Name term) (Conflicted Name typ)) (Map Name typ)
forall ref x.
Ord ref =&gt;
(Name -&gt; NESet ref -&gt; x)
-&gt; Relation Name ref -&gt; Either x (Map Name ref)
</span><a href="#local-6989586621680910144"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680910146"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680910146"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Conflicted Name typ
-&gt; Defn (Conflicted Name term) (Conflicted Name typ)
forall term typ. typ -&gt; Defn term typ
</span><span class="hs-identifier hs-var">TypeDefn</span></span><span> </span><span class="annot"><span class="annottext">(Conflicted Name typ
 -&gt; Defn (Conflicted Name term) (Conflicted Name typ))
-&gt; (NESet typ -&gt; Conflicted Name typ)
-&gt; NESet typ
-&gt; Defn (Conflicted Name term) (Conflicted Name typ)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NESet typ -&gt; Conflicted Name typ
forall n a. n -&gt; NESet a -&gt; Conflicted n a
</span><span class="hs-identifier hs-var">Conflicted</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680910146"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-210"></span><span>    </span><span class="annot"><a href="#local-6989586621680910144"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680909828"><span class="annot"><a href="#local-6989586621680909828"><span class="hs-identifier hs-type">ref</span></a></span></span><span> </span><span id="local-6989586621680909829"><span class="annot"><a href="#local-6989586621680909829"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680909828"><span class="hs-identifier hs-type">ref</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><a href="#local-6989586621680909828"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680909829"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Relation</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621680909828"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621680909829"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621680909828"><span class="hs-identifier hs-type">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>    </span><span id="local-6989586621680910144"><span class="annot"><span class="annottext">go :: forall ref x.
Ord ref =&gt;
(Name -&gt; NESet ref -&gt; x)
-&gt; Relation Name ref -&gt; Either x (Map Name ref)
</span><a href="#local-6989586621680910144"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680910151"><span class="annot"><span class="annottext">Name -&gt; NESet ref -&gt; x
</span><a href="#local-6989586621680910151"><span class="hs-identifier hs-var">conflicted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-212"></span><span>      </span><span class="annot"><span class="annottext">(Name -&gt; Set ref -&gt; Either x ref)
-&gt; Map Name (Set ref) -&gt; Either x (Map Name ref)
forall (t :: * -&gt; *) k a b.
Applicative t =&gt;
(k -&gt; a -&gt; t b) -&gt; Map k a -&gt; t (Map k b)
</span><span class="hs-identifier hs-var">Map.traverseWithKey</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Set ref -&gt; Either x ref
</span><a href="#local-6989586621680910152"><span class="hs-identifier hs-var">unconflicted</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Name (Set ref) -&gt; Either x (Map Name ref))
-&gt; (Relation Name ref -&gt; Map Name (Set ref))
-&gt; Relation Name ref
-&gt; Either x (Map Name ref)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Relation Name ref -&gt; Map Name (Set ref)
forall a b. Relation a b -&gt; Map a (Set b)
</span><span class="hs-identifier hs-var">Relation.domain</span></span><span>
</span><span id="line-213"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-214"></span><span>        </span><span class="annot"><a href="#local-6989586621680910152"><span class="hs-identifier hs-type">unconflicted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621680909828"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621680909829"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680909828"><span class="hs-identifier hs-type">ref</span></a></span><span>
</span><span id="line-215"></span><span>        </span><span id="local-6989586621680910152"><span class="annot"><span class="annottext">unconflicted :: Name -&gt; Set ref -&gt; Either x ref
</span><a href="#local-6989586621680910152"><span class="hs-identifier hs-var hs-var">unconflicted</span></a></span></span><span> </span><span id="local-6989586621680910154"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680910154"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680910155"><span class="annot"><span class="annottext">Set ref
</span><a href="#local-6989586621680910155"><span class="hs-identifier hs-var">refs0</span></a></span></span><span>
</span><span id="line-216"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NESet ref -&gt; Int
forall a. NESet a -&gt; Int
</span><span class="hs-identifier hs-var">Set.NonEmpty.size</span></span><span> </span><span class="annot"><span class="annottext">NESet ref
</span><a href="#local-6989586621680910156"><span class="hs-identifier hs-var">refs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ref -&gt; Either x ref
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NESet ref -&gt; ref
forall a. NESet a -&gt; a
</span><span class="hs-identifier hs-var">Set.NonEmpty.findMin</span></span><span> </span><span class="annot"><span class="annottext">NESet ref
</span><a href="#local-6989586621680910156"><span class="hs-identifier hs-var">refs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">x -&gt; Either x ref
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; NESet ref -&gt; x
</span><a href="#local-6989586621680910151"><span class="hs-identifier hs-var">conflicted</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680910154"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">NESet ref
</span><a href="#local-6989586621680910156"><span class="hs-identifier hs-var">refs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-219"></span><span>            </span><span id="local-6989586621680910156"><span class="annot"><span class="annottext">refs :: NESet ref
</span><a href="#local-6989586621680910156"><span class="hs-identifier hs-var hs-var">refs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set ref -&gt; NESet ref
forall a. Set a -&gt; NESet a
</span><span class="hs-identifier hs-var">Set.NonEmpty.unsafeFromSet</span></span><span> </span><span class="annot"><span class="annottext">Set ref
</span><a href="#local-6989586621680910155"><span class="hs-identifier hs-var">refs0</span></a></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-comment">------------------------------------------------------------------------------------------------------------------------</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- Hydrating definitions</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="annot"><span class="hs-comment">-- | Hydrate term/type references to actual terms/types.</span></span><span>
</span><span id="line-225"></span><span class="annot"><a href="Unison.Cli.UpdateUtils.html#hydrateDefns"><span class="hs-identifier hs-type">hydrateDefns</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680909834"><span class="annot"><a href="#local-6989586621680909834"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680909835"><span class="annot"><a href="#local-6989586621680909835"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621680909836"><span class="annot"><a href="#local-6989586621680909836"><span class="hs-identifier hs-type">term</span></a></span></span><span> </span><span id="local-6989586621680909837"><span class="annot"><a href="#local-6989586621680909837"><span class="hs-identifier hs-type">typ</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680909834"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680909835"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680909834"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680909836"><span class="hs-identifier hs-type">term</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680909834"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680909837"><span class="hs-identifier hs-type">typ</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-230"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680909835"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-231"></span><span>  </span><span class="annot"><a href="#local-6989586621680909834"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680909835"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680909836"><span class="hs-identifier hs-type">term</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680909837"><span class="hs-identifier hs-type">typ</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span id="hydrateDefns"><span class="annot"><span class="annottext">hydrateDefns :: forall (m :: * -&gt; *) name term typ.
(Monad m, Ord name) =&gt;
(Hash -&gt; m [term])
-&gt; (Hash -&gt; m [typ])
-&gt; DefnsF (Map name) Id Id
-&gt; m (DefnsF (Map name) (Id, term) (Id, typ))
</span><a href="Unison.Cli.UpdateUtils.html#hydrateDefns"><span class="hs-identifier hs-var hs-var">hydrateDefns</span></a></span></span><span> </span><span id="local-6989586621680910166"><span class="annot"><span class="annottext">Hash -&gt; m [term]
</span><a href="#local-6989586621680910166"><span class="hs-identifier hs-var">getTermComponent</span></a></span></span><span> </span><span id="local-6989586621680910167"><span class="annot"><span class="annottext">Hash -&gt; m [typ]
</span><a href="#local-6989586621680910167"><span class="hs-identifier hs-var">getTypeComponent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-233"></span><span>  </span><span class="annot"><span class="annottext">(Map name Id -&gt; m (Map name (Id, term)))
-&gt; (Map name Id -&gt; m (Map name (Id, typ)))
-&gt; DefnsF (Map name) Id Id
-&gt; m (DefnsF (Map name) (Id, term) (Id, typ))
forall (f :: * -&gt; *) a c b d.
Applicative f =&gt;
(a -&gt; f c) -&gt; (b -&gt; f d) -&gt; Defns a b -&gt; f (Defns c d)
forall (t :: * -&gt; * -&gt; *) (f :: * -&gt; *) a c b d.
(Bitraversable t, Applicative f) =&gt;
(a -&gt; f c) -&gt; (b -&gt; f d) -&gt; t a b -&gt; f (t c d)
</span><span class="hs-identifier hs-var">bitraverse</span></span><span> </span><span class="annot"><span class="annottext">Map name Id -&gt; m (Map name (Id, term))
</span><a href="#local-6989586621680910168"><span class="hs-identifier hs-var">hydrateTerms</span></a></span><span> </span><span class="annot"><span class="annottext">Map name Id -&gt; m (Map name (Id, typ))
</span><a href="#local-6989586621680910169"><span class="hs-identifier hs-var">hydrateTypes</span></a></span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-235"></span><span>    </span><span class="annot"><a href="#local-6989586621680910168"><span class="hs-identifier hs-type">hydrateTerms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680909835"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680909834"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680909835"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680909836"><span class="hs-identifier hs-type">term</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>    </span><span id="local-6989586621680910168"><span class="annot"><span class="annottext">hydrateTerms :: Map name Id -&gt; m (Map name (Id, term))
</span><a href="#local-6989586621680910168"><span class="hs-identifier hs-var hs-var">hydrateTerms</span></a></span></span><span> </span><span id="local-6989586621680910170"><span class="annot"><span class="annottext">Map name Id
</span><a href="#local-6989586621680910170"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-237"></span><span>      </span><span class="annot"><span class="annottext">(Hash -&gt; m [term])
-&gt; Map name Id
-&gt; (name -&gt; Id -&gt; term -&gt; (Id, term))
-&gt; m (Map name (Id, term))
forall a b name (m :: * -&gt; *).
(Monad m, Ord name) =&gt;
(Hash -&gt; m [a])
-&gt; Map name Id -&gt; (name -&gt; Id -&gt; a -&gt; b) -&gt; m (Map name b)
</span><a href="Unison.Cli.UpdateUtils.html#hydrateDefns_"><span class="hs-identifier hs-var">hydrateDefns_</span></a></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; m [term]
</span><a href="#local-6989586621680910166"><span class="hs-identifier hs-var">getTermComponent</span></a></span><span> </span><span class="annot"><span class="annottext">Map name Id
</span><a href="#local-6989586621680910170"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>    </span><span class="annot"><a href="#local-6989586621680910169"><span class="hs-identifier hs-type">hydrateTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680909835"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680909834"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680909835"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680909837"><span class="hs-identifier hs-type">typ</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>    </span><span id="local-6989586621680910169"><span class="annot"><span class="annottext">hydrateTypes :: Map name Id -&gt; m (Map name (Id, typ))
</span><a href="#local-6989586621680910169"><span class="hs-identifier hs-var hs-var">hydrateTypes</span></a></span></span><span> </span><span id="local-6989586621680910172"><span class="annot"><span class="annottext">Map name Id
</span><a href="#local-6989586621680910172"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-241"></span><span>      </span><span class="annot"><span class="annottext">(Hash -&gt; m [typ])
-&gt; Map name Id
-&gt; (name -&gt; Id -&gt; typ -&gt; (Id, typ))
-&gt; m (Map name (Id, typ))
forall a b name (m :: * -&gt; *).
(Monad m, Ord name) =&gt;
(Hash -&gt; m [a])
-&gt; Map name Id -&gt; (name -&gt; Id -&gt; a -&gt; b) -&gt; m (Map name b)
</span><a href="Unison.Cli.UpdateUtils.html#hydrateDefns_"><span class="hs-identifier hs-var">hydrateDefns_</span></a></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; m [typ]
</span><a href="#local-6989586621680910167"><span class="hs-identifier hs-var">getTypeComponent</span></a></span><span> </span><span class="annot"><span class="annottext">Map name Id
</span><a href="#local-6989586621680910172"><span class="hs-identifier hs-var">types</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="annot"><a href="Unison.Cli.UpdateUtils.html#hydrateDefns_"><span class="hs-identifier hs-type">hydrateDefns_</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680909844"><span class="annot"><a href="#local-6989586621680909844"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680909845"><span class="annot"><a href="#local-6989586621680909845"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621680909843"><span class="annot"><a href="#local-6989586621680909843"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621680909842"><span class="annot"><a href="#local-6989586621680909842"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680909842"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680909843"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680909842"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680909844"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-247"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680909843"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Id</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680909843"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Id</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680909844"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680909845"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-249"></span><span>  </span><span class="annot"><a href="#local-6989586621680909842"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680909843"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680909845"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span id="hydrateDefns_"><span class="annot"><span class="annottext">hydrateDefns_ :: forall a b name (m :: * -&gt; *).
(Monad m, Ord name) =&gt;
(Hash -&gt; m [a])
-&gt; Map name Id -&gt; (name -&gt; Id -&gt; a -&gt; b) -&gt; m (Map name b)
</span><a href="Unison.Cli.UpdateUtils.html#hydrateDefns_"><span class="hs-identifier hs-var hs-var">hydrateDefns_</span></a></span></span><span> </span><span id="local-6989586621680910189"><span class="annot"><span class="annottext">Hash -&gt; m [a]
</span><a href="#local-6989586621680910189"><span class="hs-identifier hs-var">getComponent</span></a></span></span><span> </span><span id="local-6989586621680910190"><span class="annot"><span class="annottext">Map name Id
</span><a href="#local-6989586621680910190"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span id="local-6989586621680910191"><span class="annot"><span class="annottext">name -&gt; Id -&gt; a -&gt; b
</span><a href="#local-6989586621680910191"><span class="hs-identifier hs-var">modify</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-251"></span><span>  </span><span class="annot"><span class="annottext">(Map name b -&gt; Hash -&gt; m (Map name b))
-&gt; Map name b -&gt; Set Hash -&gt; m (Map name b)
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">Foldable.foldlM</span></span><span> </span><span class="annot"><span class="annottext">Map name b -&gt; Hash -&gt; m (Map name b)
</span><a href="#local-6989586621680910193"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Map name b
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; Set Hash) -&gt; Map name Id -&gt; Set Hash
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Map name a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash -&gt; Set Hash
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="annot"><span class="annottext">(Hash -&gt; Set Hash) -&gt; (Id -&gt; Hash) -&gt; Id -&gt; Set Hash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Hash
</span><span class="hs-identifier hs-var">Reference.idToHash</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map name Id
</span><a href="#local-6989586621680910190"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-253"></span><span>    </span><span class="annot"><a href="#local-6989586621680910193"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680909843"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680909845"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680909842"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680909843"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680909845"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>    </span><span id="local-6989586621680910193"><span class="annot"><span class="annottext">f :: Map name b -&gt; Hash -&gt; m (Map name b)
</span><a href="#local-6989586621680910193"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680910196"><span class="annot"><span class="annottext">Map name b
</span><a href="#local-6989586621680910196"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621680910197"><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621680910197"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-255"></span><span>      </span><span class="annot"><span class="annottext">(Map name b -&gt; (Id, a) -&gt; Map name b)
-&gt; Map name b -&gt; [(Id, a)] -&gt; Map name b
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">List.foldl'</span></span><span> </span><span class="annot"><span class="annottext">Map name b -&gt; (Id, a) -&gt; Map name b
</span><a href="#local-6989586621680910199"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Map name b
</span><a href="#local-6989586621680910196"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">([(Id, a)] -&gt; Map name b)
-&gt; ([a] -&gt; [(Id, a)]) -&gt; [a] -&gt; Map name b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; [a] -&gt; [(Id, a)]
forall a. Hash -&gt; [a] -&gt; [(Id, a)]
</span><span class="hs-identifier hs-var">Reference.componentFor</span></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621680910197"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">([a] -&gt; Map name b) -&gt; m [a] -&gt; m (Map name b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; m [a]
</span><a href="#local-6989586621680910189"><span class="hs-identifier hs-var">getComponent</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621680910197"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><a href="#local-6989586621680910199"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680909843"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680909845"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.Id</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680909844"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680909843"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680909845"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-258"></span><span>    </span><span id="local-6989586621680910199"><span class="annot"><span class="annottext">g :: Map name b -&gt; (Id, a) -&gt; Map name b
</span><a href="#local-6989586621680910199"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span id="local-6989586621680910202"><span class="annot"><span class="annottext">Map name b
</span><a href="#local-6989586621680910202"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680910203"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621680910203"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680910204"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680910204"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-259"></span><span>      </span><span class="annot"><span class="annottext">(Map name b -&gt; name -&gt; Map name b)
-&gt; Map name b -&gt; Set name -&gt; Map name b
forall a b. (a -&gt; b -&gt; a) -&gt; a -&gt; Set b -&gt; a
</span><span class="hs-identifier hs-var">Set.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; a -&gt; Map name b -&gt; name -&gt; Map name b
</span><a href="#local-6989586621680910205"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621680910203"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680910204"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map name b
</span><a href="#local-6989586621680910202"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; BiMultimap Id name -&gt; Set name
forall a b. Ord a =&gt; a -&gt; BiMultimap a b -&gt; Set b
</span><span class="hs-identifier hs-var">BiMultimap.lookupDom</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621680910203"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">BiMultimap Id name
</span><a href="#local-6989586621680910206"><span class="hs-identifier hs-var">defns2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span>    </span><span class="annot"><a href="#local-6989586621680910205"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Id</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680909844"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680909843"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680909845"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680909843"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680909843"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680909845"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-262"></span><span>    </span><span id="local-6989586621680910205"><span class="annot"><span class="annottext">h :: Id -&gt; a -&gt; Map name b -&gt; name -&gt; Map name b
</span><a href="#local-6989586621680910205"><span class="hs-identifier hs-var hs-var">h</span></a></span></span><span> </span><span id="local-6989586621680910207"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621680910207"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621680910208"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680910208"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span id="local-6989586621680910209"><span class="annot"><span class="annottext">Map name b
</span><a href="#local-6989586621680910209"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621680910210"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621680910210"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-263"></span><span>      </span><span class="annot"><span class="annottext">name -&gt; b -&gt; Map name b -&gt; Map name b
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621680910210"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">name -&gt; Id -&gt; a -&gt; b
</span><a href="#local-6989586621680910191"><span class="hs-identifier hs-var">modify</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621680910210"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621680910207"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680910208"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map name b
</span><a href="#local-6989586621680910209"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span>    </span><span class="annot"><a href="#local-6989586621680910206"><span class="hs-identifier hs-type">defns2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Id</span></span><span> </span><span class="annot"><a href="#local-6989586621680909843"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span id="local-6989586621680910206"><span class="annot"><span class="annottext">defns2 :: BiMultimap Id name
</span><a href="#local-6989586621680910206"><span class="hs-identifier hs-var hs-var">defns2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-267"></span><span>      </span><span class="annot"><span class="annottext">Map name Id -&gt; BiMultimap Id name
forall a b. (Ord a, Ord b) =&gt; Map b a -&gt; BiMultimap a b
</span><span class="hs-identifier hs-var">BiMultimap.fromRange</span></span><span> </span><span class="annot"><span class="annottext">Map name Id
</span><a href="#local-6989586621680910190"><span class="hs-identifier hs-var">defns</span></a></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="hs-comment">------------------------------------------------------------------------------------------------------------------------</span><span>
</span><span id="line-270"></span><span class="hs-comment">-- Parsing and typechecking</span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="hs-comment">-- TODO: find a better module for this function, as it's used in a couple places</span><span>
</span><span id="line-273"></span><span class="annot"><a href="Unison.Cli.UpdateUtils.html#parseAndTypecheck"><span class="hs-identifier hs-type">parseAndTypecheck</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pretty.ColorText</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-275"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Parser.ParsingEnv</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Transaction</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-276"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypecheckedUnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span id="parseAndTypecheck"><span class="annot"><span class="annottext">parseAndTypecheck :: Pretty ColorText
-&gt; ParsingEnv Transaction
-&gt; Cli (Maybe (TypecheckedUnisonFile Symbol Ann))
</span><a href="Unison.Cli.UpdateUtils.html#parseAndTypecheck"><span class="hs-identifier hs-var hs-var">parseAndTypecheck</span></a></span></span><span> </span><span id="local-6989586621680910212"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680910212"><span class="hs-identifier hs-var">prettyUf</span></a></span></span><span> </span><span id="local-6989586621680910213"><span class="annot"><span class="annottext">ParsingEnv Transaction
</span><a href="#local-6989586621680910213"><span class="hs-identifier hs-var">parsingEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-278"></span><span>  </span><span id="local-6989586621680910214"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621680910214"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680910215"><span class="annot"><span class="annottext">stringUf :: String
</span><a href="#local-6989586621680910215"><span class="hs-identifier hs-var hs-var">stringUf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; String
</span><span class="hs-identifier hs-var">Pretty.toPlain</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">80</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680910212"><span class="hs-identifier hs-var">prettyUf</span></a></span><span>
</span><span id="line-280"></span><span>  </span><span class="annot"><span class="annottext">DebugFlag -&gt; Cli () -&gt; Cli ()
forall (m :: * -&gt; *). Monad m =&gt; DebugFlag -&gt; m () -&gt; m ()
</span><span class="hs-identifier hs-var">Debug.whenDebug</span></span><span> </span><span class="annot"><span class="annottext">DebugFlag
</span><span class="hs-identifier hs-var">Debug.Update</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-281"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; Cli ()
forall a. IO a -&gt; Cli a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-282"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;--- Scratch ---&quot;</span></span><span>
</span><span id="line-283"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680910215"><span class="hs-identifier hs-var">stringUf</span></a></span><span>
</span><span id="line-284"></span><span>  </span><span class="annot"><span class="annottext">Transaction (Maybe (TypecheckedUnisonFile Symbol Ann))
-&gt; Cli (Maybe (TypecheckedUnisonFile Symbol Ann))
forall a. Transaction a -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#runTransaction"><span class="hs-identifier hs-var">Cli.runTransaction</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-285"></span><span>    </span><span class="annot"><span class="annottext">String
-&gt; String
-&gt; ParsingEnv Transaction
-&gt; Transaction (Either (Err Symbol) (UnisonFile Symbol Ann))
forall (m :: * -&gt; *) v.
(Monad m, Var v) =&gt;
String
-&gt; String -&gt; ParsingEnv m -&gt; m (Either (Err v) (UnisonFile v Ann))
</span><span class="hs-identifier hs-var">Parsers.parseFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;update&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680910215"><span class="hs-identifier hs-var">stringUf</span></a></span><span> </span><span class="annot"><span class="annottext">ParsingEnv Transaction
</span><a href="#local-6989586621680910213"><span class="hs-identifier hs-var">parsingEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Transaction (Either (Err Symbol) (UnisonFile Symbol Ann))
-&gt; (Either (Err Symbol) (UnisonFile Symbol Ann)
    -&gt; Transaction (Maybe (TypecheckedUnisonFile Symbol Ann)))
-&gt; Transaction (Maybe (TypecheckedUnisonFile Symbol Ann))
forall a b. Transaction a -&gt; (a -&gt; Transaction b) -&gt; Transaction b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-286"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">Err Symbol
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
-&gt; Transaction (Maybe (TypecheckedUnisonFile Symbol Ann))
forall a. a -&gt; Transaction a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-287"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680910223"><span class="annot"><span class="annottext">UnisonFile Symbol Ann
</span><a href="#local-6989586621680910223"><span class="hs-identifier hs-var">uf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-288"></span><span>        </span><span id="local-6989586621680910224"><span class="annot"><span class="annottext">Env Symbol Ann
</span><a href="#local-6989586621680910224"><span class="hs-identifier hs-var">typecheckingEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-289"></span><span>          </span><span class="annot"><span class="annottext">ShouldUseTndr Transaction
-&gt; Codebase IO Symbol Ann
-&gt; [Type Symbol Ann]
-&gt; UnisonFile Symbol Ann
-&gt; Transaction (Env Symbol Ann)
</span><a href="Unison.Cli.TypeCheck.html#computeTypecheckingEnvironment"><span class="hs-identifier hs-var">computeTypecheckingEnvironment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ParsingEnv Transaction -&gt; ShouldUseTndr Transaction
forall (m :: * -&gt; *). ParsingEnv m -&gt; ShouldUseTndr m
</span><span class="hs-identifier hs-var">FileParsers.ShouldUseTndr'Yes</span></span><span> </span><span class="annot"><span class="annottext">ParsingEnv Transaction
</span><a href="#local-6989586621680910213"><span class="hs-identifier hs-var">parsingEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621680910214"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">codebase</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">UnisonFile Symbol Ann
</span><a href="#local-6989586621680910223"><span class="hs-identifier hs-var">uf</span></a></span><span>
</span><span id="line-290"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Result (Seq (Note Symbol Ann)) (TypecheckedUnisonFile Symbol Ann)
-&gt; Maybe (TypecheckedUnisonFile Symbol Ann)
forall notes a. Result notes a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Result.result</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env Symbol Ann
-&gt; UnisonFile Symbol Ann
-&gt; Result
     (Seq (Note Symbol Ann)) (TypecheckedUnisonFile Symbol Ann)
forall (m :: * -&gt; *) v.
(Monad m, Var v) =&gt;
Env v Ann
-&gt; UnisonFile v
-&gt; ResultT (Seq (Note v Ann)) m (TypecheckedUnisonFile v Ann)
</span><span class="hs-identifier hs-var">FileParsers.synthesizeFile</span></span><span> </span><span class="annot"><span class="annottext">Env Symbol Ann
</span><a href="#local-6989586621680910224"><span class="hs-identifier hs-var">typecheckingEnv</span></a></span><span> </span><span class="annot"><span class="annottext">UnisonFile Symbol Ann
</span><a href="#local-6989586621680910223"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-291"></span></pre></body></html>