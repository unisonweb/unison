<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Codebase.Editor.HandleInput.FormatFile</span><span>
</span><span id="line-2"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#formatFile"><span class="hs-identifier">formatFile</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-3"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#applyTextReplacements"><span class="hs-identifier">applyTextReplacements</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-4"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#TextReplacement"><span class="hs-identifier">TextReplacement</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span class="hs-keyword">where</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">List</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntervalMap.Interval</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Interval</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty.Extra</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NEL</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Builder</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TB</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Core.ABT</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ABT</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Path</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Path</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DataDeclaration</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Decl</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.HashQualified</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HQ</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Lexer.Pos</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pos</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Name</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ann</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnv.Util</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPE</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPED</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Reference</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.DeclPrinter</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DeclPrinter</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.Name</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Name</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.TermPrinter</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TermPrinter</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Term</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Term</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.UnisonFile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TypecheckedUnisonFile</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">UnisonFile</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.UnisonFile</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UF</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.UnisonFile.Summary</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FileSummary</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Pretty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pretty</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Range</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Range</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Var</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Var</span></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="annot"><span class="hs-comment">-- | Format a file, returning a list of Text replacements to apply to the file.</span></span><span>
</span><span id="line-41"></span><span id="local-6989586621680868373"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#formatFile"><span class="hs-identifier hs-type">formatFile</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680868373"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann.Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypecheckedUnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann.Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680868373"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann.Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypecheckedUnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann.Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Range</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><a href="#local-6989586621680868373"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#TextReplacement"><span class="hs-identifier hs-type">TextReplacement</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-50"></span><span id="formatFile"><span class="annot"><span class="annottext">formatFile :: forall (m :: * -&gt; *).
Monad m =&gt;
(Maybe (UnisonFile Symbol Ann)
 -&gt; Maybe (TypecheckedUnisonFile Symbol Ann)
 -&gt; m PrettyPrintEnvDecl)
-&gt; Int
-&gt; Absolute
-&gt; Maybe (UnisonFile Symbol Ann)
-&gt; Maybe (TypecheckedUnisonFile Symbol Ann)
-&gt; Maybe (Set Range)
-&gt; m (Maybe [TextReplacement])
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#formatFile"><span class="hs-identifier hs-var hs-var">formatFile</span></a></span></span><span> </span><span id="local-6989586621680869005"><span class="annot"><span class="annottext">Maybe (UnisonFile Symbol Ann)
-&gt; Maybe (TypecheckedUnisonFile Symbol Ann) -&gt; m PrettyPrintEnvDecl
</span><a href="#local-6989586621680869005"><span class="hs-identifier hs-var">makePPEDForFile</span></a></span></span><span> </span><span id="local-6989586621680869006"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869006"><span class="hs-identifier hs-var">formattingWidth</span></a></span></span><span> </span><span id="local-6989586621680869007"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680869007"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span id="local-6989586621680869008"><span class="annot"><span class="annottext">Maybe (UnisonFile Symbol Ann)
</span><a href="#local-6989586621680869008"><span class="hs-identifier hs-var">inputParsedFile</span></a></span></span><span> </span><span id="local-6989586621680869009"><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
</span><a href="#local-6989586621680869009"><span class="hs-identifier hs-var">inputTypecheckedFile</span></a></span></span><span> </span><span id="local-6989586621680869010"><span class="annot"><span class="annottext">Maybe (Set Range)
</span><a href="#local-6989586621680869010"><span class="hs-identifier hs-var">mayRangesToFormat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT m [TextReplacement] -&gt; m (Maybe [TextReplacement])
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT m [TextReplacement] -&gt; m (Maybe [TextReplacement]))
-&gt; MaybeT m [TextReplacement] -&gt; m (Maybe [TextReplacement])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680869012"><span class="annot"><span class="annottext">Maybe (UnisonFile Symbol Ann)
</span><a href="#local-6989586621680869012"><span class="hs-identifier hs-var">mayParsedFile</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869013"><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
</span><a href="#local-6989586621680869013"><span class="hs-identifier hs-var">mayTypecheckedFile</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (UnisonFile Symbol Ann)
-&gt; Maybe (TypecheckedUnisonFile Symbol Ann)
-&gt; (Maybe (UnisonFile Symbol Ann),
    Maybe (TypecheckedUnisonFile Symbol Ann))
</span><a href="#local-6989586621680869014"><span class="hs-identifier hs-var">mkUnisonFilesDeterministic</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (UnisonFile Symbol Ann)
</span><a href="#local-6989586621680869008"><span class="hs-identifier hs-var">inputParsedFile</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
</span><a href="#local-6989586621680869009"><span class="hs-identifier hs-var">inputTypecheckedFile</span></a></span><span>
</span><span id="line-52"></span><span>  </span><span id="local-6989586621680869015"><span class="annot"><span class="annottext">FileSummary
</span><a href="#local-6989586621680869015"><span class="hs-identifier hs-var">fileSummary</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe FileSummary -&gt; MaybeT m FileSummary
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">hoistMaybe</span></span><span> </span><span class="annot"><span class="annottext">(Maybe FileSummary -&gt; MaybeT m FileSummary)
-&gt; Maybe FileSummary -&gt; MaybeT m FileSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe (UnisonFile Symbol Ann)
-&gt; Maybe (TypecheckedUnisonFile Symbol Ann) -&gt; Maybe FileSummary
</span><span class="hs-identifier hs-var">FileSummary.mkFileSummary</span></span><span> </span><span class="annot"><span class="annottext">Maybe (UnisonFile Symbol Ann)
</span><a href="#local-6989586621680869012"><span class="hs-identifier hs-var">mayParsedFile</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
</span><a href="#local-6989586621680869013"><span class="hs-identifier hs-var">mayTypecheckedFile</span></a></span><span>
</span><span id="line-53"></span><span>  </span><span id="local-6989586621680869018"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621680869018"><span class="hs-identifier hs-var">filePPED</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m PrettyPrintEnvDecl -&gt; MaybeT m PrettyPrintEnvDecl
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MaybeT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m PrettyPrintEnvDecl -&gt; MaybeT m PrettyPrintEnvDecl)
-&gt; m PrettyPrintEnvDecl -&gt; MaybeT m PrettyPrintEnvDecl
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe (UnisonFile Symbol Ann)
-&gt; Maybe (TypecheckedUnisonFile Symbol Ann) -&gt; m PrettyPrintEnvDecl
</span><a href="#local-6989586621680869005"><span class="hs-identifier hs-var">makePPEDForFile</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (UnisonFile Symbol Ann)
</span><a href="#local-6989586621680869012"><span class="hs-identifier hs-var">mayParsedFile</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
</span><a href="#local-6989586621680869013"><span class="hs-identifier hs-var">mayTypecheckedFile</span></a></span><span>
</span><span id="line-54"></span><span>  </span><span id="local-6989586621680869020"><span class="annot"><span class="annottext">UnisonFile Symbol Ann
</span><a href="#local-6989586621680869020"><span class="hs-identifier hs-var">parsedFile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (UnisonFile Symbol Ann) -&gt; MaybeT m (UnisonFile Symbol Ann)
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">hoistMaybe</span></span><span> </span><span class="annot"><span class="annottext">Maybe (UnisonFile Symbol Ann)
</span><a href="#local-6989586621680869012"><span class="hs-identifier hs-var">mayParsedFile</span></a></span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-comment">-- Don't format anything unless the file typechecks.</span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-comment">-- The formatter mostly works on a parsed file, but we currently fail to print</span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-comment">-- '{{ .. }}'-style docs correctly if they don't typecheck.</span><span>
</span><span id="line-58"></span><span>  </span><span id="local-6989586621680869021"><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621680869021"><span class="hs-identifier hs-var">_typecheckedFile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
-&gt; MaybeT m (TypecheckedUnisonFile Symbol Ann)
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">hoistMaybe</span></span><span> </span><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
</span><a href="#local-6989586621680869013"><span class="hs-identifier hs-var">mayTypecheckedFile</span></a></span><span>
</span><span id="line-59"></span><span>  </span><span id="local-6989586621680869022"><span class="annot"><span class="annottext">Map Symbol (Ann, Pretty ColorText)
</span><a href="#local-6989586621680869022"><span class="hs-identifier hs-var">formattedDecls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FileSummary
-&gt; Map
     Symbol
     (TypeReferenceId,
      Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann))
</span><span class="hs-identifier hs-var">FileSummary.allTypeDecls</span></span><span> </span><span class="annot"><span class="annottext">FileSummary
</span><a href="#local-6989586621680869015"><span class="hs-identifier hs-var">fileSummary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>      </span><span class="annot"><span class="annottext">Map
  Symbol
  (TypeReferenceId,
   Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann))
-&gt; (Map
      Symbol
      (TypeReferenceId,
       Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann))
    -&gt; Map
         Symbol
         (Ann, TypeReferenceId,
          Either
            (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann)))
-&gt; Map
     Symbol
     (Ann, TypeReferenceId,
      Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann))
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">((TypeReferenceId,
  Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann))
 -&gt; (Ann, TypeReferenceId,
     Either
       (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann)))
-&gt; Map
     Symbol
     (TypeReferenceId,
      Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann))
-&gt; Map
     Symbol
     (Ann, TypeReferenceId,
      Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann))
forall a b. (a -&gt; b) -&gt; Map Symbol a -&gt; Map Symbol b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span>
</span><span id="line-62"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680869025"><span class="annot"><span class="annottext">TypeReferenceId
</span><a href="#local-6989586621680869025"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869026"><span class="annot"><span class="annottext">Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann)
</span><a href="#local-6989586621680869026"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-63"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680869027"><span class="annot"><span class="annottext">tldAnn :: Ann
</span><a href="#local-6989586621680869027"><span class="hs-identifier hs-var hs-var">tldAnn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EffectDeclaration Symbol Ann -&gt; Ann)
-&gt; (DataDeclaration Symbol Ann -&gt; Ann)
-&gt; Either
     (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann)
-&gt; Ann
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataDeclaration Symbol Ann -&gt; Ann
forall v a. DataDeclaration v a -&gt; a
</span><span class="hs-identifier hs-var">Decl.annotation</span></span><span> </span><span class="annot"><span class="annottext">(DataDeclaration Symbol Ann -&gt; Ann)
-&gt; (EffectDeclaration Symbol Ann -&gt; DataDeclaration Symbol Ann)
-&gt; EffectDeclaration Symbol Ann
-&gt; Ann
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EffectDeclaration Symbol Ann -&gt; DataDeclaration Symbol Ann
forall v a. EffectDeclaration v a -&gt; DataDeclaration v a
</span><span class="hs-identifier hs-var">Decl.toDataDecl</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataDeclaration Symbol Ann -&gt; Ann
forall v a. DataDeclaration v a -&gt; a
</span><span class="hs-identifier hs-var">Decl.annotation</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann)
</span><a href="#local-6989586621680869026"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-64"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621680869027"><span class="hs-identifier hs-var">tldAnn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeReferenceId
</span><a href="#local-6989586621680869025"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann)
</span><a href="#local-6989586621680869026"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>      </span><span class="annot"><span class="annottext">Map
  Symbol
  (Ann, TypeReferenceId,
   Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann))
-&gt; (Map
      Symbol
      (Ann, TypeReferenceId,
       Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann))
    -&gt; Map
         Symbol
         (Ann, TypeReferenceId,
          Either
            (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann)))
-&gt; Map
     Symbol
     (Ann, TypeReferenceId,
      Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann))
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">((Ann, TypeReferenceId,
  Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann))
 -&gt; Bool)
-&gt; Map
     Symbol
     (Ann, TypeReferenceId,
      Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann))
-&gt; Map
     Symbol
     (Ann, TypeReferenceId,
      Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann))
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680869033"><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621680869033"><span class="hs-identifier hs-var">tldAnn</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeReferenceId
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ann -&gt; Bool
</span><a href="#local-6989586621680869034"><span class="hs-identifier hs-var">isInFormatRange</span></a></span><span> </span><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621680869033"><span class="hs-identifier hs-var">tldAnn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>      </span><span class="annot"><span class="annottext">Map
  Symbol
  (Ann, TypeReferenceId,
   Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann))
-&gt; (Map
      Symbol
      (Ann, TypeReferenceId,
       Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann))
    -&gt; MaybeT m (Map Symbol (Ann, Pretty ColorText)))
-&gt; MaybeT m (Map Symbol (Ann, Pretty ColorText))
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Symbol
 -&gt; (Ann, TypeReferenceId,
     Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann))
 -&gt; MaybeT m (Ann, Pretty ColorText))
-&gt; Map
     Symbol
     (Ann, TypeReferenceId,
      Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann))
-&gt; MaybeT m (Map Symbol (Ann, Pretty ColorText))
forall i (t :: * -&gt; *) (f :: * -&gt; *) a b.
(TraversableWithIndex i t, Applicative f) =&gt;
(i -&gt; a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(Symbol -&gt; a -&gt; f b) -&gt; Map Symbol a -&gt; f (Map Symbol b)
</span><span class="hs-identifier hs-var">itraverse</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680869036"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680869036"><span class="hs-identifier hs-var">sym</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680869037"><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621680869037"><span class="hs-identifier hs-var">tldAnn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869038"><span class="annot"><span class="annottext">TypeReferenceId
</span><a href="#local-6989586621680869038"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869039"><span class="annot"><span class="annottext">Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann)
</span><a href="#local-6989586621680869039"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-68"></span><span>        </span><span id="local-6989586621680869040"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680869040"><span class="hs-identifier hs-var">symName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; MaybeT m Name
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">hoistMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol -&gt; Maybe Name
forall v. Var v =&gt; v -&gt; Maybe Name
</span><span class="hs-identifier hs-var">Name.parseVar</span></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680869036"><span class="hs-identifier hs-var">sym</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680869042"><span class="annot"><span class="annottext">declNameSegments :: NonEmpty NameSegment
</span><a href="#local-6989586621680869042"><span class="hs-identifier hs-var hs-var">declNameSegments</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NameSegment] -&gt; NonEmpty NameSegment -&gt; NonEmpty NameSegment
forall a. [a] -&gt; NonEmpty a -&gt; NonEmpty a
</span><span class="hs-identifier hs-var">NEL.appendr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; [NameSegment]
</span><span class="hs-identifier hs-var">Path.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680869007"><span class="hs-identifier hs-var">currentPath</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; NonEmpty NameSegment
</span><span class="hs-identifier hs-var">Name.segments</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680869040"><span class="hs-identifier hs-var">symName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680869047"><span class="annot"><span class="annottext">declName :: Name
</span><a href="#local-6989586621680869047"><span class="hs-identifier hs-var hs-var">declName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty NameSegment -&gt; Name
</span><span class="hs-identifier hs-var">Name.fromSegments</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty NameSegment
</span><a href="#local-6989586621680869042"><span class="hs-identifier hs-var">declNameSegments</span></a></span><span>
</span><span id="line-71"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680869049"><span class="annot"><span class="annottext">hqName :: HashQualified Name
</span><a href="#local-6989586621680869049"><span class="hs-identifier hs-var hs-var">hqName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; HashQualified Name
forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.fromName</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680869040"><span class="hs-identifier hs-var">symName</span></a></span><span>
</span><span id="line-72"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680869051"><span class="annot"><span class="annottext">biasedPPED :: PrettyPrintEnvDecl
</span><a href="#local-6989586621680869051"><span class="hs-identifier hs-var hs-var">biasedPPED</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; PrettyPrintEnvDecl -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.biasTo</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680869047"><span class="hs-identifier hs-var">declName</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621680869018"><span class="hs-identifier hs-var">filePPED</span></a></span><span>
</span><span id="line-73"></span><span>        </span><span class="hs-comment">-- If it's a unique type the parser will re-order constructors arbitrarily because</span><span>
</span><span id="line-74"></span><span>        </span><span class="hs-comment">-- the random unique seed gets mixed in and then things are ordered by hash.</span><span>
</span><span id="line-75"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-76"></span><span>        </span><span class="hs-comment">-- The constructor order will always be re-ordered on definition Add anyways, so we</span><span>
</span><span id="line-77"></span><span>        </span><span class="hs-comment">-- just force alphabetical order for unique types for sanity reasons.</span><span>
</span><span id="line-78"></span><span>        </span><span class="hs-comment">-- Doesn't work unless we alter it before building the pped</span><span>
</span><span id="line-79"></span><span>        </span><span class="hs-comment">-- let deterministicDecl = decl &amp; Decl.declAsDataDecl_ . Decl.constructors_ %~ sortOn (view _1)</span><span>
</span><span id="line-80"></span><span>        </span><span class="annot"><span class="annottext">(Ann, Pretty ColorText) -&gt; MaybeT m (Ann, Pretty ColorText)
forall a. a -&gt; MaybeT m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((Ann, Pretty ColorText) -&gt; MaybeT m (Ann, Pretty ColorText))
-&gt; (Ann, Pretty ColorText) -&gt; MaybeT m (Ann, Pretty ColorText)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-81"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621680869037"><span class="hs-identifier hs-var">tldAnn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
-&gt; TypeReference
-&gt; HashQualified Name
-&gt; Either
     (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann)
-&gt; Pretty SyntaxText
forall v a.
Var v =&gt;
PrettyPrintEnvDecl
-&gt; TypeReference
-&gt; HashQualified Name
-&gt; Decl v a
-&gt; Pretty SyntaxText
</span><span class="hs-identifier hs-var">DeclPrinter.prettyDecl</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621680869051"><span class="hs-identifier hs-var">biasedPPED</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReferenceId -&gt; TypeReference
forall h t. Id' h -&gt; Reference' t h
</span><span class="hs-identifier hs-var">Reference.DerivedId</span></span><span> </span><span class="annot"><span class="annottext">TypeReferenceId
</span><a href="#local-6989586621680869038"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621680869049"><span class="hs-identifier hs-var">hqName</span></a></span><span> </span><span class="annot"><span class="annottext">Either (EffectDeclaration Symbol Ann) (DataDeclaration Symbol Ann)
</span><a href="#local-6989586621680869039"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>            </span><span class="annot"><span class="annottext">(Ann, Pretty SyntaxText)
-&gt; ((Ann, Pretty SyntaxText) -&gt; (Ann, Pretty ColorText))
-&gt; (Ann, Pretty ColorText)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (Ann, Pretty SyntaxText)
  (Ann, Pretty ColorText)
  (Pretty SyntaxText)
  (Pretty ColorText)
-&gt; (Pretty SyntaxText -&gt; Pretty ColorText)
-&gt; (Ann, Pretty SyntaxText)
-&gt; (Ann, Pretty ColorText)
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (Ann, Pretty SyntaxText)
  (Ann, Pretty ColorText)
  (Pretty SyntaxText)
  (Pretty ColorText)
forall s t a b. Field2 s t a b =&gt; Lens s t a b
Lens
  (Ann, Pretty SyntaxText)
  (Ann, Pretty ColorText)
  (Pretty SyntaxText)
  (Pretty ColorText)
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">Pretty SyntaxText -&gt; Pretty ColorText
forall r. Pretty (SyntaxText' r) -&gt; Pretty ColorText
</span><span class="hs-identifier hs-var">Pretty.syntaxToColor</span></span><span>
</span><span id="line-83"></span><span>  </span><span id="local-6989586621680869058"><span class="annot"><span class="annottext">Map Symbol (Ann, Pretty ColorText)
</span><a href="#local-6989586621680869058"><span class="hs-identifier hs-var">formattedTerms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FileSummary
-&gt; Map
     Symbol
     (Ann, Maybe TypeReferenceId, Term Symbol Ann,
      Maybe (Type Symbol Ann))
</span><span class="hs-identifier hs-var">FileSummary.termsBySymbol</span></span><span> </span><span class="annot"><span class="annottext">FileSummary
</span><a href="#local-6989586621680869015"><span class="hs-identifier hs-var">fileSummary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>      </span><span class="annot"><span class="annottext">Map
  Symbol
  (Ann, Maybe TypeReferenceId, Term Symbol Ann,
   Maybe (Type Symbol Ann))
-&gt; (Map
      Symbol
      (Ann, Maybe TypeReferenceId, Term Symbol Ann,
       Maybe (Type Symbol Ann))
    -&gt; Map
         Symbol
         (Ann, Maybe TypeReferenceId, Term Symbol Ann,
          Maybe (Type Symbol Ann)))
-&gt; Map
     Symbol
     (Ann, Maybe TypeReferenceId, Term Symbol Ann,
      Maybe (Type Symbol Ann))
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">((Ann, Maybe TypeReferenceId, Term Symbol Ann,
  Maybe (Type Symbol Ann))
 -&gt; Bool)
-&gt; Map
     Symbol
     (Ann, Maybe TypeReferenceId, Term Symbol Ann,
      Maybe (Type Symbol Ann))
-&gt; Map
     Symbol
     (Ann, Maybe TypeReferenceId, Term Symbol Ann,
      Maybe (Type Symbol Ann))
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680869060"><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621680869060"><span class="hs-identifier hs-var">tldAnn</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe TypeReferenceId
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869061"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621680869061"><span class="hs-identifier hs-var">trm</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ann -&gt; Term Symbol Ann -&gt; Bool
</span><a href="#local-6989586621680869062"><span class="hs-identifier hs-var">shouldFormatTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621680869060"><span class="hs-identifier hs-var">tldAnn</span></a></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621680869061"><span class="hs-identifier hs-var">trm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>      </span><span class="annot"><span class="annottext">Map
  Symbol
  (Ann, Maybe TypeReferenceId, Term Symbol Ann,
   Maybe (Type Symbol Ann))
-&gt; (Map
      Symbol
      (Ann, Maybe TypeReferenceId, Term Symbol Ann,
       Maybe (Type Symbol Ann))
    -&gt; MaybeT m (Map Symbol (Ann, Pretty ColorText)))
-&gt; MaybeT m (Map Symbol (Ann, Pretty ColorText))
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Symbol
 -&gt; (Ann, Maybe TypeReferenceId, Term Symbol Ann,
     Maybe (Type Symbol Ann))
 -&gt; MaybeT m (Ann, Pretty ColorText))
-&gt; Map
     Symbol
     (Ann, Maybe TypeReferenceId, Term Symbol Ann,
      Maybe (Type Symbol Ann))
-&gt; MaybeT m (Map Symbol (Ann, Pretty ColorText))
forall i (t :: * -&gt; *) (f :: * -&gt; *) a b.
(TraversableWithIndex i t, Applicative f) =&gt;
(i -&gt; a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(Symbol -&gt; a -&gt; f b) -&gt; Map Symbol a -&gt; f (Map Symbol b)
</span><span class="hs-identifier hs-var">itraverse</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680869063"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680869063"><span class="hs-identifier hs-var">sym</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680869064"><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621680869064"><span class="hs-identifier hs-var">tldAnn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869065"><span class="annot"><span class="annottext">Maybe TypeReferenceId
</span><a href="#local-6989586621680869065"><span class="hs-identifier hs-var">mayRefId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869066"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621680869066"><span class="hs-identifier hs-var">trm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869067"><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621680869067"><span class="hs-identifier hs-var">_typ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-87"></span><span>        </span><span id="local-6989586621680869068"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680869068"><span class="hs-identifier hs-var">symName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; MaybeT m Name
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">hoistMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol -&gt; Maybe Name
forall v. Var v =&gt; v -&gt; Maybe Name
</span><span class="hs-identifier hs-var">Name.parseVar</span></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680869063"><span class="hs-identifier hs-var">sym</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680869069"><span class="annot"><span class="annottext">defNameSegments :: NonEmpty NameSegment
</span><a href="#local-6989586621680869069"><span class="hs-identifier hs-var hs-var">defNameSegments</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NameSegment] -&gt; NonEmpty NameSegment -&gt; NonEmpty NameSegment
forall a. [a] -&gt; NonEmpty a -&gt; NonEmpty a
</span><span class="hs-identifier hs-var">NEL.appendr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; [NameSegment]
</span><span class="hs-identifier hs-var">Path.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680869007"><span class="hs-identifier hs-var">currentPath</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; NonEmpty NameSegment
</span><span class="hs-identifier hs-var">Name.segments</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680869068"><span class="hs-identifier hs-var">symName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680869070"><span class="annot"><span class="annottext">defName :: Name
</span><a href="#local-6989586621680869070"><span class="hs-identifier hs-var hs-var">defName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty NameSegment -&gt; Name
</span><span class="hs-identifier hs-var">Name.fromSegments</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty NameSegment
</span><a href="#local-6989586621680869069"><span class="hs-identifier hs-var">defNameSegments</span></a></span><span>
</span><span id="line-90"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680869071"><span class="annot"><span class="annottext">hqName :: HashQualified Name
</span><a href="#local-6989586621680869071"><span class="hs-identifier hs-var hs-var">hqName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; HashQualified Name
forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.NameOnly</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680869068"><span class="hs-identifier hs-var">symName</span></a></span><span>
</span><span id="line-91"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680869073"><span class="annot"><span class="annottext">biasedPPED :: PrettyPrintEnvDecl
</span><a href="#local-6989586621680869073"><span class="hs-identifier hs-var hs-var">biasedPPED</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; PrettyPrintEnvDecl -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.biasTo</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680869070"><span class="hs-identifier hs-var">defName</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621680869018"><span class="hs-identifier hs-var">filePPED</span></a></span><span>
</span><span id="line-92"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680869074"><span class="annot"><span class="annottext">definitionPPE :: PrettyPrintEnv
</span><a href="#local-6989586621680869074"><span class="hs-identifier hs-var hs-var">definitionPPE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe TypeReferenceId
</span><a href="#local-6989586621680869065"><span class="hs-identifier hs-var">mayRefId</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-93"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680869075"><span class="annot"><span class="annottext">TypeReferenceId
</span><a href="#local-6989586621680869075"><span class="hs-identifier hs-var">refId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; TypeReference -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPE.declarationPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621680869073"><span class="hs-identifier hs-var">biasedPPED</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReferenceId -&gt; TypeReference
forall h t. Id' h -&gt; Reference' t h
</span><span class="hs-identifier hs-var">Reference.DerivedId</span></span><span> </span><span class="annot"><span class="annottext">TypeReferenceId
</span><a href="#local-6989586621680869075"><span class="hs-identifier hs-var">refId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>              </span><span class="annot"><span class="annottext">Maybe TypeReferenceId
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621680869073"><span class="hs-identifier hs-var">biasedPPED</span></a></span><span>
</span><span id="line-95"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680869078"><span class="annot"><span class="annottext">formattedTerm :: Pretty ColorText
</span><a href="#local-6989586621680869078"><span class="hs-identifier hs-var hs-var">formattedTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pretty SyntaxText -&gt; Pretty ColorText
forall r. Pretty (SyntaxText' r) -&gt; Pretty ColorText
</span><span class="hs-identifier hs-var">Pretty.syntaxToColor</span></span><span> </span><span class="annot"><span class="annottext">(Pretty SyntaxText -&gt; Pretty ColorText)
-&gt; Pretty SyntaxText -&gt; Pretty ColorText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
-&gt; HashQualified Name -&gt; Term Symbol Ann -&gt; Pretty SyntaxText
forall v at ap a.
Var v =&gt;
PrettyPrintEnv
-&gt; HashQualified Name -&gt; Term2 v at ap v a -&gt; Pretty SyntaxText
</span><span class="hs-identifier hs-var">TermPrinter.prettyBinding</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621680869074"><span class="hs-identifier hs-var">definitionPPE</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621680869071"><span class="hs-identifier hs-var">hqName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnisonFile Symbol Ann
-&gt; Symbol -&gt; Term Symbol Ann -&gt; Term Symbol Ann
forall a.
UnisonFile Symbol a -&gt; Symbol -&gt; Term Symbol a -&gt; Term Symbol a
</span><a href="#local-6989586621680869080"><span class="hs-identifier hs-var">removeGeneratedTypeAnnotations</span></a></span><span> </span><span class="annot"><span class="annottext">UnisonFile Symbol Ann
</span><a href="#local-6989586621680869020"><span class="hs-identifier hs-var">parsedFile</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680869063"><span class="hs-identifier hs-var">sym</span></a></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621680869066"><span class="hs-identifier hs-var">trm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>        </span><span class="hs-comment">-- TODO: format watch expressions and test watches</span><span>
</span><span id="line-97"></span><span>        </span><span class="hs-comment">-- let formattedWatches =</span><span>
</span><span id="line-98"></span><span>        </span><span class="hs-comment">--       allWatches fileSummary &amp; map \(_tldAnn, maySym, _mayRef, trm, _mayType, mayWatchKind) -&gt; do</span><span>
</span><span id="line-99"></span><span>        </span><span class="hs-comment">--         case (mayWatchKind, maySym) of</span><span>
</span><span id="line-100"></span><span>        </span><span class="hs-comment">--           (Just wk, Just (Symbol.Symbol _ (Var.User {}))) -&gt;</span><span>
</span><span id="line-101"></span><span>        </span><span class="hs-comment">--             -- Watch with binding</span><span>
</span><span id="line-102"></span><span>        </span><span class="hs-comment">--             Pretty.syntaxToColor $ Pretty.string wk &lt;&gt; &quot;&gt; &quot; &lt;&gt; TermPrinter.prettyBindingWithoutTypeSignature definitionPPE hqName (stripTypeAnnotation trm)</span><span>
</span><span id="line-103"></span><span>        </span><span class="hs-comment">--           (Just wk, _) -&gt; Pretty.string wk &lt;&gt; &quot;&gt; &quot; &lt;&gt; TermPrinter.prettyBlock False definitionPPE (stripTypeAnnotation trm)</span><span>
</span><span id="line-104"></span><span>        </span><span class="hs-comment">--           (Nothing, _) -&gt; &quot;&gt; &quot; &lt;&gt; TermPrinter.prettyBlock False definitionPPE (stripTypeAnnotation trm)</span><span>
</span><span id="line-105"></span><span>        </span><span class="annot"><span class="annottext">(Ann, Pretty ColorText) -&gt; MaybeT m (Ann, Pretty ColorText)
forall a. a -&gt; MaybeT m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621680869064"><span class="hs-identifier hs-var">tldAnn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680869078"><span class="hs-identifier hs-var">formattedTerm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-comment">-- Only keep definitions which are _actually_ in the file, skipping generated accessors</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-comment">-- and such.</span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680869081"><span class="annot"><span class="annottext">nonGeneratedDefs :: Map Symbol ((Pos, Pos), Pretty ColorText)
</span><a href="#local-6989586621680869081"><span class="hs-identifier hs-var hs-var">nonGeneratedDefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-110"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Symbol (Ann, Pretty ColorText)
</span><a href="#local-6989586621680869058"><span class="hs-identifier hs-var">formattedTerms</span></a></span><span> </span><span class="annot"><span class="annottext">Map Symbol (Ann, Pretty ColorText)
-&gt; Map Symbol (Ann, Pretty ColorText)
-&gt; Map Symbol (Ann, Pretty ColorText)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map Symbol (Ann, Pretty ColorText)
</span><a href="#local-6989586621680869022"><span class="hs-identifier hs-var">formattedDecls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>          </span><span class="annot"><span class="annottext">Map Symbol (Ann, Pretty ColorText)
-&gt; (Map Symbol (Ann, Pretty ColorText)
    -&gt; Map Symbol ((Pos, Pos), Pretty ColorText))
-&gt; Map Symbol ((Pos, Pos), Pretty ColorText)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">((Ann, Pretty ColorText) -&gt; Maybe ((Pos, Pos), Pretty ColorText))
-&gt; Map Symbol (Ann, Pretty ColorText)
-&gt; Map Symbol ((Pos, Pos), Pretty ColorText)
forall a b. (a -&gt; Maybe b) -&gt; Map Symbol a -&gt; Map Symbol b
forall (f :: * -&gt; *) a b.
Filterable f =&gt;
(a -&gt; Maybe b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span>
</span><span id="line-112"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-113"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ann.Ann</span></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680869084"><span class="annot"><span class="annottext">Pos
start :: Pos
$sel:start:Intrinsic :: Ann -&gt; Pos
</span><a href="#local-6989586621680869084"><span class="hs-identifier hs-var hs-var">start</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869086"><span class="annot"><span class="annottext">Pos
end :: Pos
$sel:end:Intrinsic :: Ann -&gt; Pos
</span><a href="#local-6989586621680869086"><span class="hs-identifier hs-var hs-var">end</span></a></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869088"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680869088"><span class="hs-identifier hs-var">txt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((Pos, Pos), Pretty ColorText)
-&gt; Maybe ((Pos, Pos), Pretty ColorText)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621680869084"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621680869086"><span class="hs-identifier hs-var">end</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680869088"><span class="hs-identifier hs-var">txt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>                </span><span class="annot"><span class="annottext">(Ann, Pretty ColorText)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ((Pos, Pos), Pretty ColorText)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-115"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-comment">-- when (null filteredDefs) empty {- Don't format if we have no definitions or it wipes out the fold! -}</span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680869089"><span class="annot"><span class="annottext">textEdits :: [TextReplacement]
</span><a href="#local-6989586621680869089"><span class="hs-identifier hs-var hs-var">textEdits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-118"></span><span>        </span><span class="annot"><span class="annottext">Map Symbol ((Pos, Pos), Pretty ColorText)
</span><a href="#local-6989586621680869081"><span class="hs-identifier hs-var">nonGeneratedDefs</span></a></span><span> </span><span class="annot"><span class="annottext">Map Symbol ((Pos, Pos), Pretty ColorText)
-&gt; (Map Symbol ((Pos, Pos), Pretty ColorText) -&gt; [TextReplacement])
-&gt; [TextReplacement]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(((Pos, Pos), Pretty ColorText) -&gt; [TextReplacement])
-&gt; Map Symbol ((Pos, Pos), Pretty ColorText) -&gt; [TextReplacement]
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Map Symbol a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680869091"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621680869091"><span class="hs-identifier hs-var">start</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869092"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621680869092"><span class="hs-identifier hs-var">end</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869093"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680869093"><span class="hs-identifier hs-var">txt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-119"></span><span>          </span><span id="local-6989586621680869094"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680869094"><span class="hs-identifier hs-var">range</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; [Range]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Range -&gt; [Range]) -&gt; Maybe Range -&gt; [Range]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ann -&gt; Maybe Range
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#annToRange"><span class="hs-identifier hs-var">annToRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pos -&gt; Pos -&gt; Ann
</span><span class="hs-identifier hs-var">Ann.Ann</span></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621680869091"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621680869092"><span class="hs-identifier hs-var">end</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>          </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Range -&gt; TextReplacement
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#TextReplacement"><span class="hs-identifier hs-var">TextReplacement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; String -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; String
</span><span class="hs-identifier hs-var">Pretty.toPlain</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Width
</span><span class="hs-identifier hs-var">Pretty.Width</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869006"><span class="hs-identifier hs-var">formattingWidth</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680869093"><span class="hs-identifier hs-var">txt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680869094"><span class="hs-identifier hs-var">range</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>  </span><span class="annot"><span class="annottext">[TextReplacement] -&gt; MaybeT m [TextReplacement]
forall a. a -&gt; MaybeT m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">[TextReplacement]
</span><a href="#local-6989586621680869089"><span class="hs-identifier hs-var">textEdits</span></a></span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-123"></span><span>    </span><span class="annot"><a href="#local-6989586621680869034"><span class="hs-identifier hs-type">isInFormatRange</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann.Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621680869034"><span class="annot"><span class="annottext">isInFormatRange :: Ann -&gt; Bool
</span><a href="#local-6989586621680869034"><span class="hs-identifier hs-var hs-var">isInFormatRange</span></a></span></span><span> </span><span id="local-6989586621680869101"><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621680869101"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-125"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Set Range)
</span><a href="#local-6989586621680869010"><span class="hs-identifier hs-var">mayRangesToFormat</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-126"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Set Range)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-127"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680869102"><span class="annot"><span class="annottext">Set Range
</span><a href="#local-6989586621680869102"><span class="hs-identifier hs-var">rangesToFormat</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Range -&gt; Bool) -&gt; Set Range -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann -&gt; Range -&gt; Bool
</span><a href="#local-6989586621680869104"><span class="hs-identifier hs-var">annRangeOverlap</span></a></span><span> </span><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621680869101"><span class="hs-identifier hs-var">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Range
</span><a href="#local-6989586621680869102"><span class="hs-identifier hs-var">rangesToFormat</span></a></span><span>
</span><span id="line-128"></span><span>    </span><span class="annot"><a href="#local-6989586621680869062"><span class="hs-identifier hs-type">shouldFormatTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann.Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term.Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann.Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-129"></span><span>    </span><span id="local-6989586621680869062"><span class="annot"><span class="annottext">shouldFormatTerm :: Ann -&gt; Term Symbol Ann -&gt; Bool
</span><a href="#local-6989586621680869062"><span class="hs-identifier hs-var hs-var">shouldFormatTerm</span></a></span></span><span> </span><span id="local-6989586621680869105"><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621680869105"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621680869106"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621680869106"><span class="hs-identifier hs-var">trm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-130"></span><span>      </span><span class="annot"><span class="annottext">Ann -&gt; Bool
</span><a href="#local-6989586621680869034"><span class="hs-identifier hs-var">isInFormatRange</span></a></span><span> </span><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621680869105"><span class="hs-identifier hs-var">ann</span></a></span><span>
</span><span id="line-131"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term Symbol Ann -&gt; Bool
</span><a href="#local-6989586621680869109"><span class="hs-identifier hs-var">isUntypecheckedDoc</span></a></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621680869106"><span class="hs-identifier hs-var">trm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-comment">-- The lexer converts '{{ .. }}' into 'syntax.docUntitledSection (..)', but the pretty</span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-comment">-- printer doesn't print it back as '{{ .. }}' unless it typechecks, so</span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-comment">-- we just don't format docs that have un-resolved 'docUntitledSection' symbols.</span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><a href="#local-6989586621680869109"><span class="hs-identifier hs-type">isUntypecheckedDoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term.Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann.Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-137"></span><span>    </span><span id="local-6989586621680869109"><span class="annot"><span class="annottext">isUntypecheckedDoc :: Term Symbol Ann -&gt; Bool
</span><a href="#local-6989586621680869109"><span class="hs-identifier hs-var hs-var">isUntypecheckedDoc</span></a></span></span><span> </span><span id="local-6989586621680869110"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621680869110"><span class="hs-identifier hs-var">trm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-138"></span><span>      </span><span class="annot"><span class="annottext">Term Symbol Ann -&gt; Set Symbol
forall (f :: * -&gt; *) v a. Term f v a -&gt; Set v
</span><span class="hs-identifier hs-var">ABT.freeVars</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621680869110"><span class="hs-identifier hs-var">trm</span></a></span><span>
</span><span id="line-139"></span><span>        </span><span class="annot"><span class="annottext">Set Symbol -&gt; (Set Symbol -&gt; Set String) -&gt; Set String
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Symbol -&gt; String) -&gt; Set Symbol -&gt; Set String
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; String
forall v. Var v =&gt; v -&gt; String
</span><span class="hs-identifier hs-var">Var.nameStr</span></span><span>
</span><span id="line-140"></span><span>        </span><span class="annot"><span class="annottext">Set String -&gt; (Set String -&gt; Bool) -&gt; Bool
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Set String -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;syntax.docUntitledSection&quot;</span></span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-comment">-- Does the given range overlap with the given annotation?</span><span>
</span><span id="line-142"></span><span>    </span><span class="annot"><a href="#local-6989586621680869104"><span class="hs-identifier hs-type">annRangeOverlap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann.Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Range</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-143"></span><span>    </span><span id="local-6989586621680869104"><span class="annot"><span class="annottext">annRangeOverlap :: Ann -&gt; Range -&gt; Bool
</span><a href="#local-6989586621680869104"><span class="hs-identifier hs-var hs-var">annRangeOverlap</span></a></span></span><span> </span><span id="local-6989586621680869115"><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621680869115"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680869116"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680869116"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-144"></span><span>      </span><span class="annot"><span class="annottext">Ann -&gt; Maybe (Interval Pos)
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#annToInterval"><span class="hs-identifier hs-var">annToInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621680869115"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Interval Pos) -&gt; (Maybe (Interval Pos) -&gt; Bool) -&gt; Bool
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-145"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Interval Pos)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-146"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680869118"><span class="annot"><span class="annottext">Interval Pos
</span><a href="#local-6989586621680869118"><span class="hs-identifier hs-var">annI</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Range -&gt; Interval Pos
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#rangeToInterval"><span class="hs-identifier hs-var">rangeToInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680869116"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Interval Pos -&gt; Interval Pos -&gt; Bool
forall a. Ord a =&gt; Interval a -&gt; Interval a -&gt; Bool
</span><span class="hs-operator hs-var">`Interval.overlaps`</span></span><span> </span><span class="annot"><span class="annottext">Interval Pos
</span><a href="#local-6989586621680869118"><span class="hs-identifier hs-var">annI</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-comment">-- Typechecking ALWAYS adds a type-signature, but we don't want to add ones that didn't</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-comment">-- already exist in the source file.</span><span>
</span><span id="line-150"></span><span>    </span><span id="local-6989586621680868599"><span class="annot"><a href="#local-6989586621680869080"><span class="hs-identifier hs-type">removeGeneratedTypeAnnotations</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-151"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">UnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><a href="#local-6989586621680868599"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term.Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><a href="#local-6989586621680868599"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term.Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><a href="#local-6989586621680868599"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-152"></span><span>    </span><span id="local-6989586621680869080"><span class="annot"><span class="annottext">removeGeneratedTypeAnnotations :: forall a.
UnisonFile Symbol a -&gt; Symbol -&gt; Term Symbol a -&gt; Term Symbol a
</span><a href="#local-6989586621680869080"><span class="hs-identifier hs-var hs-var">removeGeneratedTypeAnnotations</span></a></span></span><span> </span><span id="local-6989586621680869123"><span class="annot"><span class="annottext">UnisonFile Symbol a
</span><a href="#local-6989586621680869123"><span class="hs-identifier hs-var">uf</span></a></span></span><span> </span><span id="local-6989586621680869124"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680869124"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-153"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Term.Ann'</span></span><span> </span><span id="local-6989586621680869126"><span class="annot"><span class="annottext">Term Symbol a
</span><a href="#local-6989586621680869126"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span id="local-6989586621680869127"><span class="annot"><span class="annottext">Type Symbol a
</span><a href="#local-6989586621680869127"><span class="hs-identifier hs-var">_annotation</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnisonFile Symbol a -&gt; Symbol -&gt; Bool
forall v a. Eq v =&gt; UnisonFile v a -&gt; v -&gt; Bool
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#hasUserTypeSignature"><span class="hs-identifier hs-var">hasUserTypeSignature</span></a></span><span> </span><span class="annot"><span class="annottext">UnisonFile Symbol a
</span><a href="#local-6989586621680869123"><span class="hs-identifier hs-var">uf</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680869124"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term Symbol a
</span><a href="#local-6989586621680869126"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-154"></span><span>      </span><span id="local-6989586621680869129"><span class="annot"><span class="annottext">Term Symbol a
</span><a href="#local-6989586621680869129"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term Symbol a
</span><a href="#local-6989586621680869129"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-comment">-- This is a bit of a hack.</span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-comment">-- The file parser uses a different unique ID for unique types on every parse,</span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-comment">-- that id changes hashes, and constructors are ordered by that hash.</span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-comment">-- This means that pretty-printing isn't deterministic and constructors will re-order</span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-comment">-- themselves on every save :|</span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-comment">-- It's difficult and a bad idea to change the parser to use a deterministic unique ID,</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-comment">-- so instead we just re-sort the constructors by their source-file annotation AFTER</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-comment">-- parsing. This is fine for pretty-printing, but don't use this for anything other than</span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-comment">-- formatting since the Decls it produces aren't technically valid.</span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><a href="#local-6989586621680869014"><span class="hs-identifier hs-type">mkUnisonFilesDeterministic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann.Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypecheckedUnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann.Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann.Ann</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypecheckedUnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann.Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621680869014"><span class="annot"><span class="annottext">mkUnisonFilesDeterministic :: Maybe (UnisonFile Symbol Ann)
-&gt; Maybe (TypecheckedUnisonFile Symbol Ann)
-&gt; (Maybe (UnisonFile Symbol Ann),
    Maybe (TypecheckedUnisonFile Symbol Ann))
</span><a href="#local-6989586621680869014"><span class="hs-identifier hs-var hs-var">mkUnisonFilesDeterministic</span></a></span></span><span> </span><span id="local-6989586621680869130"><span class="annot"><span class="annottext">Maybe (UnisonFile Symbol Ann)
</span><a href="#local-6989586621680869130"><span class="hs-identifier hs-var">mayUnisonFile</span></a></span></span><span> </span><span id="local-6989586621680869131"><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
</span><a href="#local-6989586621680869131"><span class="hs-identifier hs-var">mayTypecheckedFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-168"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680869132"><span class="annot"><span class="annottext">sortedUF :: Maybe (UnisonFile Symbol Ann)
</span><a href="#local-6989586621680869132"><span class="hs-identifier hs-var hs-var">sortedUF</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-169"></span><span>            </span><span class="annot"><span class="annottext">Maybe (UnisonFile Symbol Ann)
</span><a href="#local-6989586621680869130"><span class="hs-identifier hs-var">mayUnisonFile</span></a></span><span>
</span><span id="line-170"></span><span>              </span><span class="annot"><span class="annottext">Maybe (UnisonFile Symbol Ann)
-&gt; (Maybe (UnisonFile Symbol Ann)
    -&gt; Maybe
         (ReplaceArgs
            (UnisonFile Symbol Ann)
            (Unify
               (TypeReferenceId,
                DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
               (TypeReferenceId, DataDeclaration Symbol Ann)
             ++ '[ 'Sub 1 Symbol])))
-&gt; Maybe
     (ReplaceArgs
        (UnisonFile Symbol Ann)
        (Unify
           (TypeReferenceId,
            DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
           (TypeReferenceId, DataDeclaration Symbol Ann)
         ++ '[ 'Sub 1 Symbol]))
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(UnisonFile Symbol Ann
 -&gt; Identity
      (ReplaceArgs
         (UnisonFile Symbol Ann)
         (Unify
            (TypeReferenceId,
             DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
            (TypeReferenceId, DataDeclaration Symbol Ann)
          ++ '[ 'Sub 1 Symbol])))
-&gt; Maybe (UnisonFile Symbol Ann)
-&gt; Identity
     (Maybe
        (ReplaceArgs
           (UnisonFile Symbol Ann)
           (Unify
              (TypeReferenceId,
               DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
              (TypeReferenceId, DataDeclaration Symbol Ann)
            ++ '[ 'Sub 1 Symbol])))
forall a b (p :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(Choice p, Applicative f) =&gt;
p a (f b) -&gt; p (Maybe a) (f (Maybe b))
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">((UnisonFile Symbol Ann
  -&gt; Identity
       (ReplaceArgs
          (UnisonFile Symbol Ann)
          (Unify
             (TypeReferenceId,
              DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
             (TypeReferenceId, DataDeclaration Symbol Ann)
           ++ '[ 'Sub 1 Symbol])))
 -&gt; Maybe (UnisonFile Symbol Ann)
 -&gt; Identity
      (Maybe
         (ReplaceArgs
            (UnisonFile Symbol Ann)
            (Unify
               (TypeReferenceId,
                DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
               (TypeReferenceId, DataDeclaration Symbol Ann)
             ++ '[ 'Sub 1 Symbol]))))
-&gt; ((DataDeclaration Symbol Ann
     -&gt; Identity (DataDeclaration Symbol Ann))
    -&gt; UnisonFile Symbol Ann
    -&gt; Identity
         (ReplaceArgs
            (UnisonFile Symbol Ann)
            (Unify
               (TypeReferenceId,
                DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
               (TypeReferenceId, DataDeclaration Symbol Ann)
             ++ '[ 'Sub 1 Symbol])))
-&gt; (DataDeclaration Symbol Ann
    -&gt; Identity (DataDeclaration Symbol Ann))
-&gt; Maybe (UnisonFile Symbol Ann)
-&gt; Identity
     (Maybe
        (ReplaceArgs
           (UnisonFile Symbol Ann)
           (Unify
              (TypeReferenceId,
               DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
              (TypeReferenceId, DataDeclaration Symbol Ann)
            ++ '[ 'Sub 1 Symbol])))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann)
 -&gt; Identity
      (Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann)))
-&gt; UnisonFile Symbol Ann
-&gt; Identity
     (ReplaceArgs
        (UnisonFile Symbol Ann)
        (Unify
           (TypeReferenceId,
            DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
           (TypeReferenceId, DataDeclaration Symbol Ann)
         ++ '[ 'Sub 1 Symbol]))
</span><span class="">#dataDeclarationsId</span></span><span> </span><span class="annot"><span class="annottext">((Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann)
  -&gt; Identity
       (Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann)))
 -&gt; UnisonFile Symbol Ann
 -&gt; Identity
      (ReplaceArgs
         (UnisonFile Symbol Ann)
         (Unify
            (TypeReferenceId,
             DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
            (TypeReferenceId, DataDeclaration Symbol Ann)
          ++ '[ 'Sub 1 Symbol])))
-&gt; ((DataDeclaration Symbol Ann
     -&gt; Identity (DataDeclaration Symbol Ann))
    -&gt; Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann)
    -&gt; Identity
         (Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann)))
-&gt; (DataDeclaration Symbol Ann
    -&gt; Identity (DataDeclaration Symbol Ann))
-&gt; UnisonFile Symbol Ann
-&gt; Identity
     (ReplaceArgs
        (UnisonFile Symbol Ann)
        (Unify
           (TypeReferenceId,
            DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
           (TypeReferenceId, DataDeclaration Symbol Ann)
         ++ '[ 'Sub 1 Symbol]))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((TypeReferenceId, DataDeclaration Symbol Ann)
 -&gt; Identity (TypeReferenceId, DataDeclaration Symbol Ann))
-&gt; Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann)
-&gt; Identity
     (Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann))
forall (f :: * -&gt; *) a b.
Traversable f =&gt;
IndexedTraversal Int (f a) (f b) a b
IndexedTraversal
  Int
  (Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann))
  (Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann))
  (TypeReferenceId, DataDeclaration Symbol Ann)
  (TypeReferenceId, DataDeclaration Symbol Ann)
</span><span class="hs-identifier hs-var">traversed</span></span><span> </span><span class="annot"><span class="annottext">(((TypeReferenceId, DataDeclaration Symbol Ann)
  -&gt; Identity (TypeReferenceId, DataDeclaration Symbol Ann))
 -&gt; Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann)
 -&gt; Identity
      (Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann)))
-&gt; ((DataDeclaration Symbol Ann
     -&gt; Identity (DataDeclaration Symbol Ann))
    -&gt; (TypeReferenceId, DataDeclaration Symbol Ann)
    -&gt; Identity (TypeReferenceId, DataDeclaration Symbol Ann))
-&gt; (DataDeclaration Symbol Ann
    -&gt; Identity (DataDeclaration Symbol Ann))
-&gt; Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann)
-&gt; Identity
     (Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(DataDeclaration Symbol Ann
 -&gt; Identity (DataDeclaration Symbol Ann))
-&gt; (TypeReferenceId, DataDeclaration Symbol Ann)
-&gt; Identity (TypeReferenceId, DataDeclaration Symbol Ann)
forall s t a b. Field2 s t a b =&gt; Lens s t a b
Lens
  (TypeReferenceId, DataDeclaration Symbol Ann)
  (TypeReferenceId, DataDeclaration Symbol Ann)
  (DataDeclaration Symbol Ann)
  (DataDeclaration Symbol Ann)
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">((DataDeclaration Symbol Ann
  -&gt; Identity (DataDeclaration Symbol Ann))
 -&gt; Maybe (UnisonFile Symbol Ann)
 -&gt; Identity
      (Maybe
         (ReplaceArgs
            (UnisonFile Symbol Ann)
            (Unify
               (TypeReferenceId,
                DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
               (TypeReferenceId, DataDeclaration Symbol Ann)
             ++ '[ 'Sub 1 Symbol]))))
-&gt; (DataDeclaration Symbol Ann -&gt; DataDeclaration Symbol Ann)
-&gt; Maybe (UnisonFile Symbol Ann)
-&gt; Maybe
     (ReplaceArgs
        (UnisonFile Symbol Ann)
        (Unify
           (TypeReferenceId,
            DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
           (TypeReferenceId, DataDeclaration Symbol Ann)
         ++ '[ 'Sub 1 Symbol]))
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">DataDeclaration Symbol Ann -&gt; DataDeclaration Symbol Ann
forall v. DataDeclaration v Ann -&gt; DataDeclaration v Ann
</span><a href="#local-6989586621680869136"><span class="hs-identifier hs-var">sortConstructors</span></a></span><span>
</span><span id="line-171"></span><span>              </span><span class="annot"><span class="annottext">Maybe
  (ReplaceArgs
     (UnisonFile Symbol Ann)
     (Unify
        (TypeReferenceId,
         DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
        (TypeReferenceId, DataDeclaration Symbol Ann)
      ++ '[ 'Sub 1 Symbol]))
-&gt; (Maybe
      (ReplaceArgs
         (UnisonFile Symbol Ann)
         (Unify
            (TypeReferenceId,
             DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
            (TypeReferenceId, DataDeclaration Symbol Ann)
          ++ '[ 'Sub 1 Symbol]))
    -&gt; Maybe (UnisonFile Symbol Ann))
-&gt; Maybe (UnisonFile Symbol Ann)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(ReplaceArgs
   (UnisonFile Symbol Ann)
   (Unify
      (TypeReferenceId,
       DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
      (TypeReferenceId, DataDeclaration Symbol Ann)
    ++ '[ 'Sub 1 Symbol])
 -&gt; Identity (UnisonFile Symbol Ann))
-&gt; Maybe
     (ReplaceArgs
        (UnisonFile Symbol Ann)
        (Unify
           (TypeReferenceId,
            DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
           (TypeReferenceId, DataDeclaration Symbol Ann)
         ++ '[ 'Sub 1 Symbol]))
-&gt; Identity (Maybe (UnisonFile Symbol Ann))
forall a b (p :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(Choice p, Applicative f) =&gt;
p a (f b) -&gt; p (Maybe a) (f (Maybe b))
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">((ReplaceArgs
    (UnisonFile Symbol Ann)
    (Unify
       (TypeReferenceId,
        DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
       (TypeReferenceId, DataDeclaration Symbol Ann)
     ++ '[ 'Sub 1 Symbol])
  -&gt; Identity (UnisonFile Symbol Ann))
 -&gt; Maybe
      (ReplaceArgs
         (UnisonFile Symbol Ann)
         (Unify
            (TypeReferenceId,
             DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
            (TypeReferenceId, DataDeclaration Symbol Ann)
          ++ '[ 'Sub 1 Symbol]))
 -&gt; Identity (Maybe (UnisonFile Symbol Ann)))
-&gt; ((DataDeclaration Symbol Ann
     -&gt; Identity (DataDeclaration Symbol Ann))
    -&gt; ReplaceArgs
         (UnisonFile Symbol Ann)
         (Unify
            (TypeReferenceId,
             DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
            (TypeReferenceId, DataDeclaration Symbol Ann)
          ++ '[ 'Sub 1 Symbol])
    -&gt; Identity (UnisonFile Symbol Ann))
-&gt; (DataDeclaration Symbol Ann
    -&gt; Identity (DataDeclaration Symbol Ann))
-&gt; Maybe
     (ReplaceArgs
        (UnisonFile Symbol Ann)
        (Unify
           (TypeReferenceId,
            DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
           (TypeReferenceId, DataDeclaration Symbol Ann)
         ++ '[ 'Sub 1 Symbol]))
-&gt; Identity (Maybe (UnisonFile Symbol Ann))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann)
 -&gt; Identity
      (Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann)))
-&gt; ReplaceArgs
     (UnisonFile Symbol Ann)
     (Unify
        (TypeReferenceId,
         DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
        (TypeReferenceId, DataDeclaration Symbol Ann)
      ++ '[ 'Sub 1 Symbol])
-&gt; Identity (UnisonFile Symbol Ann)
</span><span class="">#effectDeclarationsId</span></span><span> </span><span class="annot"><span class="annottext">((Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann)
  -&gt; Identity
       (Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann)))
 -&gt; ReplaceArgs
      (UnisonFile Symbol Ann)
      (Unify
         (TypeReferenceId,
          DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
         (TypeReferenceId, DataDeclaration Symbol Ann)
       ++ '[ 'Sub 1 Symbol])
 -&gt; Identity (UnisonFile Symbol Ann))
-&gt; ((DataDeclaration Symbol Ann
     -&gt; Identity (DataDeclaration Symbol Ann))
    -&gt; Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann)
    -&gt; Identity
         (Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann)))
-&gt; (DataDeclaration Symbol Ann
    -&gt; Identity (DataDeclaration Symbol Ann))
-&gt; ReplaceArgs
     (UnisonFile Symbol Ann)
     (Unify
        (TypeReferenceId,
         DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
        (TypeReferenceId, DataDeclaration Symbol Ann)
      ++ '[ 'Sub 1 Symbol])
-&gt; Identity (UnisonFile Symbol Ann)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((TypeReferenceId, EffectDeclaration Symbol Ann)
 -&gt; Identity (TypeReferenceId, EffectDeclaration Symbol Ann))
-&gt; Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann)
-&gt; Identity
     (Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann))
forall (f :: * -&gt; *) a b.
Traversable f =&gt;
IndexedTraversal Int (f a) (f b) a b
IndexedTraversal
  Int
  (Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann))
  (Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann))
  (TypeReferenceId, EffectDeclaration Symbol Ann)
  (TypeReferenceId, EffectDeclaration Symbol Ann)
</span><span class="hs-identifier hs-var">traversed</span></span><span> </span><span class="annot"><span class="annottext">(((TypeReferenceId, EffectDeclaration Symbol Ann)
  -&gt; Identity (TypeReferenceId, EffectDeclaration Symbol Ann))
 -&gt; Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann)
 -&gt; Identity
      (Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann)))
-&gt; ((DataDeclaration Symbol Ann
     -&gt; Identity (DataDeclaration Symbol Ann))
    -&gt; (TypeReferenceId, EffectDeclaration Symbol Ann)
    -&gt; Identity (TypeReferenceId, EffectDeclaration Symbol Ann))
-&gt; (DataDeclaration Symbol Ann
    -&gt; Identity (DataDeclaration Symbol Ann))
-&gt; Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann)
-&gt; Identity
     (Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(EffectDeclaration Symbol Ann
 -&gt; Identity (EffectDeclaration Symbol Ann))
-&gt; (TypeReferenceId, EffectDeclaration Symbol Ann)
-&gt; Identity (TypeReferenceId, EffectDeclaration Symbol Ann)
forall s t a b. Field2 s t a b =&gt; Lens s t a b
Lens
  (TypeReferenceId, EffectDeclaration Symbol Ann)
  (TypeReferenceId, EffectDeclaration Symbol Ann)
  (EffectDeclaration Symbol Ann)
  (EffectDeclaration Symbol Ann)
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">((EffectDeclaration Symbol Ann
  -&gt; Identity (EffectDeclaration Symbol Ann))
 -&gt; (TypeReferenceId, EffectDeclaration Symbol Ann)
 -&gt; Identity (TypeReferenceId, EffectDeclaration Symbol Ann))
-&gt; ((DataDeclaration Symbol Ann
     -&gt; Identity (DataDeclaration Symbol Ann))
    -&gt; EffectDeclaration Symbol Ann
    -&gt; Identity (EffectDeclaration Symbol Ann))
-&gt; (DataDeclaration Symbol Ann
    -&gt; Identity (DataDeclaration Symbol Ann))
-&gt; (TypeReferenceId, EffectDeclaration Symbol Ann)
-&gt; Identity (TypeReferenceId, EffectDeclaration Symbol Ann)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(DataDeclaration Symbol Ann
 -&gt; Identity (DataDeclaration Symbol Ann))
-&gt; EffectDeclaration Symbol Ann
-&gt; Identity (EffectDeclaration Symbol Ann)
forall v a (p :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(Profunctor p, Functor f) =&gt;
p (DataDeclaration v a) (f (DataDeclaration v a))
-&gt; p (EffectDeclaration v a) (f (EffectDeclaration v a))
</span><span class="hs-identifier hs-var">Decl.asDataDecl_</span></span><span> </span><span class="annot"><span class="annottext">((DataDeclaration Symbol Ann
  -&gt; Identity (DataDeclaration Symbol Ann))
 -&gt; Maybe
      (ReplaceArgs
         (UnisonFile Symbol Ann)
         (Unify
            (TypeReferenceId,
             DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
            (TypeReferenceId, DataDeclaration Symbol Ann)
          ++ '[ 'Sub 1 Symbol]))
 -&gt; Identity (Maybe (UnisonFile Symbol Ann)))
-&gt; (DataDeclaration Symbol Ann -&gt; DataDeclaration Symbol Ann)
-&gt; Maybe
     (ReplaceArgs
        (UnisonFile Symbol Ann)
        (Unify
           (TypeReferenceId,
            DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
           (TypeReferenceId, DataDeclaration Symbol Ann)
         ++ '[ 'Sub 1 Symbol]))
-&gt; Maybe (UnisonFile Symbol Ann)
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">DataDeclaration Symbol Ann -&gt; DataDeclaration Symbol Ann
forall v. DataDeclaration v Ann -&gt; DataDeclaration v Ann
</span><a href="#local-6989586621680869136"><span class="hs-identifier hs-var">sortConstructors</span></a></span><span>
</span><span id="line-172"></span><span>          </span><span id="local-6989586621680869138"><span class="annot"><span class="annottext">sortedTF :: Maybe (TypecheckedUnisonFile Symbol Ann)
</span><a href="#local-6989586621680869138"><span class="hs-identifier hs-var hs-var">sortedTF</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-173"></span><span>            </span><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
</span><a href="#local-6989586621680869131"><span class="hs-identifier hs-var">mayTypecheckedFile</span></a></span><span>
</span><span id="line-174"></span><span>              </span><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
-&gt; (Maybe (TypecheckedUnisonFile Symbol Ann)
    -&gt; Maybe
         (ReplaceArgs
            (TypecheckedUnisonFile Symbol Ann)
            (Unify
               (TypeReferenceId,
                DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
               (TypeReferenceId, DataDeclaration Symbol Ann)
             ++ '[ 'Sub 1 Symbol])))
-&gt; Maybe
     (ReplaceArgs
        (TypecheckedUnisonFile Symbol Ann)
        (Unify
           (TypeReferenceId,
            DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
           (TypeReferenceId, DataDeclaration Symbol Ann)
         ++ '[ 'Sub 1 Symbol]))
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TypecheckedUnisonFile Symbol Ann
 -&gt; Identity
      (ReplaceArgs
         (TypecheckedUnisonFile Symbol Ann)
         (Unify
            (TypeReferenceId,
             DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
            (TypeReferenceId, DataDeclaration Symbol Ann)
          ++ '[ 'Sub 1 Symbol])))
-&gt; Maybe (TypecheckedUnisonFile Symbol Ann)
-&gt; Identity
     (Maybe
        (ReplaceArgs
           (TypecheckedUnisonFile Symbol Ann)
           (Unify
              (TypeReferenceId,
               DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
              (TypeReferenceId, DataDeclaration Symbol Ann)
            ++ '[ 'Sub 1 Symbol])))
forall a b (p :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(Choice p, Applicative f) =&gt;
p a (f b) -&gt; p (Maybe a) (f (Maybe b))
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">((TypecheckedUnisonFile Symbol Ann
  -&gt; Identity
       (ReplaceArgs
          (TypecheckedUnisonFile Symbol Ann)
          (Unify
             (TypeReferenceId,
              DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
             (TypeReferenceId, DataDeclaration Symbol Ann)
           ++ '[ 'Sub 1 Symbol])))
 -&gt; Maybe (TypecheckedUnisonFile Symbol Ann)
 -&gt; Identity
      (Maybe
         (ReplaceArgs
            (TypecheckedUnisonFile Symbol Ann)
            (Unify
               (TypeReferenceId,
                DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
               (TypeReferenceId, DataDeclaration Symbol Ann)
             ++ '[ 'Sub 1 Symbol]))))
-&gt; ((DataDeclaration Symbol Ann
     -&gt; Identity (DataDeclaration Symbol Ann))
    -&gt; TypecheckedUnisonFile Symbol Ann
    -&gt; Identity
         (ReplaceArgs
            (TypecheckedUnisonFile Symbol Ann)
            (Unify
               (TypeReferenceId,
                DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
               (TypeReferenceId, DataDeclaration Symbol Ann)
             ++ '[ 'Sub 1 Symbol])))
-&gt; (DataDeclaration Symbol Ann
    -&gt; Identity (DataDeclaration Symbol Ann))
-&gt; Maybe (TypecheckedUnisonFile Symbol Ann)
-&gt; Identity
     (Maybe
        (ReplaceArgs
           (TypecheckedUnisonFile Symbol Ann)
           (Unify
              (TypeReferenceId,
               DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
              (TypeReferenceId, DataDeclaration Symbol Ann)
            ++ '[ 'Sub 1 Symbol])))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann)
 -&gt; Identity
      (Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann)))
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; Identity
     (ReplaceArgs
        (TypecheckedUnisonFile Symbol Ann)
        (Unify
           (TypeReferenceId,
            DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
           (TypeReferenceId, DataDeclaration Symbol Ann)
         ++ '[ 'Sub 1 Symbol]))
</span><span class="">#dataDeclarationsId'</span></span><span> </span><span class="annot"><span class="annottext">((Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann)
  -&gt; Identity
       (Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann)))
 -&gt; TypecheckedUnisonFile Symbol Ann
 -&gt; Identity
      (ReplaceArgs
         (TypecheckedUnisonFile Symbol Ann)
         (Unify
            (TypeReferenceId,
             DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
            (TypeReferenceId, DataDeclaration Symbol Ann)
          ++ '[ 'Sub 1 Symbol])))
-&gt; ((DataDeclaration Symbol Ann
     -&gt; Identity (DataDeclaration Symbol Ann))
    -&gt; Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann)
    -&gt; Identity
         (Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann)))
-&gt; (DataDeclaration Symbol Ann
    -&gt; Identity (DataDeclaration Symbol Ann))
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; Identity
     (ReplaceArgs
        (TypecheckedUnisonFile Symbol Ann)
        (Unify
           (TypeReferenceId,
            DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
           (TypeReferenceId, DataDeclaration Symbol Ann)
         ++ '[ 'Sub 1 Symbol]))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((TypeReferenceId, DataDeclaration Symbol Ann)
 -&gt; Identity (TypeReferenceId, DataDeclaration Symbol Ann))
-&gt; Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann)
-&gt; Identity
     (Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann))
forall (f :: * -&gt; *) a b.
Traversable f =&gt;
IndexedTraversal Int (f a) (f b) a b
IndexedTraversal
  Int
  (Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann))
  (Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann))
  (TypeReferenceId, DataDeclaration Symbol Ann)
  (TypeReferenceId, DataDeclaration Symbol Ann)
</span><span class="hs-identifier hs-var">traversed</span></span><span> </span><span class="annot"><span class="annottext">(((TypeReferenceId, DataDeclaration Symbol Ann)
  -&gt; Identity (TypeReferenceId, DataDeclaration Symbol Ann))
 -&gt; Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann)
 -&gt; Identity
      (Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann)))
-&gt; ((DataDeclaration Symbol Ann
     -&gt; Identity (DataDeclaration Symbol Ann))
    -&gt; (TypeReferenceId, DataDeclaration Symbol Ann)
    -&gt; Identity (TypeReferenceId, DataDeclaration Symbol Ann))
-&gt; (DataDeclaration Symbol Ann
    -&gt; Identity (DataDeclaration Symbol Ann))
-&gt; Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann)
-&gt; Identity
     (Map Symbol (TypeReferenceId, DataDeclaration Symbol Ann))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(DataDeclaration Symbol Ann
 -&gt; Identity (DataDeclaration Symbol Ann))
-&gt; (TypeReferenceId, DataDeclaration Symbol Ann)
-&gt; Identity (TypeReferenceId, DataDeclaration Symbol Ann)
forall s t a b. Field2 s t a b =&gt; Lens s t a b
Lens
  (TypeReferenceId, DataDeclaration Symbol Ann)
  (TypeReferenceId, DataDeclaration Symbol Ann)
  (DataDeclaration Symbol Ann)
  (DataDeclaration Symbol Ann)
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">((DataDeclaration Symbol Ann
  -&gt; Identity (DataDeclaration Symbol Ann))
 -&gt; Maybe (TypecheckedUnisonFile Symbol Ann)
 -&gt; Identity
      (Maybe
         (ReplaceArgs
            (TypecheckedUnisonFile Symbol Ann)
            (Unify
               (TypeReferenceId,
                DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
               (TypeReferenceId, DataDeclaration Symbol Ann)
             ++ '[ 'Sub 1 Symbol]))))
-&gt; (DataDeclaration Symbol Ann -&gt; DataDeclaration Symbol Ann)
-&gt; Maybe (TypecheckedUnisonFile Symbol Ann)
-&gt; Maybe
     (ReplaceArgs
        (TypecheckedUnisonFile Symbol Ann)
        (Unify
           (TypeReferenceId,
            DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
           (TypeReferenceId, DataDeclaration Symbol Ann)
         ++ '[ 'Sub 1 Symbol]))
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">DataDeclaration Symbol Ann -&gt; DataDeclaration Symbol Ann
forall v. DataDeclaration v Ann -&gt; DataDeclaration v Ann
</span><a href="#local-6989586621680869136"><span class="hs-identifier hs-var">sortConstructors</span></a></span><span>
</span><span id="line-175"></span><span>              </span><span class="annot"><span class="annottext">Maybe
  (ReplaceArgs
     (TypecheckedUnisonFile Symbol Ann)
     (Unify
        (TypeReferenceId,
         DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
        (TypeReferenceId, DataDeclaration Symbol Ann)
      ++ '[ 'Sub 1 Symbol]))
-&gt; (Maybe
      (ReplaceArgs
         (TypecheckedUnisonFile Symbol Ann)
         (Unify
            (TypeReferenceId,
             DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
            (TypeReferenceId, DataDeclaration Symbol Ann)
          ++ '[ 'Sub 1 Symbol]))
    -&gt; Maybe (TypecheckedUnisonFile Symbol Ann))
-&gt; Maybe (TypecheckedUnisonFile Symbol Ann)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(ReplaceArgs
   (TypecheckedUnisonFile Symbol Ann)
   (Unify
      (TypeReferenceId,
       DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
      (TypeReferenceId, DataDeclaration Symbol Ann)
    ++ '[ 'Sub 1 Symbol])
 -&gt; Identity (TypecheckedUnisonFile Symbol Ann))
-&gt; Maybe
     (ReplaceArgs
        (TypecheckedUnisonFile Symbol Ann)
        (Unify
           (TypeReferenceId,
            DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
           (TypeReferenceId, DataDeclaration Symbol Ann)
         ++ '[ 'Sub 1 Symbol]))
-&gt; Identity (Maybe (TypecheckedUnisonFile Symbol Ann))
forall a b (p :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(Choice p, Applicative f) =&gt;
p a (f b) -&gt; p (Maybe a) (f (Maybe b))
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">((ReplaceArgs
    (TypecheckedUnisonFile Symbol Ann)
    (Unify
       (TypeReferenceId,
        DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
       (TypeReferenceId, DataDeclaration Symbol Ann)
     ++ '[ 'Sub 1 Symbol])
  -&gt; Identity (TypecheckedUnisonFile Symbol Ann))
 -&gt; Maybe
      (ReplaceArgs
         (TypecheckedUnisonFile Symbol Ann)
         (Unify
            (TypeReferenceId,
             DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
            (TypeReferenceId, DataDeclaration Symbol Ann)
          ++ '[ 'Sub 1 Symbol]))
 -&gt; Identity (Maybe (TypecheckedUnisonFile Symbol Ann)))
-&gt; ((DataDeclaration Symbol Ann
     -&gt; Identity (DataDeclaration Symbol Ann))
    -&gt; ReplaceArgs
         (TypecheckedUnisonFile Symbol Ann)
         (Unify
            (TypeReferenceId,
             DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
            (TypeReferenceId, DataDeclaration Symbol Ann)
          ++ '[ 'Sub 1 Symbol])
    -&gt; Identity (TypecheckedUnisonFile Symbol Ann))
-&gt; (DataDeclaration Symbol Ann
    -&gt; Identity (DataDeclaration Symbol Ann))
-&gt; Maybe
     (ReplaceArgs
        (TypecheckedUnisonFile Symbol Ann)
        (Unify
           (TypeReferenceId,
            DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
           (TypeReferenceId, DataDeclaration Symbol Ann)
         ++ '[ 'Sub 1 Symbol]))
-&gt; Identity (Maybe (TypecheckedUnisonFile Symbol Ann))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann)
 -&gt; Identity
      (Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann)))
-&gt; ReplaceArgs
     (TypecheckedUnisonFile Symbol Ann)
     (Unify
        (TypeReferenceId,
         DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
        (TypeReferenceId, DataDeclaration Symbol Ann)
      ++ '[ 'Sub 1 Symbol])
-&gt; Identity (TypecheckedUnisonFile Symbol Ann)
</span><span class="">#effectDeclarationsId'</span></span><span> </span><span class="annot"><span class="annottext">((Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann)
  -&gt; Identity
       (Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann)))
 -&gt; ReplaceArgs
      (TypecheckedUnisonFile Symbol Ann)
      (Unify
         (TypeReferenceId,
          DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
         (TypeReferenceId, DataDeclaration Symbol Ann)
       ++ '[ 'Sub 1 Symbol])
 -&gt; Identity (TypecheckedUnisonFile Symbol Ann))
-&gt; ((DataDeclaration Symbol Ann
     -&gt; Identity (DataDeclaration Symbol Ann))
    -&gt; Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann)
    -&gt; Identity
         (Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann)))
-&gt; (DataDeclaration Symbol Ann
    -&gt; Identity (DataDeclaration Symbol Ann))
-&gt; ReplaceArgs
     (TypecheckedUnisonFile Symbol Ann)
     (Unify
        (TypeReferenceId,
         DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
        (TypeReferenceId, DataDeclaration Symbol Ann)
      ++ '[ 'Sub 1 Symbol])
-&gt; Identity (TypecheckedUnisonFile Symbol Ann)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((TypeReferenceId, EffectDeclaration Symbol Ann)
 -&gt; Identity (TypeReferenceId, EffectDeclaration Symbol Ann))
-&gt; Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann)
-&gt; Identity
     (Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann))
forall (f :: * -&gt; *) a b.
Traversable f =&gt;
IndexedTraversal Int (f a) (f b) a b
IndexedTraversal
  Int
  (Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann))
  (Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann))
  (TypeReferenceId, EffectDeclaration Symbol Ann)
  (TypeReferenceId, EffectDeclaration Symbol Ann)
</span><span class="hs-identifier hs-var">traversed</span></span><span> </span><span class="annot"><span class="annottext">(((TypeReferenceId, EffectDeclaration Symbol Ann)
  -&gt; Identity (TypeReferenceId, EffectDeclaration Symbol Ann))
 -&gt; Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann)
 -&gt; Identity
      (Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann)))
-&gt; ((DataDeclaration Symbol Ann
     -&gt; Identity (DataDeclaration Symbol Ann))
    -&gt; (TypeReferenceId, EffectDeclaration Symbol Ann)
    -&gt; Identity (TypeReferenceId, EffectDeclaration Symbol Ann))
-&gt; (DataDeclaration Symbol Ann
    -&gt; Identity (DataDeclaration Symbol Ann))
-&gt; Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann)
-&gt; Identity
     (Map Symbol (TypeReferenceId, EffectDeclaration Symbol Ann))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(EffectDeclaration Symbol Ann
 -&gt; Identity (EffectDeclaration Symbol Ann))
-&gt; (TypeReferenceId, EffectDeclaration Symbol Ann)
-&gt; Identity (TypeReferenceId, EffectDeclaration Symbol Ann)
forall s t a b. Field2 s t a b =&gt; Lens s t a b
Lens
  (TypeReferenceId, EffectDeclaration Symbol Ann)
  (TypeReferenceId, EffectDeclaration Symbol Ann)
  (EffectDeclaration Symbol Ann)
  (EffectDeclaration Symbol Ann)
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">((EffectDeclaration Symbol Ann
  -&gt; Identity (EffectDeclaration Symbol Ann))
 -&gt; (TypeReferenceId, EffectDeclaration Symbol Ann)
 -&gt; Identity (TypeReferenceId, EffectDeclaration Symbol Ann))
-&gt; ((DataDeclaration Symbol Ann
     -&gt; Identity (DataDeclaration Symbol Ann))
    -&gt; EffectDeclaration Symbol Ann
    -&gt; Identity (EffectDeclaration Symbol Ann))
-&gt; (DataDeclaration Symbol Ann
    -&gt; Identity (DataDeclaration Symbol Ann))
-&gt; (TypeReferenceId, EffectDeclaration Symbol Ann)
-&gt; Identity (TypeReferenceId, EffectDeclaration Symbol Ann)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(DataDeclaration Symbol Ann
 -&gt; Identity (DataDeclaration Symbol Ann))
-&gt; EffectDeclaration Symbol Ann
-&gt; Identity (EffectDeclaration Symbol Ann)
forall v a (p :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(Profunctor p, Functor f) =&gt;
p (DataDeclaration v a) (f (DataDeclaration v a))
-&gt; p (EffectDeclaration v a) (f (EffectDeclaration v a))
</span><span class="hs-identifier hs-var">Decl.asDataDecl_</span></span><span> </span><span class="annot"><span class="annottext">((DataDeclaration Symbol Ann
  -&gt; Identity (DataDeclaration Symbol Ann))
 -&gt; Maybe
      (ReplaceArgs
         (TypecheckedUnisonFile Symbol Ann)
         (Unify
            (TypeReferenceId,
             DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
            (TypeReferenceId, DataDeclaration Symbol Ann)
          ++ '[ 'Sub 1 Symbol]))
 -&gt; Identity (Maybe (TypecheckedUnisonFile Symbol Ann)))
-&gt; (DataDeclaration Symbol Ann -&gt; DataDeclaration Symbol Ann)
-&gt; Maybe
     (ReplaceArgs
        (TypecheckedUnisonFile Symbol Ann)
        (Unify
           (TypeReferenceId,
            DataDeclaration (P 1 Symbol 'PTag) (P 0 Ann 'PTag))
           (TypeReferenceId, DataDeclaration Symbol Ann)
         ++ '[ 'Sub 1 Symbol]))
-&gt; Maybe (TypecheckedUnisonFile Symbol Ann)
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">DataDeclaration Symbol Ann -&gt; DataDeclaration Symbol Ann
forall v. DataDeclaration v Ann -&gt; DataDeclaration v Ann
</span><a href="#local-6989586621680869136"><span class="hs-identifier hs-var">sortConstructors</span></a></span><span>
</span><span id="line-176"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (UnisonFile Symbol Ann)
</span><a href="#local-6989586621680869132"><span class="hs-identifier hs-var">sortedUF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
</span><a href="#local-6989586621680869138"><span class="hs-identifier hs-var">sortedTF</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-comment">-- ppedForFileHelper</span><span>
</span><span id="line-179"></span><span>    </span><span id="local-6989586621680868632"><span class="annot"><a href="#local-6989586621680869136"><span class="hs-identifier hs-type">sortConstructors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decl.DataDeclaration</span></span><span> </span><span class="annot"><a href="#local-6989586621680868632"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann.Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decl.DataDeclaration</span></span><span> </span><span class="annot"><a href="#local-6989586621680868632"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann.Ann</span></span></span><span>
</span><span id="line-180"></span><span>    </span><span id="local-6989586621680869136"><span class="annot"><span class="annottext">sortConstructors :: forall v. DataDeclaration v Ann -&gt; DataDeclaration v Ann
</span><a href="#local-6989586621680869136"><span class="hs-identifier hs-var hs-var">sortConstructors</span></a></span></span><span> </span><span id="local-6989586621680869148"><span class="annot"><span class="annottext">DataDeclaration v Ann
</span><a href="#local-6989586621680869148"><span class="hs-identifier hs-var">dd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-181"></span><span>      </span><span class="hs-comment">-- Sort by their Ann so we keep the order they were in the original file.</span><span>
</span><span id="line-182"></span><span>      </span><span class="annot"><span class="annottext">DataDeclaration v Ann
</span><a href="#local-6989586621680869148"><span class="hs-identifier hs-var">dd</span></a></span><span> </span><span class="annot"><span class="annottext">DataDeclaration v Ann
-&gt; (DataDeclaration v Ann -&gt; DataDeclaration v Ann)
-&gt; DataDeclaration v Ann
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">([(Ann, v, Type v Ann)] -&gt; Identity [(Ann, v, Type v Ann)])
-&gt; DataDeclaration v Ann -&gt; Identity (DataDeclaration v Ann)
forall v a (f :: * -&gt; *).
Functor f =&gt;
([(a, v, Type v a)] -&gt; f [(a, v, Type v a)])
-&gt; DataDeclaration v a -&gt; f (DataDeclaration v a)
</span><span class="hs-identifier hs-var">Decl.constructors_</span></span><span> </span><span class="annot"><span class="annottext">(([(Ann, v, Type v Ann)] -&gt; Identity [(Ann, v, Type v Ann)])
 -&gt; DataDeclaration v Ann -&gt; Identity (DataDeclaration v Ann))
-&gt; ([(Ann, v, Type v Ann)] -&gt; [(Ann, v, Type v Ann)])
-&gt; DataDeclaration v Ann
-&gt; DataDeclaration v Ann
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortOn</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Ann.Ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting Ann (Ann, v, Type v Ann) Ann -&gt; (Ann, v, Type v Ann) -&gt; Ann
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting Ann (Ann, v, Type v Ann) Ann
forall s t a b. Field1 s t a b =&gt; Lens s t a b
Lens (Ann, v, Type v Ann) (Ann, v, Type v Ann) Ann Ann
</span><span class="hs-identifier hs-var">_1</span></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#annToRange"><span class="hs-identifier hs-type">annToRange</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann.Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Range</span></span><span>
</span><span id="line-185"></span><span id="annToRange"><span class="annot"><span class="annottext">annToRange :: Ann -&gt; Maybe Range
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#annToRange"><span class="hs-identifier hs-var hs-var">annToRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-186"></span><span>  </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">Ann.Intrinsic</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Range
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">Ann.External</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Range
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Ann.GeneratedFrom</span></span><span> </span><span id="local-6989586621680869156"><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621680869156"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ann -&gt; Maybe Range
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#annToRange"><span class="hs-identifier hs-var">annToRange</span></a></span><span> </span><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621680869156"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-189"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Ann.Ann</span></span><span> </span><span id="local-6989586621680869157"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621680869157"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621680869158"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621680869158"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Range -&gt; Maybe Range
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Range -&gt; Maybe Range) -&gt; Range -&gt; Maybe Range
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pos -&gt; Pos -&gt; Range
</span><span class="hs-identifier hs-var">Range</span></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621680869157"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621680869158"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#rangeToInterval"><span class="hs-identifier hs-type">rangeToInterval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Range</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Interval.Interval</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pos.Pos</span></span><span>
</span><span id="line-192"></span><span id="rangeToInterval"><span class="annot"><span class="annottext">rangeToInterval :: Range -&gt; Interval Pos
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#rangeToInterval"><span class="hs-identifier hs-var hs-var">rangeToInterval</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Range</span></span><span> </span><span id="local-6989586621680869160"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621680869160"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621680869161"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621680869161"><span class="hs-identifier hs-var">end</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-193"></span><span>  </span><span class="annot"><span class="annottext">Pos -&gt; Pos -&gt; Interval Pos
forall a. a -&gt; a -&gt; Interval a
</span><span class="hs-identifier hs-var">Interval.ClosedInterval</span></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621680869160"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621680869161"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#annToInterval"><span class="hs-identifier hs-type">annToInterval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann.Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Interval.Interval</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pos.Pos</span></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span id="annToInterval"><span class="annot"><span class="annottext">annToInterval :: Ann -&gt; Maybe (Interval Pos)
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#annToInterval"><span class="hs-identifier hs-var hs-var">annToInterval</span></a></span></span><span> </span><span id="local-6989586621680869163"><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621680869163"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ann -&gt; Maybe Range
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#annToRange"><span class="hs-identifier hs-var">annToRange</span></a></span><span> </span><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621680869163"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; (Range -&gt; Interval Pos) -&gt; Maybe (Interval Pos)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Range -&gt; Interval Pos
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#rangeToInterval"><span class="hs-identifier hs-var">rangeToInterval</span></a></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-comment">-- | Returns 'True' if the given symbol is a term with a user provided type signature in the</span><span>
</span><span id="line-199"></span><span class="hs-comment">-- parsed file, false otherwise.</span><span>
</span><span id="line-200"></span><span id="local-6989586621680868622"><span id="local-6989586621680868623"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#hasUserTypeSignature"><span class="hs-identifier hs-type">hasUserTypeSignature</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680868622"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UnisonFile</span></span><span> </span><span class="annot"><a href="#local-6989586621680868622"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680868623"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680868622"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-201"></span><span id="hasUserTypeSignature"><span class="annot"><span class="annottext">hasUserTypeSignature :: forall v a. Eq v =&gt; UnisonFile v a -&gt; v -&gt; Bool
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#hasUserTypeSignature"><span class="hs-identifier hs-var hs-var">hasUserTypeSignature</span></a></span></span><span> </span><span id="local-6989586621680869168"><span class="annot"><span class="annottext">UnisonFile v a
</span><a href="#local-6989586621680869168"><span class="hs-identifier hs-var">parsedFile</span></a></span></span><span> </span><span id="local-6989586621680869169"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680869169"><span class="hs-identifier hs-var">sym</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-202"></span><span>  </span><span class="annot"><span class="annottext">Map v (a, Term v a) -&gt; [(v, (a, Term v a))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnisonFile v a -&gt; Map v (a, Term v a)
forall v a. UnisonFile v a -&gt; Map v (a, Term v a)
</span><span class="hs-identifier hs-var">UF.terms</span></span><span> </span><span class="annot"><span class="annottext">UnisonFile v a
</span><a href="#local-6989586621680869168"><span class="hs-identifier hs-var">parsedFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><span class="annottext">[(v, (a, Term v a))] -&gt; ([(v, (a, Term v a))] -&gt; Bool) -&gt; Bool
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">((v, (a, Term v a)) -&gt; Bool) -&gt; [(v, (a, Term v a))] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680869172"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680869172"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869173"><span class="annot"><span class="annottext">Term v a
</span><a href="#local-6989586621680869173"><span class="hs-identifier hs-var">trm</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680869172"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">v -&gt; v -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680869169"><span class="hs-identifier hs-var">sym</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Type v a) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term v a -&gt; Maybe (Type v a)
forall v a. Term v a -&gt; Maybe (Type v a)
</span><span class="hs-identifier hs-var">Term.getTypeAnnotation</span></span><span> </span><span class="annot"><span class="annottext">Term v a
</span><a href="#local-6989586621680869173"><span class="hs-identifier hs-var">trm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="annot"><span class="hs-comment">-- | A text replacement to apply to a file.</span></span><span>
</span><span id="line-206"></span><span class="hs-keyword">data</span><span> </span><span id="TextReplacement"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#TextReplacement"><span class="hs-identifier hs-var">TextReplacement</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TextReplacement"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#TextReplacement"><span class="hs-identifier hs-var">TextReplacement</span></a></span></span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- The new new text to replace the old text in the range with. w</span><span>
</span><span id="line-208"></span><span>    </span><span id="%24sel%3AreplacementText%3ATextReplacement"><span class="annot"><span class="annottext">TextReplacement -&gt; Text
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#%24sel%3AreplacementText%3ATextReplacement"><span class="hs-identifier hs-var hs-var">replacementText</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-comment">-- The range to replace, [start, end)</span><span>
</span><span id="line-210"></span><span>    </span><span id="%24sel%3AreplacementRange%3ATextReplacement"><span class="annot"><span class="annottext">TextReplacement -&gt; Range
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#%24sel%3AreplacementRange%3ATextReplacement"><span class="hs-identifier hs-var hs-var">replacementRange</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Range</span></span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680869179"><span id="local-6989586621680869185"><span class="annot"><span class="annottext">TextReplacement -&gt; TextReplacement -&gt; Bool
(TextReplacement -&gt; TextReplacement -&gt; Bool)
-&gt; (TextReplacement -&gt; TextReplacement -&gt; Bool)
-&gt; Eq TextReplacement
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: TextReplacement -&gt; TextReplacement -&gt; Bool
== :: TextReplacement -&gt; TextReplacement -&gt; Bool
$c/= :: TextReplacement -&gt; TextReplacement -&gt; Bool
/= :: TextReplacement -&gt; TextReplacement -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869190"><span id="local-6989586621680869198"><span id="local-6989586621680869202"><span class="annot"><span class="annottext">Int -&gt; TextReplacement -&gt; ShowS
[TextReplacement] -&gt; ShowS
TextReplacement -&gt; String
(Int -&gt; TextReplacement -&gt; ShowS)
-&gt; (TextReplacement -&gt; String)
-&gt; ([TextReplacement] -&gt; ShowS)
-&gt; Show TextReplacement
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; TextReplacement -&gt; ShowS
showsPrec :: Int -&gt; TextReplacement -&gt; ShowS
$cshow :: TextReplacement -&gt; String
show :: TextReplacement -&gt; String
$cshowList :: [TextReplacement] -&gt; ShowS
showList :: [TextReplacement] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="hs-comment">-- | Apply a list of range replacements to a text, returning the updated text.</span><span>
</span><span id="line-215"></span><span class="hs-comment">--</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- &gt;&gt;&gt; applyFormatUpdates [TextReplacement &quot;cakes&quot; (Range (Pos.Pos 1 21) (Pos.Pos 1 28))] &quot;my favorite food is oranges because\nthey are delicious and nutritious&quot;</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- &quot;my favorite food is cakes because\nthey are delicious and nutritious&quot;</span><span>
</span><span id="line-218"></span><span class="hs-comment">--</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- Multiple replacements.</span><span>
</span><span id="line-220"></span><span class="hs-comment">-- &gt;&gt;&gt; let txt = &quot;my favorite food is oranges because\nthey are delicious and nutritious&quot;</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- &gt;&gt;&gt; let replacements = [TextReplacement &quot;cakes&quot; (Range (Pos.Pos 1 21) (Pos.Pos 1 28)), TextReplacement &quot;decadent&quot; (Range (Pos.Pos 2 10) (Pos.Pos 2 19)), TextReplacement &quot;tasty&quot; (Range (Pos.Pos 2 24) (Pos.Pos 2 34))]</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- &gt;&gt;&gt; applyFormatUpdates replacements txt</span><span>
</span><span id="line-223"></span><span class="hs-comment">-- &quot;my favorite food is cakes because\nthey are decadent and tasty&quot;</span><span>
</span><span id="line-224"></span><span class="hs-comment">--</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- Multi-line replacements.</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- &gt;&gt;&gt; let txt = &quot;mary had a little lamb\nwhose fleece was white as snow\nand everywhere that mary went\nthe lamb was sure to go&quot;</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- &gt;&gt;&gt; let replacements = [TextReplacement &quot;lambo, which&quot; (Range (Pos.Pos 1 19) (Pos.Pos 2 13)), TextReplacement &quot; the people stared&quot; (Range (Pos.Pos 3 99) (Pos.Pos 4 99))]</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- &gt;&gt;&gt; applyFormatUpdates replacements txt</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- &quot;mary had a little lambo, which was white as snow\nand everywhere that mary went the people stared&quot;</span><span>
</span><span id="line-230"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#applyTextReplacements"><span class="hs-identifier hs-type">applyTextReplacements</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#TextReplacement"><span class="hs-identifier hs-type">TextReplacement</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-231"></span><span id="applyTextReplacements"><span class="annot"><span class="annottext">applyTextReplacements :: [TextReplacement] -&gt; Text -&gt; Text
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#applyTextReplacements"><span class="hs-identifier hs-var hs-var">applyTextReplacements</span></a></span></span><span> </span><span id="local-6989586621680869205"><span class="annot"><span class="annottext">[TextReplacement]
</span><a href="#local-6989586621680869205"><span class="hs-identifier hs-var">replacements</span></a></span></span><span> </span><span id="local-6989586621680869206"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680869206"><span class="hs-identifier hs-var">inputText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Int, Int, Maybe Text)] -&gt; [Text] -&gt; Builder
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#applyTextReplacementsHelper"><span class="hs-identifier hs-var">applyTextReplacementsHelper</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Int, Maybe Text)]
</span><a href="#local-6989586621680869208"><span class="hs-identifier hs-var">relativeOffsets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Text]
</span><span class="hs-identifier hs-var">Text.lines</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680869206"><span class="hs-identifier hs-var">inputText</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; (Builder -&gt; Text) -&gt; Text
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Text
</span><span class="hs-identifier hs-var">TB.run</span></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-233"></span><span>    </span><span class="annot"><a href="#local-6989586621680869211"><span class="hs-identifier hs-type">tupleReplacements</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-234"></span><span>    </span><span id="local-6989586621680869211"><span class="annot"><span class="annottext">tupleReplacements :: [(Int, Int, Maybe Text)]
</span><a href="#local-6989586621680869211"><span class="hs-identifier hs-var hs-var">tupleReplacements</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-235"></span><span>      </span><span class="annot"><span class="annottext">[TextReplacement]
</span><a href="#local-6989586621680869205"><span class="hs-identifier hs-var">replacements</span></a></span><span>
</span><span id="line-236"></span><span>        </span><span class="annot"><span class="annottext">[TextReplacement]
-&gt; ([TextReplacement] -&gt; [(Int, Int, Maybe Text)])
-&gt; [(Int, Int, Maybe Text)]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TextReplacement -&gt; [(Int, Int, Maybe Text)])
-&gt; [TextReplacement] -&gt; [(Int, Int, Maybe Text)]
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span>
</span><span id="line-237"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#TextReplacement"><span class="hs-identifier hs-type">TextReplacement</span></a></span><span> </span><span id="local-6989586621680869212"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680869212"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Range</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pos.Pos</span></span><span> </span><span id="local-6989586621680869214"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869214"><span class="hs-identifier hs-var">startLine</span></a></span></span><span> </span><span id="local-6989586621680869215"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869215"><span class="hs-identifier hs-var">startCol</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pos.Pos</span></span><span> </span><span id="local-6989586621680869216"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869216"><span class="hs-identifier hs-var">endLine</span></a></span></span><span> </span><span id="local-6989586621680869217"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869217"><span class="hs-identifier hs-var">endCol</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-238"></span><span>              </span><span class="hs-comment">-- Convert from 1-based indexing to 0-based indexing</span><span>
</span><span id="line-239"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869214"><span class="hs-identifier hs-var">startLine</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869215"><span class="hs-identifier hs-var">startCol</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869216"><span class="hs-identifier hs-var">endLine</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869217"><span class="hs-identifier hs-var">endCol</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680869212"><span class="hs-identifier hs-var">txt</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-240"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>    </span><span id="local-6989586621680869208"><span class="annot"><span class="annottext">relativeOffsets :: [(Int, Int, Maybe Text)]
</span><a href="#local-6989586621680869208"><span class="hs-identifier hs-var hs-var">relativeOffsets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Int, Int, Maybe Text)] -&gt; [(Int, Int, Maybe Text)]
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#relativizeOffsets"><span class="hs-identifier hs-var">relativizeOffsets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Int, Int, Maybe Text) -&gt; (Int, Int))
-&gt; [(Int, Int, Maybe Text)] -&gt; [(Int, Int, Maybe Text)]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.sortOn</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680869223"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869223"><span class="hs-identifier hs-var">line</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869224"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869224"><span class="hs-identifier hs-var">col</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869223"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869224"><span class="hs-identifier hs-var">col</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Int, Int, Maybe Text)]
</span><a href="#local-6989586621680869211"><span class="hs-identifier hs-var">tupleReplacements</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="hs-comment">-- | Given a list of offsets, return a list of offsets where each offset is positioned relative to the previous offset.</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- I.e. if the first offset is at line 3 col 4, and the next is at line 5 col 6, we subtract 3</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- from the 5 but leave the column alone since it's on a different line, resulting in [(3,4), (2,6)]</span><span>
</span><span id="line-246"></span><span class="hs-comment">--</span><span>
</span><span id="line-247"></span><span class="hs-comment">-- If the first offset is at line 3 col 4, and the next is at line 3 col 6, we subtract 3 from</span><span>
</span><span id="line-248"></span><span class="hs-comment">-- the line number AND subtract 4 from the column number since they're on the same line.</span><span>
</span><span id="line-249"></span><span class="hs-comment">-- Resulting in [(3,4), (0,2)]</span><span>
</span><span id="line-250"></span><span class="hs-comment">--</span><span>
</span><span id="line-251"></span><span class="hs-comment">--</span><span>
</span><span id="line-252"></span><span class="hs-comment">-- &gt;&gt;&gt; relativizeOffsets [(0, 0, Nothing), (0, 4, Just &quot;1&quot;), (0, 10, Nothing), (1, 0, Just &quot;2&quot;), (1, 5, Nothing), (5, 10, Just &quot;3&quot;)]</span><span>
</span><span id="line-253"></span><span class="hs-comment">-- NOW [(0,0,Nothing),(0,4,Just &quot;1&quot;),(0,6,Nothing),(1,0,Just &quot;2&quot;),(0,5,Nothing),(4,10,Just &quot;3&quot;)]</span><span>
</span><span id="line-254"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#relativizeOffsets"><span class="hs-identifier hs-type">relativizeOffsets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-255"></span><span id="relativizeOffsets"><span class="annot"><span class="annottext">relativizeOffsets :: [(Int, Int, Maybe Text)] -&gt; [(Int, Int, Maybe Text)]
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#relativizeOffsets"><span class="hs-identifier hs-var hs-var">relativizeOffsets</span></a></span></span><span> </span><span id="local-6989586621680869225"><span class="annot"><span class="annottext">[(Int, Int, Maybe Text)]
</span><a href="#local-6989586621680869225"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680869226"><span class="annot"><span class="annottext">grouped :: [[(Int, Int, Maybe Text)]]
</span><a href="#local-6989586621680869226"><span class="hs-identifier hs-var hs-var">grouped</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Int, Maybe Text) -&gt; (Int, Int, Maybe Text) -&gt; Bool)
-&gt; [(Int, Int, Maybe Text)] -&gt; [[(Int, Int, Maybe Text)]]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [[a]]
</span><span class="hs-identifier hs-var">List.groupBy</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680869228"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869228"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680869229"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869229"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869228"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869229"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Int, Int, Maybe Text)]
</span><a href="#local-6989586621680869225"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-257"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[[(Int, Int, Maybe Text)]]
</span><a href="#local-6989586621680869226"><span class="hs-identifier hs-var">grouped</span></a></span><span>
</span><span id="line-258"></span><span>        </span><span class="annot"><span class="annottext">[[(Int, Int, Maybe Text)]]
-&gt; ([[(Int, Int, Maybe Text)]] -&gt; [[(Int, Int, Maybe Text)]])
-&gt; [[(Int, Int, Maybe Text)]]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">([(Int, Int, Maybe Text)] -&gt; [(Int, Int, Maybe Text)])
-&gt; [[(Int, Int, Maybe Text)]] -&gt; [[(Int, Int, Maybe Text)]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, [(Int, Int, Maybe Text)]) -&gt; [(Int, Int, Maybe Text)]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Int, [(Int, Int, Maybe Text)]) -&gt; [(Int, Int, Maybe Text)])
-&gt; ([(Int, Int, Maybe Text)] -&gt; (Int, [(Int, Int, Maybe Text)]))
-&gt; [(Int, Int, Maybe Text)]
-&gt; [(Int, Int, Maybe Text)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; (Int, Int, Maybe Text) -&gt; (Int, (Int, Int, Maybe Text)))
-&gt; Int
-&gt; [(Int, Int, Maybe Text)]
-&gt; (Int, [(Int, Int, Maybe Text)])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><span class="hs-identifier hs-var">List.mapAccumL</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680869232"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869232"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680869233"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869233"><span class="hs-identifier hs-var">line</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869234"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869234"><span class="hs-identifier hs-var">col</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869235"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621680869235"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869234"><span class="hs-identifier hs-var">col</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869233"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869234"><span class="hs-identifier hs-var">col</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869232"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621680869235"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>        </span><span class="annot"><span class="annottext">[[(Int, Int, Maybe Text)]]
-&gt; ([[(Int, Int, Maybe Text)]] -&gt; [(Int, Int, Maybe Text)])
-&gt; [(Int, Int, Maybe Text)]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[[(Int, Int, Maybe Text)]] -&gt; [(Int, Int, Maybe Text)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.concat</span></span><span>
</span><span id="line-260"></span><span>        </span><span class="annot"><span class="annottext">[(Int, Int, Maybe Text)]
-&gt; ([(Int, Int, Maybe Text)] -&gt; [(Int, Int, Maybe Text)])
-&gt; [(Int, Int, Maybe Text)]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Int, [(Int, Int, Maybe Text)]) -&gt; [(Int, Int, Maybe Text)]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Int, [(Int, Int, Maybe Text)]) -&gt; [(Int, Int, Maybe Text)])
-&gt; ([(Int, Int, Maybe Text)] -&gt; (Int, [(Int, Int, Maybe Text)]))
-&gt; [(Int, Int, Maybe Text)]
-&gt; [(Int, Int, Maybe Text)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; (Int, Int, Maybe Text) -&gt; (Int, (Int, Int, Maybe Text)))
-&gt; Int
-&gt; [(Int, Int, Maybe Text)]
-&gt; (Int, [(Int, Int, Maybe Text)])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><span class="hs-identifier hs-var">List.mapAccumL</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680869237"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869237"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680869238"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869238"><span class="hs-identifier hs-var">line</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869239"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869239"><span class="hs-identifier hs-var">col</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869240"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621680869240"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869238"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869238"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869237"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869239"><span class="hs-identifier hs-var">col</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621680869240"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="hs-comment">-- | Apply a list of range replacements to a list of lines, returning the result.</span><span>
</span><span id="line-263"></span><span class="hs-comment">--</span><span>
</span><span id="line-264"></span><span class="hs-comment">-- &gt;&gt;&gt; applyTextReplacementsHelper [(0, 1, Nothing), (0, 4, Just &quot;1&quot;), (0, 2, Nothing), (1, 3, Just &quot;2&quot;), (0, 5, Nothing), (1, 10, Just &quot;3&quot;)] [&quot;abcdefghijk&quot;, &quot;lmnopqrstuv&quot;, &quot;wxyz&quot;, &quot;1234567890&quot;] &amp; TB.run</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- &quot;a1fg2opqrs3\n1234567890&quot;</span><span>
</span><span id="line-266"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#applyTextReplacementsHelper"><span class="hs-identifier hs-type">applyTextReplacementsHelper</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TB.Builder</span></span><span>
</span><span id="line-267"></span><span id="applyTextReplacementsHelper"><span class="annot"><span class="annottext">applyTextReplacementsHelper :: [(Int, Int, Maybe Text)] -&gt; [Text] -&gt; Builder
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#applyTextReplacementsHelper"><span class="hs-identifier hs-var hs-var">applyTextReplacementsHelper</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621680869241"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680869241"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; [Builder] -&gt; Builder
forall (foldable :: * -&gt; *).
Foldable foldable =&gt;
Builder -&gt; foldable Builder -&gt; Builder
</span><span class="hs-identifier hs-var">TB.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><span class="hs-identifier hs-var">TB.text</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Builder) -&gt; [Text] -&gt; [Builder]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680869241"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#applyTextReplacementsHelper"><span class="hs-identifier hs-var">applyTextReplacementsHelper</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Int, Maybe Text)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-269"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#applyTextReplacementsHelper"><span class="hs-identifier hs-var">applyTextReplacementsHelper</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869245"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869245"><span class="hs-identifier hs-var">col</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869246"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621680869246"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680869247"><span class="annot"><span class="annottext">[(Int, Int, Maybe Text)]
</span><a href="#local-6989586621680869247"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680869248"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680869248"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680869249"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680869249"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680869250"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680869250"><span class="hs-identifier hs-var">prefix</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869251"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680869251"><span class="hs-identifier hs-var">suffix</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; (Text, Text)
</span><span class="hs-identifier hs-var">Text.splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869245"><span class="hs-identifier hs-var">col</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680869248"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-271"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><span class="hs-identifier hs-var">TB.text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Maybe Text -&gt; Text
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680869250"><span class="hs-identifier hs-var">prefix</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621680869246"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Int, Int, Maybe Text)] -&gt; [Text] -&gt; Builder
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#applyTextReplacementsHelper"><span class="hs-identifier hs-var">applyTextReplacementsHelper</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Int, Maybe Text)]
</span><a href="#local-6989586621680869247"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680869251"><span class="hs-identifier hs-var">suffix</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; [Text]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680869249"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#applyTextReplacementsHelper"><span class="hs-identifier hs-var">applyTextReplacementsHelper</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680869254"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869254"><span class="hs-identifier hs-var">line</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869255"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869255"><span class="hs-identifier hs-var">col</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869256"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621680869256"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680869257"><span class="annot"><span class="annottext">[(Int, Int, Maybe Text)]
</span><a href="#local-6989586621680869257"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680869258"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680869258"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-273"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Text] -&gt; ([Text], [Text])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">List.splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869254"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680869258"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680869260"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680869260"><span class="hs-identifier hs-var">prefixLines</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; [Builder] -&gt; Builder
forall (foldable :: * -&gt; *).
Foldable foldable =&gt;
Builder -&gt; foldable Builder -&gt; Builder
</span><span class="hs-identifier hs-var">TB.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><span class="hs-identifier hs-var">TB.text</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Builder) -&gt; [Text] -&gt; [Builder]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680869260"><span class="hs-identifier hs-var">prefixLines</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680869261"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680869261"><span class="hs-identifier hs-var">prefixLines</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680869262"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680869262"><span class="hs-identifier hs-var">lastLine</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680869263"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680869263"><span class="hs-identifier hs-var">restLines</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-276"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680869264"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680869264"><span class="hs-identifier hs-var">prefixChars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680869265"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680869265"><span class="hs-identifier hs-var">suffixChars</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; (Text, Text)
</span><span class="hs-identifier hs-var">Text.splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680869255"><span class="hs-identifier hs-var">col</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680869262"><span class="hs-identifier hs-var">lastLine</span></a></span><span>
</span><span id="line-277"></span><span>          </span><span id="local-6989586621680869266"><span class="annot"><span class="annottext">segment :: Builder
</span><a href="#local-6989586621680869266"><span class="hs-identifier hs-var hs-var">segment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-278"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Builder -&gt; [Builder] -&gt; Builder
forall (foldable :: * -&gt; *).
Foldable foldable =&gt;
Builder -&gt; foldable Builder -&gt; Builder
</span><span class="hs-identifier hs-var">TB.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">([Builder] -&gt; Builder) -&gt; [Builder] -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Builder) -&gt; [Text] -&gt; [Builder]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><span class="hs-identifier hs-var">TB.text</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680869261"><span class="hs-identifier hs-var">prefixLines</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>              </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Builder
</span><span class="hs-identifier hs-var">TB.char</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\n'</span></span><span>
</span><span id="line-280"></span><span>              </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><span class="hs-identifier hs-var">TB.text</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680869264"><span class="hs-identifier hs-var">prefixChars</span></a></span><span>
</span><span id="line-281"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; (Text -&gt; Builder) -&gt; Maybe Text -&gt; Builder
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621680869266"><span class="hs-identifier hs-var">segment</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><span class="hs-identifier hs-var">TB.text</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621680869256"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Int, Int, Maybe Text)] -&gt; [Text] -&gt; Builder
</span><a href="Unison.Codebase.Editor.HandleInput.FormatFile.html#applyTextReplacementsHelper"><span class="hs-identifier hs-var">applyTextReplacementsHelper</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Int, Maybe Text)]
</span><a href="#local-6989586621680869257"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680869265"><span class="hs-identifier hs-var">suffixChars</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; [Text]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680869263"><span class="hs-identifier hs-var">restLines</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span></pre></body></html>