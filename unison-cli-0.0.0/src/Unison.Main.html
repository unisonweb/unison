<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ApplicativeDo #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE PartialTypeSignatures #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-partial-type-signatures #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Main</span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Main.html#main"><span class="hs-identifier">main</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">where</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="ArgParse.html"><span class="hs-identifier">ArgParse</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="ArgParse.html#CodebasePathOption"><span class="hs-identifier">CodebasePathOption</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="ArgParse.html#Command"><span class="hs-identifier">Command</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ArgParse.html#Init"><span class="hs-identifier">Init</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ArgParse.html#Launch"><span class="hs-identifier">Launch</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ArgParse.html#PrintVersion"><span class="hs-identifier">PrintVersion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ArgParse.html#Run"><span class="hs-identifier">Run</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ArgParse.html#Transcript"><span class="hs-identifier">Transcript</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="ArgParse.html#GlobalOptions"><span class="hs-identifier">GlobalOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="ArgParse.html#IsHeadless"><span class="hs-identifier">IsHeadless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ArgParse.html#Headless"><span class="hs-identifier">Headless</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ArgParse.html#WithCLI"><span class="hs-identifier">WithCLI</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="ArgParse.html#RunSource"><span class="hs-identifier">RunSource</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="ArgParse.html#ShouldExit"><span class="hs-identifier">ShouldExit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ArgParse.html#DoNotExit"><span class="hs-identifier">DoNotExit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ArgParse.html#Exit"><span class="hs-identifier">Exit</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="ArgParse.html#ShouldForkCodebase"><span class="hs-identifier">ShouldForkCodebase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="ArgParse.html#ShouldSaveCodebase"><span class="hs-identifier">ShouldSaveCodebase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="ArgParse.html#UsageRenderer"><span class="hs-identifier">UsageRenderer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="ArgParse.html#parseCLIArgs"><span class="hs-identifier">parseCLIArgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Compat.html"><span class="hs-identifier">Compat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Compat.html#defaultInterruptHandler"><span class="hs-identifier">defaultInterruptHandler</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Compat.html#withInterruptHandler"><span class="hs-identifier">withInterruptHandler</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">newEmptyMVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runInUnboundThread</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">takeMVar</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">displayException</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">evaluate</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either.Validation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Validation</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.IO</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Conc</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">setUncaughtExceptionHandler</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Conc</span></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ki</span></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Client</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HTTP</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Client.TLS</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HTTP</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Stats.html"><span class="hs-identifier">Stats</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Stats.html#recordRtsStats"><span class="hs-identifier">recordRtsStats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">canonicalizePath</span></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><span class="hs-identifier">exeExtension</span></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><span class="hs-identifier">getCurrentDirectory</span></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><span class="hs-identifier">removeDirectoryRecursive</span></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Environment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getExecutablePath</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getProgName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">withArgs</span></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Exit</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Exit</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Exit</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">System</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">replaceExtension</span></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><span class="hs-identifier">takeDirectory</span></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><span class="hs-identifier">takeExtension</span></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><span class="hs-operator">(&lt;.&gt;)</span></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="hs-operator">(&lt;/&gt;)</span></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">stderr</span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.CodePage</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">withCP65001</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Temp</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Temp</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="System.Path.html"><span class="hs-identifier">System.Path</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Path</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Megaparsec</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MP</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.Queries</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Queries</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Cli.ProjectUtils.html"><span class="hs-identifier">Unison.Cli.ProjectUtils</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ProjectUtils</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Codebase</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">CodebasePath</span></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Codebase</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html"><span class="hs-identifier">Unison.Codebase.Editor.Input</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Input</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Execute</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">execute</span></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Init</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CodebaseInitOptions</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">InitError</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">InitResult</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SpecifiedCodebase</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Init</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CodebaseInit</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Init.OpenCodebaseError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">OpenCodebaseError</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Path</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Path</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.ProjectPath</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PP</span></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Runtime</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Rt</span></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.SqliteCodebase</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SC</span></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.Runner.html"><span class="hs-identifier">Unison.Codebase.Transcript.Runner</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Transcript</span></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Verbosity</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Verbosity</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.CommandLine.Helpers.html"><span class="hs-identifier">Unison.CommandLine.Helpers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.CommandLine.Helpers.html#plural%27"><span class="hs-identifier">plural'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.CommandLine.Main.html"><span class="hs-identifier">Unison.CommandLine.Main</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CommandLine</span></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.CommandLine.Types.html"><span class="hs-identifier">Unison.CommandLine.Types</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CommandLine</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.CommandLine.Welcome.html"><span class="hs-identifier">Unison.CommandLine.Welcome</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.CommandLine.Welcome.html#CodebaseInitStatus"><span class="hs-identifier">CodebaseInitStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.CommandLine.Welcome.html"><span class="hs-identifier">Unison.CommandLine.Welcome</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Welcome</span></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Core.Project</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ProjectAndBranch</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ProjectBranchName</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ProjectName</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.LSP.html"><span class="hs-identifier">Unison.LSP</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LSP</span></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.LSP.Util.Signal.html"><span class="hs-identifier">Unison.LSP.Util.Signal</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Signal</span></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyTerminal</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PT</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Runtime.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">RuntimeExn</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Runtime.Interface</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">RTI</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Server.Backend</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Backend</span></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Server.CodebaseServer</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Server</span></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Pretty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Version.html"><span class="hs-identifier">Unison.Version</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Version.html#Version"><span class="hs-identifier">Version</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Version.html"><span class="hs-identifier">Unison.Version</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Version</span></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UnliftIO.Directory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getHomeDirectory</span></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-keyword">type</span><span> </span><span id="Runtimes"><span class="annot"><a href="Unison.Main.html#Runtimes"><span class="hs-identifier hs-var">Runtimes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RTI.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RTI.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RTI.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="annot"><a href="Unison.Main.html#fixNativeRuntimePath"><span class="hs-identifier hs-type">fixNativeRuntimePath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-102"></span><span id="fixNativeRuntimePath"><span class="annot"><span class="annottext">fixNativeRuntimePath :: Maybe String -&gt; IO String
</span><a href="Unison.Main.html#fixNativeRuntimePath"><span class="hs-identifier hs-var hs-var">fixNativeRuntimePath</span></a></span></span><span> </span><span id="local-6989586621680938745"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621680938745"><span class="hs-identifier hs-var">override</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-103"></span><span>  </span><span id="local-6989586621680938746"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938746"><span class="hs-identifier hs-var">ucm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">getExecutablePath</span></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680938747"><span class="annot"><span class="annottext">ucr :: String
</span><a href="#local-6989586621680938747"><span class="hs-identifier hs-var hs-var">ucr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><span class="hs-identifier hs-var">takeDirectory</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938746"><span class="hs-identifier hs-var">ucm</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runtime&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unison-runtime&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">&lt;.&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier hs-var">exeExtension</span></span><span>
</span><span id="line-105"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO String) -&gt; String -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; (String -&gt; String) -&gt; Maybe String -&gt; String
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938747"><span class="hs-identifier hs-var">ucr</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621680938745"><span class="hs-identifier hs-var">override</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="annot"><a href="Unison.Main.html#main"><span class="hs-identifier hs-type">main</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Version.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span id="main"><span class="annot"><span class="annottext">main :: Version -&gt; IO ()
</span><a href="Unison.Main.html#main"><span class="hs-identifier hs-var hs-var">main</span></a></span></span><span> </span><span id="local-6989586621680938750"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680938750"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-comment">-- Replace the default exception handler with one complains loudly, because we shouldn't have any uncaught exceptions.</span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-comment">-- Sometimes `show` and `displayException` are different strings; in this case, we want to show them both, so this</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-comment">-- issue is easier to debug.</span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><span class="annottext">(SomeException -&gt; IO ()) -&gt; IO ()
</span><span class="hs-identifier hs-var">setUncaughtExceptionHandler</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680938751"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680938751"><span class="hs-identifier hs-var">exception</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680938752"><span class="annot"><span class="annottext">shown :: Text
</span><a href="#local-6989586621680938752"><span class="hs-identifier hs-var hs-var">shown</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">tShow</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680938751"><span class="hs-identifier hs-var">exception</span></a></span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680938754"><span class="annot"><span class="annottext">displayed :: Text
</span><a href="#local-6989586621680938754"><span class="hs-identifier hs-var hs-var">displayed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeException -&gt; String
forall e. Exception e =&gt; e -&gt; String
</span><span class="hs-identifier hs-var">displayException</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680938751"><span class="hs-identifier hs-var">exception</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680938758"><span class="annot"><span class="annottext">indented :: Text -&gt; Text
</span><a href="#local-6989586621680938758"><span class="hs-identifier hs-var hs-var">indented</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">Text.unlines</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; (Text -&gt; [Text]) -&gt; Text -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; [Text] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;  &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; [Text]) -&gt; (Text -&gt; [Text]) -&gt; Text -&gt; [Text]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text]
</span><span class="hs-identifier hs-var">Text.lines</span></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span>    </span><span class="annot"><span class="annottext">Handle -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.hPutStrLn</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stderr</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; ([[Text]] -&gt; Text) -&gt; [[Text]] -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">Text.unlines</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; ([[Text]] -&gt; [Text]) -&gt; [[Text]] -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[Text]] -&gt; [Text]
forall m. Monoid m =&gt; [m] -&gt; m
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="annot"><span class="annottext">([[Text]] -&gt; IO ()) -&gt; [[Text]] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-118"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Uh oh, an unexpected exception brought the process down! That should never happen. Please file a bug report.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-119"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-120"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Here's a stringy rendering of the exception:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-121"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-122"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621680938758"><span class="hs-identifier hs-var">indented</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680938752"><span class="hs-identifier hs-var">shown</span></a></span><span>
</span><span id="line-123"></span><span>        </span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-124"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680938752"><span class="hs-identifier hs-var">shown</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680938754"><span class="hs-identifier hs-var">displayed</span></a></span><span>
</span><span id="line-125"></span><span>          </span><span class="hs-keyword">then</span><span>
</span><span id="line-126"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;And here's a different one, in case it's easier to understand:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-127"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-128"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621680938758"><span class="hs-identifier hs-var">indented</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680938754"><span class="hs-identifier hs-var">displayed</span></a></span><span>
</span><span id="line-129"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-130"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-131"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. IO a -&gt; IO a
</span><span class="hs-identifier hs-var">withCP65001</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ())
-&gt; ((Scope -&gt; IO ()) -&gt; IO ()) -&gt; (Scope -&gt; IO ()) -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. IO a -&gt; IO a
</span><span class="hs-identifier hs-var">runInUnboundThread</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ())
-&gt; ((Scope -&gt; IO ()) -&gt; IO ()) -&gt; (Scope -&gt; IO ()) -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Scope -&gt; IO ()) -&gt; IO ()
forall a. (Scope -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">Ki.scoped</span></span><span> </span><span class="annot"><span class="annottext">((Scope -&gt; IO ()) -&gt; IO ()) -&gt; (Scope -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680938766"><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680938766"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621680938767"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621680938767"><span class="hs-identifier hs-var">interruptHandler</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IO ())
</span><a href="Compat.html#defaultInterruptHandler"><span class="hs-identifier hs-var">defaultInterruptHandler</span></a></span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a. IO () -&gt; IO a -&gt; IO a
</span><a href="Compat.html#withInterruptHandler"><span class="hs-identifier hs-var">withInterruptHandler</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621680938767"><span class="hs-identifier hs-var">interruptHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-136"></span><span>      </span><span class="annot"><span class="annottext">IO (Thread ()) -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(IO (Thread ()) -&gt; IO ()) -&gt; IO (Thread ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Scope -&gt; IO () -&gt; IO (Thread ())
forall a. Scope -&gt; IO a -&gt; IO (Thread a)
</span><span class="hs-identifier hs-var">Ki.fork</span></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680938766"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; IO ()
</span><a href="Unison.Main.html#initHTTPClient"><span class="hs-identifier hs-var">initHTTPClient</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680938750"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>      </span><span id="local-6989586621680938771"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938771"><span class="hs-identifier hs-var">progName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">getProgName</span></span><span>
</span><span id="line-138"></span><span>      </span><span class="hs-comment">-- hSetBuffering stdout NoBuffering -- cool</span><span>
</span><span id="line-139"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680938772"><span class="annot"><span class="annottext">Maybe String -&gt; String
</span><a href="#local-6989586621680938772"><span class="hs-identifier hs-var">renderUsageInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680938773"><span class="annot"><span class="annottext">GlobalOptions
</span><a href="#local-6989586621680938773"><span class="hs-identifier hs-var">globalOptions</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680938774"><span class="annot"><span class="annottext">Command
</span><a href="#local-6989586621680938774"><span class="hs-identifier hs-var">command</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String
-&gt; String -&gt; IO (Maybe String -&gt; String, GlobalOptions, Command)
</span><a href="ArgParse.html#parseCLIArgs"><span class="hs-identifier hs-var">parseCLIArgs</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938771"><span class="hs-identifier hs-var">progName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; Text
</span><a href="Unison.Version.html#%24sel%3AgitDescribeWithDate%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribeWithDate</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680938750"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>      </span><span id="local-6989586621680938777"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938777"><span class="hs-identifier hs-var">nrtp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; IO String
</span><a href="Unison.Main.html#fixNativeRuntimePath"><span class="hs-identifier hs-var">fixNativeRuntimePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalOptions -&gt; Maybe String
</span><a href="ArgParse.html#%24sel%3AnativeRuntimePath%3AGlobalOptions"><span class="hs-identifier hs-var">nativeRuntimePath</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalOptions
</span><a href="#local-6989586621680938773"><span class="hs-identifier hs-var">globalOptions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="ArgParse.html#GlobalOptions"><span class="hs-identifier hs-type">GlobalOptions</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:codebasePathOption:GlobalOptions :: GlobalOptions -&gt; Maybe CodebasePathOption
</span><a href="ArgParse.html#%24sel%3AcodebasePathOption%3AGlobalOptions"><span class="hs-identifier hs-var">codebasePathOption</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680938781"><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680938781"><span class="hs-identifier hs-var">mCodePathOption</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680938782"><span class="annot"><span class="annottext">ShouldExit
exitOption :: ShouldExit
$sel:exitOption:GlobalOptions :: GlobalOptions -&gt; ShouldExit
</span><a href="#local-6989586621680938782"><span class="hs-identifier hs-var hs-var">exitOption</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680938784"><span class="annot"><span class="annottext">LspFormattingConfig
lspFormattingConfig :: LspFormattingConfig
$sel:lspFormattingConfig:GlobalOptions :: GlobalOptions -&gt; LspFormattingConfig
</span><a href="#local-6989586621680938784"><span class="hs-identifier hs-var hs-var">lspFormattingConfig</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalOptions
</span><a href="#local-6989586621680938773"><span class="hs-identifier hs-var">globalOptions</span></a></span><span>
</span><span id="line-142"></span><span>      </span><span id="local-6989586621680938786"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938786"><span class="hs-identifier hs-var">currentDir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">getCurrentDirectory</span></span><span>
</span><span id="line-143"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Command
</span><a href="#local-6989586621680938774"><span class="hs-identifier hs-var">command</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-144"></span><span>        </span><span class="annot"><span class="annottext">Command
</span><a href="ArgParse.html#PrintVersion"><span class="hs-identifier hs-var">PrintVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-145"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938771"><span class="hs-identifier hs-var">progName</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; version: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Text
</span><a href="Unison.Version.html#%24sel%3AgitDescribeWithDate%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribeWithDate</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680938750"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-146"></span><span>        </span><span class="annot"><span class="annottext">Command
</span><a href="ArgParse.html#Init"><span class="hs-identifier hs-var">Init</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-147"></span><span>          </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var">exitError</span></a></span><span>
</span><span id="line-148"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-149"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;The Init command has been removed&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-150"></span><span>                  </span><span class="annot"><span class="annottext">Pretty ColorText
forall s. IsString s =&gt; Pretty s
</span><span class="hs-identifier hs-var">P.newline</span></span><span class="hs-special">,</span><span>
</span><span id="line-151"></span><span>                  </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Use --codebase-create to create a codebase at a specified location and open it:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-152"></span><span>                  </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><span class="hs-identifier hs-var">P.hiBlue</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;$ ucm --codebase-create myNewCodebase&quot;</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-153"></span><span>                  </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Running UCM without the --codebase-create flag: &quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-154"></span><span>                  </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><span class="hs-identifier hs-var">P.hiBlue</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;$ ucm&quot;</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-155"></span><span>                  </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;will &quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><span class="hs-identifier hs-var">P.bold</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;always&quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot; create a codebase in your home directory if one does not already exist.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-157"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>        </span><span class="annot"><a href="ArgParse.html#Run"><span class="hs-identifier hs-type">Run</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ArgParse.html#RunFromSymbol"><span class="hs-identifier hs-type">RunFromSymbol</span></a></span><span> </span><span id="local-6989586621680938796"><span class="annot"><span class="annottext">ProjectPathNames
</span><a href="#local-6989586621680938796"><span class="hs-identifier hs-var">mainName</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680938797"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621680938797"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-159"></span><span>          </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
-&gt; MigrationStrategy
-&gt; ((InitResult, String, Codebase IO Symbol Ann) -&gt; IO ())
-&gt; IO ()
forall r.
Maybe CodebasePathOption
-&gt; MigrationStrategy
-&gt; ((InitResult, String, Codebase IO Symbol Ann) -&gt; IO r)
-&gt; IO r
</span><a href="Unison.Main.html#getCodebaseOrExit"><span class="hs-identifier hs-var">getCodebaseOrExit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680938781"><span class="hs-identifier hs-var">mCodePathOption</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackupStrategy -&gt; VacuumStrategy -&gt; MigrationStrategy
</span><span class="hs-identifier hs-var">SC.MigrateAutomatically</span></span><span> </span><span class="annot"><span class="annottext">BackupStrategy
</span><span class="hs-identifier hs-var">SC.Backup</span></span><span> </span><span class="annot"><span class="annottext">VacuumStrategy
</span><span class="hs-identifier hs-var">SC.Vacuum</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">InitResult
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680938802"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680938802"><span class="hs-identifier hs-var">theCodebase</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-160"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; RuntimeHost -&gt; Text -&gt; (Runtime Symbol -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a.
MonadUnliftIO m =&gt;
Bool -&gt; RuntimeHost -&gt; Text -&gt; (Runtime Symbol -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">RTI.withRuntime</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">RuntimeHost
</span><span class="hs-identifier hs-var">RTI.OneOff</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; Text
</span><a href="Unison.Version.html#%24sel%3AgitDescribeWithDate%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribeWithDate</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680938750"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680938805"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938805"><span class="hs-identifier hs-var">runtime</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-161"></span><span>              </span><span class="annot"><span class="annottext">[String]
-&gt; IO (Either (Pretty ColorText) ())
-&gt; IO (Either (Pretty ColorText) ())
forall a. [String] -&gt; IO a -&gt; IO a
</span><span class="hs-identifier hs-var">withArgs</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621680938797"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; ProjectPathNames
-&gt; IO (Either (Pretty ColorText) ())
</span><span class="hs-identifier hs-var">execute</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680938802"><span class="hs-identifier hs-var">theCodebase</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938805"><span class="hs-identifier hs-var">runtime</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectPathNames
</span><a href="#local-6989586621680938796"><span class="hs-identifier hs-var">mainName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO (Either (Pretty ColorText) ())
-&gt; (Either (Pretty ColorText) () -&gt; IO ()) -&gt; IO ()
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-162"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680938806"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680938806"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var">exitError</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680938806"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-163"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>        </span><span class="annot"><a href="ArgParse.html#Run"><span class="hs-identifier hs-type">Run</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ArgParse.html#RunFromFile"><span class="hs-identifier hs-type">RunFromFile</span></a></span><span> </span><span id="local-6989586621680938808"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938808"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621680938809"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621680938809"><span class="hs-identifier hs-var">mainName</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680938810"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621680938810"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-165"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Bool
</span><a href="Unison.Main.html#isDotU"><span class="hs-identifier hs-var">isDotU</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938808"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var">exitError</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Files must have a .u extension.&quot;</span></span><span>
</span><span id="line-166"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-167"></span><span>              </span><span id="local-6989586621680938813"><span class="annot"><span class="annottext">Either IOException Text
</span><a href="#local-6989586621680938813"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (Either IOException Text)
</span><span class="hs-identifier hs-var">safeReadUtf8</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938808"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-168"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOException Text
</span><a href="#local-6989586621680938813"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-169"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">IOException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var">exitError</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;I couldn't find that file or it is for some reason unreadable.&quot;</span></span><span>
</span><span id="line-170"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680938815"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680938815"><span class="hs-identifier hs-var">contents</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-171"></span><span>                  </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
-&gt; MigrationStrategy
-&gt; ((InitResult, String, Codebase IO Symbol Ann) -&gt; IO ())
-&gt; IO ()
forall r.
Maybe CodebasePathOption
-&gt; MigrationStrategy
-&gt; ((InitResult, String, Codebase IO Symbol Ann) -&gt; IO r)
-&gt; IO r
</span><a href="Unison.Main.html#getCodebaseOrExit"><span class="hs-identifier hs-var">getCodebaseOrExit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680938781"><span class="hs-identifier hs-var">mCodePathOption</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackupStrategy -&gt; VacuumStrategy -&gt; MigrationStrategy
</span><span class="hs-identifier hs-var">SC.MigrateAutomatically</span></span><span> </span><span class="annot"><span class="annottext">BackupStrategy
</span><span class="hs-identifier hs-var">SC.Backup</span></span><span> </span><span class="annot"><span class="annottext">VacuumStrategy
</span><span class="hs-identifier hs-var">SC.Vacuum</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680938816"><span class="annot"><span class="annottext">InitResult
</span><a href="#local-6989586621680938816"><span class="hs-identifier hs-var">initRes</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680938817"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680938817"><span class="hs-identifier hs-var">theCodebase</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-172"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; RuntimeHost -&gt; (Runtimes -&gt; IO ()) -&gt; IO ()
forall a. String -&gt; RuntimeHost -&gt; (Runtimes -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621680938818"><span class="hs-identifier hs-var">withRuntimes</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938777"><span class="hs-identifier hs-var">nrtp</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeHost
</span><span class="hs-identifier hs-var">RTI.OneOff</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680938819"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938819"><span class="hs-identifier hs-var">rt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680938820"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938820"><span class="hs-identifier hs-var">sbrt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680938821"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938821"><span class="hs-identifier hs-var">nrt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-173"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680938822"><span class="annot"><span class="annottext">fileEvent :: Event
</span><a href="#local-6989586621680938822"><span class="hs-identifier hs-var hs-var">fileEvent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Event
</span><a href="Unison.Codebase.Editor.Input.html#UnisonFileChanged"><span class="hs-identifier hs-var">Input.UnisonFileChanged</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938808"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680938815"><span class="hs-identifier hs-var">contents</span></a></span><span>
</span><span id="line-174"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680938829"><span class="annot"><span class="annottext">noOpCheckForChanges :: p -&gt; f ()
</span><a href="#local-6989586621680938829"><span class="hs-identifier hs-var hs-var">noOpCheckForChanges</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; f ()
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680938830"><span class="annot"><span class="annottext">serverUrl :: Maybe a
</span><a href="#local-6989586621680938830"><span class="hs-identifier hs-var hs-var">serverUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-176"></span><span>                      </span><span id="local-6989586621680938831"><span class="annot"><span class="annottext">ProjectPath
</span><a href="#local-6989586621680938831"><span class="hs-identifier hs-var">startProjectPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Transaction ProjectPath -&gt; IO ProjectPath
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680938817"><span class="hs-identifier hs-var">theCodebase</span></a></span><span> </span><span class="annot"><span class="annottext">Transaction ProjectPath
HasCallStack =&gt; Transaction ProjectPath
</span><span class="hs-identifier hs-var">Codebase.expectCurrentProjectPath</span></span><span>
</span><span id="line-177"></span><span>                      </span><span class="annot"><span class="annottext">Version
-&gt; String
-&gt; Runtime Symbol
-&gt; Runtime Symbol
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; [Either Event Input]
-&gt; Maybe BaseUrl
-&gt; ProjectPathIds
-&gt; InitResult
-&gt; (ProjectPathIds -&gt; IO ())
-&gt; ShouldWatchFiles
-&gt; IO ()
</span><a href="Unison.Main.html#launch"><span class="hs-identifier hs-var">launch</span></a></span><span>
</span><span id="line-178"></span><span>                        </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680938750"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-179"></span><span>                        </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938786"><span class="hs-identifier hs-var">currentDir</span></a></span><span>
</span><span id="line-180"></span><span>                        </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938819"><span class="hs-identifier hs-var">rt</span></a></span><span>
</span><span id="line-181"></span><span>                        </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938820"><span class="hs-identifier hs-var">sbrt</span></a></span><span>
</span><span id="line-182"></span><span>                        </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938821"><span class="hs-identifier hs-var">nrt</span></a></span><span>
</span><span id="line-183"></span><span>                        </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680938817"><span class="hs-identifier hs-var">theCodebase</span></a></span><span>
</span><span id="line-184"></span><span>                        </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Event -&gt; Either Event Input
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Event
</span><a href="#local-6989586621680938822"><span class="hs-identifier hs-var">fileEvent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Either Event Input
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Input -&gt; Either Event Input) -&gt; Input -&gt; Either Event Input
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; [String] -&gt; Input
</span><a href="Unison.Codebase.Editor.Input.html#ExecuteI"><span class="hs-identifier hs-var">Input.ExecuteI</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621680938809"><span class="hs-identifier hs-var">mainName</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621680938810"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Either Event Input
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#QuitI"><span class="hs-identifier hs-var">Input.QuitI</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-185"></span><span>                        </span><span class="annot"><span class="annottext">Maybe BaseUrl
forall a. Maybe a
</span><a href="#local-6989586621680938830"><span class="hs-identifier hs-var">serverUrl</span></a></span><span>
</span><span id="line-186"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjectPath -&gt; ProjectPathIds
</span><span class="hs-identifier hs-var">PP.toIds</span></span><span> </span><span class="annot"><span class="annottext">ProjectPath
</span><a href="#local-6989586621680938831"><span class="hs-identifier hs-var">startProjectPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>                        </span><span class="annot"><span class="annottext">InitResult
</span><a href="#local-6989586621680938816"><span class="hs-identifier hs-var">initRes</span></a></span><span>
</span><span id="line-188"></span><span>                        </span><span class="annot"><span class="annottext">ProjectPathIds -&gt; IO ()
forall {f :: * -&gt; *} {p}. Applicative f =&gt; p -&gt; f ()
</span><a href="#local-6989586621680938829"><span class="hs-identifier hs-var">noOpCheckForChanges</span></a></span><span>
</span><span id="line-189"></span><span>                        </span><span class="annot"><span class="annottext">ShouldWatchFiles
</span><a href="Unison.CommandLine.Types.html#ShouldNotWatchFiles"><span class="hs-identifier hs-var">CommandLine.ShouldNotWatchFiles</span></a></span><span>
</span><span id="line-190"></span><span>        </span><span class="annot"><a href="ArgParse.html#Run"><span class="hs-identifier hs-type">Run</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ArgParse.html#RunFromPipe"><span class="hs-identifier hs-type">RunFromPipe</span></a></span><span> </span><span id="local-6989586621680938840"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621680938840"><span class="hs-identifier hs-var">mainName</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680938841"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621680938841"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-191"></span><span>          </span><span id="local-6989586621680938842"><span class="annot"><span class="annottext">Either IOException Text
</span><a href="#local-6989586621680938842"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either IOException Text)
</span><span class="hs-identifier hs-var">safeReadUtf8StdIn</span></span><span>
</span><span id="line-192"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOException Text
</span><a href="#local-6989586621680938842"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-193"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">IOException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var">exitError</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;I had trouble reading this input.&quot;</span></span><span>
</span><span id="line-194"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680938844"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680938844"><span class="hs-identifier hs-var">contents</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-195"></span><span>              </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
-&gt; MigrationStrategy
-&gt; ((InitResult, String, Codebase IO Symbol Ann) -&gt; IO ())
-&gt; IO ()
forall r.
Maybe CodebasePathOption
-&gt; MigrationStrategy
-&gt; ((InitResult, String, Codebase IO Symbol Ann) -&gt; IO r)
-&gt; IO r
</span><a href="Unison.Main.html#getCodebaseOrExit"><span class="hs-identifier hs-var">getCodebaseOrExit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680938781"><span class="hs-identifier hs-var">mCodePathOption</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackupStrategy -&gt; VacuumStrategy -&gt; MigrationStrategy
</span><span class="hs-identifier hs-var">SC.MigrateAutomatically</span></span><span> </span><span class="annot"><span class="annottext">BackupStrategy
</span><span class="hs-identifier hs-var">SC.Backup</span></span><span> </span><span class="annot"><span class="annottext">VacuumStrategy
</span><span class="hs-identifier hs-var">SC.Vacuum</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680938845"><span class="annot"><span class="annottext">InitResult
</span><a href="#local-6989586621680938845"><span class="hs-identifier hs-var">initRes</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680938846"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680938846"><span class="hs-identifier hs-var">theCodebase</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-196"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; RuntimeHost -&gt; (Runtimes -&gt; IO ()) -&gt; IO ()
forall a. String -&gt; RuntimeHost -&gt; (Runtimes -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621680938818"><span class="hs-identifier hs-var">withRuntimes</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938777"><span class="hs-identifier hs-var">nrtp</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeHost
</span><span class="hs-identifier hs-var">RTI.OneOff</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680938847"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938847"><span class="hs-identifier hs-var">rt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680938848"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938848"><span class="hs-identifier hs-var">sbrt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680938849"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938849"><span class="hs-identifier hs-var">nrt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-197"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680938850"><span class="annot"><span class="annottext">fileEvent :: Event
</span><a href="#local-6989586621680938850"><span class="hs-identifier hs-var hs-var">fileEvent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Event
</span><a href="Unison.Codebase.Editor.Input.html#UnisonFileChanged"><span class="hs-identifier hs-var">Input.UnisonFileChanged</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;standard input&gt;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680938844"><span class="hs-identifier hs-var">contents</span></a></span><span>
</span><span id="line-198"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680938855"><span class="annot"><span class="annottext">noOpCheckForChanges :: p -&gt; f ()
</span><a href="#local-6989586621680938855"><span class="hs-identifier hs-var hs-var">noOpCheckForChanges</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; f ()
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680938856"><span class="annot"><span class="annottext">serverUrl :: Maybe a
</span><a href="#local-6989586621680938856"><span class="hs-identifier hs-var hs-var">serverUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-200"></span><span>                  </span><span id="local-6989586621680938857"><span class="annot"><span class="annottext">ProjectPath
</span><a href="#local-6989586621680938857"><span class="hs-identifier hs-var">startProjectPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Transaction ProjectPath -&gt; IO ProjectPath
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680938846"><span class="hs-identifier hs-var">theCodebase</span></a></span><span> </span><span class="annot"><span class="annottext">Transaction ProjectPath
HasCallStack =&gt; Transaction ProjectPath
</span><span class="hs-identifier hs-var">Codebase.expectCurrentProjectPath</span></span><span>
</span><span id="line-201"></span><span>                  </span><span class="annot"><span class="annottext">Version
-&gt; String
-&gt; Runtime Symbol
-&gt; Runtime Symbol
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; [Either Event Input]
-&gt; Maybe BaseUrl
-&gt; ProjectPathIds
-&gt; InitResult
-&gt; (ProjectPathIds -&gt; IO ())
-&gt; ShouldWatchFiles
-&gt; IO ()
</span><a href="Unison.Main.html#launch"><span class="hs-identifier hs-var">launch</span></a></span><span>
</span><span id="line-202"></span><span>                    </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680938750"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-203"></span><span>                    </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938786"><span class="hs-identifier hs-var">currentDir</span></a></span><span>
</span><span id="line-204"></span><span>                    </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938847"><span class="hs-identifier hs-var">rt</span></a></span><span>
</span><span id="line-205"></span><span>                    </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938848"><span class="hs-identifier hs-var">sbrt</span></a></span><span>
</span><span id="line-206"></span><span>                    </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938849"><span class="hs-identifier hs-var">nrt</span></a></span><span>
</span><span id="line-207"></span><span>                    </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680938846"><span class="hs-identifier hs-var">theCodebase</span></a></span><span>
</span><span id="line-208"></span><span>                    </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Event -&gt; Either Event Input
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Event
</span><a href="#local-6989586621680938850"><span class="hs-identifier hs-var">fileEvent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Either Event Input
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Input -&gt; Either Event Input) -&gt; Input -&gt; Either Event Input
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; [String] -&gt; Input
</span><a href="Unison.Codebase.Editor.Input.html#ExecuteI"><span class="hs-identifier hs-var">Input.ExecuteI</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621680938840"><span class="hs-identifier hs-var">mainName</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621680938841"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Either Event Input
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#QuitI"><span class="hs-identifier hs-var">Input.QuitI</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-209"></span><span>                    </span><span class="annot"><span class="annottext">Maybe BaseUrl
forall a. Maybe a
</span><a href="#local-6989586621680938856"><span class="hs-identifier hs-var">serverUrl</span></a></span><span>
</span><span id="line-210"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjectPath -&gt; ProjectPathIds
</span><span class="hs-identifier hs-var">PP.toIds</span></span><span> </span><span class="annot"><span class="annottext">ProjectPath
</span><a href="#local-6989586621680938857"><span class="hs-identifier hs-var">startProjectPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>                    </span><span class="annot"><span class="annottext">InitResult
</span><a href="#local-6989586621680938845"><span class="hs-identifier hs-var">initRes</span></a></span><span>
</span><span id="line-212"></span><span>                    </span><span class="annot"><span class="annottext">ProjectPathIds -&gt; IO ()
forall {f :: * -&gt; *} {p}. Applicative f =&gt; p -&gt; f ()
</span><a href="#local-6989586621680938855"><span class="hs-identifier hs-var">noOpCheckForChanges</span></a></span><span>
</span><span id="line-213"></span><span>                    </span><span class="annot"><span class="annottext">ShouldWatchFiles
</span><a href="Unison.CommandLine.Types.html#ShouldNotWatchFiles"><span class="hs-identifier hs-var">CommandLine.ShouldNotWatchFiles</span></a></span><span>
</span><span id="line-214"></span><span>        </span><span class="annot"><a href="ArgParse.html#Run"><span class="hs-identifier hs-type">Run</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ArgParse.html#RunCompiled"><span class="hs-identifier hs-type">RunCompiled</span></a></span><span> </span><span id="local-6989586621680938859"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938859"><span class="hs-identifier hs-var">file</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680938860"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621680938860"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-215"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; IO ByteString
</span><span class="hs-identifier hs-var">BL.readFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938859"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">IO ByteString -&gt; (ByteString -&gt; IO ()) -&gt; IO ()
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680938862"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680938862"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-216"></span><span>            </span><span class="annot"><span class="annottext">IO (Either String (Text, Text, CombIx, StoredCache))
-&gt; IO
     (Either
        RuntimeExn (Either String (Text, Text, CombIx, StoredCache)))
forall (m :: * -&gt; *) e a.
(MonadUnliftIO m, Exception e) =&gt;
m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">try</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either String (Text, Text, CombIx, StoredCache)
-&gt; IO (Either String (Text, Text, CombIx, StoredCache))
forall a. a -&gt; IO a
</span><span class="hs-identifier hs-var">evaluate</span></span><span> </span><span class="annot"><span class="annottext">(Either String (Text, Text, CombIx, StoredCache)
 -&gt; IO (Either String (Text, Text, CombIx, StoredCache)))
-&gt; Either String (Text, Text, CombIx, StoredCache)
-&gt; IO (Either String (Text, Text, CombIx, StoredCache))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either String (Text, Text, CombIx, StoredCache)
</span><span class="hs-identifier hs-var">RTI.decodeStandalone</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680938862"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO
  (Either
     RuntimeExn (Either String (Text, Text, CombIx, StoredCache)))
-&gt; (Either
      RuntimeExn (Either String (Text, Text, CombIx, StoredCache))
    -&gt; IO ())
-&gt; IO ()
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-217"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PE</span></span><span> </span><span id="local-6989586621680938866"><span class="annot"><span class="annottext">CallStack
</span><a href="#local-6989586621680938866"><span class="hs-identifier hs-var">_cs</span></a></span></span><span> </span><span id="local-6989586621680938867"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680938867"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-218"></span><span>                </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var">exitError</span></a></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; IO ())
-&gt; ([Pretty ColorText] -&gt; Pretty ColorText)
-&gt; [Pretty ColorText]
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span> </span><span class="annot"><span class="annottext">([Pretty ColorText] -&gt; IO ()) -&gt; [Pretty ColorText] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-219"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Pretty ColorText)
-&gt; (Text -&gt; Pretty ColorText) -&gt; Text -&gt; Pretty ColorText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Pretty ColorText
forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Pretty ColorText) -&gt; Text -&gt; Pretty ColorText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-220"></span><span>                      </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I was unable to parse this file as a compiled\
                      \ program. The parser generated the following error:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-222"></span><span>                    </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-223"></span><span>                    </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Pretty ColorText)
-&gt; Pretty ColorText -&gt; Pretty ColorText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680938867"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-224"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-225"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680938869"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938869"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-226"></span><span>                </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var">exitError</span></a></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; IO ())
-&gt; ([Pretty ColorText] -&gt; Pretty ColorText)
-&gt; [Pretty ColorText]
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span> </span><span class="annot"><span class="annottext">([Pretty ColorText] -&gt; IO ()) -&gt; [Pretty ColorText] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-227"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Pretty ColorText)
-&gt; (Text -&gt; Pretty ColorText) -&gt; Text -&gt; Pretty ColorText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Pretty ColorText
forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Pretty ColorText) -&gt; Text -&gt; Pretty ColorText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-228"></span><span>                      </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I was unable to parse this file as a compiled\
                      \ program. The parser generated the following error:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-230"></span><span>                    </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-231"></span><span>                    </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Pretty ColorText)
-&gt; (Pretty ColorText -&gt; Pretty ColorText)
-&gt; Pretty ColorText
-&gt; Pretty ColorText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Pretty ColorText)
-&gt; Pretty ColorText -&gt; Pretty ColorText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Pretty ColorText
forall s. IsString s =&gt; String -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938869"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-232"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-233"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">RuntimeExn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-234"></span><span>                </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var">exitError</span></a></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; IO ())
-&gt; (Text -&gt; Pretty ColorText) -&gt; Text -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Pretty ColorText)
-&gt; (Text -&gt; Pretty ColorText) -&gt; Text -&gt; Pretty ColorText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Pretty ColorText
forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-235"></span><span>                  </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I was unable to parse this file as a compiled\
                  \ program. The parser generated an unrecognized error.&quot;</span></span><span>
</span><span id="line-237"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680938871"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680938871"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680938872"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680938872"><span class="hs-identifier hs-var">rf</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680938873"><span class="annot"><span class="annottext">CombIx
</span><a href="#local-6989586621680938873"><span class="hs-identifier hs-var">combIx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680938874"><span class="annot"><span class="annottext">StoredCache
</span><a href="#local-6989586621680938874"><span class="hs-identifier hs-var">sto</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680938875"><span class="hs-identifier hs-var">vmatch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621680938876"><span class="hs-identifier hs-var">mismatchMsg</span></a></span><span>
</span><span id="line-239"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-240"></span><span>                    </span><span class="annot"><span class="annottext">[String]
-&gt; IO (Either (Pretty ColorText) ())
-&gt; IO (Either (Pretty ColorText) ())
forall a. [String] -&gt; IO a -&gt; IO a
</span><span class="hs-identifier hs-var">withArgs</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621680938860"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StoredCache -&gt; CombIx -&gt; IO (Either (Pretty ColorText) ())
</span><span class="hs-identifier hs-var">RTI.runStandalone</span></span><span> </span><span class="annot"><span class="annottext">StoredCache
</span><a href="#local-6989586621680938874"><span class="hs-identifier hs-var">sto</span></a></span><span> </span><span class="annot"><span class="annottext">CombIx
</span><a href="#local-6989586621680938873"><span class="hs-identifier hs-var">combIx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO (Either (Pretty ColorText) ())
-&gt; (Either (Pretty ColorText) () -&gt; IO ()) -&gt; IO ()
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-241"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680938878"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680938878"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var">exitError</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680938878"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-242"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>                </span><span class="hs-keyword">where</span><span>
</span><span id="line-244"></span><span>                  </span><span id="local-6989586621680938875"><span class="annot"><span class="annottext">vmatch :: Bool
</span><a href="#local-6989586621680938875"><span class="hs-identifier hs-var hs-var">vmatch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680938871"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Text
</span><a href="Unison.Version.html#%24sel%3AgitDescribeWithDate%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribeWithDate</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680938750"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-245"></span><span>                  </span><span id="local-6989586621680938899"><span class="annot"><span class="annottext">ws :: Text -&gt; Pretty s
</span><a href="#local-6989586621680938899"><span class="hs-identifier hs-var hs-var">ws</span></a></span></span><span> </span><span id="local-6989586621680938900"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680938900"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pretty s -&gt; Pretty s
forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Pretty s
forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680938900"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>                  </span><span id="local-6989586621680938901"><span class="annot"><span class="annottext">ifile :: String
</span><a href="#local-6989586621680938901"><span class="hs-identifier hs-var hs-var">ifile</span></a></span></span><span>
</span><span id="line-247"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'c'</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'u'</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680938902"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938902"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938859"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938902"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-248"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938859"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-249"></span><span>                  </span><span id="local-6989586621680938876"><span class="annot"><span class="annottext">mismatchMsg :: IO ()
</span><a href="#local-6989586621680938876"><span class="hs-identifier hs-var hs-var">mismatchMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-250"></span><span>                    </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; IO ())
-&gt; ([Pretty ColorText] -&gt; Pretty ColorText)
-&gt; [Pretty ColorText]
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span> </span><span class="annot"><span class="annottext">([Pretty ColorText] -&gt; IO ()) -&gt; [Pretty ColorText] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-251"></span><span>                      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Pretty ColorText
forall {s}.
(Item s ~ Char, ListLike s Char, IsString s) =&gt;
Text -&gt; Pretty s
</span><a href="#local-6989586621680938899"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-252"></span><span>                          </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I can't run this compiled program since \
                          \it works with a different version of Unison \
                          \than the one you're running.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-255"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-256"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Compiled file version&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-257"></span><span>                        </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Pretty ColorText)
-&gt; Pretty ColorText -&gt; Pretty ColorText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Pretty ColorText
forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680938871"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-258"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-259"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Your version&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-260"></span><span>                        </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Pretty ColorText)
-&gt; Pretty ColorText -&gt; Pretty ColorText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Pretty ColorText
forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Pretty ColorText) -&gt; Text -&gt; Pretty ColorText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Text
</span><a href="Unison.Version.html#%24sel%3AgitDescribeWithDate%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribeWithDate</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680938750"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-261"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-262"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Pretty ColorText)
-&gt; Pretty ColorText -&gt; Pretty ColorText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-263"></span><span>                          </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;The program was compiled from hash &quot;</span></span><span>
</span><span id="line-264"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Pretty ColorText
forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Pretty ColorText) -&gt; Text -&gt; Pretty ColorText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;`&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680938872"><span class="hs-identifier hs-var">rf</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;`.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;If you have that hash in your codebase,&quot;</span></span><span>
</span><span id="line-266"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;you can do:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-267"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-268"></span><span>                        </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Pretty ColorText)
-&gt; Pretty ColorText -&gt; Pretty ColorText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-269"></span><span>                          </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;.&gt; compile &quot;</span></span><span>
</span><span id="line-270"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Pretty ColorText
forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680938872"><span class="hs-identifier hs-var">rf</span></a></span><span>
</span><span id="line-271"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-272"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Pretty ColorText
forall s. IsString s =&gt; String -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938901"><span class="hs-identifier hs-var">ifile</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-273"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-274"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span>
</span><span id="line-275"></span><span>                          </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;to produce a new compiled program \
                          \that matches your version of Unison.&quot;</span></span><span>
</span><span id="line-277"></span><span>                      </span><span class="hs-special">]</span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><a href="ArgParse.html#Transcript"><span class="hs-identifier hs-type">Transcript</span></a></span><span> </span><span id="local-6989586621680938905"><span class="annot"><span class="annottext">ShouldForkCodebase
</span><a href="#local-6989586621680938905"><span class="hs-identifier hs-var">shouldFork</span></a></span></span><span> </span><span id="local-6989586621680938906"><span class="annot"><span class="annottext">ShouldSaveCodebase
</span><a href="#local-6989586621680938906"><span class="hs-identifier hs-var">shouldSaveCodebase</span></a></span></span><span> </span><span id="local-6989586621680938907"><span class="annot"><span class="annottext">Maybe RtsStatsPath
</span><a href="#local-6989586621680938907"><span class="hs-identifier hs-var">mrtsStatsFp</span></a></span></span><span> </span><span id="local-6989586621680938908"><span class="annot"><span class="annottext">NonEmpty String
</span><a href="#local-6989586621680938908"><span class="hs-identifier hs-var">transcriptFiles</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-279"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680938909"><span class="annot"><span class="annottext">action :: IO ()
</span><a href="#local-6989586621680938909"><span class="hs-identifier hs-var hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Version
-&gt; Verbosity
-&gt; (Maybe String -&gt; String)
-&gt; ShouldForkCodebase
-&gt; ShouldSaveCodebase
-&gt; Maybe CodebasePathOption
-&gt; String
-&gt; NonEmpty String
-&gt; IO ()
</span><a href="Unison.Main.html#runTranscripts"><span class="hs-identifier hs-var">runTranscripts</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680938750"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><span class="hs-identifier hs-var">Verbosity.Verbose</span></span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; String
</span><a href="#local-6989586621680938772"><span class="hs-identifier hs-var">renderUsageInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ShouldForkCodebase
</span><a href="#local-6989586621680938905"><span class="hs-identifier hs-var">shouldFork</span></a></span><span> </span><span class="annot"><span class="annottext">ShouldSaveCodebase
</span><a href="#local-6989586621680938906"><span class="hs-identifier hs-var">shouldSaveCodebase</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680938781"><span class="hs-identifier hs-var">mCodePathOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938777"><span class="hs-identifier hs-var">nrtp</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty String
</span><a href="#local-6989586621680938908"><span class="hs-identifier hs-var">transcriptFiles</span></a></span><span>
</span><span id="line-280"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe RtsStatsPath
</span><a href="#local-6989586621680938907"><span class="hs-identifier hs-var">mrtsStatsFp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-281"></span><span>            </span><span class="annot"><span class="annottext">Maybe RtsStatsPath
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621680938909"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-282"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680938912"><span class="annot"><span class="annottext">RtsStatsPath
</span><a href="#local-6989586621680938912"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RtsStatsPath -&gt; IO () -&gt; IO ()
forall a. RtsStatsPath -&gt; IO a -&gt; IO a
</span><a href="Stats.html#recordRtsStats"><span class="hs-identifier hs-var">recordRtsStats</span></a></span><span> </span><span class="annot"><span class="annottext">RtsStatsPath
</span><a href="#local-6989586621680938912"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621680938909"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-283"></span><span>        </span><span class="annot"><a href="ArgParse.html#Launch"><span class="hs-identifier hs-type">Launch</span></a></span><span> </span><span id="local-6989586621680938913"><span class="annot"><span class="annottext">IsHeadless
</span><a href="#local-6989586621680938913"><span class="hs-identifier hs-var">isHeadless</span></a></span></span><span> </span><span id="local-6989586621680938914"><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621680938914"><span class="hs-identifier hs-var">codebaseServerOpts</span></a></span></span><span> </span><span id="local-6989586621680938915"><span class="annot"><span class="annottext">Maybe (ProjectAndBranch ProjectName ProjectBranchName)
</span><a href="#local-6989586621680938915"><span class="hs-identifier hs-var">mayStartingProject</span></a></span></span><span> </span><span id="local-6989586621680938916"><span class="annot"><span class="annottext">ShouldWatchFiles
</span><a href="#local-6989586621680938916"><span class="hs-identifier hs-var">shouldWatchFiles</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-284"></span><span>          </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
-&gt; MigrationStrategy
-&gt; ((InitResult, String, Codebase IO Symbol Ann) -&gt; IO ())
-&gt; IO ()
forall r.
Maybe CodebasePathOption
-&gt; MigrationStrategy
-&gt; ((InitResult, String, Codebase IO Symbol Ann) -&gt; IO r)
-&gt; IO r
</span><a href="Unison.Main.html#getCodebaseOrExit"><span class="hs-identifier hs-var">getCodebaseOrExit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680938781"><span class="hs-identifier hs-var">mCodePathOption</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackupStrategy -&gt; VacuumStrategy -&gt; MigrationStrategy
</span><span class="hs-identifier hs-var">SC.MigrateAfterPrompt</span></span><span> </span><span class="annot"><span class="annottext">BackupStrategy
</span><span class="hs-identifier hs-var">SC.Backup</span></span><span> </span><span class="annot"><span class="annottext">VacuumStrategy
</span><span class="hs-identifier hs-var">SC.Vacuum</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680938918"><span class="annot"><span class="annottext">InitResult
</span><a href="#local-6989586621680938918"><span class="hs-identifier hs-var">initRes</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680938919"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680938919"><span class="hs-identifier hs-var">theCodebase</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-285"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; RuntimeHost -&gt; (Runtimes -&gt; IO ()) -&gt; IO ()
forall a. String -&gt; RuntimeHost -&gt; (Runtimes -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621680938818"><span class="hs-identifier hs-var">withRuntimes</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938777"><span class="hs-identifier hs-var">nrtp</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeHost
</span><span class="hs-identifier hs-var">RTI.Persistent</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680938921"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938921"><span class="hs-identifier hs-var">runtime</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680938922"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938922"><span class="hs-identifier hs-var">sbRuntime</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680938923"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938923"><span class="hs-identifier hs-var">nRuntime</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-286"></span><span>              </span><span id="local-6989586621680938924"><span class="annot"><span class="annottext">ProjectPath
</span><a href="#local-6989586621680938924"><span class="hs-identifier hs-var">startingProjectPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-287"></span><span>                </span><span class="hs-comment">-- If the user didn't provide a starting path on the command line, put them in the most recent</span><span>
</span><span id="line-288"></span><span>                </span><span class="hs-comment">-- path they cd'd to</span><span>
</span><span id="line-289"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (ProjectAndBranch ProjectName ProjectBranchName)
</span><a href="#local-6989586621680938915"><span class="hs-identifier hs-var">mayStartingProject</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-290"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680938925"><span class="annot"><span class="annottext">ProjectAndBranch ProjectName ProjectBranchName
</span><a href="#local-6989586621680938925"><span class="hs-identifier hs-var">startingProject</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-291"></span><span>                    </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Transaction (Maybe (ProjectAndBranch Project ProjectBranch))
-&gt; IO (Maybe (ProjectAndBranch Project ProjectBranch))
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680938919"><span class="hs-identifier hs-var">theCodebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjectAndBranch ProjectName ProjectBranchName
-&gt; Transaction (Maybe (ProjectAndBranch Project ProjectBranch))
</span><a href="Unison.Cli.ProjectUtils.html#getProjectAndBranchByNames"><span class="hs-identifier hs-var">ProjectUtils.getProjectAndBranchByNames</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch ProjectName ProjectBranchName
</span><a href="#local-6989586621680938925"><span class="hs-identifier hs-var">startingProject</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO (Maybe (ProjectAndBranch Project ProjectBranch))
-&gt; (Maybe (ProjectAndBranch Project ProjectBranch)
    -&gt; IO ProjectPath)
-&gt; IO ProjectPath
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-292"></span><span>                      </span><span class="annot"><span class="annottext">Maybe (ProjectAndBranch Project ProjectBranch)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-293"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; IO ()) -&gt; Pretty ColorText -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-294"></span><span>                          </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Pretty s -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.callout</span></span><span>
</span><span id="line-295"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&#10067;&quot;</span></span><span>
</span><span id="line-296"></span><span>                            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-297"></span><span>                                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;I couldn't find the project branch: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Pretty ColorText
forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall target source. From source target =&gt; source -&gt; target
</span><span class="hs-identifier hs-var">into</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch ProjectName ProjectBranchName
</span><a href="#local-6989586621680938925"><span class="hs-identifier hs-var">startingProject</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>                                </span><span class="hs-special">]</span><span>
</span><span id="line-299"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>                        </span><span class="annot"><span class="annottext">IO ProjectPath
forall a. IO a
</span><span class="hs-identifier hs-var">System.exitFailure</span></span><span>
</span><span id="line-301"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680938930"><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch
</span><a href="#local-6989586621680938930"><span class="hs-identifier hs-var">pab</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-302"></span><span>                        </span><span class="annot"><span class="annottext">ProjectPath -&gt; IO ProjectPath
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ProjectPath -&gt; IO ProjectPath) -&gt; ProjectPath -&gt; IO ProjectPath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch -&gt; Absolute -&gt; ProjectPath
</span><span class="hs-identifier hs-var">PP.fromProjectAndBranch</span></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch
</span><a href="#local-6989586621680938930"><span class="hs-identifier hs-var">pab</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><span class="hs-identifier hs-var">Path.absoluteEmpty</span></span><span>
</span><span id="line-303"></span><span>                  </span><span class="annot"><span class="annottext">Maybe (ProjectAndBranch ProjectName ProjectBranchName)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-304"></span><span>                    </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Transaction ProjectPath -&gt; IO ProjectPath
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680938919"><span class="hs-identifier hs-var">theCodebase</span></a></span><span> </span><span class="annot"><span class="annottext">Transaction ProjectPath
HasCallStack =&gt; Transaction ProjectPath
</span><span class="hs-identifier hs-var">Codebase.expectCurrentProjectPath</span></span><span>
</span><span id="line-305"></span><span>              </span><span id="local-6989586621680938933"><span class="annot"><span class="annottext">ProjectPathIds
</span><a href="#local-6989586621680938933"><span class="hs-identifier hs-var">currentPP</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Transaction ProjectPathIds -&gt; IO ProjectPathIds
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680938919"><span class="hs-identifier hs-var">theCodebase</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-306"></span><span>                </span><span class="annot"><span class="annottext">ProjectPath -&gt; ProjectPathIds
</span><span class="hs-identifier hs-var">PP.toIds</span></span><span> </span><span class="annot"><span class="annottext">(ProjectPath -&gt; ProjectPathIds)
-&gt; Transaction ProjectPath -&gt; Transaction ProjectPathIds
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Transaction ProjectPath
HasCallStack =&gt; Transaction ProjectPath
</span><span class="hs-identifier hs-var">Codebase.expectCurrentProjectPath</span></span><span>
</span><span id="line-307"></span><span>              </span><span id="local-6989586621680938935"><span class="annot"><span class="annottext">Signal ProjectPathIds
</span><a href="#local-6989586621680938935"><span class="hs-identifier hs-var">changeSignal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ProjectPathIds -&gt; IO (Signal ProjectPathIds)
forall (m :: * -&gt; *) a. MonadIO m =&gt; Maybe a -&gt; m (Signal a)
</span><a href="Unison.LSP.Util.Signal.html#newSignalIO"><span class="hs-identifier hs-var">Signal.newSignalIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjectPathIds -&gt; Maybe ProjectPathIds
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ProjectPathIds
</span><a href="#local-6989586621680938933"><span class="hs-identifier hs-var">currentPP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680938937"><span class="annot"><span class="annottext">lspCheckForChanges :: ProjectPathIds -&gt; IO ()
</span><a href="#local-6989586621680938937"><span class="hs-identifier hs-var hs-var">lspCheckForChanges</span></a></span></span><span> </span><span id="local-6989586621680938938"><span class="annot"><span class="annottext">ProjectPathIds
</span><a href="#local-6989586621680938938"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Signal ProjectPathIds -&gt; ProjectPathIds -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; Signal a -&gt; a -&gt; m ()
</span><a href="Unison.LSP.Util.Signal.html#writeSignalIO"><span class="hs-identifier hs-var">Signal.writeSignalIO</span></a></span><span> </span><span class="annot"><span class="annottext">Signal ProjectPathIds
</span><a href="#local-6989586621680938935"><span class="hs-identifier hs-var">changeSignal</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectPathIds
</span><a href="#local-6989586621680938938"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-309"></span><span>              </span><span class="hs-comment">-- Unfortunately, the windows IO manager on GHC 8.* is prone to just hanging forever</span><span>
</span><span id="line-310"></span><span>              </span><span class="hs-comment">-- when waiting for input on handles, so if we listen for LSP connections it will</span><span>
</span><span id="line-311"></span><span>              </span><span class="hs-comment">-- prevent UCM from shutting down properly. Hopefully we can re-enable LSP on</span><span>
</span><span id="line-312"></span><span>              </span><span class="hs-comment">-- Windows when we move to GHC 9.*</span><span>
</span><span id="line-313"></span><span>              </span><span class="hs-comment">-- https://gitlab.haskell.org/ghc/ghc/-/merge_requests/1224</span><span>
</span><span id="line-314"></span><span>              </span><span class="annot"><span class="annottext">IO (Thread ()) -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(IO (Thread ()) -&gt; IO ())
-&gt; (IO () -&gt; IO (Thread ())) -&gt; IO () -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Scope -&gt; IO () -&gt; IO (Thread ())
forall a. Scope -&gt; IO a -&gt; IO (Thread a)
</span><span class="hs-identifier hs-var">Ki.fork</span></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680938766"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LspFormattingConfig
-&gt; Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; Signal ProjectPathIds
-&gt; IO ()
</span><a href="Unison.LSP.html#spawnLsp"><span class="hs-identifier hs-var">LSP.spawnLsp</span></a></span><span> </span><span class="annot"><span class="annottext">LspFormattingConfig
</span><a href="#local-6989586621680938784"><span class="hs-identifier hs-var">lspFormattingConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680938919"><span class="hs-identifier hs-var">theCodebase</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938921"><span class="hs-identifier hs-var">runtime</span></a></span><span> </span><span class="annot"><span class="annottext">Signal ProjectPathIds
</span><a href="#local-6989586621680938935"><span class="hs-identifier hs-var">changeSignal</span></a></span><span>
</span><span id="line-315"></span><span>              </span><span class="annot"><span class="annottext">BackendEnv
-&gt; CodebaseServerOpts
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; (BaseUrl -&gt; IO ())
-&gt; IO ()
forall a.
BackendEnv
-&gt; CodebaseServerOpts
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; (BaseUrl -&gt; IO a)
-&gt; IO a
</span><span class="hs-identifier hs-var">Server.startServer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Backend.BackendEnv</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:useNamesIndex:BackendEnv :: Bool
</span><span class="hs-identifier hs-var">Backend.useNamesIndex</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621680938914"><span class="hs-identifier hs-var">codebaseServerOpts</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938922"><span class="hs-identifier hs-var">sbRuntime</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680938919"><span class="hs-identifier hs-var">theCodebase</span></a></span><span> </span><span class="annot"><span class="annottext">((BaseUrl -&gt; IO ()) -&gt; IO ()) -&gt; (BaseUrl -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680938944"><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621680938944"><span class="hs-identifier hs-var">baseUrl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-316"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ShouldExit
</span><a href="#local-6989586621680938782"><span class="hs-identifier hs-var">exitOption</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-317"></span><span>                  </span><span class="annot"><span class="annottext">ShouldExit
</span><a href="ArgParse.html#DoNotExit"><span class="hs-identifier hs-var">DoNotExit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-318"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IsHeadless
</span><a href="#local-6989586621680938913"><span class="hs-identifier hs-var">isHeadless</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-319"></span><span>                      </span><span class="annot"><span class="annottext">IsHeadless
</span><a href="ArgParse.html#Headless"><span class="hs-identifier hs-var">Headless</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-320"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; IO ()) -&gt; Pretty ColorText -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-321"></span><span>                          </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-322"></span><span>                            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;I've started the Codebase API server at&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-323"></span><span>                              </span><span class="annot"><span class="annottext">Text -&gt; Pretty ColorText
forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Pretty ColorText) -&gt; Text -&gt; Pretty ColorText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Service -&gt; BaseUrl -&gt; Text
</span><span class="hs-identifier hs-var">Server.urlFor</span></span><span> </span><span class="annot"><span class="annottext">Service
</span><span class="hs-identifier hs-var">Server.Api</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621680938944"><span class="hs-identifier hs-var">baseUrl</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-324"></span><span>                              </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;and the Codebase UI at&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-325"></span><span>                              </span><span class="annot"><span class="annottext">Text -&gt; Pretty ColorText
forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Pretty ColorText) -&gt; Text -&gt; Pretty ColorText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Service -&gt; BaseUrl -&gt; Text
</span><span class="hs-identifier hs-var">Server.urlFor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjectAndBranch ProjectName ProjectBranchName
-&gt; Absolute -&gt; Maybe DefinitionReference -&gt; Service
</span><span class="hs-identifier hs-var">Server.ProjectBranchUI</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjectName
-&gt; ProjectBranchName
-&gt; ProjectAndBranch ProjectName ProjectBranchName
forall a b. a -&gt; b -&gt; ProjectAndBranch a b
</span><span class="hs-identifier hs-var">ProjectAndBranch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; ProjectName
</span><span class="hs-identifier hs-var">UnsafeProjectName</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;scratch&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; ProjectBranchName
</span><span class="hs-identifier hs-var">UnsafeProjectBranchName</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;main&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Absolute
</span><span class="hs-identifier hs-var">Path.absoluteEmpty</span></span><span> </span><span class="annot"><span class="annottext">Maybe DefinitionReference
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621680938944"><span class="hs-identifier hs-var">baseUrl</span></a></span><span>
</span><span id="line-326"></span><span>                            </span><span class="hs-special">]</span><span>
</span><span id="line-327"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; IO ()) -&gt; Pretty ColorText -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-328"></span><span>                          </span><span class="annot"><span class="annottext">String -&gt; Pretty ColorText
forall s. IsString s =&gt; String -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Running the codebase manager headless with &quot;</span></span><span>
</span><span id="line-329"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Pretty ColorText
forall a s. (Show a, IsString s) =&gt; a -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.shown</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier hs-var">GHC.Conc.numCapabilities</span></span><span>
</span><span id="line-330"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-331"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a b. Integral a =&gt; a -&gt; b -&gt; b -&gt; b
</span><a href="Unison.CommandLine.Helpers.html#plural%27"><span class="hs-identifier hs-var">plural'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier hs-var">GHC.Conc.numCapabilities</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;cpu&quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;cpus&quot;</span></span><span>
</span><span id="line-332"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-333"></span><span>                        </span><span id="local-6989586621680938953"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621680938953"><span class="hs-identifier hs-var">mvar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar ())
forall a. IO (MVar a)
</span><span class="hs-identifier hs-var">newEmptyMVar</span></span><span>
</span><span id="line-334"></span><span>                        </span><span class="annot"><span class="annottext">MVar () -&gt; IO ()
forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">takeMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621680938953"><span class="hs-identifier hs-var">mvar</span></a></span><span>
</span><span id="line-335"></span><span>                      </span><span class="annot"><span class="annottext">IsHeadless
</span><a href="ArgParse.html#WithCLI"><span class="hs-identifier hs-var">WithCLI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-336"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; IO ()) -&gt; Pretty ColorText -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Pretty ColorText
forall s. IsString s =&gt; String -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Now starting the Unison Codebase Manager (UCM)...&quot;</span></span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span>                        </span><span class="annot"><span class="annottext">Version
-&gt; String
-&gt; Runtime Symbol
-&gt; Runtime Symbol
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; [Either Event Input]
-&gt; Maybe BaseUrl
-&gt; ProjectPathIds
-&gt; InitResult
-&gt; (ProjectPathIds -&gt; IO ())
-&gt; ShouldWatchFiles
-&gt; IO ()
</span><a href="Unison.Main.html#launch"><span class="hs-identifier hs-var">launch</span></a></span><span>
</span><span id="line-339"></span><span>                          </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680938750"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-340"></span><span>                          </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938786"><span class="hs-identifier hs-var">currentDir</span></a></span><span>
</span><span id="line-341"></span><span>                          </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938921"><span class="hs-identifier hs-var">runtime</span></a></span><span>
</span><span id="line-342"></span><span>                          </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938922"><span class="hs-identifier hs-var">sbRuntime</span></a></span><span>
</span><span id="line-343"></span><span>                          </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938923"><span class="hs-identifier hs-var">nRuntime</span></a></span><span>
</span><span id="line-344"></span><span>                          </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680938919"><span class="hs-identifier hs-var">theCodebase</span></a></span><span>
</span><span id="line-345"></span><span>                          </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-346"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BaseUrl -&gt; Maybe BaseUrl
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621680938944"><span class="hs-identifier hs-var">baseUrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjectPath -&gt; ProjectPathIds
</span><span class="hs-identifier hs-var">PP.toIds</span></span><span> </span><span class="annot"><span class="annottext">ProjectPath
</span><a href="#local-6989586621680938924"><span class="hs-identifier hs-var">startingProjectPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>                          </span><span class="annot"><span class="annottext">InitResult
</span><a href="#local-6989586621680938918"><span class="hs-identifier hs-var">initRes</span></a></span><span>
</span><span id="line-349"></span><span>                          </span><span class="annot"><span class="annottext">ProjectPathIds -&gt; IO ()
</span><a href="#local-6989586621680938937"><span class="hs-identifier hs-var">lspCheckForChanges</span></a></span><span>
</span><span id="line-350"></span><span>                          </span><span class="annot"><span class="annottext">ShouldWatchFiles
</span><a href="#local-6989586621680938916"><span class="hs-identifier hs-var">shouldWatchFiles</span></a></span><span>
</span><span id="line-351"></span><span>                  </span><span class="annot"><span class="annottext">ShouldExit
</span><a href="ArgParse.html#Exit"><span class="hs-identifier hs-var">Exit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">IO ()
forall a. IO a
</span><span class="hs-identifier hs-var">Exit.exitSuccess</span></span><span>
</span><span id="line-352"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-353"></span><span>    </span><span class="hs-comment">-- (runtime, sandboxed runtime)</span><span>
</span><span id="line-354"></span><span>    </span><span id="local-6989586621680938141"><span class="annot"><a href="#local-6989586621680938818"><span class="hs-identifier hs-type">withRuntimes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RTI.RuntimeHost</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Main.html#Runtimes"><span class="hs-identifier hs-type">Runtimes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680938141"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680938141"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-355"></span><span>    </span><span id="local-6989586621680938818"><span class="annot"><span class="annottext">withRuntimes :: forall a. String -&gt; RuntimeHost -&gt; (Runtimes -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621680938818"><span class="hs-identifier hs-var hs-var">withRuntimes</span></a></span></span><span> </span><span id="local-6989586621680938958"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938958"><span class="hs-identifier hs-var">nrtp</span></a></span></span><span> </span><span id="local-6989586621680938959"><span class="annot"><span class="annottext">RuntimeHost
</span><a href="#local-6989586621680938959"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621680938960"><span class="annot"><span class="annottext">Runtimes -&gt; IO a
</span><a href="#local-6989586621680938960"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-356"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; RuntimeHost -&gt; Text -&gt; (Runtime Symbol -&gt; IO a) -&gt; IO a
forall (m :: * -&gt; *) a.
MonadUnliftIO m =&gt;
Bool -&gt; RuntimeHost -&gt; Text -&gt; (Runtime Symbol -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">RTI.withRuntime</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">RuntimeHost
</span><a href="#local-6989586621680938959"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; Text
</span><a href="Unison.Version.html#%24sel%3AgitDescribeWithDate%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribeWithDate</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680938750"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680938961"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938961"><span class="hs-identifier hs-var">runtime</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-357"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; RuntimeHost -&gt; Text -&gt; (Runtime Symbol -&gt; IO a) -&gt; IO a
forall (m :: * -&gt; *) a.
MonadUnliftIO m =&gt;
Bool -&gt; RuntimeHost -&gt; Text -&gt; (Runtime Symbol -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">RTI.withRuntime</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">RuntimeHost
</span><a href="#local-6989586621680938959"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; Text
</span><a href="Unison.Version.html#%24sel%3AgitDescribeWithDate%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribeWithDate</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680938750"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680938962"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938962"><span class="hs-identifier hs-var">sbRuntime</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-358"></span><span>          </span><span class="annot"><span class="annottext">Runtimes -&gt; IO a
</span><a href="#local-6989586621680938960"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">(Runtimes -&gt; IO a)
-&gt; (Runtime Symbol -&gt; Runtimes) -&gt; Runtime Symbol -&gt; IO a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938961"><span class="hs-identifier hs-var">runtime</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680938962"><span class="hs-identifier hs-var">sbRuntime</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>            </span><span class="hs-comment">-- startNativeRuntime saves the path to `unison-runtime`</span><span>
</span><span id="line-360"></span><span>            </span><span class="annot"><span class="annottext">(Runtime Symbol -&gt; IO a) -&gt; IO (Runtime Symbol) -&gt; IO a
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String -&gt; IO (Runtime Symbol)
</span><span class="hs-identifier hs-var">RTI.startNativeRuntime</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; Text
</span><a href="Unison.Version.html#%24sel%3AgitDescribeWithDate%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribeWithDate</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680938750"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938958"><span class="hs-identifier hs-var">nrtp</span></a></span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span class="hs-comment">-- | Set user agent and configure TLS on global http client.</span><span>
</span><span id="line-363"></span><span class="hs-comment">-- Note that the authorized http client is distinct from the global http client.</span><span>
</span><span id="line-364"></span><span class="annot"><a href="Unison.Main.html#initHTTPClient"><span class="hs-identifier hs-type">initHTTPClient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Version.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span id="initHTTPClient"><span class="annot"><span class="annottext">initHTTPClient :: Version -&gt; IO ()
</span><a href="Unison.Main.html#initHTTPClient"><span class="hs-identifier hs-var hs-var">initHTTPClient</span></a></span></span><span> </span><span id="local-6989586621680938965"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680938965"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-366"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680938966"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680938966"><span class="hs-identifier hs-var">ucmVersion</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680938967"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680938967"><span class="hs-identifier hs-var">_date</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Version -&gt; (Text, Text)
</span><a href="Unison.Version.html#%24sel%3AgitDescribe%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribe</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680938965"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-367"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680938969"><span class="annot"><span class="annottext">userAgent :: ByteString
</span><a href="#local-6989586621680938969"><span class="hs-identifier hs-var hs-var">userAgent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><span class="hs-identifier hs-var">Text.encodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ByteString) -&gt; Text -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;UCM/&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680938966"><span class="hs-identifier hs-var">ucmVersion</span></a></span><span>
</span><span id="line-368"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680938971"><span class="annot"><span class="annottext">addUserAgent :: Request -&gt; IO Request
</span><a href="#local-6989586621680938971"><span class="hs-identifier hs-var hs-var">addUserAgent</span></a></span></span><span> </span><span id="local-6989586621680938972"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621680938972"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-369"></span><span>        </span><span class="annot"><span class="annottext">Request -&gt; IO Request
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Request -&gt; IO Request) -&gt; Request -&gt; IO Request
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621680938972"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="hs-identifier hs-var">HTTP.requestHeaders</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;User-Agent&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680938969"><span class="hs-identifier hs-type">userAgent</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="hs-identifier hs-var">HTTP.requestHeaders</span></span><span> </span><span class="annot"><a href="#local-6989586621680938972"><span class="hs-identifier hs-type">req</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-370"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680938974"><span class="annot"><span class="annottext">managerSettings :: ManagerSettings
</span><a href="#local-6989586621680938974"><span class="hs-identifier hs-var hs-var">managerSettings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ManagerSettings
</span><span class="hs-identifier hs-var">HTTP.tlsManagerSettings</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="hs-identifier hs-var">HTTP.managerModifyRequest</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680938971"><span class="hs-identifier hs-type">addUserAgent</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-371"></span><span>  </span><span id="local-6989586621680938977"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621680938977"><span class="hs-identifier hs-var">manager</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ManagerSettings -&gt; IO Manager
forall (m :: * -&gt; *). MonadIO m =&gt; ManagerSettings -&gt; m Manager
</span><span class="hs-identifier hs-var">HTTP.newTlsManagerWith</span></span><span> </span><span class="annot"><span class="annottext">ManagerSettings
</span><a href="#local-6989586621680938974"><span class="hs-identifier hs-var">managerSettings</span></a></span><span>
</span><span id="line-372"></span><span>  </span><span class="annot"><span class="annottext">Manager -&gt; IO ()
</span><span class="hs-identifier hs-var">HTTP.setGlobalManager</span></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621680938977"><span class="hs-identifier hs-var">manager</span></a></span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span class="annot"><a href="Unison.Main.html#prepareTranscriptDir"><span class="hs-identifier hs-type">prepareTranscriptDir</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Verbosity.Verbosity</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ArgParse.html#ShouldForkCodebase"><span class="hs-identifier hs-type">ShouldForkCodebase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="ArgParse.html#CodebasePathOption"><span class="hs-identifier hs-type">CodebasePathOption</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ArgParse.html#ShouldSaveCodebase"><span class="hs-identifier hs-type">ShouldSaveCodebase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-375"></span><span id="prepareTranscriptDir"><span class="annot"><span class="annottext">prepareTranscriptDir :: Verbosity
-&gt; ShouldForkCodebase
-&gt; Maybe CodebasePathOption
-&gt; ShouldSaveCodebase
-&gt; IO String
</span><a href="Unison.Main.html#prepareTranscriptDir"><span class="hs-identifier hs-var hs-var">prepareTranscriptDir</span></a></span></span><span> </span><span id="local-6989586621680938981"><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621680938981"><span class="hs-identifier hs-var">verbosity</span></a></span></span><span> </span><span id="local-6989586621680938982"><span class="annot"><span class="annottext">ShouldForkCodebase
</span><a href="#local-6989586621680938982"><span class="hs-identifier hs-var">shouldFork</span></a></span></span><span> </span><span id="local-6989586621680938983"><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680938983"><span class="hs-identifier hs-var">mCodePathOption</span></a></span></span><span> </span><span id="local-6989586621680938984"><span class="annot"><span class="annottext">ShouldSaveCodebase
</span><a href="#local-6989586621680938984"><span class="hs-identifier hs-var">shouldSaveCodebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-376"></span><span>  </span><span id="local-6989586621680938985"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938985"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ShouldSaveCodebase
</span><a href="#local-6989586621680938984"><span class="hs-identifier hs-var">shouldSaveCodebase</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-377"></span><span>    </span><span class="annot"><a href="ArgParse.html#SaveCodebase"><span class="hs-identifier hs-type">SaveCodebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680938987"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938987"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938987"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-378"></span><span>    </span><span class="annot"><span class="annottext">ShouldSaveCodebase
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">Temp.getCanonicalTemporaryDirectory</span></span><span> </span><span class="annot"><span class="annottext">IO String -&gt; (String -&gt; IO String) -&gt; IO String
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO String
</span><span class="hs-operator hs-var">`Temp.createTempDirectory`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;transcript&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680938997"><span class="annot"><span class="annottext">cbInit :: Init IO Symbol Ann
</span><a href="#local-6989586621680938997"><span class="hs-identifier hs-var hs-var">cbInit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Init IO Symbol Ann
forall (m :: * -&gt; *).
(HasCallStack, MonadUnliftIO m) =&gt;
Init m Symbol Ann
</span><span class="hs-identifier hs-var">SC.init</span></span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ShouldForkCodebase
</span><a href="#local-6989586621680938982"><span class="hs-identifier hs-var">shouldFork</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-381"></span><span>    </span><span class="annot"><span class="annottext">ShouldForkCodebase
</span><a href="ArgParse.html#UseFork"><span class="hs-identifier hs-var">UseFork</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-382"></span><span>      </span><span class="hs-comment">-- A forked codebase does not need to Create a codebase, because it already exists</span><span>
</span><span id="line-383"></span><span>      </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
-&gt; MigrationStrategy
-&gt; ((InitResult, String, Codebase IO Symbol Ann) -&gt; IO ())
-&gt; IO ()
forall r.
Maybe CodebasePathOption
-&gt; MigrationStrategy
-&gt; ((InitResult, String, Codebase IO Symbol Ann) -&gt; IO r)
-&gt; IO r
</span><a href="Unison.Main.html#getCodebaseOrExit"><span class="hs-identifier hs-var">getCodebaseOrExit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680938983"><span class="hs-identifier hs-var">mCodePathOption</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackupStrategy -&gt; VacuumStrategy -&gt; MigrationStrategy
</span><span class="hs-identifier hs-var">SC.MigrateAutomatically</span></span><span> </span><span class="annot"><span class="annottext">BackupStrategy
</span><span class="hs-identifier hs-var">SC.Backup</span></span><span> </span><span class="annot"><span class="annottext">VacuumStrategy
</span><span class="hs-identifier hs-var">SC.Vacuum</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((InitResult, String, Codebase IO Symbol Ann) -&gt; IO ()) -&gt; IO ())
-&gt; ((InitResult, String, Codebase IO Symbol Ann) -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; (InitResult, String, Codebase IO Symbol Ann) -&gt; IO ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>      </span><span id="local-6989586621680939001"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939001"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; IO String
forall (m :: * -&gt; *). MonadIO m =&gt; Maybe String -&gt; m String
</span><span class="hs-identifier hs-var">Codebase.getCodebaseDir</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CodebasePathOption -&gt; String)
-&gt; Maybe CodebasePathOption -&gt; Maybe String
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">CodebasePathOption -&gt; String
</span><a href="Unison.Main.html#codebasePathOptionToPath"><span class="hs-identifier hs-var">codebasePathOptionToPath</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680938983"><span class="hs-identifier hs-var">mCodePathOption</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Verbosity -&gt; Bool
</span><span class="hs-identifier hs-var">Verbosity.isSilent</span></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621680938981"><span class="hs-identifier hs-var">verbosity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ())
-&gt; (Pretty ColorText -&gt; IO ()) -&gt; Pretty ColorText -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; IO ()) -&gt; Pretty ColorText -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-386"></span><span>        </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-387"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Transcript will be run on a copy of the codebase at: &quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-388"></span><span>            </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-389"></span><span>            </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Pretty ColorText
forall s. IsString s =&gt; String -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939001"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-391"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><a href="System.Path.html#copyDir"><span class="hs-identifier hs-var">Path.copyDir</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Init IO Symbol Ann -&gt; String -&gt; String
forall (m :: * -&gt; *) v a. Init m v a -&gt; String -&gt; String
</span><span class="hs-identifier hs-var">CodebaseInit.codebasePath</span></span><span> </span><span class="annot"><span class="annottext">Init IO Symbol Ann
</span><a href="#local-6989586621680938997"><span class="hs-identifier hs-var">cbInit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939001"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Init IO Symbol Ann -&gt; String -&gt; String
forall (m :: * -&gt; *) v a. Init m v a -&gt; String -&gt; String
</span><span class="hs-identifier hs-var">CodebaseInit.codebasePath</span></span><span> </span><span class="annot"><span class="annottext">Init IO Symbol Ann
</span><a href="#local-6989586621680938997"><span class="hs-identifier hs-var">cbInit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938985"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>    </span><span class="annot"><span class="annottext">ShouldForkCodebase
</span><a href="ArgParse.html#DontFork"><span class="hs-identifier hs-var">DontFork</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-393"></span><span>      </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; IO ())
-&gt; (Pretty ColorText -&gt; Pretty ColorText)
-&gt; Pretty ColorText
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; IO ()) -&gt; Pretty ColorText -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Transcript will be run on a new, empty codebase.&quot;</span></span><span>
</span><span id="line-394"></span><span>      </span><span class="annot"><span class="annottext">Init IO Symbol Ann
-&gt; Verbosity
-&gt; String
-&gt; String
-&gt; CodebaseLockOption
-&gt; (Codebase IO Symbol Ann -&gt; IO ())
-&gt; IO ()
forall (m :: * -&gt; *) r.
MonadIO m =&gt;
Init m Symbol Ann
-&gt; Verbosity
-&gt; String
-&gt; String
-&gt; CodebaseLockOption
-&gt; (Codebase m Symbol Ann -&gt; m r)
-&gt; m r
</span><span class="hs-identifier hs-var">CodebaseInit.withNewUcmCodebaseOrExit</span></span><span> </span><span class="annot"><span class="annottext">Init IO Symbol Ann
</span><a href="#local-6989586621680938997"><span class="hs-identifier hs-var">cbInit</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621680938981"><span class="hs-identifier hs-var">verbosity</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;main.transcript&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938985"><span class="hs-identifier hs-var">tmp</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseLockOption
</span><span class="hs-identifier hs-var">SC.DoLock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; Codebase IO Symbol Ann -&gt; IO ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Codebase IO Symbol Ann -&gt; IO ())
-&gt; IO () -&gt; Codebase IO Symbol Ann -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680938985"><span class="hs-identifier hs-var">tmp</span></a></span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span class="annot"><a href="Unison.Main.html#runTranscripts%27"><span class="hs-identifier hs-type">runTranscripts'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-398"></span><span>  </span><span class="annot"><a href="Unison.Version.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-399"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-400"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-401"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-402"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="Unison.Main.html#MarkdownFile"><span class="hs-identifier hs-type">MarkdownFile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-403"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-404"></span><span id="runTranscripts%27"><span class="annot"><span class="annottext">runTranscripts' :: Version
-&gt; String -&gt; String -&gt; String -&gt; NonEmpty MarkdownFile -&gt; IO Bool
</span><a href="Unison.Main.html#runTranscripts%27"><span class="hs-identifier hs-var hs-var">runTranscripts'</span></a></span></span><span> </span><span id="local-6989586621680939012"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680939012"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621680939013"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939013"><span class="hs-identifier hs-var">progName</span></a></span></span><span> </span><span id="local-6989586621680939014"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939014"><span class="hs-identifier hs-var">nativeRtp</span></a></span></span><span> </span><span id="local-6989586621680939015"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939015"><span class="hs-identifier hs-var">transcriptDir</span></a></span></span><span> </span><span id="local-6989586621680939016"><span class="annot"><span class="annottext">NonEmpty MarkdownFile
</span><a href="#local-6989586621680939016"><span class="hs-identifier hs-var">markdownFiles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-405"></span><span>  </span><span id="local-6989586621680939017"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939017"><span class="hs-identifier hs-var">currentDir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">getCurrentDirectory</span></span><span>
</span><span id="line-406"></span><span>  </span><span class="hs-comment">-- We don't need to create a codebase through `getCodebaseOrExit` as we've already done so previously.</span><span>
</span><span id="line-407"></span><span>  </span><span class="annot"><span class="annottext">NonEmpty Bool -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">and</span></span><span>
</span><span id="line-408"></span><span>    </span><span class="annot"><span class="annottext">(NonEmpty Bool -&gt; Bool) -&gt; IO (NonEmpty Bool) -&gt; IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
-&gt; MigrationStrategy
-&gt; ((InitResult, String, Codebase IO Symbol Ann)
    -&gt; IO (NonEmpty Bool))
-&gt; IO (NonEmpty Bool)
forall r.
Maybe CodebasePathOption
-&gt; MigrationStrategy
-&gt; ((InitResult, String, Codebase IO Symbol Ann) -&gt; IO r)
-&gt; IO r
</span><a href="Unison.Main.html#getCodebaseOrExit"><span class="hs-identifier hs-var">getCodebaseOrExit</span></a></span><span>
</span><span id="line-409"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodebasePathOption -&gt; Maybe CodebasePathOption
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; CodebasePathOption
</span><a href="ArgParse.html#DontCreateCodebaseWhenMissing"><span class="hs-identifier hs-var">DontCreateCodebaseWhenMissing</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939015"><span class="hs-identifier hs-var">transcriptDir</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackupStrategy -&gt; VacuumStrategy -&gt; MigrationStrategy
</span><span class="hs-identifier hs-var">SC.MigrateAutomatically</span></span><span> </span><span class="annot"><span class="annottext">BackupStrategy
</span><span class="hs-identifier hs-var">SC.Backup</span></span><span> </span><span class="annot"><span class="annottext">VacuumStrategy
</span><span class="hs-identifier hs-var">SC.Vacuum</span></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span>      </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">InitResult
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680939020"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939020"><span class="hs-identifier hs-var">codebasePath</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680939021"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680939021"><span class="hs-identifier hs-var">theCodebase</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-412"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680939022"><span class="annot"><span class="annottext">isTest :: Bool
</span><a href="#local-6989586621680939022"><span class="hs-identifier hs-var hs-var">isTest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-413"></span><span>        </span><span class="annot"><span class="annottext">Bool
-&gt; Verbosity
-&gt; Text
-&gt; String
-&gt; (Runner -&gt; IO (NonEmpty Bool))
-&gt; IO (NonEmpty Bool)
forall (m :: * -&gt; *) r.
MonadUnliftIO m =&gt;
Bool -&gt; Verbosity -&gt; Text -&gt; String -&gt; (Runner -&gt; m r) -&gt; m r
</span><a href="Unison.Codebase.Transcript.Runner.html#withRunner"><span class="hs-identifier hs-var">Transcript.withRunner</span></a></span><span>
</span><span id="line-414"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680939022"><span class="hs-identifier hs-var">isTest</span></a></span><span>
</span><span id="line-415"></span><span>          </span><span class="annot"><span class="annottext">Verbosity
</span><span class="hs-identifier hs-var">Verbosity.Verbose</span></span><span>
</span><span id="line-416"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; Text
</span><a href="Unison.Version.html#%24sel%3AgitDescribeWithDate%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribeWithDate</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680939012"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>          </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939014"><span class="hs-identifier hs-var">nativeRtp</span></a></span><span>
</span><span id="line-418"></span><span>          </span><span class="hs-glyph">\</span><span id="local-6989586621680939024"><span class="annot"><span class="annottext">Runner
</span><a href="#local-6989586621680939024"><span class="hs-identifier hs-var">runTranscript</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-419"></span><span>            </span><span class="annot"><span class="annottext">NonEmpty MarkdownFile
-&gt; (MarkdownFile -&gt; IO Bool) -&gt; IO (NonEmpty Bool)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty MarkdownFile
</span><a href="#local-6989586621680939016"><span class="hs-identifier hs-var">markdownFiles</span></a></span><span> </span><span class="annot"><span class="annottext">((MarkdownFile -&gt; IO Bool) -&gt; IO (NonEmpty Bool))
-&gt; (MarkdownFile -&gt; IO Bool) -&gt; IO (NonEmpty Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Main.html#MarkdownFile"><span class="hs-identifier hs-type">MarkdownFile</span></a></span><span> </span><span id="local-6989586621680939027"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939027"><span class="hs-identifier hs-var">fileName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-420"></span><span>              </span><span id="local-6989586621680939028"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680939028"><span class="hs-identifier hs-var">transcriptSrc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Text
</span><span class="hs-identifier hs-var">readUtf8</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939027"><span class="hs-identifier hs-var">fileName</span></a></span><span>
</span><span id="line-421"></span><span>              </span><span id="local-6989586621680939030"><span class="annot"><span class="annottext">Either Error Text
</span><a href="#local-6989586621680939030"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Runner
</span><a href="#local-6989586621680939024"><span class="hs-identifier hs-var">runTranscript</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939027"><span class="hs-identifier hs-var">fileName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680939028"><span class="hs-identifier hs-var">transcriptSrc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939020"><span class="hs-identifier hs-var">codebasePath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680939021"><span class="hs-identifier hs-var">theCodebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680939031"><span class="annot"><span class="annottext">outputFile :: String
</span><a href="#local-6989586621680939031"><span class="hs-identifier hs-var hs-var">outputFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-identifier hs-var">replaceExtension</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939017"><span class="hs-identifier hs-var">currentDir</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939027"><span class="hs-identifier hs-var">fileName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.output.md&quot;</span></span><span>
</span><span id="line-423"></span><span>              </span><span id="local-6989586621680939032"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680939032"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-424"></span><span>                </span><span class="annot"><span class="annottext">(Error -&gt; IO Text)
-&gt; (Text -&gt; IO Text) -&gt; Either Error Text -&gt; IO Text
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span>
</span><span id="line-425"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Text -&gt; IO Text) -&gt; (IO (), Text) -&gt; IO Text
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Text -&gt; IO Text
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">($&gt;)</span></span><span> </span><span class="annot"><span class="annottext">((IO (), Text) -&gt; IO Text)
-&gt; (Error -&gt; (IO (), Text)) -&gt; Error -&gt; IO Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([Pretty ColorText] -&gt; IO ())
-&gt; ([Pretty ColorText], Text) -&gt; (IO (), Text)
forall a b c. (a -&gt; b) -&gt; (a, c) -&gt; (b, c)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; IO ())
-&gt; ([Pretty ColorText] -&gt; Pretty ColorText)
-&gt; [Pretty ColorText]
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Pretty s -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.callout</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&#10067;&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Pretty ColorText)
-&gt; ([Pretty ColorText] -&gt; Pretty ColorText)
-&gt; [Pretty ColorText]
-&gt; Pretty ColorText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Pretty ColorText], Text) -&gt; (IO (), Text))
-&gt; (Error -&gt; ([Pretty ColorText], Text)) -&gt; Error -&gt; (IO (), Text)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-426"></span><span>                      </span><span class="annot"><a href="Unison.Codebase.Transcript.Runner.html#ParseError"><span class="hs-identifier hs-type">Transcript.ParseError</span></a></span><span> </span><span id="local-6989586621680939038"><span class="annot"><span class="annottext">ParseErrorBundle Text Void
</span><a href="#local-6989586621680939038"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-427"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680939039"><span class="annot"><span class="annottext">msg :: String
</span><a href="#local-6989586621680939039"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ParseErrorBundle Text Void -&gt; String
forall s e.
(VisualStream s, TraversableStream s, ShowErrorComponent e) =&gt;
ParseErrorBundle s e -&gt; String
</span><span class="hs-identifier hs-var">MP.errorBundlePretty</span></span><span> </span><span class="annot"><span class="annottext">ParseErrorBundle Text Void
</span><a href="#local-6989586621680939038"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-428"></span><span>                         </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Pretty ColorText)
-&gt; Pretty ColorText -&gt; Pretty ColorText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-429"></span><span>                                  </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;An error occurred while parsing the following file: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Pretty ColorText
forall s. IsString s =&gt; String -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939027"><span class="hs-identifier hs-var">fileName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-430"></span><span>                                </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-431"></span><span>                                </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Pretty ColorText)
-&gt; Pretty ColorText -&gt; Pretty ColorText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Pretty ColorText
forall s. IsString s =&gt; String -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939039"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-432"></span><span>                              </span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-433"></span><span>                              </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939039"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-434"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>                      </span><span class="annot"><a href="Unison.Codebase.Transcript.Runner.html#RunFailure"><span class="hs-identifier hs-type">Transcript.RunFailure</span></a></span><span> </span><span id="local-6989586621680939042"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680939042"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-436"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Pretty ColorText)
-&gt; Pretty ColorText -&gt; Pretty ColorText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;An error occurred while running the following file: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Pretty ColorText
forall s. IsString s =&gt; String -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939027"><span class="hs-identifier hs-var">fileName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-437"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-438"></span><span>                            </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Pretty ColorText
forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680939042"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-439"></span><span>                            </span><span class="annot"><span class="annottext">String -&gt; Pretty ColorText
forall s. IsString s =&gt; String -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Pretty ColorText) -&gt; String -&gt; Pretty ColorText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-440"></span><span>                              </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Run `&quot;</span></span><span>
</span><span id="line-441"></span><span>                                </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939013"><span class="hs-identifier hs-var">progName</span></a></span><span>
</span><span id="line-442"></span><span>                                </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; --codebase &quot;</span></span><span>
</span><span id="line-443"></span><span>                                </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939020"><span class="hs-identifier hs-var">codebasePath</span></a></span><span>
</span><span id="line-444"></span><span>                                </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;` &quot;</span></span><span>
</span><span id="line-445"></span><span>                                </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;to do more work with it.&quot;</span></span><span>
</span><span id="line-446"></span><span>                          </span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-447"></span><span>                          </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680939042"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-448"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span>                  </span><span class="annot"><span class="annottext">Text -&gt; IO Text
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-451"></span><span>                  </span><span class="annot"><span class="annottext">Either Error Text
</span><a href="#local-6989586621680939030"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-452"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">writeUtf8</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939031"><span class="hs-identifier hs-var">outputFile</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680939032"><span class="hs-identifier hs-var">output</span></a></span><span>
</span><span id="line-453"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&#128190;  Wrote &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939031"><span class="hs-identifier hs-var">outputFile</span></a></span><span>
</span><span id="line-454"></span><span>              </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Either Error Text -&gt; Bool
forall a b. Either a b -&gt; Bool
</span><span class="hs-identifier hs-var">isRight</span></span><span> </span><span class="annot"><span class="annottext">Either Error Text
</span><a href="#local-6989586621680939030"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span class="annot"><a href="Unison.Main.html#runTranscripts"><span class="hs-identifier hs-type">runTranscripts</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-457"></span><span>  </span><span class="annot"><a href="Unison.Version.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-458"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Verbosity.Verbosity</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-459"></span><span>  </span><span class="annot"><a href="ArgParse.html#UsageRenderer"><span class="hs-identifier hs-type">UsageRenderer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-460"></span><span>  </span><span class="annot"><a href="ArgParse.html#ShouldForkCodebase"><span class="hs-identifier hs-type">ShouldForkCodebase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-461"></span><span>  </span><span class="annot"><a href="ArgParse.html#ShouldSaveCodebase"><span class="hs-identifier hs-type">ShouldSaveCodebase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-462"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="ArgParse.html#CodebasePathOption"><span class="hs-identifier hs-type">CodebasePathOption</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-463"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-464"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-465"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span id="runTranscripts"><span class="annot"><span class="annottext">runTranscripts :: Version
-&gt; Verbosity
-&gt; (Maybe String -&gt; String)
-&gt; ShouldForkCodebase
-&gt; ShouldSaveCodebase
-&gt; Maybe CodebasePathOption
-&gt; String
-&gt; NonEmpty String
-&gt; IO ()
</span><a href="Unison.Main.html#runTranscripts"><span class="hs-identifier hs-var hs-var">runTranscripts</span></a></span></span><span> </span><span id="local-6989586621680939046"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680939046"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621680939047"><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621680939047"><span class="hs-identifier hs-var">verbosity</span></a></span></span><span> </span><span id="local-6989586621680939048"><span class="annot"><span class="annottext">Maybe String -&gt; String
</span><a href="#local-6989586621680939048"><span class="hs-identifier hs-var">renderUsageInfo</span></a></span></span><span> </span><span id="local-6989586621680939049"><span class="annot"><span class="annottext">ShouldForkCodebase
</span><a href="#local-6989586621680939049"><span class="hs-identifier hs-var">shouldFork</span></a></span></span><span> </span><span id="local-6989586621680939050"><span class="annot"><span class="annottext">ShouldSaveCodebase
</span><a href="#local-6989586621680939050"><span class="hs-identifier hs-var">shouldSaveTempCodebase</span></a></span></span><span> </span><span id="local-6989586621680939051"><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680939051"><span class="hs-identifier hs-var">mCodePathOption</span></a></span></span><span> </span><span id="local-6989586621680939052"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939052"><span class="hs-identifier hs-var">nativeRtp</span></a></span></span><span> </span><span id="local-6989586621680939053"><span class="annot"><span class="annottext">NonEmpty String
</span><a href="#local-6989586621680939053"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-467"></span><span>  </span><span id="local-6989586621680939054"><span class="annot"><span class="annottext">NonEmpty MarkdownFile
</span><a href="#local-6989586621680939054"><span class="hs-identifier hs-var">markdownFiles</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Validation [String] MarkdownFile)
-&gt; NonEmpty String -&gt; Validation [String] (NonEmpty MarkdownFile)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; NonEmpty a -&gt; f (NonEmpty b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String -&gt; [String])
-&gt; Validation String MarkdownFile
-&gt; Validation [String] MarkdownFile
forall a b c. (a -&gt; b) -&gt; Validation a c -&gt; Validation b c
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Validation String MarkdownFile
 -&gt; Validation [String] MarkdownFile)
-&gt; (String -&gt; Validation String MarkdownFile)
-&gt; String
-&gt; Validation [String] MarkdownFile
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Validation String MarkdownFile
</span><a href="Unison.Main.html#markdownFile"><span class="hs-identifier hs-var">markdownFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty String
</span><a href="#local-6989586621680939053"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-468"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Failure</span></span><span> </span><span id="local-6989586621680939058"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621680939058"><span class="hs-identifier hs-var">invalidArgs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-469"></span><span>      </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; IO ()) -&gt; Pretty ColorText -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-470"></span><span>        </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Pretty s -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.callout</span></span><span>
</span><span id="line-471"></span><span>          </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&#10067;&quot;</span></span><span>
</span><span id="line-472"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-473"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Transcripts must have an .md or .markdown extension.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-474"></span><span>                </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-475"></span><span>                </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall (f :: * -&gt; *) s.
(Foldable f, ListLike s Char, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.bulleted</span></span><span> </span><span class="annot"><span class="annottext">([Pretty ColorText] -&gt; Pretty ColorText)
-&gt; [Pretty ColorText] -&gt; Pretty ColorText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Pretty ColorText) -&gt; [String] -&gt; [Pretty ColorText]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><span class="hs-identifier hs-var">P.bold</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Pretty ColorText)
-&gt; (String -&gt; Pretty ColorText) -&gt; String -&gt; Pretty ColorText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Pretty ColorText
forall s. IsString s =&gt; String -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Pretty ColorText)
-&gt; (String -&gt; String) -&gt; String -&gt; Pretty ColorText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621680939058"><span class="hs-identifier hs-var">invalidArgs</span></a></span><span>
</span><span id="line-476"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-477"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe String -&gt; String
</span><a href="#local-6989586621680939048"><span class="hs-identifier hs-var">renderUsageInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; String) -&gt; Maybe String -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;transcript&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>      </span><span class="annot"><span class="annottext">ExitCode -&gt; IO (NonEmpty MarkdownFile)
forall a. ExitCode -&gt; IO a
</span><span class="hs-identifier hs-var">Exit.exitWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ExitCode
</span><span class="hs-identifier hs-var">Exit.ExitFailure</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Success</span></span><span> </span><span id="local-6989586621680939063"><span class="annot"><span class="annottext">NonEmpty MarkdownFile
</span><a href="#local-6989586621680939063"><span class="hs-identifier hs-var">markdownFiles</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty MarkdownFile -&gt; IO (NonEmpty MarkdownFile)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty MarkdownFile
</span><a href="#local-6989586621680939063"><span class="hs-identifier hs-var">markdownFiles</span></a></span><span>
</span><span id="line-481"></span><span>  </span><span id="local-6989586621680939064"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939064"><span class="hs-identifier hs-var">progName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">getProgName</span></span><span>
</span><span id="line-482"></span><span>  </span><span id="local-6989586621680939065"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939065"><span class="hs-identifier hs-var">transcriptDir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Verbosity
-&gt; ShouldForkCodebase
-&gt; Maybe CodebasePathOption
-&gt; ShouldSaveCodebase
-&gt; IO String
</span><a href="Unison.Main.html#prepareTranscriptDir"><span class="hs-identifier hs-var">prepareTranscriptDir</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621680939047"><span class="hs-identifier hs-var">verbosity</span></a></span><span> </span><span class="annot"><span class="annottext">ShouldForkCodebase
</span><a href="#local-6989586621680939049"><span class="hs-identifier hs-var">shouldFork</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680939051"><span class="hs-identifier hs-var">mCodePathOption</span></a></span><span> </span><span class="annot"><span class="annottext">ShouldSaveCodebase
</span><a href="#local-6989586621680939050"><span class="hs-identifier hs-var">shouldSaveTempCodebase</span></a></span><span>
</span><span id="line-483"></span><span>  </span><span id="local-6989586621680939066"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680939066"><span class="hs-identifier hs-var">completed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-484"></span><span>    </span><span class="annot"><span class="annottext">Version
-&gt; String -&gt; String -&gt; String -&gt; NonEmpty MarkdownFile -&gt; IO Bool
</span><a href="Unison.Main.html#runTranscripts%27"><span class="hs-identifier hs-var">runTranscripts'</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680939046"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939064"><span class="hs-identifier hs-var">progName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939052"><span class="hs-identifier hs-var">nativeRtp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939065"><span class="hs-identifier hs-var">transcriptDir</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty MarkdownFile
</span><a href="#local-6989586621680939054"><span class="hs-identifier hs-var">markdownFiles</span></a></span><span>
</span><span id="line-485"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ShouldSaveCodebase
</span><a href="#local-6989586621680939050"><span class="hs-identifier hs-var">shouldSaveTempCodebase</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-486"></span><span>    </span><span class="annot"><span class="annottext">ShouldSaveCodebase
</span><a href="ArgParse.html#DontSaveCodebase"><span class="hs-identifier hs-var">DontSaveCodebase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">removeDirectoryRecursive</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939065"><span class="hs-identifier hs-var">transcriptDir</span></a></span><span>
</span><span id="line-487"></span><span>    </span><span class="annot"><a href="ArgParse.html#SaveCodebase"><span class="hs-identifier hs-type">SaveCodebase</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-488"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680939066"><span class="hs-identifier hs-var">completed</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-489"></span><span>        </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; IO ()) -&gt; Pretty ColorText -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-490"></span><span>          </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Pretty s -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.callout</span></span><span>
</span><span id="line-491"></span><span>            </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&#127800;&quot;</span></span><span>
</span><span id="line-492"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-493"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;I've finished running the transcript(s) in this codebase:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-494"></span><span>                  </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-495"></span><span>                  </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Pretty ColorText
forall s. IsString s =&gt; String -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939065"><span class="hs-identifier hs-var">transcriptDir</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-496"></span><span>                  </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-497"></span><span>                  </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Pretty ColorText)
-&gt; Pretty ColorText -&gt; Pretty ColorText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-498"></span><span>                    </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;You can run&quot;</span></span><span>
</span><span id="line-499"></span><span>                      </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
forall s. IsString s =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.backticked</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Pretty ColorText
forall s. IsString s =&gt; String -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939064"><span class="hs-identifier hs-var">progName</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot; --codebase &quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Pretty ColorText
forall s. IsString s =&gt; String -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939065"><span class="hs-identifier hs-var">transcriptDir</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-500"></span><span>                      </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;to do more work with it.&quot;</span></span><span>
</span><span id="line-501"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-502"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680939066"><span class="hs-identifier hs-var">completed</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExitCode -&gt; IO ()
forall a. ExitCode -&gt; IO a
</span><span class="hs-identifier hs-var">Exit.exitWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ExitCode
</span><span class="hs-identifier hs-var">Exit.ExitFailure</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span class="annot"><a href="Unison.Main.html#launch"><span class="hs-identifier hs-type">launch</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-506"></span><span>  </span><span class="annot"><a href="Unison.Version.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-507"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-508"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-509"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-510"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-511"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase.Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-512"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#Event"><span class="hs-identifier hs-type">Input.Event</span></a></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#Input"><span class="hs-identifier hs-type">Input.Input</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-513"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server.BaseUrl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-514"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PP.ProjectPathIds</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-515"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">InitResult</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-516"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PP.ProjectPathIds</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-517"></span><span>  </span><span class="annot"><a href="Unison.CommandLine.Types.html#ShouldWatchFiles"><span class="hs-identifier hs-type">CommandLine.ShouldWatchFiles</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-518"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span id="launch"><span class="annot"><span class="annottext">launch :: Version
-&gt; String
-&gt; Runtime Symbol
-&gt; Runtime Symbol
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; [Either Event Input]
-&gt; Maybe BaseUrl
-&gt; ProjectPathIds
-&gt; InitResult
-&gt; (ProjectPathIds -&gt; IO ())
-&gt; ShouldWatchFiles
-&gt; IO ()
</span><a href="Unison.Main.html#launch"><span class="hs-identifier hs-var hs-var">launch</span></a></span></span><span> </span><span id="local-6989586621680939070"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680939070"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621680939071"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939071"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span id="local-6989586621680939072"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680939072"><span class="hs-identifier hs-var">runtime</span></a></span></span><span> </span><span id="local-6989586621680939073"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680939073"><span class="hs-identifier hs-var">sbRuntime</span></a></span></span><span> </span><span id="local-6989586621680939074"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680939074"><span class="hs-identifier hs-var">nRuntime</span></a></span></span><span> </span><span id="local-6989586621680939075"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680939075"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621680939076"><span class="annot"><span class="annottext">[Either Event Input]
</span><a href="#local-6989586621680939076"><span class="hs-identifier hs-var">inputs</span></a></span></span><span> </span><span id="local-6989586621680939077"><span class="annot"><span class="annottext">Maybe BaseUrl
</span><a href="#local-6989586621680939077"><span class="hs-identifier hs-var">serverBaseUrl</span></a></span></span><span> </span><span id="local-6989586621680939078"><span class="annot"><span class="annottext">ProjectPathIds
</span><a href="#local-6989586621680939078"><span class="hs-identifier hs-var">startingPath</span></a></span></span><span> </span><span id="local-6989586621680939079"><span class="annot"><span class="annottext">InitResult
</span><a href="#local-6989586621680939079"><span class="hs-identifier hs-var">initResult</span></a></span></span><span> </span><span id="local-6989586621680939080"><span class="annot"><span class="annottext">ProjectPathIds -&gt; IO ()
</span><a href="#local-6989586621680939080"><span class="hs-identifier hs-var">lspCheckForChanges</span></a></span></span><span> </span><span id="local-6989586621680939081"><span class="annot"><span class="annottext">ShouldWatchFiles
</span><a href="#local-6989586621680939081"><span class="hs-identifier hs-var">shouldWatchFiles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-520"></span><span>  </span><span id="local-6989586621680939082"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680939082"><span class="hs-identifier hs-var">showWelcomeHint</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Transaction Bool -&gt; IO Bool
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680939075"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Transaction Bool
</span><span class="hs-identifier hs-var">Queries.doProjectsExist</span></span><span>
</span><span id="line-521"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680939084"><span class="annot"><span class="annottext">isNewCodebase :: CodebaseInitStatus
</span><a href="#local-6989586621680939084"><span class="hs-identifier hs-var hs-var">isNewCodebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">InitResult
</span><a href="#local-6989586621680939079"><span class="hs-identifier hs-var">initResult</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-522"></span><span>        </span><span class="annot"><span class="annottext">InitResult
</span><span class="hs-identifier hs-var">CreatedCodebase</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CodebaseInitStatus
</span><a href="Unison.CommandLine.Welcome.html#NewlyCreatedCodebase"><span class="hs-identifier hs-var">NewlyCreatedCodebase</span></a></span><span>
</span><span id="line-523"></span><span>        </span><span class="annot"><span class="annottext">InitResult
</span><span class="hs-identifier hs-var">OpenedCodebase</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CodebaseInitStatus
</span><a href="Unison.CommandLine.Welcome.html#PreviouslyCreatedCodebase"><span class="hs-identifier hs-var">PreviouslyCreatedCodebase</span></a></span><span>
</span><span id="line-524"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680939089"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680939089"><span class="hs-identifier hs-var">ucmVersion</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680939090"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680939090"><span class="hs-identifier hs-var">_date</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Version -&gt; (Text, Text)
</span><a href="Unison.Version.html#%24sel%3AgitDescribe%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribe</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680939070"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-525"></span><span>      </span><span id="local-6989586621680939091"><span class="annot"><span class="annottext">welcome :: Welcome
</span><a href="#local-6989586621680939091"><span class="hs-identifier hs-var hs-var">welcome</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CodebaseInitStatus -&gt; Text -&gt; Bool -&gt; Welcome
</span><a href="Unison.CommandLine.Welcome.html#welcome"><span class="hs-identifier hs-var">Welcome.welcome</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseInitStatus
</span><a href="#local-6989586621680939084"><span class="hs-identifier hs-var">isNewCodebase</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680939089"><span class="hs-identifier hs-var">ucmVersion</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680939082"><span class="hs-identifier hs-var">showWelcomeHint</span></a></span><span>
</span><span id="line-526"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">String
-&gt; Welcome
-&gt; ProjectPathIds
-&gt; [Either Event Input]
-&gt; Runtime Symbol
-&gt; Runtime Symbol
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; Maybe BaseUrl
-&gt; Text
-&gt; (ProjectPathIds -&gt; IO ())
-&gt; ShouldWatchFiles
-&gt; IO ()
</span><a href="Unison.CommandLine.Main.html#main"><span class="hs-identifier hs-var">CommandLine.main</span></a></span><span>
</span><span id="line-527"></span><span>        </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939071"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-528"></span><span>        </span><span class="annot"><span class="annottext">Welcome
</span><a href="#local-6989586621680939091"><span class="hs-identifier hs-var">welcome</span></a></span><span>
</span><span id="line-529"></span><span>        </span><span class="annot"><span class="annottext">ProjectPathIds
</span><a href="#local-6989586621680939078"><span class="hs-identifier hs-var">startingPath</span></a></span><span>
</span><span id="line-530"></span><span>        </span><span class="annot"><span class="annottext">[Either Event Input]
</span><a href="#local-6989586621680939076"><span class="hs-identifier hs-var">inputs</span></a></span><span>
</span><span id="line-531"></span><span>        </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680939072"><span class="hs-identifier hs-var">runtime</span></a></span><span>
</span><span id="line-532"></span><span>        </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680939073"><span class="hs-identifier hs-var">sbRuntime</span></a></span><span>
</span><span id="line-533"></span><span>        </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680939074"><span class="hs-identifier hs-var">nRuntime</span></a></span><span>
</span><span id="line-534"></span><span>        </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680939075"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-535"></span><span>        </span><span class="annot"><span class="annottext">Maybe BaseUrl
</span><a href="#local-6989586621680939077"><span class="hs-identifier hs-var">serverBaseUrl</span></a></span><span>
</span><span id="line-536"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680939089"><span class="hs-identifier hs-var">ucmVersion</span></a></span><span>
</span><span id="line-537"></span><span>        </span><span class="annot"><span class="annottext">ProjectPathIds -&gt; IO ()
</span><a href="#local-6989586621680939080"><span class="hs-identifier hs-var">lspCheckForChanges</span></a></span><span>
</span><span id="line-538"></span><span>        </span><span class="annot"><span class="annottext">ShouldWatchFiles
</span><a href="#local-6989586621680939081"><span class="hs-identifier hs-var">shouldWatchFiles</span></a></span><span>
</span><span id="line-539"></span><span>
</span><span id="line-540"></span><span class="hs-keyword">newtype</span><span> </span><span id="MarkdownFile"><span class="annot"><a href="Unison.Main.html#MarkdownFile"><span class="hs-identifier hs-var">MarkdownFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MarkdownFile"><span class="annot"><a href="Unison.Main.html#MarkdownFile"><span class="hs-identifier hs-var">MarkdownFile</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-541"></span><span>
</span><span id="line-542"></span><span class="annot"><a href="Unison.Main.html#markdownFile"><span class="hs-identifier hs-type">markdownFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Validation</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="annot"><a href="Unison.Main.html#MarkdownFile"><span class="hs-identifier hs-type">MarkdownFile</span></a></span><span>
</span><span id="line-543"></span><span id="markdownFile"><span class="annot"><span class="annottext">markdownFile :: String -&gt; Validation String MarkdownFile
</span><a href="Unison.Main.html#markdownFile"><span class="hs-identifier hs-var hs-var">markdownFile</span></a></span></span><span> </span><span id="local-6989586621680939094"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939094"><span class="hs-identifier hs-var">md</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><span class="hs-identifier hs-var">takeExtension</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939094"><span class="hs-identifier hs-var">md</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-544"></span><span>  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.md&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MarkdownFile -&gt; Validation String MarkdownFile
forall e a. a -&gt; Validation e a
</span><span class="hs-identifier hs-var">Success</span></span><span> </span><span class="annot"><span class="annottext">(MarkdownFile -&gt; Validation String MarkdownFile)
-&gt; MarkdownFile -&gt; Validation String MarkdownFile
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; MarkdownFile
</span><a href="Unison.Main.html#MarkdownFile"><span class="hs-identifier hs-var">MarkdownFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939094"><span class="hs-identifier hs-var">md</span></a></span><span>
</span><span id="line-545"></span><span>  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.markdown&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MarkdownFile -&gt; Validation String MarkdownFile
forall e a. a -&gt; Validation e a
</span><span class="hs-identifier hs-var">Success</span></span><span> </span><span class="annot"><span class="annottext">(MarkdownFile -&gt; Validation String MarkdownFile)
-&gt; MarkdownFile -&gt; Validation String MarkdownFile
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; MarkdownFile
</span><a href="Unison.Main.html#MarkdownFile"><span class="hs-identifier hs-var">MarkdownFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939094"><span class="hs-identifier hs-var">md</span></a></span><span>
</span><span id="line-546"></span><span>  </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Validation String MarkdownFile
forall e a. e -&gt; Validation e a
</span><span class="hs-identifier hs-var">Failure</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939094"><span class="hs-identifier hs-var">md</span></a></span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span class="annot"><a href="Unison.Main.html#isDotU"><span class="hs-identifier hs-type">isDotU</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-549"></span><span id="isDotU"><span class="annot"><span class="annottext">isDotU :: String -&gt; Bool
</span><a href="Unison.Main.html#isDotU"><span class="hs-identifier hs-var hs-var">isDotU</span></a></span></span><span> </span><span id="local-6989586621680939095"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939095"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><span class="hs-identifier hs-var">takeExtension</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939095"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.u&quot;</span></span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span id="local-6989586621680938126"><span class="annot"><a href="Unison.Main.html#getCodebaseOrExit"><span class="hs-identifier hs-type">getCodebaseOrExit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="ArgParse.html#CodebasePathOption"><span class="hs-identifier hs-type">CodebasePathOption</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SC.MigrationStrategy</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InitResult</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CodebasePath</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680938126"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680938126"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-552"></span><span id="getCodebaseOrExit"><span class="annot"><span class="annottext">getCodebaseOrExit :: forall r.
Maybe CodebasePathOption
-&gt; MigrationStrategy
-&gt; ((InitResult, String, Codebase IO Symbol Ann) -&gt; IO r)
-&gt; IO r
</span><a href="Unison.Main.html#getCodebaseOrExit"><span class="hs-identifier hs-var hs-var">getCodebaseOrExit</span></a></span></span><span> </span><span id="local-6989586621680939164"><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680939164"><span class="hs-identifier hs-var">codebasePathOption</span></a></span></span><span> </span><span id="local-6989586621680939165"><span class="annot"><span class="annottext">MigrationStrategy
</span><a href="#local-6989586621680939165"><span class="hs-identifier hs-var">migrationStrategy</span></a></span></span><span> </span><span id="local-6989586621680939166"><span class="annot"><span class="annottext">(InitResult, String, Codebase IO Symbol Ann) -&gt; IO r
</span><a href="#local-6989586621680939166"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-553"></span><span>  </span><span id="local-6989586621680939167"><span class="annot"><span class="annottext">CodebaseInitOptions
</span><a href="#local-6989586621680939167"><span class="hs-identifier hs-var">initOptions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption -&gt; IO CodebaseInitOptions
</span><a href="Unison.Main.html#argsToCodebaseInitOptions"><span class="hs-identifier hs-var">argsToCodebaseInitOptions</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680939164"><span class="hs-identifier hs-var">codebasePathOption</span></a></span><span>
</span><span id="line-554"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680939176"><span class="annot"><span class="annottext">cbInit :: Init IO Symbol Ann
</span><a href="#local-6989586621680939176"><span class="hs-identifier hs-var hs-var">cbInit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Init IO Symbol Ann
forall (m :: * -&gt; *).
(HasCallStack, MonadUnliftIO m) =&gt;
Init m Symbol Ann
</span><span class="hs-identifier hs-var">SC.init</span></span><span>
</span><span id="line-555"></span><span>  </span><span id="local-6989586621680939177"><span class="annot"><span class="annottext">Either (String, InitError) r
</span><a href="#local-6989586621680939177"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Init IO Symbol Ann
-&gt; String
-&gt; CodebaseInitOptions
-&gt; CodebaseLockOption
-&gt; MigrationStrategy
-&gt; ((InitResult, String, Codebase IO Symbol Ann) -&gt; IO r)
-&gt; IO (Either (String, InitError) r)
forall (m :: * -&gt; *) v a r.
MonadIO m =&gt;
Init m v a
-&gt; String
-&gt; CodebaseInitOptions
-&gt; CodebaseLockOption
-&gt; MigrationStrategy
-&gt; ((InitResult, String, Codebase m v a) -&gt; m r)
-&gt; m (Either (String, InitError) r)
</span><span class="hs-identifier hs-var">CodebaseInit.withOpenOrCreateCodebase</span></span><span> </span><span class="annot"><span class="annottext">Init IO Symbol Ann
</span><a href="#local-6989586621680939176"><span class="hs-identifier hs-var">cbInit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;main&quot;</span></span><span> </span><span class="annot"><span class="annottext">CodebaseInitOptions
</span><a href="#local-6989586621680939167"><span class="hs-identifier hs-var">initOptions</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseLockOption
</span><span class="hs-identifier hs-var">SC.DoLock</span></span><span> </span><span class="annot"><span class="annottext">MigrationStrategy
</span><a href="#local-6989586621680939165"><span class="hs-identifier hs-var">migrationStrategy</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-556"></span><span>    </span><span id="local-6989586621680939179"><span class="annot"><span class="annottext">cbInit :: (InitResult, String, Codebase IO Symbol Ann)
</span><a href="#local-6989586621680939179"><span class="hs-identifier hs-var">cbInit</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">InitResult
</span><span class="hs-identifier hs-var">CreatedCodebase</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680939180"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939180"><span class="hs-identifier hs-var">dir</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-557"></span><span>      </span><span id="local-6989586621680939181"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680939181"><span class="hs-identifier hs-var">pDir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (Pretty ColorText)
forall {s}. IsString s =&gt; String -&gt; IO (Pretty s)
</span><a href="#local-6989586621680939182"><span class="hs-identifier hs-var">prettyDir</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939180"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-558"></span><span>      </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn'</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-559"></span><span>      </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn'</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; IO ())
-&gt; (Pretty ColorText -&gt; Pretty ColorText)
-&gt; Pretty ColorText
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Pretty ColorText)
-&gt; (Pretty ColorText -&gt; Pretty ColorText)
-&gt; Pretty ColorText
-&gt; Pretty ColorText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; IO ()) -&gt; Pretty ColorText -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;I created a new codebase for you at&quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><span class="hs-identifier hs-var">P.blue</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680939181"><span class="hs-identifier hs-var">pDir</span></a></span><span>
</span><span id="line-560"></span><span>      </span><span class="annot"><span class="annottext">(InitResult, String, Codebase IO Symbol Ann) -&gt; IO r
</span><a href="#local-6989586621680939166"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">(InitResult, String, Codebase IO Symbol Ann)
</span><a href="#local-6989586621680939179"><span class="hs-identifier hs-var">cbInit</span></a></span><span>
</span><span id="line-561"></span><span>    </span><span id="local-6989586621680939185"><span class="annot"><span class="annottext">cbInit :: (InitResult, String, Codebase IO Symbol Ann)
</span><a href="#local-6989586621680939185"><span class="hs-identifier hs-var">cbInit</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">InitResult
</span><span class="hs-identifier hs-var">OpenedCodebase</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-562"></span><span>      </span><span class="annot"><span class="annottext">(InitResult, String, Codebase IO Symbol Ann) -&gt; IO r
</span><a href="#local-6989586621680939166"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">(InitResult, String, Codebase IO Symbol Ann)
</span><a href="#local-6989586621680939185"><span class="hs-identifier hs-var">cbInit</span></a></span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (String, InitError) r
</span><a href="#local-6989586621680939177"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-565"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680939186"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680939186"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; IO r
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680939186"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-566"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680939187"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939187"><span class="hs-identifier hs-var">dir</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680939188"><span class="annot"><span class="annottext">InitError
</span><a href="#local-6989586621680939188"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-567"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680939189"><span class="annot"><span class="annottext">message :: IO (Pretty ColorText)
</span><a href="#local-6989586621680939189"><span class="hs-identifier hs-var hs-var">message</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-568"></span><span>            </span><span id="local-6989586621680939190"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680939190"><span class="hs-identifier hs-var">pDir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (Pretty ColorText)
forall {s}. IsString s =&gt; String -&gt; IO (Pretty s)
</span><a href="#local-6989586621680939182"><span class="hs-identifier hs-var">prettyDir</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939187"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-569"></span><span>            </span><span id="local-6989586621680939191"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680939191"><span class="hs-identifier hs-var">executableName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Pretty ColorText
forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Pretty ColorText)
-&gt; (String -&gt; Text) -&gt; String -&gt; Pretty ColorText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Pretty ColorText) -&gt; IO String -&gt; IO (Pretty ColorText)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">getProgName</span></span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">InitError
</span><a href="#local-6989586621680939188"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-572"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">InitErrorOpen</span></span><span> </span><span id="local-6989586621680939193"><span class="annot"><span class="annottext">OpenCodebaseError
</span><a href="#local-6989586621680939193"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-573"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OpenCodebaseError
</span><a href="#local-6989586621680939193"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-574"></span><span>                  </span><span class="annot"><span class="annottext">OpenCodebaseError
</span><span class="hs-identifier hs-var">OpenCodebaseFileLockFailed</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-575"></span><span>                    </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO (Pretty ColorText)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-576"></span><span>                      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-577"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Failed to obtain a file lock on the codebase. &quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-578"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Perhaps you are running multiple ucm processes against the same codebase.&quot;</span></span><span>
</span><span id="line-579"></span><span>                          </span><span class="hs-special">]</span><span>
</span><span id="line-580"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span>                  </span><span class="annot"><span class="annottext">OpenCodebaseError
</span><span class="hs-identifier hs-var">OpenCodebaseDoesntExist</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-582"></span><span>                    </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO (Pretty ColorText)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-583"></span><span>                      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-584"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;No codebase exists in &quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680939190"><span class="hs-identifier hs-var">pDir</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-585"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Run `&quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680939191"><span class="hs-identifier hs-var">executableName</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot; --codebase-create &quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Pretty ColorText
forall s. IsString s =&gt; String -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939187"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot; to create one, then try again!&quot;</span></span><span>
</span><span id="line-586"></span><span>                          </span><span class="hs-special">]</span><span>
</span><span id="line-587"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">OpenCodebaseUnknownSchemaVersion</span></span><span> </span><span class="annot"><span class="annottext">SchemaVersion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-589"></span><span>                    </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO (Pretty ColorText)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-590"></span><span>                      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-591"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;I can't read the codebase in &quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680939190"><span class="hs-identifier hs-var">pDir</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot; because it was constructed using a newer version of unison.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-592"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Please upgrade your version of UCM.&quot;</span></span><span>
</span><span id="line-593"></span><span>                          </span><span class="hs-special">]</span><span>
</span><span id="line-594"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-595"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">OpenCodebaseRequiresMigration</span></span><span> </span><span class="annot"><span class="annottext">SchemaVersion
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SchemaVersion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-596"></span><span>                    </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO (Pretty ColorText)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-597"></span><span>                      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-598"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;The codebase is from an older version of UCM, it needs to be migrated before it can be used.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-599"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;You can migrate it by opening it in UCM, e.g. ucm -c mycodebase&quot;</span></span><span>
</span><span id="line-600"></span><span>                          </span><span class="hs-special">]</span><span>
</span><span id="line-601"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-602"></span><span>              </span><span class="annot"><span class="annottext">InitError
</span><span class="hs-identifier hs-var">FoundV1Codebase</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-603"></span><span>                </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO (Pretty ColorText)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-604"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-605"></span><span>                      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Found a v1 codebase at &quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680939190"><span class="hs-identifier hs-var">pDir</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-606"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;v1 codebases are no longer supported in this version of the UCM.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-607"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Please download version M2g of the UCM to upgrade.&quot;</span></span><span>
</span><span id="line-608"></span><span>                      </span><span class="hs-special">]</span><span>
</span><span id="line-609"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-610"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">CouldntCreateCodebase</span></span><span> </span><span id="local-6989586621680939200"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680939200"><span class="hs-identifier hs-var">errMessage</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-611"></span><span>                </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO (Pretty ColorText)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680939200"><span class="hs-identifier hs-var">errMessage</span></a></span><span>
</span><span id="line-612"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-613"></span><span>            </span><span id="local-6989586621680939201"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680939201"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Pretty ColorText)
</span><a href="#local-6989586621680939189"><span class="hs-identifier hs-var">message</span></a></span><span>
</span><span id="line-614"></span><span>            </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn'</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680939201"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-615"></span><span>            </span><span class="annot"><span class="annottext">IO r
forall a. IO a
</span><span class="hs-identifier hs-var">Exit.exitFailure</span></span><span>
</span><span id="line-616"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-617"></span><span>    </span><span id="local-6989586621680939182"><span class="annot"><span class="annottext">prettyDir :: String -&gt; IO (Pretty s)
</span><a href="#local-6989586621680939182"><span class="hs-identifier hs-var hs-var">prettyDir</span></a></span></span><span> </span><span id="local-6989586621680939205"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939205"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Pretty s
forall s. IsString s =&gt; String -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Pretty s) -&gt; IO String -&gt; IO (Pretty s)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><span class="hs-identifier hs-var">canonicalizePath</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939205"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-618"></span><span>
</span><span id="line-619"></span><span id="local-6989586621680938113"><span class="annot"><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-type">exitError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.ColorText</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680938113"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-620"></span><span id="exitError"><span class="annot"><span class="annottext">exitError :: forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var hs-var">exitError</span></a></span></span><span> </span><span id="local-6989586621680939211"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680939211"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-621"></span><span>  </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; IO ()) -&gt; Pretty ColorText -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Pretty s -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.callout</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&#9888;&#65039;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680939211"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-622"></span><span>  </span><span class="annot"><span class="annottext">IO a
forall a. IO a
</span><span class="hs-identifier hs-var">Exit.exitFailure</span></span><span>
</span><span id="line-623"></span><span>
</span><span id="line-624"></span><span class="annot"><a href="Unison.Main.html#argsToCodebaseInitOptions"><span class="hs-identifier hs-type">argsToCodebaseInitOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="ArgParse.html#CodebasePathOption"><span class="hs-identifier hs-type">CodebasePathOption</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CodebaseInit.CodebaseInitOptions</span></span><span>
</span><span id="line-625"></span><span id="argsToCodebaseInitOptions"><span class="annot"><span class="annottext">argsToCodebaseInitOptions :: Maybe CodebasePathOption -&gt; IO CodebaseInitOptions
</span><a href="Unison.Main.html#argsToCodebaseInitOptions"><span class="hs-identifier hs-var hs-var">argsToCodebaseInitOptions</span></a></span></span><span> </span><span id="local-6989586621680939212"><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680939212"><span class="hs-identifier hs-var">pathOption</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-626"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680939212"><span class="hs-identifier hs-var">pathOption</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-627"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ArgParse.html#CreateCodebaseWhenMissing"><span class="hs-identifier hs-type">CreateCodebaseWhenMissing</span></a></span><span> </span><span id="local-6989586621680939214"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939214"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CodebaseInitOptions -&gt; IO CodebaseInitOptions
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(CodebaseInitOptions -&gt; IO CodebaseInitOptions)
-&gt; CodebaseInitOptions -&gt; IO CodebaseInitOptions
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SpecifiedCodebase -&gt; CodebaseInitOptions
</span><span class="hs-identifier hs-var">Specified</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SpecifiedCodebase
</span><span class="hs-identifier hs-var">CreateWhenMissing</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939214"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-628"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ArgParse.html#DontCreateCodebaseWhenMissing"><span class="hs-identifier hs-type">DontCreateCodebaseWhenMissing</span></a></span><span> </span><span id="local-6989586621680939217"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939217"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CodebaseInitOptions -&gt; IO CodebaseInitOptions
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(CodebaseInitOptions -&gt; IO CodebaseInitOptions)
-&gt; CodebaseInitOptions -&gt; IO CodebaseInitOptions
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SpecifiedCodebase -&gt; CodebaseInitOptions
</span><span class="hs-identifier hs-var">Specified</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SpecifiedCodebase
</span><span class="hs-identifier hs-var">DontCreateWhenMissing</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939217"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>    </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">String -&gt; CodebaseInitOptions
</span><span class="hs-identifier hs-var">Home</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; CodebaseInitOptions)
-&gt; IO String -&gt; IO CodebaseInitOptions
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO String
forall (m :: * -&gt; *). MonadIO m =&gt; m String
</span><span class="hs-identifier hs-var">getHomeDirectory</span></span><span>
</span><span id="line-630"></span><span>
</span><span id="line-631"></span><span class="annot"><a href="Unison.Main.html#codebasePathOptionToPath"><span class="hs-identifier hs-type">codebasePathOptionToPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ArgParse.html#CodebasePathOption"><span class="hs-identifier hs-type">CodebasePathOption</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-632"></span><span id="codebasePathOptionToPath"><span class="annot"><span class="annottext">codebasePathOptionToPath :: CodebasePathOption -&gt; String
</span><a href="Unison.Main.html#codebasePathOptionToPath"><span class="hs-identifier hs-var hs-var">codebasePathOptionToPath</span></a></span></span><span> </span><span id="local-6989586621680939220"><span class="annot"><span class="annottext">CodebasePathOption
</span><a href="#local-6989586621680939220"><span class="hs-identifier hs-var">codebasePathOption</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-633"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CodebasePathOption
</span><a href="#local-6989586621680939220"><span class="hs-identifier hs-var">codebasePathOption</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-634"></span><span>    </span><span class="annot"><a href="ArgParse.html#CreateCodebaseWhenMissing"><span class="hs-identifier hs-type">CreateCodebaseWhenMissing</span></a></span><span> </span><span id="local-6989586621680939221"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939221"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939221"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-635"></span><span>    </span><span class="annot"><a href="ArgParse.html#DontCreateCodebaseWhenMissing"><span class="hs-identifier hs-type">DontCreateCodebaseWhenMissing</span></a></span><span> </span><span id="local-6989586621680939222"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939222"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680939222"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-636"></span></pre></body></html>