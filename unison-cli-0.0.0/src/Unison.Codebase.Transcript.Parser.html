<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="annot"><span class="hs-comment">-- | Parse and print CommonMark (like Github-flavored Markdown) transcripts.</span></span><span>
</span><span id="line-2"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Codebase.Transcript.Parser</span><span>
</span><span id="line-3"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * printing</span></span><span>
</span><span id="line-4"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#formatAPIRequest"><span class="hs-identifier">formatAPIRequest</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-5"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#formatUcmLine"><span class="hs-identifier">formatUcmLine</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#formatStanza"><span class="hs-identifier">formatStanza</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#formatNode"><span class="hs-identifier">formatNode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#formatProcessedBlock"><span class="hs-identifier">formatProcessedBlock</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><span class="hs-comment">-- * conversion</span></span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#processedBlockToNode"><span class="hs-identifier">processedBlockToNode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><span class="hs-comment">-- * parsing</span></span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#stanzas"><span class="hs-identifier">stanzas</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#ucmLine"><span class="hs-identifier">ucmLine</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#apiRequest"><span class="hs-identifier">apiRequest</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#fenced"><span class="hs-identifier">fenced</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#hidden"><span class="hs-identifier">hidden</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#expectingError"><span class="hs-identifier">expectingError</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#language"><span class="hs-identifier">language</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">where</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">CMark</span></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Char</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Megaparsec</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.html"><span class="hs-identifier">Unison.Codebase.Transcript</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Project</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fullyQualifiedProjectAndBranchNamesParser</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#formatAPIRequest"><span class="hs-identifier hs-type">formatAPIRequest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.html#APIRequest"><span class="hs-identifier hs-type">APIRequest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-33"></span><span id="formatAPIRequest"><span class="annot"><span class="annottext">formatAPIRequest :: APIRequest -&gt; Text
</span><a href="Unison.Codebase.Transcript.Parser.html#formatAPIRequest"><span class="hs-identifier hs-var hs-var">formatAPIRequest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Transcript.html#GetRequest"><span class="hs-identifier hs-type">GetRequest</span></a></span><span> </span><span id="local-6989586621680873786"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873786"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;GET &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873786"><span class="hs-identifier hs-var">txt</span></a></span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Transcript.html#APIComment"><span class="hs-identifier hs-type">APIComment</span></a></span><span> </span><span id="local-6989586621680873788"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873788"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;-- &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873788"><span class="hs-identifier hs-var">txt</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#formatUcmLine"><span class="hs-identifier hs-type">formatUcmLine</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.html#UcmLine"><span class="hs-identifier hs-type">UcmLine</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-38"></span><span id="formatUcmLine"><span class="annot"><span class="annottext">formatUcmLine :: UcmLine -&gt; Text
</span><a href="Unison.Codebase.Transcript.Parser.html#formatUcmLine"><span class="hs-identifier hs-var hs-var">formatUcmLine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Transcript.html#UcmCommand"><span class="hs-identifier hs-type">UcmCommand</span></a></span><span> </span><span id="local-6989586621680873790"><span class="annot"><span class="annottext">UcmContext
</span><a href="#local-6989586621680873790"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621680873791"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873791"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UcmContext -&gt; Text
</span><a href="#local-6989586621680873792"><span class="hs-identifier hs-var">formatContext</span></a></span><span> </span><span class="annot"><span class="annottext">UcmContext
</span><a href="#local-6989586621680873790"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&gt; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873791"><span class="hs-identifier hs-var">txt</span></a></span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Transcript.html#UcmComment"><span class="hs-identifier hs-type">UcmComment</span></a></span><span> </span><span id="local-6989586621680873794"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873794"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;--&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873794"><span class="hs-identifier hs-var">txt</span></a></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-42"></span><span>    </span><span id="local-6989586621680873792"><span class="annot"><span class="annottext">formatContext :: UcmContext -&gt; Text
</span><a href="#local-6989586621680873792"><span class="hs-identifier hs-var hs-var">formatContext</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Transcript.html#UcmContextProject"><span class="hs-identifier hs-type">UcmContextProject</span></a></span><span> </span><span id="local-6989586621680873798"><span class="annot"><span class="annottext">ProjectAndBranch ProjectName ProjectBranchName
</span><a href="#local-6989586621680873798"><span class="hs-identifier hs-var">projectAndBranch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall target source. From source target =&gt; source -&gt; target
</span><span class="hs-identifier hs-var">into</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch ProjectName ProjectBranchName
</span><a href="#local-6989586621680873798"><span class="hs-identifier hs-var">projectAndBranch</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#formatStanza"><span class="hs-identifier hs-type">formatStanza</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.html#Stanza"><span class="hs-identifier hs-type">Stanza</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-45"></span><span id="formatStanza"><span class="annot"><span class="annottext">formatStanza :: Stanza -&gt; Text
</span><a href="Unison.Codebase.Transcript.Parser.html#formatStanza"><span class="hs-identifier hs-var hs-var">formatStanza</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Node -&gt; Text) -&gt; (ProcessedBlock -&gt; Text) -&gt; Stanza -&gt; Text
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">Node -&gt; Text
</span><a href="Unison.Codebase.Transcript.Parser.html#formatNode"><span class="hs-identifier hs-var">formatNode</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessedBlock -&gt; Text
</span><a href="Unison.Codebase.Transcript.Parser.html#formatProcessedBlock"><span class="hs-identifier hs-var">formatProcessedBlock</span></a></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#formatNode"><span class="hs-identifier hs-type">formatNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CMark.Node</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-48"></span><span id="formatNode"><span class="annot"><span class="annottext">formatNode :: Node -&gt; Text
</span><a href="Unison.Codebase.Transcript.Parser.html#formatNode"><span class="hs-identifier hs-var hs-var">formatNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (Node -&gt; Text) -&gt; Node -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[CMarkOption] -&gt; Maybe Int -&gt; Node -&gt; Text
</span><span class="hs-identifier hs-var">CMark.nodeToCommonmark</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#formatProcessedBlock"><span class="hs-identifier hs-type">formatProcessedBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.html#ProcessedBlock"><span class="hs-identifier hs-type">ProcessedBlock</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-51"></span><span id="formatProcessedBlock"><span class="annot"><span class="annottext">formatProcessedBlock :: ProcessedBlock -&gt; Text
</span><a href="Unison.Codebase.Transcript.Parser.html#formatProcessedBlock"><span class="hs-identifier hs-var hs-var">formatProcessedBlock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node -&gt; Text
</span><a href="Unison.Codebase.Transcript.Parser.html#formatNode"><span class="hs-identifier hs-var">formatNode</span></a></span><span> </span><span class="annot"><span class="annottext">(Node -&gt; Text)
-&gt; (ProcessedBlock -&gt; Node) -&gt; ProcessedBlock -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ProcessedBlock -&gt; Node
</span><a href="Unison.Codebase.Transcript.Parser.html#processedBlockToNode"><span class="hs-identifier hs-var">processedBlockToNode</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#processedBlockToNode"><span class="hs-identifier hs-type">processedBlockToNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.html#ProcessedBlock"><span class="hs-identifier hs-type">ProcessedBlock</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CMark.Node</span></span><span>
</span><span id="line-54"></span><span id="processedBlockToNode"><span class="annot"><span class="annottext">processedBlockToNode :: ProcessedBlock -&gt; Node
</span><a href="Unison.Codebase.Transcript.Parser.html#processedBlockToNode"><span class="hs-identifier hs-var hs-var">processedBlockToNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Transcript.html#Ucm"><span class="hs-identifier hs-type">Ucm</span></a></span><span> </span><span class="annot"><span class="annottext">Hidden
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ExpectingError
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680873804"><span class="annot"><span class="annottext">[UcmLine]
</span><a href="#local-6989586621680873804"><span class="hs-identifier hs-var">cmds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe PosInfo -&gt; Text -&gt; Text -&gt; Node
</span><a href="Unison.Codebase.Transcript.html#CMarkCodeBlock"><span class="hs-identifier hs-var">CMarkCodeBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PosInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ucm&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Node) -&gt; Text -&gt; Node
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(UcmLine -&gt; Text -&gt; Text) -&gt; Text -&gt; [UcmLine] -&gt; Text
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text -&gt; Text)
-&gt; (UcmLine -&gt; Text) -&gt; UcmLine -&gt; Text -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UcmLine -&gt; Text
</span><a href="Unison.Codebase.Transcript.Parser.html#formatUcmLine"><span class="hs-identifier hs-var">formatUcmLine</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">[UcmLine]
</span><a href="#local-6989586621680873804"><span class="hs-identifier hs-var">cmds</span></a></span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Transcript.html#Unison"><span class="hs-identifier hs-type">Unison</span></a></span><span> </span><span id="local-6989586621680873808"><span class="annot"><span class="annottext">Hidden
</span><a href="#local-6989586621680873808"><span class="hs-identifier hs-var">_hide</span></a></span></span><span> </span><span class="annot"><span class="annottext">ExpectingError
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680873809"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621680873809"><span class="hs-identifier hs-var">fname</span></a></span></span><span> </span><span id="local-6989586621680873810"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873810"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><span class="annottext">Maybe PosInfo -&gt; Text -&gt; Text -&gt; Node
</span><a href="Unison.Codebase.Transcript.html#CMarkCodeBlock"><span class="hs-identifier hs-var">CMarkCodeBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PosInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unison&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Node) -&gt; Text -&gt; Node
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Text -&gt; Text) -&gt; Maybe Text -&gt; Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873810"><span class="hs-identifier hs-var">txt</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680873812"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873812"><span class="hs-identifier hs-var">fname</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">Text.unlines</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;---&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;title: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873812"><span class="hs-identifier hs-var">fname</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;---&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873810"><span class="hs-identifier hs-var">txt</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621680873809"><span class="hs-identifier hs-var">fname</span></a></span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Transcript.html#API"><span class="hs-identifier hs-type">API</span></a></span><span> </span><span id="local-6989586621680873815"><span class="annot"><span class="annottext">[APIRequest]
</span><a href="#local-6989586621680873815"><span class="hs-identifier hs-var">apiRequests</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe PosInfo -&gt; Text -&gt; Text -&gt; Node
</span><a href="Unison.Codebase.Transcript.html#CMarkCodeBlock"><span class="hs-identifier hs-var">CMarkCodeBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PosInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;api&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Node) -&gt; Text -&gt; Node
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">Text.unlines</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">APIRequest -&gt; Text
</span><a href="Unison.Codebase.Transcript.Parser.html#formatAPIRequest"><span class="hs-identifier hs-var">formatAPIRequest</span></a></span><span> </span><span class="annot"><span class="annottext">(APIRequest -&gt; Text) -&gt; [APIRequest] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[APIRequest]
</span><a href="#local-6989586621680873815"><span class="hs-identifier hs-var">apiRequests</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">type</span><span> </span><span id="P"><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#P"><span class="hs-identifier hs-var">P</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Parsec</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#stanzas"><span class="hs-identifier hs-type">stanzas</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">P.ParseErrorBundle</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Codebase.Transcript.html#Stanza"><span class="hs-identifier hs-type">Stanza</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-63"></span><span id="stanzas"><span class="annot"><span class="annottext">stanzas :: String -&gt; Text -&gt; Either (ParseErrorBundle Text Void) [Stanza]
</span><a href="Unison.Codebase.Transcript.Parser.html#stanzas"><span class="hs-identifier hs-var hs-var">stanzas</span></a></span></span><span> </span><span id="local-6989586621680873818"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680873818"><span class="hs-identifier hs-var">srcName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-comment">-- TODO: Internal warning if `_DOCUMENT` isn&#8217;t `CMark.DOCUMENT`.</span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">CMark.Node</span></span><span> </span><span class="annot"><span class="annottext">Maybe PosInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680873820"><span class="annot"><span class="annottext">NodeType
</span><a href="#local-6989586621680873820"><span class="hs-identifier hs-var">_DOCUMENT</span></a></span></span><span> </span><span id="local-6989586621680873821"><span class="annot"><span class="annottext">[Node]
</span><a href="#local-6989586621680873821"><span class="hs-identifier hs-var">blocks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Node -&gt; Either (ParseErrorBundle Text Void) Stanza)
-&gt; [Node] -&gt; Either (ParseErrorBundle Text Void) [Stanza]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">Node -&gt; Either (ParseErrorBundle Text Void) Stanza
</span><a href="#local-6989586621680873823"><span class="hs-identifier hs-var">stanzaFromNode</span></a></span><span> </span><span class="annot"><span class="annottext">[Node]
</span><a href="#local-6989586621680873821"><span class="hs-identifier hs-var">blocks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><span class="annottext">(Node -&gt; Either (ParseErrorBundle Text Void) [Stanza])
-&gt; (Text -&gt; Node)
-&gt; Text
-&gt; Either (ParseErrorBundle Text Void) [Stanza]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[CMarkOption] -&gt; Text -&gt; Node
</span><span class="hs-identifier hs-var">CMark.commonmarkToNode</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CMarkOption
</span><span class="hs-identifier hs-var">CMark.optSourcePos</span></span><span class="hs-special">]</span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><a href="#local-6989586621680873823"><span class="hs-identifier hs-type">stanzaFromNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CMark.Node</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">P.ParseErrorBundle</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.html#Stanza"><span class="hs-identifier hs-type">Stanza</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span id="local-6989586621680873823"><span class="annot"><span class="annottext">stanzaFromNode :: Node -&gt; Either (ParseErrorBundle Text Void) Stanza
</span><a href="#local-6989586621680873823"><span class="hs-identifier hs-var hs-var">stanzaFromNode</span></a></span></span><span> </span><span id="local-6989586621680873826"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621680873826"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621680873826"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-70"></span><span>      </span><span class="annot"><a href="Unison.Codebase.Transcript.html#CMarkCodeBlock"><span class="hs-identifier hs-type">CMarkCodeBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CMark.PosInfo</span></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680873828"><span class="annot"><span class="annottext">Int
startLine :: Int
startLine :: PosInfo -&gt; Int
</span><a href="#local-6989586621680873828"><span class="hs-identifier hs-var hs-var">startLine</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680873830"><span class="annot"><span class="annottext">Int
startColumn :: Int
startColumn :: PosInfo -&gt; Int
</span><a href="#local-6989586621680873830"><span class="hs-identifier hs-var hs-var">startColumn</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680873832"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873832"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621680873833"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873833"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-71"></span><span>        </span><span class="annot"><span class="annottext">Stanza
-&gt; (ProcessedBlock -&gt; Stanza) -&gt; Maybe ProcessedBlock -&gt; Stanza
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Node -&gt; Stanza
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621680873826"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ProcessedBlock -&gt; Stanza
forall a. a -&gt; Either Node a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ProcessedBlock -&gt; Stanza)
-&gt; Either (ParseErrorBundle Text Void) (Maybe ProcessedBlock)
-&gt; Either (ParseErrorBundle Text Void) Stanza
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(State Text Void,
 Either (ParseErrorBundle Text Void) (Maybe ProcessedBlock))
-&gt; Either (ParseErrorBundle Text Void) (Maybe ProcessedBlock)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Parsec Void Text (Maybe ProcessedBlock)
-&gt; State Text Void
-&gt; (State Text Void,
    Either (ParseErrorBundle Text Void) (Maybe ProcessedBlock))
forall e s a.
Parsec e s a
-&gt; State s e -&gt; (State s e, Either (ParseErrorBundle s e) a)
</span><span class="hs-identifier hs-var">P.runParser'</span></span><span> </span><span class="annot"><span class="annottext">Parsec Void Text (Maybe ProcessedBlock)
</span><a href="Unison.Codebase.Transcript.Parser.html#fenced"><span class="hs-identifier hs-var">fenced</span></a></span><span> </span><span class="annot"><span class="annottext">(State Text Void
 -&gt; (State Text Void,
     Either (ParseErrorBundle Text Void) (Maybe ProcessedBlock)))
-&gt; State Text Void
-&gt; (State Text Void,
    Either (ParseErrorBundle Text Void) (Maybe ProcessedBlock))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; Int -&gt; Text -&gt; Text -&gt; State Text Void
forall e. String -&gt; Int -&gt; Int -&gt; Text -&gt; Text -&gt; State Text e
</span><a href="Unison.Codebase.Transcript.Parser.html#fencedState"><span class="hs-identifier hs-var">fencedState</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680873818"><span class="hs-identifier hs-var">srcName</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680873828"><span class="hs-identifier hs-var">startLine</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680873830"><span class="hs-identifier hs-var">startColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873832"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873833"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>      </span><span class="annot"><span class="annottext">Node
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Stanza -&gt; Either (ParseErrorBundle Text Void) Stanza
forall a. a -&gt; Either (ParseErrorBundle Text Void) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Stanza -&gt; Either (ParseErrorBundle Text Void) Stanza)
-&gt; Stanza -&gt; Either (ParseErrorBundle Text Void) Stanza
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Node -&gt; Stanza
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621680873826"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#ucmLine"><span class="hs-identifier hs-type">ucmLine</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.html#UcmLine"><span class="hs-identifier hs-type">UcmLine</span></a></span><span>
</span><span id="line-75"></span><span id="ucmLine"><span class="annot"><span class="annottext">ucmLine :: P UcmLine
</span><a href="Unison.Codebase.Transcript.Parser.html#ucmLine"><span class="hs-identifier hs-var hs-var">ucmLine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">P UcmLine
</span><a href="#local-6989586621680873837"><span class="hs-identifier hs-var">ucmCommand</span></a></span><span> </span><span class="annot"><span class="annottext">P UcmLine -&gt; P UcmLine -&gt; P UcmLine
forall a.
ParsecT Void Text Identity a
-&gt; ParsecT Void Text Identity a -&gt; ParsecT Void Text Identity a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">P UcmLine
</span><a href="#local-6989586621680873839"><span class="hs-identifier hs-var">ucmComment</span></a></span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><a href="#local-6989586621680873837"><span class="hs-identifier hs-type">ucmCommand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.html#UcmLine"><span class="hs-identifier hs-type">UcmLine</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span id="local-6989586621680873837"><span class="annot"><span class="annottext">ucmCommand :: P UcmLine
</span><a href="#local-6989586621680873837"><span class="hs-identifier hs-var hs-var">ucmCommand</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-79"></span><span>      </span><span class="annot"><span class="annottext">UcmContext -&gt; Text -&gt; UcmLine
</span><a href="Unison.Codebase.Transcript.html#UcmCommand"><span class="hs-identifier hs-var">UcmCommand</span></a></span><span>
</span><span id="line-80"></span><span>        </span><span class="annot"><span class="annottext">(UcmContext -&gt; Text -&gt; UcmLine)
-&gt; ParsecT Void Text Identity UcmContext
-&gt; ParsecT Void Text Identity (Text -&gt; UcmLine)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(ProjectAndBranch ProjectName ProjectBranchName -&gt; UcmContext)
-&gt; ParsecT
     Void Text Identity (ProjectAndBranch ProjectName ProjectBranchName)
-&gt; ParsecT Void Text Identity UcmContext
forall a b.
(a -&gt; b)
-&gt; ParsecT Void Text Identity a -&gt; ParsecT Void Text Identity b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch ProjectName ProjectBranchName -&gt; UcmContext
</span><a href="Unison.Codebase.Transcript.html#UcmContextProject"><span class="hs-identifier hs-var">UcmContextProject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ParsecT
  Void Text Identity (ProjectAndBranch ProjectName ProjectBranchName)
-&gt; ParsecT
     Void Text Identity (ProjectAndBranch ProjectName ProjectBranchName)
forall a.
ParsecT Void Text Identity a -&gt; ParsecT Void Text Identity a
forall e s (m :: * -&gt; *) a. MonadParsec e s m =&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">P.try</span></span><span> </span><span class="annot"><span class="annottext">(ParsecT
   Void Text Identity (ProjectAndBranch ProjectName ProjectBranchName)
 -&gt; ParsecT
      Void
      Text
      Identity
      (ProjectAndBranch ProjectName ProjectBranchName))
-&gt; ParsecT
     Void Text Identity (ProjectAndBranch ProjectName ProjectBranchName)
-&gt; ParsecT
     Void Text Identity (ProjectAndBranch ProjectName ProjectBranchName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ParsecT
  Void Text Identity (ProjectAndBranch ProjectName ProjectBranchName)
</span><span class="hs-identifier hs-var">fullyQualifiedProjectAndBranchNamesParser</span></span><span> </span><span class="annot"><span class="annottext">ParsecT
  Void Text Identity (ProjectAndBranch ProjectName ProjectBranchName)
-&gt; ParsecT Void Text Identity Text
-&gt; ParsecT
     Void Text Identity (ProjectAndBranch ProjectName ProjectBranchName)
forall a b.
ParsecT Void Text Identity a
-&gt; ParsecT Void Text Identity b -&gt; ParsecT Void Text Identity a
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity Text -&gt; ParsecT Void Text Identity Text
forall a.
ParsecT Void Text Identity a -&gt; ParsecT Void Text Identity a
</span><a href="Unison.Codebase.Transcript.Parser.html#lineToken"><span class="hs-identifier hs-var">lineToken</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; ParsecT Void Text Identity Text
</span><a href="Unison.Codebase.Transcript.Parser.html#word"><span class="hs-identifier hs-var">word</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&gt;&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>        </span><span class="annot"><span class="annottext">ParsecT Void Text Identity (Text -&gt; UcmLine)
-&gt; ParsecT Void Text Identity Text -&gt; P UcmLine
forall a b.
ParsecT Void Text Identity (a -&gt; b)
-&gt; ParsecT Void Text Identity a -&gt; ParsecT Void Text Identity b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
-&gt; (Token Text -&gt; ExpectingError)
-&gt; ParsecT Void Text Identity (Tokens Text)
forall e s (m :: * -&gt; *).
MonadParsec e s m =&gt;
Maybe String -&gt; (Token s -&gt; ExpectingError) -&gt; m (Tokens s)
</span><span class="hs-identifier hs-var">P.takeWhileP</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Token Text -&gt; Token Text -&gt; ExpectingError
forall a. Eq a =&gt; a -&gt; a -&gt; ExpectingError
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Char
Token Text
</span><span class="hs-char">'\n'</span></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>        </span><span class="annot"><span class="annottext">P UcmLine -&gt; ParsecT Void Text Identity () -&gt; P UcmLine
forall a b.
ParsecT Void Text Identity a
-&gt; ParsecT Void Text Identity b -&gt; ParsecT Void Text Identity a
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity ()
</span><a href="Unison.Codebase.Transcript.Parser.html#spaces"><span class="hs-identifier hs-var">spaces</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><a href="#local-6989586621680873839"><span class="hs-identifier hs-type">ucmComment</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.html#UcmLine"><span class="hs-identifier hs-type">UcmLine</span></a></span><span>
</span><span id="line-85"></span><span>    </span><span id="local-6989586621680873839"><span class="annot"><span class="annottext">ucmComment :: P UcmLine
</span><a href="#local-6989586621680873839"><span class="hs-identifier hs-var hs-var">ucmComment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-86"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; P UcmLine -&gt; P UcmLine
forall a.
String
-&gt; ParsecT Void Text Identity a -&gt; ParsecT Void Text Identity a
forall e s (m :: * -&gt; *) a.
MonadParsec e s m =&gt;
String -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">P.label</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;comment (delimited with &#8220;--&#8221;)&quot;</span></span><span> </span><span class="annot"><span class="annottext">(P UcmLine -&gt; P UcmLine) -&gt; P UcmLine -&gt; P UcmLine
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-87"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; UcmLine
</span><a href="Unison.Codebase.Transcript.html#UcmComment"><span class="hs-identifier hs-var">UcmComment</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; UcmLine) -&gt; ParsecT Void Text Identity Text -&gt; P UcmLine
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; ParsecT Void Text Identity Text
</span><a href="Unison.Codebase.Transcript.Parser.html#word"><span class="hs-identifier hs-var">word</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;--&quot;</span></span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity Text
-&gt; ParsecT Void Text Identity Text
-&gt; ParsecT Void Text Identity Text
forall a b.
ParsecT Void Text Identity a
-&gt; ParsecT Void Text Identity b -&gt; ParsecT Void Text Identity b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
-&gt; (Token Text -&gt; ExpectingError)
-&gt; ParsecT Void Text Identity (Tokens Text)
forall e s (m :: * -&gt; *).
MonadParsec e s m =&gt;
Maybe String -&gt; (Token s -&gt; ExpectingError) -&gt; m (Tokens s)
</span><span class="hs-identifier hs-var">P.takeWhileP</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Token Text -&gt; Token Text -&gt; ExpectingError
forall a. Eq a =&gt; a -&gt; a -&gt; ExpectingError
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Char
Token Text
</span><span class="hs-char">'\n'</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">P UcmLine -&gt; ParsecT Void Text Identity () -&gt; P UcmLine
forall a b.
ParsecT Void Text Identity a
-&gt; ParsecT Void Text Identity b -&gt; ParsecT Void Text Identity a
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity ()
</span><a href="Unison.Codebase.Transcript.Parser.html#spaces"><span class="hs-identifier hs-var">spaces</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#apiRequest"><span class="hs-identifier hs-type">apiRequest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.html#APIRequest"><span class="hs-identifier hs-type">APIRequest</span></a></span><span>
</span><span id="line-90"></span><span id="apiRequest"><span class="annot"><span class="annottext">apiRequest :: P APIRequest
</span><a href="Unison.Codebase.Transcript.Parser.html#apiRequest"><span class="hs-identifier hs-var hs-var">apiRequest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-91"></span><span>  </span><span class="annot"><span class="annottext">P APIRequest
</span><a href="#local-6989586621680873848"><span class="hs-identifier hs-var">apiComment</span></a></span><span> </span><span class="annot"><span class="annottext">P APIRequest -&gt; P APIRequest -&gt; P APIRequest
forall a.
ParsecT Void Text Identity a
-&gt; ParsecT Void Text Identity a -&gt; ParsecT Void Text Identity a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">P APIRequest
</span><a href="#local-6989586621680873849"><span class="hs-identifier hs-var">getRequest</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-93"></span><span>    </span><span id="local-6989586621680873849"><span class="annot"><span class="annottext">getRequest :: P APIRequest
</span><a href="#local-6989586621680873849"><span class="hs-identifier hs-var hs-var">getRequest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-94"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; ParsecT Void Text Identity Text
</span><a href="Unison.Codebase.Transcript.Parser.html#word"><span class="hs-identifier hs-var">word</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;GET&quot;</span></span><span>
</span><span id="line-95"></span><span>      </span><span class="annot"><span class="annottext">ParsecT Void Text Identity ()
</span><a href="Unison.Codebase.Transcript.Parser.html#spaces"><span class="hs-identifier hs-var">spaces</span></a></span><span>
</span><span id="line-96"></span><span>      </span><span id="local-6989586621680873860"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873860"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe String
-&gt; (Token Text -&gt; ExpectingError)
-&gt; ParsecT Void Text Identity (Tokens Text)
forall e s (m :: * -&gt; *).
MonadParsec e s m =&gt;
Maybe String -&gt; (Token s -&gt; ExpectingError) -&gt; m (Tokens s)
</span><span class="hs-identifier hs-var">P.takeWhile1P</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Token Text -&gt; Token Text -&gt; ExpectingError
forall a. Eq a =&gt; a -&gt; a -&gt; ExpectingError
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Char
Token Text
</span><span class="hs-char">'\n'</span></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>      </span><span class="annot"><span class="annottext">ParsecT Void Text Identity ()
</span><a href="Unison.Codebase.Transcript.Parser.html#spaces"><span class="hs-identifier hs-var">spaces</span></a></span><span>
</span><span id="line-98"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; APIRequest
</span><a href="Unison.Codebase.Transcript.html#GetRequest"><span class="hs-identifier hs-var">GetRequest</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873860"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>    </span><span id="local-6989586621680873848"><span class="annot"><span class="annottext">apiComment :: P APIRequest
</span><a href="#local-6989586621680873848"><span class="hs-identifier hs-var hs-var">apiComment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-100"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; ParsecT Void Text Identity Text
</span><a href="Unison.Codebase.Transcript.Parser.html#word"><span class="hs-identifier hs-var">word</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;--&quot;</span></span><span>
</span><span id="line-101"></span><span>      </span><span id="local-6989586621680873871"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873871"><span class="hs-identifier hs-var">comment</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe String
-&gt; (Token Text -&gt; ExpectingError)
-&gt; ParsecT Void Text Identity (Tokens Text)
forall e s (m :: * -&gt; *).
MonadParsec e s m =&gt;
Maybe String -&gt; (Token s -&gt; ExpectingError) -&gt; m (Tokens s)
</span><span class="hs-identifier hs-var">P.takeWhileP</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Token Text -&gt; Token Text -&gt; ExpectingError
forall a. Eq a =&gt; a -&gt; a -&gt; ExpectingError
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Char
Token Text
</span><span class="hs-char">'\n'</span></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>      </span><span class="annot"><span class="annottext">ParsecT Void Text Identity ()
</span><a href="Unison.Codebase.Transcript.Parser.html#spaces"><span class="hs-identifier hs-var">spaces</span></a></span><span>
</span><span id="line-103"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; APIRequest
</span><a href="Unison.Codebase.Transcript.html#APIComment"><span class="hs-identifier hs-var">APIComment</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873871"><span class="hs-identifier hs-var">comment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="annot"><span class="hs-comment">-- | Parses the info string and contents of a fenced code block.</span></span><span>
</span><span id="line-106"></span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#fenced"><span class="hs-identifier hs-type">fenced</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.html#ProcessedBlock"><span class="hs-identifier hs-type">ProcessedBlock</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span id="fenced"><span class="annot"><span class="annottext">fenced :: Parsec Void Text (Maybe ProcessedBlock)
</span><a href="Unison.Codebase.Transcript.Parser.html#fenced"><span class="hs-identifier hs-var hs-var">fenced</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-108"></span><span>  </span><span id="local-6989586621680873872"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873872"><span class="hs-identifier hs-var">fenceType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity Text -&gt; ParsecT Void Text Identity Text
forall a.
ParsecT Void Text Identity a -&gt; ParsecT Void Text Identity a
</span><a href="Unison.Codebase.Transcript.Parser.html#lineToken"><span class="hs-identifier hs-var">lineToken</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; ParsecT Void Text Identity Text
</span><a href="Unison.Codebase.Transcript.Parser.html#word"><span class="hs-identifier hs-var">word</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ucm&quot;</span></span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity Text
-&gt; ParsecT Void Text Identity Text
-&gt; ParsecT Void Text Identity Text
forall a.
ParsecT Void Text Identity a
-&gt; ParsecT Void Text Identity a -&gt; ParsecT Void Text Identity a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ParsecT Void Text Identity Text
</span><a href="Unison.Codebase.Transcript.Parser.html#word"><span class="hs-identifier hs-var">word</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unison&quot;</span></span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity Text
-&gt; ParsecT Void Text Identity Text
-&gt; ParsecT Void Text Identity Text
forall a.
ParsecT Void Text Identity a
-&gt; ParsecT Void Text Identity a -&gt; ParsecT Void Text Identity a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ParsecT Void Text Identity Text
</span><a href="Unison.Codebase.Transcript.Parser.html#word"><span class="hs-identifier hs-var">word</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;api&quot;</span></span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity Text
-&gt; ParsecT Void Text Identity Text
-&gt; ParsecT Void Text Identity Text
forall a.
ParsecT Void Text Identity a
-&gt; ParsecT Void Text Identity a -&gt; ParsecT Void Text Identity a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity Text
</span><a href="Unison.Codebase.Transcript.Parser.html#language"><span class="hs-identifier hs-var">language</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873872"><span class="hs-identifier hs-var">fenceType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ucm&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-111"></span><span>      </span><span id="local-6989586621680873873"><span class="annot"><span class="annottext">Hidden
</span><a href="#local-6989586621680873873"><span class="hs-identifier hs-var">hide</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">P Hidden
</span><a href="Unison.Codebase.Transcript.Parser.html#hidden"><span class="hs-identifier hs-var">hidden</span></a></span><span>
</span><span id="line-112"></span><span>      </span><span id="local-6989586621680873874"><span class="annot"><span class="annottext">ExpectingError
</span><a href="#local-6989586621680873874"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">P ExpectingError
</span><a href="Unison.Codebase.Transcript.Parser.html#expectingError"><span class="hs-identifier hs-var">expectingError</span></a></span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><span class="annottext">ProcessedBlock -&gt; Maybe ProcessedBlock
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ProcessedBlock -&gt; Maybe ProcessedBlock)
-&gt; ([UcmLine] -&gt; ProcessedBlock)
-&gt; [UcmLine]
-&gt; Maybe ProcessedBlock
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Hidden -&gt; ExpectingError -&gt; [UcmLine] -&gt; ProcessedBlock
</span><a href="Unison.Codebase.Transcript.html#Ucm"><span class="hs-identifier hs-var">Ucm</span></a></span><span> </span><span class="annot"><span class="annottext">Hidden
</span><a href="#local-6989586621680873873"><span class="hs-identifier hs-var">hide</span></a></span><span> </span><span class="annot"><span class="annottext">ExpectingError
</span><a href="#local-6989586621680873874"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">([UcmLine] -&gt; Maybe ProcessedBlock)
-&gt; ParsecT Void Text Identity [UcmLine]
-&gt; Parsec Void Text (Maybe ProcessedBlock)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ParsecT Void Text Identity ()
</span><a href="Unison.Codebase.Transcript.Parser.html#spaces"><span class="hs-identifier hs-var">spaces</span></a></span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity ()
-&gt; ParsecT Void Text Identity [UcmLine]
-&gt; ParsecT Void Text Identity [UcmLine]
forall a b.
ParsecT Void Text Identity a
-&gt; ParsecT Void Text Identity b -&gt; ParsecT Void Text Identity b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">P UcmLine
-&gt; ParsecT Void Text Identity ()
-&gt; ParsecT Void Text Identity [UcmLine]
forall (m :: * -&gt; *) a end. MonadPlus m =&gt; m a -&gt; m end -&gt; m [a]
</span><span class="hs-identifier hs-var">P.manyTill</span></span><span> </span><span class="annot"><span class="annottext">P UcmLine
</span><a href="Unison.Codebase.Transcript.Parser.html#ucmLine"><span class="hs-identifier hs-var">ucmLine</span></a></span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity ()
forall e s (m :: * -&gt; *). MonadParsec e s m =&gt; m ()
</span><span class="hs-identifier hs-var">P.eof</span></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unison&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-115"></span><span>      </span><span class="hs-comment">-- todo: this has to be more interesting</span><span>
</span><span id="line-116"></span><span>      </span><span class="hs-comment">-- ``` unison :hide</span><span>
</span><span id="line-117"></span><span>      </span><span class="hs-comment">-- ``` unison</span><span>
</span><span id="line-118"></span><span>      </span><span class="hs-comment">-- ``` unison :hide:all scratch.u</span><span>
</span><span id="line-119"></span><span>      </span><span id="local-6989586621680873877"><span class="annot"><span class="annottext">Hidden
</span><a href="#local-6989586621680873877"><span class="hs-identifier hs-var">hide</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">P Hidden -&gt; P Hidden
forall a.
ParsecT Void Text Identity a -&gt; ParsecT Void Text Identity a
</span><a href="Unison.Codebase.Transcript.Parser.html#lineToken"><span class="hs-identifier hs-var">lineToken</span></a></span><span> </span><span class="annot"><span class="annottext">P Hidden
</span><a href="Unison.Codebase.Transcript.Parser.html#hidden"><span class="hs-identifier hs-var">hidden</span></a></span><span>
</span><span id="line-120"></span><span>      </span><span id="local-6989586621680873878"><span class="annot"><span class="annottext">ExpectingError
</span><a href="#local-6989586621680873878"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">P ExpectingError -&gt; P ExpectingError
forall a.
ParsecT Void Text Identity a -&gt; ParsecT Void Text Identity a
</span><a href="Unison.Codebase.Transcript.Parser.html#lineToken"><span class="hs-identifier hs-var">lineToken</span></a></span><span> </span><span class="annot"><span class="annottext">P ExpectingError
</span><a href="Unison.Codebase.Transcript.Parser.html#expectingError"><span class="hs-identifier hs-var">expectingError</span></a></span><span>
</span><span id="line-121"></span><span>      </span><span id="local-6989586621680873879"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621680873879"><span class="hs-identifier hs-var">fileName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity Text
-&gt; ParsecT Void Text Identity (Maybe Text)
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f (Maybe a)
</span><span class="hs-identifier hs-var">optional</span></span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity Text
</span><a href="Unison.Codebase.Transcript.Parser.html#untilSpace1"><span class="hs-identifier hs-var">untilSpace1</span></a></span><span>
</span><span id="line-122"></span><span>      </span><span class="annot"><span class="annottext">Token Text -&gt; ParsecT Void Text Identity (Token Text)
forall e s (m :: * -&gt; *).
MonadParsec e s m =&gt;
Token s -&gt; m (Token s)
</span><span class="hs-identifier hs-var">P.single</span></span><span> </span><span class="annot"><span class="annottext">Char
Token Text
</span><span class="hs-char">'\n'</span></span><span>
</span><span id="line-123"></span><span>      </span><span class="annot"><span class="annottext">ProcessedBlock -&gt; Maybe ProcessedBlock
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ProcessedBlock -&gt; Maybe ProcessedBlock)
-&gt; (Text -&gt; ProcessedBlock) -&gt; Text -&gt; Maybe ProcessedBlock
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Hidden -&gt; ExpectingError -&gt; Maybe Text -&gt; Text -&gt; ProcessedBlock
</span><a href="Unison.Codebase.Transcript.html#Unison"><span class="hs-identifier hs-var">Unison</span></a></span><span> </span><span class="annot"><span class="annottext">Hidden
</span><a href="#local-6989586621680873877"><span class="hs-identifier hs-var">hide</span></a></span><span> </span><span class="annot"><span class="annottext">ExpectingError
</span><a href="#local-6989586621680873878"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621680873879"><span class="hs-identifier hs-var">fileName</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe ProcessedBlock)
-&gt; ParsecT Void Text Identity Text
-&gt; Parsec Void Text (Maybe ProcessedBlock)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity Text
forall e s (m :: * -&gt; *). MonadParsec e s m =&gt; m s
</span><span class="hs-identifier hs-var">P.getInput</span></span><span>
</span><span id="line-124"></span><span>    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;api&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ProcessedBlock -&gt; Maybe ProcessedBlock
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ProcessedBlock -&gt; Maybe ProcessedBlock)
-&gt; ([APIRequest] -&gt; ProcessedBlock)
-&gt; [APIRequest]
-&gt; Maybe ProcessedBlock
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[APIRequest] -&gt; ProcessedBlock
</span><a href="Unison.Codebase.Transcript.html#API"><span class="hs-identifier hs-var">API</span></a></span><span> </span><span class="annot"><span class="annottext">([APIRequest] -&gt; Maybe ProcessedBlock)
-&gt; ParsecT Void Text Identity [APIRequest]
-&gt; Parsec Void Text (Maybe ProcessedBlock)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ParsecT Void Text Identity ()
</span><a href="Unison.Codebase.Transcript.Parser.html#spaces"><span class="hs-identifier hs-var">spaces</span></a></span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity ()
-&gt; ParsecT Void Text Identity [APIRequest]
-&gt; ParsecT Void Text Identity [APIRequest]
forall a b.
ParsecT Void Text Identity a
-&gt; ParsecT Void Text Identity b -&gt; ParsecT Void Text Identity b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">P APIRequest
-&gt; ParsecT Void Text Identity ()
-&gt; ParsecT Void Text Identity [APIRequest]
forall (m :: * -&gt; *) a end. MonadPlus m =&gt; m a -&gt; m end -&gt; m [a]
</span><span class="hs-identifier hs-var">P.manyTill</span></span><span> </span><span class="annot"><span class="annottext">P APIRequest
</span><a href="Unison.Codebase.Transcript.Parser.html#apiRequest"><span class="hs-identifier hs-var">apiRequest</span></a></span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity ()
forall e s (m :: * -&gt; *). MonadParsec e s m =&gt; m ()
</span><span class="hs-identifier hs-var">P.eof</span></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ProcessedBlock -&gt; Parsec Void Text (Maybe ProcessedBlock)
forall a. a -&gt; ParsecT Void Text Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe ProcessedBlock
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#word"><span class="hs-identifier hs-type">word</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-128"></span><span id="word"><span class="annot"><span class="annottext">word :: Text -&gt; ParsecT Void Text Identity Text
</span><a href="Unison.Codebase.Transcript.Parser.html#word"><span class="hs-identifier hs-var hs-var">word</span></a></span></span><span> </span><span id="local-6989586621680873884"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873884"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity Text -&gt; ParsecT Void Text Identity Text
forall a.
ParsecT Void Text Identity a -&gt; ParsecT Void Text Identity a
forall e s (m :: * -&gt; *) a. MonadParsec e s m =&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">P.try</span></span><span> </span><span class="annot"><span class="annottext">(ParsecT Void Text Identity Text
 -&gt; ParsecT Void Text Identity Text)
-&gt; ParsecT Void Text Identity Text
-&gt; ParsecT Void Text Identity Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-129"></span><span>  </span><span id="local-6989586621680873885"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873885"><span class="hs-identifier hs-var">chs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; Int -&gt; ParsecT Void Text Identity (Tokens Text)
forall e s (m :: * -&gt; *).
MonadParsec e s m =&gt;
Maybe String -&gt; Int -&gt; m (Tokens s)
</span><span class="hs-identifier hs-var">P.takeP</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Maybe String) -&gt; String -&gt; Maybe String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873884"><span class="hs-identifier hs-var">txt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Int
</span><span class="hs-identifier hs-var">Text.length</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873884"><span class="hs-identifier hs-var">txt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><span class="annottext">ExpectingError -&gt; ParsecT Void Text Identity ()
forall (f :: * -&gt; *). Alternative f =&gt; ExpectingError -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873885"><span class="hs-identifier hs-var">chs</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; ExpectingError
forall a. Eq a =&gt; a -&gt; a -&gt; ExpectingError
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873884"><span class="hs-identifier hs-var">txt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873884"><span class="hs-identifier hs-var">txt</span></a></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span id="local-6989586621680873889"><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#lineToken"><span class="hs-identifier hs-type">lineToken</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680873889"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680873889"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-134"></span><span id="lineToken"><span class="annot"><span class="annottext">lineToken :: forall a.
ParsecT Void Text Identity a -&gt; ParsecT Void Text Identity a
</span><a href="Unison.Codebase.Transcript.Parser.html#lineToken"><span class="hs-identifier hs-var hs-var">lineToken</span></a></span></span><span> </span><span id="local-6989586621680873891"><span class="annot"><span class="annottext">P a
</span><a href="#local-6989586621680873891"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">P a
</span><a href="#local-6989586621680873891"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">P a -&gt; ParsecT Void Text Identity () -&gt; P a
forall a b.
ParsecT Void Text Identity a
-&gt; ParsecT Void Text Identity b -&gt; ParsecT Void Text Identity a
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity ()
</span><a href="Unison.Codebase.Transcript.Parser.html#nonNewlineSpaces"><span class="hs-identifier hs-var">nonNewlineSpaces</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#nonNewlineSpaces"><span class="hs-identifier hs-type">nonNewlineSpaces</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span id="nonNewlineSpaces"><span class="annot"><span class="annottext">nonNewlineSpaces :: ParsecT Void Text Identity ()
</span><a href="Unison.Codebase.Transcript.Parser.html#nonNewlineSpaces"><span class="hs-identifier hs-var hs-var">nonNewlineSpaces</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity (Tokens Text)
-&gt; ParsecT Void Text Identity ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(ParsecT Void Text Identity (Tokens Text)
 -&gt; ParsecT Void Text Identity ())
-&gt; ParsecT Void Text Identity (Tokens Text)
-&gt; ParsecT Void Text Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
-&gt; (Token Text -&gt; ExpectingError)
-&gt; ParsecT Void Text Identity (Tokens Text)
forall e s (m :: * -&gt; *).
MonadParsec e s m =&gt;
Maybe String -&gt; (Token s -&gt; ExpectingError) -&gt; m (Tokens s)
</span><span class="hs-identifier hs-var">P.takeWhileP</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680873894"><span class="annot"><span class="annottext">Token Text
</span><a href="#local-6989586621680873894"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
Token Text
</span><a href="#local-6989586621680873894"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; ExpectingError
forall a. Eq a =&gt; a -&gt; a -&gt; ExpectingError
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span> </span><span class="annot"><span class="annottext">ExpectingError -&gt; ExpectingError -&gt; ExpectingError
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Char
Token Text
</span><a href="#local-6989586621680873894"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; ExpectingError
forall a. Eq a =&gt; a -&gt; a -&gt; ExpectingError
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\t'</span></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#hidden"><span class="hs-identifier hs-type">hidden</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.html#Hidden"><span class="hs-identifier hs-type">Hidden</span></a></span><span>
</span><span id="line-140"></span><span id="hidden"><span class="annot"><span class="annottext">hidden :: P Hidden
</span><a href="Unison.Codebase.Transcript.Parser.html#hidden"><span class="hs-identifier hs-var hs-var">hidden</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hidden
</span><a href="Unison.Codebase.Transcript.html#HideAll"><span class="hs-identifier hs-var">HideAll</span></a></span><span> </span><span class="annot"><span class="annottext">Hidden -&gt; ParsecT Void Text Identity Text -&gt; P Hidden
forall a b.
a -&gt; ParsecT Void Text Identity b -&gt; ParsecT Void Text Identity a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ParsecT Void Text Identity Text
</span><a href="Unison.Codebase.Transcript.Parser.html#word"><span class="hs-identifier hs-var">word</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;:hide:all&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>    </span><span class="annot"><span class="annottext">P Hidden -&gt; P Hidden -&gt; P Hidden
forall a.
ParsecT Void Text Identity a
-&gt; ParsecT Void Text Identity a -&gt; ParsecT Void Text Identity a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hidden
</span><a href="Unison.Codebase.Transcript.html#HideOutput"><span class="hs-identifier hs-var">HideOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Hidden -&gt; ParsecT Void Text Identity Text -&gt; P Hidden
forall a b.
a -&gt; ParsecT Void Text Identity b -&gt; ParsecT Void Text Identity a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ParsecT Void Text Identity Text
</span><a href="Unison.Codebase.Transcript.Parser.html#word"><span class="hs-identifier hs-var">word</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;:hide&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><span class="annottext">P Hidden -&gt; P Hidden -&gt; P Hidden
forall a.
ParsecT Void Text Identity a
-&gt; ParsecT Void Text Identity a -&gt; ParsecT Void Text Identity a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Hidden -&gt; P Hidden
forall a. a -&gt; ParsecT Void Text Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Hidden
</span><a href="Unison.Codebase.Transcript.html#Shown"><span class="hs-identifier hs-var">Shown</span></a></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#expectingError"><span class="hs-identifier hs-type">expectingError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.html#ExpectingError"><span class="hs-identifier hs-type">ExpectingError</span></a></span><span>
</span><span id="line-146"></span><span id="expectingError"><span class="annot"><span class="annottext">expectingError :: P ExpectingError
</span><a href="Unison.Codebase.Transcript.Parser.html#expectingError"><span class="hs-identifier hs-var hs-var">expectingError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; ExpectingError
forall a. Maybe a -&gt; ExpectingError
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; ExpectingError)
-&gt; ParsecT Void Text Identity (Maybe Text) -&gt; P ExpectingError
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity Text
-&gt; ParsecT Void Text Identity (Maybe Text)
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f (Maybe a)
</span><span class="hs-identifier hs-var">optional</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; ParsecT Void Text Identity Text
</span><a href="Unison.Codebase.Transcript.Parser.html#word"><span class="hs-identifier hs-var">word</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;:error&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#untilSpace1"><span class="hs-identifier hs-type">untilSpace1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-149"></span><span id="untilSpace1"><span class="annot"><span class="annottext">untilSpace1 :: ParsecT Void Text Identity Text
</span><a href="Unison.Codebase.Transcript.Parser.html#untilSpace1"><span class="hs-identifier hs-var hs-var">untilSpace1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String
-&gt; (Token Text -&gt; ExpectingError)
-&gt; ParsecT Void Text Identity (Tokens Text)
forall e s (m :: * -&gt; *).
MonadParsec e s m =&gt;
Maybe String -&gt; (Token s -&gt; ExpectingError) -&gt; m (Tokens s)
</span><span class="hs-identifier hs-var">P.takeWhile1P</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpectingError -&gt; ExpectingError
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(ExpectingError -&gt; ExpectingError)
-&gt; (Char -&gt; ExpectingError) -&gt; Char -&gt; ExpectingError
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; ExpectingError
</span><span class="hs-identifier hs-var">Char.isSpace</span></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#language"><span class="hs-identifier hs-type">language</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-152"></span><span id="language"><span class="annot"><span class="annottext">language :: ParsecT Void Text Identity Text
</span><a href="Unison.Codebase.Transcript.Parser.html#language"><span class="hs-identifier hs-var hs-var">language</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String
-&gt; (Token Text -&gt; ExpectingError)
-&gt; ParsecT Void Text Identity (Tokens Text)
forall e s (m :: * -&gt; *).
MonadParsec e s m =&gt;
Maybe String -&gt; (Token s -&gt; ExpectingError) -&gt; m (Tokens s)
</span><span class="hs-identifier hs-var">P.takeWhileP</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680873903"><span class="annot"><span class="annottext">Token Text
</span><a href="#local-6989586621680873903"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char -&gt; ExpectingError
</span><span class="hs-identifier hs-var">Char.isDigit</span></span><span> </span><span class="annot"><span class="annottext">Char
Token Text
</span><a href="#local-6989586621680873903"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">ExpectingError -&gt; ExpectingError -&gt; ExpectingError
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; ExpectingError
</span><span class="hs-identifier hs-var">Char.isLower</span></span><span> </span><span class="annot"><span class="annottext">Char
Token Text
</span><a href="#local-6989586621680873903"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">ExpectingError -&gt; ExpectingError -&gt; ExpectingError
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Char
Token Text
</span><a href="#local-6989586621680873903"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; ExpectingError
forall a. Eq a =&gt; a -&gt; a -&gt; ExpectingError
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'_'</span></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#spaces"><span class="hs-identifier hs-type">spaces</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span id="spaces"><span class="annot"><span class="annottext">spaces :: ParsecT Void Text Identity ()
</span><a href="Unison.Codebase.Transcript.Parser.html#spaces"><span class="hs-identifier hs-var hs-var">spaces</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ParsecT Void Text Identity (Tokens Text)
-&gt; ParsecT Void Text Identity ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(ParsecT Void Text Identity (Tokens Text)
 -&gt; ParsecT Void Text Identity ())
-&gt; ParsecT Void Text Identity (Tokens Text)
-&gt; ParsecT Void Text Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
-&gt; (Token Text -&gt; ExpectingError)
-&gt; ParsecT Void Text Identity (Tokens Text)
forall e s (m :: * -&gt; *).
MonadParsec e s m =&gt;
Maybe String -&gt; (Token s -&gt; ExpectingError) -&gt; m (Tokens s)
</span><span class="hs-identifier hs-var">P.takeWhileP</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spaces&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Char -&gt; ExpectingError
Token Text -&gt; ExpectingError
</span><span class="hs-identifier hs-var">Char.isSpace</span></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-comment">-- | Create a parser state that has source locations that match the file (as opposed to being relative to the start of</span><span>
</span><span id="line-158"></span><span class="hs-comment">--   the individual fenced code block).</span><span>
</span><span id="line-159"></span><span class="hs-comment">--</span><span>
</span><span id="line-160"></span><span class="hs-comment">--  __NB__: If a code block has a fence longer than the minimum (three backticks), the columns for parse errors in the</span><span>
</span><span id="line-161"></span><span class="hs-comment">--          info string will be slightly off (but the printed code excerpt will match the reported positions).</span><span>
</span><span id="line-162"></span><span class="hs-comment">--</span><span>
</span><span id="line-163"></span><span class="hs-comment">--  __NB__: Creating custom states is likely simpler starting with Megaparsec 9.6.0.</span><span>
</span><span id="line-164"></span><span id="local-6989586621680873593"><span class="annot"><a href="Unison.Codebase.Transcript.Parser.html#fencedState"><span class="hs-identifier hs-type">fencedState</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><span class="hs-comment">-- | file containing the fenced code block</span></span><span>
</span><span id="line-166"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-167"></span><span>  </span><span class="annot"><span class="hs-comment">-- | `CMark.startLine` for the block</span></span><span>
</span><span id="line-168"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-169"></span><span>  </span><span class="annot"><span class="hs-comment">-- | `CMark.startColumn` for the block`</span></span><span>
</span><span id="line-170"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-171"></span><span>  </span><span class="annot"><span class="hs-comment">-- | info string from the block</span></span><span>
</span><span id="line-172"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-173"></span><span>  </span><span class="annot"><span class="hs-comment">-- | contents of the code block</span></span><span>
</span><span id="line-174"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-175"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">P.State</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="#local-6989586621680873593"><span class="hs-identifier hs-type">e</span></a></span></span><span>
</span><span id="line-176"></span><span id="fencedState"><span class="annot"><span class="annottext">fencedState :: forall e. String -&gt; Int -&gt; Int -&gt; Text -&gt; Text -&gt; State Text e
</span><a href="Unison.Codebase.Transcript.Parser.html#fencedState"><span class="hs-identifier hs-var hs-var">fencedState</span></a></span></span><span> </span><span id="local-6989586621680873912"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680873912"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680873913"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680873913"><span class="hs-identifier hs-var">startLine</span></a></span></span><span> </span><span id="local-6989586621680873914"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680873914"><span class="hs-identifier hs-var">startColumn</span></a></span></span><span> </span><span id="local-6989586621680873915"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873915"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621680873916"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873916"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- This is the most common opening fence, so we assume it&#8217;s the right one. I don&#8217;t think there&#8217;s any way to get</span><span>
</span><span id="line-178"></span><span>      </span><span class="hs-comment">-- the actual size of the fence from &quot;CMark&quot;, so this can be wrong sometimes, but it&#8217;s probably the approach</span><span>
</span><span id="line-179"></span><span>      </span><span class="hs-comment">-- that&#8217;s least likely to confuse users.</span><span>
</span><span id="line-180"></span><span>      </span><span id="local-6989586621680873918"><span class="annot"><span class="annottext">openingFence :: String
</span><a href="#local-6989586621680873918"><span class="hs-identifier hs-var hs-var">openingFence</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;``` &quot;</span></span><span>
</span><span id="line-181"></span><span>      </span><span class="hs-comment">-- Glue the info string and body back together, as if they hadn&#8217;t been split by &quot;CMark&quot;. This keeps the position</span><span>
</span><span id="line-182"></span><span>      </span><span class="hs-comment">-- info in sync.</span><span>
</span><span id="line-183"></span><span>      </span><span id="local-6989586621680873919"><span class="annot"><span class="annottext">s :: Text
</span><a href="#local-6989586621680873919"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873915"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873916"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-184"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.State</span></span><span>
</span><span id="line-185"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">stateInput :: Text
</span><span class="hs-identifier hs-var">stateInput</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873919"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-186"></span><span>          </span><span class="annot"><span class="annottext">stateOffset :: Int
</span><span class="hs-identifier hs-var">stateOffset</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-187"></span><span>          </span><span class="annot"><span class="annottext">statePosState :: PosState Text
</span><span class="hs-identifier hs-var">statePosState</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-188"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">P.PosState</span></span><span>
</span><span id="line-189"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pstateInput :: Text
</span><span class="hs-identifier hs-var">pstateInput</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680873919"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-190"></span><span>                </span><span class="annot"><span class="annottext">pstateOffset :: Int
</span><span class="hs-identifier hs-var">pstateOffset</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-191"></span><span>                </span><span class="hs-comment">-- `CMark.startColumn` marks the beginning of the fence, not the beginning of the info string, so we</span><span>
</span><span id="line-192"></span><span>                </span><span class="hs-comment">-- adjust it for the fence that precedes it.</span><span>
</span><span id="line-193"></span><span>                </span><span class="annot"><span class="annottext">pstateSourcePos :: SourcePos
</span><span class="hs-identifier hs-var">pstateSourcePos</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Pos -&gt; Pos -&gt; SourcePos
</span><span class="hs-identifier hs-var">P.SourcePos</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680873912"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Pos
</span><span class="hs-identifier hs-var">P.mkPos</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680873913"><span class="hs-identifier hs-var">startLine</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Pos -&gt; SourcePos) -&gt; (Int -&gt; Pos) -&gt; Int -&gt; SourcePos
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Pos
</span><span class="hs-identifier hs-var">P.mkPos</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; SourcePos) -&gt; Int -&gt; SourcePos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680873914"><span class="hs-identifier hs-var">startColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680873918"><span class="hs-identifier hs-var">openingFence</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-194"></span><span>                </span><span class="annot"><span class="annottext">pstateTabWidth :: Pos
</span><span class="hs-identifier hs-var">pstateTabWidth</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pos
</span><span class="hs-identifier hs-var">P.defaultTabWidth</span></span><span class="hs-special">,</span><span>
</span><span id="line-195"></span><span>                </span><span class="hs-comment">-- Ensure we print the fence as part of the line if there&#8217;s a parse error in the info string.</span><span>
</span><span id="line-196"></span><span>                </span><span class="annot"><span class="annottext">pstateLinePrefix :: String
</span><span class="hs-identifier hs-var">pstateLinePrefix</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680873918"><span class="hs-identifier hs-var">openingFence</span></a></span><span>
</span><span id="line-197"></span><span>              </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-198"></span><span>          </span><span class="annot"><span class="annottext">stateParseErrors :: [ParseError Text e]
</span><span class="hs-identifier hs-var">stateParseErrors</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-199"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-200"></span></pre></body></html>