<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.LSP.Types</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Colog.Core</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Lens'</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Comonad.Cofree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Cofree</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Comonad.Cofree</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cofree</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">List</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(:&lt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Aeson</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntervalMap.Lazy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IntervalMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntervalMap.Lazy</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IM</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ki</span></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Logging</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LSP</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Lens</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Message</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MessageDirection</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MessageKind</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Method</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TMessage</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TNotificationMessage</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromServerNot</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Types</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Server</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Server</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LSP</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.VFS</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.ProjectPath</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PP</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Runtime</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Runtime</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Debug</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Debug</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.LSP.Orphans.html"><span class="hs-identifier">Unison.LSP.Orphans</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.LabeledDependency</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">LabeledDependency</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Names</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Names</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PrettyPrintEnvDecl</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Referent</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Result</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Note</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Server.Backend</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Backend</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Server.NameSearch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NameSearch</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Sqlite</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Sqlite</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Symbol</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.Lexer.Unison</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Lexer</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Type</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.UnisonFile</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UF</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.UnisonFile.Summary</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">FileSummary</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UnliftIO</span></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="annot"><span class="hs-comment">-- | A custom LSP monad wrapper so we can provide our own environment.</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">newtype</span><span> </span><span id="Lsp"><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-var">Lsp</span></a></span></span><span> </span><span id="local-6989586621680877436"><span class="annot"><a href="#local-6989586621680877436"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Lsp"><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-var">Lsp</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3ArunLspM%3ALsp"><span class="annot"><span class="annottext">forall a. Lsp a -&gt; ReaderT Env (LspM Config) a
</span><a href="Unison.LSP.Types.html#%24sel%3ArunLspM%3ALsp"><span class="hs-identifier hs-var hs-var">runLspM</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LspM</span></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680877436"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680877774"><span id="local-6989586621680877780"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; Lsp a -&gt; Lsp b)
-&gt; (forall a b. a -&gt; Lsp b -&gt; Lsp a) -&gt; Functor Lsp
forall a b. a -&gt; Lsp b -&gt; Lsp a
forall a b. (a -&gt; b) -&gt; Lsp a -&gt; Lsp b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; Lsp a -&gt; Lsp b
fmap :: forall a b. (a -&gt; b) -&gt; Lsp a -&gt; Lsp b
$c&lt;$ :: forall a b. a -&gt; Lsp b -&gt; Lsp a
&lt;$ :: forall a b. a -&gt; Lsp b -&gt; Lsp a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680877793"><span id="local-6989586621680877799"><span id="local-6989586621680877804"><span id="local-6989586621680877809"><span id="local-6989586621680877814"><span class="annot"><span class="annottext">Functor Lsp
Functor Lsp =&gt;
(forall a. a -&gt; Lsp a)
-&gt; (forall a b. Lsp (a -&gt; b) -&gt; Lsp a -&gt; Lsp b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; Lsp a -&gt; Lsp b -&gt; Lsp c)
-&gt; (forall a b. Lsp a -&gt; Lsp b -&gt; Lsp b)
-&gt; (forall a b. Lsp a -&gt; Lsp b -&gt; Lsp a)
-&gt; Applicative Lsp
forall a. a -&gt; Lsp a
forall a b. Lsp a -&gt; Lsp b -&gt; Lsp a
forall a b. Lsp a -&gt; Lsp b -&gt; Lsp b
forall a b. Lsp (a -&gt; b) -&gt; Lsp a -&gt; Lsp b
forall a b c. (a -&gt; b -&gt; c) -&gt; Lsp a -&gt; Lsp b -&gt; Lsp c
forall (f :: * -&gt; *).
Functor f =&gt;
(forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
$cpure :: forall a. a -&gt; Lsp a
pure :: forall a. a -&gt; Lsp a
$c&lt;*&gt; :: forall a b. Lsp (a -&gt; b) -&gt; Lsp a -&gt; Lsp b
&lt;*&gt; :: forall a b. Lsp (a -&gt; b) -&gt; Lsp a -&gt; Lsp b
$cliftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; Lsp a -&gt; Lsp b -&gt; Lsp c
liftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; Lsp a -&gt; Lsp b -&gt; Lsp c
$c*&gt; :: forall a b. Lsp a -&gt; Lsp b -&gt; Lsp b
*&gt; :: forall a b. Lsp a -&gt; Lsp b -&gt; Lsp b
$c&lt;* :: forall a b. Lsp a -&gt; Lsp b -&gt; Lsp a
&lt;* :: forall a b. Lsp a -&gt; Lsp b -&gt; Lsp a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680877830"><span id="local-6989586621680877836"><span id="local-6989586621680877841"><span class="annot"><span class="annottext">Applicative Lsp
Applicative Lsp =&gt;
(forall a b. Lsp a -&gt; (a -&gt; Lsp b) -&gt; Lsp b)
-&gt; (forall a b. Lsp a -&gt; Lsp b -&gt; Lsp b)
-&gt; (forall a. a -&gt; Lsp a)
-&gt; Monad Lsp
forall a. a -&gt; Lsp a
forall a b. Lsp a -&gt; Lsp b -&gt; Lsp b
forall a b. Lsp a -&gt; (a -&gt; Lsp b) -&gt; Lsp b
forall (m :: * -&gt; *).
Applicative m =&gt;
(forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
$c&gt;&gt;= :: forall a b. Lsp a -&gt; (a -&gt; Lsp b) -&gt; Lsp b
&gt;&gt;= :: forall a b. Lsp a -&gt; (a -&gt; Lsp b) -&gt; Lsp b
$c&gt;&gt; :: forall a b. Lsp a -&gt; Lsp b -&gt; Lsp b
&gt;&gt; :: forall a b. Lsp a -&gt; Lsp b -&gt; Lsp b
$creturn :: forall a. a -&gt; Lsp a
return :: forall a. a -&gt; Lsp a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680877854"><span class="annot"><span class="annottext">Monad Lsp
Monad Lsp =&gt; (forall a. IO a -&gt; Lsp a) -&gt; MonadIO Lsp
forall a. IO a -&gt; Lsp a
forall (m :: * -&gt; *).
Monad m =&gt;
(forall a. IO a -&gt; m a) -&gt; MonadIO m
$cliftIO :: forall a. IO a -&gt; Lsp a
liftIO :: forall a. IO a -&gt; Lsp a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680877866"><span class="annot"><span class="annottext">MonadIO Lsp
MonadIO Lsp =&gt;
(forall b. ((forall a. Lsp a -&gt; IO a) -&gt; IO b) -&gt; Lsp b)
-&gt; MonadUnliftIO Lsp
forall b. ((forall a. Lsp a -&gt; IO a) -&gt; IO b) -&gt; Lsp b
forall (m :: * -&gt; *).
MonadIO m =&gt;
(forall b. ((forall a. m a -&gt; IO a) -&gt; IO b) -&gt; m b)
-&gt; MonadUnliftIO m
$cwithRunInIO :: forall b. ((forall a. Lsp a -&gt; IO a) -&gt; IO b) -&gt; Lsp b
withRunInIO :: forall b. ((forall a. Lsp a -&gt; IO a) -&gt; IO b) -&gt; Lsp b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadUnliftIO</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680877879"><span id="local-6989586621680877885"><span id="local-6989586621680877890"><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680877901"><span class="annot"><span class="hs-identifier hs-type">MonadLsp</span></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="annot"><span class="hs-comment">-- | Log an info message to the client's LSP log.</span></span><span>
</span><span id="line-55"></span><span class="annot"><a href="Unison.LSP.Types.html#logInfo"><span class="hs-identifier hs-type">logInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-type">Lsp</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span id="logInfo"><span class="annot"><span class="annottext">logInfo :: Text -&gt; Lsp ()
</span><a href="Unison.LSP.Types.html#logInfo"><span class="hs-identifier hs-var hs-var">logInfo</span></a></span></span><span> </span><span id="local-6989586621680877910"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680877910"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogAction</span></span><span> </span><span id="local-6989586621680877918"><span class="annot"><span class="annottext">WithSeverity Text -&gt; Lsp ()
</span><a href="#local-6989586621680877918"><span class="hs-identifier hs-var">log</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogAction Lsp (WithSeverity Text)
forall c (m :: * -&gt; *).
MonadLsp c m =&gt;
LogAction m (WithSeverity Text)
</span><span class="hs-identifier hs-var">LSP.defaultClientLogger</span></span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><span class="annottext">WithSeverity Text -&gt; Lsp ()
</span><a href="#local-6989586621680877918"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Severity -&gt; WithSeverity Text
forall msg. msg -&gt; Severity -&gt; WithSeverity msg
</span><span class="hs-identifier hs-var">WithSeverity</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680877910"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Info</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">-- | Log an error message to the client's LSP log, this will be shown to the user in most LSP</span><span>
</span><span id="line-61"></span><span class="hs-comment">-- implementations.</span><span>
</span><span id="line-62"></span><span class="annot"><a href="Unison.LSP.Types.html#logError"><span class="hs-identifier hs-type">logError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-type">Lsp</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span id="logError"><span class="annot"><span class="annottext">logError :: Text -&gt; Lsp ()
</span><a href="Unison.LSP.Types.html#logError"><span class="hs-identifier hs-var hs-var">logError</span></a></span></span><span> </span><span id="local-6989586621680877923"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680877923"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogAction</span></span><span> </span><span id="local-6989586621680877930"><span class="annot"><span class="annottext">WithSeverity Text -&gt; Lsp ()
</span><a href="#local-6989586621680877930"><span class="hs-identifier hs-var">log</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogAction Lsp (WithSeverity Text)
forall c (m :: * -&gt; *).
MonadLsp c m =&gt;
LogAction m (WithSeverity Text)
</span><span class="hs-identifier hs-var">LSP.defaultClientLogger</span></span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><span class="annottext">WithSeverity Text -&gt; Lsp ()
</span><a href="#local-6989586621680877930"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Severity -&gt; WithSeverity Text
forall msg. msg -&gt; Severity -&gt; WithSeverity msg
</span><span class="hs-identifier hs-var">WithSeverity</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680877923"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Error</span></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="annot"><span class="hs-comment">-- | Environment for the Lsp monad.</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">data</span><span> </span><span id="Env"><span class="annot"><a href="Unison.LSP.Types.html#Env"><span class="hs-identifier hs-var">Env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Env"><span class="annot"><a href="Unison.LSP.Types.html#Env"><span class="hs-identifier hs-var">Env</span></a></span></span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- contains handlers for talking to the client.</span><span>
</span><span id="line-70"></span><span>    </span><span id="%24sel%3AlspContext%3AEnv"><span class="annot"><span class="annottext">Env -&gt; LanguageContextEnv Config
</span><a href="Unison.LSP.Types.html#%24sel%3AlspContext%3AEnv"><span class="hs-identifier hs-var hs-var">lspContext</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LanguageContextEnv</span></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>    </span><span id="%24sel%3Acodebase%3AEnv"><span class="annot"><span class="annottext">Env -&gt; Codebase IO Symbol Ann
</span><a href="Unison.LSP.Types.html#%24sel%3Acodebase%3AEnv"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>    </span><span id="%24sel%3AcurrentNamesCache%3AEnv"><span class="annot"><span class="annottext">Env -&gt; IO Names
</span><a href="Unison.LSP.Types.html#%24sel%3AcurrentNamesCache%3AEnv"><span class="hs-identifier hs-var hs-var">currentNamesCache</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>    </span><span id="%24sel%3AppedCache%3AEnv"><span class="annot"><span class="annottext">Env -&gt; IO PrettyPrintEnvDecl
</span><a href="Unison.LSP.Types.html#%24sel%3AppedCache%3AEnv"><span class="hs-identifier hs-var hs-var">ppedCache</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PrettyPrintEnvDecl</span></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>    </span><span id="%24sel%3AnameSearchCache%3AEnv"><span class="annot"><span class="annottext">Env -&gt; IO (NameSearch Transaction)
</span><a href="Unison.LSP.Types.html#%24sel%3AnameSearchCache%3AEnv"><span class="hs-identifier hs-var hs-var">nameSearchCache</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NameSearch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>    </span><span id="%24sel%3AcurrentProjectPathCache%3AEnv"><span class="annot"><span class="annottext">Env -&gt; IO ProjectPath
</span><a href="Unison.LSP.Types.html#%24sel%3AcurrentProjectPathCache%3AEnv"><span class="hs-identifier hs-var hs-var">currentProjectPathCache</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PP.ProjectPath</span></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>    </span><span id="%24sel%3AvfsVar%3AEnv"><span class="annot"><span class="annottext">Env -&gt; MVar VFS
</span><a href="Unison.LSP.Types.html#%24sel%3AvfsVar%3AEnv"><span class="hs-identifier hs-var hs-var">vfsVar</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MVar</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VFS</span></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>    </span><span id="%24sel%3Aruntime%3AEnv"><span class="annot"><span class="annottext">Env -&gt; Runtime Symbol
</span><a href="Unison.LSP.Types.html#%24sel%3Aruntime%3AEnv"><span class="hs-identifier hs-var hs-var">runtime</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-comment">-- The information we have for each file.</span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-comment">-- The MVar is filled when analysis finishes, and is emptied whenever</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-comment">-- the file has changed (until it's checked again)</span><span>
</span><span id="line-81"></span><span>    </span><span id="%24sel%3AcheckedFilesVar%3AEnv"><span class="annot"><span class="annottext">Env -&gt; TVar (Map Uri (TMVar FileAnalysis))
</span><a href="Unison.LSP.Types.html#%24sel%3AcheckedFilesVar%3AEnv"><span class="hs-identifier hs-var hs-var">checkedFilesVar</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Uri</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TMVar</span></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#FileAnalysis"><span class="hs-identifier hs-type">FileAnalysis</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>    </span><span id="%24sel%3AdirtyFilesVar%3AEnv"><span class="annot"><span class="annottext">Env -&gt; TVar (Set Uri)
</span><a href="Unison.LSP.Types.html#%24sel%3AdirtyFilesVar%3AEnv"><span class="hs-identifier hs-var hs-var">dirtyFilesVar</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Uri</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-comment">-- A map  of request IDs to an action which kills that request.</span><span>
</span><span id="line-84"></span><span>    </span><span id="%24sel%3AcancellationMapVar%3AEnv"><span class="annot"><span class="annottext">Env -&gt; TVar (Map (Int32 |? Text) (IO ()))
</span><a href="Unison.LSP.Types.html#%24sel%3AcancellationMapVar%3AEnv"><span class="hs-identifier hs-var hs-var">cancellationMapVar</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">|?</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-comment">-- A lazily computed map of all valid completion suffixes from the current path.</span><span>
</span><span id="line-86"></span><span>    </span><span id="%24sel%3AcompletionsVar%3AEnv"><span class="annot"><span class="annottext">Env -&gt; TMVar CompletionTree
</span><a href="Unison.LSP.Types.html#%24sel%3AcompletionsVar%3AEnv"><span class="hs-identifier hs-var hs-var">completionsVar</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TMVar</span></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#CompletionTree"><span class="hs-identifier hs-type">CompletionTree</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>    </span><span id="%24sel%3Ascope%3AEnv"><span class="annot"><span class="annottext">Env -&gt; Scope
</span><a href="Unison.LSP.Types.html#%24sel%3Ascope%3AEnv"><span class="hs-identifier hs-var hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ki.Scope</span></span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">-- | A suffix tree over path segments of name completions.</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- see 'namesToCompletionTree' for more on how this is built and the invariants it should have.</span><span>
</span><span id="line-92"></span><span class="hs-keyword">newtype</span><span> </span><span id="CompletionTree"><span class="annot"><a href="Unison.LSP.Types.html#CompletionTree"><span class="hs-identifier hs-var">CompletionTree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CompletionTree"><span class="annot"><a href="Unison.LSP.Types.html#CompletionTree"><span class="hs-identifier hs-var">CompletionTree</span></a></span></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AunCompletionTree%3ACompletionTree"><span class="annot"><span class="annottext">CompletionTree
-&gt; Cofree (Map NameSegment) (Set (Name, LabeledDependency))
</span><a href="Unison.LSP.Types.html#%24sel%3AunCompletionTree%3ACompletionTree"><span class="hs-identifier hs-var hs-var">unCompletionTree</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cofree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LabeledDependency</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680877949"><span id="local-6989586621680877957"><span id="local-6989586621680877961"><span class="annot"><span class="annottext">Int -&gt; CompletionTree -&gt; ShowS
[CompletionTree] -&gt; ShowS
CompletionTree -&gt; String
(Int -&gt; CompletionTree -&gt; ShowS)
-&gt; (CompletionTree -&gt; String)
-&gt; ([CompletionTree] -&gt; ShowS)
-&gt; Show CompletionTree
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; CompletionTree -&gt; ShowS
showsPrec :: Int -&gt; CompletionTree -&gt; ShowS
$cshow :: CompletionTree -&gt; String
show :: CompletionTree -&gt; String
$cshowList :: [CompletionTree] -&gt; ShowS
showList :: [CompletionTree] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680877976"><span id="local-6989586621680877980"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#CompletionTree"><span class="hs-identifier hs-type">CompletionTree</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><a href="Unison.LSP.Types.html#CompletionTree"><span class="hs-identifier hs-type">CompletionTree</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680877996"><span class="annot"><span class="annottext">Set (Name, LabeledDependency)
</span><a href="#local-6989586621680877996"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">Cofree.:&lt;</span></span><span> </span><span id="local-6989586621680877998"><span class="annot"><span class="annottext">Map
  NameSegment
  (Cofree (Map NameSegment) (Set (Name, LabeledDependency)))
</span><a href="#local-6989586621680877998"><span class="hs-identifier hs-var">subtreeA</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680877999"><span class="annot"><span class="annottext">&lt;&gt; :: CompletionTree -&gt; CompletionTree -&gt; CompletionTree
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#CompletionTree"><span class="hs-identifier hs-type">CompletionTree</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680878000"><span class="annot"><span class="annottext">Set (Name, LabeledDependency)
</span><a href="#local-6989586621680878000"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">Cofree.:&lt;</span></span><span> </span><span id="local-6989586621680878001"><span class="annot"><span class="annottext">Map
  NameSegment
  (Cofree (Map NameSegment) (Set (Name, LabeledDependency)))
</span><a href="#local-6989586621680878001"><span class="hs-identifier hs-var">subtreeB</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><span class="annottext">Cofree (Map NameSegment) (Set (Name, LabeledDependency))
-&gt; CompletionTree
</span><a href="Unison.LSP.Types.html#CompletionTree"><span class="hs-identifier hs-var">CompletionTree</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (Name, LabeledDependency)
</span><a href="#local-6989586621680877996"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Name, LabeledDependency)
-&gt; Set (Name, LabeledDependency) -&gt; Set (Name, LabeledDependency)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set (Name, LabeledDependency)
</span><a href="#local-6989586621680878000"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Name, LabeledDependency)
-&gt; Map
     NameSegment
     (Cofree (Map NameSegment) (Set (Name, LabeledDependency)))
-&gt; Cofree (Map NameSegment) (Set (Name, LabeledDependency))
forall (f :: * -&gt; *) a. a -&gt; f (Cofree f a) -&gt; Cofree f a
</span><span class="hs-operator hs-var">Cofree.:&lt;</span></span><span> </span><span class="annot"><span class="annottext">(Cofree (Map NameSegment) (Set (Name, LabeledDependency))
 -&gt; Cofree (Map NameSegment) (Set (Name, LabeledDependency))
 -&gt; Cofree (Map NameSegment) (Set (Name, LabeledDependency)))
-&gt; Map
     NameSegment
     (Cofree (Map NameSegment) (Set (Name, LabeledDependency)))
-&gt; Map
     NameSegment
     (Cofree (Map NameSegment) (Set (Name, LabeledDependency)))
-&gt; Map
     NameSegment
     (Cofree (Map NameSegment) (Set (Name, LabeledDependency)))
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.unionWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680878003"><span class="annot"><span class="annottext">Cofree (Map NameSegment) (Set (Name, LabeledDependency))
</span><a href="#local-6989586621680878003"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680878004"><span class="annot"><span class="annottext">Cofree (Map NameSegment) (Set (Name, LabeledDependency))
</span><a href="#local-6989586621680878004"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompletionTree
-&gt; Cofree (Map NameSegment) (Set (Name, LabeledDependency))
</span><a href="Unison.LSP.Types.html#%24sel%3AunCompletionTree%3ACompletionTree"><span class="hs-identifier hs-var">unCompletionTree</span></a></span><span> </span><span class="annot"><span class="annottext">(CompletionTree
 -&gt; Cofree (Map NameSegment) (Set (Name, LabeledDependency)))
-&gt; CompletionTree
-&gt; Cofree (Map NameSegment) (Set (Name, LabeledDependency))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cofree (Map NameSegment) (Set (Name, LabeledDependency))
-&gt; CompletionTree
</span><a href="Unison.LSP.Types.html#CompletionTree"><span class="hs-identifier hs-var">CompletionTree</span></a></span><span> </span><span class="annot"><span class="annottext">Cofree (Map NameSegment) (Set (Name, LabeledDependency))
</span><a href="#local-6989586621680878003"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">CompletionTree -&gt; CompletionTree -&gt; CompletionTree
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Cofree (Map NameSegment) (Set (Name, LabeledDependency))
-&gt; CompletionTree
</span><a href="Unison.LSP.Types.html#CompletionTree"><span class="hs-identifier hs-var">CompletionTree</span></a></span><span> </span><span class="annot"><span class="annottext">Cofree (Map NameSegment) (Set (Name, LabeledDependency))
</span><a href="#local-6989586621680878004"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map
  NameSegment
  (Cofree (Map NameSegment) (Set (Name, LabeledDependency)))
</span><a href="#local-6989586621680877998"><span class="hs-identifier hs-var">subtreeA</span></a></span><span> </span><span class="annot"><span class="annottext">Map
  NameSegment
  (Cofree (Map NameSegment) (Set (Name, LabeledDependency)))
</span><a href="#local-6989586621680878001"><span class="hs-identifier hs-var">subtreeB</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680878009"><span id="local-6989586621680878013"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#CompletionTree"><span class="hs-identifier hs-type">CompletionTree</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-102"></span><span>  </span><span id="local-6989586621680878024"><span class="annot"><span class="annottext">mempty :: CompletionTree
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cofree (Map NameSegment) (Set (Name, LabeledDependency))
-&gt; CompletionTree
</span><a href="Unison.LSP.Types.html#CompletionTree"><span class="hs-identifier hs-var">CompletionTree</span></a></span><span> </span><span class="annot"><span class="annottext">(Cofree (Map NameSegment) (Set (Name, LabeledDependency))
 -&gt; CompletionTree)
-&gt; Cofree (Map NameSegment) (Set (Name, LabeledDependency))
-&gt; CompletionTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set (Name, LabeledDependency)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Set (Name, LabeledDependency)
-&gt; Map
     NameSegment
     (Cofree (Map NameSegment) (Set (Name, LabeledDependency)))
-&gt; Cofree (Map NameSegment) (Set (Name, LabeledDependency))
forall (f :: * -&gt; *) a. a -&gt; f (Cofree f a) -&gt; Cofree f a
</span><span class="hs-operator hs-var">Cofree.:&lt;</span></span><span> </span><span class="annot"><span class="annottext">Map
  NameSegment
  (Cofree (Map NameSegment) (Set (Name, LabeledDependency)))
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="annot"><span class="hs-comment">-- | A monotonically increasing file version tracked by the lsp client.</span></span><span>
</span><span id="line-105"></span><span class="hs-keyword">type</span><span> </span><span id="FileVersion"><span class="annot"><a href="Unison.LSP.Types.html#FileVersion"><span class="hs-identifier hs-var">FileVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-keyword">type</span><span> </span><span id="LexedSource"><span class="annot"><a href="Unison.LSP.Types.html#LexedSource"><span class="hs-identifier hs-var">LexedSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Lexer.Token</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lexer.Lexeme</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-keyword">data</span><span> </span><span id="TypeSignatureHint"><span class="annot"><a href="Unison.LSP.Types.html#TypeSignatureHint"><span class="hs-identifier hs-var">TypeSignatureHint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TypeSignatureHint"><span class="annot"><a href="Unison.LSP.Types.html#TypeSignatureHint"><span class="hs-identifier hs-var">TypeSignatureHint</span></a></span></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Aname%3ATypeSignatureHint"><span class="annot"><span class="annottext">TypeSignatureHint -&gt; Name
</span><a href="Unison.LSP.Types.html#%24sel%3Aname%3ATypeSignatureHint"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>    </span><span id="%24sel%3Areferent%3ATypeSignatureHint"><span class="annot"><span class="annottext">TypeSignatureHint -&gt; Referent
</span><a href="Unison.LSP.Types.html#%24sel%3Areferent%3ATypeSignatureHint"><span class="hs-identifier hs-var hs-var">referent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>    </span><span id="%24sel%3AbindingLocation%3ATypeSignatureHint"><span class="annot"><span class="annottext">TypeSignatureHint -&gt; Range
</span><a href="Unison.LSP.Types.html#%24sel%3AbindingLocation%3ATypeSignatureHint"><span class="hs-identifier hs-var hs-var">bindingLocation</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Range</span></span><span class="hs-special">,</span><span>
</span><span id="line-113"></span><span>    </span><span id="%24sel%3Asignature%3ATypeSignatureHint"><span class="annot"><span class="annottext">TypeSignatureHint -&gt; Type Symbol Ann
</span><a href="Unison.LSP.Types.html#%24sel%3Asignature%3ATypeSignatureHint"><span class="hs-keyword hs-var hs-var">signature</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680878032"><span id="local-6989586621680878045"><span id="local-6989586621680878049"><span class="annot"><span class="annottext">Int -&gt; TypeSignatureHint -&gt; ShowS
[TypeSignatureHint] -&gt; ShowS
TypeSignatureHint -&gt; String
(Int -&gt; TypeSignatureHint -&gt; ShowS)
-&gt; (TypeSignatureHint -&gt; String)
-&gt; ([TypeSignatureHint] -&gt; ShowS)
-&gt; Show TypeSignatureHint
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; TypeSignatureHint -&gt; ShowS
showsPrec :: Int -&gt; TypeSignatureHint -&gt; ShowS
$cshow :: TypeSignatureHint -&gt; String
show :: TypeSignatureHint -&gt; String
$cshowList :: [TypeSignatureHint] -&gt; ShowS
showList :: [TypeSignatureHint] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-keyword">data</span><span> </span><span id="FileAnalysis"><span class="annot"><a href="Unison.LSP.Types.html#FileAnalysis"><span class="hs-identifier hs-var">FileAnalysis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FileAnalysis"><span class="annot"><a href="Unison.LSP.Types.html#FileAnalysis"><span class="hs-identifier hs-var">FileAnalysis</span></a></span></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AfileUri%3AFileAnalysis"><span class="annot"><span class="annottext">FileAnalysis -&gt; Uri
</span><a href="Unison.LSP.Types.html#%24sel%3AfileUri%3AFileAnalysis"><span class="hs-identifier hs-var hs-var">fileUri</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Uri</span></span><span class="hs-special">,</span><span>
</span><span id="line-119"></span><span>    </span><span id="%24sel%3AfileVersion%3AFileAnalysis"><span class="annot"><span class="annottext">FileAnalysis -&gt; Int32
</span><a href="Unison.LSP.Types.html#%24sel%3AfileVersion%3AFileAnalysis"><span class="hs-identifier hs-var hs-var">fileVersion</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#FileVersion"><span class="hs-identifier hs-type">FileVersion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-120"></span><span>    </span><span id="%24sel%3AlexedSource%3AFileAnalysis"><span class="annot"><span class="annottext">FileAnalysis -&gt; LexedSource
</span><a href="Unison.LSP.Types.html#%24sel%3AlexedSource%3AFileAnalysis"><span class="hs-identifier hs-var hs-var">lexedSource</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#LexedSource"><span class="hs-identifier hs-type">LexedSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-121"></span><span>    </span><span id="%24sel%3AtokenMap%3AFileAnalysis"><span class="annot"><span class="annottext">FileAnalysis -&gt; IntervalMap Position Lexeme
</span><a href="Unison.LSP.Types.html#%24sel%3AtokenMap%3AFileAnalysis"><span class="hs-identifier hs-var hs-var">tokenMap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IM.IntervalMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Position</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lexer.Lexeme</span></span><span class="hs-special">,</span><span>
</span><span id="line-122"></span><span>    </span><span id="%24sel%3AparsedFile%3AFileAnalysis"><span class="annot"><span class="annottext">FileAnalysis -&gt; Maybe (UnisonFile Symbol Ann)
</span><a href="Unison.LSP.Types.html#%24sel%3AparsedFile%3AFileAnalysis"><span class="hs-identifier hs-var hs-var">parsedFile</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UF.UnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-123"></span><span>    </span><span id="%24sel%3AtypecheckedFile%3AFileAnalysis"><span class="annot"><span class="annottext">FileAnalysis -&gt; Maybe (TypecheckedUnisonFile Symbol Ann)
</span><a href="Unison.LSP.Types.html#%24sel%3AtypecheckedFile%3AFileAnalysis"><span class="hs-identifier hs-var hs-var">typecheckedFile</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UF.TypecheckedUnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-124"></span><span>    </span><span id="%24sel%3Anotes%3AFileAnalysis"><span class="annot"><span class="annottext">FileAnalysis -&gt; Seq (Note Symbol Ann)
</span><a href="Unison.LSP.Types.html#%24sel%3Anotes%3AFileAnalysis"><span class="hs-identifier hs-var hs-var">notes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Note</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-125"></span><span>    </span><span id="%24sel%3Adiagnostics%3AFileAnalysis"><span class="annot"><span class="annottext">FileAnalysis -&gt; IntervalMap Position [Diagnostic]
</span><a href="Unison.LSP.Types.html#%24sel%3Adiagnostics%3AFileAnalysis"><span class="hs-identifier hs-var hs-var">diagnostics</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntervalMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Position</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Diagnostic</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-126"></span><span>    </span><span id="%24sel%3AcodeActions%3AFileAnalysis"><span class="annot"><span class="annottext">FileAnalysis -&gt; IntervalMap Position [CodeAction]
</span><a href="Unison.LSP.Types.html#%24sel%3AcodeActions%3AFileAnalysis"><span class="hs-identifier hs-var hs-var">codeActions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntervalMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Position</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">CodeAction</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-127"></span><span>    </span><span id="%24sel%3AtypeSignatureHints%3AFileAnalysis"><span class="annot"><span class="annottext">FileAnalysis -&gt; Map Symbol TypeSignatureHint
</span><a href="Unison.LSP.Types.html#%24sel%3AtypeSignatureHints%3AFileAnalysis"><span class="hs-identifier hs-var hs-var">typeSignatureHints</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#TypeSignatureHint"><span class="hs-identifier hs-type">TypeSignatureHint</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-128"></span><span>    </span><span id="%24sel%3AfileSummary%3AFileAnalysis"><span class="annot"><span class="annottext">FileAnalysis -&gt; Maybe FileSummary
</span><a href="Unison.LSP.Types.html#%24sel%3AfileSummary%3AFileAnalysis"><span class="hs-identifier hs-var hs-var">fileSummary</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FileSummary</span></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680878070"><span id="local-6989586621680878102"><span id="local-6989586621680878106"><span class="annot"><span class="annottext">Int -&gt; FileAnalysis -&gt; ShowS
[FileAnalysis] -&gt; ShowS
FileAnalysis -&gt; String
(Int -&gt; FileAnalysis -&gt; ShowS)
-&gt; (FileAnalysis -&gt; String)
-&gt; ([FileAnalysis] -&gt; ShowS)
-&gt; Show FileAnalysis
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; FileAnalysis -&gt; ShowS
showsPrec :: Int -&gt; FileAnalysis -&gt; ShowS
$cshow :: FileAnalysis -&gt; String
show :: FileAnalysis -&gt; String
$cshowList :: [FileAnalysis] -&gt; ShowS
showList :: [FileAnalysis] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="annot"><a href="Unison.LSP.Types.html#getCurrentProjectPath"><span class="hs-identifier hs-type">getCurrentProjectPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-type">Lsp</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PP.ProjectPath</span></span><span>
</span><span id="line-133"></span><span id="getCurrentProjectPath"><span class="annot"><span class="annottext">getCurrentProjectPath :: Lsp ProjectPath
</span><a href="Unison.LSP.Types.html#getCurrentProjectPath"><span class="hs-identifier hs-var hs-var">getCurrentProjectPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; IO ProjectPath) -&gt; Lsp (IO ProjectPath)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; IO ProjectPath
</span><a href="Unison.LSP.Types.html#%24sel%3AcurrentProjectPathCache%3AEnv"><span class="hs-identifier hs-var">currentProjectPathCache</span></a></span><span> </span><span class="annot"><span class="annottext">Lsp (IO ProjectPath)
-&gt; (IO ProjectPath -&gt; Lsp ProjectPath) -&gt; Lsp ProjectPath
forall a b. Lsp a -&gt; (a -&gt; Lsp b) -&gt; Lsp b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">IO ProjectPath -&gt; Lsp ProjectPath
forall a. IO a -&gt; Lsp a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="annot"><a href="Unison.LSP.Types.html#getCodebaseCompletions"><span class="hs-identifier hs-type">getCodebaseCompletions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-type">Lsp</span></a></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#CompletionTree"><span class="hs-identifier hs-type">CompletionTree</span></a></span><span>
</span><span id="line-136"></span><span id="getCodebaseCompletions"><span class="annot"><span class="annottext">getCodebaseCompletions :: Lsp CompletionTree
</span><a href="Unison.LSP.Types.html#getCodebaseCompletions"><span class="hs-identifier hs-var hs-var">getCodebaseCompletions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; TMVar CompletionTree) -&gt; Lsp (TMVar CompletionTree)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; TMVar CompletionTree
</span><a href="Unison.LSP.Types.html#%24sel%3AcompletionsVar%3AEnv"><span class="hs-identifier hs-var">completionsVar</span></a></span><span> </span><span class="annot"><span class="annottext">Lsp (TMVar CompletionTree)
-&gt; (TMVar CompletionTree -&gt; Lsp CompletionTree)
-&gt; Lsp CompletionTree
forall a b. Lsp a -&gt; (a -&gt; Lsp b) -&gt; Lsp b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">STM CompletionTree -&gt; Lsp CompletionTree
forall (m :: * -&gt; *) a. MonadIO m =&gt; STM a -&gt; m a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM CompletionTree -&gt; Lsp CompletionTree)
-&gt; (TMVar CompletionTree -&gt; STM CompletionTree)
-&gt; TMVar CompletionTree
-&gt; Lsp CompletionTree
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TMVar CompletionTree -&gt; STM CompletionTree
forall a. TMVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTMVar</span></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="annot"><a href="Unison.LSP.Types.html#currentPPED"><span class="hs-identifier hs-type">currentPPED</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-type">Lsp</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PrettyPrintEnvDecl</span></span><span>
</span><span id="line-139"></span><span id="currentPPED"><span class="annot"><span class="annottext">currentPPED :: Lsp PrettyPrintEnvDecl
</span><a href="Unison.LSP.Types.html#currentPPED"><span class="hs-identifier hs-var hs-var">currentPPED</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; IO PrettyPrintEnvDecl) -&gt; Lsp (IO PrettyPrintEnvDecl)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; IO PrettyPrintEnvDecl
</span><a href="Unison.LSP.Types.html#%24sel%3AppedCache%3AEnv"><span class="hs-identifier hs-var">ppedCache</span></a></span><span> </span><span class="annot"><span class="annottext">Lsp (IO PrettyPrintEnvDecl)
-&gt; (IO PrettyPrintEnvDecl -&gt; Lsp PrettyPrintEnvDecl)
-&gt; Lsp PrettyPrintEnvDecl
forall a b. Lsp a -&gt; (a -&gt; Lsp b) -&gt; Lsp b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">IO PrettyPrintEnvDecl -&gt; Lsp PrettyPrintEnvDecl
forall a. IO a -&gt; Lsp a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="annot"><a href="Unison.LSP.Types.html#getNameSearch"><span class="hs-identifier hs-type">getNameSearch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-type">Lsp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NameSearch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span id="getNameSearch"><span class="annot"><span class="annottext">getNameSearch :: Lsp (NameSearch Transaction)
</span><a href="Unison.LSP.Types.html#getNameSearch"><span class="hs-identifier hs-var hs-var">getNameSearch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; IO (NameSearch Transaction))
-&gt; Lsp (IO (NameSearch Transaction))
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; IO (NameSearch Transaction)
</span><a href="Unison.LSP.Types.html#%24sel%3AnameSearchCache%3AEnv"><span class="hs-identifier hs-var">nameSearchCache</span></a></span><span> </span><span class="annot"><span class="annottext">Lsp (IO (NameSearch Transaction))
-&gt; (IO (NameSearch Transaction) -&gt; Lsp (NameSearch Transaction))
-&gt; Lsp (NameSearch Transaction)
forall a b. Lsp a -&gt; (a -&gt; Lsp b) -&gt; Lsp b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">IO (NameSearch Transaction) -&gt; Lsp (NameSearch Transaction)
forall a. IO a -&gt; Lsp a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="annot"><a href="Unison.LSP.Types.html#getCurrentNames"><span class="hs-identifier hs-type">getCurrentNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-type">Lsp</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span>
</span><span id="line-145"></span><span id="getCurrentNames"><span class="annot"><span class="annottext">getCurrentNames :: Lsp Names
</span><a href="Unison.LSP.Types.html#getCurrentNames"><span class="hs-identifier hs-var hs-var">getCurrentNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; IO Names) -&gt; Lsp (IO Names)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; IO Names
</span><a href="Unison.LSP.Types.html#%24sel%3AcurrentNamesCache%3AEnv"><span class="hs-identifier hs-var">currentNamesCache</span></a></span><span> </span><span class="annot"><span class="annottext">Lsp (IO Names) -&gt; (IO Names -&gt; Lsp Names) -&gt; Lsp Names
forall a b. Lsp a -&gt; (a -&gt; Lsp b) -&gt; Lsp b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">IO Names -&gt; Lsp Names
forall a. IO a -&gt; Lsp a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-keyword">data</span><span> </span><span id="Config"><span class="annot"><a href="Unison.LSP.Types.html#Config"><span class="hs-identifier hs-var">Config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Config"><span class="annot"><a href="Unison.LSP.Types.html#Config"><span class="hs-identifier hs-var">Config</span></a></span></span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AformattingWidth%3AConfig"><span class="annot"><span class="annottext">Config -&gt; Int
</span><a href="Unison.LSP.Types.html#%24sel%3AformattingWidth%3AConfig"><span class="hs-identifier hs-var hs-var">formattingWidth</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-comment">-- 'Nothing' will load ALL available completions, which is slower, but may provide a better</span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-comment">-- solution for some users.</span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-comment">-- 'Just n' will only fetch the first 'n' completions and will prompt the client to ask for</span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-comment">-- more completions after more typing.</span><span>
</span><span id="line-154"></span><span>    </span><span id="%24sel%3AmaxCompletions%3AConfig"><span class="annot"><span class="annottext">Config -&gt; Maybe Int
</span><a href="Unison.LSP.Types.html#%24sel%3AmaxCompletions%3AConfig"><span class="hs-identifier hs-var hs-var">maxCompletions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680878143"><span id="local-6989586621680878149"><span id="local-6989586621680878153"><span class="annot"><span class="annottext">Int -&gt; Config -&gt; ShowS
[Config] -&gt; ShowS
Config -&gt; String
(Int -&gt; Config -&gt; ShowS)
-&gt; (Config -&gt; String) -&gt; ([Config] -&gt; ShowS) -&gt; Show Config
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Config -&gt; ShowS
showsPrec :: Int -&gt; Config -&gt; ShowS
$cshow :: Config -&gt; String
show :: Config -&gt; String
$cshowList :: [Config] -&gt; ShowS
showList :: [Config] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680878157"><span class="annot"><span class="hs-identifier hs-type">Aeson.FromJSON</span></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-159"></span><span>  </span><span id="local-6989586621680878187"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser Config
</span><a href="#local-6989586621680878187"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (Object -&gt; Parser Config) -&gt; Value -&gt; Parser Config
forall a. String -&gt; (Object -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">Aeson.withObject</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Config&quot;</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680878190"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621680878190"><span class="hs-identifier hs-var">obj</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621680878191"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621680878191"><span class="hs-identifier hs-var">maxCompletions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621680878190"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser (Maybe (Maybe Int))
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser (Maybe a)
</span><span class="hs-operator hs-var">Aeson..:!</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;maxCompletions&quot;</span></span><span> </span><span class="annot"><span class="annottext">Parser (Maybe (Maybe Int)) -&gt; Maybe Int -&gt; Parser (Maybe Int)
forall a. Parser (Maybe a) -&gt; a -&gt; Parser a
</span><span class="hs-operator hs-var">Aeson..!=</span></span><span> </span><span class="annot"><span class="annottext">Config -&gt; Maybe Int
</span><a href="Unison.LSP.Types.html#%24sel%3AmaxCompletions%3AConfig"><span class="hs-identifier hs-var">maxCompletions</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="Unison.LSP.Types.html#defaultLSPConfig"><span class="hs-identifier hs-var">defaultLSPConfig</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><span class="annottext">DebugFlag -&gt; String -&gt; String -&gt; Parser ()
forall a (m :: * -&gt; *).
(Show a, Monad m) =&gt;
DebugFlag -&gt; String -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">Debug.debugM</span></span><span> </span><span class="annot"><span class="annottext">DebugFlag
</span><span class="hs-identifier hs-var">Debug.LSP</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Config&quot;</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Parser ()) -&gt; String -&gt; Parser ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;maxCompletions: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621680878191"><span class="hs-identifier hs-var">maxCompletions</span></a></span><span>
</span><span id="line-162"></span><span>    </span><span id="local-6989586621680878198"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680878198"><span class="hs-identifier hs-var">formattingWidth</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621680878190"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser (Maybe Int)
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser (Maybe a)
</span><span class="hs-operator hs-var">Aeson..:?</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;formattingWidth&quot;</span></span><span> </span><span class="annot"><span class="annottext">Parser (Maybe Int) -&gt; Int -&gt; Parser Int
forall a. Parser (Maybe a) -&gt; a -&gt; Parser a
</span><span class="hs-operator hs-var">Aeson..!=</span></span><span> </span><span class="annot"><span class="annottext">Config -&gt; Int
</span><a href="Unison.LSP.Types.html#%24sel%3AformattingWidth%3AConfig"><span class="hs-identifier hs-var">formattingWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="Unison.LSP.Types.html#defaultLSPConfig"><span class="hs-identifier hs-var">defaultLSPConfig</span></a></span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Int
Maybe Int
$sel:formattingWidth:Config :: Int
$sel:maxCompletions:Config :: Maybe Int
maxCompletions :: Maybe Int
formattingWidth :: Int
</span><a href="Unison.LSP.Types.html#%24sel%3AformattingWidth%3AConfig"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680878202"><span id="local-6989586621680878206"><span id="local-6989586621680878209"><span class="annot"><span class="hs-identifier hs-type">Aeson.ToJSON</span></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-166"></span><span>  </span><span id="local-6989586621680878223"><span class="annot"><span class="annottext">toJSON :: Config -&gt; Value
</span><a href="#local-6989586621680878223"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.LSP.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span> </span><span id="local-6989586621680878225"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680878225"><span class="hs-identifier hs-var">formattingWidth</span></a></span></span><span> </span><span id="local-6989586621680878226"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621680878226"><span class="hs-identifier hs-var">maxCompletions</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">Aeson.object</span></span><span>
</span><span id="line-168"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;formattingWidth&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Int -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><span class="hs-operator hs-var">Aeson..=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680878225"><span class="hs-identifier hs-var">formattingWidth</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-169"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;maxCompletions&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Maybe Int -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><span class="hs-operator hs-var">Aeson..=</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621680878226"><span class="hs-identifier hs-var">maxCompletions</span></a></span><span>
</span><span id="line-170"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="annot"><a href="Unison.LSP.Types.html#defaultLSPConfig"><span class="hs-identifier hs-type">defaultLSPConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span>
</span><span id="line-173"></span><span id="defaultLSPConfig"><span class="annot"><span class="annottext">defaultLSPConfig :: Config
</span><a href="Unison.LSP.Types.html#defaultLSPConfig"><span class="hs-identifier hs-var hs-var">defaultLSPConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Int
Maybe Int
$sel:formattingWidth:Config :: Int
$sel:maxCompletions:Config :: Maybe Int
formattingWidth :: Int
maxCompletions :: Maybe Int
</span><a href="Unison.LSP.Types.html#%24sel%3AformattingWidth%3AConfig"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-175"></span><span>    </span><span id="local-6989586621680878229"><span class="annot"><span class="annottext">formattingWidth :: Int
</span><a href="#local-6989586621680878229"><span class="hs-identifier hs-var hs-var">formattingWidth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">80</span></span><span>
</span><span id="line-176"></span><span>    </span><span id="local-6989586621680878230"><span class="annot"><span class="annottext">maxCompletions :: Maybe Int
</span><a href="#local-6989586621680878230"><span class="hs-identifier hs-var hs-var">maxCompletions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100</span></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="annot"><span class="hs-comment">-- | Lift a backend computation into the Lsp monad.</span></span><span>
</span><span id="line-179"></span><span id="local-6989586621680877666"><span class="annot"><a href="Unison.LSP.Types.html#lspBackend"><span class="hs-identifier hs-type">lspBackend</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Backend.Backend</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680877666"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-type">Lsp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Backend.BackendError</span></span><span> </span><span class="annot"><a href="#local-6989586621680877666"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-180"></span><span id="lspBackend"><span class="annot"><span class="annottext">lspBackend :: forall a. Backend IO a -&gt; Lsp (Either BackendError a)
</span><a href="Unison.LSP.Types.html#lspBackend"><span class="hs-identifier hs-var hs-var">lspBackend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Either BackendError a) -&gt; Lsp (Either BackendError a)
forall a. IO a -&gt; Lsp a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either BackendError a) -&gt; Lsp (Either BackendError a))
-&gt; (Backend IO a -&gt; IO (Either BackendError a))
-&gt; Backend IO a
-&gt; Lsp (Either BackendError a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ExceptT BackendError IO a -&gt; IO (Either BackendError a)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT BackendError IO a -&gt; IO (Either BackendError a))
-&gt; (Backend IO a -&gt; ExceptT BackendError IO a)
-&gt; Backend IO a
-&gt; IO (Either BackendError a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ReaderT BackendEnv (ExceptT BackendError IO) a
 -&gt; BackendEnv -&gt; ExceptT BackendError IO a)
-&gt; BackendEnv
-&gt; ReaderT BackendEnv (ExceptT BackendError IO) a
-&gt; ExceptT BackendError IO a
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ReaderT BackendEnv (ExceptT BackendError IO) a
-&gt; BackendEnv -&gt; ExceptT BackendError IO a
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; BackendEnv
</span><span class="hs-identifier hs-var">Backend.BackendEnv</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ReaderT BackendEnv (ExceptT BackendError IO) a
 -&gt; ExceptT BackendError IO a)
-&gt; (Backend IO a -&gt; ReaderT BackendEnv (ExceptT BackendError IO) a)
-&gt; Backend IO a
-&gt; ExceptT BackendError IO a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Backend IO a -&gt; ReaderT BackendEnv (ExceptT BackendError IO) a
forall (m :: * -&gt; *) a.
Backend m a -&gt; ReaderT BackendEnv (ExceptT BackendError m) a
</span><span class="hs-identifier hs-var">Backend.runBackend</span></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="annot"><a href="Unison.LSP.Types.html#sendNotification"><span class="hs-identifier hs-type">sendNotification</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680877686"><span class="annot"><a href="#local-6989586621680877686"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">ServerToClient</span></span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Notification</span></span><span class="hs-special">)</span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TMessage</span></span><span> </span><span class="annot"><a href="#local-6989586621680877686"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TNotificationMessage</span></span><span> </span><span class="annot"><a href="#local-6989586621680877686"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TNotificationMessage</span></span><span> </span><span class="annot"><a href="#local-6989586621680877686"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-type">Lsp</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span id="sendNotification"><span class="annot"><span class="annottext">sendNotification :: forall (m :: Method 'ServerToClient 'Notification).
(TMessage m ~ TNotificationMessage m) =&gt;
TNotificationMessage m -&gt; Lsp ()
</span><a href="Unison.LSP.Types.html#sendNotification"><span class="hs-identifier hs-var hs-var">sendNotification</span></a></span></span><span> </span><span id="local-6989586621680878249"><span class="annot"><span class="annottext">TNotificationMessage m
</span><a href="#local-6989586621680878249"><span class="hs-identifier hs-var">notif</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-184"></span><span>  </span><span id="local-6989586621680878250"><span class="annot"><span class="annottext">FromServerMessage -&gt; IO ()
</span><a href="#local-6989586621680878250"><span class="hs-identifier hs-var">sendServerMessage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; FromServerMessage -&gt; IO ())
-&gt; Lsp (FromServerMessage -&gt; IO ())
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LanguageContextEnv Config -&gt; FromServerMessage -&gt; IO ()
forall config.
LanguageContextEnv config -&gt; FromServerMessage -&gt; IO ()
</span><span class="hs-identifier hs-var">resSendMessage</span></span><span> </span><span class="annot"><span class="annottext">(LanguageContextEnv Config -&gt; FromServerMessage -&gt; IO ())
-&gt; (Env -&gt; LanguageContextEnv Config)
-&gt; Env
-&gt; FromServerMessage
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; LanguageContextEnv Config
</span><a href="Unison.LSP.Types.html#%24sel%3AlspContext%3AEnv"><span class="hs-identifier hs-var">lspContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>  </span><span class="annot"><span class="annottext">IO () -&gt; Lsp ()
forall a. IO a -&gt; Lsp a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Lsp ()) -&gt; IO () -&gt; Lsp ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FromServerMessage -&gt; IO ()
</span><a href="#local-6989586621680878250"><span class="hs-identifier hs-var">sendServerMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(FromServerMessage -&gt; IO ()) -&gt; FromServerMessage -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TNotificationMessage m -&gt; FromServerMessage
forall (m :: Method 'ServerToClient 'Notification).
(TMessage m ~ TNotificationMessage m) =&gt;
TNotificationMessage m -&gt; FromServerMessage
</span><span class="hs-identifier hs-var">fromServerNot</span></span><span> </span><span class="annot"><span class="annottext">TNotificationMessage m
</span><a href="#local-6989586621680878249"><span class="hs-identifier hs-var">notif</span></a></span><span> </span><span class="hs-comment">-- (notif ^. method) notif</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="hs-keyword">data</span><span> </span><span id="RangedCodeAction"><span class="annot"><a href="Unison.LSP.Types.html#RangedCodeAction"><span class="hs-identifier hs-var">RangedCodeAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RangedCodeAction"><span class="annot"><a href="Unison.LSP.Types.html#RangedCodeAction"><span class="hs-identifier hs-var">RangedCodeAction</span></a></span></span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- All the ranges the code action applies</span><span>
</span><span id="line-189"></span><span>    </span><span id="%24sel%3A_codeActionRanges%3ARangedCodeAction"><span class="annot"><span class="annottext">RangedCodeAction -&gt; [Range]
</span><a href="Unison.LSP.Types.html#%24sel%3A_codeActionRanges%3ARangedCodeAction"><span class="hs-identifier hs-var hs-var">_codeActionRanges</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Range</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-190"></span><span>    </span><span id="%24sel%3A_codeAction%3ARangedCodeAction"><span class="annot"><span class="annottext">RangedCodeAction -&gt; CodeAction
</span><a href="Unison.LSP.Types.html#%24sel%3A_codeAction%3ARangedCodeAction"><span class="hs-identifier hs-var hs-var">_codeAction</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CodeAction</span></span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680878256"><span id="local-6989586621680878263"><span class="annot"><span class="annottext">RangedCodeAction -&gt; RangedCodeAction -&gt; Bool
(RangedCodeAction -&gt; RangedCodeAction -&gt; Bool)
-&gt; (RangedCodeAction -&gt; RangedCodeAction -&gt; Bool)
-&gt; Eq RangedCodeAction
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: RangedCodeAction -&gt; RangedCodeAction -&gt; Bool
== :: RangedCodeAction -&gt; RangedCodeAction -&gt; Bool
$c/= :: RangedCodeAction -&gt; RangedCodeAction -&gt; Bool
/= :: RangedCodeAction -&gt; RangedCodeAction -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680878269"><span id="local-6989586621680878275"><span id="local-6989586621680878279"><span class="annot"><span class="annottext">Int -&gt; RangedCodeAction -&gt; ShowS
[RangedCodeAction] -&gt; ShowS
RangedCodeAction -&gt; String
(Int -&gt; RangedCodeAction -&gt; ShowS)
-&gt; (RangedCodeAction -&gt; String)
-&gt; ([RangedCodeAction] -&gt; ShowS)
-&gt; Show RangedCodeAction
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; RangedCodeAction -&gt; ShowS
showsPrec :: Int -&gt; RangedCodeAction -&gt; ShowS
$cshow :: RangedCodeAction -&gt; String
show :: RangedCodeAction -&gt; String
$cshowList :: [RangedCodeAction] -&gt; ShowS
showList :: [RangedCodeAction] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCodeAction</span></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#RangedCodeAction"><span class="hs-identifier hs-type">RangedCodeAction</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CodeAction</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-195"></span><span>  </span><span id="local-6989586621680878285"><span class="annot"><span class="annottext">codeAction :: Lens' RangedCodeAction CodeAction
</span><a href="#local-6989586621680878285"><span class="hs-identifier hs-var hs-var hs-var hs-var">codeAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RangedCodeAction -&gt; CodeAction)
-&gt; (RangedCodeAction -&gt; CodeAction -&gt; RangedCodeAction)
-&gt; Lens' RangedCodeAction CodeAction
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><span class="hs-identifier hs-var">lens</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><a href="Unison.LSP.Types.html#RangedCodeAction"><span class="hs-identifier hs-type">RangedCodeAction</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680878288"><span class="annot"><span class="annottext">CodeAction
$sel:_codeAction:RangedCodeAction :: RangedCodeAction -&gt; CodeAction
_codeAction :: CodeAction
</span><a href="Unison.LSP.Types.html#%24sel%3A_codeAction%3ARangedCodeAction"><span class="hs-identifier hs-var hs-var">_codeAction</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CodeAction
</span><a href="#local-6989586621680878288"><span class="hs-identifier hs-var">_codeAction</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680878289"><span class="annot"><span class="annottext">RangedCodeAction
</span><a href="#local-6989586621680878289"><span class="hs-identifier hs-var">rca</span></a></span></span><span> </span><span id="local-6989586621680878290"><span class="annot"><span class="annottext">CodeAction
</span><a href="#local-6989586621680878290"><span class="hs-identifier hs-var">ca</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#RangedCodeAction"><span class="hs-identifier hs-type">RangedCodeAction</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:_codeActionRanges:RangedCodeAction :: [Range]
</span><a href="Unison.LSP.Types.html#%24sel%3A_codeActionRanges%3ARangedCodeAction"><span class="hs-identifier hs-var">_codeActionRanges</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RangedCodeAction -&gt; [Range]
</span><a href="Unison.LSP.Types.html#%24sel%3A_codeActionRanges%3ARangedCodeAction"><span class="hs-identifier hs-var">_codeActionRanges</span></a></span><span> </span><span class="annot"><span class="annottext">RangedCodeAction
</span><a href="#local-6989586621680878289"><span class="hs-identifier hs-var">rca</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:_codeAction:RangedCodeAction :: CodeAction
</span><a href="Unison.LSP.Types.html#%24sel%3A_codeAction%3ARangedCodeAction"><span class="hs-identifier hs-var">_codeAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CodeAction
</span><a href="#local-6989586621680878290"><span class="hs-identifier hs-var">ca</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="annot"><a href="Unison.LSP.Types.html#rangedCodeAction"><span class="hs-identifier hs-type">rangedCodeAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Diagnostic</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Range</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#RangedCodeAction"><span class="hs-identifier hs-type">RangedCodeAction</span></a></span><span>
</span><span id="line-198"></span><span id="rangedCodeAction"><span class="annot"><span class="annottext">rangedCodeAction :: Text -&gt; [Diagnostic] -&gt; [Range] -&gt; RangedCodeAction
</span><a href="Unison.LSP.Types.html#rangedCodeAction"><span class="hs-identifier hs-var hs-var">rangedCodeAction</span></a></span></span><span> </span><span id="local-6989586621680878292"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680878292"><span class="hs-identifier hs-var">title</span></a></span></span><span> </span><span id="local-6989586621680878293"><span class="annot"><span class="annottext">[Diagnostic]
</span><a href="#local-6989586621680878293"><span class="hs-identifier hs-var">diags</span></a></span></span><span> </span><span id="local-6989586621680878294"><span class="annot"><span class="annottext">[Range]
</span><a href="#local-6989586621680878294"><span class="hs-identifier hs-var">ranges</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-199"></span><span>  </span><span class="annot"><span class="annottext">[Range] -&gt; CodeAction -&gt; RangedCodeAction
</span><a href="Unison.LSP.Types.html#RangedCodeAction"><span class="hs-identifier hs-var">RangedCodeAction</span></a></span><span> </span><span class="annot"><span class="annottext">[Range]
</span><a href="#local-6989586621680878294"><span class="hs-identifier hs-var">ranges</span></a></span><span> </span><span class="annot"><span class="annottext">(CodeAction -&gt; RangedCodeAction) -&gt; CodeAction -&gt; RangedCodeAction
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-200"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">CodeAction</span></span><span>
</span><span id="line-201"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:_title:CodeAction :: Text
</span><span class="hs-identifier hs-var">_title</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680878292"><span class="hs-identifier hs-var">title</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-202"></span><span>        </span><span class="annot"><span class="annottext">$sel:_kind:CodeAction :: Maybe CodeActionKind
</span><span class="hs-identifier hs-var">_kind</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CodeActionKind
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-203"></span><span>        </span><span class="annot"><span class="annottext">$sel:_diagnostics:CodeAction :: Maybe [Diagnostic]
</span><span class="hs-identifier hs-var">_diagnostics</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Diagnostic] -&gt; Maybe [Diagnostic]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">[Diagnostic]
</span><a href="#local-6989586621680878293"><span class="hs-identifier hs-var">diags</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-204"></span><span>        </span><span class="annot"><span class="annottext">$sel:_isPreferred:CodeAction :: Maybe Bool
</span><span class="hs-identifier hs-var">_isPreferred</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Bool
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-205"></span><span>        </span><span class="annot"><span class="annottext">$sel:_disabled:CodeAction :: Maybe (Rec ((&quot;reason&quot; .== Text) .+ Empty))
</span><span class="hs-identifier hs-var">_disabled</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Rec ((&quot;reason&quot; .== Text) .+ Empty))
Maybe (Rec ('R '[&quot;reason&quot; ':-&gt; Text]))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-206"></span><span>        </span><span class="annot"><span class="annottext">$sel:_edit:CodeAction :: Maybe WorkspaceEdit
</span><span class="hs-identifier hs-var">_edit</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe WorkspaceEdit
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-207"></span><span>        </span><span class="annot"><span class="annottext">$sel:_command:CodeAction :: Maybe Command
</span><span class="hs-identifier hs-var">_command</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Command
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-208"></span><span>        </span><span class="annot"><span class="annottext">$sel:_data_:CodeAction :: Maybe Value
</span><span class="hs-identifier hs-var">_data_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-209"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="annot"><span class="hs-comment">-- | Provided ranges must not intersect.</span></span><span>
</span><span id="line-212"></span><span class="annot"><a href="Unison.LSP.Types.html#includeEdits"><span class="hs-identifier hs-type">includeEdits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Uri</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Range</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#RangedCodeAction"><span class="hs-identifier hs-type">RangedCodeAction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#RangedCodeAction"><span class="hs-identifier hs-type">RangedCodeAction</span></a></span><span>
</span><span id="line-213"></span><span id="includeEdits"><span class="annot"><span class="annottext">includeEdits :: Uri -&gt; Text -&gt; [Range] -&gt; RangedCodeAction -&gt; RangedCodeAction
</span><a href="Unison.LSP.Types.html#includeEdits"><span class="hs-identifier hs-var hs-var">includeEdits</span></a></span></span><span> </span><span id="local-6989586621680878305"><span class="annot"><span class="annottext">Uri
</span><a href="#local-6989586621680878305"><span class="hs-identifier hs-var">uri</span></a></span></span><span> </span><span id="local-6989586621680878306"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680878306"><span class="hs-identifier hs-var">replacement</span></a></span></span><span> </span><span id="local-6989586621680878307"><span class="annot"><span class="annottext">[Range]
</span><a href="#local-6989586621680878307"><span class="hs-identifier hs-var">ranges</span></a></span></span><span> </span><span id="local-6989586621680878308"><span class="annot"><span class="annottext">RangedCodeAction
</span><a href="#local-6989586621680878308"><span class="hs-identifier hs-var">rca</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680878309"><span class="annot"><span class="annottext">edits :: [TextEdit]
</span><a href="#local-6989586621680878309"><span class="hs-identifier hs-var hs-var">edits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-215"></span><span>        </span><span id="local-6989586621680878310"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680878310"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Range]
</span><a href="#local-6989586621680878307"><span class="hs-identifier hs-var">ranges</span></a></span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Range -&gt; Text -&gt; TextEdit
</span><span class="hs-identifier hs-var">TextEdit</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621680878310"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680878306"><span class="hs-identifier hs-var">replacement</span></a></span><span>
</span><span id="line-217"></span><span>      </span><span id="local-6989586621680878312"><span class="annot"><span class="annottext">workspaceEdit :: WorkspaceEdit
</span><a href="#local-6989586621680878312"><span class="hs-identifier hs-var hs-var">workspaceEdit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-218"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">WorkspaceEdit</span></span><span>
</span><span id="line-219"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:_changes:WorkspaceEdit :: Maybe (Map Uri [TextEdit])
</span><span class="hs-identifier hs-var">_changes</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Uri [TextEdit] -&gt; Maybe (Map Uri [TextEdit])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Map Uri [TextEdit] -&gt; Maybe (Map Uri [TextEdit]))
-&gt; Map Uri [TextEdit] -&gt; Maybe (Map Uri [TextEdit])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Uri -&gt; [TextEdit] -&gt; Map Uri [TextEdit]
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.singleton</span></span><span> </span><span class="annot"><span class="annottext">Uri
</span><a href="#local-6989586621680878305"><span class="hs-identifier hs-var">uri</span></a></span><span> </span><span class="annot"><span class="annottext">[TextEdit]
</span><a href="#local-6989586621680878309"><span class="hs-identifier hs-var">edits</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-220"></span><span>            </span><span class="annot"><span class="annottext">$sel:_documentChanges:WorkspaceEdit :: Maybe
  [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
</span><span class="hs-identifier hs-var">_documentChanges</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe
  [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-221"></span><span>            </span><span class="annot"><span class="annottext">$sel:_changeAnnotations:WorkspaceEdit :: Maybe (Map ChangeAnnotationIdentifier ChangeAnnotation)
</span><span class="hs-identifier hs-var">_changeAnnotations</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Map ChangeAnnotationIdentifier ChangeAnnotation)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-222"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-223"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">RangedCodeAction
</span><a href="#local-6989586621680878308"><span class="hs-identifier hs-var">rca</span></a></span><span> </span><span class="annot"><span class="annottext">RangedCodeAction
-&gt; (RangedCodeAction -&gt; RangedCodeAction) -&gt; RangedCodeAction
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(CodeAction -&gt; Identity CodeAction)
-&gt; RangedCodeAction -&gt; Identity RangedCodeAction
forall s a. HasCodeAction s a =&gt; Lens' s a
Lens' RangedCodeAction CodeAction
</span><span class="hs-identifier hs-var">codeAction</span></span><span> </span><span class="annot"><span class="annottext">((CodeAction -&gt; Identity CodeAction)
 -&gt; RangedCodeAction -&gt; Identity RangedCodeAction)
-&gt; ((Maybe WorkspaceEdit -&gt; Identity (Maybe WorkspaceEdit))
    -&gt; CodeAction -&gt; Identity CodeAction)
-&gt; (Maybe WorkspaceEdit -&gt; Identity (Maybe WorkspaceEdit))
-&gt; RangedCodeAction
-&gt; Identity RangedCodeAction
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Maybe WorkspaceEdit -&gt; Identity (Maybe WorkspaceEdit))
-&gt; CodeAction -&gt; Identity CodeAction
forall s a. HasEdit s a =&gt; Lens' s a
Lens' CodeAction (Maybe WorkspaceEdit)
</span><span class="hs-identifier hs-var">edit</span></span><span> </span><span class="annot"><span class="annottext">((Maybe WorkspaceEdit -&gt; Identity (Maybe WorkspaceEdit))
 -&gt; RangedCodeAction -&gt; Identity RangedCodeAction)
-&gt; WorkspaceEdit -&gt; RangedCodeAction -&gt; RangedCodeAction
forall s t a b. ASetter s t a (Maybe b) -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">?~</span></span><span> </span><span class="annot"><span class="annottext">WorkspaceEdit
</span><a href="#local-6989586621680878312"><span class="hs-identifier hs-var">workspaceEdit</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="annot"><a href="Unison.LSP.Types.html#getConfig"><span class="hs-identifier hs-type">getConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-type">Lsp</span></a></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span>
</span><span id="line-226"></span><span id="getConfig"><span class="annot"><span class="annottext">getConfig :: Lsp Config
</span><a href="Unison.LSP.Types.html#getConfig"><span class="hs-identifier hs-var hs-var">getConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lsp Config
forall config (m :: * -&gt; *). MonadLsp config m =&gt; m config
</span><span class="hs-identifier hs-var">LSP.getConfig</span></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="annot"><a href="Unison.LSP.Types.html#setConfig"><span class="hs-identifier hs-type">setConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-type">Lsp</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span id="setConfig"><span class="annot"><span class="annottext">setConfig :: Config -&gt; Lsp ()
</span><a href="Unison.LSP.Types.html#setConfig"><span class="hs-identifier hs-var hs-var">setConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Config -&gt; Lsp ()
forall config (m :: * -&gt; *). MonadLsp config m =&gt; config -&gt; m ()
</span><span class="hs-identifier hs-var">LSP.setConfig</span></span><span>
</span><span id="line-230"></span></pre></body></html>