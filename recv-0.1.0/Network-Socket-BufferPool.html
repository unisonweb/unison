<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Network.Socket.BufferPool</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">recv-0.1.0: Efficient network recv</span><ul class="links" id="page-menu"><li><a href="src/Network.Socket.BufferPool.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Network.Socket.BufferPool</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Recv</a></li><li><a href="#g:2">RecvN</a></li><li><a href="#g:3">Types</a></li><li><a href="#g:4">Utilities</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module provides efficient receiving functions from the network.
   <code><a href="../network-3.1.4.0/Network-Socket-ByteString.html#v:recv" title="Network.Socket.ByteString">recv</a></code> uses <code>createAndTrim</code>
   which behaves as follows:</p><ul><li>Allocates a buffer whose size is decided from the
     first argument.</li><li>Receives data with the buffer.</li><li>Allocates another buffer whose size fits the received data.</li><li>Copies the data from the first buffer to the second buffer.</li></ul><p>On 64bit machines, the global lock is taken for the allocation of
  a byte string whose length is larger than or equal to 3272 bytes.
  So, for instance, if 4,096 is specified to <code>recv</code> and the size of
  received data is 3,300, the global lock is taken twice with the copy
  overhead.</p><p>The efficient receiving functions provided here use a buffer pool.
  A large buffer is allocated at the beginning and it is divided into
  a used one and a leftover when receiving.
  The latter is kept in the buffer pool and will be used next time.
  When the buffer gets small
  and usefless, a new large buffer is allocated.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">type</span> <a href="#t:Recv">Recv</a> = <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a></li><li class="src short"><a href="#v:receive">receive</a> :: <a href="../network-3.1.4.0/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> -&gt; <a href="Network-Socket-BufferPool.html#t:BufferPool" title="Network.Socket.BufferPool">BufferPool</a> -&gt; <a href="Network-Socket-BufferPool.html#t:Recv" title="Network.Socket.BufferPool">Recv</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:BufferPool">BufferPool</a></li><li class="src short"><a href="#v:newBufferPool">newBufferPool</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Network-Socket-BufferPool.html#t:BufferPool" title="Network.Socket.BufferPool">BufferPool</a></li><li class="src short"><a href="#v:withBufferPool">withBufferPool</a> :: <a href="Network-Socket-BufferPool.html#t:BufferPool" title="Network.Socket.BufferPool">BufferPool</a> -&gt; (<a href="Network-Socket-BufferPool.html#t:Buffer" title="Network.Socket.BufferPool">Buffer</a> -&gt; <a href="Network-Socket-BufferPool.html#t:BufSize" title="Network.Socket.BufferPool">BufSize</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a>) -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:RecvN">RecvN</a> = <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a></li><li class="src short"><a href="#v:makeRecvN">makeRecvN</a> :: <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a> -&gt; <a href="Network-Socket-BufferPool.html#t:Recv" title="Network.Socket.BufferPool">Recv</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Network-Socket-BufferPool.html#t:RecvN" title="Network.Socket.BufferPool">RecvN</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:Buffer">Buffer</a> = <a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> <a href="../base-4.18.2.1/Data-Word.html#t:Word8" title="Data.Word">Word8</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:BufSize">BufSize</a> = <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li class="src short"><a href="#v:mallocBS">mallocBS</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a></li><li class="src short"><a href="#v:copy">copy</a> :: <a href="Network-Socket-BufferPool.html#t:Buffer" title="Network.Socket.BufferPool">Buffer</a> -&gt; <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Network-Socket-BufferPool.html#t:Buffer" title="Network.Socket.BufferPool">Buffer</a></li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Recv</h1></a><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:Recv" class="def">Recv</a> = <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a> <a href="src/Network.Socket.BufferPool.Types.html#Recv" class="link">Source</a> <a href="#t:Recv" class="selflink">#</a></p><div class="doc"><p>Type for the receiving function with a buffer pool.</p></div></div><div class="top"><p class="src"><a id="v:receive" class="def">receive</a> :: <a href="../network-3.1.4.0/Network-Socket.html#t:Socket" title="Network.Socket">Socket</a> -&gt; <a href="Network-Socket-BufferPool.html#t:BufferPool" title="Network.Socket.BufferPool">BufferPool</a> -&gt; <a href="Network-Socket-BufferPool.html#t:Recv" title="Network.Socket.BufferPool">Recv</a> <a href="src/Network.Socket.BufferPool.Recv.html#receive" class="link">Source</a> <a href="#v:receive" class="selflink">#</a></p><div class="doc"><p>The receiving function with a buffer pool.
   The buffer pool is automatically managed.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:BufferPool" class="def">BufferPool</a> <a href="src/Network.Socket.BufferPool.Types.html#BufferPool" class="link">Source</a> <a href="#t:BufferPool" class="selflink">#</a></p><div class="doc"><p>Type for read buffer pool.</p></div></div><div class="top"><p class="src"><a id="v:newBufferPool" class="def">newBufferPool</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Network-Socket-BufferPool.html#t:BufferPool" title="Network.Socket.BufferPool">BufferPool</a> <a href="src/Network.Socket.BufferPool.Buffer.html#newBufferPool" class="link">Source</a> <a href="#v:newBufferPool" class="selflink">#</a></p><div class="doc"><p>Creating a buffer pool.
   The first argument is the lower limit.
   When the size of the buffer in the poll is lower than this limit,
   the buffer is thrown awany (and is eventually freed).
   Then a new buffer is allocated.
   The second argument is the size for the new allocation.</p></div></div><div class="top"><p class="src"><a id="v:withBufferPool" class="def">withBufferPool</a> :: <a href="Network-Socket-BufferPool.html#t:BufferPool" title="Network.Socket.BufferPool">BufferPool</a> -&gt; (<a href="Network-Socket-BufferPool.html#t:Buffer" title="Network.Socket.BufferPool">Buffer</a> -&gt; <a href="Network-Socket-BufferPool.html#t:BufSize" title="Network.Socket.BufferPool">BufSize</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a>) -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a> <a href="src/Network.Socket.BufferPool.Buffer.html#withBufferPool" class="link">Source</a> <a href="#v:withBufferPool" class="selflink">#</a></p><div class="doc"><p>Using a buffer pool.
   The second argument is a function which returns
   how many bytes are filled in the buffer.
   The buffer in the buffer pool is automatically managed.</p></div></div><a href="#g:2" id="g:2"><h1>RecvN</h1></a><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:RecvN" class="def">RecvN</a> = <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a> <a href="src/Network.Socket.BufferPool.Types.html#RecvN" class="link">Source</a> <a href="#t:RecvN" class="selflink">#</a></p><div class="doc"><p>Type for the receiving function which receives N bytes.</p></div></div><div class="top"><p class="src"><a id="v:makeRecvN" class="def">makeRecvN</a> :: <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a> -&gt; <a href="Network-Socket-BufferPool.html#t:Recv" title="Network.Socket.BufferPool">Recv</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Network-Socket-BufferPool.html#t:RecvN" title="Network.Socket.BufferPool">RecvN</a> <a href="src/Network.Socket.BufferPool.Recv.html#makeRecvN" class="link">Source</a> <a href="#v:makeRecvN" class="selflink">#</a></p><div class="doc"><p>This function returns a receiving function
   based on two receiving functions.
   The returned function receives exactly N bytes.
   The first argument is an initial received data.
   After consuming the initial data, the two functions is used.
   When N is less than equal to 4096, the buffer pool is used.
   Otherwise, a new buffer is allocated.
   In this case, the global lock is taken.</p></div></div><a href="#g:3" id="g:3"><h1>Types</h1></a><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:Buffer" class="def">Buffer</a> = <a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> <a href="../base-4.18.2.1/Data-Word.html#t:Word8" title="Data.Word">Word8</a> <a href="src/Network.Socket.BufferPool.Types.html#Buffer" class="link">Source</a> <a href="#t:Buffer" class="selflink">#</a></p><div class="doc"><p>Type for buffer.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:BufSize" class="def">BufSize</a> = <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="src/Network.Socket.BufferPool.Types.html#BufSize" class="link">Source</a> <a href="#t:BufSize" class="selflink">#</a></p><div class="doc"><p>Type for buffer size.</p></div></div><a href="#g:4" id="g:4"><h1>Utilities</h1></a><div class="top"><p class="src"><a id="v:mallocBS" class="def">mallocBS</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a> <a href="src/Network.Socket.BufferPool.Buffer.html#mallocBS" class="link">Source</a> <a href="#v:mallocBS" class="selflink">#</a></p><div class="doc"><p>Allocating a byte string.</p></div></div><div class="top"><p class="src"><a id="v:copy" class="def">copy</a> :: <a href="Network-Socket-BufferPool.html#t:Buffer" title="Network.Socket.BufferPool">Buffer</a> -&gt; <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Network-Socket-BufferPool.html#t:Buffer" title="Network.Socket.BufferPool">Buffer</a> <a href="src/Network.Socket.BufferPool.Buffer.html#copy" class="link">Source</a> <a href="#v:copy" class="selflink">#</a></p><div class="doc"><p>Copying the bytestring to the buffer.
   This function returns the point where the next copy should start.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>