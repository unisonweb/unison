<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span class="hs-cpp">

#include &quot;HsNetDef.h&quot;
</span><span>
</span><span id="line-6"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Module      :  Network.Socket.Internal</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Copyright   :  (c) The University of Glasgow 2001</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- License     :  BSD-style (see the file libraries/network/LICENSE)</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- Maintainer  :  libraries@haskell.org</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- Stability   :  provisional</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- Portability :  portable</span><span>
</span><span id="line-15"></span><span class="hs-comment">--</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- A module containing semi-public &quot;Network.Socket&quot; internals.</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- Modules which extend the &quot;Network.Socket&quot; module will need to use</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- this module while ideally most users will be able to make do with</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- the public interface.</span><span>
</span><span id="line-20"></span><span class="hs-comment">--</span><span>
</span><span id="line-21"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.Socket.Internal</span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">(</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Socket error functions</span></span><span>
</span><span id="line-26"></span><span>      </span><span class="annot"><a href="Network.Socket.Internal.html#throwSocketError"><span class="hs-identifier">throwSocketError</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorCode"><span class="hs-identifier">throwSocketErrorCode</span></a></span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">c_getLastError</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Guards for socket operations that may fail</span></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1_"><span class="hs-identifier">throwSocketErrorIfMinus1_</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1Retry"><span class="hs-identifier">throwSocketErrorIfMinus1Retry</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1Retry_"><span class="hs-identifier">throwSocketErrorIfMinus1Retry_</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1RetryMayBlock"><span class="hs-identifier">throwSocketErrorIfMinus1RetryMayBlock</span></a></span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">throwSocketErrorIfMinus1ButRetry</span><span class="hs-cpp">
#endif
</span><span>    </span><span class="annot"><span class="hs-comment">-- ** Guards that wait and retry if the operation would block</span></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-comment">-- | These guards are based on 'throwSocketErrorIfMinus1RetryMayBlock'.</span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-comment">-- They wait for socket readiness if the action fails with @EWOULDBLOCK@</span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-comment">-- or similar.</span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorWaitRead"><span class="hs-identifier">throwSocketErrorWaitRead</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorWaitReadBut"><span class="hs-identifier">throwSocketErrorWaitReadBut</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorWaitWrite"><span class="hs-identifier">throwSocketErrorWaitWrite</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Initialization</span></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Socket.Internal.html#withSocketsDo"><span class="hs-identifier">withSocketsDo</span></a></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Low-level helpers</span></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Socket.Types.html#zeroMemory"><span class="hs-identifier">zeroMemory</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Conc</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">threadWaitRead</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">threadWaitWrite</span></span><span class="hs-special">)</span><span class="hs-cpp">

#if defined(mingw32_HOST_OS)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Exception</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">evaluate</span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.IO.Unsafe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafePerformIO</span><span class="hs-special">)</span><span class="hs-cpp">
# if __GLASGOW_HASKELL__ &gt;= 707
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.IO.Exception</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IOErrorType</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
# else
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.IOBase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IOErrorType</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
# endif
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.IO.Error</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ioeSetErrorString</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkIOError</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.C.Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">throwErrno</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwErrnoIfMinus1Retry</span></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>                        </span><span class="annot"><span class="hs-identifier">throwErrnoIfMinus1RetryMayBlock</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwErrnoIfMinus1_</span></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>                        </span><span class="annot"><span class="hs-identifier">Errno</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">errnoToIOError</span></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Network.Socket.Cbits</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.Socket.Imports.html"><span class="hs-identifier">Network.Socket.Imports</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.Socket.Types.html"><span class="hs-identifier">Network.Socket.Types</span></a></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- Guards for socket operations that may fail</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="annot"><span class="hs-comment">-- | Throw an 'IOError' corresponding to the current socket error.</span></span><span>
</span><span id="line-82"></span><span id="local-6989586621679077191"><span class="annot"><a href="Network.Socket.Internal.html#throwSocketError"><span class="hs-identifier hs-type">throwSocketError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ textual description of the error location</span></span><span>
</span><span id="line-83"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077191"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-comment">-- | Like 'throwSocketError', but the error code is supplied as an argument.</span><span>
</span><span id="line-86"></span><span class="hs-comment">--</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- On Windows, do not use errno.  Use a system error code instead.</span><span>
</span><span id="line-88"></span><span id="local-6989586621679077193"><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorCode"><span class="hs-identifier hs-type">throwSocketErrorCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077193"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">-- | Throw an 'IOError' corresponding to the current socket error if</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- the IO action returns a result of @-1@.  Discards the result of the</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- IO action after error handling.</span><span>
</span><span id="line-93"></span><span id="local-6989586621679077238"><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1_"><span class="hs-identifier hs-type">throwSocketErrorIfMinus1_</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679077238"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679077238"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ textual description of the location</span></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077238"><span class="hs-identifier hs-type">a</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ the 'IO' operation to be executed</span></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1_"><span class="hs-pragma hs-type">throwSocketErrorIfMinus1_</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">String</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">CInt</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">IO</span></span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-comment">-- | Throw an 'IOError' corresponding to the current socket error if</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- the IO action returns a result of @-1@, but retries in case of an</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- interrupted operation.</span><span>
</span><span id="line-104"></span><span id="local-6989586621679077178"><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1Retry"><span class="hs-identifier hs-type">throwSocketErrorIfMinus1Retry</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679077178"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679077178"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ textual description of the location</span></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077178"><span class="hs-identifier hs-type">a</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ the 'IO' operation to be executed</span></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077178"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1Retry"><span class="hs-pragma hs-type">throwSocketErrorIfMinus1Retry</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">String</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">CInt</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">CInt</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-comment">-- | Throw an 'IOError' corresponding to the current socket error if</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- the IO action returns a result of @-1@, but retries in case of an</span><span>
</span><span id="line-114"></span><span class="hs-comment">-- interrupted operation. Discards the result of the IO action after</span><span>
</span><span id="line-115"></span><span class="hs-comment">-- error handling.</span><span>
</span><span id="line-116"></span><span id="local-6989586621679077171"><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1Retry_"><span class="hs-identifier hs-type">throwSocketErrorIfMinus1Retry_</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679077171"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679077171"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ textual description of the location</span></span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077171"><span class="hs-identifier hs-type">a</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ the 'IO' operation to be executed</span></span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-121"></span><span id="throwSocketErrorIfMinus1Retry_"><span class="annot"><span class="annottext">throwSocketErrorIfMinus1Retry_ :: forall a. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO ()
</span><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1Retry_"><span class="hs-identifier hs-var hs-var">throwSocketErrorIfMinus1Retry_</span></a></span></span><span> </span><span id="local-6989586621679077245"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679077245"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621679077246"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679077246"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><span class="annottext">IO a -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO ()) -&gt; IO a -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO a -&gt; IO a
forall a. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO a
</span><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1Retry"><span class="hs-identifier hs-var">throwSocketErrorIfMinus1Retry</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679077245"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679077246"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-123"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1Retry_"><span class="hs-pragma hs-type">throwSocketErrorIfMinus1Retry_</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">String</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">CInt</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">IO</span></span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="hs-comment">-- | Throw an 'IOError' corresponding to the current socket error if</span><span>
</span><span id="line-126"></span><span class="hs-comment">-- the IO action returns a result of @-1@, but retries in case of an</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- interrupted operation.  Checks for operations that would block and</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- executes an alternative action before retrying in that case.</span><span>
</span><span id="line-129"></span><span id="local-6989586621679077179"><span id="local-6989586621679077180"><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1RetryMayBlock"><span class="hs-identifier hs-type">throwSocketErrorIfMinus1RetryMayBlock</span></a></span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679077179"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679077179"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ textual description of the location</span></span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077180"><span class="hs-identifier hs-type">b</span></a></span><span>    </span><span class="hs-comment">-- ^ action to execute before retrying if an</span><span>
</span><span id="line-133"></span><span>               </span><span class="hs-comment">--   immediate retry would block</span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077179"><span class="hs-identifier hs-type">a</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ the 'IO' operation to be executed</span></span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077179"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1RetryMayBlock"><span class="hs-pragma hs-type">throwSocketErrorIfMinus1RetryMayBlock</span></a></span><span>
</span><span id="line-138"></span><span>        </span><span class="hs-pragma">::</span><span> </span><span id="local-6989586621679077248"><span class="annot"><span class="hs-pragma hs-type">String</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077248"><span class="hs-pragma hs-type">b</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">CInt</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">CInt</span></span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-comment">-- | Throw an 'IOError' corresponding to the current socket error if</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- the IO action returns a result of @-1@, but retries in case of an</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- interrupted operation.  Checks for operations that would block and</span><span>
</span><span id="line-144"></span><span class="hs-comment">-- executes an alternative action before retrying in that case.  If the error</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- is one handled by the exempt filter then ignore it and return the error code.</span><span>
</span><span id="line-146"></span><span id="local-6989586621679077185"><span id="local-6989586621679077186"><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1RetryMayBlockBut"><span class="hs-identifier hs-type">throwSocketErrorIfMinus1RetryMayBlockBut</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679077185"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679077185"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ exception exempt filter</span></span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ textual description of the location</span></span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077186"><span class="hs-identifier hs-type">b</span></a></span><span>           </span><span class="hs-comment">-- ^ action to execute before retrying if an</span><span>
</span><span id="line-151"></span><span>                      </span><span class="hs-comment">--   immediate retry would block</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077185"><span class="hs-identifier hs-type">a</span></a></span><span>           </span><span class="annot"><span class="hs-comment">-- ^ the 'IO' operation to be executed</span></span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077185"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1RetryMayBlock"><span class="hs-pragma hs-type">throwSocketErrorIfMinus1RetryMayBlock</span></a></span><span>
</span><span id="line-156"></span><span>        </span><span class="hs-pragma">::</span><span> </span><span id="local-6989586621679077250"><span class="annot"><span class="hs-pragma hs-type">String</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077250"><span class="hs-pragma hs-type">b</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">CInt</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">CInt</span></span></span><span> </span><span class="hs-pragma">#-}</span><span class="hs-cpp">

#if defined(mingw32_HOST_OS)
</span><span>
</span><span id="line-160"></span><span class="hs-identifier">throwSocketErrorIfMinus1RetryMayBlock</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">act</span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">throwSocketErrorIfMinus1Retry</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">act</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-identifier">throwSocketErrorIfMinus1RetryMayBlockBut</span><span> </span><span class="hs-identifier">exempt</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">act</span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">throwSocketErrorIfMinus1ButRetry</span><span> </span><span class="hs-identifier">exempt</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">act</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-identifier">throwSocketErrorIfMinus1_</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">act</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">throwSocketErrorIfMinus1Retry</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">act</span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="hs-identifier">throwSocketErrorIfMinus1ButRetry</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Eq</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Num</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-171"></span><span>                                    </span><span class="hs-special">(</span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">a</span><span>
</span><span id="line-172"></span><span class="hs-identifier">throwSocketErrorIfMinus1ButRetry</span><span> </span><span class="hs-identifier">exempt</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">act</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-identifier">r</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">act</span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">r</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>   </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-identifier">rc</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_getLastError</span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">rc</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">wsaNotInitialized</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-178"></span><span>        </span><span class="hs-identifier">withSocketsDo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>        </span><span class="hs-identifier">r'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">act</span><span>
</span><span id="line-180"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">r'</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>           </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">throwSocketError</span><span> </span><span class="hs-identifier">name</span><span>
</span><span id="line-182"></span><span>           </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">r'</span><span>
</span><span id="line-183"></span><span>      </span><span class="hs-keyword">else</span><span>
</span><span id="line-184"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">exempt</span><span> </span><span class="hs-identifier">rc</span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">r</span><span>
</span><span id="line-186"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">throwSocketError</span><span> </span><span class="hs-identifier">name</span><span>
</span><span id="line-187"></span><span>   </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">r</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-identifier">throwSocketErrorIfMinus1Retry</span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">throwSocketErrorIfMinus1ButRetry</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">const</span><span> </span><span class="hs-identifier">False</span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-identifier">throwSocketErrorCode</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">rc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-identifier">pstr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_getWSError</span><span> </span><span class="hs-identifier">rc</span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-identifier">str</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">peekCString</span><span> </span><span class="hs-identifier">pstr</span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-identifier">ioError</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ioeSetErrorString</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mkIOError</span><span> </span><span class="hs-identifier">OtherError</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-identifier">Nothing</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">str</span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="hs-identifier">throwSocketError</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-identifier">c_getLastError</span><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-identifier">throwSocketErrorCode</span><span> </span><span class="hs-identifier">name</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CALLCONV</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;WSAGetLastError&quot;</span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-identifier">c_getLastError</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;getWSErrorDescr&quot;</span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-identifier">c_getWSError</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CChar</span><span class="hs-special">)</span><span class="hs-cpp">

#else
</span><span>
</span><span id="line-208"></span><span id="throwSocketErrorIfMinus1RetryMayBlock"><span class="annot"><span class="annottext">throwSocketErrorIfMinus1RetryMayBlock :: forall a b. (Eq a, Num a) =&gt; String -&gt; IO b -&gt; IO a -&gt; IO a
</span><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1RetryMayBlock"><span class="hs-identifier hs-var hs-var">throwSocketErrorIfMinus1RetryMayBlock</span></a></span></span><span> </span><span id="local-6989586621679077255"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679077255"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679077256"><span class="annot"><span class="annottext">IO b
</span><a href="#local-6989586621679077256"><span class="hs-identifier hs-var">on_block</span></a></span></span><span> </span><span id="local-6989586621679077257"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679077257"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-209"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO a -&gt; IO b -&gt; IO a
forall a b. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO b -&gt; IO a
</span><span class="hs-identifier hs-var">throwErrnoIfMinus1RetryMayBlock</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679077255"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679077257"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="annot"><span class="annottext">IO b
</span><a href="#local-6989586621679077256"><span class="hs-identifier hs-var">on_block</span></a></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span id="throwSocketErrorIfMinus1RetryMayBlockBut"><span class="annot"><span class="annottext">throwSocketErrorIfMinus1RetryMayBlockBut :: forall a b.
(Eq a, Num a) =&gt;
(CInt -&gt; Bool) -&gt; String -&gt; IO b -&gt; IO a -&gt; IO a
</span><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1RetryMayBlockBut"><span class="hs-identifier hs-var hs-var">throwSocketErrorIfMinus1RetryMayBlockBut</span></a></span></span><span> </span><span id="local-6989586621679077262"><span class="annot"><span class="annottext">CInt -&gt; Bool
</span><a href="#local-6989586621679077262"><span class="hs-identifier hs-var">_exempt</span></a></span></span><span> </span><span id="local-6989586621679077263"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679077263"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679077264"><span class="annot"><span class="annottext">IO b
</span><a href="#local-6989586621679077264"><span class="hs-identifier hs-var">on_block</span></a></span></span><span> </span><span id="local-6989586621679077265"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679077265"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO a -&gt; IO b -&gt; IO a
forall a b. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO b -&gt; IO a
</span><span class="hs-identifier hs-var">throwErrnoIfMinus1RetryMayBlock</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679077263"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679077265"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="annot"><span class="annottext">IO b
</span><a href="#local-6989586621679077264"><span class="hs-identifier hs-var">on_block</span></a></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span id="throwSocketErrorIfMinus1Retry"><span class="annot"><span class="annottext">throwSocketErrorIfMinus1Retry :: forall a. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO a
</span><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1Retry"><span class="hs-identifier hs-var hs-var">throwSocketErrorIfMinus1Retry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO a -&gt; IO a
forall a. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO a
</span><span class="hs-identifier hs-var">throwErrnoIfMinus1Retry</span></span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span id="throwSocketErrorIfMinus1_"><span class="annot"><span class="annottext">throwSocketErrorIfMinus1_ :: forall a. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO ()
</span><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1_"><span class="hs-identifier hs-var hs-var">throwSocketErrorIfMinus1_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO a -&gt; IO ()
forall a. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO ()
</span><span class="hs-identifier hs-var">throwErrnoIfMinus1_</span></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span id="throwSocketError"><span class="annot"><span class="annottext">throwSocketError :: forall a. String -&gt; IO a
</span><a href="Network.Socket.Internal.html#throwSocketError"><span class="hs-identifier hs-var hs-var">throwSocketError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO a
forall a. String -&gt; IO a
</span><span class="hs-identifier hs-var">throwErrno</span></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span id="throwSocketErrorCode"><span class="annot"><span class="annottext">throwSocketErrorCode :: forall a. String -&gt; CInt -&gt; IO a
</span><a href="Network.Socket.Internal.html#throwSocketErrorCode"><span class="hs-identifier hs-var hs-var">throwSocketErrorCode</span></a></span></span><span> </span><span id="local-6989586621679077274"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679077274"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621679077275"><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679077275"><span class="hs-identifier hs-var">errno</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-221"></span><span>    </span><span class="annot"><span class="annottext">IOError -&gt; IO a
forall a. IOError -&gt; IO a
</span><span class="hs-identifier hs-var">ioError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Errno -&gt; Maybe Handle -&gt; Maybe String -&gt; IOError
</span><span class="hs-identifier hs-var">errnoToIOError</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679077274"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; Errno
</span><span class="hs-identifier hs-var">Errno</span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679077275"><span class="hs-identifier hs-var">errno</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Handle
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-cpp">

#endif
</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- | Like 'throwSocketErrorIfMinus1Retry', but if the action fails with</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- @EWOULDBLOCK@ or similar, wait for the socket to be read-ready,</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- and try again.</span><span>
</span><span id="line-228"></span><span id="local-6989586621679077200"><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorWaitRead"><span class="hs-identifier hs-type">throwSocketErrorWaitRead</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679077200"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679077200"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.Socket.Types.html#Socket"><span class="hs-identifier hs-type">Socket</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077200"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077200"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-229"></span><span id="throwSocketErrorWaitRead"><span class="annot"><span class="annottext">throwSocketErrorWaitRead :: forall a. (Eq a, Num a) =&gt; Socket -&gt; String -&gt; IO a -&gt; IO a
</span><a href="Network.Socket.Internal.html#throwSocketErrorWaitRead"><span class="hs-identifier hs-var hs-var">throwSocketErrorWaitRead</span></a></span></span><span> </span><span id="local-6989586621679077286"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679077286"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679077287"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679077287"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679077288"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679077288"><span class="hs-identifier hs-var">io</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; (CInt -&gt; IO a) -&gt; IO a
forall r. Socket -&gt; (CInt -&gt; IO r) -&gt; IO r
</span><a href="Network.Socket.Types.html#withFdSocket"><span class="hs-identifier hs-var">withFdSocket</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679077286"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">((CInt -&gt; IO a) -&gt; IO a) -&gt; (CInt -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679077290"><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679077290"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; IO a -&gt; IO a
forall a b. (Eq a, Num a) =&gt; String -&gt; IO b -&gt; IO a -&gt; IO a
</span><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1RetryMayBlock"><span class="hs-identifier hs-var">throwSocketErrorIfMinus1RetryMayBlock</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679077287"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-231"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Fd -&gt; IO ()
</span><span class="hs-identifier hs-var">threadWaitRead</span></span><span> </span><span class="annot"><span class="annottext">(Fd -&gt; IO ()) -&gt; Fd -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CInt -&gt; Fd
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679077290"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679077288"><span class="hs-identifier hs-var">io</span></a></span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span class="hs-comment">-- | Like 'throwSocketErrorIfMinus1Retry', but if the action fails with</span><span>
</span><span id="line-234"></span><span class="hs-comment">-- @EWOULDBLOCK@ or similar, wait for the socket to be read-ready,</span><span>
</span><span id="line-235"></span><span class="hs-comment">-- and try again.  If it fails with the error the user was expecting then</span><span>
</span><span id="line-236"></span><span class="hs-comment">-- ignore the error</span><span>
</span><span id="line-237"></span><span id="local-6989586621679077207"><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorWaitReadBut"><span class="hs-identifier hs-type">throwSocketErrorWaitReadBut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679077207"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679077207"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Socket.Types.html#Socket"><span class="hs-identifier hs-type">Socket</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077207"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077207"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-238"></span><span id="throwSocketErrorWaitReadBut"><span class="annot"><span class="annottext">throwSocketErrorWaitReadBut :: forall a.
(Eq a, Num a) =&gt;
(CInt -&gt; Bool) -&gt; Socket -&gt; String -&gt; IO a -&gt; IO a
</span><a href="Network.Socket.Internal.html#throwSocketErrorWaitReadBut"><span class="hs-identifier hs-var hs-var">throwSocketErrorWaitReadBut</span></a></span></span><span> </span><span id="local-6989586621679077297"><span class="annot"><span class="annottext">CInt -&gt; Bool
</span><a href="#local-6989586621679077297"><span class="hs-identifier hs-var">exempt</span></a></span></span><span> </span><span id="local-6989586621679077298"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679077298"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679077299"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679077299"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679077300"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679077300"><span class="hs-identifier hs-var">io</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; (CInt -&gt; IO a) -&gt; IO a
forall r. Socket -&gt; (CInt -&gt; IO r) -&gt; IO r
</span><a href="Network.Socket.Types.html#withFdSocket"><span class="hs-identifier hs-var">withFdSocket</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679077298"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">((CInt -&gt; IO a) -&gt; IO a) -&gt; (CInt -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679077301"><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679077301"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-239"></span><span>    </span><span class="annot"><span class="annottext">(CInt -&gt; Bool) -&gt; String -&gt; IO () -&gt; IO a -&gt; IO a
forall a b.
(Eq a, Num a) =&gt;
(CInt -&gt; Bool) -&gt; String -&gt; IO b -&gt; IO a -&gt; IO a
</span><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1RetryMayBlockBut"><span class="hs-identifier hs-var">throwSocketErrorIfMinus1RetryMayBlockBut</span></a></span><span> </span><span class="annot"><span class="annottext">CInt -&gt; Bool
</span><a href="#local-6989586621679077297"><span class="hs-identifier hs-var">exempt</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679077299"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-240"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Fd -&gt; IO ()
</span><span class="hs-identifier hs-var">threadWaitRead</span></span><span> </span><span class="annot"><span class="annottext">(Fd -&gt; IO ()) -&gt; Fd -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CInt -&gt; Fd
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679077301"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679077300"><span class="hs-identifier hs-var">io</span></a></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="hs-comment">-- | Like 'throwSocketErrorIfMinus1Retry', but if the action fails with</span><span>
</span><span id="line-243"></span><span class="hs-comment">-- @EWOULDBLOCK@ or similar, wait for the socket to be write-ready,</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- and try again.</span><span>
</span><span id="line-245"></span><span id="local-6989586621679077302"><span class="annot"><a href="Network.Socket.Internal.html#throwSocketErrorWaitWrite"><span class="hs-identifier hs-type">throwSocketErrorWaitWrite</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679077302"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679077302"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.Socket.Types.html#Socket"><span class="hs-identifier hs-type">Socket</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077302"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077302"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-246"></span><span id="throwSocketErrorWaitWrite"><span class="annot"><span class="annottext">throwSocketErrorWaitWrite :: forall a. (Eq a, Num a) =&gt; Socket -&gt; String -&gt; IO a -&gt; IO a
</span><a href="Network.Socket.Internal.html#throwSocketErrorWaitWrite"><span class="hs-identifier hs-var hs-var">throwSocketErrorWaitWrite</span></a></span></span><span> </span><span id="local-6989586621679077309"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679077309"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679077310"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679077310"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679077311"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679077311"><span class="hs-identifier hs-var">io</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; (CInt -&gt; IO a) -&gt; IO a
forall r. Socket -&gt; (CInt -&gt; IO r) -&gt; IO r
</span><a href="Network.Socket.Types.html#withFdSocket"><span class="hs-identifier hs-var">withFdSocket</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679077309"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">((CInt -&gt; IO a) -&gt; IO a) -&gt; (CInt -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679077312"><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679077312"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-247"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; IO a -&gt; IO a
forall a b. (Eq a, Num a) =&gt; String -&gt; IO b -&gt; IO a -&gt; IO a
</span><a href="Network.Socket.Internal.html#throwSocketErrorIfMinus1RetryMayBlock"><span class="hs-identifier hs-var">throwSocketErrorIfMinus1RetryMayBlock</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679077310"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-248"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Fd -&gt; IO ()
</span><span class="hs-identifier hs-var">threadWaitWrite</span></span><span> </span><span class="annot"><span class="annottext">(Fd -&gt; IO ()) -&gt; Fd -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CInt -&gt; Fd
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679077312"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679077311"><span class="hs-identifier hs-var">io</span></a></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-251"></span><span class="hs-comment">-- WinSock support</span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="annot"><span class="hs-comment">{-| With older versions of the @network@ library (version 2.6.0.2 or earlier)
on Windows operating systems,
the networking subsystem must be initialised using 'withSocketsDo' before
any networking operations can be used. eg.

&gt; main = withSocketsDo $ do {...}

It is fine to nest calls to 'withSocketsDo', and to perform networking operations
after 'withSocketsDo' has returned.

'withSocketsDo' is not necessary for the current network library.
However, for compatibility with older versions on Windows, it is good practice
to always call 'withSocketsDo' (it's very cheap).
-}</span></span><span>
</span><span id="line-267"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Network.Socket.Internal.html#withSocketsDo"><span class="hs-pragma hs-type">withSocketsDo</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-268"></span><span id="local-6989586621679077210"><span class="annot"><a href="Network.Socket.Internal.html#withSocketsDo"><span class="hs-identifier hs-type">withSocketsDo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077210"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679077210"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span>
</span><span id="line-271"></span><span class="hs-identifier">withSocketsDo</span><span> </span><span class="hs-identifier">act</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">evaluate</span><span> </span><span class="hs-identifier">withSocketsInit</span><span> </span><span class="hs-operator">&gt;&gt;</span><span> </span><span class="hs-identifier">act</span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="hs-pragma">withSocketsInit</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-274"></span><span class="hs-identifier">withSocketsInit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span class="hs-comment">-- Use a CAF to make forcing it do initialisation once, but subsequent forces will be cheap</span><span>
</span><span id="line-276"></span><span class="hs-identifier">withSocketsInit</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafePerformIO</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">initWinSock</span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-identifier">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span> </span><span class="hs-operator">/=</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">ioError</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-279"></span><span>      </span><span class="hs-identifier">userError</span><span> </span><span class="hs-string">&quot;Network.Socket.Internal.withSocketsDo: Failed to initialise WinSock&quot;</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;initWinSock&quot;</span><span> </span><span class="hs-identifier">initWinSock</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Int</span><span class="hs-cpp">

#else
</span><span>
</span><span id="line-285"></span><span id="withSocketsDo"><span class="annot"><span class="annottext">withSocketsDo :: forall a. IO a -&gt; IO a
</span><a href="Network.Socket.Internal.html#withSocketsDo"><span class="hs-identifier hs-var hs-var">withSocketsDo</span></a></span></span><span> </span><span id="local-6989586621679077313"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679077313"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679077313"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-cpp">

#endif
</span></pre></body></html>