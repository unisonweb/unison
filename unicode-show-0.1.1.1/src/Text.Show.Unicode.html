<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="annot"><span class="hs-comment">{- |
Copyright   : (c) Takayuki Muranushi, 2016
License     : BSD3
Maintainer  : whosekiteneverfly@gmail.com
Stability   : experimental


Provides a interactive printer for printing Unicode characters in ghci REPL. Our design goal is that 'uprint' produces String representations that are valid Haskell 'String' literals and uses as many Unicode printable characters as possible. Hence

@
read . ushow == id
@

see the tests of this package for detailed specifications.

__Example__

With 'print' :

@
$ __ghci__
...
&gt; __[&quot;&#21704;&#26031;&#20811;&#23572;7.6.1&quot;]__
[&quot;\\21704\\26031\\20811\\23572\\&amp;7.6.1&quot;]
&gt;
@

With 'uprint' :

@
$ __ghci -interactive-print=Text.Show.Unicode.uprint Text.Show.Unicode__
...
Ok, modules loaded: Text.Show.Unicode.
&gt; __(&quot;&#1061;&#1086;&#1088;&#1086;&#1096;&#1086;!&quot;,[&quot;&#21704;&#26031;&#20811;&#23572;7.6.1&#30340;&#21147;&#37327;&quot;,&quot;&#24863;&#12376;&#12427;&quot;])__
(&quot;&#1061;&#1086;&#1088;&#1086;&#1096;&#1086;!&quot;,[&quot;&#21704;&#26031;&#20811;&#23572;7.6.1&#30340;&#21147;&#37327;&quot;,&quot;&#24863;&#12376;&#12427;&quot;])
&gt; &quot;&#25913;\\n&#34892;&quot;
&quot;&#25913;\\n&#34892;&quot;
@

You can make 'uprint' the default interactive printer in several ways. One is to
@cabal install unicode-show@, and add the following lines to your @~/.ghci@ config file.

@
import qualified Text.Show.Unicode
:set -interactive-print=Text.Show.Unicode.uprint
@

-}</span></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Text.Show.Unicode</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Show.Unicode.html#ushow"><span class="hs-identifier">ushow</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Show.Unicode.html#uprint"><span class="hs-identifier">uprint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Show.Unicode.html#urecover"><span class="hs-identifier">urecover</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Show.Unicode.html#ushowWith"><span class="hs-identifier">ushowWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Show.Unicode.html#uprintWith"><span class="hs-identifier">uprintWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Show.Unicode.html#urecoverWith"><span class="hs-identifier">urecoverWith</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.State.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">StateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">StateT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runStateT</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>                                                   </span><span class="annot"><span class="hs-identifier">get</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">put</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isAscii</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isPrint</span></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span>                        </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Ord</span></span><span>                         </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">O</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Safe</span></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">minimumByMay</span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Text.ParserCombinators.ReadP</span></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">gather</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">readP_to_S</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Text.Read.Lex</span></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lexChar</span></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="annot"><span class="hs-comment">-- | Create a parser for less dependencies. ReadP is too slow</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">type</span><span> </span><span id="Parser"><span class="annot"><a href="Text.Show.Unicode.html#Parser"><span class="hs-identifier hs-var">Parser</span></a></span></span><span> </span><span id="local-6989586621679024170"><span class="annot"><a href="#local-6989586621679024170"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679024170"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-comment">-- | Show the input, and then replace Haskell character literals</span><span>
</span><span id="line-66"></span><span class="hs-comment">-- with the character it represents, for any Unicode printable characters except backslash, single and double quotation marks.</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- If something fails, fallback to standard 'show'.</span><span>
</span><span id="line-68"></span><span id="local-6989586621679024100"><span class="annot"><a href="Text.Show.Unicode.html#ushow"><span class="hs-identifier hs-type">ushow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679024100"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679024100"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span></span><span>
</span><span id="line-69"></span><span id="ushow"><span class="annot"><span class="annottext">ushow :: forall a. Show a =&gt; a -&gt; String
</span><a href="Text.Show.Unicode.html#ushow"><span class="hs-identifier hs-var hs-var">ushow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; a -&gt; String
forall a. Show a =&gt; (Char -&gt; Bool) -&gt; a -&gt; String
</span><a href="Text.Show.Unicode.html#ushowWith"><span class="hs-identifier hs-var">ushowWith</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="Text.Show.Unicode.html#shouldRecover"><span class="hs-identifier hs-var">shouldRecover</span></a></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-comment">-- | Replace Haskell character literals with the character it represents, for</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- any Unicode printable characters except backslash, single and double</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- quotation marks.</span><span>
</span><span id="line-74"></span><span class="annot"><a href="Text.Show.Unicode.html#urecover"><span class="hs-identifier hs-type">urecover</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-75"></span><span id="urecover"><span class="annot"><span class="annottext">urecover :: String -&gt; String
</span><a href="Text.Show.Unicode.html#urecover"><span class="hs-identifier hs-var hs-var">urecover</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; String -&gt; String
</span><a href="Text.Show.Unicode.html#urecoverWith"><span class="hs-identifier hs-var">urecoverWith</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="Text.Show.Unicode.html#shouldRecover"><span class="hs-identifier hs-var">shouldRecover</span></a></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="annot"><a href="Text.Show.Unicode.html#shouldRecover"><span class="hs-identifier hs-type">shouldRecover</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-78"></span><span id="shouldRecover"><span class="annot"><span class="annottext">shouldRecover :: Char -&gt; Bool
</span><a href="Text.Show.Unicode.html#shouldRecover"><span class="hs-identifier hs-var hs-var">shouldRecover</span></a></span></span><span> </span><span id="local-6989586621679024175"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679024175"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isPrint</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679024175"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isAscii</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679024175"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="annot"><span class="hs-comment">-- | A version of 'print' that uses 'ushow'.</span></span><span>
</span><span id="line-81"></span><span id="local-6989586621679024103"><span class="annot"><a href="Text.Show.Unicode.html#uprint"><span class="hs-identifier hs-type">uprint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679024103"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679024103"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-82"></span><span id="uprint"><span class="annot"><span class="annottext">uprint :: forall a. Show a =&gt; a -&gt; IO ()
</span><a href="Text.Show.Unicode.html#uprint"><span class="hs-identifier hs-var hs-var">uprint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; (a -&gt; String) -&gt; a -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="Text.Show.Unicode.html#ushow"><span class="hs-identifier hs-var">ushow</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-comment">-- | Show the input, and then replace character literals</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- with the character itself, for characters that satisfy the given predicate.</span><span>
</span><span id="line-86"></span><span id="local-6989586621679024102"><span class="annot"><a href="Text.Show.Unicode.html#ushowWith"><span class="hs-identifier hs-type">ushowWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679024102"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679024102"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span></span><span>
</span><span id="line-87"></span><span id="ushowWith"><span class="annot"><span class="annottext">ushowWith :: forall a. Show a =&gt; (Char -&gt; Bool) -&gt; a -&gt; String
</span><a href="Text.Show.Unicode.html#ushowWith"><span class="hs-identifier hs-var hs-var">ushowWith</span></a></span></span><span> </span><span id="local-6989586621679024184"><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="#local-6989586621679024184"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; String -&gt; String
</span><a href="Text.Show.Unicode.html#urecoverWith"><span class="hs-identifier hs-var">urecoverWith</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="#local-6989586621679024184"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; (a -&gt; String) -&gt; a -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-comment">-- | Replace character literals with the character itself, for characters that</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- satisfy the given predicate.</span><span>
</span><span id="line-91"></span><span class="annot"><a href="Text.Show.Unicode.html#urecoverWith"><span class="hs-identifier hs-type">urecoverWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-92"></span><span id="urecoverWith"><span class="annot"><span class="annottext">urecoverWith :: (Char -&gt; Bool) -&gt; String -&gt; String
</span><a href="Text.Show.Unicode.html#urecoverWith"><span class="hs-identifier hs-var hs-var">urecoverWith</span></a></span></span><span> </span><span id="local-6989586621679024185"><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="#local-6989586621679024185"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679024186"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679024186"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StateT String Maybe String -&gt; String -&gt; Maybe (String, String)
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var">runStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; StateT String Maybe String
</span><a href="Text.Show.Unicode.html#recoverChars"><span class="hs-identifier hs-var">recoverChars</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="#local-6989586621679024185"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679024186"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-94"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679024188"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679024188"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679024189"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679024189"><span class="hs-identifier hs-var">left</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679024188"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679024189"><span class="hs-identifier hs-var">left</span></a></span><span>
</span><span id="line-95"></span><span>      </span><span class="annot"><span class="annottext">Maybe (String, String)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679024186"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="annot"><a href="Text.Show.Unicode.html#recoverChars"><span class="hs-identifier hs-type">recoverChars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Show.Unicode.html#Parser"><span class="hs-identifier hs-type">Parser</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-99"></span><span id="recoverChars"><span class="annot"><span class="annottext">recoverChars :: (Char -&gt; Bool) -&gt; StateT String Maybe String
</span><a href="Text.Show.Unicode.html#recoverChars"><span class="hs-identifier hs-var hs-var">recoverChars</span></a></span></span><span> </span><span id="local-6989586621679024190"><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="#local-6989586621679024190"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT String Maybe String
</span><a href="#local-6989586621679024191"><span class="hs-identifier hs-var">outsideLiteral</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-101"></span><span>    </span><span id="local-6989586621679024191"><span class="annot"><span class="annottext">outsideLiteral :: StateT String Maybe String
</span><a href="#local-6989586621679024191"><span class="hs-identifier hs-var hs-var">outsideLiteral</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-102"></span><span>      </span><span id="local-6989586621679024209"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679024209"><span class="hs-identifier hs-var">notLit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT String Maybe String
</span><a href="#local-6989586621679024210"><span class="hs-identifier hs-var">untilDoubleQuote</span></a></span><span>
</span><span id="line-103"></span><span>      </span><span id="local-6989586621679024211"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679024211"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT String Maybe String
forall (m :: * -&gt; *) s. Monad m =&gt; StateT s m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-104"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679024211"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-105"></span><span>          </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\&quot;'</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679024212"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679024212"><span class="hs-identifier hs-var">inLiteral</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-106"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; StateT String Maybe ()
forall (m :: * -&gt; *) s. Monad m =&gt; s -&gt; StateT s m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679024212"><span class="hs-identifier hs-var">inLiteral</span></a></span><span>
</span><span id="line-107"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679024209"><span class="hs-identifier hs-var">notLit</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; (String -&gt; String) -&gt; String -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\&quot;'</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; String)
-&gt; StateT String Maybe String -&gt; StateT String Maybe String
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateT String Maybe String
</span><a href="#local-6989586621679024214"><span class="hs-identifier hs-var">insideLiteral</span></a></span><span>
</span><span id="line-108"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-109"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; StateT String Maybe String
forall a. a -&gt; StateT String Maybe a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; StateT String Maybe String)
-&gt; String -&gt; StateT String Maybe String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679024209"><span class="hs-identifier hs-var">notLit</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679024211"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span>    </span><span id="local-6989586621679024214"><span class="annot"><span class="annottext">insideLiteral :: StateT String Maybe String
</span><a href="#local-6989586621679024214"><span class="hs-identifier hs-var hs-var">insideLiteral</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>      </span><span id="local-6989586621679024215"><span class="annot"><span class="annottext">(String, Char)
</span><a href="#local-6989586621679024215"><span class="hs-identifier hs-var">recovered</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Parser (String, Char)
</span><a href="Text.Show.Unicode.html#recoverCharInLiteral"><span class="hs-identifier hs-var">recoverCharInLiteral</span></a></span><span>
</span><span id="line-113"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(String, Char)
</span><a href="#local-6989586621679024215"><span class="hs-identifier hs-var">recovered</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-114"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\&quot;&quot;</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'&quot;'</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'&quot;'</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; String)
-&gt; StateT String Maybe String -&gt; StateT String Maybe String
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateT String Maybe String
</span><a href="#local-6989586621679024191"><span class="hs-identifier hs-var">outsideLiteral</span></a></span><span>
</span><span id="line-115"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679024217"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679024217"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679024218"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679024218"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="#local-6989586621679024190"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679024218"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679024218"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; String)
-&gt; StateT String Maybe String -&gt; StateT String Maybe String
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateT String Maybe String
</span><a href="#local-6989586621679024214"><span class="hs-identifier hs-var">insideLiteral</span></a></span><span>
</span><span id="line-117"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679024217"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; String)
-&gt; StateT String Maybe String -&gt; StateT String Maybe String
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateT String Maybe String
</span><a href="#local-6989586621679024214"><span class="hs-identifier hs-var">insideLiteral</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>    </span><span id="local-6989586621679024210"><span class="annot"><span class="annottext">untilDoubleQuote :: StateT String Maybe String
</span><a href="#local-6989586621679024210"><span class="hs-identifier hs-var hs-var">untilDoubleQuote</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Maybe (String, String)) -&gt; StateT String Maybe String
forall s (m :: * -&gt; *) a. (s -&gt; m (a, s)) -&gt; StateT s m a
</span><span class="hs-identifier hs-var">StateT</span></span><span> </span><span class="annot"><span class="annottext">((String -&gt; Maybe (String, String)) -&gt; StateT String Maybe String)
-&gt; (String -&gt; Maybe (String, String)) -&gt; StateT String Maybe String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, String) -&gt; Maybe (String, String)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">((String, String) -&gt; Maybe (String, String))
-&gt; (String -&gt; (String, String)) -&gt; String -&gt; Maybe (String, String)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; String -&gt; (String, String)
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">L.break</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\&quot;'</span></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-comment">-- | Parse one Haskell character literal expression from a 'String' produced by 'show', and</span><span>
</span><span id="line-123"></span><span class="hs-comment">--   returns the pair of the string before parsed with the parsed character.</span><span>
</span><span id="line-124"></span><span class="hs-comment">--  * Note that special delimiter sequence &quot;\&amp;&quot; may appear in a string. c.f.  &lt;https://www.haskell.org/onlinereport/haskell2010/haskellch2.html#x7-200002.6 Section 2.6 of the Haskell 2010 specification&gt;.</span><span>
</span><span id="line-125"></span><span class="annot"><a href="Text.Show.Unicode.html#recoverCharInLiteral"><span class="hs-identifier hs-type">recoverCharInLiteral</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Show.Unicode.html#Parser"><span class="hs-identifier hs-type">Parser</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span id="recoverCharInLiteral"><span class="annot"><span class="annottext">recoverCharInLiteral :: Parser (String, Char)
</span><a href="Text.Show.Unicode.html#recoverCharInLiteral"><span class="hs-identifier hs-var hs-var">recoverCharInLiteral</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Maybe ((String, Char), String)) -&gt; Parser (String, Char)
forall s (m :: * -&gt; *) a. (s -&gt; m (a, s)) -&gt; StateT s m a
</span><span class="hs-identifier hs-var">StateT</span></span><span> </span><span class="annot"><span class="annottext">((String -&gt; Maybe ((String, Char), String))
 -&gt; Parser (String, Char))
-&gt; (String -&gt; Maybe ((String, Char), String))
-&gt; Parser (String, Char)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679024222"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679024222"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-127"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679024223"><span class="annot"><span class="annottext">result :: [((String, Char), String)]
</span><a href="#local-6989586621679024223"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReadP (String, Char) -&gt; ReadS (String, Char)
forall a. ReadP a -&gt; ReadS a
</span><span class="hs-identifier hs-var">readP_to_S</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReadP Char -&gt; ReadP (String, Char)
forall a. ReadP a -&gt; ReadP (String, a)
</span><span class="hs-identifier hs-var">gather</span></span><span> </span><span class="annot"><span class="annottext">ReadP Char
</span><span class="hs-identifier hs-var">lexChar</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679024222"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-128"></span><span>          </span><span class="hs-comment">-- The longest match result should leave the shortest string.</span><span>
</span><span id="line-129"></span><span>          </span><span class="hs-comment">-- So choose the result with the minimum length left.</span><span>
</span><span id="line-130"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(((String, Char), String) -&gt; ((String, Char), String) -&gt; Ordering)
-&gt; [((String, Char), String)] -&gt; Maybe ((String, Char), String)
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; Maybe a
</span><span class="hs-identifier hs-var">minimumByMay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((String, Char), String) -&gt; Int)
-&gt; ((String, Char), String) -&gt; ((String, Char), String) -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">O.comparing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Int)
-&gt; (((String, Char), String) -&gt; String)
-&gt; ((String, Char), String)
-&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((String, Char), String) -&gt; String
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[((String, Char), String)]
</span><a href="#local-6989586621679024223"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="annot"><span class="hs-comment">-- | A version of 'print' that uses 'ushowWith'.</span></span><span>
</span><span id="line-134"></span><span id="local-6989586621679024148"><span class="annot"><a href="Text.Show.Unicode.html#uprintWith"><span class="hs-identifier hs-type">uprintWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679024148"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679024148"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-135"></span><span id="uprintWith"><span class="annot"><span class="annottext">uprintWith :: forall a. Show a =&gt; (Char -&gt; Bool) -&gt; a -&gt; IO ()
</span><a href="Text.Show.Unicode.html#uprintWith"><span class="hs-identifier hs-var hs-var">uprintWith</span></a></span></span><span> </span><span id="local-6989586621679024229"><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="#local-6989586621679024229"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; (a -&gt; String) -&gt; a -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; a -&gt; String
forall a. Show a =&gt; (Char -&gt; Bool) -&gt; a -&gt; String
</span><a href="Text.Show.Unicode.html#ushowWith"><span class="hs-identifier hs-var">ushowWith</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="#local-6989586621679024229"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-136"></span></pre></body></html>