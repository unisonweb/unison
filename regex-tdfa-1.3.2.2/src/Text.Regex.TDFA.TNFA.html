<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- XXX design uncertainty:  should preResets be inserted into nullView?</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- if not, why not? ADDED</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">-- XXX design uncertainty: what does act -&gt; actNullable -&gt;</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- actNullableTagless not use nullQ and same for inStar, etc?</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- TODO : try rewriting whole qToNFA in terms of &quot;act&quot;</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- (That will require re-organizing the continuation data a bit)</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-comment">-- | &quot;Text.Regex.TDFA.TNFA&quot; converts the CorePattern Q\/P data (and its</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Pattern leafs) to a QNFA tagged non-deterministic finite automata.</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- This holds every possible way to follow one state by another, while</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- in the DFA these will be reduced by picking a single best</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- transition for each (source,destination) pair.  The transitions are</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- heavily and often redundantly annotated with tasks to perform, and</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- this redundancy is reduced when picking the best transition.  So</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- far, keeping all this information has helped fix bugs in both the</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- design and implementation.</span><span>
</span><span id="line-19"></span><span class="hs-comment">--</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- The QNFA for a Pattern with a starTraned Q\/P form with N one</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- character accepting leaves has at most N+1 nodes.  These nodes</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- represent the future choices after accepting a leaf.  The processing</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- of Or nodes often reduces this number by sharing at the end of the</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- different paths.  Turning off capturing while compiling the pattern</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- may (future extension) reduce this further for some patterns by</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- processing Star with optimizations.  This compact design also means</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- that tags are assigned not just to be updated before taking a</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- transition (PreUpdate) but also after the transition (PostUpdate).</span><span>
</span><span id="line-29"></span><span class="hs-comment">--</span><span>
</span><span id="line-30"></span><span class="hs-comment">-- Uses recursive do notation.</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Text.Regex.TDFA.TNFA</span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#patternToNFA"><span class="hs-identifier">patternToNFA</span></a></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier">QNFA</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier">QT</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier">QTrans</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagUpdate"><span class="hs-identifier">TagUpdate</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-comment">{- By Chris Kuklewicz, 2007. BSD License, see the LICENSE file. -}</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">State</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">runState</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">execState</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">get</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">put</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">modify</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Array.IArray</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Array</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">array</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toLower</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">toUpper</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">isAlpha</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">ord</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldl'</span></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IntMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IMap</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toAscList</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">unionWith</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">singleton</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">fromList</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">fromDistinctAscList</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.IntMap.CharMap2.html"><span class="hs-identifier">Data.IntMap.CharMap2</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier">CharMap</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.IntMap.CharMap2.html"><span class="hs-identifier">Data.IntMap.CharMap2</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">(</span><span class="annot"><a href="Data.IntMap.CharMap2.html#null"><span class="hs-identifier">null</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Data.IntMap.CharMap2.html#singleton"><span class="hs-identifier">singleton</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Data.IntMap.CharMap2.html#map"><span class="hs-identifier">map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.IntMap.EnumMap2.html"><span class="hs-identifier">Data.IntMap.EnumMap2</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EMap</span></span><span class="hs-special">(</span><span class="annot"><a href="Data.IntMap.EnumMap2.html#null"><span class="hs-identifier">null</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Data.IntMap.EnumMap2.html#keysSet"><span class="hs-identifier">keysSet</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Data.IntMap.EnumMap2.html#assocs"><span class="hs-identifier">assocs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.IntSet.EnumSet2.html"><span class="hs-identifier">Data.IntSet.EnumSet2</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Data.IntSet.EnumSet2.html#EnumSet"><span class="hs-identifier">EnumSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.IntSet.EnumSet2.html"><span class="hs-identifier">Data.IntSet.EnumSet2</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">(</span><span class="annot"><a href="Data.IntSet.EnumSet2.html#singleton"><span class="hs-identifier">singleton</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Data.IntSet.EnumSet2.html#toList"><span class="hs-identifier">toList</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Data.IntSet.EnumSet2.html#insert"><span class="hs-identifier">insert</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">catMaybes</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">isNothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Mon</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Monoid</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">insert</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toAscList</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html"><span class="hs-identifier">Text.Regex.TDFA.Common</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier">QT</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier">QNFA</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier">QTrans</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagTask"><span class="hs-identifier">TagTask</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagUpdate"><span class="hs-identifier">TagUpdate</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DoPa"><span class="hs-identifier">DoPa</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>                             </span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#CompOption"><span class="hs-identifier">CompOption</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>                             </span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier">Tag</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier">TagTasks</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagList"><span class="hs-identifier">TagList</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier">Index</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#WinTags"><span class="hs-identifier">WinTags</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupIndex"><span class="hs-identifier">GroupIndex</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupInfo"><span class="hs-identifier">GroupInfo</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>                             </span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#common_error"><span class="hs-identifier">common_error</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#noWin"><span class="hs-identifier">noWin</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#snd3"><span class="hs-identifier">snd3</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#mapSnd"><span class="hs-identifier">mapSnd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html"><span class="hs-identifier">Text.Regex.TDFA.CorePattern</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier">Q</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#P"><span class="hs-identifier">P</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#OP"><span class="hs-identifier">OP</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#WhichTest"><span class="hs-identifier">WhichTest</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#cleanNullView"><span class="hs-identifier">cleanNullView</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier">NullView</span></a></span><span>
</span><span id="line-60"></span><span>                                  </span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier">SetTestInfo</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Wanted"><span class="hs-identifier">Wanted</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#TestInfo"><span class="hs-identifier">TestInfo</span></a></span><span>
</span><span id="line-61"></span><span>                                  </span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#mustAccept"><span class="hs-identifier">mustAccept</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#cannotAccept"><span class="hs-identifier">cannotAccept</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#patternToQ"><span class="hs-identifier">patternToQ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html"><span class="hs-identifier">Text.Regex.TDFA.Pattern</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#Pattern"><span class="hs-identifier">Pattern</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#decodePatternSet"><span class="hs-identifier">decodePatternSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span id="local-6989586621679112610"><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#ecart"><span class="hs-identifier hs-type">ecart</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679112610"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679112610"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-65"></span><span id="ecart"><span class="annot"><span class="annottext">ecart :: forall a. [Char] -&gt; a -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#ecart"><span class="hs-identifier hs-var hs-var">ecart</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span id="local-6989586621679112613"><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679112613"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-68"></span><span id="err"><span class="annot"><span class="annottext">err :: forall a. [Char] -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span id="local-6989586621679113050"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679113050"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; a
forall a. [Char] -&gt; [Char] -&gt; a
</span><a href="Text.Regex.TDFA.Common.html#common_error"><span class="hs-identifier hs-var">common_error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Text.Regex.TDFA.TNFA&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679113050"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span id="local-6989586621679112616"><span id="local-6989586621679112617"><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679112616"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679112616"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679112617"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679112617"><span class="hs-identifier hs-type">s</span></a></span></span></span><span>
</span><span id="line-71"></span><span id="debug"><span class="annot"><span class="annottext">debug :: forall a s. Show a =&gt; a -&gt; s -&gt; s
</span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var hs-var">debug</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679113053"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679113053"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679113053"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#qtwin"><span class="hs-identifier hs-type">qtwin</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#qtlose"><span class="hs-identifier hs-type">qtlose</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- qtwin is the continuation after matching the whole pattern.  It has</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- no further transitions and sets tag #1 to the current position.</span><span>
</span><span id="line-76"></span><span id="qtwin"><span class="annot"><span class="annottext">qtwin :: QT
</span><a href="Text.Regex.TDFA.TNFA.html#qtwin"><span class="hs-identifier hs-var hs-var">qtwin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-type">Simple</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">qt_win :: WinTags
</span><a href="Text.Regex.TDFA.Common.html#qt_win"><span class="hs-identifier hs-var">qt_win</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagTask -&gt; TagUpdate
</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#TagTask"><span class="hs-identifier hs-var">TagTask</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_trans :: CharMap QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_trans"><span class="hs-identifier hs-var">qt_trans</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">CharMap QTrans
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_other :: QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_other"><span class="hs-identifier hs-var">qt_other</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">QTrans
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">}</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- qtlose is the continuation to nothing, used when ^ or $ tests fail.</span><span>
</span><span id="line-78"></span><span id="qtlose"><span class="annot"><span class="annottext">qtlose :: QT
</span><a href="Text.Regex.TDFA.TNFA.html#qtlose"><span class="hs-identifier hs-var hs-var">qtlose</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-type">Simple</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">qt_win :: WinTags
</span><a href="Text.Regex.TDFA.Common.html#qt_win"><span class="hs-identifier hs-var">qt_win</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">WinTags
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_trans :: CharMap QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_trans"><span class="hs-identifier hs-var">qt_trans</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">CharMap QTrans
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_other :: QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_other"><span class="hs-identifier hs-var">qt_other</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">QTrans
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">}</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#patternToNFA"><span class="hs-identifier hs-type">patternToNFA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#CompOption"><span class="hs-identifier hs-type">CompOption</span></a></span><span>
</span><span id="line-81"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupIndex"><span class="hs-identifier hs-type">GroupIndex</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DoPa"><span class="hs-identifier hs-type">DoPa</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>                </span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#OP"><span class="hs-identifier hs-type">OP</span></a></span><span>
</span><span id="line-84"></span><span>                </span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupIndex"><span class="hs-identifier hs-type">GroupIndex</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupInfo"><span class="hs-identifier hs-type">GroupInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span id="patternToNFA"><span class="annot"><span class="annottext">patternToNFA :: CompOption
-&gt; (Pattern, (Key, DoPa))
-&gt; ((Key, Array Key QNFA), Array Key OP, Array Key [GroupInfo])
</span><a href="Text.Regex.TDFA.TNFA.html#patternToNFA"><span class="hs-identifier hs-var hs-var">patternToNFA</span></a></span></span><span> </span><span id="local-6989586621679113062"><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621679113062"><span class="hs-identifier hs-var">compOpt</span></a></span></span><span> </span><span id="local-6989586621679113063"><span class="annot"><span class="annottext">(Pattern, (Key, DoPa))
</span><a href="#local-6989586621679113063"><span class="hs-identifier hs-var">pattern</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113064"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113064"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113065"><span class="annot"><span class="annottext">Array Key OP
</span><a href="#local-6989586621679113065"><span class="hs-identifier hs-var">tags</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113066"><span class="annot"><span class="annottext">Array Key [GroupInfo]
</span><a href="#local-6989586621679113066"><span class="hs-identifier hs-var">groups</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompOption
-&gt; (Pattern, (Key, DoPa))
-&gt; (Q, Array Key OP, Array Key [GroupInfo])
</span><a href="Text.Regex.TDFA.CorePattern.html#patternToQ"><span class="hs-identifier hs-var">patternToQ</span></a></span><span> </span><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621679113062"><span class="hs-identifier hs-var">compOpt</span></a></span><span> </span><span class="annot"><span class="annottext">(Pattern, (Key, DoPa))
</span><a href="#local-6989586621679113063"><span class="hs-identifier hs-var">pattern</span></a></span><span>
</span><span id="line-87"></span><span>      </span><span id="local-6989586621679113068"><span class="annot"><span class="annottext">msg :: [Char]
</span><a href="#local-6989586621679113068"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
</span><span class="hs-identifier hs-var">unlines</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Q -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113064"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; ((Key, Array Key QNFA), Array Key OP, Array Key [GroupInfo])
-&gt; ((Key, Array Key QNFA), Array Key OP, Array Key [GroupInfo])
forall a s. Show a =&gt; a -&gt; s -&gt; s
</span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679113068"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompOption -&gt; Q -&gt; (Key, Array Key QNFA)
</span><a href="Text.Regex.TDFA.TNFA.html#qToNFA"><span class="hs-identifier hs-var">qToNFA</span></a></span><span> </span><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621679113062"><span class="hs-identifier hs-var">compOpt</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113064"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Array Key OP
</span><a href="#local-6989586621679113065"><span class="hs-identifier hs-var">tags</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Array Key [GroupInfo]
</span><a href="#local-6989586621679113066"><span class="hs-identifier hs-var">groups</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">-- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- ==</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- Query function on Q</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#nullable"><span class="hs-identifier hs-type">nullable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-94"></span><span id="nullable"><span class="annot"><span class="annottext">nullable :: Q -&gt; Bool
</span><a href="Text.Regex.TDFA.TNFA.html#nullable"><span class="hs-identifier hs-var hs-var">nullable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Q -&gt; Bool) -&gt; Q -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(SetTestInfo, WinTags)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">([(SetTestInfo, WinTags)] -&gt; Bool)
-&gt; (Q -&gt; [(SetTestInfo, WinTags)]) -&gt; Q -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; [(SetTestInfo, WinTags)]
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#notNullable"><span class="hs-identifier hs-type">notNullable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-97"></span><span id="notNullable"><span class="annot"><span class="annottext">notNullable :: Q -&gt; Bool
</span><a href="Text.Regex.TDFA.TNFA.html#notNullable"><span class="hs-identifier hs-var hs-var">notNullable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(SetTestInfo, WinTags)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">([(SetTestInfo, WinTags)] -&gt; Bool)
-&gt; (Q -&gt; [(SetTestInfo, WinTags)]) -&gt; Q -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; [(SetTestInfo, WinTags)]
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- This asks if the preferred (i.e. first) NullView has no tests.</span><span>
</span><span id="line-100"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#maybeOnlyEmpty"><span class="hs-identifier hs-type">maybeOnlyEmpty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#WinTags"><span class="hs-identifier hs-type">WinTags</span></a></span><span>
</span><span id="line-101"></span><span id="maybeOnlyEmpty"><span class="annot"><span class="annottext">maybeOnlyEmpty :: Q -&gt; Maybe WinTags
</span><a href="Text.Regex.TDFA.TNFA.html#maybeOnlyEmpty"><span class="hs-identifier hs-var hs-var">maybeOnlyEmpty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">nullQ :: Q -&gt; [(SetTestInfo, WinTags)]
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier hs-type">SetTestInfo</span></a></span><span> </span><span id="local-6989586621679113081"><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa)
</span><a href="#local-6989586621679113081"><span class="hs-identifier hs-var">sti</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113082"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113082"><span class="hs-identifier hs-var">tags</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[(SetTestInfo, WinTags)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa) -&gt; Bool
forall key a. Enum key =&gt; EnumMap key a -&gt; Bool
</span><a href="Data.IntMap.EnumMap2.html#null"><span class="hs-identifier hs-var">EMap.null</span></a></span><span> </span><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa)
</span><a href="#local-6989586621679113081"><span class="hs-identifier hs-var">sti</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">WinTags -&gt; Maybe WinTags
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113082"><span class="hs-identifier hs-var">tags</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe WinTags
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-102"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#maybeOnlyEmpty"><span class="hs-identifier hs-var">maybeOnlyEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe WinTags
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#usesQNFA"><span class="hs-identifier hs-type">usesQNFA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-105"></span><span id="usesQNFA"><span class="annot"><span class="annottext">usesQNFA :: Q -&gt; Bool
</span><a href="Text.Regex.TDFA.TNFA.html#usesQNFA"><span class="hs-identifier hs-var hs-var">usesQNFA</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">wants :: Q -&gt; Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#wants"><span class="hs-identifier hs-var">wants</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#WantsBoth"><span class="hs-identifier hs-var">WantsBoth</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-106"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#usesQNFA"><span class="hs-identifier hs-var">usesQNFA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">wants :: Q -&gt; Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#wants"><span class="hs-identifier hs-var">wants</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#WantsQNFA"><span class="hs-identifier hs-var">WantsQNFA</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-107"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#usesQNFA"><span class="hs-identifier hs-var">usesQNFA</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">-- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- ==</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- Functions related to QT</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-comment">-- dumb smart constructor used by qToQNFA</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- Possible: Go through the qt and keep only the best tagged transition(s) to each state to make simple NFA?</span><span>
</span><span id="line-114"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#mkQNFA"><span class="hs-identifier hs-type">mkQNFA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a></span><span>
</span><span id="line-115"></span><span id="mkQNFA"><span class="annot"><span class="annottext">mkQNFA :: Key -&gt; QT -&gt; QNFA
</span><a href="Text.Regex.TDFA.TNFA.html#mkQNFA"><span class="hs-identifier hs-var hs-var">mkQNFA</span></a></span></span><span> </span><span id="local-6989586621679113088"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113088"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679113089"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113089"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; QNFA -&gt; QNFA
forall a s. Show a =&gt; a -&gt; s -&gt; s
</span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\n&gt;QNFA id=&quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Key -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113088"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QNFA -&gt; QNFA) -&gt; QNFA -&gt; QNFA
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-116"></span><span>  </span><span class="annot"><span class="annottext">Key -&gt; QT -&gt; QNFA
</span><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-var">QNFA</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113088"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; QT -&gt; QT
forall a s. Show a =&gt; a -&gt; s -&gt; s
</span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\ngetting QT for &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Key -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113088"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113089"><span class="hs-identifier hs-var">qt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">-- This uses the Eq QT instance above</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- ZZZ</span><span>
</span><span id="line-120"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#mkTesting"><span class="hs-identifier hs-type">mkTesting</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span>
</span><span id="line-121"></span><span id="mkTesting"><span class="annot"><span class="annottext">mkTesting :: QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mkTesting"><span class="hs-identifier hs-var hs-var">mkTesting</span></a></span></span><span> </span><span id="local-6989586621679113092"><span class="annot"><span class="annottext">t :: QT
</span><a href="#local-6989586621679113092"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-type">Testing</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">qt_a :: QT -&gt; QT
</span><a href="Text.Regex.TDFA.Common.html#qt_a"><span class="hs-identifier hs-var">qt_a</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113095"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113095"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_b :: QT -&gt; QT
</span><a href="Text.Regex.TDFA.Common.html#qt_b"><span class="hs-identifier hs-var">qt_b</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113097"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113097"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113095"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">QT -&gt; QT -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113097"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113095"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113092"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-comment">-- Move to nfsToDFA XXX</span><span>
</span><span id="line-122"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#mkTesting"><span class="hs-identifier hs-var">mkTesting</span></a></span><span> </span><span id="local-6989586621679113098"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113098"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113098"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#nullQT"><span class="hs-identifier hs-type">nullQT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-125"></span><span id="nullQT"><span class="annot"><span class="annottext">nullQT :: QT -&gt; Bool
</span><a href="Text.Regex.TDFA.TNFA.html#nullQT"><span class="hs-identifier hs-var hs-var">nullQT</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-type">Simple</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">qt_win :: QT -&gt; WinTags
</span><a href="Text.Regex.TDFA.Common.html#qt_win"><span class="hs-identifier hs-var">qt_win</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113100"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113100"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_trans :: QT -&gt; CharMap QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_trans"><span class="hs-identifier hs-var">qt_trans</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113101"><span class="annot"><span class="annottext">CharMap QTrans
</span><a href="#local-6989586621679113101"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_other :: QT -&gt; QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_other"><span class="hs-identifier hs-var">qt_other</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113102"><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113102"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WinTags -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#noWin"><span class="hs-identifier hs-var">noWin</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113100"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">CharMap QTrans -&gt; Bool
forall a. CharMap a -&gt; Bool
</span><a href="Data.IntMap.CharMap2.html#null"><span class="hs-identifier hs-var">Map.null</span></a></span><span> </span><span class="annot"><span class="annottext">CharMap QTrans
</span><a href="#local-6989586621679113101"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">QTrans -&gt; Bool
forall a. IntMap a -&gt; Bool
</span><span class="hs-identifier hs-var">IMap.null</span></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113102"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-126"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#nullQT"><span class="hs-identifier hs-var">nullQT</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-comment">-- This reconstructs the set of tests checked in processing QT, adding</span><span>
</span><span id="line-129"></span><span class="hs-comment">-- them to the passed set.</span><span>
</span><span id="line-130"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#listTestInfo"><span class="hs-identifier hs-type">listTestInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.IntSet.EnumSet2.html#EnumSet"><span class="hs-identifier hs-type">EnumSet</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#WhichTest"><span class="hs-identifier hs-type">WhichTest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.IntSet.EnumSet2.html#EnumSet"><span class="hs-identifier hs-type">EnumSet</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#WhichTest"><span class="hs-identifier hs-type">WhichTest</span></a></span><span>
</span><span id="line-131"></span><span id="listTestInfo"><span class="annot"><span class="annottext">listTestInfo :: QT -&gt; EnumSet WhichTest -&gt; EnumSet WhichTest
</span><a href="Text.Regex.TDFA.TNFA.html#listTestInfo"><span class="hs-identifier hs-var hs-var">listTestInfo</span></a></span></span><span> </span><span id="local-6989586621679113105"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113105"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span id="local-6989586621679113106"><span class="annot"><span class="annottext">EnumSet WhichTest
</span><a href="#local-6989586621679113106"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State (EnumSet WhichTest) ()
-&gt; EnumSet WhichTest -&gt; EnumSet WhichTest
forall s a. State s a -&gt; s -&gt; s
</span><span class="hs-identifier hs-var">execState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QT -&gt; State (EnumSet WhichTest) ()
forall {m :: * -&gt; *}.
MonadState (EnumSet WhichTest) m =&gt;
QT -&gt; m ()
</span><a href="#local-6989586621679113107"><span class="hs-identifier hs-var">helper</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113105"><span class="hs-identifier hs-var">qt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EnumSet WhichTest
</span><a href="#local-6989586621679113106"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679113107"><span class="annot"><span class="annottext">helper :: QT -&gt; m ()
</span><a href="#local-6989586621679113107"><span class="hs-identifier hs-var hs-var">helper</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-type">Simple</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><a href="#local-6989586621679113107"><span class="hs-identifier hs-var">helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-type">Testing</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">qt_test :: QT -&gt; WhichTest
</span><a href="Text.Regex.TDFA.Common.html#qt_test"><span class="hs-identifier hs-var">qt_test</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679113126"><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113126"><span class="hs-identifier hs-var">wt</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qt_a :: QT -&gt; QT
</span><a href="Text.Regex.TDFA.Common.html#qt_a"><span class="hs-identifier hs-var">qt_a</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679113127"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113127"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qt_b :: QT -&gt; QT
</span><a href="Text.Regex.TDFA.Common.html#qt_b"><span class="hs-identifier hs-var">qt_b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679113128"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113128"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-134"></span><span>          </span><span class="annot"><span class="annottext">(EnumSet WhichTest -&gt; EnumSet WhichTest) -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhichTest -&gt; EnumSet WhichTest -&gt; EnumSet WhichTest
forall e. Enum e =&gt; e -&gt; EnumSet e -&gt; EnumSet e
</span><a href="Data.IntSet.EnumSet2.html#insert"><span class="hs-identifier hs-var">Set.insert</span></a></span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113126"><span class="hs-identifier hs-var">wt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>          </span><span class="annot"><span class="annottext">QT -&gt; m ()
</span><a href="#local-6989586621679113107"><span class="hs-identifier hs-var">helper</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113127"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-136"></span><span>          </span><span class="annot"><span class="annottext">QT -&gt; m ()
</span><a href="#local-6989586621679113107"><span class="hs-identifier hs-var">helper</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113128"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-comment">-- This is used to view &quot;win&quot; only through NullView, and is used in</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- processing Or.</span><span>
</span><span id="line-140"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#applyNullViews"><span class="hs-identifier hs-type">applyNullViews</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-type">NullView</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span>
</span><span id="line-141"></span><span id="applyNullViews"><span class="annot"><span class="annottext">applyNullViews :: [(SetTestInfo, WinTags)] -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#applyNullViews"><span class="hs-identifier hs-var hs-var">applyNullViews</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679113130"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113130"><span class="hs-identifier hs-var">win</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113130"><span class="hs-identifier hs-var">win</span></a></span><span>
</span><span id="line-142"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#applyNullViews"><span class="hs-identifier hs-var">applyNullViews</span></a></span><span> </span><span id="local-6989586621679113131"><span class="annot"><span class="annottext">[(SetTestInfo, WinTags)]
</span><a href="#local-6989586621679113131"><span class="hs-identifier hs-var">nvs</span></a></span></span><span> </span><span id="local-6989586621679113132"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113132"><span class="hs-identifier hs-var">win</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(QT -&gt; (SetTestInfo, WinTags) -&gt; QT)
-&gt; QT -&gt; [(SetTestInfo, WinTags)] -&gt; QT
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QT -&gt; QT -&gt; (SetTestInfo, WinTags) -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#dominate"><span class="hs-identifier hs-var">dominate</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113132"><span class="hs-identifier hs-var">win</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="Text.Regex.TDFA.TNFA.html#qtlose"><span class="hs-identifier hs-var">qtlose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(SetTestInfo, WinTags)] -&gt; [(SetTestInfo, WinTags)]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([(SetTestInfo, WinTags)] -&gt; [(SetTestInfo, WinTags)])
-&gt; [(SetTestInfo, WinTags)] -&gt; [(SetTestInfo, WinTags)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(SetTestInfo, WinTags)] -&gt; [(SetTestInfo, WinTags)]
</span><a href="Text.Regex.TDFA.CorePattern.html#cleanNullView"><span class="hs-identifier hs-var">cleanNullView</span></a></span><span> </span><span class="annot"><span class="annottext">[(SetTestInfo, WinTags)]
</span><a href="#local-6989586621679113131"><span class="hs-identifier hs-var">nvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="hs-comment">-- This is used to prefer to view &quot;win&quot; through NullView.  Losing is</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- replaced by the plain win.  This is employed by Star patterns to</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- express that the first iteration is allowed to match null, but</span><span>
</span><span id="line-147"></span><span class="hs-comment">-- skipping the NullView occurs if the match fails.</span><span>
</span><span id="line-148"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#preferNullViews"><span class="hs-identifier hs-type">preferNullViews</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-type">NullView</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span>
</span><span id="line-149"></span><span id="preferNullViews"><span class="annot"><span class="annottext">preferNullViews :: [(SetTestInfo, WinTags)] -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#preferNullViews"><span class="hs-identifier hs-var hs-var">preferNullViews</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679113136"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113136"><span class="hs-identifier hs-var">win</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113136"><span class="hs-identifier hs-var">win</span></a></span><span>
</span><span id="line-150"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#preferNullViews"><span class="hs-identifier hs-var">preferNullViews</span></a></span><span> </span><span id="local-6989586621679113137"><span class="annot"><span class="annottext">[(SetTestInfo, WinTags)]
</span><a href="#local-6989586621679113137"><span class="hs-identifier hs-var">nvs</span></a></span></span><span> </span><span id="local-6989586621679113138"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113138"><span class="hs-identifier hs-var">win</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(QT -&gt; (SetTestInfo, WinTags) -&gt; QT)
-&gt; QT -&gt; [(SetTestInfo, WinTags)] -&gt; QT
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QT -&gt; QT -&gt; (SetTestInfo, WinTags) -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#dominate"><span class="hs-identifier hs-var">dominate</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113138"><span class="hs-identifier hs-var">win</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113138"><span class="hs-identifier hs-var">win</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(SetTestInfo, WinTags)] -&gt; [(SetTestInfo, WinTags)]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([(SetTestInfo, WinTags)] -&gt; [(SetTestInfo, WinTags)])
-&gt; [(SetTestInfo, WinTags)] -&gt; [(SetTestInfo, WinTags)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(SetTestInfo, WinTags)] -&gt; [(SetTestInfo, WinTags)]
</span><a href="Text.Regex.TDFA.CorePattern.html#cleanNullView"><span class="hs-identifier hs-var">cleanNullView</span></a></span><span> </span><span class="annot"><span class="annottext">[(SetTestInfo, WinTags)]
</span><a href="#local-6989586621679113137"><span class="hs-identifier hs-var">nvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-comment">{-
dominate is common to applyNullViews and preferNullViews above.

Even I no longer understand it without study.

Oversimplified: The last argument has a new set of tests &quot;sti&quot; that
must be satisfied to then apply the new &quot;tags&quot; and reach the &quot;win&quot; QT.
Failing any of this set of tests leads to the &quot;lose&quot; QT.

Closer: The &quot;win&quot; may already have some other set of tests leading to
various branches, this set is cached in winTests.  And the &quot;lose&quot; may
already have some other set of tests leading to various branches.  The
combination of &quot;win&quot; and &quot;lose&quot; and &quot;sti&quot; must check the union of
these tests, which is &quot;allTests&quot;.

Detail: The merging is done by useTest, where the tests in sti divert
losing to a branch of &quot;lose&quot; and winning to a branch of &quot;win&quot;.  Tests
not in sti are unchanged (but the losing DoPa index might be added).
-}</span><span>
</span><span id="line-171"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#dominate"><span class="hs-identifier hs-type">dominate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier hs-type">SetTestInfo</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#WinTags"><span class="hs-identifier hs-type">WinTags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span>
</span><span id="line-172"></span><span id="dominate"><span class="annot"><span class="annottext">dominate :: QT -&gt; QT -&gt; (SetTestInfo, WinTags) -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#dominate"><span class="hs-identifier hs-var hs-var">dominate</span></a></span></span><span> </span><span id="local-6989586621679113139"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113139"><span class="hs-identifier hs-var">win</span></a></span></span><span> </span><span id="local-6989586621679113140"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113140"><span class="hs-identifier hs-var">lose</span></a></span></span><span> </span><span id="local-6989586621679113141"><span class="annot"><span class="annottext">x :: (SetTestInfo, WinTags)
</span><a href="#local-6989586621679113141"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier hs-type">SetTestInfo</span></a></span><span> </span><span id="local-6989586621679113142"><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa)
</span><a href="#local-6989586621679113142"><span class="hs-identifier hs-var">sti</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113143"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113143"><span class="hs-identifier hs-var">tags</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; QT -&gt; QT
forall a s. Show a =&gt; a -&gt; s -&gt; s
</span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;dominate &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">(SetTestInfo, WinTags) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(SetTestInfo, WinTags)
</span><a href="#local-6989586621679113141"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; QT -&gt; QT
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- The winning states are reached through the SetTag</span><span>
</span><span id="line-174"></span><span>      </span><span id="local-6989586621679113144"><span class="annot"><span class="annottext">win' :: QT
</span><a href="#local-6989586621679113144"><span class="hs-identifier hs-var hs-var">win'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WinTags -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var">prependTags'</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113143"><span class="hs-identifier hs-var">tags</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113139"><span class="hs-identifier hs-var">win</span></a></span><span>
</span><span id="line-175"></span><span>      </span><span class="hs-comment">-- get the SetTestInfo</span><span>
</span><span id="line-176"></span><span>      </span><span id="local-6989586621679113147"><span class="annot"><span class="annottext">winTests :: EnumSet WhichTest
</span><a href="#local-6989586621679113147"><span class="hs-identifier hs-var hs-var">winTests</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT -&gt; EnumSet WhichTest -&gt; EnumSet WhichTest
</span><a href="Text.Regex.TDFA.TNFA.html#listTestInfo"><span class="hs-identifier hs-var">listTestInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113139"><span class="hs-identifier hs-var">win</span></a></span><span> </span><span class="annot"><span class="annottext">(EnumSet WhichTest -&gt; EnumSet WhichTest)
-&gt; EnumSet WhichTest -&gt; EnumSet WhichTest
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EnumSet WhichTest
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-177"></span><span>      </span><span id="local-6989586621679113150"><span class="annot"><span class="annottext">allTests :: EnumSet WhichTest
</span><a href="#local-6989586621679113150"><span class="hs-identifier hs-var hs-var">allTests</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QT -&gt; EnumSet WhichTest -&gt; EnumSet WhichTest
</span><a href="Text.Regex.TDFA.TNFA.html#listTestInfo"><span class="hs-identifier hs-var">listTestInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113140"><span class="hs-identifier hs-var">lose</span></a></span><span> </span><span class="annot"><span class="annottext">(EnumSet WhichTest -&gt; EnumSet WhichTest)
-&gt; EnumSet WhichTest -&gt; EnumSet WhichTest
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EnumSet WhichTest
</span><a href="#local-6989586621679113147"><span class="hs-identifier hs-var">winTests</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EnumSet WhichTest -&gt; EnumSet WhichTest -&gt; EnumSet WhichTest
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa) -&gt; EnumSet WhichTest
forall key a. Enum key =&gt; EnumMap key a -&gt; EnumSet key
</span><a href="Data.IntMap.EnumMap2.html#keysSet"><span class="hs-identifier hs-var">EMap.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa)
</span><a href="#local-6989586621679113142"><span class="hs-identifier hs-var">sti</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>      </span><span class="hs-comment">-- The first and second arguments of useTest are sorted</span><span>
</span><span id="line-179"></span><span>      </span><span class="hs-comment">-- At all times the second argument of useTest is a subset of the first</span><span>
</span><span id="line-180"></span><span>      </span><span id="local-6989586621679113156"><span class="annot"><span class="annottext">useTest :: [WhichTest] -&gt; [(WhichTest, EnumSet DoPa)] -&gt; QT -&gt; QT -&gt; QT
</span><a href="#local-6989586621679113156"><span class="hs-identifier hs-var hs-var">useTest</span></a></span></span><span> </span><span class="annot"><span class="annottext">[WhichTest]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679113157"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113157"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="annot"><span class="annottext">QT
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113157"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-comment">-- no more dominating tests to fail to choose lose, so just choose win</span><span>
</span><span id="line-181"></span><span>      </span><span class="annot"><a href="#local-6989586621679113156"><span class="hs-identifier hs-var">useTest</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113158"><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113158"><span class="hs-identifier hs-var">aTest</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679113159"><span class="annot"><span class="annottext">[WhichTest]
</span><a href="#local-6989586621679113159"><span class="hs-identifier hs-var">tests</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679113160"><span class="annot"><span class="annottext">allD :: [(WhichTest, EnumSet DoPa)]
</span><a href="#local-6989586621679113160"><span class="hs-identifier hs-var">allD</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679113161"><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113161"><span class="hs-identifier hs-var">dTest</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113162"><span class="annot"><span class="annottext">EnumSet DoPa
</span><a href="#local-6989586621679113162"><span class="hs-identifier hs-var">dopas</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679113163"><span class="annot"><span class="annottext">[(WhichTest, EnumSet DoPa)]
</span><a href="#local-6989586621679113163"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679113164"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113164"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621679113165"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113165"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-182"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113166"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113166"><span class="hs-identifier hs-var">wA</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113167"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113167"><span class="hs-identifier hs-var">wB</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113168"><span class="annot"><span class="annottext">EnumSet DoPa
</span><a href="#local-6989586621679113168"><span class="hs-identifier hs-var">wD</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT -&gt; (QT, QT, EnumSet DoPa)
</span><a href="#local-6989586621679113169"><span class="hs-identifier hs-var">branches</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113164"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-183"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679113170"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113170"><span class="hs-identifier hs-var">lA</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113171"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113171"><span class="hs-identifier hs-var">lB</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113172"><span class="annot"><span class="annottext">EnumSet DoPa
</span><a href="#local-6989586621679113172"><span class="hs-identifier hs-var">lD</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT -&gt; (QT, QT, EnumSet DoPa)
</span><a href="#local-6989586621679113169"><span class="hs-identifier hs-var">branches</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113165"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-184"></span><span>            </span><span id="local-6989586621679113169"><span class="annot"><span class="annottext">branches :: QT -&gt; (QT, QT, EnumSet DoPa)
</span><a href="#local-6989586621679113169"><span class="hs-identifier hs-var hs-var">branches</span></a></span></span><span> </span><span id="local-6989586621679113175"><span class="annot"><span class="annottext">qt :: QT
</span><a href="#local-6989586621679113175"><span class="hs-identifier hs-var">qt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-type">Testing</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113158"><span class="hs-identifier hs-var">aTest</span></a></span><span class="annot"><span class="annottext">WhichTest -&gt; WhichTest -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">QT -&gt; WhichTest
</span><a href="Text.Regex.TDFA.Common.html#qt_test"><span class="hs-identifier hs-var">qt_test</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113175"><span class="hs-identifier hs-var">qt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QT -&gt; QT
</span><a href="Text.Regex.TDFA.Common.html#qt_a"><span class="hs-identifier hs-var">qt_a</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113175"><span class="hs-identifier hs-var">qt</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">QT -&gt; QT
</span><a href="Text.Regex.TDFA.Common.html#qt_b"><span class="hs-identifier hs-var">qt_b</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113175"><span class="hs-identifier hs-var">qt</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">QT -&gt; EnumSet DoPa
</span><a href="Text.Regex.TDFA.Common.html#qt_dopas"><span class="hs-identifier hs-var">qt_dopas</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113175"><span class="hs-identifier hs-var">qt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>            </span><span class="annot"><a href="#local-6989586621679113169"><span class="hs-identifier hs-var">branches</span></a></span><span> </span><span id="local-6989586621679113177"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113177"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113177"><span class="hs-identifier hs-var">qt</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113177"><span class="hs-identifier hs-var">qt</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">EnumSet DoPa
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113158"><span class="hs-identifier hs-var">aTest</span></a></span><span> </span><span class="annot"><span class="annottext">WhichTest -&gt; WhichTest -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113161"><span class="hs-identifier hs-var">dTest</span></a></span><span>
</span><span id="line-187"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-type">Testing</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">qt_test :: WhichTest
</span><a href="Text.Regex.TDFA.Common.html#qt_test"><span class="hs-identifier hs-var">qt_test</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113158"><span class="hs-identifier hs-var">aTest</span></a></span><span>
</span><span id="line-188"></span><span>                          </span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_dopas :: EnumSet DoPa
</span><a href="Text.Regex.TDFA.Common.html#qt_dopas"><span class="hs-identifier hs-var">qt_dopas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EnumSet DoPa
</span><a href="#local-6989586621679113162"><span class="hs-identifier hs-var">dopas</span></a></span><span> </span><span class="annot"><span class="annottext">EnumSet DoPa -&gt; EnumSet DoPa -&gt; EnumSet DoPa
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">EnumSet DoPa
</span><a href="#local-6989586621679113168"><span class="hs-identifier hs-var">wD</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EnumSet DoPa -&gt; EnumSet DoPa -&gt; EnumSet DoPa
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">EnumSet DoPa
</span><a href="#local-6989586621679113172"><span class="hs-identifier hs-var">lD</span></a></span><span>
</span><span id="line-189"></span><span>                          </span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_a :: QT
</span><a href="Text.Regex.TDFA.Common.html#qt_a"><span class="hs-identifier hs-var">qt_a</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[WhichTest] -&gt; [(WhichTest, EnumSet DoPa)] -&gt; QT -&gt; QT -&gt; QT
</span><a href="#local-6989586621679113156"><span class="hs-identifier hs-var">useTest</span></a></span><span> </span><span class="annot"><span class="annottext">[WhichTest]
</span><a href="#local-6989586621679113159"><span class="hs-identifier hs-var">tests</span></a></span><span> </span><span class="annot"><span class="annottext">[(WhichTest, EnumSet DoPa)]
</span><a href="#local-6989586621679113163"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113166"><span class="hs-identifier hs-var">wA</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113170"><span class="hs-identifier hs-var">lA</span></a></span><span>
</span><span id="line-190"></span><span>                          </span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_b :: QT
</span><a href="Text.Regex.TDFA.Common.html#qt_b"><span class="hs-identifier hs-var">qt_b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113171"><span class="hs-identifier hs-var">lB</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-191"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-type">Testing</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">qt_test :: WhichTest
</span><a href="Text.Regex.TDFA.Common.html#qt_test"><span class="hs-identifier hs-var">qt_test</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113158"><span class="hs-identifier hs-var">aTest</span></a></span><span>
</span><span id="line-192"></span><span>                          </span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_dopas :: EnumSet DoPa
</span><a href="Text.Regex.TDFA.Common.html#qt_dopas"><span class="hs-identifier hs-var">qt_dopas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EnumSet DoPa
</span><a href="#local-6989586621679113168"><span class="hs-identifier hs-var">wD</span></a></span><span> </span><span class="annot"><span class="annottext">EnumSet DoPa -&gt; EnumSet DoPa -&gt; EnumSet DoPa
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">EnumSet DoPa
</span><a href="#local-6989586621679113172"><span class="hs-identifier hs-var">lD</span></a></span><span>
</span><span id="line-193"></span><span>                          </span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_a :: QT
</span><a href="Text.Regex.TDFA.Common.html#qt_a"><span class="hs-identifier hs-var">qt_a</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[WhichTest] -&gt; [(WhichTest, EnumSet DoPa)] -&gt; QT -&gt; QT -&gt; QT
</span><a href="#local-6989586621679113156"><span class="hs-identifier hs-var">useTest</span></a></span><span> </span><span class="annot"><span class="annottext">[WhichTest]
</span><a href="#local-6989586621679113159"><span class="hs-identifier hs-var">tests</span></a></span><span> </span><span class="annot"><span class="annottext">[(WhichTest, EnumSet DoPa)]
</span><a href="#local-6989586621679113160"><span class="hs-identifier hs-var">allD</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113166"><span class="hs-identifier hs-var">wA</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113170"><span class="hs-identifier hs-var">lA</span></a></span><span>
</span><span id="line-194"></span><span>                          </span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_b :: QT
</span><a href="Text.Regex.TDFA.Common.html#qt_b"><span class="hs-identifier hs-var">qt_b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[WhichTest] -&gt; [(WhichTest, EnumSet DoPa)] -&gt; QT -&gt; QT -&gt; QT
</span><a href="#local-6989586621679113156"><span class="hs-identifier hs-var">useTest</span></a></span><span> </span><span class="annot"><span class="annottext">[WhichTest]
</span><a href="#local-6989586621679113159"><span class="hs-identifier hs-var">tests</span></a></span><span> </span><span class="annot"><span class="annottext">[(WhichTest, EnumSet DoPa)]
</span><a href="#local-6989586621679113160"><span class="hs-identifier hs-var">allD</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113167"><span class="hs-identifier hs-var">wB</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113171"><span class="hs-identifier hs-var">lB</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-195"></span><span>      </span><span class="annot"><a href="#local-6989586621679113156"><span class="hs-identifier hs-var">useTest</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(WhichTest, EnumSet DoPa)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">QT
</span><span class="hs-identifier">_</span></span><span>  </span><span class="annot"><span class="annottext">QT
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; QT
forall a. [Char] -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;This case in dominate.useText cannot happen: second argument would have to have been null and that is checked before this case&quot;</span></span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[WhichTest] -&gt; [(WhichTest, EnumSet DoPa)] -&gt; QT -&gt; QT -&gt; QT
</span><a href="#local-6989586621679113156"><span class="hs-identifier hs-var">useTest</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EnumSet WhichTest -&gt; [WhichTest]
forall e. Enum e =&gt; EnumSet e -&gt; [e]
</span><a href="Data.IntSet.EnumSet2.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">EnumSet WhichTest
</span><a href="#local-6989586621679113150"><span class="hs-identifier hs-var">allTests</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa) -&gt; [(WhichTest, EnumSet DoPa)]
forall key a. Enum key =&gt; EnumMap key a -&gt; [(key, a)]
</span><a href="Data.IntMap.EnumMap2.html#assocs"><span class="hs-identifier hs-var">EMap.assocs</span></a></span><span> </span><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa)
</span><a href="#local-6989586621679113142"><span class="hs-identifier hs-var">sti</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113144"><span class="hs-identifier hs-var">win'</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113140"><span class="hs-identifier hs-var">lose</span></a></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-comment">-- 'applyTest' is only used by addTest</span><span>
</span><span id="line-199"></span><span class="hs-comment">-- 2009: maybe need to keep track of whether a change is actually made</span><span>
</span><span id="line-200"></span><span class="hs-comment">-- (beyond DoPa tracking) to the QT.</span><span>
</span><span id="line-201"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#applyTest"><span class="hs-identifier hs-type">applyTest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#TestInfo"><span class="hs-identifier hs-type">TestInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span>
</span><span id="line-202"></span><span id="applyTest"><span class="annot"><span class="annottext">applyTest :: TestInfo -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#applyTest"><span class="hs-identifier hs-var hs-var">applyTest</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113179"><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113179"><span class="hs-identifier hs-var">wt</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113180"><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679113180"><span class="hs-identifier hs-var">dopa</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679113181"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113181"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QT -&gt; Bool
</span><a href="Text.Regex.TDFA.TNFA.html#nullQT"><span class="hs-identifier hs-var">nullQT</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113181"><span class="hs-identifier hs-var">qt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113181"><span class="hs-identifier hs-var">qt</span></a></span><span>
</span><span id="line-203"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT
</span><a href="#local-6989586621679113182"><span class="hs-identifier hs-var">applyTest'</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113181"><span class="hs-identifier hs-var">qt</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-204"></span><span>  </span><span class="annot"><a href="#local-6989586621679113182"><span class="hs-identifier hs-type">applyTest'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span>
</span><span id="line-205"></span><span>  </span><span id="local-6989586621679113182"><span class="annot"><span class="annottext">applyTest' :: QT -&gt; QT
</span><a href="#local-6989586621679113182"><span class="hs-identifier hs-var hs-var">applyTest'</span></a></span></span><span> </span><span id="local-6989586621679113183"><span class="annot"><span class="annottext">q :: QT
</span><a href="#local-6989586621679113183"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-type">Simple</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-206"></span><span>    </span><span class="annot"><span class="annottext">QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mkTesting"><span class="hs-identifier hs-var">mkTesting</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; QT -&gt; QT
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-type">Testing</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">qt_test :: WhichTest
</span><a href="Text.Regex.TDFA.Common.html#qt_test"><span class="hs-identifier hs-var">qt_test</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113179"><span class="hs-identifier hs-var">wt</span></a></span><span>
</span><span id="line-207"></span><span>                        </span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_dopas :: EnumSet DoPa
</span><a href="Text.Regex.TDFA.Common.html#qt_dopas"><span class="hs-identifier hs-var">qt_dopas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DoPa -&gt; EnumSet DoPa
forall e. Enum e =&gt; e -&gt; EnumSet e
</span><a href="Data.IntSet.EnumSet2.html#singleton"><span class="hs-identifier hs-var">Set.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679113180"><span class="hs-identifier hs-var">dopa</span></a></span><span>
</span><span id="line-208"></span><span>                        </span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_a :: QT
</span><a href="Text.Regex.TDFA.Common.html#qt_a"><span class="hs-identifier hs-var">qt_a</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113183"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-209"></span><span>                        </span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_b :: QT
</span><a href="Text.Regex.TDFA.Common.html#qt_b"><span class="hs-identifier hs-var">qt_b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="Text.Regex.TDFA.TNFA.html#qtlose"><span class="hs-identifier hs-var">qtlose</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><a href="#local-6989586621679113182"><span class="hs-identifier hs-var">applyTest'</span></a></span><span> </span><span id="local-6989586621679113184"><span class="annot"><span class="annottext">q :: QT
</span><a href="#local-6989586621679113184"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-type">Testing</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">qt_test :: QT -&gt; WhichTest
</span><a href="Text.Regex.TDFA.Common.html#qt_test"><span class="hs-identifier hs-var">qt_test</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113185"><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113185"><span class="hs-identifier hs-var">wt'</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WhichTest -&gt; WhichTest -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113179"><span class="hs-identifier hs-var">wt</span></a></span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113185"><span class="hs-identifier hs-var">wt'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-212"></span><span>      </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-type">Testing</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">qt_test :: WhichTest
</span><a href="Text.Regex.TDFA.Common.html#qt_test"><span class="hs-identifier hs-var">qt_test</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113179"><span class="hs-identifier hs-var">wt</span></a></span><span>
</span><span id="line-213"></span><span>                    </span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_dopas :: EnumSet DoPa
</span><a href="Text.Regex.TDFA.Common.html#qt_dopas"><span class="hs-identifier hs-var">qt_dopas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DoPa -&gt; EnumSet DoPa
forall e. Enum e =&gt; e -&gt; EnumSet e
</span><a href="Data.IntSet.EnumSet2.html#singleton"><span class="hs-identifier hs-var">Set.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679113180"><span class="hs-identifier hs-var">dopa</span></a></span><span>
</span><span id="line-214"></span><span>                    </span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_a :: QT
</span><a href="Text.Regex.TDFA.Common.html#qt_a"><span class="hs-identifier hs-var">qt_a</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113184"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-215"></span><span>                    </span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_b :: QT
</span><a href="Text.Regex.TDFA.Common.html#qt_b"><span class="hs-identifier hs-var">qt_b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="Text.Regex.TDFA.TNFA.html#qtlose"><span class="hs-identifier hs-var">qtlose</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-216"></span><span>      </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113184"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#qt_dopas"><span class="hs-identifier hs-var">qt_dopas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.IntSet.EnumSet2.html#insert"><span class="hs-identifier hs-type">Set.insert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113180"><span class="hs-identifier hs-type">dopa</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#qt_dopas"><span class="hs-identifier hs-var">qt_dopas</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113184"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>              </span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#qt_b"><span class="hs-identifier hs-var">qt_b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#qtlose"><span class="hs-identifier hs-type">qtlose</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-218"></span><span>      </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113184"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#qt_a"><span class="hs-identifier hs-var">qt_a</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679113182"><span class="hs-identifier hs-type">applyTest'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#qt_a"><span class="hs-identifier hs-var">qt_a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113184"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>              </span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#qt_b"><span class="hs-identifier hs-var">qt_b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679113182"><span class="hs-identifier hs-type">applyTest'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#qt_b"><span class="hs-identifier hs-var">qt_b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113184"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-comment">-- Three ways to merge a pair of QT's varying how winning transitions</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- are handled.</span><span>
</span><span id="line-223"></span><span class="hs-comment">--</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- mergeQT_2nd is used by the NonEmpty case and always discards the</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- first argument's win and uses the second argument's win.</span><span>
</span><span id="line-226"></span><span class="hs-comment">--</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- mergeAltQT is used by the Or cases and is biased to the first</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- argument's winning transition, if present.</span><span>
</span><span id="line-229"></span><span class="hs-comment">--</span><span>
</span><span id="line-230"></span><span class="hs-comment">-- mergeQT is used by Star and mergeE and combines the winning</span><span>
</span><span id="line-231"></span><span class="hs-comment">-- transitions (concatenating the instructions).</span><span>
</span><span id="line-232"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#mergeQT_2nd"><span class="hs-identifier hs-type">mergeQT_2nd</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#mergeAltQT"><span class="hs-identifier hs-type">mergeAltQT</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#mergeQT"><span class="hs-identifier hs-type">mergeQT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span>
</span><span id="line-233"></span><span id="mergeQT_2nd"><span class="annot"><span class="annottext">mergeQT_2nd :: QT -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mergeQT_2nd"><span class="hs-identifier hs-var hs-var">mergeQT_2nd</span></a></span></span><span> </span><span id="local-6989586621679113190"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113190"><span class="hs-identifier hs-var">q1</span></a></span></span><span> </span><span id="local-6989586621679113191"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113191"><span class="hs-identifier hs-var">q2</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QT -&gt; Bool
</span><a href="Text.Regex.TDFA.TNFA.html#nullQT"><span class="hs-identifier hs-var">nullQT</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113190"><span class="hs-identifier hs-var">q1</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113191"><span class="hs-identifier hs-var">q2</span></a></span><span>
</span><span id="line-234"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WinTags -&gt; WinTags -&gt; WinTags) -&gt; QT -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mergeQTWith"><span class="hs-identifier hs-var">mergeQTWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">WinTags
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679113193"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113193"><span class="hs-identifier hs-var">w2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113193"><span class="hs-identifier hs-var">w2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113190"><span class="hs-identifier hs-var">q1</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113191"><span class="hs-identifier hs-var">q2</span></a></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span id="mergeAltQT"><span class="annot"><span class="annottext">mergeAltQT :: QT -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mergeAltQT"><span class="hs-identifier hs-var hs-var">mergeAltQT</span></a></span></span><span> </span><span id="local-6989586621679113194"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113194"><span class="hs-identifier hs-var">q1</span></a></span></span><span> </span><span id="local-6989586621679113195"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113195"><span class="hs-identifier hs-var">q2</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QT -&gt; Bool
</span><a href="Text.Regex.TDFA.TNFA.html#nullQT"><span class="hs-identifier hs-var">nullQT</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113194"><span class="hs-identifier hs-var">q1</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113195"><span class="hs-identifier hs-var">q2</span></a></span><span>  </span><span class="hs-comment">-- prefer winning with w1 then with w2</span><span>
</span><span id="line-237"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WinTags -&gt; WinTags -&gt; WinTags) -&gt; QT -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mergeQTWith"><span class="hs-identifier hs-var">mergeQTWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679113196"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113196"><span class="hs-identifier hs-var">w1</span></a></span></span><span> </span><span id="local-6989586621679113197"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113197"><span class="hs-identifier hs-var">w2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">WinTags -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#noWin"><span class="hs-identifier hs-var">noWin</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113196"><span class="hs-identifier hs-var">w1</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113197"><span class="hs-identifier hs-var">w2</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113196"><span class="hs-identifier hs-var">w1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113194"><span class="hs-identifier hs-var">q1</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113195"><span class="hs-identifier hs-var">q2</span></a></span><span>
</span><span id="line-238"></span><span id="mergeQT"><span class="annot"><span class="annottext">mergeQT :: QT -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mergeQT"><span class="hs-identifier hs-var hs-var">mergeQT</span></a></span></span><span> </span><span id="local-6989586621679113198"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113198"><span class="hs-identifier hs-var">q1</span></a></span></span><span> </span><span id="local-6989586621679113199"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113199"><span class="hs-identifier hs-var">q2</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QT -&gt; Bool
</span><a href="Text.Regex.TDFA.TNFA.html#nullQT"><span class="hs-identifier hs-var">nullQT</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113198"><span class="hs-identifier hs-var">q1</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113199"><span class="hs-identifier hs-var">q2</span></a></span><span>  </span><span class="hs-comment">-- union wins</span><span>
</span><span id="line-239"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QT -&gt; Bool
</span><a href="Text.Regex.TDFA.TNFA.html#nullQT"><span class="hs-identifier hs-var">nullQT</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113199"><span class="hs-identifier hs-var">q2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113198"><span class="hs-identifier hs-var">q1</span></a></span><span>  </span><span class="hs-comment">-- union wins</span><span>
</span><span id="line-240"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WinTags -&gt; WinTags -&gt; WinTags) -&gt; QT -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mergeQTWith"><span class="hs-identifier hs-var">mergeQTWith</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags -&gt; WinTags -&gt; WinTags
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">mappend</span></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113198"><span class="hs-identifier hs-var">q1</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113199"><span class="hs-identifier hs-var">q2</span></a></span><span> </span><span class="hs-comment">-- no preference, win with combined SetTag XXX is the wrong thing! &quot;(.?)*&quot;</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="hs-comment">-- This takes a function which implements a policy on merging</span><span>
</span><span id="line-243"></span><span class="hs-comment">-- winning transitions and then merges all the transitions.  It opens</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- the CharMap newtype for more efficient operation, then rewraps it.</span><span>
</span><span id="line-245"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#mergeQTWith"><span class="hs-identifier hs-type">mergeQTWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#WinTags"><span class="hs-identifier hs-type">WinTags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#WinTags"><span class="hs-identifier hs-type">WinTags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#WinTags"><span class="hs-identifier hs-type">WinTags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span>
</span><span id="line-246"></span><span id="mergeQTWith"><span class="annot"><span class="annottext">mergeQTWith :: (WinTags -&gt; WinTags -&gt; WinTags) -&gt; QT -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mergeQTWith"><span class="hs-identifier hs-var hs-var">mergeQTWith</span></a></span></span><span> </span><span id="local-6989586621679113200"><span class="annot"><span class="annottext">WinTags -&gt; WinTags -&gt; WinTags
</span><a href="#local-6989586621679113200"><span class="hs-identifier hs-var">mergeWins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT -&gt; QT
</span><a href="#local-6989586621679113201"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-247"></span><span>  </span><span class="annot"><a href="#local-6989586621679113201"><span class="hs-identifier hs-type">merge</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span>
</span><span id="line-248"></span><span>  </span><span id="local-6989586621679113201"><span class="annot"><span class="annottext">merge :: QT -&gt; QT -&gt; QT
</span><a href="#local-6989586621679113201"><span class="hs-identifier hs-var hs-var">merge</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-type">Simple</span></a></span><span> </span><span id="local-6989586621679113202"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113202"><span class="hs-identifier hs-var">w1</span></a></span></span><span> </span><span id="local-6989586621679113203"><span class="annot"><span class="annottext">CharMap QTrans
</span><a href="#local-6989586621679113203"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679113204"><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113204"><span class="hs-identifier hs-var">o1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-type">Simple</span></a></span><span> </span><span id="local-6989586621679113205"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113205"><span class="hs-identifier hs-var">w2</span></a></span></span><span> </span><span id="local-6989586621679113206"><span class="annot"><span class="annottext">CharMap QTrans
</span><a href="#local-6989586621679113206"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span id="local-6989586621679113207"><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113207"><span class="hs-identifier hs-var">o2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113208"><span class="annot"><span class="annottext">w' :: WinTags
</span><a href="#local-6989586621679113208"><span class="hs-identifier hs-var hs-var">w'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WinTags -&gt; WinTags -&gt; WinTags
</span><a href="#local-6989586621679113200"><span class="hs-identifier hs-var">mergeWins</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113202"><span class="hs-identifier hs-var">w1</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113205"><span class="hs-identifier hs-var">w2</span></a></span><span>
</span><span id="line-250"></span><span>        </span><span id="local-6989586621679113209"><span class="annot"><span class="annottext">t' :: CharMap QTrans
</span><a href="#local-6989586621679113209"><span class="hs-identifier hs-var hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CharMap QTrans
-&gt; QTrans -&gt; CharMap QTrans -&gt; QTrans -&gt; CharMap QTrans
</span><a href="#local-6989586621679113210"><span class="hs-identifier hs-var">fuseQTrans</span></a></span><span> </span><span class="annot"><span class="annottext">CharMap QTrans
</span><a href="#local-6989586621679113203"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113204"><span class="hs-identifier hs-var">o1</span></a></span><span> </span><span class="annot"><span class="annottext">CharMap QTrans
</span><a href="#local-6989586621679113206"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113207"><span class="hs-identifier hs-var">o2</span></a></span><span>
</span><span id="line-251"></span><span>        </span><span id="local-6989586621679113211"><span class="annot"><span class="annottext">o' :: QTrans
</span><a href="#local-6989586621679113211"><span class="hs-identifier hs-var hs-var">o'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTrans -&gt; QTrans -&gt; QTrans
</span><a href="#local-6989586621679113212"><span class="hs-identifier hs-var">mergeQTrans</span></a></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113204"><span class="hs-identifier hs-var">o1</span></a></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113207"><span class="hs-identifier hs-var">o2</span></a></span><span>
</span><span id="line-252"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">WinTags -&gt; CharMap QTrans -&gt; QTrans -&gt; QT
</span><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-var">Simple</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113208"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">CharMap QTrans
</span><a href="#local-6989586621679113209"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113211"><span class="hs-identifier hs-var">o'</span></a></span><span>
</span><span id="line-253"></span><span>  </span><span class="annot"><a href="#local-6989586621679113201"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span id="local-6989586621679113213"><span class="annot"><span class="annottext">t1 :: QT
</span><a href="#local-6989586621679113213"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-type">Testing</span></a></span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">EnumSet DoPa
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679113214"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113214"><span class="hs-identifier hs-var">a1</span></a></span></span><span> </span><span id="local-6989586621679113215"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113215"><span class="hs-identifier hs-var">b1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679113216"><span class="annot"><span class="annottext">s2 :: QT
</span><a href="#local-6989586621679113216"><span class="hs-identifier hs-var">s2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-type">Simple</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mkTesting"><span class="hs-identifier hs-var">mkTesting</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; QT -&gt; QT
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-254"></span><span>    </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113213"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#qt_a"><span class="hs-identifier hs-var">qt_a</span></a></span><span class="hs-glyph">=</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679113201"><span class="hs-identifier hs-type">merge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113214"><span class="hs-identifier hs-type">a1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113216"><span class="hs-identifier hs-type">s2</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#qt_b"><span class="hs-identifier hs-var">qt_b</span></a></span><span class="hs-glyph">=</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679113201"><span class="hs-identifier hs-type">merge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113215"><span class="hs-identifier hs-type">b1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113216"><span class="hs-identifier hs-type">s2</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-255"></span><span>  </span><span class="annot"><a href="#local-6989586621679113201"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span id="local-6989586621679113217"><span class="annot"><span class="annottext">s1 :: QT
</span><a href="#local-6989586621679113217"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-type">Simple</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679113218"><span class="annot"><span class="annottext">t2 :: QT
</span><a href="#local-6989586621679113218"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-type">Testing</span></a></span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">EnumSet DoPa
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679113219"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113219"><span class="hs-identifier hs-var">a2</span></a></span></span><span> </span><span id="local-6989586621679113220"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113220"><span class="hs-identifier hs-var">b2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mkTesting"><span class="hs-identifier hs-var">mkTesting</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; QT -&gt; QT
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113218"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#qt_a"><span class="hs-identifier hs-var">qt_a</span></a></span><span class="hs-glyph">=</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679113201"><span class="hs-identifier hs-type">merge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113217"><span class="hs-identifier hs-type">s1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113219"><span class="hs-identifier hs-type">a2</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#qt_b"><span class="hs-identifier hs-var">qt_b</span></a></span><span class="hs-glyph">=</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679113201"><span class="hs-identifier hs-type">merge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113217"><span class="hs-identifier hs-type">s1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113220"><span class="hs-identifier hs-type">b2</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-257"></span><span>  </span><span class="annot"><a href="#local-6989586621679113201"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span id="local-6989586621679113221"><span class="annot"><span class="annottext">t1 :: QT
</span><a href="#local-6989586621679113221"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-type">Testing</span></a></span><span> </span><span id="local-6989586621679113222"><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113222"><span class="hs-identifier hs-var">wt1</span></a></span></span><span> </span><span id="local-6989586621679113223"><span class="annot"><span class="annottext">EnumSet DoPa
</span><a href="#local-6989586621679113223"><span class="hs-identifier hs-var">ds1</span></a></span></span><span> </span><span id="local-6989586621679113224"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113224"><span class="hs-identifier hs-var">a1</span></a></span></span><span> </span><span id="local-6989586621679113225"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113225"><span class="hs-identifier hs-var">b1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679113226"><span class="annot"><span class="annottext">t2 :: QT
</span><a href="#local-6989586621679113226"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-type">Testing</span></a></span><span> </span><span id="local-6989586621679113227"><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113227"><span class="hs-identifier hs-var">wt2</span></a></span></span><span> </span><span id="local-6989586621679113228"><span class="annot"><span class="annottext">EnumSet DoPa
</span><a href="#local-6989586621679113228"><span class="hs-identifier hs-var">ds2</span></a></span></span><span> </span><span id="local-6989586621679113229"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113229"><span class="hs-identifier hs-var">a2</span></a></span></span><span> </span><span id="local-6989586621679113230"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113230"><span class="hs-identifier hs-var">b2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mkTesting"><span class="hs-identifier hs-var">mkTesting</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; QT -&gt; QT
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WhichTest -&gt; WhichTest -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113222"><span class="hs-identifier hs-var">wt1</span></a></span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113227"><span class="hs-identifier hs-var">wt2</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-259"></span><span>      </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113221"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#qt_a"><span class="hs-identifier hs-var">qt_a</span></a></span><span class="hs-glyph">=</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679113201"><span class="hs-identifier hs-type">merge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113224"><span class="hs-identifier hs-type">a1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113226"><span class="hs-identifier hs-type">t2</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#qt_b"><span class="hs-identifier hs-var">qt_b</span></a></span><span class="hs-glyph">=</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679113201"><span class="hs-identifier hs-type">merge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113225"><span class="hs-identifier hs-type">b1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113226"><span class="hs-identifier hs-type">t2</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-260"></span><span>      </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-type">Testing</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">qt_test :: WhichTest
</span><a href="Text.Regex.TDFA.Common.html#qt_test"><span class="hs-identifier hs-var">qt_test</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113222"><span class="hs-identifier hs-var">wt1</span></a></span><span> </span><span class="hs-comment">-- same as wt2</span><span>
</span><span id="line-261"></span><span>                    </span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_dopas :: EnumSet DoPa
</span><a href="Text.Regex.TDFA.Common.html#qt_dopas"><span class="hs-identifier hs-var">qt_dopas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EnumSet DoPa -&gt; EnumSet DoPa -&gt; EnumSet DoPa
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">mappend</span></span><span> </span><span class="annot"><span class="annottext">EnumSet DoPa
</span><a href="#local-6989586621679113223"><span class="hs-identifier hs-var">ds1</span></a></span><span> </span><span class="annot"><span class="annottext">EnumSet DoPa
</span><a href="#local-6989586621679113228"><span class="hs-identifier hs-var">ds2</span></a></span><span>
</span><span id="line-262"></span><span>                    </span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_a :: QT
</span><a href="Text.Regex.TDFA.Common.html#qt_a"><span class="hs-identifier hs-var">qt_a</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT -&gt; QT
</span><a href="#local-6989586621679113201"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113224"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113229"><span class="hs-identifier hs-var">a2</span></a></span><span>
</span><span id="line-263"></span><span>                    </span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_b :: QT
</span><a href="Text.Regex.TDFA.Common.html#qt_b"><span class="hs-identifier hs-var">qt_b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT -&gt; QT
</span><a href="#local-6989586621679113201"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113225"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113230"><span class="hs-identifier hs-var">b2</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-264"></span><span>      </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113226"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#qt_a"><span class="hs-identifier hs-var">qt_a</span></a></span><span class="hs-glyph">=</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679113201"><span class="hs-identifier hs-type">merge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113221"><span class="hs-identifier hs-type">t1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113229"><span class="hs-identifier hs-type">a2</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#qt_b"><span class="hs-identifier hs-var">qt_b</span></a></span><span class="hs-glyph">=</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679113201"><span class="hs-identifier hs-type">merge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113221"><span class="hs-identifier hs-type">t1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113230"><span class="hs-identifier hs-type">b2</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span>  </span><span class="annot"><a href="#local-6989586621679113210"><span class="hs-identifier hs-type">fuseQTrans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-type">CharMap</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier hs-type">QTrans</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier hs-type">QTrans</span></a></span><span>
</span><span id="line-267"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-type">CharMap</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier hs-type">QTrans</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier hs-type">QTrans</span></a></span><span>
</span><span id="line-268"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-type">CharMap</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier hs-type">QTrans</span></a></span><span>
</span><span id="line-269"></span><span>  </span><span id="local-6989586621679113210"><span class="annot"><span class="annottext">fuseQTrans :: CharMap QTrans
-&gt; QTrans -&gt; CharMap QTrans -&gt; QTrans -&gt; CharMap QTrans
</span><a href="#local-6989586621679113210"><span class="hs-identifier hs-var hs-var">fuseQTrans</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-type">CharMap</span></a></span><span> </span><span id="local-6989586621679113232"><span class="annot"><span class="annottext">IntMap QTrans
</span><a href="#local-6989586621679113232"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679113233"><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113233"><span class="hs-identifier hs-var">o1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-type">CharMap</span></a></span><span> </span><span id="local-6989586621679113234"><span class="annot"><span class="annottext">IntMap QTrans
</span><a href="#local-6989586621679113234"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679113235"><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113235"><span class="hs-identifier hs-var">o2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap QTrans -&gt; CharMap QTrans
forall a. IntMap a -&gt; CharMap a
</span><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-var">CharMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Key, QTrans)] -&gt; IntMap QTrans
forall a. [(Key, a)] -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.fromDistinctAscList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Key, QTrans)] -&gt; [(Key, QTrans)] -&gt; [(Key, QTrans)]
forall {a}.
Ord a =&gt;
[(a, QTrans)] -&gt; [(a, QTrans)] -&gt; [(a, QTrans)]
</span><a href="#local-6989586621679113236"><span class="hs-identifier hs-var">fuse</span></a></span><span> </span><span class="annot"><span class="annottext">[(Key, QTrans)]
</span><a href="#local-6989586621679113237"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Key, QTrans)]
</span><a href="#local-6989586621679113238"><span class="hs-identifier hs-var">l2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-270"></span><span>    </span><span id="local-6989586621679113237"><span class="annot"><span class="annottext">l1 :: [(Key, QTrans)]
</span><a href="#local-6989586621679113237"><span class="hs-identifier hs-var hs-var">l1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap QTrans -&gt; [(Key, QTrans)]
forall a. IntMap a -&gt; [(Key, a)]
</span><span class="hs-identifier hs-var">IMap.toAscList</span></span><span> </span><span class="annot"><span class="annottext">IntMap QTrans
</span><a href="#local-6989586621679113232"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-271"></span><span>    </span><span id="local-6989586621679113238"><span class="annot"><span class="annottext">l2 :: [(Key, QTrans)]
</span><a href="#local-6989586621679113238"><span class="hs-identifier hs-var hs-var">l2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap QTrans -&gt; [(Key, QTrans)]
forall a. IntMap a -&gt; [(Key, a)]
</span><span class="hs-identifier hs-var">IMap.toAscList</span></span><span> </span><span class="annot"><span class="annottext">IntMap QTrans
</span><a href="#local-6989586621679113234"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-272"></span><span>    </span><span id="local-6989586621679113236"><span class="annot"><span class="annottext">fuse :: [(a, QTrans)] -&gt; [(a, QTrans)] -&gt; [(a, QTrans)]
</span><a href="#local-6989586621679113236"><span class="hs-identifier hs-var hs-var">fuse</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679113247"><span class="annot"><span class="annottext">[(a, QTrans)]
</span><a href="#local-6989586621679113247"><span class="hs-identifier hs-var">y</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(QTrans -&gt; QTrans) -&gt; [(a, QTrans)] -&gt; [(a, QTrans)]
forall (f :: * -&gt; *) t1 t2 t.
Functor f =&gt;
(t1 -&gt; t2) -&gt; f (t, t1) -&gt; f (t, t2)
</span><a href="Text.Regex.TDFA.Common.html#mapSnd"><span class="hs-identifier hs-var">mapSnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QTrans -&gt; QTrans -&gt; QTrans
</span><a href="#local-6989586621679113212"><span class="hs-identifier hs-var">mergeQTrans</span></a></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113233"><span class="hs-identifier hs-var">o1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(a, QTrans)]
</span><a href="#local-6989586621679113247"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-273"></span><span>    </span><span class="annot"><a href="#local-6989586621679113236"><span class="hs-identifier hs-var">fuse</span></a></span><span> </span><span id="local-6989586621679113248"><span class="annot"><span class="annottext">[(a, QTrans)]
</span><a href="#local-6989586621679113248"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(QTrans -&gt; QTrans) -&gt; [(a, QTrans)] -&gt; [(a, QTrans)]
forall (f :: * -&gt; *) t1 t2 t.
Functor f =&gt;
(t1 -&gt; t2) -&gt; f (t, t1) -&gt; f (t, t2)
</span><a href="Text.Regex.TDFA.Common.html#mapSnd"><span class="hs-identifier hs-var">mapSnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QTrans -&gt; QTrans -&gt; QTrans
</span><a href="#local-6989586621679113212"><span class="hs-identifier hs-var">mergeQTrans</span></a></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113235"><span class="hs-identifier hs-var">o2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(a, QTrans)]
</span><a href="#local-6989586621679113248"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-274"></span><span>    </span><span class="annot"><a href="#local-6989586621679113236"><span class="hs-identifier hs-var">fuse</span></a></span><span> </span><span id="local-6989586621679113249"><span class="annot"><span class="annottext">x :: [(a, QTrans)]
</span><a href="#local-6989586621679113249"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679113250"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113250"><span class="hs-identifier hs-var">xc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113251"><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113251"><span class="hs-identifier hs-var">xa</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679113252"><span class="annot"><span class="annottext">[(a, QTrans)]
</span><a href="#local-6989586621679113252"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679113253"><span class="annot"><span class="annottext">y :: [(a, QTrans)]
</span><a href="#local-6989586621679113253"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679113254"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113254"><span class="hs-identifier hs-var">yc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113255"><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113255"><span class="hs-identifier hs-var">ya</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679113256"><span class="annot"><span class="annottext">[(a, QTrans)]
</span><a href="#local-6989586621679113256"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-275"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113250"><span class="hs-identifier hs-var">xc</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113254"><span class="hs-identifier hs-var">yc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-276"></span><span>        </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113250"><span class="hs-identifier hs-var">xc</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">QTrans -&gt; QTrans -&gt; QTrans
</span><a href="#local-6989586621679113212"><span class="hs-identifier hs-var">mergeQTrans</span></a></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113251"><span class="hs-identifier hs-var">xa</span></a></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113235"><span class="hs-identifier hs-var">o2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a, QTrans) -&gt; [(a, QTrans)] -&gt; [(a, QTrans)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(a, QTrans)] -&gt; [(a, QTrans)] -&gt; [(a, QTrans)]
</span><a href="#local-6989586621679113236"><span class="hs-identifier hs-var">fuse</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, QTrans)]
</span><a href="#local-6989586621679113252"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, QTrans)]
</span><a href="#local-6989586621679113253"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-277"></span><span>        </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113250"><span class="hs-identifier hs-var">xc</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">QTrans -&gt; QTrans -&gt; QTrans
</span><a href="#local-6989586621679113212"><span class="hs-identifier hs-var">mergeQTrans</span></a></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113251"><span class="hs-identifier hs-var">xa</span></a></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113255"><span class="hs-identifier hs-var">ya</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a, QTrans) -&gt; [(a, QTrans)] -&gt; [(a, QTrans)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(a, QTrans)] -&gt; [(a, QTrans)] -&gt; [(a, QTrans)]
</span><a href="#local-6989586621679113236"><span class="hs-identifier hs-var">fuse</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, QTrans)]
</span><a href="#local-6989586621679113252"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, QTrans)]
</span><a href="#local-6989586621679113256"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113254"><span class="hs-identifier hs-var">yc</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">QTrans -&gt; QTrans -&gt; QTrans
</span><a href="#local-6989586621679113212"><span class="hs-identifier hs-var">mergeQTrans</span></a></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113233"><span class="hs-identifier hs-var">o1</span></a></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113255"><span class="hs-identifier hs-var">ya</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a, QTrans) -&gt; [(a, QTrans)] -&gt; [(a, QTrans)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(a, QTrans)] -&gt; [(a, QTrans)] -&gt; [(a, QTrans)]
</span><a href="#local-6989586621679113236"><span class="hs-identifier hs-var">fuse</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, QTrans)]
</span><a href="#local-6989586621679113249"><span class="hs-identifier hs-var">x</span></a></span><span>  </span><span class="annot"><span class="annottext">[(a, QTrans)]
</span><a href="#local-6989586621679113256"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span>  </span><span class="annot"><a href="#local-6989586621679113212"><span class="hs-identifier hs-type">mergeQTrans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier hs-type">QTrans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier hs-type">QTrans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier hs-type">QTrans</span></a></span><span>
</span><span id="line-281"></span><span>  </span><span id="local-6989586621679113212"><span class="annot"><span class="annottext">mergeQTrans :: QTrans -&gt; QTrans -&gt; QTrans
</span><a href="#local-6989586621679113212"><span class="hs-identifier hs-var hs-var">mergeQTrans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([TagCommand] -&gt; [TagCommand] -&gt; [TagCommand])
-&gt; QTrans -&gt; QTrans -&gt; QTrans
forall a. (a -&gt; a -&gt; a) -&gt; IntMap a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.unionWith</span></span><span> </span><span class="annot"><span class="annottext">[TagCommand] -&gt; [TagCommand] -&gt; [TagCommand]
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">mappend</span></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="hs-comment">-- Note: There are no append* operations. There are only these</span><span>
</span><span id="line-284"></span><span class="hs-comment">-- prepend* operations because things are only prepended to the future</span><span>
</span><span id="line-285"></span><span class="hs-comment">-- continuation.  And the ordering is significant.</span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="hs-comment">-- This is only used in inStar/nullable</span><span>
</span><span id="line-288"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#prependPreTag"><span class="hs-identifier hs-type">prependPreTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span>
</span><span id="line-289"></span><span id="prependPreTag"><span class="annot"><span class="annottext">prependPreTag :: Maybe Key -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#prependPreTag"><span class="hs-identifier hs-var hs-var">prependPreTag</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span id="local-6989586621679113258"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113258"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113258"><span class="hs-identifier hs-var">qt</span></a></span><span>
</span><span id="line-290"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#prependPreTag"><span class="hs-identifier hs-var">prependPreTag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679113259"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113259"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679113260"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113260"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WinTags -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var">prependTags'</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113259"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagTask -&gt; TagUpdate
</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#TagTask"><span class="hs-identifier hs-var">TagTask</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113260"><span class="hs-identifier hs-var">qt</span></a></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#prependGroupResets"><span class="hs-identifier hs-type">prependGroupResets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span>
</span><span id="line-293"></span><span id="prependGroupResets"><span class="annot"><span class="annottext">prependGroupResets :: [Key] -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#prependGroupResets"><span class="hs-identifier hs-var hs-var">prependGroupResets</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679113262"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113262"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113262"><span class="hs-identifier hs-var">qt</span></a></span><span>
</span><span id="line-294"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#prependGroupResets"><span class="hs-identifier hs-var">prependGroupResets</span></a></span><span> </span><span id="local-6989586621679113263"><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113263"><span class="hs-identifier hs-var">tags</span></a></span></span><span> </span><span id="local-6989586621679113264"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113264"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WinTags -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var">prependTags'</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113265"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagTask -&gt; TagUpdate
</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#ResetGroupStopTask"><span class="hs-identifier hs-var">ResetGroupStopTask</span></a></span><span class="hs-special">)</span><span class="hs-glyph">|</span><span id="local-6989586621679113265"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113265"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-glyph">&lt;-</span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113263"><span class="hs-identifier hs-var">tags</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113264"><span class="hs-identifier hs-var">qt</span></a></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-type">prependTags'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagList"><span class="hs-identifier hs-type">TagList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span>
</span><span id="line-297"></span><span id="prependTags%27"><span class="annot"><span class="annottext">prependTags' :: WinTags -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var hs-var">prependTags'</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span id="local-6989586621679113267"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113267"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113267"><span class="hs-identifier hs-var">qt</span></a></span><span>
</span><span id="line-298"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var">prependTags'</span></a></span><span> </span><span id="local-6989586621679113268"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113268"><span class="hs-identifier hs-var">tcs'</span></a></span></span><span> </span><span id="local-6989586621679113269"><span class="annot"><span class="annottext">qt :: QT
</span><a href="#local-6989586621679113269"><span class="hs-identifier hs-var">qt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-type">Testing</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113269"><span class="hs-identifier hs-var">qt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#qt_a"><span class="hs-identifier hs-var">qt_a</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-type">prependTags'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113268"><span class="hs-identifier hs-type">tcs'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#qt_a"><span class="hs-identifier hs-var">qt_a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113269"><span class="hs-identifier hs-type">qt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#qt_b"><span class="hs-identifier hs-var">qt_b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-type">prependTags'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113268"><span class="hs-identifier hs-type">tcs'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#qt_b"><span class="hs-identifier hs-var">qt_b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679113269"><span class="hs-identifier hs-type">qt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-300"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var">prependTags'</span></a></span><span> </span><span id="local-6989586621679113270"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113270"><span class="hs-identifier hs-var">tcs'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-type">Simple</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">qt_win :: QT -&gt; WinTags
</span><a href="Text.Regex.TDFA.Common.html#qt_win"><span class="hs-identifier hs-var">qt_win</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113271"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113271"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_trans :: QT -&gt; CharMap QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_trans"><span class="hs-identifier hs-var">qt_trans</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113272"><span class="annot"><span class="annottext">CharMap QTrans
</span><a href="#local-6989586621679113272"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">qt_other :: QT -&gt; QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_other"><span class="hs-identifier hs-var">qt_other</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113273"><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113273"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-301"></span><span>  </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-type">Simple</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">qt_win :: WinTags
</span><a href="Text.Regex.TDFA.Common.html#qt_win"><span class="hs-identifier hs-var">qt_win</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">WinTags -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#noWin"><span class="hs-identifier hs-var">noWin</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113271"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113271"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113270"><span class="hs-identifier hs-var">tcs'</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags -&gt; WinTags -&gt; WinTags
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113271"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-302"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qt_trans :: CharMap QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_trans"><span class="hs-identifier hs-var">qt_trans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(QTrans -&gt; QTrans) -&gt; CharMap QTrans -&gt; CharMap QTrans
forall a b. (a -&gt; b) -&gt; CharMap a -&gt; CharMap b
</span><a href="Data.IntMap.CharMap2.html#map"><span class="hs-identifier hs-var">Map.map</span></a></span><span> </span><span class="annot"><span class="annottext">QTrans -&gt; QTrans
forall {a}. IntMap [(a, WinTags)] -&gt; IntMap [(a, WinTags)]
</span><a href="#local-6989586621679113274"><span class="hs-identifier hs-var">prependQTrans</span></a></span><span> </span><span class="annot"><span class="annottext">CharMap QTrans
</span><a href="#local-6989586621679113272"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-303"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qt_other :: QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_other"><span class="hs-identifier hs-var">qt_other</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTrans -&gt; QTrans
forall {a}. IntMap [(a, WinTags)] -&gt; IntMap [(a, WinTags)]
</span><a href="#local-6989586621679113274"><span class="hs-identifier hs-var">prependQTrans</span></a></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113273"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-304"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679113274"><span class="annot"><span class="annottext">prependQTrans :: IntMap [(a, WinTags)] -&gt; IntMap [(a, WinTags)]
</span><a href="#local-6989586621679113274"><span class="hs-identifier hs-var hs-var">prependQTrans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(a, WinTags)] -&gt; [(a, WinTags)])
-&gt; IntMap [(a, WinTags)] -&gt; IntMap [(a, WinTags)]
forall a b. (a -&gt; b) -&gt; IntMap a -&gt; IntMap b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((a, WinTags) -&gt; (a, WinTags)) -&gt; [(a, WinTags)] -&gt; [(a, WinTags)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679113278"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113278"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113279"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113279"><span class="hs-identifier hs-var">tcs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113278"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113270"><span class="hs-identifier hs-var">tcs'</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags -&gt; WinTags -&gt; WinTags
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113279"><span class="hs-identifier hs-var">tcs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="hs-comment">-- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- ==</span><span>
</span><span id="line-307"></span><span class="hs-comment">-- define type S which is a State monad, this allows the creation of the uniq QNFA ids and storing the QNFA</span><span>
</span><span id="line-308"></span><span class="hs-comment">-- in an ascending order difference list for later placement in an array.</span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span class="hs-comment">-- Type of State monad used inside qToNFA</span><span>
</span><span id="line-311"></span><span class="hs-keyword">type</span><span> </span><span id="S"><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#S"><span class="hs-identifier hs-var">S</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span>                             </span><span class="hs-comment">-- Next available QNFA index</span><span>
</span><span id="line-312"></span><span>               </span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- DList of previous QNFAs</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="hs-comment">-- Type of continuation of the NFA, not much more complicated</span><span>
</span><span id="line-315"></span><span class="hs-keyword">type</span><span> </span><span id="E"><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-var">E</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a></span><span>            </span><span class="hs-comment">-- Things to do before the Either QNFA QT</span><span>
</span><span id="line-316"></span><span>                              </span><span class="hs-comment">-- with OneChar these become PostUpdate otherwise they become PreUpdate</span><span>
</span><span id="line-317"></span><span>         </span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- The future, packaged in the best way</span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span class="hs-comment">-- See documentation below before the 'act' function.  This is for use inside a Star pattern.</span><span>
</span><span id="line-320"></span><span class="hs-keyword">type</span><span> </span><span id="ActCont"><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-var">ActCont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span>                      </span><span class="hs-comment">-- The eLoop is the dangerous recursive reference to continuation</span><span>
</span><span id="line-321"></span><span>                                        </span><span class="hs-comment">-- future that loops while accepting zero more characters</span><span>
</span><span id="line-322"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span>                </span><span class="hs-comment">-- This holds the safe non-zero-character accepting continuation</span><span>
</span><span id="line-323"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- optimized merger of the above, used only inside act, to avoid orphan QNFA id values</span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span class="hs-comment">-- newQNFA is the only operation that actually uses the monad get and put operations</span><span>
</span><span id="line-326"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#newQNFA"><span class="hs-identifier hs-type">newQNFA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a></span><span>
</span><span id="line-327"></span><span id="newQNFA"><span class="annot"><span class="annottext">newQNFA :: [Char] -&gt; QT -&gt; S QNFA
</span><a href="Text.Regex.TDFA.TNFA.html#newQNFA"><span class="hs-identifier hs-var hs-var">newQNFA</span></a></span></span><span> </span><span id="local-6989586621679113281"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679113281"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679113282"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113282"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-328"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679113283"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113283"><span class="hs-identifier hs-var">thisI</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113284"><span class="annot"><span class="annottext">[(Key, QNFA)] -&gt; [(Key, QNFA)]
</span><a href="#local-6989586621679113284"><span class="hs-identifier hs-var">oldQs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)])
  Identity
  (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)])
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-329"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113286"><span class="annot"><span class="annottext">futureI :: Key
</span><a href="#local-6989586621679113286"><span class="hs-identifier hs-var hs-var">futureI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Key -&gt; Key
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113283"><span class="hs-identifier hs-var">thisI</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Key -&gt; S QNFA -&gt; S QNFA
forall a b. a -&gt; b -&gt; b
</span><span class="hs-identifier hs-var">seq</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113286"><span class="hs-identifier hs-var">futureI</span></a></span><span> </span><span class="annot"><span class="annottext">(S QNFA -&gt; S QNFA) -&gt; S QNFA -&gt; S QNFA
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; S QNFA -&gt; S QNFA
forall a s. Show a =&gt; a -&gt; s -&gt; s
</span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&gt;newQNFA&lt; &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679113281"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; : &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Key -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113283"><span class="hs-identifier hs-var">thisI</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(S QNFA -&gt; S QNFA) -&gt; S QNFA -&gt; S QNFA
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-330"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113288"><span class="annot"><span class="annottext">qnfa :: QNFA
</span><a href="#local-6989586621679113288"><span class="hs-identifier hs-var hs-var">qnfa</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Key -&gt; QT -&gt; QNFA
</span><a href="Text.Regex.TDFA.TNFA.html#mkQNFA"><span class="hs-identifier hs-var">mkQNFA</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113283"><span class="hs-identifier hs-var">thisI</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113282"><span class="hs-identifier hs-var">qt</span></a></span><span> </span><span class="hs-comment">-- (strictQT qt) -- making strictQNFA kills test (1,11) ZZZ</span><span>
</span><span id="line-331"></span><span>  </span><span class="annot"><span class="annottext">(Key, [(Key, QNFA)] -&gt; [(Key, QNFA)])
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">((Key, [(Key, QNFA)] -&gt; [(Key, QNFA)])
 -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ())
-&gt; (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)])
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113286"><span class="hs-identifier hs-var">futureI</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Key, QNFA)] -&gt; [(Key, QNFA)]
</span><a href="#local-6989586621679113284"><span class="hs-identifier hs-var">oldQs</span></a></span><span> </span><span class="annot"><span class="annottext">([(Key, QNFA)] -&gt; [(Key, QNFA)])
-&gt; ([(Key, QNFA)] -&gt; [(Key, QNFA)])
-&gt; [(Key, QNFA)]
-&gt; [(Key, QNFA)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113283"><span class="hs-identifier hs-var">thisI</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113288"><span class="hs-identifier hs-var">qnfa</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Key, QNFA) -&gt; [(Key, QNFA)] -&gt; [(Key, QNFA)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>  </span><span class="annot"><span class="annottext">QNFA -&gt; S QNFA
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113288"><span class="hs-identifier hs-var">qnfa</span></a></span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span class="hs-comment">-- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- ==</span><span>
</span><span id="line-335"></span><span class="hs-comment">-- E related functions</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#fromQNFA"><span class="hs-identifier hs-type">fromQNFA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span>
</span><span id="line-338"></span><span id="fromQNFA"><span class="annot"><span class="annottext">fromQNFA :: QNFA -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQNFA"><span class="hs-identifier hs-var hs-var">fromQNFA</span></a></span></span><span> </span><span id="local-6989586621679113291"><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113291"><span class="hs-identifier hs-var">qnfa</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagTasks
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">QNFA -&gt; Either QNFA QT
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113291"><span class="hs-identifier hs-var">qnfa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-type">fromQT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span>
</span><span id="line-341"></span><span id="fromQT"><span class="annot"><span class="annottext">fromQT :: QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var hs-var">fromQT</span></a></span></span><span> </span><span id="local-6989586621679113293"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113293"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagTasks
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">QT -&gt; Either QNFA QT
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113293"><span class="hs-identifier hs-var">qt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span class="hs-comment">-- Promises the output will match (_,Left _), used by Or cases when any branch wants a QNFA continuation</span><span>
</span><span id="line-344"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#asQNFA"><span class="hs-identifier hs-type">asQNFA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span>
</span><span id="line-345"></span><span id="asQNFA"><span class="annot"><span class="annottext">asQNFA :: [Char] -&gt; E -&gt; S E
</span><a href="Text.Regex.TDFA.TNFA.html#asQNFA"><span class="hs-identifier hs-var hs-var">asQNFA</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679113295"><span class="annot"><span class="annottext">x :: E
</span><a href="#local-6989586621679113295"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagTasks
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">QNFA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">E -&gt; S E
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113295"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-346"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#asQNFA"><span class="hs-identifier hs-var">asQNFA</span></a></span><span> </span><span id="local-6989586621679113296"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679113296"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113297"><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113297"><span class="hs-identifier hs-var">tags</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679113298"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113298"><span class="hs-identifier hs-var">qt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679113299"><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113299"><span class="hs-identifier hs-var">qnfa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; QT -&gt; S QNFA
</span><a href="Text.Regex.TDFA.TNFA.html#newQNFA"><span class="hs-identifier hs-var">newQNFA</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679113296"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113298"><span class="hs-identifier hs-var">qt</span></a></span><span>      </span><span class="hs-comment">-- YYY Policy choice: leave the tags</span><span>
</span><span id="line-347"></span><span>                              </span><span class="annot"><span class="annottext">E -&gt; S E
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113297"><span class="hs-identifier hs-var">tags</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QNFA -&gt; Either QNFA QT
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113299"><span class="hs-identifier hs-var">qnfa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span class="hs-comment">-- Convert continuation E into a QNFA, only done at &quot;top level&quot; by qToNFA to get unique start state</span><span>
</span><span id="line-350"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#getQNFA"><span class="hs-identifier hs-type">getQNFA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a></span><span>
</span><span id="line-351"></span><span id="getQNFA"><span class="annot"><span class="annottext">getQNFA :: [Char] -&gt; E -&gt; S QNFA
</span><a href="Text.Regex.TDFA.TNFA.html#getQNFA"><span class="hs-identifier hs-var hs-var">getQNFA</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679113301"><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113301"><span class="hs-identifier hs-var">qnfa</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QNFA -&gt; S QNFA
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113301"><span class="hs-identifier hs-var">qnfa</span></a></span><span>
</span><span id="line-352"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#getQNFA"><span class="hs-identifier hs-var">getQNFA</span></a></span><span> </span><span id="local-6989586621679113302"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679113302"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113303"><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113303"><span class="hs-identifier hs-var">tags</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679113304"><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113304"><span class="hs-identifier hs-var">qnfa</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; QT -&gt; S QNFA
</span><a href="Text.Regex.TDFA.TNFA.html#newQNFA"><span class="hs-identifier hs-var">newQNFA</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679113302"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WinTags -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var">prependTags'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TagTask -&gt; TagUpdate) -&gt; TagTasks -&gt; WinTags
</span><a href="Text.Regex.TDFA.TNFA.html#promoteTasks"><span class="hs-identifier hs-var">promoteTasks</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask -&gt; TagUpdate
</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113303"><span class="hs-identifier hs-var">tags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QNFA -&gt; QT
</span><a href="Text.Regex.TDFA.Common.html#q_qt"><span class="hs-identifier hs-var">q_qt</span></a></span><span> </span><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113304"><span class="hs-identifier hs-var">qnfa</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#getQNFA"><span class="hs-identifier hs-var">getQNFA</span></a></span><span> </span><span id="local-6989586621679113307"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679113307"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113308"><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113308"><span class="hs-identifier hs-var">tags</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679113309"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113309"><span class="hs-identifier hs-var">qt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; QT -&gt; S QNFA
</span><a href="Text.Regex.TDFA.TNFA.html#newQNFA"><span class="hs-identifier hs-var">newQNFA</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679113307"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WinTags -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var">prependTags'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TagTask -&gt; TagUpdate) -&gt; TagTasks -&gt; WinTags
</span><a href="Text.Regex.TDFA.TNFA.html#promoteTasks"><span class="hs-identifier hs-var">promoteTasks</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask -&gt; TagUpdate
</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113308"><span class="hs-identifier hs-var">tags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113309"><span class="hs-identifier hs-var">qt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span class="hs-comment">-- Extract the QT from the E</span><span>
</span><span id="line-356"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-type">getQT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span>
</span><span id="line-357"></span><span id="getQT"><span class="annot"><span class="annottext">getQT :: E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var hs-var">getQT</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113311"><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113311"><span class="hs-identifier hs-var">tags</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113312"><span class="annot"><span class="annottext">Either QNFA QT
</span><a href="#local-6989586621679113312"><span class="hs-identifier hs-var">cont</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WinTags -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var">prependTags'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TagTask -&gt; TagUpdate) -&gt; TagTasks -&gt; WinTags
</span><a href="Text.Regex.TDFA.TNFA.html#promoteTasks"><span class="hs-identifier hs-var">promoteTasks</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask -&gt; TagUpdate
</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113311"><span class="hs-identifier hs-var">tags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(QNFA -&gt; QT) -&gt; (QT -&gt; QT) -&gt; Either QNFA QT -&gt; QT
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">QNFA -&gt; QT
</span><a href="Text.Regex.TDFA.Common.html#q_qt"><span class="hs-identifier hs-var">q_qt</span></a></span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Either QNFA QT
</span><a href="#local-6989586621679113312"><span class="hs-identifier hs-var">cont</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span class="hs-comment">-- 2009: This looks realllly dodgy, since it can convert a QNFA/Testing to a QT/Testing</span><span>
</span><span id="line-360"></span><span class="hs-comment">-- without actually achieving anything except adding a DoPa to the Testing.  A diagnostic</span><span>
</span><span id="line-361"></span><span class="hs-comment">-- series of runs might be needed to decide if this ever creates orphan id numbers.</span><span>
</span><span id="line-362"></span><span class="hs-comment">-- Then applyTest might need to keep track of whether it actually changes anything.</span><span>
</span><span id="line-363"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#addTest"><span class="hs-identifier hs-type">addTest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#TestInfo"><span class="hs-identifier hs-type">TestInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span>
</span><span id="line-364"></span><span id="addTest"><span class="annot"><span class="annottext">addTest :: TestInfo -&gt; E -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#addTest"><span class="hs-identifier hs-var hs-var">addTest</span></a></span></span><span> </span><span id="local-6989586621679113315"><span class="annot"><span class="annottext">TestInfo
</span><a href="#local-6989586621679113315"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113316"><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113316"><span class="hs-identifier hs-var">tags</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113317"><span class="annot"><span class="annottext">Either QNFA QT
</span><a href="#local-6989586621679113317"><span class="hs-identifier hs-var">cont</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113316"><span class="hs-identifier hs-var">tags</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QT -&gt; Either QNFA QT
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; Either QNFA QT)
-&gt; (Either QNFA QT -&gt; QT) -&gt; Either QNFA QT -&gt; Either QNFA QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TestInfo -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#applyTest"><span class="hs-identifier hs-var">applyTest</span></a></span><span> </span><span class="annot"><span class="annottext">TestInfo
</span><a href="#local-6989586621679113315"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (Either QNFA QT -&gt; QT) -&gt; Either QNFA QT -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(QNFA -&gt; QT) -&gt; (QT -&gt; QT) -&gt; Either QNFA QT -&gt; QT
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">QNFA -&gt; QT
</span><a href="Text.Regex.TDFA.Common.html#q_qt"><span class="hs-identifier hs-var">q_qt</span></a></span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(Either QNFA QT -&gt; Either QNFA QT)
-&gt; Either QNFA QT -&gt; Either QNFA QT
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Either QNFA QT
</span><a href="#local-6989586621679113317"><span class="hs-identifier hs-var">cont</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span class="hs-comment">-- This is used only with PreUpdate and PostUpdate as the first argument.</span><span>
</span><span id="line-367"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#promoteTasks"><span class="hs-identifier hs-type">promoteTasks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagTask"><span class="hs-identifier hs-type">TagTask</span></a></span><span class="hs-glyph">-&gt;</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagUpdate"><span class="hs-identifier hs-type">TagUpdate</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagList"><span class="hs-identifier hs-type">TagList</span></a></span><span>
</span><span id="line-368"></span><span id="promoteTasks"><span class="annot"><span class="annottext">promoteTasks :: (TagTask -&gt; TagUpdate) -&gt; TagTasks -&gt; WinTags
</span><a href="Text.Regex.TDFA.TNFA.html#promoteTasks"><span class="hs-identifier hs-var hs-var">promoteTasks</span></a></span></span><span> </span><span id="local-6989586621679113318"><span class="annot"><span class="annottext">TagTask -&gt; TagUpdate
</span><a href="#local-6989586621679113318"><span class="hs-identifier hs-var">promote</span></a></span></span><span> </span><span id="local-6989586621679113319"><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113319"><span class="hs-identifier hs-var">tags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Key, TagTask) -&gt; (Key, TagUpdate)) -&gt; TagTasks -&gt; WinTags
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679113320"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113320"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113321"><span class="annot"><span class="annottext">TagTask
</span><a href="#local-6989586621679113321"><span class="hs-identifier hs-var">task</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113320"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagTask -&gt; TagUpdate
</span><a href="#local-6989586621679113318"><span class="hs-identifier hs-var">promote</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="#local-6989586621679113321"><span class="hs-identifier hs-var">task</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113319"><span class="hs-identifier hs-var">tags</span></a></span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span class="hs-comment">-- only used in addWinTags</span><span>
</span><span id="line-371"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#demoteTags"><span class="hs-identifier hs-type">demoteTags</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagList"><span class="hs-identifier hs-type">TagList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a></span><span>
</span><span id="line-372"></span><span id="demoteTags"><span class="annot"><span class="annottext">demoteTags :: WinTags -&gt; TagTasks
</span><a href="Text.Regex.TDFA.TNFA.html#demoteTags"><span class="hs-identifier hs-var hs-var">demoteTags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Key, TagUpdate) -&gt; (Key, TagTask)) -&gt; WinTags -&gt; TagTasks
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Key, TagUpdate) -&gt; (Key, TagTask)
forall {a}. (a, TagUpdate) -&gt; (a, TagTask)
</span><a href="#local-6989586621679113323"><span class="hs-identifier hs-var">helper</span></a></span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679113323"><span class="annot"><span class="annottext">helper :: (a, TagUpdate) -&gt; (a, TagTask)
</span><a href="#local-6989586621679113323"><span class="hs-identifier hs-var hs-var">helper</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113324"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113324"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-type">PreUpdate</span></a></span><span> </span><span id="local-6989586621679113325"><span class="annot"><span class="annottext">TagTask
</span><a href="#local-6989586621679113325"><span class="hs-identifier hs-var">tt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113324"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagTask
</span><a href="#local-6989586621679113325"><span class="hs-identifier hs-var">tt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>        </span><span class="annot"><a href="#local-6989586621679113323"><span class="hs-identifier hs-var">helper</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113326"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113326"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#PostUpdate"><span class="hs-identifier hs-type">PostUpdate</span></a></span><span> </span><span id="local-6989586621679113328"><span class="annot"><span class="annottext">TagTask
</span><a href="#local-6989586621679113328"><span class="hs-identifier hs-var">tt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113326"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagTask
</span><a href="#local-6989586621679113328"><span class="hs-identifier hs-var">tt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span class="hs-comment">-- This is polymorphic so addWinTags can be cute below</span><span>
</span><span id="line-377"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#addWinTags"><span class="hs-pragma hs-type">addWinTags</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-378"></span><span id="local-6989586621679112694"><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#addWinTags"><span class="hs-identifier hs-type">addWinTags</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#WinTags"><span class="hs-identifier hs-type">WinTags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679112694"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679112694"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-379"></span><span id="addWinTags"><span class="annot"><span class="annottext">addWinTags :: forall a. WinTags -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addWinTags"><span class="hs-identifier hs-var hs-var">addWinTags</span></a></span></span><span> </span><span id="local-6989586621679113331"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113331"><span class="hs-identifier hs-var">wtags</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113332"><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113332"><span class="hs-identifier hs-var">tags</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113333"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113333"><span class="hs-identifier hs-var">cont</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WinTags -&gt; TagTasks
</span><a href="Text.Regex.TDFA.TNFA.html#demoteTags"><span class="hs-identifier hs-var">demoteTags</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113331"><span class="hs-identifier hs-var">wtags</span></a></span><span> </span><span class="annot"><span class="annottext">TagTasks -&gt; TagTasks -&gt; TagTasks
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113332"><span class="hs-identifier hs-var">tags</span></a></span><span>
</span><span id="line-380"></span><span>                               </span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113333"><span class="hs-identifier hs-var">cont</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#addTag%27"><span class="hs-pragma hs-type">addTag'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-383"></span><span class="hs-comment">-- This is polymorphic so addTagAC can be cute below</span><span>
</span><span id="line-384"></span><span id="local-6989586621679112696"><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#addTag%27"><span class="hs-identifier hs-type">addTag'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679112696"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679112696"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-385"></span><span id="addTag%27"><span class="annot"><span class="annottext">addTag' :: forall a. Key -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addTag%27"><span class="hs-identifier hs-var hs-var">addTag'</span></a></span></span><span> </span><span id="local-6989586621679113335"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113335"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113336"><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113336"><span class="hs-identifier hs-var">tags</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113337"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113337"><span class="hs-identifier hs-var">cont</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113335"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#TagTask"><span class="hs-identifier hs-var">TagTask</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Key, TagTask) -&gt; TagTasks -&gt; TagTasks
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113336"><span class="hs-identifier hs-var">tags</span></a></span><span>
</span><span id="line-386"></span><span>                          </span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113337"><span class="hs-identifier hs-var">cont</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span class="hs-comment">-- a Maybe version of addTag' above, specializing 'a' to Either QNFA QT</span><span>
</span><span id="line-389"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#addTag"><span class="hs-identifier hs-type">addTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span>
</span><span id="line-390"></span><span id="addTag"><span class="annot"><span class="annottext">addTag :: Maybe Key -&gt; E -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#addTag"><span class="hs-identifier hs-var hs-var">addTag</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span id="local-6989586621679113339"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113339"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113339"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-391"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#addTag"><span class="hs-identifier hs-var">addTag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679113340"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113340"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679113341"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113341"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Key -&gt; E -&gt; E
forall a. Key -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addTag%27"><span class="hs-identifier hs-var">addTag'</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113340"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113341"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#addGroupResets"><span class="hs-pragma hs-type">addGroupResets</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-394"></span><span class="hs-comment">-- This is polymorphic so addGroupResetsAC can be cute below</span><span>
</span><span id="line-395"></span><span id="local-6989586621679112698"><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#addGroupResets"><span class="hs-identifier hs-type">addGroupResets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679112698"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679112698"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679112698"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-396"></span><span id="addGroupResets"><span class="annot"><span class="annottext">addGroupResets :: forall a. Show a =&gt; [Key] -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupResets"><span class="hs-identifier hs-var hs-var">addGroupResets</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679113345"><span class="annot"><span class="annottext">(TagTasks, a)
</span><a href="#local-6989586621679113345"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TagTasks, a)
</span><a href="#local-6989586621679113345"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-397"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#addGroupResets"><span class="hs-identifier hs-var">addGroupResets</span></a></span><span> </span><span id="local-6989586621679113346"><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113346"><span class="hs-identifier hs-var">tags</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113347"><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113347"><span class="hs-identifier hs-var">tags'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113348"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113348"><span class="hs-identifier hs-var">cont</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Key, TagTask) -&gt; TagTasks -&gt; TagTasks)
-&gt; TagTasks -&gt; TagTasks -&gt; TagTasks
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113347"><span class="hs-identifier hs-var">tags'</span></a></span><span> </span><span class="annot"><span class="annottext">(TagTasks -&gt; TagTasks) -&gt; ([Key] -&gt; TagTasks) -&gt; [Key] -&gt; TagTasks
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Key -&gt; (Key, TagTask)) -&gt; [Key] -&gt; TagTasks
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679113350"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113350"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113350"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#ResetGroupStopTask"><span class="hs-identifier hs-var">ResetGroupStopTask</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Key] -&gt; TagTasks) -&gt; [Key] -&gt; TagTasks
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113346"><span class="hs-identifier hs-var">tags</span></a></span><span>
</span><span id="line-398"></span><span>                                   </span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113348"><span class="hs-identifier hs-var">cont</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span id="local-6989586621679113351"><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#addGroupSets"><span class="hs-identifier hs-type">addGroupSets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679113351"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679113351"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679113351"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-401"></span><span id="addGroupSets"><span class="annot"><span class="annottext">addGroupSets :: forall a. Show a =&gt; [Key] -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupSets"><span class="hs-identifier hs-var hs-var">addGroupSets</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679113355"><span class="annot"><span class="annottext">(TagTasks, a)
</span><a href="#local-6989586621679113355"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TagTasks, a)
</span><a href="#local-6989586621679113355"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-402"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#addGroupSets"><span class="hs-identifier hs-var">addGroupSets</span></a></span><span> </span><span id="local-6989586621679113356"><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113356"><span class="hs-identifier hs-var">tags</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113357"><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113357"><span class="hs-identifier hs-var">tags'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113358"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113358"><span class="hs-identifier hs-var">cont</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Key, TagTask) -&gt; TagTasks -&gt; TagTasks)
-&gt; TagTasks -&gt; TagTasks -&gt; TagTasks
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113357"><span class="hs-identifier hs-var">tags'</span></a></span><span> </span><span class="annot"><span class="annottext">(TagTasks -&gt; TagTasks) -&gt; ([Key] -&gt; TagTasks) -&gt; [Key] -&gt; TagTasks
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Key -&gt; (Key, TagTask)) -&gt; [Key] -&gt; TagTasks
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679113359"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113359"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113359"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#SetGroupStopTask"><span class="hs-identifier hs-var">SetGroupStopTask</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Key] -&gt; TagTasks) -&gt; [Key] -&gt; TagTasks
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113356"><span class="hs-identifier hs-var">tags</span></a></span><span>
</span><span id="line-403"></span><span>                                 </span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679113358"><span class="hs-identifier hs-var">cont</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span class="hs-comment">-- Consume an ActCont.  Uses the mergeQT form to combine non-accepting</span><span>
</span><span id="line-406"></span><span class="hs-comment">-- and accepting view of the continuation.</span><span>
</span><span id="line-407"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#getE"><span class="hs-identifier hs-type">getE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span>
</span><span id="line-408"></span><span id="getE"><span class="annot"><span class="annottext">getE :: ActCont -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#getE"><span class="hs-identifier hs-var hs-var">getE</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe E
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113362"><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113362"><span class="hs-identifier hs-var">tags</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113363"><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113363"><span class="hs-identifier hs-var">qnfa</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113362"><span class="hs-identifier hs-var">tags</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QNFA -&gt; Either QNFA QT
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113363"><span class="hs-identifier hs-var">qnfa</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- consume optimized mQNFA value returned by Star</span><span>
</span><span id="line-409"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#getE"><span class="hs-identifier hs-var">getE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113364"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113364"><span class="hs-identifier hs-var">eLoop</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679113365"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113365"><span class="hs-identifier hs-var">accepting</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QT -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mergeQT"><span class="hs-identifier hs-var">mergeQT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113364"><span class="hs-identifier hs-var">eLoop</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113365"><span class="hs-identifier hs-var">accepting</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#getE"><span class="hs-identifier hs-var">getE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113366"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113366"><span class="hs-identifier hs-var">eLoop</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe E
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113366"><span class="hs-identifier hs-var">eLoop</span></a></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span class="hs-comment">-- 2009: See comment for addTest.  Here is a case where the third component might be a (Just qnfa) and it</span><span>
</span><span id="line-413"></span><span class="hs-comment">-- is being lost even though the added test might be redundant.</span><span>
</span><span id="line-414"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#addTestAC"><span class="hs-identifier hs-type">addTestAC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#TestInfo"><span class="hs-identifier hs-type">TestInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a></span><span>
</span><span id="line-415"></span><span id="addTestAC"><span class="annot"><span class="annottext">addTestAC :: TestInfo -&gt; ActCont -&gt; ActCont
</span><a href="Text.Regex.TDFA.TNFA.html#addTestAC"><span class="hs-identifier hs-var hs-var">addTestAC</span></a></span></span><span> </span><span id="local-6989586621679113368"><span class="annot"><span class="annottext">TestInfo
</span><a href="#local-6989586621679113368"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113369"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113369"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113370"><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113370"><span class="hs-identifier hs-var">mE</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TestInfo -&gt; E -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#addTest"><span class="hs-identifier hs-var">addTest</span></a></span><span> </span><span class="annot"><span class="annottext">TestInfo
</span><a href="#local-6989586621679113368"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113369"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-416"></span><span>                        </span><span class="hs-special">,</span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; Maybe E -&gt; Maybe E
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TestInfo -&gt; E -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#addTest"><span class="hs-identifier hs-var">addTest</span></a></span><span> </span><span class="annot"><span class="annottext">TestInfo
</span><a href="#local-6989586621679113368"><span class="hs-identifier hs-var">ti</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113370"><span class="hs-identifier hs-var">mE</span></a></span><span>
</span><span id="line-417"></span><span>                        </span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span>
</span><span id="line-419"></span><span class="hs-comment">-- These are AC versions of the add functions on E</span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#addTagAC"><span class="hs-identifier hs-type">addTagAC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a></span><span>
</span><span id="line-422"></span><span id="addTagAC"><span class="annot"><span class="annottext">addTagAC :: Maybe Key -&gt; ActCont -&gt; ActCont
</span><a href="Text.Regex.TDFA.TNFA.html#addTagAC"><span class="hs-identifier hs-var hs-var">addTagAC</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span id="local-6989586621679113372"><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113372"><span class="hs-identifier hs-var">ac</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113372"><span class="hs-identifier hs-var">ac</span></a></span><span>
</span><span id="line-423"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#addTagAC"><span class="hs-identifier hs-var">addTagAC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679113373"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113373"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113374"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113374"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113375"><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113375"><span class="hs-identifier hs-var">mE</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113376"><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><a href="#local-6989586621679113376"><span class="hs-identifier hs-var">mQNFA</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key -&gt; E -&gt; E
forall a. Key -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addTag%27"><span class="hs-identifier hs-var">addTag'</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113373"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113374"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-424"></span><span>                                   </span><span class="hs-special">,</span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; Maybe E -&gt; Maybe E
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key -&gt; E -&gt; E
forall a. Key -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addTag%27"><span class="hs-identifier hs-var">addTag'</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113373"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113375"><span class="hs-identifier hs-var">mE</span></a></span><span>
</span><span id="line-425"></span><span>                                   </span><span class="hs-special">,</span><span class="annot"><span class="annottext">((TagTasks, QNFA) -&gt; (TagTasks, QNFA))
-&gt; Maybe (TagTasks, QNFA) -&gt; Maybe (TagTasks, QNFA)
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key -&gt; (TagTasks, QNFA) -&gt; (TagTasks, QNFA)
forall a. Key -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addTag%27"><span class="hs-identifier hs-var">addTag'</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113373"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><a href="#local-6989586621679113376"><span class="hs-identifier hs-var">mQNFA</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#addGroupResetsAC"><span class="hs-identifier hs-type">addGroupResetsAC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a></span><span>
</span><span id="line-428"></span><span id="addGroupResetsAC"><span class="annot"><span class="annottext">addGroupResetsAC :: [Key] -&gt; ActCont -&gt; ActCont
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupResetsAC"><span class="hs-identifier hs-var hs-var">addGroupResetsAC</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679113378"><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113378"><span class="hs-identifier hs-var">ac</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113378"><span class="hs-identifier hs-var">ac</span></a></span><span>
</span><span id="line-429"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#addGroupResetsAC"><span class="hs-identifier hs-var">addGroupResetsAC</span></a></span><span> </span><span id="local-6989586621679113379"><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113379"><span class="hs-identifier hs-var">tags</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113380"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113380"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113381"><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113381"><span class="hs-identifier hs-var">mE</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113382"><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><a href="#local-6989586621679113382"><span class="hs-identifier hs-var">mQNFA</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Key] -&gt; E -&gt; E
forall a. Show a =&gt; [Key] -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupResets"><span class="hs-identifier hs-var">addGroupResets</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113379"><span class="hs-identifier hs-var">tags</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113380"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-430"></span><span>                                     </span><span class="hs-special">,</span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; Maybe E -&gt; Maybe E
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Key] -&gt; E -&gt; E
forall a. Show a =&gt; [Key] -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupResets"><span class="hs-identifier hs-var">addGroupResets</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113379"><span class="hs-identifier hs-var">tags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113381"><span class="hs-identifier hs-var">mE</span></a></span><span>
</span><span id="line-431"></span><span>                                     </span><span class="hs-special">,</span><span class="annot"><span class="annottext">((TagTasks, QNFA) -&gt; (TagTasks, QNFA))
-&gt; Maybe (TagTasks, QNFA) -&gt; Maybe (TagTasks, QNFA)
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Key] -&gt; (TagTasks, QNFA) -&gt; (TagTasks, QNFA)
forall a. Show a =&gt; [Key] -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupResets"><span class="hs-identifier hs-var">addGroupResets</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113379"><span class="hs-identifier hs-var">tags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><a href="#local-6989586621679113382"><span class="hs-identifier hs-var">mQNFA</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#addGroupSetsAC"><span class="hs-identifier hs-type">addGroupSetsAC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a></span><span>
</span><span id="line-434"></span><span id="addGroupSetsAC"><span class="annot"><span class="annottext">addGroupSetsAC :: [Key] -&gt; ActCont -&gt; ActCont
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupSetsAC"><span class="hs-identifier hs-var hs-var">addGroupSetsAC</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679113384"><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113384"><span class="hs-identifier hs-var">ac</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113384"><span class="hs-identifier hs-var">ac</span></a></span><span>
</span><span id="line-435"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#addGroupSetsAC"><span class="hs-identifier hs-var">addGroupSetsAC</span></a></span><span> </span><span id="local-6989586621679113385"><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113385"><span class="hs-identifier hs-var">tags</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113386"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113386"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113387"><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113387"><span class="hs-identifier hs-var">mE</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113388"><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><a href="#local-6989586621679113388"><span class="hs-identifier hs-var">mQNFA</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Key] -&gt; E -&gt; E
forall a. Show a =&gt; [Key] -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupSets"><span class="hs-identifier hs-var">addGroupSets</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113385"><span class="hs-identifier hs-var">tags</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113386"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-436"></span><span>                                   </span><span class="hs-special">,</span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; Maybe E -&gt; Maybe E
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Key] -&gt; E -&gt; E
forall a. Show a =&gt; [Key] -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupSets"><span class="hs-identifier hs-var">addGroupSets</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113385"><span class="hs-identifier hs-var">tags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113387"><span class="hs-identifier hs-var">mE</span></a></span><span>
</span><span id="line-437"></span><span>                                   </span><span class="hs-special">,</span><span class="annot"><span class="annottext">((TagTasks, QNFA) -&gt; (TagTasks, QNFA))
-&gt; Maybe (TagTasks, QNFA) -&gt; Maybe (TagTasks, QNFA)
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Key] -&gt; (TagTasks, QNFA) -&gt; (TagTasks, QNFA)
forall a. Show a =&gt; [Key] -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupSets"><span class="hs-identifier hs-var">addGroupSets</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113385"><span class="hs-identifier hs-var">tags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><a href="#local-6989586621679113388"><span class="hs-identifier hs-var">mQNFA</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#addWinTagsAC"><span class="hs-identifier hs-type">addWinTagsAC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#WinTags"><span class="hs-identifier hs-type">WinTags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a></span><span>
</span><span id="line-440"></span><span id="addWinTagsAC"><span class="annot"><span class="annottext">addWinTagsAC :: WinTags -&gt; ActCont -&gt; ActCont
</span><a href="Text.Regex.TDFA.TNFA.html#addWinTagsAC"><span class="hs-identifier hs-var hs-var">addWinTagsAC</span></a></span></span><span> </span><span id="local-6989586621679113390"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113390"><span class="hs-identifier hs-var">wtags</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113391"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113391"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113392"><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113392"><span class="hs-identifier hs-var">mE</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113393"><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><a href="#local-6989586621679113393"><span class="hs-identifier hs-var">mQNFA</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WinTags -&gt; E -&gt; E
forall a. WinTags -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addWinTags"><span class="hs-identifier hs-var">addWinTags</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113390"><span class="hs-identifier hs-var">wtags</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113391"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-441"></span><span>                                  </span><span class="hs-special">,</span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; Maybe E -&gt; Maybe E
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WinTags -&gt; E -&gt; E
forall a. WinTags -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addWinTags"><span class="hs-identifier hs-var">addWinTags</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113390"><span class="hs-identifier hs-var">wtags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113392"><span class="hs-identifier hs-var">mE</span></a></span><span>
</span><span id="line-442"></span><span>                                  </span><span class="hs-special">,</span><span class="annot"><span class="annottext">((TagTasks, QNFA) -&gt; (TagTasks, QNFA))
-&gt; Maybe (TagTasks, QNFA) -&gt; Maybe (TagTasks, QNFA)
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WinTags -&gt; (TagTasks, QNFA) -&gt; (TagTasks, QNFA)
forall a. WinTags -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addWinTags"><span class="hs-identifier hs-var">addWinTags</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113390"><span class="hs-identifier hs-var">wtags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><a href="#local-6989586621679113393"><span class="hs-identifier hs-var">mQNFA</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span class="hs-comment">-- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- ==</span><span>
</span><span id="line-444"></span><span>
</span><span id="line-445"></span><span class="hs-comment">-- Initial preTag of 0th tag is implied. No other general pre-tags would be expected.</span><span>
</span><span id="line-446"></span><span class="hs-comment">-- The qtwin contains the preTag of the 1st tag and is only set when a match is completed.</span><span>
</span><span id="line-447"></span><span class="hs-comment">-- The fst Index is the index of the unique starting QNFA state.</span><span>
</span><span id="line-448"></span><span class="hs-comment">-- The snd (Array Index QNFA) is all the QNFA states.</span><span>
</span><span id="line-449"></span><span class="hs-comment">--</span><span>
</span><span id="line-450"></span><span class="hs-comment">-- In the cases below, Empty is handled much like a Test with no TestInfo.</span><span>
</span><span id="line-451"></span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#qToNFA"><span class="hs-identifier hs-type">qToNFA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#CompOption"><span class="hs-identifier hs-type">CompOption</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span id="qToNFA"><span class="annot"><span class="annottext">qToNFA :: CompOption -&gt; Q -&gt; (Key, Array Key QNFA)
</span><a href="Text.Regex.TDFA.TNFA.html#qToNFA"><span class="hs-identifier hs-var hs-var">qToNFA</span></a></span></span><span> </span><span id="local-6989586621679113394"><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621679113394"><span class="hs-identifier hs-var">compOpt</span></a></span></span><span> </span><span id="local-6989586621679113395"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113395"><span class="hs-identifier hs-var">qTop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QNFA -&gt; Key
</span><a href="Text.Regex.TDFA.Common.html#q_id"><span class="hs-identifier hs-var">q_id</span></a></span><span> </span><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113397"><span class="hs-identifier hs-var">startingQNFA</span></a></span><span>
</span><span id="line-453"></span><span>                      </span><span class="hs-special">,</span><span class="annot"><span class="annottext">(Key, Key) -&gt; [(Key, QNFA)] -&gt; Array Key QNFA
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
(i, i) -&gt; [(i, e)] -&gt; a i e
</span><span class="hs-identifier hs-var">array</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Key -&gt; Key
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">pred</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113399"><span class="hs-identifier hs-var">lastIndex</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Key, QNFA)] -&gt; [(Key, QNFA)]
</span><a href="#local-6989586621679113400"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-454"></span><span>  </span><span class="hs-comment">-- Result startingQNFA is the top level's index</span><span>
</span><span id="line-455"></span><span>  </span><span class="hs-comment">-- State pair: fst 0 is the next state number (not yet used) going in, and lastIndex coming out (succ of last used)</span><span>
</span><span id="line-456"></span><span>  </span><span class="hs-comment">--             snd id is the difference list of states going in, and the finished list coming out</span><span>
</span><span id="line-457"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679113397"><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113397"><span class="hs-identifier hs-var">startingQNFA</span></a></span></span><span class="hs-special">,</span><span class="hs-special">(</span><span id="local-6989586621679113399"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113399"><span class="hs-identifier hs-var">lastIndex</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113400"><span class="annot"><span class="annottext">[(Key, QNFA)] -&gt; [(Key, QNFA)]
</span><a href="#local-6989586621679113400"><span class="hs-identifier hs-var">table</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-458"></span><span>    </span><span class="annot"><span class="annottext">S QNFA
-&gt; (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)])
-&gt; (QNFA, (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]))
forall s a. State s a -&gt; s -&gt; (a, s)
</span><span class="hs-identifier hs-var">runState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; E -&gt; S E
</span><a href="#local-6989586621679113403"><span class="hs-identifier hs-var">getTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113395"><span class="hs-identifier hs-var">qTop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; E) -&gt; QT -&gt; E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="Text.Regex.TDFA.TNFA.html#qtwin"><span class="hs-identifier hs-var">qtwin</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">S E -&gt; (E -&gt; S QNFA) -&gt; S QNFA
forall a b.
StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
-&gt; (a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity b)
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; E -&gt; S QNFA
</span><a href="Text.Regex.TDFA.TNFA.html#getQNFA"><span class="hs-identifier hs-var">getQNFA</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;top level&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Key, [(Key, QNFA)] -&gt; [(Key, QNFA)])
forall {a}. (Key, a -&gt; a)
</span><a href="#local-6989586621679113404"><span class="hs-identifier hs-var">startState</span></a></span><span>
</span><span id="line-459"></span><span>  </span><span id="local-6989586621679113404"><span class="annot"><span class="annottext">startState :: (Key, a -&gt; a)
</span><a href="#local-6989586621679113404"><span class="hs-identifier hs-var hs-var">startState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a -&gt; a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span>  </span><span class="annot"><a href="#local-6989586621679113403"><span class="hs-identifier hs-type">getTrans</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679113406"><span class="hs-identifier hs-type">getTransTagless</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span>
</span><span id="line-462"></span><span>  </span><span id="local-6989586621679113403"><span class="annot"><span class="annottext">getTrans :: Q -&gt; E -&gt; S E
</span><a href="#local-6989586621679113403"><span class="hs-identifier hs-var hs-var">getTrans</span></a></span></span><span> </span><span id="local-6989586621679113407"><span class="annot"><span class="annottext">qIn :: Q
</span><a href="#local-6989586621679113407"><span class="hs-identifier hs-var">qIn</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">preReset :: Q -&gt; [Key]
</span><a href="Text.Regex.TDFA.CorePattern.html#preReset"><span class="hs-identifier hs-var">preReset</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113409"><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113409"><span class="hs-identifier hs-var">resets</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">postSet :: Q -&gt; [Key]
</span><a href="Text.Regex.TDFA.CorePattern.html#postSet"><span class="hs-identifier hs-var">postSet</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113411"><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113411"><span class="hs-identifier hs-var">sets</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">preTag :: Q -&gt; Maybe Key
</span><a href="Text.Regex.TDFA.CorePattern.html#preTag"><span class="hs-identifier hs-var">preTag</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113413"><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113413"><span class="hs-identifier hs-var">pre</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">postTag :: Q -&gt; Maybe Key
</span><a href="Text.Regex.TDFA.CorePattern.html#postTag"><span class="hs-identifier hs-var">postTag</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113415"><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113415"><span class="hs-identifier hs-var">post</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">unQ :: Q -&gt; P
</span><a href="Text.Regex.TDFA.CorePattern.html#unQ"><span class="hs-identifier hs-var">unQ</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113417"><span class="annot"><span class="annottext">P
</span><a href="#local-6989586621679113417"><span class="hs-identifier hs-var">pIn</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679113418"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113418"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; S E -&gt; S E
forall a s. Show a =&gt; a -&gt; s -&gt; s
</span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&gt;&lt; getTrans &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Q -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113407"><span class="hs-identifier hs-var">qIn</span></a></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; &lt;&gt;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(S E -&gt; S E) -&gt; S E -&gt; S E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-463"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">P
</span><a href="#local-6989586621679113417"><span class="hs-identifier hs-var">pIn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-464"></span><span>      </span><span class="hs-comment">-- The case below is the ultimate consumer of every single OneChar in the input and the only caller of</span><span>
</span><span id="line-465"></span><span>      </span><span class="hs-comment">-- newTrans/acceptTrans which is the sole source of QT/Simple nodes.</span><span>
</span><span id="line-466"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#OneChar"><span class="hs-identifier hs-type">OneChar</span></a></span><span> </span><span id="local-6989586621679113420"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679113420"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Key] -&gt; Maybe Key -&gt; Pattern -&gt; E -&gt; S E
</span><a href="#local-6989586621679113421"><span class="hs-identifier hs-var">newTrans</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;getTrans/OneChar&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113409"><span class="hs-identifier hs-var">resets</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113413"><span class="hs-identifier hs-var">pre</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679113420"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; S E) -&gt; (E -&gt; E) -&gt; E -&gt; S E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; E -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#addTag"><span class="hs-identifier hs-var">addTag</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113415"><span class="hs-identifier hs-var">post</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; (E -&gt; E) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Key] -&gt; E -&gt; E
forall a. Show a =&gt; [Key] -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupSets"><span class="hs-identifier hs-var">addGroupSets</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113411"><span class="hs-identifier hs-var">sets</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; S E) -&gt; E -&gt; S E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113418"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-467"></span><span>      </span><span class="annot"><span class="annottext">P
</span><a href="Text.Regex.TDFA.CorePattern.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E -&gt; S E
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(E -&gt; S E) -&gt; (E -&gt; E) -&gt; E -&gt; S E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Key] -&gt; E -&gt; E
forall a. Show a =&gt; [Key] -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupResets"><span class="hs-identifier hs-var">addGroupResets</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113409"><span class="hs-identifier hs-var">resets</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; (E -&gt; E) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; E -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#addTag"><span class="hs-identifier hs-var">addTag</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113413"><span class="hs-identifier hs-var">pre</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; (E -&gt; E) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; E -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#addTag"><span class="hs-identifier hs-var">addTag</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113415"><span class="hs-identifier hs-var">post</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; (E -&gt; E) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Key] -&gt; E -&gt; E
forall a. Show a =&gt; [Key] -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupSets"><span class="hs-identifier hs-var">addGroupSets</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113411"><span class="hs-identifier hs-var">sets</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; S E) -&gt; E -&gt; S E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113418"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-468"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Test"><span class="hs-identifier hs-type">Test</span></a></span><span> </span><span id="local-6989586621679113424"><span class="annot"><span class="annottext">TestInfo
</span><a href="#local-6989586621679113424"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E -&gt; S E
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(E -&gt; S E) -&gt; (E -&gt; E) -&gt; E -&gt; S E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Key] -&gt; E -&gt; E
forall a. Show a =&gt; [Key] -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupResets"><span class="hs-identifier hs-var">addGroupResets</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113409"><span class="hs-identifier hs-var">resets</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; (E -&gt; E) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; E -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#addTag"><span class="hs-identifier hs-var">addTag</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113413"><span class="hs-identifier hs-var">pre</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; (E -&gt; E) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TestInfo -&gt; E -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#addTest"><span class="hs-identifier hs-var">addTest</span></a></span><span> </span><span class="annot"><span class="annottext">TestInfo
</span><a href="#local-6989586621679113424"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; (E -&gt; E) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; E -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#addTag"><span class="hs-identifier hs-var">addTag</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113415"><span class="hs-identifier hs-var">post</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; (E -&gt; E) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Key] -&gt; E -&gt; E
forall a. Show a =&gt; [Key] -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupSets"><span class="hs-identifier hs-var">addGroupSets</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113411"><span class="hs-identifier hs-var">sets</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; S E) -&gt; E -&gt; S E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113418"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-469"></span><span>      </span><span class="annot"><span class="annottext">P
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E -&gt; S E
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(E -&gt; S E) -&gt; (E -&gt; E) -&gt; E -&gt; S E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Key] -&gt; E -&gt; E
forall a. Show a =&gt; [Key] -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupResets"><span class="hs-identifier hs-var">addGroupResets</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113409"><span class="hs-identifier hs-var">resets</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; (E -&gt; E) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; E -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#addTag"><span class="hs-identifier hs-var">addTag</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113413"><span class="hs-identifier hs-var">pre</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; S E) -&gt; S E -&gt; S E
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; E -&gt; S E
</span><a href="#local-6989586621679113406"><span class="hs-identifier hs-var">getTransTagless</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113407"><span class="hs-identifier hs-var">qIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Key -&gt; E -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#addTag"><span class="hs-identifier hs-var">addTag</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113415"><span class="hs-identifier hs-var">post</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; (E -&gt; E) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Key] -&gt; E -&gt; E
forall a. Show a =&gt; [Key] -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupSets"><span class="hs-identifier hs-var">addGroupSets</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113411"><span class="hs-identifier hs-var">sets</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; E -&gt; E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113418"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-470"></span><span>
</span><span id="line-471"></span><span>  </span><span id="local-6989586621679113406"><span class="annot"><span class="annottext">getTransTagless :: Q -&gt; E -&gt; S E
</span><a href="#local-6989586621679113406"><span class="hs-identifier hs-var hs-var">getTransTagless</span></a></span></span><span> </span><span id="local-6989586621679113426"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113426"><span class="hs-identifier hs-var">qIn</span></a></span></span><span> </span><span id="local-6989586621679113427"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113427"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; S E -&gt; S E
forall a s. Show a =&gt; a -&gt; s -&gt; s
</span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&gt;&lt; getTransTagless &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Q -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113426"><span class="hs-identifier hs-var">qIn</span></a></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; &lt;&gt;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(S E -&gt; S E) -&gt; S E -&gt; S E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-472"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Q -&gt; P
</span><a href="Text.Regex.TDFA.CorePattern.html#unQ"><span class="hs-identifier hs-var">unQ</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113426"><span class="hs-identifier hs-var">qIn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-473"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Seq"><span class="hs-identifier hs-type">Seq</span></a></span><span> </span><span id="local-6989586621679113429"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113429"><span class="hs-identifier hs-var">q1</span></a></span></span><span> </span><span id="local-6989586621679113430"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113430"><span class="hs-identifier hs-var">q2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Q -&gt; E -&gt; S E
</span><a href="#local-6989586621679113403"><span class="hs-identifier hs-var">getTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113429"><span class="hs-identifier hs-var">q1</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; S E) -&gt; S E -&gt; S E
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; E -&gt; S E
</span><a href="#local-6989586621679113403"><span class="hs-identifier hs-var">getTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113430"><span class="hs-identifier hs-var">q2</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113427"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-474"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Or"><span class="hs-identifier hs-type">Or</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E -&gt; S E
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113427"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-475"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Or"><span class="hs-identifier hs-type">Or</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679113432"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113432"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Q -&gt; E -&gt; S E
</span><a href="#local-6989586621679113403"><span class="hs-identifier hs-var">getTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113432"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113427"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-476"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Or"><span class="hs-identifier hs-type">Or</span></a></span><span> </span><span id="local-6989586621679113433"><span class="annot"><span class="annottext">[Q]
</span><a href="#local-6989586621679113433"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-477"></span><span>        </span><span id="local-6989586621679113434"><span class="annot"><span class="annottext">[E]
</span><a href="#local-6989586621679113434"><span class="hs-identifier hs-var">eqts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.TNFA.html#usesQNFA"><span class="hs-identifier hs-var">usesQNFA</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113426"><span class="hs-identifier hs-var">qIn</span></a></span><span>
</span><span id="line-478"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-479"></span><span>                    </span><span id="local-6989586621679113435"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113435"><span class="hs-identifier hs-var">eQNFA</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; E -&gt; S E
</span><a href="Text.Regex.TDFA.TNFA.html#asQNFA"><span class="hs-identifier hs-var">asQNFA</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;getTransTagless/Or/usesQNFA&quot;</span></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113427"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-480"></span><span>                    </span><span class="annot"><span class="annottext">[S E] -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity [E]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
forall (m :: * -&gt; *) a. Monad m =&gt; [m a] -&gt; m [a]
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Q -&gt; E -&gt; S E
</span><a href="#local-6989586621679113403"><span class="hs-identifier hs-var">getTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113437"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113435"><span class="hs-identifier hs-var">eQNFA</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679113437"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113437"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Q]
</span><a href="#local-6989586621679113433"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-481"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[S E] -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity [E]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
forall (m :: * -&gt; *) a. Monad m =&gt; [m a] -&gt; m [a]
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Q -&gt; E -&gt; S E
</span><a href="#local-6989586621679113403"><span class="hs-identifier hs-var">getTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113438"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113427"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679113438"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113438"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Q]
</span><a href="#local-6989586621679113433"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-482"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113439"><span class="annot"><span class="annottext">qts :: [QT]
</span><a href="#local-6989586621679113439"><span class="hs-identifier hs-var hs-var">qts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(E -&gt; QT) -&gt; [E] -&gt; [QT]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">[E]
</span><a href="#local-6989586621679113434"><span class="hs-identifier hs-var">eqts</span></a></span><span>
</span><span id="line-483"></span><span>        </span><span class="annot"><span class="annottext">E -&gt; S E
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(QT -&gt; QT -&gt; QT) -&gt; [QT] -&gt; QT
forall a. (a -&gt; a -&gt; a) -&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">foldr1</span></span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mergeAltQT"><span class="hs-identifier hs-var">mergeAltQT</span></a></span><span> </span><span class="annot"><span class="annottext">[QT]
</span><a href="#local-6989586621679113439"><span class="hs-identifier hs-var">qts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Star"><span class="hs-identifier hs-type">Star</span></a></span><span> </span><span id="local-6989586621679113442"><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113442"><span class="hs-identifier hs-var">mOrbit</span></a></span></span><span> </span><span id="local-6989586621679113443"><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113443"><span class="hs-identifier hs-var">resetTheseOrbits</span></a></span></span><span> </span><span id="local-6989586621679113444"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679113444"><span class="hs-identifier hs-var">mayFirstBeNull</span></a></span></span><span> </span><span id="local-6989586621679113445"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113445"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-486"></span><span>        </span><span class="hs-comment">-- mOrbit of Just implies varies q and childGroups q</span><span>
</span><span id="line-487"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113447"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113447"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113448"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679113448"><span class="hs-identifier hs-var">clear</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- debug (&quot;\n&gt;&quot;++show e++&quot;\n&quot;++show q++&quot;\n&lt;&quot;) $</span><span>
</span><span id="line-488"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.TNFA.html#notNullable"><span class="hs-identifier hs-var">notNullable</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113445"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113427"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- subpattern cannot be null</span><span>
</span><span id="line-489"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Key] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113443"><span class="hs-identifier hs-var">resetTheseOrbits</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113442"><span class="hs-identifier hs-var">mOrbit</span></a></span><span>
</span><span id="line-490"></span><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Maybe WinTags
</span><a href="Text.Regex.TDFA.TNFA.html#maybeOnlyEmpty"><span class="hs-identifier hs-var">maybeOnlyEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113445"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-491"></span><span>                              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113427"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- True because null of subpattern is same as skipping subpattern</span><span>
</span><span id="line-492"></span><span>                              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679113449"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113449"><span class="hs-identifier hs-var">tagList</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WinTags -&gt; E -&gt; E
forall a. WinTags -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addWinTags"><span class="hs-identifier hs-var">addWinTags</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113449"><span class="hs-identifier hs-var">tagList</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113427"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- null of subpattern NOT same as skipping</span><span>
</span><span id="line-493"></span><span>                              </span><span class="annot"><span class="annottext">Maybe WinTags
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; E) -&gt; (E -&gt; QT) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(SetTestInfo, WinTags)] -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#preferNullViews"><span class="hs-identifier hs-var">preferNullViews</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; [(SetTestInfo, WinTags)]
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113445"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (E -&gt; QT) -&gt; E -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; E -&gt; E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113427"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- is NOT same as skipping</span><span>
</span><span id="line-494"></span><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; E) -&gt; (E -&gt; QT) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Key] -&gt; QT -&gt; QT
</span><a href="#local-6989586621679113450"><span class="hs-identifier hs-var">resetOrbitsQT</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113443"><span class="hs-identifier hs-var">resetTheseOrbits</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (E -&gt; QT) -&gt; E -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; QT -&gt; QT
</span><a href="#local-6989586621679113451"><span class="hs-identifier hs-var">enterOrbitQT</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113442"><span class="hs-identifier hs-var">mOrbit</span></a></span><span> </span><span class="hs-comment">-- resetOrbitsQT and enterOrbitQT commute</span><span>
</span><span id="line-495"></span><span>                             </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (E -&gt; QT) -&gt; E -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(SetTestInfo, WinTags)] -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#preferNullViews"><span class="hs-identifier hs-var">preferNullViews</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; [(SetTestInfo, WinTags)]
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113445"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (E -&gt; QT) -&gt; E -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; QT) -&gt; (E -&gt; E) -&gt; E -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; E -&gt; E
</span><a href="#local-6989586621679113452"><span class="hs-identifier hs-var">leaveOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113442"><span class="hs-identifier hs-var">mOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; E -&gt; E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113427"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- perform resets when accepting 0 characters</span><span>
</span><span id="line-496"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#cannotAccept"><span class="hs-identifier hs-var">cannotAccept</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113445"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">E -&gt; S E
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113447"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">mdo</span><span>
</span><span id="line-497"></span><span>        </span><span id="local-6989586621679113453"><span class="annot"><span class="annottext">Maybe QT
</span><a href="#local-6989586621679113453"><span class="hs-identifier hs-var">mqt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q -&gt; E -&gt; S (Maybe QT)
</span><a href="#local-6989586621679113454"><span class="hs-identifier hs-var">inStar</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113445"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113455"><span class="hs-identifier hs-var">this</span></a></span><span>
</span><span id="line-498"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679113455"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113455"><span class="hs-identifier hs-var">this</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113456"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113456"><span class="hs-identifier hs-var">ans</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe QT
</span><a href="#local-6989586621679113453"><span class="hs-identifier hs-var">mqt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-499"></span><span>                        </span><span class="annot"><span class="annottext">Maybe QT
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity (E, E)
forall a. [Char] -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Weird pattern in getTransTagless/Star: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Q, Q) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113395"><span class="hs-identifier hs-var">qTop</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113426"><span class="hs-identifier hs-var">qIn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-500"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679113457"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113457"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-501"></span><span>                          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113458"><span class="annot"><span class="annottext">qt' :: QT
</span><a href="#local-6989586621679113458"><span class="hs-identifier hs-var hs-var">qt'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Key] -&gt; QT -&gt; QT
</span><a href="#local-6989586621679113450"><span class="hs-identifier hs-var">resetOrbitsQT</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113443"><span class="hs-identifier hs-var">resetTheseOrbits</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (QT -&gt; QT) -&gt; QT -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; QT -&gt; QT
</span><a href="#local-6989586621679113451"><span class="hs-identifier hs-var">enterOrbitQT</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113442"><span class="hs-identifier hs-var">mOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; QT -&gt; QT
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113457"><span class="hs-identifier hs-var">qt</span></a></span><span> </span><span class="hs-comment">-- resetOrbitsQT and enterOrbitQT commute</span><span>
</span><span id="line-502"></span><span>                              </span><span id="local-6989586621679113459"><span class="annot"><span class="annottext">thisQT :: QT
</span><a href="#local-6989586621679113459"><span class="hs-identifier hs-var hs-var">thisQT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mergeQT"><span class="hs-identifier hs-var">mergeQT</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113458"><span class="hs-identifier hs-var">qt'</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (E -&gt; QT) -&gt; E -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; QT) -&gt; (E -&gt; E) -&gt; E -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; E -&gt; E
</span><a href="#local-6989586621679113452"><span class="hs-identifier hs-var">leaveOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113442"><span class="hs-identifier hs-var">mOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; QT) -&gt; E -&gt; QT
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113427"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-comment">-- capture of subpattern or leave via next pattern (avoid null of subpattern on way out)</span><span>
</span><span id="line-503"></span><span>                              </span><span id="local-6989586621679113460"><span class="annot"><span class="annottext">ansE :: E
</span><a href="#local-6989586621679113460"><span class="hs-identifier hs-var hs-var">ansE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; E) -&gt; (E -&gt; QT) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mergeQT"><span class="hs-identifier hs-var">mergeQT</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113458"><span class="hs-identifier hs-var">qt'</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (E -&gt; QT) -&gt; E -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; E -&gt; E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113447"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="hs-comment">-- capture of subpattern or leave via null of subpattern</span><span>
</span><span id="line-504"></span><span>                          </span><span id="local-6989586621679113461"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113461"><span class="hs-identifier hs-var">thisE</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.TNFA.html#usesQNFA"><span class="hs-identifier hs-var">usesQNFA</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113445"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-505"></span><span>                                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">E -&gt; S E
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(E -&gt; S E) -&gt; (QNFA -&gt; E) -&gt; QNFA -&gt; S E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QNFA -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQNFA"><span class="hs-identifier hs-var">fromQNFA</span></a></span><span> </span><span class="annot"><span class="annottext">(QNFA -&gt; S E) -&gt; S QNFA -&gt; S E
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; QT -&gt; S QNFA
</span><a href="Text.Regex.TDFA.TNFA.html#newQNFA"><span class="hs-identifier hs-var">newQNFA</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;getTransTagless/Star&quot;</span></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113459"><span class="hs-identifier hs-var">thisQT</span></a></span><span>
</span><span id="line-506"></span><span>                                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">E -&gt; S E
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(E -&gt; S E) -&gt; (QT -&gt; E) -&gt; QT -&gt; S E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; S E) -&gt; QT -&gt; S E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113459"><span class="hs-identifier hs-var">thisQT</span></a></span><span>
</span><span id="line-507"></span><span>                          </span><span class="annot"><span class="annottext">(E, E)
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity (E, E)
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113461"><span class="hs-identifier hs-var">thisE</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113460"><span class="hs-identifier hs-var">ansE</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span>        </span><span class="annot"><span class="annottext">E -&gt; S E
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679113444"><span class="hs-identifier hs-var">mayFirstBeNull</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679113448"><span class="hs-identifier hs-var">clear</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113455"><span class="hs-identifier hs-var">this</span></a></span><span>  </span><span class="hs-comment">-- optimization to possibly preserve QNFA</span><span>
</span><span id="line-509"></span><span>                                                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113456"><span class="hs-identifier hs-var">ans</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113455"><span class="hs-identifier hs-var">this</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span>      </span><span class="hs-comment">{- NonEmpty is like actNullable (Or [Empty,q]) without the extra tag to prefer the first Empty branch -}</span><span>
</span><span id="line-513"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NonEmpty"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span id="local-6989586621679113463"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113463"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; S E -&gt; S E
forall a. [Char] -&gt; a -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#ecart"><span class="hs-identifier hs-var">ecart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\n&gt; getTransTagless/NonEmpty&quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Q -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113426"><span class="hs-identifier hs-var">qIn</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">(S E -&gt; S E) -&gt; S E -&gt; S E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-514"></span><span>        </span><span class="hs-comment">-- Assertion to check than Pattern.starTrans did its job right:</span><span>
</span><span id="line-515"></span><span>        </span><span class="annot"><span class="annottext">Bool
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ()
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#cannotAccept"><span class="hs-identifier hs-var">cannotAccept</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113463"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ()
forall a. [Char] -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">([Char]
 -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ())
-&gt; [Char]
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;getTransTagless/NonEmpty : provided with a *cannotAccept* pattern: &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">(Q, Q) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113395"><span class="hs-identifier hs-var">qTop</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113426"><span class="hs-identifier hs-var">qIn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span>        </span><span class="annot"><span class="annottext">Bool
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ()
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#mustAccept"><span class="hs-identifier hs-var">mustAccept</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113463"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ()
forall a. [Char] -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">([Char]
 -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ())
-&gt; [Char]
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;getTransTagless/NonEmpty : provided with a *mustAccept* pattern: &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">(Q, Q) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113395"><span class="hs-identifier hs-var">qTop</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113426"><span class="hs-identifier hs-var">qIn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113465"><span class="annot"><span class="annottext">e' :: E
</span><a href="#local-6989586621679113465"><span class="hs-identifier hs-var hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Maybe WinTags
</span><a href="Text.Regex.TDFA.TNFA.html#maybeOnlyEmpty"><span class="hs-identifier hs-var">maybeOnlyEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113426"><span class="hs-identifier hs-var">qIn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-518"></span><span>                   </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113427"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-519"></span><span>                   </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679113466"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113466"><span class="hs-identifier hs-var">_wtags</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113427"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-comment">-- addWinTags wtags e  XXX was duplicating tags</span><span>
</span><span id="line-520"></span><span>                   </span><span class="annot"><span class="annottext">Maybe WinTags
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; E
forall a. [Char] -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; E) -&gt; [Char] -&gt; E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;getTransTagless/NonEmpty is supposed to have an emptyNull nullView : &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Q -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113426"><span class="hs-identifier hs-var">qIn</span></a></span><span>
</span><span id="line-521"></span><span>        </span><span id="local-6989586621679113467"><span class="annot"><span class="annottext">Maybe QT
</span><a href="#local-6989586621679113467"><span class="hs-identifier hs-var">mqt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q -&gt; E -&gt; S (Maybe QT)
</span><a href="#local-6989586621679113454"><span class="hs-identifier hs-var">inStar</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113463"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113427"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-522"></span><span>        </span><span class="annot"><span class="annottext">E -&gt; S E
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(E -&gt; S E) -&gt; E -&gt; S E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe QT
</span><a href="#local-6989586621679113467"><span class="hs-identifier hs-var">mqt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-523"></span><span>                   </span><span class="annot"><span class="annottext">Maybe QT
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; E
forall a. [Char] -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Weird pattern in getTransTagless/NonEmpty: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Q, Q) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113395"><span class="hs-identifier hs-var">qTop</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113426"><span class="hs-identifier hs-var">qIn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>                   </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679113468"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113468"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; E) -&gt; (E -&gt; QT) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mergeQT_2nd"><span class="hs-identifier hs-var">mergeQT_2nd</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113468"><span class="hs-identifier hs-var">qt</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (E -&gt; QT) -&gt; E -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; E -&gt; E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113465"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="hs-comment">-- ...and then this sets qt_win to exactly that of e'</span><span>
</span><span id="line-525"></span><span>      </span><span class="annot"><span class="annottext">P
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; S E
forall a. [Char] -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;This case in Text.Regex.TNFA.TNFA.getTransTagless cannot happen&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Q, Q) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113395"><span class="hs-identifier hs-var">qTop</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113426"><span class="hs-identifier hs-var">qIn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span>  </span><span class="annot"><a href="#local-6989586621679113454"><span class="hs-identifier hs-type">inStar</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679113469"><span class="hs-identifier hs-type">inStarNullableTagless</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-528"></span><span>  </span><span id="local-6989586621679113454"><span class="annot"><span class="annottext">inStar :: Q -&gt; E -&gt; S (Maybe QT)
</span><a href="#local-6989586621679113454"><span class="hs-identifier hs-var hs-var">inStar</span></a></span></span><span> </span><span id="local-6989586621679113470"><span class="annot"><span class="annottext">qIn :: Q
</span><a href="#local-6989586621679113470"><span class="hs-identifier hs-var">qIn</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">preReset :: Q -&gt; [Key]
</span><a href="Text.Regex.TDFA.CorePattern.html#preReset"><span class="hs-identifier hs-var">preReset</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113471"><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113471"><span class="hs-identifier hs-var">resets</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">postSet :: Q -&gt; [Key]
</span><a href="Text.Regex.TDFA.CorePattern.html#postSet"><span class="hs-identifier hs-var">postSet</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113472"><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113472"><span class="hs-identifier hs-var">sets</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">preTag :: Q -&gt; Maybe Key
</span><a href="Text.Regex.TDFA.CorePattern.html#preTag"><span class="hs-identifier hs-var">preTag</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113473"><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113473"><span class="hs-identifier hs-var">pre</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">postTag :: Q -&gt; Maybe Key
</span><a href="Text.Regex.TDFA.CorePattern.html#postTag"><span class="hs-identifier hs-var">postTag</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113474"><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113474"><span class="hs-identifier hs-var">post</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679113475"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113475"><span class="hs-identifier hs-var">eLoop</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.TNFA.html#notNullable"><span class="hs-identifier hs-var">notNullable</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113470"><span class="hs-identifier hs-var">qIn</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-529"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; S (Maybe QT) -&gt; S (Maybe QT)
forall a s. Show a =&gt; a -&gt; s -&gt; s
</span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&gt;&lt; inStar/1 &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Q -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113470"><span class="hs-identifier hs-var">qIn</span></a></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; &lt;&gt;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(S (Maybe QT) -&gt; S (Maybe QT)) -&gt; S (Maybe QT) -&gt; S (Maybe QT)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-530"></span><span>    </span><span class="annot"><span class="annottext">Maybe QT -&gt; S (Maybe QT)
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe QT -&gt; S (Maybe QT)) -&gt; (E -&gt; Maybe QT) -&gt; E -&gt; S (Maybe QT)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QT -&gt; Maybe QT
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; Maybe QT) -&gt; (E -&gt; QT) -&gt; E -&gt; Maybe QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; S (Maybe QT)) -&gt; S E -&gt; S (Maybe QT)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; E -&gt; S E
</span><a href="#local-6989586621679113403"><span class="hs-identifier hs-var">getTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113470"><span class="hs-identifier hs-var">qIn</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113475"><span class="hs-identifier hs-var">eLoop</span></a></span><span>
</span><span id="line-531"></span><span>                                                                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-532"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; S (Maybe QT) -&gt; S (Maybe QT)
forall a s. Show a =&gt; a -&gt; s -&gt; s
</span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&gt;&lt; inStar/2 &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Q -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113470"><span class="hs-identifier hs-var">qIn</span></a></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; &lt;&gt;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(S (Maybe QT) -&gt; S (Maybe QT)) -&gt; S (Maybe QT) -&gt; S (Maybe QT)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-533"></span><span>    </span><span class="annot"><span class="annottext">Maybe QT -&gt; S (Maybe QT)
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe QT -&gt; S (Maybe QT))
-&gt; (Maybe QT -&gt; Maybe QT) -&gt; Maybe QT -&gt; S (Maybe QT)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; Maybe QT -&gt; Maybe QT
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Key] -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#prependGroupResets"><span class="hs-identifier hs-var">prependGroupResets</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113471"><span class="hs-identifier hs-var">resets</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (QT -&gt; QT) -&gt; QT -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#prependPreTag"><span class="hs-identifier hs-var">prependPreTag</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113473"><span class="hs-identifier hs-var">pre</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe QT -&gt; S (Maybe QT)) -&gt; S (Maybe QT) -&gt; S (Maybe QT)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; E -&gt; S (Maybe QT)
</span><a href="#local-6989586621679113469"><span class="hs-identifier hs-var">inStarNullableTagless</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113470"><span class="hs-identifier hs-var">qIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Key -&gt; E -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#addTag"><span class="hs-identifier hs-var">addTag</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113474"><span class="hs-identifier hs-var">post</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; (E -&gt; E) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Key] -&gt; E -&gt; E
forall a. Show a =&gt; [Key] -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupSets"><span class="hs-identifier hs-var">addGroupSets</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113472"><span class="hs-identifier hs-var">sets</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; E -&gt; E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113475"><span class="hs-identifier hs-var">eLoop</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span>  </span><span id="local-6989586621679113469"><span class="annot"><span class="annottext">inStarNullableTagless :: Q -&gt; E -&gt; S (Maybe QT)
</span><a href="#local-6989586621679113469"><span class="hs-identifier hs-var hs-var">inStarNullableTagless</span></a></span></span><span> </span><span id="local-6989586621679113476"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113476"><span class="hs-identifier hs-var">qIn</span></a></span></span><span> </span><span id="local-6989586621679113477"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113477"><span class="hs-identifier hs-var">eLoop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; S (Maybe QT) -&gt; S (Maybe QT)
forall a s. Show a =&gt; a -&gt; s -&gt; s
</span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&gt;&lt; inStarNullableTagless &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Q -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113476"><span class="hs-identifier hs-var">qIn</span></a></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; &lt;&gt;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(S (Maybe QT) -&gt; S (Maybe QT)) -&gt; S (Maybe QT) -&gt; S (Maybe QT)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-536"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Q -&gt; P
</span><a href="Text.Regex.TDFA.CorePattern.html#unQ"><span class="hs-identifier hs-var">unQ</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113476"><span class="hs-identifier hs-var">qIn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-537"></span><span>      </span><span class="annot"><span class="annottext">P
</span><a href="Text.Regex.TDFA.CorePattern.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe QT -&gt; S (Maybe QT)
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe QT
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-comment">-- with Or this discards () branch in &quot;(^|foo|())*&quot;</span><span>
</span><span id="line-538"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Or"><span class="hs-identifier hs-type">Or</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe QT -&gt; S (Maybe QT)
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe QT
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-539"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Or"><span class="hs-identifier hs-type">Or</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679113478"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113478"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Q -&gt; E -&gt; S (Maybe QT)
</span><a href="#local-6989586621679113454"><span class="hs-identifier hs-var">inStar</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113478"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113477"><span class="hs-identifier hs-var">eLoop</span></a></span><span>
</span><span id="line-540"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Or"><span class="hs-identifier hs-type">Or</span></a></span><span> </span><span id="local-6989586621679113479"><span class="annot"><span class="annottext">[Q]
</span><a href="#local-6989586621679113479"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-541"></span><span>        </span><span id="local-6989586621679113480"><span class="annot"><span class="annottext">[Maybe QT]
</span><a href="#local-6989586621679113480"><span class="hs-identifier hs-var">mqts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.TNFA.html#usesQNFA"><span class="hs-identifier hs-var">usesQNFA</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113476"><span class="hs-identifier hs-var">qIn</span></a></span><span>
</span><span id="line-542"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679113481"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113481"><span class="hs-identifier hs-var">eQNFA</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; E -&gt; S E
</span><a href="Text.Regex.TDFA.TNFA.html#asQNFA"><span class="hs-identifier hs-var">asQNFA</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;inStarNullableTagless/Or/usesQNFA&quot;</span></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113477"><span class="hs-identifier hs-var">eLoop</span></a></span><span>
</span><span id="line-543"></span><span>                          </span><span class="annot"><span class="annottext">[S (Maybe QT)]
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity [Maybe QT]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
forall (m :: * -&gt; *) a. Monad m =&gt; [m a] -&gt; m [a]
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Q -&gt; E -&gt; S (Maybe QT)
</span><a href="#local-6989586621679113454"><span class="hs-identifier hs-var">inStar</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113482"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113481"><span class="hs-identifier hs-var">eQNFA</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679113482"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113482"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Q]
</span><a href="#local-6989586621679113479"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-544"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[S (Maybe QT)]
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity [Maybe QT]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
forall (m :: * -&gt; *) a. Monad m =&gt; [m a] -&gt; m [a]
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Q -&gt; E -&gt; S (Maybe QT)
</span><a href="#local-6989586621679113454"><span class="hs-identifier hs-var">inStar</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113483"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113477"><span class="hs-identifier hs-var">eLoop</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679113483"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113483"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Q]
</span><a href="#local-6989586621679113479"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-545"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113484"><span class="annot"><span class="annottext">qts :: [QT]
</span><a href="#local-6989586621679113484"><span class="hs-identifier hs-var hs-var">qts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe QT] -&gt; [QT]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">[Maybe QT]
</span><a href="#local-6989586621679113480"><span class="hs-identifier hs-var">mqts</span></a></span><span>
</span><span id="line-546"></span><span>            </span><span id="local-6989586621679113487"><span class="annot"><span class="annottext">mqt :: Maybe QT
</span><a href="#local-6989586621679113487"><span class="hs-identifier hs-var hs-var">mqt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[QT] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[QT]
</span><a href="#local-6989586621679113484"><span class="hs-identifier hs-var">qts</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe QT
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">QT -&gt; Maybe QT
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(QT -&gt; QT -&gt; QT) -&gt; [QT] -&gt; QT
forall a. (a -&gt; a -&gt; a) -&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">foldr1</span></span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mergeAltQT"><span class="hs-identifier hs-var">mergeAltQT</span></a></span><span> </span><span class="annot"><span class="annottext">[QT]
</span><a href="#local-6989586621679113484"><span class="hs-identifier hs-var">qts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-547"></span><span>        </span><span class="annot"><span class="annottext">Maybe QT -&gt; S (Maybe QT)
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe QT
</span><a href="#local-6989586621679113487"><span class="hs-identifier hs-var">mqt</span></a></span><span>
</span><span id="line-548"></span><span>      </span><span class="hs-comment">-- Calls to act are inlined by hand to actNullable.  This returns only cases where q1 or q2 or both</span><span>
</span><span id="line-549"></span><span>      </span><span class="hs-comment">-- accepted characters.  The zero-character case is handled by the tag wrapping by inStar.</span><span>
</span><span id="line-550"></span><span>      </span><span class="hs-comment">-- 2009: Does this look dodgy and repetitios of tags?  Seq by policy has no preTag or postTag.</span><span>
</span><span id="line-551"></span><span>      </span><span class="hs-comment">-- though it can have prependGroupResets, but those are not repeated in children so it is okay.</span><span>
</span><span id="line-552"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Seq"><span class="hs-identifier hs-type">Seq</span></a></span><span> </span><span id="local-6989586621679113488"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113488"><span class="hs-identifier hs-var">q1</span></a></span></span><span> </span><span id="local-6989586621679113489"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113489"><span class="hs-identifier hs-var">q2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679113490"><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113490"><span class="hs-identifier hs-var">meAcceptingOut</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q -&gt; ActCont -&gt; S ActCont
</span><a href="#local-6989586621679113491"><span class="hs-identifier hs-var">actNullable</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113488"><span class="hs-identifier hs-var">q1</span></a></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; S ActCont) -&gt; S ActCont -&gt; S ActCont
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; ActCont -&gt; S ActCont
</span><a href="#local-6989586621679113491"><span class="hs-identifier hs-var">actNullable</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113489"><span class="hs-identifier hs-var">q2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113477"><span class="hs-identifier hs-var">eLoop</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe E
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>                      </span><span class="annot"><span class="annottext">Maybe QT -&gt; S (Maybe QT)
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(E -&gt; QT) -&gt; Maybe E -&gt; Maybe QT
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113490"><span class="hs-identifier hs-var">meAcceptingOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>      </span><span class="hs-comment">-- Calls to act are inlined by hand and are we losing the tags?</span><span>
</span><span id="line-555"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Star"><span class="hs-identifier hs-type">Star</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679113492"><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113492"><span class="hs-identifier hs-var">meAcceptingOut</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q -&gt; ActCont -&gt; S ActCont
</span><a href="#local-6989586621679113493"><span class="hs-identifier hs-var">actNullableTagless</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113476"><span class="hs-identifier hs-var">qIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113477"><span class="hs-identifier hs-var">eLoop</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe E
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>                    </span><span class="annot"><span class="annottext">Maybe QT -&gt; S (Maybe QT)
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(E -&gt; QT) -&gt; Maybe E -&gt; Maybe QT
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113492"><span class="hs-identifier hs-var">meAcceptingOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NonEmpty"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; S (Maybe QT) -&gt; S (Maybe QT)
forall a. [Char] -&gt; a -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#ecart"><span class="hs-identifier hs-var">ecart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\n&gt; inStarNullableTagless/NonEmpty&quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Q -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113476"><span class="hs-identifier hs-var">qIn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(S (Maybe QT) -&gt; S (Maybe QT)) -&gt; S (Maybe QT) -&gt; S (Maybe QT)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-558"></span><span>                     </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679113494"><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113494"><span class="hs-identifier hs-var">meAcceptingOut</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q -&gt; ActCont -&gt; S ActCont
</span><a href="#local-6989586621679113493"><span class="hs-identifier hs-var">actNullableTagless</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113476"><span class="hs-identifier hs-var">qIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113477"><span class="hs-identifier hs-var">eLoop</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe E
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-559"></span><span>                        </span><span class="annot"><span class="annottext">Maybe QT -&gt; S (Maybe QT)
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(E -&gt; QT) -&gt; Maybe E -&gt; Maybe QT
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113494"><span class="hs-identifier hs-var">meAcceptingOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-560"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Test"><span class="hs-identifier hs-type">Test</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe QT -&gt; S (Maybe QT)
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe QT
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-comment">-- with Or this discards ^ branch in &quot;(^|foo|())*&quot;</span><span>
</span><span id="line-561"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#OneChar"><span class="hs-identifier hs-type">OneChar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; S (Maybe QT)
forall a. [Char] -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;OneChar cannot have nullable True&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-562"></span><span>
</span><span id="line-563"></span><span>  </span><span class="hs-comment">{- act* functions

  These have a very complicated state that they receive and return as
  &quot;the continuation&quot;.

   (E, Maybe E,Maybe (SetTag,QNFA))

  The first E is the source of the danger that must be avoided.  It
  starts out a reference to the QNFA/QT state that will be created by
  the most recent parent Star node.  Thus it is a recursive reference
  from the MonadFix machinery.  In particular, this value cannot be
  returned to the parent Star to be included in itself or we get a &quot;let
  x = y; y=x&quot; style infinite loop.

  As act* progresses the first E is actually modified to be the parent
  QNFA/QT as &quot;seen&quot; when all the elements to the right have accepted 0
  characters.  Thus it acquires tags and tests+tags (the NullView data
  is used for this purpose).

  The second item in the 3-tuple is a Maybe E.  This will be used as the
  source of the QT for this contents of the Star QNFA/QT.  It will be
  merged with the Star's own continuation data.  It starts out Nothing
  and stays that way as long as there are no accepting transitions in
  the Star's pattern.  This is value (via getQT) returned by inStar.

  The third item is a special optimization I added to remove a source
  of orphaned QNFAs.  A Star within Act will often have to create a
  QNFA node.  This cannot go into the second Maybe E item as Just
  (SetTag,Left QNFA) because this QNFA can have pulled values from the
  recursive parent Star's QNFA/QT in the first E value.  Thus pulling
  with getQT from the QNFA and using that as the Maybe E would likely
  cause an infinite loop.  This extra QNFA is stored in the thd3
  location for use by getE. To improve it further it can accumulate
  Tag information after being formed.

  When a non nullable Q is handled by act it checks to see if the
  third value is there, in which case it uses that QNFA as the total
  continuation (subsumed in getE).  Otherwise it merges the first E
  with any (Just E) in the second value to form the continuation.

  -}</span><span>
</span><span id="line-604"></span><span>
</span><span id="line-605"></span><span>  </span><span class="annot"><a href="#local-6989586621679113495"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span>  </span><span id="local-6989586621679113495"><span class="annot"><span class="annottext">act :: Q -&gt; ActCont -&gt; S (Maybe E)
</span><a href="#local-6989586621679113495"><span class="hs-identifier hs-var hs-var">act</span></a></span></span><span> </span><span id="local-6989586621679113496"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113496"><span class="hs-identifier hs-var">qIn</span></a></span></span><span> </span><span id="local-6989586621679113497"><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113497"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.TNFA.html#nullable"><span class="hs-identifier hs-var">nullable</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113496"><span class="hs-identifier hs-var">qIn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; Maybe E) -&gt; S ActCont -&gt; S (Maybe E)
forall a b.
(a -&gt; b)
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ActCont -&gt; Maybe E
forall a b c. (a, b, c) -&gt; b
</span><a href="Text.Regex.TDFA.Common.html#snd3"><span class="hs-identifier hs-var">snd3</span></a></span><span> </span><span class="annot"><span class="annottext">(S ActCont -&gt; S (Maybe E)) -&gt; S ActCont -&gt; S (Maybe E)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; ActCont -&gt; S ActCont
</span><a href="#local-6989586621679113491"><span class="hs-identifier hs-var">actNullable</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113496"><span class="hs-identifier hs-var">qIn</span></a></span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113497"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-607"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; S (Maybe E) -&gt; S (Maybe E)
forall a s. Show a =&gt; a -&gt; s -&gt; s
</span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&gt;&lt; act &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Q -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113496"><span class="hs-identifier hs-var">qIn</span></a></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; &lt;&gt;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(S (Maybe E) -&gt; S (Maybe E)) -&gt; S (Maybe E) -&gt; S (Maybe E)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-608"></span><span>    </span><span id="local-6989586621679113498"><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113498"><span class="hs-identifier hs-var">mqt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe E -&gt; S (Maybe E)
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe E -&gt; S (Maybe E)) -&gt; (E -&gt; Maybe E) -&gt; E -&gt; S (Maybe E)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; Maybe E
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(E -&gt; S (Maybe E)) -&gt; S E -&gt; S (Maybe E)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; E -&gt; S E
</span><a href="#local-6989586621679113403"><span class="hs-identifier hs-var">getTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113496"><span class="hs-identifier hs-var">qIn</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ActCont -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#getE"><span class="hs-identifier hs-var">getE</span></a></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; E) -&gt; ActCont -&gt; E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113497"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-609"></span><span>    </span><span class="annot"><span class="annottext">Maybe E -&gt; S (Maybe E)
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113498"><span class="hs-identifier hs-var">mqt</span></a></span><span>  </span><span class="hs-comment">-- or &quot;return (fromQT qtlose,mqt,Nothing)&quot;</span><span>
</span><span id="line-610"></span><span>
</span><span id="line-611"></span><span>  </span><span class="annot"><a href="#local-6989586621679113491"><span class="hs-identifier hs-type">actNullable</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679113493"><span class="hs-identifier hs-type">actNullableTagless</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a></span><span>
</span><span id="line-612"></span><span>  </span><span id="local-6989586621679113491"><span class="annot"><span class="annottext">actNullable :: Q -&gt; ActCont -&gt; S ActCont
</span><a href="#local-6989586621679113491"><span class="hs-identifier hs-var hs-var">actNullable</span></a></span></span><span> </span><span id="local-6989586621679113499"><span class="annot"><span class="annottext">qIn :: Q
</span><a href="#local-6989586621679113499"><span class="hs-identifier hs-var">qIn</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">preReset :: Q -&gt; [Key]
</span><a href="Text.Regex.TDFA.CorePattern.html#preReset"><span class="hs-identifier hs-var">preReset</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113500"><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113500"><span class="hs-identifier hs-var">resets</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">postSet :: Q -&gt; [Key]
</span><a href="Text.Regex.TDFA.CorePattern.html#postSet"><span class="hs-identifier hs-var">postSet</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113501"><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113501"><span class="hs-identifier hs-var">sets</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">preTag :: Q -&gt; Maybe Key
</span><a href="Text.Regex.TDFA.CorePattern.html#preTag"><span class="hs-identifier hs-var">preTag</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113502"><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113502"><span class="hs-identifier hs-var">pre</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">postTag :: Q -&gt; Maybe Key
</span><a href="Text.Regex.TDFA.CorePattern.html#postTag"><span class="hs-identifier hs-var">postTag</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113503"><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113503"><span class="hs-identifier hs-var">post</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">unQ :: Q -&gt; P
</span><a href="Text.Regex.TDFA.CorePattern.html#unQ"><span class="hs-identifier hs-var">unQ</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113504"><span class="annot"><span class="annottext">P
</span><a href="#local-6989586621679113504"><span class="hs-identifier hs-var">pIn</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679113505"><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113505"><span class="hs-identifier hs-var">ac</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-613"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; S ActCont -&gt; S ActCont
forall a s. Show a =&gt; a -&gt; s -&gt; s
</span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&gt;&lt; actNullable &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Q -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113499"><span class="hs-identifier hs-var">qIn</span></a></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; &lt;&gt;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(S ActCont -&gt; S ActCont) -&gt; S ActCont -&gt; S ActCont
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-614"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">P
</span><a href="#local-6989586621679113504"><span class="hs-identifier hs-var">pIn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-615"></span><span>      </span><span class="annot"><span class="annottext">P
</span><a href="Text.Regex.TDFA.CorePattern.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ActCont -&gt; S ActCont
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; S ActCont)
-&gt; (ActCont -&gt; ActCont) -&gt; ActCont -&gt; S ActCont
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Key] -&gt; ActCont -&gt; ActCont
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupResetsAC"><span class="hs-identifier hs-var">addGroupResetsAC</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113500"><span class="hs-identifier hs-var">resets</span></a></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; ActCont) -&gt; (ActCont -&gt; ActCont) -&gt; ActCont -&gt; ActCont
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; ActCont -&gt; ActCont
</span><a href="Text.Regex.TDFA.TNFA.html#addTagAC"><span class="hs-identifier hs-var">addTagAC</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113502"><span class="hs-identifier hs-var">pre</span></a></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; ActCont) -&gt; (ActCont -&gt; ActCont) -&gt; ActCont -&gt; ActCont
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; ActCont -&gt; ActCont
</span><a href="Text.Regex.TDFA.TNFA.html#addTagAC"><span class="hs-identifier hs-var">addTagAC</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113503"><span class="hs-identifier hs-var">post</span></a></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; ActCont) -&gt; (ActCont -&gt; ActCont) -&gt; ActCont -&gt; ActCont
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Key] -&gt; ActCont -&gt; ActCont
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupSetsAC"><span class="hs-identifier hs-var">addGroupSetsAC</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113501"><span class="hs-identifier hs-var">sets</span></a></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; S ActCont) -&gt; ActCont -&gt; S ActCont
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113505"><span class="hs-identifier hs-var">ac</span></a></span><span>
</span><span id="line-616"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Test"><span class="hs-identifier hs-type">Test</span></a></span><span> </span><span id="local-6989586621679113506"><span class="annot"><span class="annottext">TestInfo
</span><a href="#local-6989586621679113506"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ActCont -&gt; S ActCont
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; S ActCont)
-&gt; (ActCont -&gt; ActCont) -&gt; ActCont -&gt; S ActCont
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Key] -&gt; ActCont -&gt; ActCont
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupResetsAC"><span class="hs-identifier hs-var">addGroupResetsAC</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113500"><span class="hs-identifier hs-var">resets</span></a></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; ActCont) -&gt; (ActCont -&gt; ActCont) -&gt; ActCont -&gt; ActCont
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; ActCont -&gt; ActCont
</span><a href="Text.Regex.TDFA.TNFA.html#addTagAC"><span class="hs-identifier hs-var">addTagAC</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113502"><span class="hs-identifier hs-var">pre</span></a></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; ActCont) -&gt; (ActCont -&gt; ActCont) -&gt; ActCont -&gt; ActCont
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TestInfo -&gt; ActCont -&gt; ActCont
</span><a href="Text.Regex.TDFA.TNFA.html#addTestAC"><span class="hs-identifier hs-var">addTestAC</span></a></span><span> </span><span class="annot"><span class="annottext">TestInfo
</span><a href="#local-6989586621679113506"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; ActCont) -&gt; (ActCont -&gt; ActCont) -&gt; ActCont -&gt; ActCont
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; ActCont -&gt; ActCont
</span><a href="Text.Regex.TDFA.TNFA.html#addTagAC"><span class="hs-identifier hs-var">addTagAC</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113503"><span class="hs-identifier hs-var">post</span></a></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; ActCont) -&gt; (ActCont -&gt; ActCont) -&gt; ActCont -&gt; ActCont
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Key] -&gt; ActCont -&gt; ActCont
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupSetsAC"><span class="hs-identifier hs-var">addGroupSetsAC</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113501"><span class="hs-identifier hs-var">sets</span></a></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; S ActCont) -&gt; ActCont -&gt; S ActCont
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113505"><span class="hs-identifier hs-var">ac</span></a></span><span>
</span><span id="line-617"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#OneChar"><span class="hs-identifier hs-type">OneChar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; S ActCont
forall a. [Char] -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;OneChar cannot have nullable True &quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>      </span><span class="annot"><span class="annottext">P
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ActCont -&gt; S ActCont
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; S ActCont)
-&gt; (ActCont -&gt; ActCont) -&gt; ActCont -&gt; S ActCont
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Key] -&gt; ActCont -&gt; ActCont
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupResetsAC"><span class="hs-identifier hs-var">addGroupResetsAC</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113500"><span class="hs-identifier hs-var">resets</span></a></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; ActCont) -&gt; (ActCont -&gt; ActCont) -&gt; ActCont -&gt; ActCont
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; ActCont -&gt; ActCont
</span><a href="Text.Regex.TDFA.TNFA.html#addTagAC"><span class="hs-identifier hs-var">addTagAC</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113502"><span class="hs-identifier hs-var">pre</span></a></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; S ActCont) -&gt; S ActCont -&gt; S ActCont
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; ActCont -&gt; S ActCont
</span><a href="#local-6989586621679113493"><span class="hs-identifier hs-var">actNullableTagless</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113499"><span class="hs-identifier hs-var">qIn</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; ActCont -&gt; ActCont
</span><a href="Text.Regex.TDFA.TNFA.html#addTagAC"><span class="hs-identifier hs-var">addTagAC</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113503"><span class="hs-identifier hs-var">post</span></a></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; ActCont) -&gt; (ActCont -&gt; ActCont) -&gt; ActCont -&gt; ActCont
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Key] -&gt; ActCont -&gt; ActCont
</span><a href="Text.Regex.TDFA.TNFA.html#addGroupSetsAC"><span class="hs-identifier hs-var">addGroupSetsAC</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113501"><span class="hs-identifier hs-var">sets</span></a></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; ActCont) -&gt; ActCont -&gt; ActCont
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113505"><span class="hs-identifier hs-var">ac</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span>  </span><span id="local-6989586621679113493"><span class="annot"><span class="annottext">actNullableTagless :: Q -&gt; ActCont -&gt; S ActCont
</span><a href="#local-6989586621679113493"><span class="hs-identifier hs-var hs-var">actNullableTagless</span></a></span></span><span> </span><span id="local-6989586621679113507"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113507"><span class="hs-identifier hs-var">qIn</span></a></span></span><span> </span><span id="local-6989586621679113508"><span class="annot"><span class="annottext">ac :: ActCont
</span><a href="#local-6989586621679113508"><span class="hs-identifier hs-var">ac</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679113509"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113509"><span class="hs-identifier hs-var">eLoop</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113510"><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113510"><span class="hs-identifier hs-var">mAccepting</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113511"><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><a href="#local-6989586621679113511"><span class="hs-identifier hs-var">mQNFA</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; S ActCont -&gt; S ActCont
forall a s. Show a =&gt; a -&gt; s -&gt; s
</span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&gt;&lt; actNullableTagless &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Q -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113507"><span class="hs-identifier hs-var">qIn</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; &lt;&gt;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(S ActCont -&gt; S ActCont) -&gt; S ActCont -&gt; S ActCont
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-621"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Q -&gt; P
</span><a href="Text.Regex.TDFA.CorePattern.html#unQ"><span class="hs-identifier hs-var">unQ</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113507"><span class="hs-identifier hs-var">qIn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-622"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Seq"><span class="hs-identifier hs-type">Seq</span></a></span><span> </span><span id="local-6989586621679113512"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113512"><span class="hs-identifier hs-var">q1</span></a></span></span><span> </span><span id="local-6989586621679113513"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113513"><span class="hs-identifier hs-var">q2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Q -&gt; ActCont -&gt; S ActCont
</span><a href="#local-6989586621679113491"><span class="hs-identifier hs-var">actNullable</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113512"><span class="hs-identifier hs-var">q1</span></a></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; S ActCont) -&gt; S ActCont -&gt; S ActCont
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; ActCont -&gt; S ActCont
</span><a href="#local-6989586621679113491"><span class="hs-identifier hs-var">actNullable</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113513"><span class="hs-identifier hs-var">q2</span></a></span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113508"><span class="hs-identifier hs-var">ac</span></a></span><span>   </span><span class="hs-comment">-- We know q1 and q2 are nullable</span><span>
</span><span id="line-623"></span><span>
</span><span id="line-624"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Or"><span class="hs-identifier hs-type">Or</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ActCont -&gt; S ActCont
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113508"><span class="hs-identifier hs-var">ac</span></a></span><span>
</span><span id="line-625"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Or"><span class="hs-identifier hs-type">Or</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679113514"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113514"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Q -&gt; ActCont -&gt; S ActCont
</span><a href="#local-6989586621679113493"><span class="hs-identifier hs-var">actNullableTagless</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113514"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113508"><span class="hs-identifier hs-var">ac</span></a></span><span>
</span><span id="line-626"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Or"><span class="hs-identifier hs-type">Or</span></a></span><span> </span><span id="local-6989586621679113515"><span class="annot"><span class="annottext">[Q]
</span><a href="#local-6989586621679113515"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-627"></span><span>        </span><span id="local-6989586621679113516"><span class="annot"><span class="annottext">[Maybe E]
</span><a href="#local-6989586621679113516"><span class="hs-identifier hs-var">cqts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-628"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(Q -&gt; Bool) -&gt; [Q] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.TNFA.html#nullable"><span class="hs-identifier hs-var">nullable</span></a></span><span> </span><span class="annot"><span class="annottext">[Q]
</span><a href="#local-6989586621679113515"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-629"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[S (Maybe E)]
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity [Maybe E]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
forall (m :: * -&gt; *) a. Monad m =&gt; [m a] -&gt; m [a]
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(ActCont -&gt; Maybe E) -&gt; S ActCont -&gt; S (Maybe E)
forall a b.
(a -&gt; b)
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ActCont -&gt; Maybe E
forall a b c. (a, b, c) -&gt; b
</span><a href="Text.Regex.TDFA.Common.html#snd3"><span class="hs-identifier hs-var">snd3</span></a></span><span> </span><span class="annot"><span class="annottext">(S ActCont -&gt; S (Maybe E)) -&gt; S ActCont -&gt; S (Maybe E)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; ActCont -&gt; S ActCont
</span><a href="#local-6989586621679113491"><span class="hs-identifier hs-var">actNullable</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113518"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113508"><span class="hs-identifier hs-var">ac</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679113518"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113518"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Q]
</span><a href="#local-6989586621679113515"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-630"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-631"></span><span>              </span><span id="local-6989586621679113519"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113519"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; E -&gt; S E
</span><a href="Text.Regex.TDFA.TNFA.html#asQNFA"><span class="hs-identifier hs-var">asQNFA</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;qToNFA/actNullableTagless/Or&quot;</span></span><span> </span><span class="annot"><span class="annottext">(E -&gt; S E) -&gt; (ActCont -&gt; E) -&gt; ActCont -&gt; S E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ActCont -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#getE"><span class="hs-identifier hs-var">getE</span></a></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; S E) -&gt; ActCont -&gt; S E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113508"><span class="hs-identifier hs-var">ac</span></a></span><span>
</span><span id="line-632"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679113520"><span class="hs-identifier hs-type">act'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-633"></span><span>                  </span><span id="local-6989586621679113520"><span class="annot"><span class="annottext">act' :: Q -&gt; S (Maybe E)
</span><a href="#local-6989586621679113520"><span class="hs-identifier hs-var hs-var">act'</span></a></span></span><span> </span><span id="local-6989586621679113521"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113521"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe E -&gt; S (Maybe E)
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe E -&gt; S (Maybe E)) -&gt; (E -&gt; Maybe E) -&gt; E -&gt; S (Maybe E)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; Maybe E
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(E -&gt; S (Maybe E)) -&gt; S E -&gt; S (Maybe E)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; E -&gt; S E
</span><a href="#local-6989586621679113403"><span class="hs-identifier hs-var">getTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113521"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113519"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-634"></span><span>              </span><span class="annot"><span class="annottext">[S (Maybe E)]
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity [Maybe E]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
forall (m :: * -&gt; *) a. Monad m =&gt; [m a] -&gt; m [a]
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.TNFA.html#nullable"><span class="hs-identifier hs-var">nullable</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113522"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; Maybe E) -&gt; S ActCont -&gt; S (Maybe E)
forall a b.
(a -&gt; b)
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ActCont -&gt; Maybe E
forall a b c. (a, b, c) -&gt; b
</span><a href="Text.Regex.TDFA.Common.html#snd3"><span class="hs-identifier hs-var">snd3</span></a></span><span> </span><span class="annot"><span class="annottext">(S ActCont -&gt; S (Maybe E)) -&gt; S ActCont -&gt; S (Maybe E)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; ActCont -&gt; S ActCont
</span><a href="#local-6989586621679113491"><span class="hs-identifier hs-var">actNullable</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113522"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113508"><span class="hs-identifier hs-var">ac</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Q -&gt; S (Maybe E)
</span><a href="#local-6989586621679113520"><span class="hs-identifier hs-var">act'</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113522"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679113522"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113522"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Q]
</span><a href="#local-6989586621679113515"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-635"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113523"><span class="annot"><span class="annottext">qts :: [QT]
</span><a href="#local-6989586621679113523"><span class="hs-identifier hs-var hs-var">qts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(E -&gt; QT) -&gt; [E] -&gt; [QT]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe E] -&gt; [E]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">[Maybe E]
</span><a href="#local-6989586621679113516"><span class="hs-identifier hs-var">cqts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-636"></span><span>            </span><span id="local-6989586621679113524"><span class="annot"><span class="annottext">eLoop' :: E
</span><a href="#local-6989586621679113524"><span class="hs-identifier hs-var hs-var">eLoop'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Maybe WinTags
</span><a href="Text.Regex.TDFA.TNFA.html#maybeOnlyEmpty"><span class="hs-identifier hs-var">maybeOnlyEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113507"><span class="hs-identifier hs-var">qIn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-637"></span><span>                       </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679113525"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113525"><span class="hs-identifier hs-var">wtags</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WinTags -&gt; E -&gt; E
forall a. WinTags -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addWinTags"><span class="hs-identifier hs-var">addWinTags</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113525"><span class="hs-identifier hs-var">wtags</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113509"><span class="hs-identifier hs-var">eLoop</span></a></span><span> </span><span class="hs-comment">-- nullable without tests; avoid getQT</span><span>
</span><span id="line-638"></span><span>                       </span><span class="annot"><span class="annottext">Maybe WinTags
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; E) -&gt; QT -&gt; E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(SetTestInfo, WinTags)] -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#applyNullViews"><span class="hs-identifier hs-var">applyNullViews</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; [(SetTestInfo, WinTags)]
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113507"><span class="hs-identifier hs-var">qIn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113509"><span class="hs-identifier hs-var">eLoop</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- suspect this of duplicating some tags with nullQ qIn</span><span>
</span><span id="line-639"></span><span>            </span><span id="local-6989586621679113529"><span class="annot"><span class="annottext">mAccepting' :: Maybe E
</span><a href="#local-6989586621679113529"><span class="hs-identifier hs-var hs-var">mAccepting'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[QT] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[QT]
</span><a href="#local-6989586621679113523"><span class="hs-identifier hs-var">qts</span></a></span><span>
</span><span id="line-640"></span><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; Maybe E -&gt; Maybe E
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; E) -&gt; (E -&gt; QT) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(SetTestInfo, WinTags)] -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#applyNullViews"><span class="hs-identifier hs-var">applyNullViews</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; [(SetTestInfo, WinTags)]
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113507"><span class="hs-identifier hs-var">qIn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (E -&gt; QT) -&gt; E -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113510"><span class="hs-identifier hs-var">mAccepting</span></a></span><span> </span><span class="hs-comment">-- suspect this of duplicating some tags with nullQ qIn</span><span>
</span><span id="line-641"></span><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">E -&gt; Maybe E
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; E) -&gt; QT -&gt; E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT -&gt; QT) -&gt; [QT] -&gt; QT
forall a. (a -&gt; a -&gt; a) -&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">foldr1</span></span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mergeAltQT"><span class="hs-identifier hs-var">mergeAltQT</span></a></span><span> </span><span class="annot"><span class="annottext">[QT]
</span><a href="#local-6989586621679113523"><span class="hs-identifier hs-var">qts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-642"></span><span>            </span><span id="local-6989586621679113532"><span class="annot"><span class="annottext">mQNFA' :: Maybe (TagTasks, QNFA)
</span><a href="#local-6989586621679113532"><span class="hs-identifier hs-var hs-var">mQNFA'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[QT] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[QT]
</span><a href="#local-6989586621679113523"><span class="hs-identifier hs-var">qts</span></a></span><span>
</span><span id="line-643"></span><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Maybe WinTags
</span><a href="Text.Regex.TDFA.TNFA.html#maybeOnlyEmpty"><span class="hs-identifier hs-var">maybeOnlyEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113507"><span class="hs-identifier hs-var">qIn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-644"></span><span>                              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679113533"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113533"><span class="hs-identifier hs-var">wtags</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((TagTasks, QNFA) -&gt; (TagTasks, QNFA))
-&gt; Maybe (TagTasks, QNFA) -&gt; Maybe (TagTasks, QNFA)
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WinTags -&gt; (TagTasks, QNFA) -&gt; (TagTasks, QNFA)
forall a. WinTags -&gt; (TagTasks, a) -&gt; (TagTasks, a)
</span><a href="Text.Regex.TDFA.TNFA.html#addWinTags"><span class="hs-identifier hs-var">addWinTags</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113533"><span class="hs-identifier hs-var">wtags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><a href="#local-6989586621679113511"><span class="hs-identifier hs-var">mQNFA</span></a></span><span>
</span><span id="line-645"></span><span>                              </span><span class="annot"><span class="annottext">Maybe WinTags
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-646"></span><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-647"></span><span>        </span><span class="annot"><span class="annottext">ActCont -&gt; S ActCont
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113524"><span class="hs-identifier hs-var">eLoop'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113529"><span class="hs-identifier hs-var">mAccepting'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><a href="#local-6989586621679113532"><span class="hs-identifier hs-var">mQNFA'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Star"><span class="hs-identifier hs-type">Star</span></a></span><span> </span><span id="local-6989586621679113534"><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113534"><span class="hs-identifier hs-var">mOrbit</span></a></span></span><span> </span><span id="local-6989586621679113535"><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113535"><span class="hs-identifier hs-var">resetTheseOrbits</span></a></span></span><span> </span><span id="local-6989586621679113536"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679113536"><span class="hs-identifier hs-var">mayFirstBeNull</span></a></span></span><span> </span><span id="local-6989586621679113537"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113537"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-650"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113541"><span class="annot"><span class="annottext">ac0 :: ActCont
</span><a href="#local-6989586621679113541"><span class="hs-identifier hs-var">ac0</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">E
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679113542"><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113542"><span class="hs-identifier hs-var">mAccepting0</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679113543"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679113543"><span class="hs-identifier hs-var">clear</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-651"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.TNFA.html#notNullable"><span class="hs-identifier hs-var">notNullable</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113537"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-652"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113508"><span class="hs-identifier hs-var">ac</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-653"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Key] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113535"><span class="hs-identifier hs-var">resetTheseOrbits</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113534"><span class="hs-identifier hs-var">mOrbit</span></a></span><span>
</span><span id="line-654"></span><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Maybe WinTags
</span><a href="Text.Regex.TDFA.TNFA.html#maybeOnlyEmpty"><span class="hs-identifier hs-var">maybeOnlyEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113537"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-655"></span><span>                              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113508"><span class="hs-identifier hs-var">ac</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span>                              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679113544"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113544"><span class="hs-identifier hs-var">wtags</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WinTags -&gt; ActCont -&gt; ActCont
</span><a href="Text.Regex.TDFA.TNFA.html#addWinTagsAC"><span class="hs-identifier hs-var">addWinTagsAC</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113544"><span class="hs-identifier hs-var">wtags</span></a></span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113508"><span class="hs-identifier hs-var">ac</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-657"></span><span>                              </span><span class="annot"><span class="annottext">Maybe WinTags
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113545"><span class="annot"><span class="annottext">nQ :: E -&gt; E
</span><a href="#local-6989586621679113545"><span class="hs-identifier hs-var hs-var">nQ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; E) -&gt; (E -&gt; QT) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(SetTestInfo, WinTags)] -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#preferNullViews"><span class="hs-identifier hs-var">preferNullViews</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; [(SetTestInfo, WinTags)]
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113537"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (E -&gt; QT) -&gt; E -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span>
</span><span id="line-658"></span><span>                                   </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">E -&gt; E
</span><a href="#local-6989586621679113545"><span class="hs-identifier hs-var">nQ</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113509"><span class="hs-identifier hs-var">eLoop</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; Maybe E -&gt; Maybe E
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; E
</span><a href="#local-6989586621679113545"><span class="hs-identifier hs-var">nQ</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113510"><span class="hs-identifier hs-var">mAccepting</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113546"><span class="annot"><span class="annottext">nQ :: E -&gt; E
</span><a href="#local-6989586621679113546"><span class="hs-identifier hs-var hs-var">nQ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; E) -&gt; (E -&gt; QT) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Key] -&gt; QT -&gt; QT
</span><a href="#local-6989586621679113450"><span class="hs-identifier hs-var">resetOrbitsQT</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113535"><span class="hs-identifier hs-var">resetTheseOrbits</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (E -&gt; QT) -&gt; E -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; QT -&gt; QT
</span><a href="#local-6989586621679113451"><span class="hs-identifier hs-var">enterOrbitQT</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113534"><span class="hs-identifier hs-var">mOrbit</span></a></span><span>
</span><span id="line-660"></span><span>                                     </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (E -&gt; QT) -&gt; E -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(SetTestInfo, WinTags)] -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#preferNullViews"><span class="hs-identifier hs-var">preferNullViews</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; [(SetTestInfo, WinTags)]
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113537"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (E -&gt; QT) -&gt; E -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; QT) -&gt; (E -&gt; E) -&gt; E -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; E -&gt; E
</span><a href="#local-6989586621679113452"><span class="hs-identifier hs-var">leaveOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113534"><span class="hs-identifier hs-var">mOrbit</span></a></span><span>
</span><span id="line-661"></span><span>                            </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">E -&gt; E
</span><a href="#local-6989586621679113546"><span class="hs-identifier hs-var">nQ</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113509"><span class="hs-identifier hs-var">eLoop</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; Maybe E -&gt; Maybe E
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; E
</span><a href="#local-6989586621679113546"><span class="hs-identifier hs-var">nQ</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113510"><span class="hs-identifier hs-var">mAccepting</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-662"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#cannotAccept"><span class="hs-identifier hs-var">cannotAccept</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113537"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ActCont -&gt; S ActCont
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113541"><span class="hs-identifier hs-var">ac0</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">mdo</span><span>
</span><span id="line-663"></span><span>          </span><span id="local-6989586621679113547"><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113547"><span class="hs-identifier hs-var">mChildAccepting</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q -&gt; ActCont -&gt; S (Maybe E)
</span><a href="#local-6989586621679113495"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113537"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113548"><span class="hs-identifier hs-var">this</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe E
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-664"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679113549"><span class="annot"><span class="annottext">thisAC :: ActCont
</span><a href="#local-6989586621679113549"><span class="hs-identifier hs-var">thisAC</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679113548"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113548"><span class="hs-identifier hs-var">this</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe E
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679113550"><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113550"><span class="hs-identifier hs-var">ansAC</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-665"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113547"><span class="hs-identifier hs-var">mChildAccepting</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-666"></span><span>              </span><span class="annot"><span class="annottext">Maybe E
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; StateT
     (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity (ActCont, ActCont)
forall a. [Char] -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">([Char]
 -&gt; StateT
      (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity (ActCont, ActCont))
-&gt; [Char]
-&gt; StateT
     (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity (ActCont, ActCont)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Weird pattern in getTransTagless/Star: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Q, Q) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113395"><span class="hs-identifier hs-var">qTop</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113507"><span class="hs-identifier hs-var">qIn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679113551"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113551"><span class="hs-identifier hs-var">childAccepting</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-668"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113552"><span class="annot"><span class="annottext">childQT :: QT
</span><a href="#local-6989586621679113552"><span class="hs-identifier hs-var hs-var">childQT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Key] -&gt; QT -&gt; QT
</span><a href="#local-6989586621679113450"><span class="hs-identifier hs-var">resetOrbitsQT</span></a></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113535"><span class="hs-identifier hs-var">resetTheseOrbits</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (E -&gt; QT) -&gt; E -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; QT -&gt; QT
</span><a href="#local-6989586621679113451"><span class="hs-identifier hs-var">enterOrbitQT</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113534"><span class="hs-identifier hs-var">mOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (E -&gt; QT) -&gt; E -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; QT) -&gt; E -&gt; QT
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113551"><span class="hs-identifier hs-var">childAccepting</span></a></span><span>
</span><span id="line-669"></span><span>                    </span><span id="local-6989586621679113553"><span class="annot"><span class="annottext">thisQT :: QT
</span><a href="#local-6989586621679113553"><span class="hs-identifier hs-var hs-var">thisQT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mergeQT"><span class="hs-identifier hs-var">mergeQT</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113552"><span class="hs-identifier hs-var">childQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (ActCont -&gt; QT) -&gt; ActCont -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; QT) -&gt; (ActCont -&gt; E) -&gt; ActCont -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Key -&gt; E -&gt; E
</span><a href="#local-6989586621679113452"><span class="hs-identifier hs-var">leaveOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113534"><span class="hs-identifier hs-var">mOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; (ActCont -&gt; E) -&gt; ActCont -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ActCont -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#getE"><span class="hs-identifier hs-var">getE</span></a></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; QT) -&gt; ActCont -&gt; QT
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113508"><span class="hs-identifier hs-var">ac</span></a></span><span>
</span><span id="line-670"></span><span>                    </span><span id="local-6989586621679113554"><span class="annot"><span class="annottext">thisAccepting :: Maybe E
</span><a href="#local-6989586621679113554"><span class="hs-identifier hs-var hs-var">thisAccepting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-671"></span><span>                      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113510"><span class="hs-identifier hs-var">mAccepting</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-672"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679113555"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113555"><span class="hs-identifier hs-var">futureAccepting</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E -&gt; Maybe E
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(E -&gt; Maybe E) -&gt; (E -&gt; E) -&gt; E -&gt; Maybe E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; E) -&gt; (E -&gt; QT) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mergeQT"><span class="hs-identifier hs-var">mergeQT</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113552"><span class="hs-identifier hs-var">childQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (E -&gt; QT) -&gt; E -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; Maybe E) -&gt; E -&gt; Maybe E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113555"><span class="hs-identifier hs-var">futureAccepting</span></a></span><span>
</span><span id="line-673"></span><span>                        </span><span class="annot"><span class="annottext">Maybe E
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E -&gt; Maybe E
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(E -&gt; Maybe E) -&gt; (QT -&gt; E) -&gt; QT -&gt; Maybe E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; Maybe E) -&gt; QT -&gt; Maybe E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113552"><span class="hs-identifier hs-var">childQT</span></a></span><span>
</span><span id="line-674"></span><span>                </span><span id="local-6989586621679113556"><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113556"><span class="hs-identifier hs-var">thisAll</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.TNFA.html#usesQNFA"><span class="hs-identifier hs-var">usesQNFA</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113537"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-675"></span><span>                             </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679113557"><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113557"><span class="hs-identifier hs-var">thisQNFA</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; QT -&gt; S QNFA
</span><a href="Text.Regex.TDFA.TNFA.html#newQNFA"><span class="hs-identifier hs-var">newQNFA</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;actNullableTagless/Star&quot;</span></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113553"><span class="hs-identifier hs-var">thisQT</span></a></span><span>
</span><span id="line-676"></span><span>                                     </span><span class="annot"><span class="annottext">ActCont -&gt; S ActCont
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QNFA -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQNFA"><span class="hs-identifier hs-var">fromQNFA</span></a></span><span> </span><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113557"><span class="hs-identifier hs-var">thisQNFA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113554"><span class="hs-identifier hs-var">thisAccepting</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(TagTasks, QNFA) -&gt; Maybe (TagTasks, QNFA)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagTasks
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113557"><span class="hs-identifier hs-var">thisQNFA</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span>                             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ActCont -&gt; S ActCont
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113553"><span class="hs-identifier hs-var">thisQT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113554"><span class="hs-identifier hs-var">thisAccepting</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-678"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113558"><span class="annot"><span class="annottext">skipQT :: QT
</span><a href="#local-6989586621679113558"><span class="hs-identifier hs-var hs-var">skipQT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mergeQT"><span class="hs-identifier hs-var">mergeQT</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113552"><span class="hs-identifier hs-var">childQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (ActCont -&gt; QT) -&gt; ActCont -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; QT) -&gt; (ActCont -&gt; E) -&gt; ActCont -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ActCont -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#getE"><span class="hs-identifier hs-var">getE</span></a></span><span> </span><span class="annot"><span class="annottext">(ActCont -&gt; QT) -&gt; ActCont -&gt; QT
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113541"><span class="hs-identifier hs-var">ac0</span></a></span><span>  </span><span class="hs-comment">-- for first iteration the continuation uses NullView</span><span>
</span><span id="line-679"></span><span>                    </span><span id="local-6989586621679113559"><span class="annot"><span class="annottext">skipAccepting :: Maybe E
</span><a href="#local-6989586621679113559"><span class="hs-identifier hs-var hs-var">skipAccepting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-680"></span><span>                      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113542"><span class="hs-identifier hs-var">mAccepting0</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-681"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679113560"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113560"><span class="hs-identifier hs-var">futureAccepting0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E -&gt; Maybe E
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(E -&gt; Maybe E) -&gt; (E -&gt; E) -&gt; E -&gt; Maybe E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; E) -&gt; (E -&gt; QT) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mergeQT"><span class="hs-identifier hs-var">mergeQT</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113552"><span class="hs-identifier hs-var">childQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (E -&gt; QT) -&gt; E -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; Maybe E) -&gt; E -&gt; Maybe E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113560"><span class="hs-identifier hs-var">futureAccepting0</span></a></span><span>
</span><span id="line-682"></span><span>                        </span><span class="annot"><span class="annottext">Maybe E
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E -&gt; Maybe E
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(E -&gt; Maybe E) -&gt; (QT -&gt; E) -&gt; QT -&gt; Maybe E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; Maybe E) -&gt; QT -&gt; Maybe E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113552"><span class="hs-identifier hs-var">childQT</span></a></span><span>
</span><span id="line-683"></span><span>                    </span><span id="local-6989586621679113561"><span class="annot"><span class="annottext">ansAll :: (E, Maybe E, Maybe a)
</span><a href="#local-6989586621679113561"><span class="hs-identifier hs-var hs-var">ansAll</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113558"><span class="hs-identifier hs-var">skipQT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113559"><span class="hs-identifier hs-var">skipAccepting</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-684"></span><span>                </span><span class="annot"><span class="annottext">(ActCont, ActCont)
-&gt; StateT
     (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity (ActCont, ActCont)
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113556"><span class="hs-identifier hs-var">thisAll</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ActCont
forall {a}. (E, Maybe E, Maybe a)
</span><a href="#local-6989586621679113561"><span class="hs-identifier hs-var">ansAll</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span>          </span><span class="annot"><span class="annottext">ActCont -&gt; S ActCont
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679113536"><span class="hs-identifier hs-var">mayFirstBeNull</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679113543"><span class="hs-identifier hs-var">clear</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113549"><span class="hs-identifier hs-var">thisAC</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113550"><span class="hs-identifier hs-var">ansAC</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-686"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113549"><span class="hs-identifier hs-var">thisAC</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-687"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NonEmpty"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span id="local-6989586621679113562"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113562"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; S ActCont -&gt; S ActCont
forall a. [Char] -&gt; a -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#ecart"><span class="hs-identifier hs-var">ecart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\n&gt; actNullableTagless/NonEmpty&quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Q -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113507"><span class="hs-identifier hs-var">qIn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(S ActCont -&gt; S ActCont) -&gt; S ActCont -&gt; S ActCont
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-688"></span><span>        </span><span class="hs-comment">-- We *know* that q is nullable from Pattern and CorePattern checks, but assert here anyway</span><span>
</span><span id="line-689"></span><span>        </span><span class="annot"><span class="annottext">Bool
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ()
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#mustAccept"><span class="hs-identifier hs-var">mustAccept</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113562"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ()
forall a. [Char] -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">([Char]
 -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ())
-&gt; [Char]
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;actNullableTagless/NonEmpty : provided with a *mustAccept* pattern: &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">(Q, Q) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113395"><span class="hs-identifier hs-var">qTop</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113507"><span class="hs-identifier hs-var">qIn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-690"></span><span>        </span><span class="annot"><span class="annottext">Bool
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ()
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#cannotAccept"><span class="hs-identifier hs-var">cannotAccept</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113562"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ()
forall a. [Char] -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">([Char]
 -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ())
-&gt; [Char]
-&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;actNullableTagless/NonEmpty : provided with a *cannotAccept* pattern: &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">(Q, Q) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113395"><span class="hs-identifier hs-var">qTop</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113507"><span class="hs-identifier hs-var">qIn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-691"></span><span>
</span><span id="line-692"></span><span>        </span><span class="hs-comment">{- This is like actNullable (Or [Empty,q]) without the extra tag to prefer the first Empty branch -}</span><span>
</span><span id="line-693"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113566"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113566"><span class="hs-identifier hs-var">clearE</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe E
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Maybe WinTags
</span><a href="Text.Regex.TDFA.TNFA.html#maybeOnlyEmpty"><span class="hs-identifier hs-var">maybeOnlyEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113507"><span class="hs-identifier hs-var">qIn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-694"></span><span>                             </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113508"><span class="hs-identifier hs-var">ac</span></a></span><span>
</span><span id="line-695"></span><span>                             </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679113567"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113567"><span class="hs-identifier hs-var">_wtags</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113508"><span class="hs-identifier hs-var">ac</span></a></span><span> </span><span class="hs-comment">-- addWinTagsAC wtags ac XXX was duplicating tags</span><span>
</span><span id="line-696"></span><span>                             </span><span class="annot"><span class="annottext">Maybe WinTags
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ActCont
forall a. [Char] -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ActCont) -&gt; [Char] -&gt; ActCont
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;actNullableTagless/NonEmpty is supposed to have an emptyNull nullView : &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">(Q, Q) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113395"><span class="hs-identifier hs-var">qTop</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113507"><span class="hs-identifier hs-var">qIn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-697"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679113568"><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113568"><span class="hs-identifier hs-var">mChildAccepting</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q -&gt; ActCont -&gt; S ActCont
</span><a href="#local-6989586621679113491"><span class="hs-identifier hs-var">actNullable</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113562"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">ActCont
</span><a href="#local-6989586621679113508"><span class="hs-identifier hs-var">ac</span></a></span><span>
</span><span id="line-698"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113568"><span class="hs-identifier hs-var">mChildAccepting</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-699"></span><span>          </span><span class="annot"><span class="annottext">Maybe E
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; S ActCont
forall a. [Char] -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span>  </span><span class="annot"><span class="annottext">([Char] -&gt; S ActCont) -&gt; [Char] -&gt; S ActCont
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Weird pattern in actNullableTagless/NonEmpty: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Q, Q) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113395"><span class="hs-identifier hs-var">qTop</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113507"><span class="hs-identifier hs-var">qIn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-700"></span><span>            </span><span class="hs-comment">-- cannotAccept q checked for and excluded the above condition (and starTrans!)</span><span>
</span><span id="line-701"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679113569"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113569"><span class="hs-identifier hs-var">childAccepting</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-702"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113570"><span class="annot"><span class="annottext">childQT :: QT
</span><a href="#local-6989586621679113570"><span class="hs-identifier hs-var hs-var">childQT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113569"><span class="hs-identifier hs-var">childAccepting</span></a></span><span>
</span><span id="line-703"></span><span>                </span><span id="local-6989586621679113571"><span class="annot"><span class="annottext">thisAccepting :: Maybe E
</span><a href="#local-6989586621679113571"><span class="hs-identifier hs-var hs-var">thisAccepting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113510"><span class="hs-identifier hs-var">mAccepting</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-704"></span><span>                                  </span><span class="annot"><span class="annottext">Maybe E
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E -&gt; Maybe E
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(E -&gt; Maybe E) -&gt; (QT -&gt; E) -&gt; QT -&gt; Maybe E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; Maybe E) -&gt; QT -&gt; Maybe E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113570"><span class="hs-identifier hs-var">childQT</span></a></span><span>
</span><span id="line-705"></span><span>                                  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679113572"><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113572"><span class="hs-identifier hs-var">futureAcceptingE</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E -&gt; Maybe E
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(E -&gt; Maybe E) -&gt; (E -&gt; E) -&gt; E -&gt; Maybe E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; E) -&gt; (E -&gt; QT) -&gt; E -&gt; E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#mergeQT"><span class="hs-identifier hs-var">mergeQT</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113570"><span class="hs-identifier hs-var">childQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (E -&gt; QT) -&gt; E -&gt; QT
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a></span><span> </span><span class="annot"><span class="annottext">(E -&gt; Maybe E) -&gt; E -&gt; Maybe E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113572"><span class="hs-identifier hs-var">futureAcceptingE</span></a></span><span>
</span><span id="line-706"></span><span>                                  </span><span class="hs-comment">-- I _think_ there is no need for mergeQT_2nd in the above.</span><span>
</span><span id="line-707"></span><span>            </span><span class="annot"><span class="annottext">ActCont -&gt; S ActCont
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E
</span><a href="#local-6989586621679113566"><span class="hs-identifier hs-var">clearE</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe E
</span><a href="#local-6989586621679113571"><span class="hs-identifier hs-var">thisAccepting</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (TagTasks, QNFA)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-708"></span><span>      </span><span class="annot"><span class="annottext">P
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; S ActCont
forall a. [Char] -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; S ActCont) -&gt; [Char] -&gt; S ActCont
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;This case in Text.Regex.TNFA.TNFA.actNullableTagless cannot happen: &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">(Q, Q) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113395"><span class="hs-identifier hs-var">qTop</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113507"><span class="hs-identifier hs-var">qIn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-709"></span><span>
</span><span id="line-710"></span><span>  </span><span class="hs-comment">-- This is applied directly to any qt immediately before passing to mergeQT</span><span>
</span><span id="line-711"></span><span>  </span><span class="annot"><a href="#local-6989586621679113450"><span class="hs-identifier hs-type">resetOrbitsQT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span>
</span><span id="line-712"></span><span>  </span><span id="local-6989586621679113450"><span class="annot"><span class="annottext">resetOrbitsQT :: [Key] -&gt; QT -&gt; QT
</span><a href="#local-6989586621679113450"><span class="hs-identifier hs-var hs-var">resetOrbitsQT</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CompOption -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#lastStarGreedy"><span class="hs-identifier hs-var">lastStarGreedy</span></a></span><span> </span><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621679113394"><span class="hs-identifier hs-var">compOpt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; [Key] -&gt; QT -&gt; QT
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-713"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679113575"><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113575"><span class="hs-identifier hs-var">tags</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WinTags -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var">prependTags'</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113576"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagTask -&gt; TagUpdate
</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#ResetOrbitTask"><span class="hs-identifier hs-var">ResetOrbitTask</span></a></span><span class="hs-special">)</span><span class="hs-glyph">|</span><span id="local-6989586621679113576"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113576"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-glyph">&lt;-</span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113575"><span class="hs-identifier hs-var">tags</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-714"></span><span>
</span><span id="line-715"></span><span>  </span><span class="annot"><a href="#local-6989586621679113451"><span class="hs-identifier hs-type">enterOrbitQT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span>
</span><span id="line-716"></span><span>  </span><span id="local-6989586621679113451"><span class="annot"><span class="annottext">enterOrbitQT :: Maybe Key -&gt; QT -&gt; QT
</span><a href="#local-6989586621679113451"><span class="hs-identifier hs-var hs-var">enterOrbitQT</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CompOption -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#lastStarGreedy"><span class="hs-identifier hs-var">lastStarGreedy</span></a></span><span> </span><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621679113394"><span class="hs-identifier hs-var">compOpt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; Maybe Key -&gt; QT -&gt; QT
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-717"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(QT -&gt; QT) -&gt; (Key -&gt; QT -&gt; QT) -&gt; Maybe Key -&gt; QT -&gt; QT
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">QT -&gt; QT
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679113579"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113579"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-glyph">-&gt;</span><span class="annot"><span class="annottext">WinTags -&gt; QT -&gt; QT
</span><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var">prependTags'</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113579"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagTask -&gt; TagUpdate
</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#EnterOrbitTask"><span class="hs-identifier hs-var">EnterOrbitTask</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>
</span><span id="line-719"></span><span>  </span><span class="annot"><a href="#local-6989586621679113452"><span class="hs-identifier hs-type">leaveOrbit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span>
</span><span id="line-720"></span><span>  </span><span id="local-6989586621679113452"><span class="annot"><span class="annottext">leaveOrbit :: Maybe Key -&gt; E -&gt; E
</span><a href="#local-6989586621679113452"><span class="hs-identifier hs-var hs-var">leaveOrbit</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CompOption -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#lastStarGreedy"><span class="hs-identifier hs-var">lastStarGreedy</span></a></span><span> </span><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621679113394"><span class="hs-identifier hs-var">compOpt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; Maybe Key -&gt; E -&gt; E
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; E
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-721"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(E -&gt; E) -&gt; (Key -&gt; E -&gt; E) -&gt; Maybe Key -&gt; E -&gt; E
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">E -&gt; E
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679113581"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113581"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-glyph">-&gt;</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679113582"><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113582"><span class="hs-identifier hs-var">tags</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113583"><span class="annot"><span class="annottext">Either QNFA QT
</span><a href="#local-6989586621679113583"><span class="hs-identifier hs-var">cont</span></a></span></span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113581"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#LeaveOrbitTask"><span class="hs-identifier hs-var">LeaveOrbitTask</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Key, TagTask) -&gt; TagTasks -&gt; TagTasks
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113582"><span class="hs-identifier hs-var">tags</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Either QNFA QT
</span><a href="#local-6989586621679113583"><span class="hs-identifier hs-var">cont</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-722"></span><span>
</span><span id="line-723"></span><span>  </span><span class="hs-comment">-- 'newTrans' is the only place where PostUpdate is used and is only called from getTrans/OneChar</span><span>
</span><span id="line-724"></span><span>  </span><span class="hs-comment">--  and is the only caller of 'acceptTrans' to make QT/Simple nodes.</span><span>
</span><span id="line-725"></span><span>  </span><span class="annot"><a href="#local-6989586621679113421"><span class="hs-identifier hs-type">newTrans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>    </span><span class="hs-comment">-- debugging string for when a newQNFA is allocated</span><span>
</span><span id="line-726"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- which tags get ResetGroupStopTask in this transition (PreUpdate)</span><span>
</span><span id="line-727"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-comment">-- maybe one TagTask to update before incrementing the offset (PreUpdate)</span><span>
</span><span id="line-728"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a></span><span>   </span><span class="hs-comment">-- the one character accepting Pattern of this transition</span><span>
</span><span id="line-729"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span>         </span><span class="hs-comment">-- the continuation state, reified to a QNFA, of after this Pattern</span><span>
</span><span id="line-730"></span><span>                       </span><span class="hs-comment">-- The fst part of the E is consumed here as a TagTask (PostUpdate)</span><span>
</span><span id="line-731"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a></span><span>       </span><span class="hs-comment">-- the continuation state, as a QT, of before this Pattern</span><span>
</span><span id="line-732"></span><span>  </span><span id="local-6989586621679113421"><span class="annot"><span class="annottext">newTrans :: [Char] -&gt; [Key] -&gt; Maybe Key -&gt; Pattern -&gt; E -&gt; S E
</span><a href="#local-6989586621679113421"><span class="hs-identifier hs-var hs-var">newTrans</span></a></span></span><span> </span><span id="local-6989586621679113585"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679113585"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679113586"><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113586"><span class="hs-identifier hs-var">resets</span></a></span></span><span> </span><span id="local-6989586621679113587"><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113587"><span class="hs-identifier hs-var">mPre</span></a></span></span><span> </span><span id="local-6989586621679113588"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679113588"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679113589"><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113589"><span class="hs-identifier hs-var">tags</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113590"><span class="annot"><span class="annottext">Either QNFA QT
</span><a href="#local-6989586621679113590"><span class="hs-identifier hs-var">cont</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-733"></span><span>    </span><span id="local-6989586621679113591"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113591"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either QNFA QT
</span><a href="#local-6989586621679113590"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-734"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679113592"><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113592"><span class="hs-identifier hs-var">qnfa</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Key -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity Key
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QNFA -&gt; Key
</span><a href="Text.Regex.TDFA.Common.html#q_id"><span class="hs-identifier hs-var">q_id</span></a></span><span> </span><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113592"><span class="hs-identifier hs-var">qnfa</span></a></span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- strictQNFA ZZZ no help</span><span>
</span><span id="line-735"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679113593"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113593"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679113594"><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113594"><span class="hs-identifier hs-var">qnfa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; QT -&gt; S QNFA
</span><a href="Text.Regex.TDFA.TNFA.html#newQNFA"><span class="hs-identifier hs-var">newQNFA</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679113585"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113593"><span class="hs-identifier hs-var">qt</span></a></span><span> </span><span class="hs-comment">-- strictQT ZZZ no help</span><span>
</span><span id="line-736"></span><span>                          </span><span class="annot"><span class="annottext">Key -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity Key
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QNFA -&gt; Key
</span><a href="Text.Regex.TDFA.Common.html#q_id"><span class="hs-identifier hs-var">q_id</span></a></span><span> </span><span class="annot"><span class="annottext">QNFA
</span><a href="#local-6989586621679113594"><span class="hs-identifier hs-var">qnfa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-737"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113595"><span class="annot"><span class="annottext">post :: WinTags
</span><a href="#local-6989586621679113595"><span class="hs-identifier hs-var hs-var">post</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TagTask -&gt; TagUpdate) -&gt; TagTasks -&gt; WinTags
</span><a href="Text.Regex.TDFA.TNFA.html#promoteTasks"><span class="hs-identifier hs-var">promoteTasks</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask -&gt; TagUpdate
</span><a href="Text.Regex.TDFA.Common.html#PostUpdate"><span class="hs-identifier hs-var">PostUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTasks
</span><a href="#local-6989586621679113589"><span class="hs-identifier hs-var">tags</span></a></span><span>
</span><span id="line-738"></span><span>        </span><span id="local-6989586621679113596"><span class="annot"><span class="annottext">pre :: WinTags
</span><a href="#local-6989586621679113596"><span class="hs-identifier hs-var hs-var">pre</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TagTask -&gt; TagUpdate) -&gt; TagTasks -&gt; WinTags
</span><a href="Text.Regex.TDFA.TNFA.html#promoteTasks"><span class="hs-identifier hs-var">promoteTasks</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask -&gt; TagUpdate
</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113597"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#ResetGroupStopTask"><span class="hs-identifier hs-var">ResetGroupStopTask</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679113597"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113597"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-glyph">&lt;-</span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679113586"><span class="hs-identifier hs-var">resets</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TagTasks -&gt; TagTasks -&gt; TagTasks
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TagTasks -&gt; (Key -&gt; TagTasks) -&gt; Maybe Key -&gt; TagTasks
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679113598"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113598"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113598"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#TagTask"><span class="hs-identifier hs-var">TagTask</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Key
</span><a href="#local-6989586621679113587"><span class="hs-identifier hs-var">mPre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-739"></span><span>    </span><span class="annot"><span class="annottext">E -&gt; S E
forall a.
a -&gt; StateT (Key, [(Key, QNFA)] -&gt; [(Key, QNFA)]) Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(E -&gt; S E) -&gt; (QT -&gt; E) -&gt; QT -&gt; S E
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QT -&gt; E
</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a></span><span> </span><span class="annot"><span class="annottext">(QT -&gt; S E) -&gt; QT -&gt; S E
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WinTags -&gt; Pattern -&gt; WinTags -&gt; Key -&gt; QT
</span><a href="#local-6989586621679113599"><span class="hs-identifier hs-var">acceptTrans</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113596"><span class="hs-identifier hs-var">pre</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679113588"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113595"><span class="hs-identifier hs-var">post</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113591"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-comment">-- fromQT $ strictQT no help</span><span>
</span><span id="line-740"></span><span>
</span><span id="line-741"></span><span>  </span><span class="hs-comment">-- 'acceptTrans' is the sole creator of QT/Simple and is only called by getTrans/OneChar/newTrans</span><span>
</span><span id="line-742"></span><span>  </span><span class="annot"><a href="#local-6989586621679113599"><span class="hs-identifier hs-type">acceptTrans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagList"><span class="hs-identifier hs-type">TagList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagList"><span class="hs-identifier hs-type">TagList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span>
</span><span id="line-743"></span><span>  </span><span id="local-6989586621679113599"><span class="annot"><span class="annottext">acceptTrans :: WinTags -&gt; Pattern -&gt; WinTags -&gt; Key -&gt; QT
</span><a href="#local-6989586621679113599"><span class="hs-identifier hs-var hs-var">acceptTrans</span></a></span></span><span> </span><span id="local-6989586621679113600"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113600"><span class="hs-identifier hs-var">pre</span></a></span></span><span> </span><span id="local-6989586621679113601"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679113601"><span class="hs-identifier hs-var">pIn</span></a></span></span><span> </span><span id="local-6989586621679113602"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113602"><span class="hs-identifier hs-var">post</span></a></span></span><span> </span><span id="local-6989586621679113603"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113603"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-744"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113604"><span class="annot"><span class="annottext">target :: QTrans
</span><a href="#local-6989586621679113604"><span class="hs-identifier hs-var hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Key -&gt; [TagCommand] -&gt; QTrans
forall a. Key -&gt; a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.singleton</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679113603"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern -&gt; DoPa
</span><a href="Text.Regex.TDFA.Pattern.html#getDoPa"><span class="hs-identifier hs-var">getDoPa</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679113601"><span class="hs-identifier hs-var">pIn</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113600"><span class="hs-identifier hs-var">pre</span></a></span><span class="annot"><span class="annottext">WinTags -&gt; WinTags -&gt; WinTags
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113602"><span class="hs-identifier hs-var">post</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-745"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679113601"><span class="hs-identifier hs-var">pIn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-746"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PChar"><span class="hs-identifier hs-type">PChar</span></a></span><span> </span><span class="annot"><span class="annottext">DoPa
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679113607"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679113607"><span class="hs-identifier hs-var">char</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-747"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113608"><span class="annot"><span class="annottext">trans :: CharMap QTrans
</span><a href="#local-6989586621679113608"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTrans -&gt; [Char] -&gt; CharMap QTrans
</span><a href="#local-6989586621679113609"><span class="hs-identifier hs-var">toMap</span></a></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113604"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679113607"><span class="hs-identifier hs-var">char</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-748"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-type">Simple</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">qt_win :: WinTags
</span><a href="Text.Regex.TDFA.Common.html#qt_win"><span class="hs-identifier hs-var">qt_win</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WinTags
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qt_trans :: CharMap QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_trans"><span class="hs-identifier hs-var">qt_trans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CharMap QTrans
</span><a href="#local-6989586621679113608"><span class="hs-identifier hs-var">trans</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qt_other :: QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_other"><span class="hs-identifier hs-var">qt_other</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTrans
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-749"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PEscape"><span class="hs-identifier hs-type">PEscape</span></a></span><span> </span><span class="annot"><span class="annottext">DoPa
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679113611"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679113611"><span class="hs-identifier hs-var">char</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-750"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113612"><span class="annot"><span class="annottext">trans :: CharMap QTrans
</span><a href="#local-6989586621679113612"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTrans -&gt; [Char] -&gt; CharMap QTrans
</span><a href="#local-6989586621679113609"><span class="hs-identifier hs-var">toMap</span></a></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113604"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679113611"><span class="hs-identifier hs-var">char</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-751"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-type">Simple</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">qt_win :: WinTags
</span><a href="Text.Regex.TDFA.Common.html#qt_win"><span class="hs-identifier hs-var">qt_win</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WinTags
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qt_trans :: CharMap QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_trans"><span class="hs-identifier hs-var">qt_trans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CharMap QTrans
</span><a href="#local-6989586621679113612"><span class="hs-identifier hs-var">trans</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qt_other :: QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_other"><span class="hs-identifier hs-var">qt_other</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTrans
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-752"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PDot"><span class="hs-identifier hs-type">PDot</span></a></span><span> </span><span class="annot"><span class="annottext">DoPa
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-type">Simple</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">qt_win :: WinTags
</span><a href="Text.Regex.TDFA.Common.html#qt_win"><span class="hs-identifier hs-var">qt_win</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WinTags
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qt_trans :: CharMap QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_trans"><span class="hs-identifier hs-var">qt_trans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CharMap QTrans
</span><a href="#local-6989586621679113614"><span class="hs-identifier hs-var">dotTrans</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qt_other :: QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_other"><span class="hs-identifier hs-var">qt_other</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113604"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-753"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PAny"><span class="hs-identifier hs-type">PAny</span></a></span><span> </span><span class="annot"><span class="annottext">DoPa
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679113616"><span class="annot"><span class="annottext">PatternSet
</span><a href="#local-6989586621679113616"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-754"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113617"><span class="annot"><span class="annottext">trans :: CharMap QTrans
</span><a href="#local-6989586621679113617"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTrans -&gt; [Char] -&gt; CharMap QTrans
</span><a href="#local-6989586621679113609"><span class="hs-identifier hs-var">toMap</span></a></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113604"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; CharMap QTrans)
-&gt; (PatternSet -&gt; [Char]) -&gt; PatternSet -&gt; CharMap QTrans
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set Char -&gt; [Char]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toAscList</span></span><span> </span><span class="annot"><span class="annottext">(Set Char -&gt; [Char])
-&gt; (PatternSet -&gt; Set Char) -&gt; PatternSet -&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PatternSet -&gt; Set Char
</span><a href="Text.Regex.TDFA.Pattern.html#decodePatternSet"><span class="hs-identifier hs-var">decodePatternSet</span></a></span><span> </span><span class="annot"><span class="annottext">(PatternSet -&gt; CharMap QTrans) -&gt; PatternSet -&gt; CharMap QTrans
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatternSet
</span><a href="#local-6989586621679113616"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-755"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-type">Simple</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">qt_win :: WinTags
</span><a href="Text.Regex.TDFA.Common.html#qt_win"><span class="hs-identifier hs-var">qt_win</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WinTags
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qt_trans :: CharMap QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_trans"><span class="hs-identifier hs-var">qt_trans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CharMap QTrans
</span><a href="#local-6989586621679113617"><span class="hs-identifier hs-var">trans</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qt_other :: QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_other"><span class="hs-identifier hs-var">qt_other</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTrans
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-756"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PAnyNot"><span class="hs-identifier hs-type">PAnyNot</span></a></span><span> </span><span class="annot"><span class="annottext">DoPa
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679113619"><span class="annot"><span class="annottext">PatternSet
</span><a href="#local-6989586621679113619"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-757"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679113621"><span class="annot"><span class="annottext">trans :: CharMap QTrans
</span><a href="#local-6989586621679113621"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTrans -&gt; [Char] -&gt; CharMap QTrans
</span><a href="#local-6989586621679113609"><span class="hs-identifier hs-var">toMap</span></a></span><span> </span><span class="annot"><span class="annottext">QTrans
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; CharMap QTrans)
-&gt; (PatternSet -&gt; [Char]) -&gt; PatternSet -&gt; CharMap QTrans
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set Char -&gt; [Char]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toAscList</span></span><span> </span><span class="annot"><span class="annottext">(Set Char -&gt; [Char])
-&gt; (PatternSet -&gt; Set Char) -&gt; PatternSet -&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set Char -&gt; Set Char
</span><a href="#local-6989586621679113622"><span class="hs-identifier hs-var">addNewline</span></a></span><span> </span><span class="annot"><span class="annottext">(Set Char -&gt; Set Char)
-&gt; (PatternSet -&gt; Set Char) -&gt; PatternSet -&gt; Set Char
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PatternSet -&gt; Set Char
</span><a href="Text.Regex.TDFA.Pattern.html#decodePatternSet"><span class="hs-identifier hs-var">decodePatternSet</span></a></span><span> </span><span class="annot"><span class="annottext">(PatternSet -&gt; CharMap QTrans) -&gt; PatternSet -&gt; CharMap QTrans
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatternSet
</span><a href="#local-6989586621679113619"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-758"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-type">Simple</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">qt_win :: WinTags
</span><a href="Text.Regex.TDFA.Common.html#qt_win"><span class="hs-identifier hs-var">qt_win</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WinTags
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qt_trans :: CharMap QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_trans"><span class="hs-identifier hs-var">qt_trans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CharMap QTrans
</span><a href="#local-6989586621679113621"><span class="hs-identifier hs-var">trans</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qt_other :: QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_other"><span class="hs-identifier hs-var">qt_other</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113604"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-759"></span><span>         </span><span class="annot"><span class="annottext">Pattern
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; QT
forall a. [Char] -&gt; a
</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Cannot acceptTrans pattern &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">(Q, Pattern) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679113395"><span class="hs-identifier hs-var">qTop</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679113601"><span class="hs-identifier hs-var">pIn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-760"></span><span>    </span><span class="hs-keyword">where</span><span>  </span><span class="hs-comment">-- Take a common destination and a sorted list of unique characters</span><span>
</span><span id="line-761"></span><span>           </span><span class="hs-comment">-- and create a map from those characters to the common destination</span><span>
</span><span id="line-762"></span><span>      </span><span class="annot"><a href="#local-6989586621679113609"><span class="hs-identifier hs-type">toMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DoPa"><span class="hs-identifier hs-type">DoPa</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagUpdate"><span class="hs-identifier hs-type">TagUpdate</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">]</span><span>
</span><span id="line-763"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-type">CharMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IntMap</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DoPa"><span class="hs-identifier hs-type">DoPa</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagUpdate"><span class="hs-identifier hs-type">TagUpdate</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-764"></span><span>      </span><span id="local-6989586621679113609"><span class="annot"><span class="annottext">toMap :: QTrans -&gt; [Char] -&gt; CharMap QTrans
</span><a href="#local-6989586621679113609"><span class="hs-identifier hs-var hs-var">toMap</span></a></span></span><span> </span><span id="local-6989586621679113623"><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113623"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CompOption -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#caseSensitive"><span class="hs-identifier hs-var">caseSensitive</span></a></span><span> </span><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621679113394"><span class="hs-identifier hs-var">compOpt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap QTrans -&gt; CharMap QTrans
forall a. IntMap a -&gt; CharMap a
</span><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-var">CharMap</span></a></span><span> </span><span class="annot"><span class="annottext">(IntMap QTrans -&gt; CharMap QTrans)
-&gt; ([Char] -&gt; IntMap QTrans) -&gt; [Char] -&gt; CharMap QTrans
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(Key, QTrans)] -&gt; IntMap QTrans
forall a. [(Key, a)] -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.fromDistinctAscList</span></span><span> </span><span class="annot"><span class="annottext">([(Key, QTrans)] -&gt; IntMap QTrans)
-&gt; ([Char] -&gt; [(Key, QTrans)]) -&gt; [Char] -&gt; IntMap QTrans
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; (Key, QTrans)) -&gt; [Char] -&gt; [(Key, QTrans)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679113625"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679113625"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Key
</span><span class="hs-identifier hs-var">ord</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679113625"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113623"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-765"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap QTrans -&gt; CharMap QTrans
forall a. IntMap a -&gt; CharMap a
</span><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-var">CharMap</span></a></span><span> </span><span class="annot"><span class="annottext">(IntMap QTrans -&gt; CharMap QTrans)
-&gt; ([Char] -&gt; IntMap QTrans) -&gt; [Char] -&gt; CharMap QTrans
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(Key, QTrans)] -&gt; IntMap QTrans
forall a. [(Key, a)] -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Key, QTrans)] -&gt; IntMap QTrans)
-&gt; ([Char] -&gt; [(Key, QTrans)]) -&gt; [Char] -&gt; IntMap QTrans
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([(Key, QTrans)] -&gt; [(Key, QTrans)])
-&gt; [(Key, QTrans)] -&gt; [(Key, QTrans)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-766"></span><span>                               </span><span class="annot"><span class="annottext">(([(Key, QTrans)] -&gt; [(Key, QTrans)]) -&gt; [(Key, QTrans)])
-&gt; ([Char] -&gt; [(Key, QTrans)] -&gt; [(Key, QTrans)])
-&gt; [Char]
-&gt; [(Key, QTrans)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Char
 -&gt; ([(Key, QTrans)] -&gt; [(Key, QTrans)])
 -&gt; [(Key, QTrans)]
 -&gt; [(Key, QTrans)])
-&gt; ([(Key, QTrans)] -&gt; [(Key, QTrans)])
-&gt; [Char]
-&gt; [(Key, QTrans)]
-&gt; [(Key, QTrans)]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679113626"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679113626"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679113627"><span class="annot"><span class="annottext">[(Key, QTrans)] -&gt; [(Key, QTrans)]
</span><a href="#local-6989586621679113627"><span class="hs-identifier hs-var">dl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isAlpha</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679113626"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-767"></span><span>                                                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Key, QTrans)] -&gt; [(Key, QTrans)]
</span><a href="#local-6989586621679113627"><span class="hs-identifier hs-var">dl</span></a></span><span class="annot"><span class="annottext">([(Key, QTrans)] -&gt; [(Key, QTrans)])
-&gt; ([(Key, QTrans)] -&gt; [(Key, QTrans)])
-&gt; [(Key, QTrans)]
-&gt; [(Key, QTrans)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Key
</span><span class="hs-identifier hs-var">ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char
</span><span class="hs-identifier hs-var">toUpper</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679113626"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113623"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Key, QTrans) -&gt; [(Key, QTrans)] -&gt; [(Key, QTrans)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-768"></span><span>                                                           </span><span class="annot"><span class="annottext">([(Key, QTrans)] -&gt; [(Key, QTrans)])
-&gt; ([(Key, QTrans)] -&gt; [(Key, QTrans)])
-&gt; [(Key, QTrans)]
-&gt; [(Key, QTrans)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Key
</span><span class="hs-identifier hs-var">ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char
</span><span class="hs-identifier hs-var">toLower</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679113626"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113623"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Key, QTrans) -&gt; [(Key, QTrans)] -&gt; [(Key, QTrans)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-769"></span><span>                                                        </span><span class="hs-special">)</span><span>
</span><span id="line-770"></span><span>                                                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Key, QTrans)] -&gt; [(Key, QTrans)]
</span><a href="#local-6989586621679113627"><span class="hs-identifier hs-var">dl</span></a></span><span class="annot"><span class="annottext">([(Key, QTrans)] -&gt; [(Key, QTrans)])
-&gt; ([(Key, QTrans)] -&gt; [(Key, QTrans)])
-&gt; [(Key, QTrans)]
-&gt; [(Key, QTrans)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Key
</span><span class="hs-identifier hs-var">ord</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679113626"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113623"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Key, QTrans) -&gt; [(Key, QTrans)] -&gt; [(Key, QTrans)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-771"></span><span>                                       </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Key, QTrans)] -&gt; [(Key, QTrans)]
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-772"></span><span>      </span><span id="local-6989586621679113622"><span class="annot"><span class="annottext">addNewline :: Set Char -&gt; Set Char
</span><a href="#local-6989586621679113622"><span class="hs-identifier hs-var hs-var">addNewline</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CompOption -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#multiline"><span class="hs-identifier hs-var">multiline</span></a></span><span> </span><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621679113394"><span class="hs-identifier hs-var">compOpt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Set Char -&gt; Set Char
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.insert</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\n'</span></span><span>
</span><span id="line-773"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Char -&gt; Set Char
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-774"></span><span>      </span><span id="local-6989586621679113614"><span class="annot"><span class="annottext">dotTrans :: CharMap QTrans
</span><a href="#local-6989586621679113614"><span class="hs-identifier hs-var hs-var">dotTrans</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CompOption -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#multiline"><span class="hs-identifier hs-var">multiline</span></a></span><span> </span><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621679113394"><span class="hs-identifier hs-var">compOpt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; QTrans -&gt; CharMap QTrans
forall a. Char -&gt; a -&gt; CharMap a
</span><a href="Data.IntMap.CharMap2.html#singleton"><span class="hs-identifier hs-var">Map.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\n'</span></span><span> </span><span class="annot"><span class="annottext">QTrans
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-775"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CharMap QTrans
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">Mon.mempty</span></span><span>
</span><span id="line-776"></span><span>
</span><span id="line-777"></span><span class="hs-comment">{-

prepend architecture becomes
prependTags :: TagTask -&gt; [Tag] -&gt; QT -&gt; QT
which always uses PreUpdate and the same task for all the tags

qt_win seems to only allow PreUpdate so why keep the same type?


ADD ORPHAN ID check and make this a fatal error while testing

-}</span><span>
</span><span id="line-789"></span></pre></body></html>