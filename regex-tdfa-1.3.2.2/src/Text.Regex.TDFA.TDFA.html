<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | &quot;Text.Regex.TDFA.TDFA&quot; converts the QNFA from TNFA into the DFA.</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- A DFA state corresponds to a Set of QNFA states, represented as list</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- of Index which are used to lookup the DFA state in a lazy Trie</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- which holds all possible subsets of QNFA states.</span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Text.Regex.TDFA.TDFA</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#patternToRegex"><span class="hs-identifier">patternToRegex</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DFA"><span class="hs-identifier">DFA</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DT"><span class="hs-identifier">DT</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span>                            </span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#examineDFA"><span class="hs-identifier">examineDFA</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#nfaToDFA"><span class="hs-identifier">nfaToDFA</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#dfaMap"><span class="hs-identifier">dfaMap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-comment">--import Control.Arrow((***))</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Mon</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Monoid</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">State</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">MonadState</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">execState</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Array.IArray</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Array</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-operator">(!)</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">bounds</span></span><span class="hs-special">,</span><span class="hs-comment">{-assocs-}</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IntMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IMap</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">empty</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">keys</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">delete</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">lookup</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">fromDistinctAscList</span></span><span>
</span><span id="line-14"></span><span>                                    </span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">member</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">unionWith</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">singleton</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">union</span></span><span>
</span><span id="line-15"></span><span>                                    </span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">toAscList</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">Key</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">elems</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">toList</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">insert</span></span><span>
</span><span id="line-16"></span><span>                                    </span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">insertWith</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">insertWithKey</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.IntMap.CharMap2.html"><span class="hs-identifier">Data.IntMap.CharMap2</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier">CharMap</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.IntMap.CharMap2.html"><span class="hs-identifier">Data.IntMap.CharMap2</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">(</span><span class="annot"><a href="Data.IntMap.CharMap2.html#empty"><span class="hs-identifier">empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-comment">--import Data.IntSet(IntSet)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntSet</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ISet</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">empty</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">singleton</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldl'</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">empty</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">member</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">insert</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">elems</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(|&gt;)</span></span><span class="hs-special">,</span><span class="hs-comment">{-viewl,ViewL(..)-}</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html"><span class="hs-identifier">Text.Regex.TDFA.Common</span></a></span><span> </span><span class="hs-comment">{- all -}</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.IntArrTrieSet.html"><span class="hs-identifier">Text.Regex.TDFA.IntArrTrieSet</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.IntArrTrieSet.html#TrieSet"><span class="hs-identifier">TrieSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.IntArrTrieSet.html"><span class="hs-identifier">Text.Regex.TDFA.IntArrTrieSet</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Trie</span></span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.IntArrTrieSet.html#lookupAsc"><span class="hs-identifier">lookupAsc</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.IntArrTrieSet.html#fromSinglesMerge"><span class="hs-identifier">fromSinglesMerge</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html"><span class="hs-identifier">Text.Regex.TDFA.Pattern</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#Pattern"><span class="hs-identifier">Pattern</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-comment">--import Text.Regex.TDFA.RunMutState(toInstructions)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html"><span class="hs-identifier">Text.Regex.TDFA.TNFA</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.TNFA.html#patternToNFA"><span class="hs-identifier">patternToNFA</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-comment">--import Debug.Trace</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-comment">{- By Chris Kuklewicz, 2007. BSD License, see the LICENSE file. -}</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span id="local-6989586621679113663"><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#err"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679113663"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-36"></span><span id="err"><span class="annot"><span class="annottext">err :: forall a. String -&gt; a
</span><a href="Text.Regex.TDFA.TDFA.html#err"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span id="local-6989586621679113893"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113893"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; a
forall a. String -&gt; String -&gt; a
</span><a href="Text.Regex.TDFA.Common.html#common_error"><span class="hs-identifier hs-var">common_error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Text.Regex.TDFA.TDFA&quot;</span></span><span>  </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679113893"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#dlose"><span class="hs-identifier hs-type">dlose</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DFA"><span class="hs-identifier hs-type">DFA</span></a></span><span>
</span><span id="line-39"></span><span id="dlose"><span class="annot"><span class="annottext">dlose :: DFA
</span><a href="Text.Regex.TDFA.TDFA.html#dlose"><span class="hs-identifier hs-var hs-var">dlose</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DFA"><span class="hs-identifier hs-type">DFA</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">d_id :: SetIndex
</span><a href="Text.Regex.TDFA.Common.html#d_id"><span class="hs-identifier hs-var">d_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><span class="hs-identifier hs-var">ISet.empty</span></span><span>
</span><span id="line-40"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">d_dt :: DT
</span><a href="Text.Regex.TDFA.Common.html#d_dt"><span class="hs-identifier hs-var">d_dt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple%27"><span class="hs-identifier hs-type">Simple'</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dt_win :: IntMap Instructions
</span><a href="Text.Regex.TDFA.Common.html#dt_win"><span class="hs-identifier hs-var">dt_win</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap Instructions
forall a. IntMap a
</span><span class="hs-identifier hs-var">IMap.empty</span></span><span>
</span><span id="line-41"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dt_trans :: CharMap Transition
</span><a href="Text.Regex.TDFA.Common.html#dt_trans"><span class="hs-identifier hs-var">dt_trans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CharMap Transition
forall a. CharMap a
</span><a href="Data.IntMap.CharMap2.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span>
</span><span id="line-42"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dt_other :: Transition
</span><a href="Text.Regex.TDFA.Common.html#dt_other"><span class="hs-identifier hs-var">dt_other</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DFA -&gt; DFA -&gt; DTrans -&gt; Transition
</span><a href="Text.Regex.TDFA.Common.html#Transition"><span class="hs-identifier hs-var">Transition</span></a></span><span> </span><span class="annot"><span class="annottext">DFA
</span><a href="Text.Regex.TDFA.TDFA.html#dlose"><span class="hs-identifier hs-var">dlose</span></a></span><span> </span><span class="annot"><span class="annottext">DFA
</span><a href="Text.Regex.TDFA.TDFA.html#dlose"><span class="hs-identifier hs-var">dlose</span></a></span><span> </span><span class="annot"><span class="annottext">DTrans
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-comment">-- dumb smart constructor for tracing construction (I wanted to monitor laziness)</span><span>
</span><span id="line-45"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#makeDFA"><span class="hs-pragma hs-type">makeDFA</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-46"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#makeDFA"><span class="hs-identifier hs-type">makeDFA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#SetIndex"><span class="hs-identifier hs-type">SetIndex</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DT"><span class="hs-identifier hs-type">DT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DFA"><span class="hs-identifier hs-type">DFA</span></a></span><span>
</span><span id="line-47"></span><span id="makeDFA"><span class="annot"><span class="annottext">makeDFA :: SetIndex -&gt; DT -&gt; DFA
</span><a href="Text.Regex.TDFA.TDFA.html#makeDFA"><span class="hs-identifier hs-var hs-var">makeDFA</span></a></span></span><span> </span><span id="local-6989586621679113905"><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679113905"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679113906"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679113906"><span class="hs-identifier hs-var">dt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SetIndex -&gt; DT -&gt; DFA
</span><a href="Text.Regex.TDFA.Common.html#DFA"><span class="hs-identifier hs-var">DFA</span></a></span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679113905"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679113906"><span class="hs-identifier hs-var">dt</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">-- Note that no CompOption or ExecOption parameter is needed.</span><span>
</span><span id="line-50"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#nfaToDFA"><span class="hs-identifier hs-type">nfaToDFA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#OP"><span class="hs-identifier hs-type">OP</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupIndex"><span class="hs-identifier hs-type">GroupIndex</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupInfo"><span class="hs-identifier hs-type">GroupInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#CompOption"><span class="hs-identifier hs-type">CompOption</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#ExecOption"><span class="hs-identifier hs-type">ExecOption</span></a></span><span>
</span><span id="line-52"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Regex"><span class="hs-identifier hs-type">Regex</span></a></span><span>
</span><span id="line-53"></span><span id="nfaToDFA"><span class="annot"><span class="annottext">nfaToDFA :: ((Position, Array Position QNFA), Array Position OP,
 Array Position [GroupInfo])
-&gt; CompOption -&gt; ExecOption -&gt; Regex
</span><a href="Text.Regex.TDFA.TDFA.html#nfaToDFA"><span class="hs-identifier hs-var hs-var">nfaToDFA</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679113910"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679113910"><span class="hs-identifier hs-var">startIndex</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113911"><span class="annot"><span class="annottext">Array Position QNFA
</span><a href="#local-6989586621679113911"><span class="hs-identifier hs-var">aQNFA</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679113912"><span class="annot"><span class="annottext">Array Position OP
</span><a href="#local-6989586621679113912"><span class="hs-identifier hs-var">aTagOp</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679113913"><span class="annot"><span class="annottext">Array Position [GroupInfo]
</span><a href="#local-6989586621679113913"><span class="hs-identifier hs-var">aGroupInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679113914"><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621679113914"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621679113915"><span class="annot"><span class="annottext">ExecOption
</span><a href="#local-6989586621679113915"><span class="hs-identifier hs-var">eo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DFA
-&gt; Position
-&gt; (Position, Position)
-&gt; (Position, Position)
-&gt; TrieSet DFA
-&gt; Array Position OP
-&gt; Array Position [GroupInfo]
-&gt; Bool
-&gt; CompOption
-&gt; ExecOption
-&gt; Regex
</span><a href="Text.Regex.TDFA.Common.html#Regex"><span class="hs-identifier hs-var">Regex</span></a></span><span> </span><span class="annot"><span class="annottext">DFA
</span><a href="#local-6989586621679113917"><span class="hs-identifier hs-var">dfa</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679113910"><span class="hs-identifier hs-var">startIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(Position, Position)
</span><a href="#local-6989586621679113918"><span class="hs-identifier hs-var">indexBounds</span></a></span><span> </span><span class="annot"><span class="annottext">(Position, Position)
</span><a href="#local-6989586621679113919"><span class="hs-identifier hs-var">tagBounds</span></a></span><span> </span><span class="annot"><span class="annottext">TrieSet DFA
</span><a href="#local-6989586621679113920"><span class="hs-identifier hs-var">trie</span></a></span><span> </span><span class="annot"><span class="annottext">Array Position OP
</span><a href="#local-6989586621679113912"><span class="hs-identifier hs-var">aTagOp</span></a></span><span> </span><span class="annot"><span class="annottext">Array Position [GroupInfo]
</span><a href="#local-6989586621679113913"><span class="hs-identifier hs-var">aGroupInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679113921"><span class="hs-identifier hs-var">ifa</span></a></span><span> </span><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621679113914"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">ExecOption
</span><a href="#local-6989586621679113915"><span class="hs-identifier hs-var">eo</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-54"></span><span>  </span><span id="local-6989586621679113917"><span class="annot"><span class="annottext">dfa :: DFA
</span><a href="#local-6989586621679113917"><span class="hs-identifier hs-var hs-var">dfa</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Position] -&gt; DFA
</span><a href="#local-6989586621679113922"><span class="hs-identifier hs-var">indexesToDFA</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679113910"><span class="hs-identifier hs-var">startIndex</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-55"></span><span>  </span><span id="local-6989586621679113918"><span class="annot"><span class="annottext">indexBounds :: (Position, Position)
</span><a href="#local-6989586621679113918"><span class="hs-identifier hs-var hs-var">indexBounds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array Position QNFA -&gt; (Position, Position)
forall i. Ix i =&gt; Array i QNFA -&gt; (i, i)
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; (i, i)
</span><span class="hs-identifier hs-var">bounds</span></span><span> </span><span class="annot"><span class="annottext">Array Position QNFA
</span><a href="#local-6989586621679113911"><span class="hs-identifier hs-var">aQNFA</span></a></span><span>
</span><span id="line-56"></span><span>  </span><span id="local-6989586621679113919"><span class="annot"><span class="annottext">tagBounds :: (Position, Position)
</span><a href="#local-6989586621679113919"><span class="hs-identifier hs-var hs-var">tagBounds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array Position OP -&gt; (Position, Position)
forall i. Ix i =&gt; Array i OP -&gt; (i, i)
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; (i, i)
</span><span class="hs-identifier hs-var">bounds</span></span><span> </span><span class="annot"><span class="annottext">Array Position OP
</span><a href="#local-6989586621679113912"><span class="hs-identifier hs-var">aTagOp</span></a></span><span>
</span><span id="line-57"></span><span>  </span><span id="local-6989586621679113921"><span class="annot"><span class="annottext">ifa :: Bool
</span><a href="#local-6989586621679113921"><span class="hs-identifier hs-var hs-var">ifa</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompOption -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#multiline"><span class="hs-identifier hs-var">multiline</span></a></span><span> </span><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621679113914"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">DFA -&gt; Bool
</span><a href="Text.Regex.TDFA.TDFA.html#isDFAFrontAnchored"><span class="hs-identifier hs-var">isDFAFrontAnchored</span></a></span><span> </span><span class="annot"><span class="annottext">DFA
</span><a href="#local-6989586621679113917"><span class="hs-identifier hs-var">dfa</span></a></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span>  </span><span id="local-6989586621679113922"><span class="annot"><span class="annottext">indexesToDFA :: [Position] -&gt; DFA
</span><a href="#local-6989586621679113922"><span class="hs-identifier hs-var hs-var">indexesToDFA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;nfaToDFA.indexesToDFA&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><span class="annottext">TrieSet DFA -&gt; [Position] -&gt; DFA
forall v. TrieSet v -&gt; [Position] -&gt; v
</span><a href="Text.Regex.TDFA.IntArrTrieSet.html#lookupAsc"><span class="hs-identifier hs-var">Trie.lookupAsc</span></a></span><span> </span><span class="annot"><span class="annottext">TrieSet DFA
</span><a href="#local-6989586621679113920"><span class="hs-identifier hs-var">trie</span></a></span><span>  </span><span class="hs-comment">-- Lookup in cache</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><a href="#local-6989586621679113920"><span class="hs-identifier hs-type">trie</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.IntArrTrieSet.html#TrieSet"><span class="hs-identifier hs-type">TrieSet</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DFA"><span class="hs-identifier hs-type">DFA</span></a></span><span>
</span><span id="line-62"></span><span>  </span><span id="local-6989586621679113920"><span class="annot"><span class="annottext">trie :: TrieSet DFA
</span><a href="#local-6989586621679113920"><span class="hs-identifier hs-var hs-var">trie</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DFA
-&gt; (DFA -&gt; DFA -&gt; DFA)
-&gt; (Position, Position)
-&gt; (Position -&gt; DFA)
-&gt; TrieSet DFA
forall v.
v
-&gt; (v -&gt; v -&gt; v)
-&gt; (Position, Position)
-&gt; (Position -&gt; v)
-&gt; TrieSet v
</span><a href="Text.Regex.TDFA.IntArrTrieSet.html#fromSinglesMerge"><span class="hs-identifier hs-var">Trie.fromSinglesMerge</span></a></span><span> </span><span class="annot"><span class="annottext">DFA
</span><a href="Text.Regex.TDFA.TDFA.html#dlose"><span class="hs-identifier hs-var">dlose</span></a></span><span> </span><span class="annot"><span class="annottext">DFA -&gt; DFA -&gt; DFA
</span><a href="#local-6989586621679113931"><span class="hs-identifier hs-var">mergeDFA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array Position QNFA -&gt; (Position, Position)
forall i. Ix i =&gt; Array i QNFA -&gt; (i, i)
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; (i, i)
</span><span class="hs-identifier hs-var">bounds</span></span><span> </span><span class="annot"><span class="annottext">Array Position QNFA
</span><a href="#local-6989586621679113911"><span class="hs-identifier hs-var">aQNFA</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Position -&gt; DFA
</span><a href="#local-6989586621679113932"><span class="hs-identifier hs-var">indexToDFA</span></a></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="#local-6989586621679113933"><span class="hs-identifier hs-type">newTransition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DTrans"><span class="hs-identifier hs-type">DTrans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span>
</span><span id="line-65"></span><span>  </span><span id="local-6989586621679113933"><span class="annot"><span class="annottext">newTransition :: DTrans -&gt; Transition
</span><a href="#local-6989586621679113933"><span class="hs-identifier hs-var hs-var">newTransition</span></a></span></span><span> </span><span id="local-6989586621679113934"><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679113934"><span class="hs-identifier hs-var">dtrans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">trans_many :: DFA
</span><a href="Text.Regex.TDFA.Common.html#trans_many"><span class="hs-identifier hs-var">trans_many</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Position] -&gt; DFA
</span><a href="#local-6989586621679113922"><span class="hs-identifier hs-var">indexesToDFA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DTrans -&gt; [Position]
forall a. IntMap a -&gt; [Position]
</span><span class="hs-identifier hs-var">IMap.keys</span></span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679113936"><span class="hs-identifier hs-var">dtransWithSpawn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">trans_single :: DFA
</span><a href="Text.Regex.TDFA.Common.html#trans_single"><span class="hs-identifier hs-var">trans_single</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Position] -&gt; DFA
</span><a href="#local-6989586621679113922"><span class="hs-identifier hs-var">indexesToDFA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DTrans -&gt; [Position]
forall a. IntMap a -&gt; [Position]
</span><span class="hs-identifier hs-var">IMap.keys</span></span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679113934"><span class="hs-identifier hs-var">dtrans</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">trans_how :: DTrans
</span><a href="Text.Regex.TDFA.Common.html#trans_how"><span class="hs-identifier hs-var">trans_how</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679113936"><span class="hs-identifier hs-var">dtransWithSpawn</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679113936"><span class="annot"><span class="annottext">dtransWithSpawn :: DTrans
</span><a href="#local-6989586621679113936"><span class="hs-identifier hs-var hs-var">dtransWithSpawn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DTrans -&gt; DTrans
</span><a href="#local-6989586621679113939"><span class="hs-identifier hs-var">addSpawn</span></a></span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679113934"><span class="hs-identifier hs-var">dtrans</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><a href="#local-6989586621679113940"><span class="hs-identifier hs-type">makeTransition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DTrans"><span class="hs-identifier hs-type">DTrans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span id="local-6989586621679113940"><span class="annot"><span class="annottext">makeTransition :: DTrans -&gt; Transition
</span><a href="#local-6989586621679113940"><span class="hs-identifier hs-var hs-var">makeTransition</span></a></span></span><span> </span><span id="local-6989586621679113941"><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679113941"><span class="hs-identifier hs-var">dtrans</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679113942"><span class="hs-identifier hs-var">hasSpawn</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">trans_many :: DFA
</span><a href="Text.Regex.TDFA.Common.html#trans_many"><span class="hs-identifier hs-var">trans_many</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Position] -&gt; DFA
</span><a href="#local-6989586621679113922"><span class="hs-identifier hs-var">indexesToDFA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DTrans -&gt; [Position]
forall a. IntMap a -&gt; [Position]
</span><span class="hs-identifier hs-var">IMap.keys</span></span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679113941"><span class="hs-identifier hs-var">dtrans</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>                                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">trans_single :: DFA
</span><a href="Text.Regex.TDFA.Common.html#trans_single"><span class="hs-identifier hs-var">trans_single</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Position] -&gt; DFA
</span><a href="#local-6989586621679113922"><span class="hs-identifier hs-var">indexesToDFA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DTrans -&gt; [Position]
forall a. IntMap a -&gt; [Position]
</span><span class="hs-identifier hs-var">IMap.keys</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position -&gt; DTrans -&gt; DTrans
forall a. Position -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.delete</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679113910"><span class="hs-identifier hs-var">startIndex</span></a></span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679113941"><span class="hs-identifier hs-var">dtrans</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>                                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">trans_how :: DTrans
</span><a href="Text.Regex.TDFA.Common.html#trans_how"><span class="hs-identifier hs-var">trans_how</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679113941"><span class="hs-identifier hs-var">dtrans</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-74"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">trans_many :: DFA
</span><a href="Text.Regex.TDFA.Common.html#trans_many"><span class="hs-identifier hs-var">trans_many</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Position] -&gt; DFA
</span><a href="#local-6989586621679113922"><span class="hs-identifier hs-var">indexesToDFA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DTrans -&gt; [Position]
forall a. IntMap a -&gt; [Position]
</span><span class="hs-identifier hs-var">IMap.keys</span></span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679113941"><span class="hs-identifier hs-var">dtrans</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>                                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">trans_single :: DFA
</span><a href="Text.Regex.TDFA.Common.html#trans_single"><span class="hs-identifier hs-var">trans_single</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Position] -&gt; DFA
</span><a href="#local-6989586621679113922"><span class="hs-identifier hs-var">indexesToDFA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DTrans -&gt; [Position]
forall a. IntMap a -&gt; [Position]
</span><span class="hs-identifier hs-var">IMap.keys</span></span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679113941"><span class="hs-identifier hs-var">dtrans</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>                                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">trans_how :: DTrans
</span><a href="Text.Regex.TDFA.Common.html#trans_how"><span class="hs-identifier hs-var">trans_how</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679113941"><span class="hs-identifier hs-var">dtrans</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679113942"><span class="annot"><span class="annottext">hasSpawn :: Bool
</span><a href="#local-6989586621679113942"><span class="hs-identifier hs-var hs-var">hasSpawn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; (IntMap (DoPa, Instructions) -&gt; Bool)
-&gt; Maybe (IntMap (DoPa, Instructions))
-&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">IntMap (DoPa, Instructions) -&gt; Bool
forall a. IntMap a -&gt; Bool
</span><span class="hs-identifier hs-var">IMap.null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position -&gt; DTrans -&gt; Maybe (IntMap (DoPa, Instructions))
forall a. Position -&gt; IntMap a -&gt; Maybe a
</span><span class="hs-identifier hs-var">IMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679113910"><span class="hs-identifier hs-var">startIndex</span></a></span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679113941"><span class="hs-identifier hs-var">dtrans</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-comment">-- coming from (-1) means spawn a new starting item</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><a href="#local-6989586621679113939"><span class="hs-identifier hs-type">addSpawn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DTrans"><span class="hs-identifier hs-type">DTrans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DTrans"><span class="hs-identifier hs-type">DTrans</span></a></span><span>
</span><span id="line-81"></span><span>  </span><span id="local-6989586621679113939"><span class="annot"><span class="annottext">addSpawn :: DTrans -&gt; DTrans
</span><a href="#local-6989586621679113939"><span class="hs-identifier hs-var hs-var">addSpawn</span></a></span></span><span> </span><span id="local-6989586621679113944"><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679113944"><span class="hs-identifier hs-var">dtrans</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Position -&gt; DTrans -&gt; Bool
forall a. Position -&gt; IntMap a -&gt; Bool
</span><span class="hs-identifier hs-var">IMap.member</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679113910"><span class="hs-identifier hs-var">startIndex</span></a></span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679113944"><span class="hs-identifier hs-var">dtrans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679113944"><span class="hs-identifier hs-var">dtrans</span></a></span><span>
</span><span id="line-82"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; IntMap (DoPa, Instructions) -&gt; DTrans -&gt; DTrans
forall a. Position -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.insert</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679113910"><span class="hs-identifier hs-var">startIndex</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap (DoPa, Instructions)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679113944"><span class="hs-identifier hs-var">dtrans</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span>  </span><span class="annot"><a href="#local-6989586621679113932"><span class="hs-identifier hs-type">indexToDFA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DFA"><span class="hs-identifier hs-type">DFA</span></a></span><span>  </span><span class="hs-comment">-- used to seed the Trie from the NFA</span><span>
</span><span id="line-85"></span><span>  </span><span id="local-6989586621679113932"><span class="annot"><span class="annottext">indexToDFA :: Position -&gt; DFA
</span><a href="#local-6989586621679113932"><span class="hs-identifier hs-var hs-var">indexToDFA</span></a></span></span><span> </span><span id="local-6989586621679113945"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679113945"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;nfaToDFA.indexToDFA&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><span class="annottext">SetIndex -&gt; DT -&gt; DFA
</span><a href="Text.Regex.TDFA.TDFA.html#makeDFA"><span class="hs-identifier hs-var">makeDFA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position -&gt; SetIndex
</span><span class="hs-identifier hs-var">ISet.singleton</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679113946"><span class="hs-identifier hs-var">source</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QT -&gt; DT
</span><a href="#local-6989586621679113947"><span class="hs-identifier hs-var">qtToDT</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113948"><span class="hs-identifier hs-var">qtIn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-87"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">q_id :: QNFA -&gt; Position
</span><a href="Text.Regex.TDFA.Common.html#q_id"><span class="hs-identifier hs-var">q_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679113946"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679113946"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">q_qt :: QNFA -&gt; QT
</span><a href="Text.Regex.TDFA.Common.html#q_qt"><span class="hs-identifier hs-var">q_qt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679113948"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113948"><span class="hs-identifier hs-var">qtIn</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array Position QNFA
</span><a href="#local-6989586621679113911"><span class="hs-identifier hs-var">aQNFA</span></a></span><span class="annot"><span class="annottext">Array Position QNFA -&gt; Position -&gt; QNFA
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679113945"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-88"></span><span>      </span><span class="annot"><a href="#local-6989586621679113947"><span class="hs-identifier hs-type">qtToDT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DT"><span class="hs-identifier hs-type">DT</span></a></span><span>
</span><span id="line-89"></span><span>      </span><span id="local-6989586621679113947"><span class="annot"><span class="annottext">qtToDT :: QT -&gt; DT
</span><a href="#local-6989586621679113947"><span class="hs-identifier hs-var hs-var">qtToDT</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-type">Testing</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">qt_test :: QT -&gt; WhichTest
</span><a href="Text.Regex.TDFA.Common.html#qt_test"><span class="hs-identifier hs-var">qt_test</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113956"><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113956"><span class="hs-identifier hs-var">wt</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qt_dopas :: QT -&gt; EnumSet DoPa
</span><a href="Text.Regex.TDFA.Common.html#qt_dopas"><span class="hs-identifier hs-var">qt_dopas</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113958"><span class="annot"><span class="annottext">EnumSet DoPa
</span><a href="#local-6989586621679113958"><span class="hs-identifier hs-var">dopas</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qt_a :: QT -&gt; QT
</span><a href="Text.Regex.TDFA.Common.html#qt_a"><span class="hs-identifier hs-var">qt_a</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113960"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113960"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qt_b :: QT -&gt; QT
</span><a href="Text.Regex.TDFA.Common.html#qt_b"><span class="hs-identifier hs-var">qt_b</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113962"><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113962"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-90"></span><span>          </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing%27"><span class="hs-identifier hs-type">Testing'</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dt_test :: WhichTest
</span><a href="Text.Regex.TDFA.Common.html#dt_test"><span class="hs-identifier hs-var">dt_test</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679113956"><span class="hs-identifier hs-var">wt</span></a></span><span>
</span><span id="line-91"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dt_dopas :: EnumSet DoPa
</span><a href="Text.Regex.TDFA.Common.html#dt_dopas"><span class="hs-identifier hs-var">dt_dopas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EnumSet DoPa
</span><a href="#local-6989586621679113958"><span class="hs-identifier hs-var">dopas</span></a></span><span>
</span><span id="line-92"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dt_a :: DT
</span><a href="Text.Regex.TDFA.Common.html#dt_a"><span class="hs-identifier hs-var">dt_a</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT -&gt; DT
</span><a href="#local-6989586621679113947"><span class="hs-identifier hs-var">qtToDT</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113960"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-93"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dt_b :: DT
</span><a href="Text.Regex.TDFA.Common.html#dt_b"><span class="hs-identifier hs-var">dt_b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QT -&gt; DT
</span><a href="#local-6989586621679113947"><span class="hs-identifier hs-var">qtToDT</span></a></span><span> </span><span class="annot"><span class="annottext">QT
</span><a href="#local-6989586621679113962"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-94"></span><span>      </span><span class="annot"><a href="#local-6989586621679113947"><span class="hs-identifier hs-var">qtToDT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-type">Simple</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">qt_win :: QT -&gt; WinTags
</span><a href="Text.Regex.TDFA.Common.html#qt_win"><span class="hs-identifier hs-var">qt_win</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113970"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113970"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qt_trans :: QT -&gt; CharMap QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_trans"><span class="hs-identifier hs-var">qt_trans</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113972"><span class="annot"><span class="annottext">CharMap QTrans
</span><a href="#local-6989586621679113972"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qt_other :: QT -&gt; QTrans
</span><a href="Text.Regex.TDFA.Common.html#qt_other"><span class="hs-identifier hs-var">qt_other</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679113974"><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113974"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-95"></span><span>        </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple%27"><span class="hs-identifier hs-type">Simple'</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dt_win :: IntMap Instructions
</span><a href="Text.Regex.TDFA.Common.html#dt_win"><span class="hs-identifier hs-var">dt_win</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap Instructions
</span><a href="#local-6989586621679113975"><span class="hs-identifier hs-var">makeWinner</span></a></span><span>
</span><span id="line-96"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dt_trans :: CharMap Transition
</span><a href="Text.Regex.TDFA.Common.html#dt_trans"><span class="hs-identifier hs-var">dt_trans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(QTrans -&gt; Transition) -&gt; CharMap QTrans -&gt; CharMap Transition
forall a b. (a -&gt; b) -&gt; CharMap a -&gt; CharMap b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">QTrans -&gt; Transition
</span><a href="#local-6989586621679113976"><span class="hs-identifier hs-var">qtransToDFA</span></a></span><span> </span><span class="annot"><span class="annottext">CharMap QTrans
</span><a href="#local-6989586621679113972"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-97"></span><span class="hs-comment">--                , dt_other = if IMap.null o then Just (newTransition $ IMap.singleton startIndex mempty) else Just (qtransToDFA o)}</span><span>
</span><span id="line-98"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dt_other :: Transition
</span><a href="Text.Regex.TDFA.Common.html#dt_other"><span class="hs-identifier hs-var">dt_other</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTrans -&gt; Transition
</span><a href="#local-6989586621679113976"><span class="hs-identifier hs-var">qtransToDFA</span></a></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113974"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-99"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-100"></span><span>          </span><span class="annot"><a href="#local-6989586621679113975"><span class="hs-identifier hs-type">makeWinner</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap</span></span><span> </span><span class="hs-comment">{- Index -}</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Instructions"><span class="hs-identifier hs-type">Instructions</span></a></span><span> </span><span class="hs-comment">--  (RunState ())</span><span>
</span><span id="line-101"></span><span>          </span><span id="local-6989586621679113975"><span class="annot"><span class="annottext">makeWinner :: IntMap Instructions
</span><a href="#local-6989586621679113975"><span class="hs-identifier hs-var hs-var">makeWinner</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">WinTags -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#noWin"><span class="hs-identifier hs-var">noWin</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113970"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap Instructions
forall a. IntMap a
</span><span class="hs-identifier hs-var">IMap.empty</span></span><span>
</span><span id="line-102"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; Instructions -&gt; IntMap Instructions
forall a. Position -&gt; a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.singleton</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679113946"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WinTags -&gt; Instructions
</span><a href="Text.Regex.TDFA.TDFA.html#cleanWin"><span class="hs-identifier hs-var">cleanWin</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679113970"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span>          </span><span class="annot"><a href="#local-6989586621679113976"><span class="hs-identifier hs-type">qtransToDFA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier hs-type">QTrans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span>
</span><span id="line-105"></span><span>          </span><span id="local-6989586621679113976"><span class="annot"><span class="annottext">qtransToDFA :: QTrans -&gt; Transition
</span><a href="#local-6989586621679113976"><span class="hs-identifier hs-var hs-var">qtransToDFA</span></a></span></span><span> </span><span id="local-6989586621679113979"><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113979"><span class="hs-identifier hs-var">qtrans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;nfaToDFA.indexToDFA.qtransToDFA&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-106"></span><span>                               </span><span class="annot"><span class="annottext">DTrans -&gt; Transition
</span><a href="#local-6989586621679113933"><span class="hs-identifier hs-var">newTransition</span></a></span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679113980"><span class="hs-identifier hs-var">dtrans</span></a></span><span>
</span><span id="line-107"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-108"></span><span>              </span><span class="annot"><a href="#local-6989586621679113980"><span class="hs-identifier hs-type">dtrans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DTrans"><span class="hs-identifier hs-type">DTrans</span></a></span><span>
</span><span id="line-109"></span><span>              </span><span id="local-6989586621679113980"><span class="annot"><span class="annottext">dtrans :: DTrans
</span><a href="#local-6989586621679113980"><span class="hs-identifier hs-var hs-var">dtrans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">[(Position, IntMap (DoPa, Instructions))] -&gt; DTrans
forall a. [(Position, a)] -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.fromDistinctAscList</span></span><span> </span><span class="annot"><span class="annottext">([(Position, IntMap (DoPa, Instructions))] -&gt; DTrans)
-&gt; ([(Position, (DoPa, Instructions))]
    -&gt; [(Position, IntMap (DoPa, Instructions))])
-&gt; [(Position, (DoPa, Instructions))]
-&gt; DTrans
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((DoPa, Instructions) -&gt; IntMap (DoPa, Instructions))
-&gt; [(Position, (DoPa, Instructions))]
-&gt; [(Position, IntMap (DoPa, Instructions))]
forall (f :: * -&gt; *) t1 t2 t.
Functor f =&gt;
(t1 -&gt; t2) -&gt; f (t, t1) -&gt; f (t, t2)
</span><a href="Text.Regex.TDFA.Common.html#mapSnd"><span class="hs-identifier hs-var">mapSnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position -&gt; (DoPa, Instructions) -&gt; IntMap (DoPa, Instructions)
forall a. Position -&gt; a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.singleton</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679113946"><span class="hs-identifier hs-var">source</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Position, (DoPa, Instructions))] -&gt; DTrans)
-&gt; [(Position, (DoPa, Instructions))] -&gt; DTrans
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Position, (DoPa, Instructions))]
</span><a href="#local-6989586621679113983"><span class="hs-identifier hs-var">best</span></a></span><span>
</span><span id="line-110"></span><span>              </span><span class="annot"><a href="#local-6989586621679113983"><span class="hs-identifier hs-type">best</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-comment">{- Destination -}</span><span> </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DoPa"><span class="hs-identifier hs-type">DoPa</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Instructions"><span class="hs-identifier hs-type">Instructions</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-111"></span><span>              </span><span id="local-6989586621679113983"><span class="annot"><span class="annottext">best :: [(Position, (DoPa, Instructions))]
</span><a href="#local-6989586621679113983"><span class="hs-identifier hs-var hs-var">best</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array Position OP -&gt; QTrans -&gt; [(Position, (DoPa, Instructions))]
</span><a href="Text.Regex.TDFA.TDFA.html#pickQTrans"><span class="hs-identifier hs-var">pickQTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Array Position OP
</span><a href="#local-6989586621679113912"><span class="hs-identifier hs-var">aTagOp</span></a></span><span> </span><span class="annot"><span class="annottext">(QTrans -&gt; [(Position, (DoPa, Instructions))])
-&gt; QTrans -&gt; [(Position, (DoPa, Instructions))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679113979"><span class="hs-identifier hs-var">qtrans</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-comment">-- The DFA states are built up by merging the singleton ones converted from the NFA.</span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-comment">-- Thus the &quot;source&quot; indices in the DTrans should not collide.</span><span>
</span><span id="line-115"></span><span>  </span><span class="annot"><a href="#local-6989586621679113931"><span class="hs-identifier hs-type">mergeDFA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DFA"><span class="hs-identifier hs-type">DFA</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DFA"><span class="hs-identifier hs-type">DFA</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DFA"><span class="hs-identifier hs-type">DFA</span></a></span><span>
</span><span id="line-116"></span><span>  </span><span id="local-6989586621679113931"><span class="annot"><span class="annottext">mergeDFA :: DFA -&gt; DFA -&gt; DFA
</span><a href="#local-6989586621679113931"><span class="hs-identifier hs-var hs-var">mergeDFA</span></a></span></span><span> </span><span id="local-6989586621679113985"><span class="annot"><span class="annottext">DFA
</span><a href="#local-6989586621679113985"><span class="hs-identifier hs-var">d1</span></a></span></span><span> </span><span id="local-6989586621679113986"><span class="annot"><span class="annottext">DFA
</span><a href="#local-6989586621679113986"><span class="hs-identifier hs-var">d2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;nfaToDFA.mergeDFA&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><span class="annottext">SetIndex -&gt; DT -&gt; DFA
</span><a href="Text.Regex.TDFA.TDFA.html#makeDFA"><span class="hs-identifier hs-var">makeDFA</span></a></span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679113987"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679113988"><span class="hs-identifier hs-var">dt</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-118"></span><span>      </span><span id="local-6989586621679113987"><span class="annot"><span class="annottext">i :: SetIndex
</span><a href="#local-6989586621679113987"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DFA -&gt; SetIndex
</span><a href="Text.Regex.TDFA.Common.html#d_id"><span class="hs-identifier hs-var">d_id</span></a></span><span> </span><span class="annot"><span class="annottext">DFA
</span><a href="#local-6989586621679113985"><span class="hs-identifier hs-var">d1</span></a></span><span> </span><span class="annot"><span class="annottext">SetIndex -&gt; SetIndex -&gt; SetIndex
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">DFA -&gt; SetIndex
</span><a href="Text.Regex.TDFA.Common.html#d_id"><span class="hs-identifier hs-var">d_id</span></a></span><span> </span><span class="annot"><span class="annottext">DFA
</span><a href="#local-6989586621679113986"><span class="hs-identifier hs-var">d2</span></a></span><span>
</span><span id="line-119"></span><span>      </span><span id="local-6989586621679113988"><span class="annot"><span class="annottext">dt :: DT
</span><a href="#local-6989586621679113988"><span class="hs-identifier hs-var hs-var">dt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DFA -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#d_dt"><span class="hs-identifier hs-var">d_dt</span></a></span><span> </span><span class="annot"><span class="annottext">DFA
</span><a href="#local-6989586621679113985"><span class="hs-identifier hs-var">d1</span></a></span><span> </span><span class="annot"><span class="annottext">DT -&gt; DT -&gt; DT
</span><a href="#local-6989586621679113991"><span class="hs-operator hs-var">`mergeDT`</span></a></span><span> </span><span class="annot"><span class="annottext">DFA -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#d_dt"><span class="hs-identifier hs-var">d_dt</span></a></span><span> </span><span class="annot"><span class="annottext">DFA
</span><a href="#local-6989586621679113986"><span class="hs-identifier hs-var">d2</span></a></span><span>
</span><span id="line-120"></span><span>      </span><span class="annot"><a href="#local-6989586621679113991"><span class="hs-identifier hs-type">mergeDT</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679113992"><span class="hs-identifier hs-type">nestDT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DT"><span class="hs-identifier hs-type">DT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DT"><span class="hs-identifier hs-type">DT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DT"><span class="hs-identifier hs-type">DT</span></a></span><span>
</span><span id="line-121"></span><span>      </span><span id="local-6989586621679113991"><span class="annot"><span class="annottext">mergeDT :: DT -&gt; DT -&gt; DT
</span><a href="#local-6989586621679113991"><span class="hs-identifier hs-var hs-var">mergeDT</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple%27"><span class="hs-identifier hs-type">Simple'</span></a></span><span> </span><span id="local-6989586621679113993"><span class="annot"><span class="annottext">IntMap Instructions
</span><a href="#local-6989586621679113993"><span class="hs-identifier hs-var">w1</span></a></span></span><span> </span><span id="local-6989586621679113994"><span class="annot"><span class="annottext">CharMap Transition
</span><a href="#local-6989586621679113994"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679113995"><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679113995"><span class="hs-identifier hs-var">o1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple%27"><span class="hs-identifier hs-type">Simple'</span></a></span><span> </span><span id="local-6989586621679113996"><span class="annot"><span class="annottext">IntMap Instructions
</span><a href="#local-6989586621679113996"><span class="hs-identifier hs-var">w2</span></a></span></span><span> </span><span id="local-6989586621679113997"><span class="annot"><span class="annottext">CharMap Transition
</span><a href="#local-6989586621679113997"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span id="local-6989586621679113998"><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679113998"><span class="hs-identifier hs-var">o2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap Instructions -&gt; CharMap Transition -&gt; Transition -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#Simple%27"><span class="hs-identifier hs-var">Simple'</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Instructions
</span><a href="#local-6989586621679113999"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">CharMap Transition
</span><a href="#local-6989586621679114000"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679114001"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-122"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-123"></span><span>          </span><span id="local-6989586621679113999"><span class="annot"><span class="annottext">w :: IntMap Instructions
</span><a href="#local-6989586621679113999"><span class="hs-identifier hs-var hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap Instructions
</span><a href="#local-6989586621679113993"><span class="hs-identifier hs-var">w1</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Instructions -&gt; IntMap Instructions -&gt; IntMap Instructions
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">IntMap Instructions
</span><a href="#local-6989586621679113996"><span class="hs-identifier hs-var">w2</span></a></span><span>
</span><span id="line-124"></span><span>          </span><span id="local-6989586621679114000"><span class="annot"><span class="annottext">t :: CharMap Transition
</span><a href="#local-6989586621679114000"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CharMap Transition
</span><a href="#local-6989586621679114003"><span class="hs-identifier hs-var">fuseDTrans</span></a></span><span> </span><span class="hs-comment">-- t1 o1 t2 o2</span><span>
</span><span id="line-125"></span><span>          </span><span id="local-6989586621679114001"><span class="annot"><span class="annottext">o :: Transition
</span><a href="#local-6989586621679114001"><span class="hs-identifier hs-var hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Transition -&gt; Transition -&gt; Transition
</span><a href="#local-6989586621679114004"><span class="hs-identifier hs-var">mergeDTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679113995"><span class="hs-identifier hs-var">o1</span></a></span><span> </span><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679113998"><span class="hs-identifier hs-var">o2</span></a></span><span>
</span><span id="line-126"></span><span>          </span><span class="hs-comment">-- This is very much like mergeQTrans</span><span>
</span><span id="line-127"></span><span>          </span><span class="annot"><a href="#local-6989586621679114004"><span class="hs-identifier hs-type">mergeDTrans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span>
</span><span id="line-128"></span><span>          </span><span id="local-6989586621679114004"><span class="annot"><span class="annottext">mergeDTrans :: Transition -&gt; Transition -&gt; Transition
</span><a href="#local-6989586621679114004"><span class="hs-identifier hs-var hs-var">mergeDTrans</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">trans_how :: Transition -&gt; DTrans
</span><a href="Text.Regex.TDFA.Common.html#trans_how"><span class="hs-identifier hs-var">trans_how</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679114005"><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679114005"><span class="hs-identifier hs-var">dt1</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">trans_how :: Transition -&gt; DTrans
</span><a href="Text.Regex.TDFA.Common.html#trans_how"><span class="hs-identifier hs-var">trans_how</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679114006"><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679114006"><span class="hs-identifier hs-var">dt2</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DTrans -&gt; Transition
</span><a href="#local-6989586621679113940"><span class="hs-identifier hs-var">makeTransition</span></a></span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679114007"><span class="hs-identifier hs-var">dtrans</span></a></span><span>
</span><span id="line-129"></span><span>            </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679114007"><span class="annot"><span class="annottext">dtrans :: DTrans
</span><a href="#local-6989586621679114007"><span class="hs-identifier hs-var hs-var">dtrans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IntMap (DoPa, Instructions)
 -&gt; IntMap (DoPa, Instructions) -&gt; IntMap (DoPa, Instructions))
-&gt; DTrans -&gt; DTrans -&gt; DTrans
forall a. (a -&gt; a -&gt; a) -&gt; IntMap a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.unionWith</span></span><span> </span><span class="annot"><span class="annottext">IntMap (DoPa, Instructions)
-&gt; IntMap (DoPa, Instructions) -&gt; IntMap (DoPa, Instructions)
forall a. IntMap a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.union</span></span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679114005"><span class="hs-identifier hs-var">dt1</span></a></span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679114006"><span class="hs-identifier hs-var">dt2</span></a></span><span>
</span><span id="line-130"></span><span>          </span><span class="hs-comment">-- This is very much like fuseQTrans</span><span>
</span><span id="line-131"></span><span>          </span><span class="annot"><a href="#local-6989586621679114003"><span class="hs-identifier hs-type">fuseDTrans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-type">CharMap</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span>
</span><span id="line-132"></span><span>          </span><span id="local-6989586621679114003"><span class="annot"><span class="annottext">fuseDTrans :: CharMap Transition
</span><a href="#local-6989586621679114003"><span class="hs-identifier hs-var hs-var">fuseDTrans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap Transition -&gt; CharMap Transition
forall a. IntMap a -&gt; CharMap a
</span><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-var">CharMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Position, Transition)] -&gt; IntMap Transition
forall a. [(Position, a)] -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.fromDistinctAscList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Position, Transition)]
-&gt; [(Position, Transition)] -&gt; [(Position, Transition)]
</span><a href="#local-6989586621679114009"><span class="hs-identifier hs-var">fuse</span></a></span><span> </span><span class="annot"><span class="annottext">[(Position, Transition)]
</span><a href="#local-6989586621679114010"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Position, Transition)]
</span><a href="#local-6989586621679114011"><span class="hs-identifier hs-var">l2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-134"></span><span>              </span><span id="local-6989586621679114010"><span class="annot"><span class="annottext">l1 :: [(Position, Transition)]
</span><a href="#local-6989586621679114010"><span class="hs-identifier hs-var hs-var">l1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap Transition -&gt; [(Position, Transition)]
forall a. IntMap a -&gt; [(Position, a)]
</span><span class="hs-identifier hs-var">IMap.toAscList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CharMap Transition -&gt; IntMap Transition
forall a. CharMap a -&gt; IntMap a
</span><a href="Data.IntMap.CharMap2.html#unCharMap"><span class="hs-identifier hs-var">unCharMap</span></a></span><span> </span><span class="annot"><span class="annottext">CharMap Transition
</span><a href="#local-6989586621679113994"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>              </span><span id="local-6989586621679114011"><span class="annot"><span class="annottext">l2 :: [(Position, Transition)]
</span><a href="#local-6989586621679114011"><span class="hs-identifier hs-var hs-var">l2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap Transition -&gt; [(Position, Transition)]
forall a. IntMap a -&gt; [(Position, a)]
</span><span class="hs-identifier hs-var">IMap.toAscList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CharMap Transition -&gt; IntMap Transition
forall a. CharMap a -&gt; IntMap a
</span><a href="Data.IntMap.CharMap2.html#unCharMap"><span class="hs-identifier hs-var">unCharMap</span></a></span><span> </span><span class="annot"><span class="annottext">CharMap Transition
</span><a href="#local-6989586621679113997"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>              </span><span class="annot"><a href="#local-6989586621679114009"><span class="hs-identifier hs-type">fuse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IMap.Key</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-137"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IMap.Key</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-138"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IMap.Key</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-139"></span><span>              </span><span id="local-6989586621679114009"><span class="annot"><span class="annottext">fuse :: [(Position, Transition)]
-&gt; [(Position, Transition)] -&gt; [(Position, Transition)]
</span><a href="#local-6989586621679114009"><span class="hs-identifier hs-var hs-var">fuse</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679114013"><span class="annot"><span class="annottext">[(Position, Transition)]
</span><a href="#local-6989586621679114013"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Position, Transition) -&gt; (Position, Transition))
-&gt; [(Position, Transition)] -&gt; [(Position, Transition)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Transition -&gt; Transition)
-&gt; (Position, Transition) -&gt; (Position, Transition)
forall a b. (a -&gt; b) -&gt; (Position, a) -&gt; (Position, b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Transition -&gt; Transition -&gt; Transition
</span><a href="#local-6989586621679114004"><span class="hs-identifier hs-var">mergeDTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679113995"><span class="hs-identifier hs-var">o1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Position, Transition)]
</span><a href="#local-6989586621679114013"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-140"></span><span>              </span><span class="annot"><a href="#local-6989586621679114009"><span class="hs-identifier hs-var">fuse</span></a></span><span> </span><span id="local-6989586621679114014"><span class="annot"><span class="annottext">[(Position, Transition)]
</span><a href="#local-6989586621679114014"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Position, Transition) -&gt; (Position, Transition))
-&gt; [(Position, Transition)] -&gt; [(Position, Transition)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Transition -&gt; Transition)
-&gt; (Position, Transition) -&gt; (Position, Transition)
forall a b. (a -&gt; b) -&gt; (Position, a) -&gt; (Position, b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Transition -&gt; Transition -&gt; Transition
</span><a href="#local-6989586621679114004"><span class="hs-identifier hs-var">mergeDTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679113998"><span class="hs-identifier hs-var">o2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Position, Transition)]
</span><a href="#local-6989586621679114014"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-141"></span><span>              </span><span class="annot"><a href="#local-6989586621679114009"><span class="hs-identifier hs-var">fuse</span></a></span><span> </span><span id="local-6989586621679114015"><span class="annot"><span class="annottext">x :: [(Position, Transition)]
</span><a href="#local-6989586621679114015"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679114016"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114016"><span class="hs-identifier hs-var">xc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679114017"><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679114017"><span class="hs-identifier hs-var">xa</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679114018"><span class="annot"><span class="annottext">[(Position, Transition)]
</span><a href="#local-6989586621679114018"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679114019"><span class="annot"><span class="annottext">y :: [(Position, Transition)]
</span><a href="#local-6989586621679114019"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679114020"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114020"><span class="hs-identifier hs-var">yc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679114021"><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679114021"><span class="hs-identifier hs-var">ya</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679114022"><span class="annot"><span class="annottext">[(Position, Transition)]
</span><a href="#local-6989586621679114022"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-142"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Position -&gt; Position -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114016"><span class="hs-identifier hs-var">xc</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114020"><span class="hs-identifier hs-var">yc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-143"></span><span>                  </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114016"><span class="hs-identifier hs-var">xc</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Transition -&gt; Transition -&gt; Transition
</span><a href="#local-6989586621679114004"><span class="hs-identifier hs-var">mergeDTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679113998"><span class="hs-identifier hs-var">o2</span></a></span><span> </span><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679114017"><span class="hs-identifier hs-var">xa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Position, Transition)
-&gt; [(Position, Transition)] -&gt; [(Position, Transition)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(Position, Transition)]
-&gt; [(Position, Transition)] -&gt; [(Position, Transition)]
</span><a href="#local-6989586621679114009"><span class="hs-identifier hs-var">fuse</span></a></span><span> </span><span class="annot"><span class="annottext">[(Position, Transition)]
</span><a href="#local-6989586621679114018"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Position, Transition)]
</span><a href="#local-6989586621679114019"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-144"></span><span>                  </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114016"><span class="hs-identifier hs-var">xc</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Transition -&gt; Transition -&gt; Transition
</span><a href="#local-6989586621679114004"><span class="hs-identifier hs-var">mergeDTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679114017"><span class="hs-identifier hs-var">xa</span></a></span><span> </span><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679114021"><span class="hs-identifier hs-var">ya</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Position, Transition)
-&gt; [(Position, Transition)] -&gt; [(Position, Transition)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(Position, Transition)]
-&gt; [(Position, Transition)] -&gt; [(Position, Transition)]
</span><a href="#local-6989586621679114009"><span class="hs-identifier hs-var">fuse</span></a></span><span> </span><span class="annot"><span class="annottext">[(Position, Transition)]
</span><a href="#local-6989586621679114018"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Position, Transition)]
</span><a href="#local-6989586621679114022"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-145"></span><span>                  </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114020"><span class="hs-identifier hs-var">yc</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Transition -&gt; Transition -&gt; Transition
</span><a href="#local-6989586621679114004"><span class="hs-identifier hs-var">mergeDTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679113995"><span class="hs-identifier hs-var">o1</span></a></span><span> </span><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679114021"><span class="hs-identifier hs-var">ya</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Position, Transition)
-&gt; [(Position, Transition)] -&gt; [(Position, Transition)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(Position, Transition)]
-&gt; [(Position, Transition)] -&gt; [(Position, Transition)]
</span><a href="#local-6989586621679114009"><span class="hs-identifier hs-var">fuse</span></a></span><span> </span><span class="annot"><span class="annottext">[(Position, Transition)]
</span><a href="#local-6989586621679114015"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[(Position, Transition)]
</span><a href="#local-6989586621679114022"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-146"></span><span>      </span><span class="annot"><a href="#local-6989586621679113991"><span class="hs-identifier hs-var">mergeDT</span></a></span><span> </span><span id="local-6989586621679114024"><span class="annot"><span class="annottext">dt1 :: DT
</span><a href="#local-6989586621679114024"><span class="hs-identifier hs-var">dt1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing%27"><span class="hs-identifier hs-type">Testing'</span></a></span><span> </span><span id="local-6989586621679114025"><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679114025"><span class="hs-identifier hs-var">wt1</span></a></span></span><span> </span><span id="local-6989586621679114026"><span class="annot"><span class="annottext">EnumSet DoPa
</span><a href="#local-6989586621679114026"><span class="hs-identifier hs-var">dopas1</span></a></span></span><span> </span><span id="local-6989586621679114027"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114027"><span class="hs-identifier hs-var">a1</span></a></span></span><span> </span><span id="local-6989586621679114028"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114028"><span class="hs-identifier hs-var">b1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679114029"><span class="annot"><span class="annottext">dt2 :: DT
</span><a href="#local-6989586621679114029"><span class="hs-identifier hs-var">dt2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing%27"><span class="hs-identifier hs-type">Testing'</span></a></span><span> </span><span id="local-6989586621679114030"><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679114030"><span class="hs-identifier hs-var">wt2</span></a></span></span><span> </span><span id="local-6989586621679114031"><span class="annot"><span class="annottext">EnumSet DoPa
</span><a href="#local-6989586621679114031"><span class="hs-identifier hs-var">dopas2</span></a></span></span><span> </span><span id="local-6989586621679114032"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114032"><span class="hs-identifier hs-var">a2</span></a></span></span><span> </span><span id="local-6989586621679114033"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114033"><span class="hs-identifier hs-var">b2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-147"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WhichTest -&gt; WhichTest -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679114025"><span class="hs-identifier hs-var">wt1</span></a></span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679114030"><span class="hs-identifier hs-var">wt2</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-148"></span><span>          </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DT -&gt; DT -&gt; DT
</span><a href="#local-6989586621679113992"><span class="hs-identifier hs-var">nestDT</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114024"><span class="hs-identifier hs-var">dt1</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114029"><span class="hs-identifier hs-var">dt2</span></a></span><span>
</span><span id="line-149"></span><span>          </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing%27"><span class="hs-identifier hs-type">Testing'</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dt_test :: WhichTest
</span><a href="Text.Regex.TDFA.Common.html#dt_test"><span class="hs-identifier hs-var">dt_test</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679114025"><span class="hs-identifier hs-var">wt1</span></a></span><span>
</span><span id="line-150"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dt_dopas :: EnumSet DoPa
</span><a href="Text.Regex.TDFA.Common.html#dt_dopas"><span class="hs-identifier hs-var">dt_dopas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EnumSet DoPa
</span><a href="#local-6989586621679114026"><span class="hs-identifier hs-var">dopas1</span></a></span><span> </span><span class="annot"><span class="annottext">EnumSet DoPa -&gt; EnumSet DoPa -&gt; EnumSet DoPa
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">EnumSet DoPa
</span><a href="#local-6989586621679114031"><span class="hs-identifier hs-var">dopas2</span></a></span><span>
</span><span id="line-151"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dt_a :: DT
</span><a href="Text.Regex.TDFA.Common.html#dt_a"><span class="hs-identifier hs-var">dt_a</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DT -&gt; DT -&gt; DT
</span><a href="#local-6989586621679113991"><span class="hs-identifier hs-var">mergeDT</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114027"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114032"><span class="hs-identifier hs-var">a2</span></a></span><span>
</span><span id="line-152"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dt_b :: DT
</span><a href="Text.Regex.TDFA.Common.html#dt_b"><span class="hs-identifier hs-var">dt_b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DT -&gt; DT -&gt; DT
</span><a href="#local-6989586621679113991"><span class="hs-identifier hs-var">mergeDT</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114028"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114033"><span class="hs-identifier hs-var">b2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-153"></span><span>          </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DT -&gt; DT -&gt; DT
</span><a href="#local-6989586621679113992"><span class="hs-identifier hs-var">nestDT</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114029"><span class="hs-identifier hs-var">dt2</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114024"><span class="hs-identifier hs-var">dt1</span></a></span><span>
</span><span id="line-154"></span><span>      </span><span class="annot"><a href="#local-6989586621679113991"><span class="hs-identifier hs-var">mergeDT</span></a></span><span> </span><span id="local-6989586621679114034"><span class="annot"><span class="annottext">dt1 :: DT
</span><a href="#local-6989586621679114034"><span class="hs-identifier hs-var">dt1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing%27"><span class="hs-identifier hs-type">Testing'</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679114035"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114035"><span class="hs-identifier hs-var">dt2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DT -&gt; DT -&gt; DT
</span><a href="#local-6989586621679113992"><span class="hs-identifier hs-var">nestDT</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114034"><span class="hs-identifier hs-var">dt1</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114035"><span class="hs-identifier hs-var">dt2</span></a></span><span>
</span><span id="line-155"></span><span>      </span><span class="annot"><a href="#local-6989586621679113991"><span class="hs-identifier hs-var">mergeDT</span></a></span><span> </span><span id="local-6989586621679114036"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114036"><span class="hs-identifier hs-var">dt1</span></a></span></span><span> </span><span id="local-6989586621679114037"><span class="annot"><span class="annottext">dt2 :: DT
</span><a href="#local-6989586621679114037"><span class="hs-identifier hs-var">dt2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing%27"><span class="hs-identifier hs-type">Testing'</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DT -&gt; DT -&gt; DT
</span><a href="#local-6989586621679113992"><span class="hs-identifier hs-var">nestDT</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114037"><span class="hs-identifier hs-var">dt2</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114036"><span class="hs-identifier hs-var">dt1</span></a></span><span>
</span><span id="line-156"></span><span>      </span><span id="local-6989586621679113992"><span class="annot"><span class="annottext">nestDT :: DT -&gt; DT -&gt; DT
</span><a href="#local-6989586621679113992"><span class="hs-identifier hs-var hs-var">nestDT</span></a></span></span><span> </span><span id="local-6989586621679114038"><span class="annot"><span class="annottext">dt1 :: DT
</span><a href="#local-6989586621679114038"><span class="hs-identifier hs-var">dt1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing%27"><span class="hs-identifier hs-type">Testing'</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">dt_a :: DT -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#dt_a"><span class="hs-identifier hs-var">dt_a</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679114039"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114039"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">dt_b :: DT -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#dt_b"><span class="hs-identifier hs-var">dt_b</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679114040"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114040"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679114041"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114041"><span class="hs-identifier hs-var">dt2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114038"><span class="hs-identifier hs-var">dt1</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#dt_a"><span class="hs-identifier hs-var">dt_a</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679113991"><span class="hs-identifier hs-type">mergeDT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679114039"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679114041"><span class="hs-identifier hs-type">dt2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#dt_b"><span class="hs-identifier hs-var">dt_b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679113991"><span class="hs-identifier hs-type">mergeDT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679114040"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679114041"><span class="hs-identifier hs-type">dt2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-157"></span><span>      </span><span class="annot"><a href="#local-6989586621679113992"><span class="hs-identifier hs-var">nestDT</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">DT
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; DT
forall a. String -&gt; a
</span><a href="Text.Regex.TDFA.TDFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nestDT called on Simple -- cannot happen&quot;</span></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#patternToRegex"><span class="hs-identifier hs-type">patternToRegex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupIndex"><span class="hs-identifier hs-type">GroupIndex</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DoPa"><span class="hs-identifier hs-type">DoPa</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#CompOption"><span class="hs-identifier hs-type">CompOption</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#ExecOption"><span class="hs-identifier hs-type">ExecOption</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Regex"><span class="hs-identifier hs-type">Regex</span></a></span><span>
</span><span id="line-160"></span><span id="patternToRegex"><span class="annot"><span class="annottext">patternToRegex :: (Pattern, (Position, DoPa)) -&gt; CompOption -&gt; ExecOption -&gt; Regex
</span><a href="Text.Regex.TDFA.TDFA.html#patternToRegex"><span class="hs-identifier hs-var hs-var">patternToRegex</span></a></span></span><span> </span><span id="local-6989586621679114042"><span class="annot"><span class="annottext">(Pattern, (Position, DoPa))
</span><a href="#local-6989586621679114042"><span class="hs-identifier hs-var">pattern</span></a></span></span><span> </span><span id="local-6989586621679114043"><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621679114043"><span class="hs-identifier hs-var">compOpt</span></a></span></span><span> </span><span id="local-6989586621679114044"><span class="annot"><span class="annottext">ExecOption
</span><a href="#local-6989586621679114044"><span class="hs-identifier hs-var">execOpt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Position, Array Position QNFA), Array Position OP,
 Array Position [GroupInfo])
-&gt; CompOption -&gt; ExecOption -&gt; Regex
</span><a href="Text.Regex.TDFA.TDFA.html#nfaToDFA"><span class="hs-identifier hs-var">nfaToDFA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompOption
-&gt; (Pattern, (Position, DoPa))
-&gt; ((Position, Array Position QNFA), Array Position OP,
    Array Position [GroupInfo])
</span><a href="Text.Regex.TDFA.TNFA.html#patternToNFA"><span class="hs-identifier hs-var">patternToNFA</span></a></span><span> </span><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621679114043"><span class="hs-identifier hs-var">compOpt</span></a></span><span> </span><span class="annot"><span class="annottext">(Pattern, (Position, DoPa))
</span><a href="#local-6989586621679114042"><span class="hs-identifier hs-var">pattern</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621679114043"><span class="hs-identifier hs-var">compOpt</span></a></span><span> </span><span class="annot"><span class="annottext">ExecOption
</span><a href="#local-6989586621679114044"><span class="hs-identifier hs-var">execOpt</span></a></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#dfaMap"><span class="hs-identifier hs-type">dfaMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DFA"><span class="hs-identifier hs-type">DFA</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Data.Map.Map</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#SetIndex"><span class="hs-identifier hs-type">SetIndex</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DFA"><span class="hs-identifier hs-type">DFA</span></a></span><span>
</span><span id="line-163"></span><span id="dfaMap"><span class="annot"><span class="annottext">dfaMap :: DFA -&gt; Map SetIndex DFA
</span><a href="Text.Regex.TDFA.TDFA.html#dfaMap"><span class="hs-identifier hs-var hs-var">dfaMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map SetIndex DFA -&gt; DFA -&gt; Map SetIndex DFA
</span><a href="#local-6989586621679114045"><span class="hs-identifier hs-var">seen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map SetIndex DFA
forall k a. Map k a
</span><span class="hs-identifier hs-var">Data.Map.empty</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-164"></span><span>  </span><span id="local-6989586621679114045"><span class="annot"><span class="annottext">seen :: Map SetIndex DFA -&gt; DFA -&gt; Map SetIndex DFA
</span><a href="#local-6989586621679114045"><span class="hs-identifier hs-var hs-var">seen</span></a></span></span><span> </span><span id="local-6989586621679114049"><span class="annot"><span class="annottext">Map SetIndex DFA
</span><a href="#local-6989586621679114049"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span id="local-6989586621679114050"><span class="annot"><span class="annottext">d :: DFA
</span><a href="#local-6989586621679114050"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DFA"><span class="hs-identifier hs-type">DFA</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">d_id :: DFA -&gt; SetIndex
</span><a href="Text.Regex.TDFA.Common.html#d_id"><span class="hs-identifier hs-var">d_id</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679114051"><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679114051"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">d_dt :: DFA -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#d_dt"><span class="hs-identifier hs-var">d_dt</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679114052"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114052"><span class="hs-identifier hs-var">dt</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679114051"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">SetIndex -&gt; Map SetIndex DFA -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><span class="hs-operator hs-var">`Data.Map.member`</span></span><span> </span><span class="annot"><span class="annottext">Map SetIndex DFA
</span><a href="#local-6989586621679114049"><span class="hs-identifier hs-var">old</span></a></span><span>
</span><span id="line-166"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Map SetIndex DFA
</span><a href="#local-6989586621679114049"><span class="hs-identifier hs-var">old</span></a></span><span>
</span><span id="line-167"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679114054"><span class="annot"><span class="annottext">new :: Map SetIndex DFA
</span><a href="#local-6989586621679114054"><span class="hs-identifier hs-var hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SetIndex -&gt; DFA -&gt; Map SetIndex DFA -&gt; Map SetIndex DFA
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Data.Map.insert</span></span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679114051"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">DFA
</span><a href="#local-6989586621679114050"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map SetIndex DFA
</span><a href="#local-6989586621679114049"><span class="hs-identifier hs-var">old</span></a></span><span>
</span><span id="line-168"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Map SetIndex DFA -&gt; DFA -&gt; Map SetIndex DFA)
-&gt; Map SetIndex DFA -&gt; [DFA] -&gt; Map SetIndex DFA
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">Map SetIndex DFA -&gt; DFA -&gt; Map SetIndex DFA
</span><a href="#local-6989586621679114045"><span class="hs-identifier hs-var">seen</span></a></span><span> </span><span class="annot"><span class="annottext">Map SetIndex DFA
</span><a href="#local-6989586621679114054"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DT -&gt; [DFA]
</span><a href="Text.Regex.TDFA.TDFA.html#flattenDT"><span class="hs-identifier hs-var">flattenDT</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114052"><span class="hs-identifier hs-var">dt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="hs-comment">-- Get all trans_many states</span><span>
</span><span id="line-171"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#flattenDT"><span class="hs-identifier hs-type">flattenDT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DT"><span class="hs-identifier hs-type">DT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DFA"><span class="hs-identifier hs-type">DFA</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-172"></span><span id="flattenDT"><span class="annot"><span class="annottext">flattenDT :: DT -&gt; [DFA]
</span><a href="Text.Regex.TDFA.TDFA.html#flattenDT"><span class="hs-identifier hs-var hs-var">flattenDT</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple%27"><span class="hs-identifier hs-type">Simple'</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">dt_trans :: DT -&gt; CharMap Transition
</span><a href="Text.Regex.TDFA.Common.html#dt_trans"><span class="hs-identifier hs-var">dt_trans</span></a></span><span class="hs-glyph">=</span><span class="hs-special">(</span><span class="annot"><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-type">CharMap</span></a></span><span> </span><span id="local-6989586621679114056"><span class="annot"><span class="annottext">IntMap Transition
</span><a href="#local-6989586621679114056"><span class="hs-identifier hs-var">mt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">dt_other :: DT -&gt; Transition
</span><a href="Text.Regex.TDFA.Common.html#dt_other"><span class="hs-identifier hs-var">dt_other</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679114057"><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679114057"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Transition -&gt; [DFA]) -&gt; [Transition] -&gt; [DFA]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679114059"><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679114059"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Transition -&gt; DFA
</span><a href="Text.Regex.TDFA.Common.html#trans_many"><span class="hs-identifier hs-var">trans_many</span></a></span><span> </span><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679114059"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-comment">{-,trans_single d-}</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Transition] -&gt; [DFA])
-&gt; (IntMap Transition -&gt; [Transition])
-&gt; IntMap Transition
-&gt; [DFA]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679114057"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">([Transition] -&gt; [Transition])
-&gt; (IntMap Transition -&gt; [Transition])
-&gt; IntMap Transition
-&gt; [Transition]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IntMap Transition -&gt; [Transition]
forall a. IntMap a -&gt; [a]
</span><span class="hs-identifier hs-var">IMap.elems</span></span><span> </span><span class="annot"><span class="annottext">(IntMap Transition -&gt; [DFA]) -&gt; IntMap Transition -&gt; [DFA]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IntMap Transition
</span><a href="#local-6989586621679114056"><span class="hs-identifier hs-var">mt</span></a></span><span>
</span><span id="line-173"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#flattenDT"><span class="hs-identifier hs-var">flattenDT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing%27"><span class="hs-identifier hs-type">Testing'</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">dt_a :: DT -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#dt_a"><span class="hs-identifier hs-var">dt_a</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679114060"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114060"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">dt_b :: DT -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#dt_b"><span class="hs-identifier hs-var">dt_b</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679114061"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114061"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DT -&gt; [DFA]
</span><a href="Text.Regex.TDFA.TDFA.html#flattenDT"><span class="hs-identifier hs-var">flattenDT</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114060"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[DFA] -&gt; [DFA] -&gt; [DFA]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">DT -&gt; [DFA]
</span><a href="Text.Regex.TDFA.TDFA.html#flattenDT"><span class="hs-identifier hs-var">flattenDT</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114061"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#examineDFA"><span class="hs-identifier hs-type">examineDFA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Regex"><span class="hs-identifier hs-type">Regex</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-176"></span><span id="examineDFA"><span class="annot"><span class="annottext">examineDFA :: Regex -&gt; String
</span><a href="Text.Regex.TDFA.TDFA.html#examineDFA"><span class="hs-identifier hs-var hs-var">examineDFA</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Regex"><span class="hs-identifier hs-type">Regex</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">regex_dfa :: Regex -&gt; DFA
</span><a href="Text.Regex.TDFA.Common.html#regex_dfa"><span class="hs-identifier hs-var">regex_dfa</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679114063"><span class="annot"><span class="annottext">DFA
</span><a href="#local-6989586621679114063"><span class="hs-identifier hs-var">dfa</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unlines</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; String) -&gt; ([DFA] -&gt; [String]) -&gt; [DFA] -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Number of reachable DFA states: &quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Position -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DFA] -&gt; Position
forall a. [a] -&gt; Position
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Position
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[DFA]
</span><a href="#local-6989586621679114067"><span class="hs-identifier hs-var">dfas</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String]) -&gt; ([DFA] -&gt; [String]) -&gt; [DFA] -&gt; [String]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(DFA -&gt; String) -&gt; [DFA] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">DFA -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">([DFA] -&gt; String) -&gt; [DFA] -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[DFA]
</span><a href="#local-6989586621679114067"><span class="hs-identifier hs-var">dfas</span></a></span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679114067"><span class="annot"><span class="annottext">dfas :: [DFA]
</span><a href="#local-6989586621679114067"><span class="hs-identifier hs-var hs-var">dfas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map SetIndex DFA -&gt; [DFA]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Data.Map.elems</span></span><span> </span><span class="annot"><span class="annottext">(Map SetIndex DFA -&gt; [DFA]) -&gt; Map SetIndex DFA -&gt; [DFA]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DFA -&gt; Map SetIndex DFA
</span><a href="Text.Regex.TDFA.TDFA.html#dfaMap"><span class="hs-identifier hs-var">dfaMap</span></a></span><span> </span><span class="annot"><span class="annottext">DFA
</span><a href="#local-6989586621679114063"><span class="hs-identifier hs-var">dfa</span></a></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="hs-comment">{-

fillMap :: Tag -&gt; IntMap (Position,Bool)
fillMap tag = IMap.fromDistinctAscList [(t,(-1,True)) | t &lt;- [0..tag] ]

diffMap :: IntMap (Position,Bool) -&gt; IntMap (Position,Bool) -&gt; [(Index,(Position,Bool))]
diffMap old new = IMap.toList (IMap.differenceWith (\a b -&gt; if a==b then Nothing else Just b) old new)

examineDFA :: (DFA,Index,Array Tag OP,Array GroupIndex [GroupInfo]) -&gt; String
examineDFA (dfa,_,aTags,_) = unlines $ map (examineDFA' (snd . bounds $ aTags)) (Map.elems $ dfaMap dfa)

examineDFA' :: Tag -&gt; DFA -&gt; String
examineDFA' maxTag = showDFA (fillMap maxTag)

{-
instance Show DFA where
  show (DFA {d_id=i,d_dt=dt}) = &quot;DFA {d_id = &quot;++show (ISet.toList i)
                            ++&quot;\n    ,d_dt = &quot;++ show dt
                            ++&quot;\n}&quot;
-}
-- instance Show DT where show = showDT

showDFA :: IntMap (Position,Bool) -&gt; DFA -&gt; String
showDFA m (DFA {d_id=i,d_dt=dt}) = &quot;DFA {d_id = &quot;++show (ISet.toList i)
                               ++&quot;\n    ,d_dt = &quot;++ showDT m dt
                               ++&quot;\n}&quot;
-}</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="hs-comment">-- pick QTrans can be told the unique source and knows all the</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- destinations (hmm...along with qt_win)!  So if in ascending destination order the last source</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- is free to mutatate the old state.  If the QTrans has only one</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- entry then all we need to do is mutate that entry when making a</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- transition.</span><span>
</span><span id="line-214"></span><span class="hs-comment">--</span><span>
</span><span id="line-215"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#pickQTrans"><span class="hs-identifier hs-type">pickQTrans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#OP"><span class="hs-identifier hs-type">OP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier hs-type">QTrans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-comment">{-Destination-}</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DoPa"><span class="hs-identifier hs-type">DoPa</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Instructions"><span class="hs-identifier hs-type">Instructions</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-216"></span><span id="pickQTrans"><span class="annot"><span class="annottext">pickQTrans :: Array Position OP -&gt; QTrans -&gt; [(Position, (DoPa, Instructions))]
</span><a href="Text.Regex.TDFA.TDFA.html#pickQTrans"><span class="hs-identifier hs-var hs-var">pickQTrans</span></a></span></span><span> </span><span id="local-6989586621679114068"><span class="annot"><span class="annottext">Array Position OP
</span><a href="#local-6989586621679114068"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679114069"><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679114069"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([TagCommand] -&gt; (DoPa, Instructions))
-&gt; [(Position, [TagCommand])] -&gt; [(Position, (DoPa, Instructions))]
forall (f :: * -&gt; *) t1 t2 t.
Functor f =&gt;
(t1 -&gt; t2) -&gt; f (t, t1) -&gt; f (t, t2)
</span><a href="Text.Regex.TDFA.Common.html#mapSnd"><span class="hs-identifier hs-var">mapSnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array Position OP -&gt; [TagCommand] -&gt; (DoPa, Instructions)
</span><a href="Text.Regex.TDFA.TDFA.html#bestTrans"><span class="hs-identifier hs-var">bestTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Array Position OP
</span><a href="#local-6989586621679114068"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Position, [TagCommand])] -&gt; [(Position, (DoPa, Instructions))])
-&gt; (QTrans -&gt; [(Position, [TagCommand])])
-&gt; QTrans
-&gt; [(Position, (DoPa, Instructions))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QTrans -&gt; [(Position, [TagCommand])]
forall a. IntMap a -&gt; [(Position, a)]
</span><span class="hs-identifier hs-var">IMap.toList</span></span><span> </span><span class="annot"><span class="annottext">(QTrans -&gt; [(Position, (DoPa, Instructions))])
-&gt; QTrans -&gt; [(Position, (DoPa, Instructions))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QTrans
</span><a href="#local-6989586621679114069"><span class="hs-identifier hs-var">tr</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#cleanWin"><span class="hs-identifier hs-type">cleanWin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#WinTags"><span class="hs-identifier hs-type">WinTags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Instructions"><span class="hs-identifier hs-type">Instructions</span></a></span><span>
</span><span id="line-219"></span><span id="cleanWin"><span class="annot"><span class="annottext">cleanWin :: WinTags -&gt; Instructions
</span><a href="Text.Regex.TDFA.TDFA.html#cleanWin"><span class="hs-identifier hs-var hs-var">cleanWin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WinTags -&gt; Instructions
</span><a href="Text.Regex.TDFA.TDFA.html#toInstructions"><span class="hs-identifier hs-var">toInstructions</span></a></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#bestTrans"><span class="hs-identifier hs-type">bestTrans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#OP"><span class="hs-identifier hs-type">OP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagCommand"><span class="hs-identifier hs-type">TagCommand</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DoPa"><span class="hs-identifier hs-type">DoPa</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Instructions"><span class="hs-identifier hs-type">Instructions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span id="bestTrans"><span class="annot"><span class="annottext">bestTrans :: Array Position OP -&gt; [TagCommand] -&gt; (DoPa, Instructions)
</span><a href="Text.Regex.TDFA.TDFA.html#bestTrans"><span class="hs-identifier hs-var hs-var">bestTrans</span></a></span></span><span> </span><span class="annot"><span class="annottext">Array Position OP
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (DoPa, Instructions)
forall a. String -&gt; a
</span><a href="Text.Regex.TDFA.TDFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bestTrans : There were no transition choose from!&quot;</span></span><span>
</span><span id="line-223"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#bestTrans"><span class="hs-identifier hs-var">bestTrans</span></a></span><span> </span><span id="local-6989586621679114072"><span class="annot"><span class="annottext">Array Position OP
</span><a href="#local-6989586621679114072"><span class="hs-identifier hs-var">aTagOP</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679114073"><span class="annot"><span class="annottext">TagCommand
</span><a href="#local-6989586621679114073"><span class="hs-identifier hs-var">f</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679114074"><span class="annot"><span class="annottext">[TagCommand]
</span><a href="#local-6989586621679114074"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[TagCommand] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[TagCommand]
</span><a href="#local-6989586621679114074"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagCommand -&gt; (DoPa, Instructions)
</span><a href="#local-6989586621679114076"><span class="hs-identifier hs-var">canonical</span></a></span><span> </span><span class="annot"><span class="annottext">TagCommand
</span><a href="#local-6989586621679114073"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-224"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DoPa, Instructions)
</span><a href="#local-6989586621679114077"><span class="hs-identifier hs-var">answer</span></a></span><span> </span><span class="hs-comment">-- if null toDisplay then answer else trace toDisplay answer</span><span>
</span><span id="line-225"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-226"></span><span>  </span><span id="local-6989586621679114077"><span class="annot"><span class="annottext">answer :: (DoPa, Instructions)
</span><a href="#local-6989586621679114077"><span class="hs-identifier hs-var hs-var">answer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((DoPa, Instructions) -&gt; TagCommand -&gt; (DoPa, Instructions))
-&gt; (DoPa, Instructions) -&gt; [TagCommand] -&gt; (DoPa, Instructions)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">(DoPa, Instructions) -&gt; TagCommand -&gt; (DoPa, Instructions)
</span><a href="#local-6989586621679114079"><span class="hs-identifier hs-var">pick</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagCommand -&gt; (DoPa, Instructions)
</span><a href="#local-6989586621679114076"><span class="hs-identifier hs-var">canonical</span></a></span><span> </span><span class="annot"><span class="annottext">TagCommand
</span><a href="#local-6989586621679114073"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TagCommand]
</span><a href="#local-6989586621679114074"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-comment">{- toDisplay | null fs = &quot;&quot;
               | otherwise = unlines $ &quot;bestTrans&quot; : show (answer) : &quot;from among&quot; : concatMap (\x -&gt; [show x, show (toInstructions (snd x))]) (f:fs) -}</span><span>
</span><span id="line-229"></span><span>  </span><span class="annot"><a href="#local-6989586621679114076"><span class="hs-identifier hs-type">canonical</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagCommand"><span class="hs-identifier hs-type">TagCommand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DoPa"><span class="hs-identifier hs-type">DoPa</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Instructions"><span class="hs-identifier hs-type">Instructions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>  </span><span id="local-6989586621679114076"><span class="annot"><span class="annottext">canonical :: TagCommand -&gt; (DoPa, Instructions)
</span><a href="#local-6989586621679114076"><span class="hs-identifier hs-var hs-var">canonical</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679114080"><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679114080"><span class="hs-identifier hs-var">dopa</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679114081"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679114081"><span class="hs-identifier hs-var">spec</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679114080"><span class="hs-identifier hs-var">dopa</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WinTags -&gt; Instructions
</span><a href="Text.Regex.TDFA.TDFA.html#toInstructions"><span class="hs-identifier hs-var">toInstructions</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679114081"><span class="hs-identifier hs-var">spec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>  </span><span class="annot"><a href="#local-6989586621679114079"><span class="hs-identifier hs-type">pick</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DoPa"><span class="hs-identifier hs-type">DoPa</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Instructions"><span class="hs-identifier hs-type">Instructions</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagCommand"><span class="hs-identifier hs-type">TagCommand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DoPa"><span class="hs-identifier hs-type">DoPa</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Instructions"><span class="hs-identifier hs-type">Instructions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>  </span><span id="local-6989586621679114079"><span class="annot"><span class="annottext">pick :: (DoPa, Instructions) -&gt; TagCommand -&gt; (DoPa, Instructions)
</span><a href="#local-6989586621679114079"><span class="hs-identifier hs-var hs-var">pick</span></a></span></span><span> </span><span id="local-6989586621679114082"><span class="annot"><span class="annottext">win :: (DoPa, Instructions)
</span><a href="#local-6989586621679114082"><span class="hs-identifier hs-var">win</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679114083"><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679114083"><span class="hs-identifier hs-var">dopa1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679114084"><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679114084"><span class="hs-identifier hs-var">winI</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679114085"><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679114085"><span class="hs-identifier hs-var">dopa2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679114086"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679114086"><span class="hs-identifier hs-var">spec</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679114087"><span class="annot"><span class="annottext">nextI :: Instructions
</span><a href="#local-6989586621679114087"><span class="hs-identifier hs-var hs-var">nextI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WinTags -&gt; Instructions
</span><a href="Text.Regex.TDFA.TDFA.html#toInstructions"><span class="hs-identifier hs-var">toInstructions</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679114086"><span class="hs-identifier hs-var">spec</span></a></span><span>
</span><span id="line-234"></span><span class="hs-comment">--    in case compareWith choose winPos nextPos of -- XXX 2009: add in enterOrbit information</span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Maybe (Position, Action) -&gt; Maybe (Position, Action) -&gt; Ordering)
-&gt; [(Position, Action)] -&gt; [(Position, Action)] -&gt; Ordering
forall x a b c.
(Ord x, Monoid a) =&gt;
(Maybe (x, b) -&gt; Maybe (x, c) -&gt; a) -&gt; [(x, b)] -&gt; [(x, c)] -&gt; a
</span><a href="#local-6989586621679114088"><span class="hs-identifier hs-var">compareWith</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Position, Action) -&gt; Maybe (Position, Action) -&gt; Ordering
</span><a href="#local-6989586621679114089"><span class="hs-identifier hs-var">choose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Instructions -&gt; [(Position, Action)]
</span><a href="#local-6989586621679114090"><span class="hs-identifier hs-var">toListing</span></a></span><span> </span><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679114084"><span class="hs-identifier hs-var">winI</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Instructions -&gt; [(Position, Action)]
</span><a href="#local-6989586621679114090"><span class="hs-identifier hs-var">toListing</span></a></span><span> </span><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679114087"><span class="hs-identifier hs-var">nextI</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-236"></span><span>         </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(DoPa, Instructions)
</span><a href="#local-6989586621679114082"><span class="hs-identifier hs-var">win</span></a></span><span>
</span><span id="line-237"></span><span>         </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679114085"><span class="hs-identifier hs-var">dopa2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679114087"><span class="hs-identifier hs-var">nextI</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>         </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679114083"><span class="hs-identifier hs-var">dopa1</span></a></span><span> </span><span class="annot"><span class="annottext">DoPa -&gt; DoPa -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679114085"><span class="hs-identifier hs-var">dopa2</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(DoPa, Instructions)
</span><a href="#local-6989586621679114082"><span class="hs-identifier hs-var">win</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679114085"><span class="hs-identifier hs-var">dopa2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679114087"><span class="hs-identifier hs-var">nextI</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- no deep reason not to just pick win</span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><a href="#local-6989586621679114090"><span class="hs-identifier hs-type">toListing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Instructions"><span class="hs-identifier hs-type">Instructions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-241"></span><span>  </span><span id="local-6989586621679114090"><span class="annot"><span class="annottext">toListing :: Instructions -&gt; [(Position, Action)]
</span><a href="#local-6989586621679114090"><span class="hs-identifier hs-var hs-var">toListing</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Instructions"><span class="hs-identifier hs-type">Instructions</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">newPos :: Instructions -&gt; [(Position, Action)]
</span><a href="Text.Regex.TDFA.Common.html#newPos"><span class="hs-identifier hs-var">newPos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679114093"><span class="annot"><span class="annottext">[(Position, Action)]
</span><a href="#local-6989586621679114093"><span class="hs-identifier hs-var">nextPos</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Position, Action) -&gt; Bool)
-&gt; [(Position, Action)] -&gt; [(Position, Action)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">(Position, Action) -&gt; Bool
forall {a}. (a, Action) -&gt; Bool
</span><a href="#local-6989586621679114094"><span class="hs-identifier hs-var">notReset</span></a></span><span> </span><span class="annot"><span class="annottext">[(Position, Action)]
</span><a href="#local-6989586621679114093"><span class="hs-identifier hs-var">nextPos</span></a></span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679114094"><span class="annot"><span class="annottext">notReset :: (a, Action) -&gt; Bool
</span><a href="#local-6989586621679114094"><span class="hs-identifier hs-var hs-var">notReset</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#SetVal"><span class="hs-identifier hs-type">SetVal</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-243"></span><span>          </span><span class="annot"><a href="#local-6989586621679114094"><span class="hs-identifier hs-var">notReset</span></a></span><span> </span><span class="annot"><span class="annottext">(a, Action)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-244"></span><span class="hs-comment">{-
  toListing (Instructions {newPos = nextPos}) = mergeTagOrbit nextPos (filter snd nextFlags)

  mergeTagOrbit xx [] = xx
  mergeTagOrbit [] yy = yy
  mergeTagOrbit xx@(x:xs) yy@(y:ys) =
    case compare (fst x) (fst y) of
      GT -&gt; y : mergeTagOrbit xx ys
      LT -&gt; x : mergeTagOrbit xs yy
      EQ -&gt; x : mergeTagOrbit xs ys -- keep tag setting over orbit setting.
-}</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679114089"><span class="hs-pragma hs-type">choose</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-257"></span><span>  </span><span class="annot"><a href="#local-6989586621679114089"><span class="hs-identifier hs-type">choose</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span><span>
</span><span id="line-258"></span><span>  </span><span id="local-6989586621679114089"><span class="annot"><span class="annottext">choose :: Maybe (Position, Action) -&gt; Maybe (Position, Action) -&gt; Ordering
</span><a href="#local-6989586621679114089"><span class="hs-identifier hs-var hs-var">choose</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (Position, Action)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Position, Action)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-259"></span><span>  </span><span class="annot"><a href="#local-6989586621679114089"><span class="hs-identifier hs-var">choose</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Position, Action)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span id="local-6989586621679114100"><span class="annot"><span class="annottext">Maybe (Position, Action)
</span><a href="#local-6989586621679114100"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering
</span><a href="Text.Regex.TDFA.Common.html#flipOrder"><span class="hs-identifier hs-var">flipOrder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Position, Action) -&gt; Maybe (Position, Action) -&gt; Ordering
</span><a href="#local-6989586621679114089"><span class="hs-identifier hs-var">choose</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Position, Action)
</span><a href="#local-6989586621679114100"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Position, Action)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>  </span><span class="annot"><a href="#local-6989586621679114089"><span class="hs-identifier hs-var">choose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679114102"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114102"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679114103"><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679114103"><span class="hs-identifier hs-var">_post</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Position, Action)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Array Position OP
</span><a href="#local-6989586621679114072"><span class="hs-identifier hs-var">aTagOP</span></a></span><span class="annot"><span class="annottext">Array Position OP -&gt; Position -&gt; OP
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114102"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-262"></span><span>      </span><span class="annot"><span class="annottext">OP
</span><a href="Text.Regex.TDFA.Common.html#Maximize"><span class="hs-identifier hs-var">Maximize</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span>
</span><span id="line-263"></span><span>      </span><span class="annot"><span class="annottext">OP
</span><a href="Text.Regex.TDFA.Common.html#Minimize"><span class="hs-identifier hs-var">Minimize</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span> </span><span class="hs-comment">-- needed to choose best path inside nested * operators,</span><span>
</span><span id="line-264"></span><span>                    </span><span class="hs-comment">-- this needs a leading Minimize tag inside at least the parent * operator</span><span>
</span><span id="line-265"></span><span>      </span><span class="annot"><span class="annottext">OP
</span><a href="Text.Regex.TDFA.Common.html#Ignore"><span class="hs-identifier hs-var">Ignore</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-comment">-- XXX this is a guess in analogy with Maximize for the end bit of a group</span><span>
</span><span id="line-266"></span><span>      </span><span class="annot"><span class="annottext">OP
</span><a href="Text.Regex.TDFA.Common.html#Orbit"><span class="hs-identifier hs-var">Orbit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span> </span><span class="hs-comment">-- trace (&quot;choose LT! Just &quot;++show tag++&quot; &lt; Nothing&quot;) LT -- 2009 XXX : comment out next line and use the Orbit instead</span><span>
</span><span id="line-267"></span><span class="hs-comment">--      Orbit -&gt; err $ &quot;bestTrans.choose : Very Unexpeted Orbit in Just Nothing: &quot;++show (tag,post,aTagOP,f:fs)</span><span>
</span><span id="line-268"></span><span>  </span><span class="annot"><a href="#local-6989586621679114089"><span class="hs-identifier hs-var">choose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679114108"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114108"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679114109"><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679114109"><span class="hs-identifier hs-var">post1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679114110"><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679114110"><span class="hs-identifier hs-var">post2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Array Position OP
</span><a href="#local-6989586621679114072"><span class="hs-identifier hs-var">aTagOP</span></a></span><span class="annot"><span class="annottext">Array Position OP -&gt; Position -&gt; OP
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114108"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-270"></span><span>      </span><span class="annot"><span class="annottext">OP
</span><a href="Text.Regex.TDFA.Common.html#Maximize"><span class="hs-identifier hs-var">Maximize</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679114111"><span class="hs-identifier hs-var">order</span></a></span><span>
</span><span id="line-271"></span><span>      </span><span class="annot"><span class="annottext">OP
</span><a href="Text.Regex.TDFA.Common.html#Minimize"><span class="hs-identifier hs-var">Minimize</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering
</span><a href="Text.Regex.TDFA.Common.html#flipOrder"><span class="hs-identifier hs-var">flipOrder</span></a></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679114111"><span class="hs-identifier hs-var">order</span></a></span><span>
</span><span id="line-272"></span><span>      </span><span class="annot"><span class="annottext">OP
</span><a href="Text.Regex.TDFA.Common.html#Ignore"><span class="hs-identifier hs-var">Ignore</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-273"></span><span>      </span><span class="annot"><span class="annottext">OP
</span><a href="Text.Regex.TDFA.Common.html#Orbit"><span class="hs-identifier hs-var">Orbit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-274"></span><span class="hs-comment">--      Orbit -&gt; err $ &quot;bestTrans.choose : Very Unexpeted Orbit in Just Just: &quot;++show (tag,(post1,post2),aTagOP,f:fs)</span><span>
</span><span id="line-275"></span><span>   </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679114111"><span class="annot"><span class="annottext">order :: Ordering
</span><a href="#local-6989586621679114111"><span class="hs-identifier hs-var hs-var">order</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679114109"><span class="hs-identifier hs-var">post1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679114110"><span class="hs-identifier hs-var">post2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-276"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPre"><span class="hs-identifier hs-var">SetPre</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPre"><span class="hs-identifier hs-var">SetPre</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-277"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPost"><span class="hs-identifier hs-var">SetPost</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPost"><span class="hs-identifier hs-var">SetPost</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-278"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPre"><span class="hs-identifier hs-var">SetPre</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPost"><span class="hs-identifier hs-var">SetPost</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span>
</span><span id="line-279"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPost"><span class="hs-identifier hs-var">SetPost</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPre"><span class="hs-identifier hs-var">SetPre</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span>
</span><span id="line-280"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#SetVal"><span class="hs-identifier hs-type">SetVal</span></a></span><span> </span><span id="local-6989586621679114121"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114121"><span class="hs-identifier hs-var">v1</span></a></span></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#SetVal"><span class="hs-identifier hs-type">SetVal</span></a></span><span> </span><span id="local-6989586621679114122"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114122"><span class="hs-identifier hs-var">v2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Position -&gt; Position -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114121"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114122"><span class="hs-identifier hs-var">v2</span></a></span><span>
</span><span id="line-281"></span><span>                   </span><span class="annot"><span class="annottext">(Action, Action)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Ordering
forall a. String -&gt; a
</span><a href="Text.Regex.TDFA.TDFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Ordering) -&gt; String -&gt; Ordering
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bestTrans.compareWith.choose sees incomparable &quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">(Position, Action, Action) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114108"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679114109"><span class="hs-identifier hs-var">post1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679114110"><span class="hs-identifier hs-var">post2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679114088"><span class="hs-pragma hs-type">compareWith</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-285"></span><span>  </span><span id="local-6989586621679113740"><span id="local-6989586621679113741"><span id="local-6989586621679113742"><span id="local-6989586621679113743"><span class="annot"><a href="#local-6989586621679114088"><span class="hs-identifier hs-type">compareWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679113740"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679113741"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679113740"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679113742"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679113740"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679113743"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679113741"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679113740"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679113742"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679113740"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679113743"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679113741"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-286"></span><span>  </span><span id="local-6989586621679114088"><span class="annot"><span class="annottext">compareWith :: forall x a b c.
(Ord x, Monoid a) =&gt;
(Maybe (x, b) -&gt; Maybe (x, c) -&gt; a) -&gt; [(x, b)] -&gt; [(x, c)] -&gt; a
</span><a href="#local-6989586621679114088"><span class="hs-identifier hs-var hs-var">compareWith</span></a></span></span><span> </span><span id="local-6989586621679114129"><span class="annot"><span class="annottext">Maybe (x, b) -&gt; Maybe (x, c) -&gt; a
</span><a href="#local-6989586621679114129"><span class="hs-identifier hs-var">comp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(x, b)] -&gt; [(x, c)] -&gt; a
</span><a href="#local-6989586621679114130"><span class="hs-identifier hs-var">cw</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-287"></span><span>    </span><span id="local-6989586621679114130"><span class="annot"><span class="annottext">cw :: [(x, b)] -&gt; [(x, c)] -&gt; a
</span><a href="#local-6989586621679114130"><span class="hs-identifier hs-var hs-var">cw</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (x, b) -&gt; Maybe (x, c) -&gt; a
</span><a href="#local-6989586621679114129"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (x, b)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe (x, c)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-288"></span><span>    </span><span class="annot"><a href="#local-6989586621679114130"><span class="hs-identifier hs-var">cw</span></a></span><span> </span><span id="local-6989586621679114143"><span class="annot"><span class="annottext">xx :: [(x, b)]
</span><a href="#local-6989586621679114143"><span class="hs-identifier hs-var">xx</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679114144"><span class="annot"><span class="annottext">(x, b)
</span><a href="#local-6989586621679114144"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679114145"><span class="annot"><span class="annottext">[(x, b)]
</span><a href="#local-6989586621679114145"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679114146"><span class="annot"><span class="annottext">yy :: [(x, c)]
</span><a href="#local-6989586621679114146"><span class="hs-identifier hs-var">yy</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679114147"><span class="annot"><span class="annottext">(x, c)
</span><a href="#local-6989586621679114147"><span class="hs-identifier hs-var">y</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679114148"><span class="annot"><span class="annottext">[(x, c)]
</span><a href="#local-6989586621679114148"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-289"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">x -&gt; x -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(x, b) -&gt; x
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(x, b)
</span><a href="#local-6989586621679114144"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(x, c) -&gt; x
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(x, c)
</span><a href="#local-6989586621679114147"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-290"></span><span>        </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (x, b) -&gt; Maybe (x, c) -&gt; a
</span><a href="#local-6989586621679114129"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (x, b)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(x, c) -&gt; Maybe (x, c)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(x, c)
</span><a href="#local-6989586621679114147"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">[(x, b)] -&gt; [(x, c)] -&gt; a
</span><a href="#local-6989586621679114130"><span class="hs-identifier hs-var">cw</span></a></span><span> </span><span class="annot"><span class="annottext">[(x, b)]
</span><a href="#local-6989586621679114143"><span class="hs-identifier hs-var">xx</span></a></span><span> </span><span class="annot"><span class="annottext">[(x, c)]
</span><a href="#local-6989586621679114148"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-291"></span><span>        </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (x, b) -&gt; Maybe (x, c) -&gt; a
</span><a href="#local-6989586621679114129"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(x, b) -&gt; Maybe (x, b)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(x, b)
</span><a href="#local-6989586621679114144"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(x, c) -&gt; Maybe (x, c)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(x, c)
</span><a href="#local-6989586621679114147"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">[(x, b)] -&gt; [(x, c)] -&gt; a
</span><a href="#local-6989586621679114130"><span class="hs-identifier hs-var">cw</span></a></span><span> </span><span class="annot"><span class="annottext">[(x, b)]
</span><a href="#local-6989586621679114145"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[(x, c)]
</span><a href="#local-6989586621679114148"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-292"></span><span>        </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (x, b) -&gt; Maybe (x, c) -&gt; a
</span><a href="#local-6989586621679114129"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(x, b) -&gt; Maybe (x, b)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(x, b)
</span><a href="#local-6989586621679114144"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (x, c)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">[(x, b)] -&gt; [(x, c)] -&gt; a
</span><a href="#local-6989586621679114130"><span class="hs-identifier hs-var">cw</span></a></span><span> </span><span class="annot"><span class="annottext">[(x, b)]
</span><a href="#local-6989586621679114145"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[(x, c)]
</span><a href="#local-6989586621679114146"><span class="hs-identifier hs-var">yy</span></a></span><span>
</span><span id="line-293"></span><span>    </span><span class="annot"><a href="#local-6989586621679114130"><span class="hs-identifier hs-var">cw</span></a></span><span> </span><span id="local-6989586621679114150"><span class="annot"><span class="annottext">[(x, b)]
</span><a href="#local-6989586621679114150"><span class="hs-identifier hs-var">xx</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((x, b) -&gt; a -&gt; a) -&gt; a -&gt; [(x, b)] -&gt; a
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679114152"><span class="annot"><span class="annottext">(x, b)
</span><a href="#local-6989586621679114152"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679114153"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679114153"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (x, b) -&gt; Maybe (x, c) -&gt; a
</span><a href="#local-6989586621679114129"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(x, b) -&gt; Maybe (x, b)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(x, b)
</span><a href="#local-6989586621679114152"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (x, c)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679114153"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">[(x, b)]
</span><a href="#local-6989586621679114150"><span class="hs-identifier hs-var">xx</span></a></span><span>
</span><span id="line-294"></span><span>    </span><span class="annot"><a href="#local-6989586621679114130"><span class="hs-identifier hs-var">cw</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679114154"><span class="annot"><span class="annottext">[(x, c)]
</span><a href="#local-6989586621679114154"><span class="hs-identifier hs-var">yy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((x, c) -&gt; a -&gt; a) -&gt; a -&gt; [(x, c)] -&gt; a
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679114155"><span class="annot"><span class="annottext">(x, c)
</span><a href="#local-6989586621679114155"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679114156"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679114156"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (x, b) -&gt; Maybe (x, c) -&gt; a
</span><a href="#local-6989586621679114129"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (x, b)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(x, c) -&gt; Maybe (x, c)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(x, c)
</span><a href="#local-6989586621679114155"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679114156"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">[(x, c)]
</span><a href="#local-6989586621679114154"><span class="hs-identifier hs-var">yy</span></a></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#isDFAFrontAnchored"><span class="hs-identifier hs-type">isDFAFrontAnchored</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DFA"><span class="hs-identifier hs-type">DFA</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-298"></span><span id="isDFAFrontAnchored"><span class="annot"><span class="annottext">isDFAFrontAnchored :: DFA -&gt; Bool
</span><a href="Text.Regex.TDFA.TDFA.html#isDFAFrontAnchored"><span class="hs-identifier hs-var hs-var">isDFAFrontAnchored</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DT -&gt; Bool
</span><a href="#local-6989586621679114157"><span class="hs-identifier hs-var">isDTFrontAnchored</span></a></span><span> </span><span class="annot"><span class="annottext">(DT -&gt; Bool) -&gt; (DFA -&gt; DT) -&gt; DFA -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DFA -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#d_dt"><span class="hs-identifier hs-var">d_dt</span></a></span><span>
</span><span id="line-299"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-300"></span><span>  </span><span class="annot"><a href="#local-6989586621679114157"><span class="hs-identifier hs-type">isDTFrontAnchored</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DT"><span class="hs-identifier hs-type">DT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-301"></span><span>  </span><span id="local-6989586621679114157"><span class="annot"><span class="annottext">isDTFrontAnchored :: DT -&gt; Bool
</span><a href="#local-6989586621679114157"><span class="hs-identifier hs-var hs-var">isDTFrontAnchored</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple%27"><span class="hs-identifier hs-type">Simple'</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-302"></span><span>  </span><span class="annot"><a href="#local-6989586621679114157"><span class="hs-identifier hs-var">isDTFrontAnchored</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing%27"><span class="hs-identifier hs-type">Testing'</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">dt_test :: DT -&gt; WhichTest
</span><a href="Text.Regex.TDFA.Common.html#dt_test"><span class="hs-identifier hs-var">dt_test</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679114158"><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679114158"><span class="hs-identifier hs-var">wt</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">dt_a :: DT -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#dt_a"><span class="hs-identifier hs-var">dt_a</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679114159"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114159"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">dt_b :: DT -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#dt_b"><span class="hs-identifier hs-var">dt_b</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679114160"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114160"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679114158"><span class="hs-identifier hs-var">wt</span></a></span><span> </span><span class="annot"><span class="annottext">WhichTest -&gt; WhichTest -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="Text.Regex.TDFA.Common.html#Test_BOL"><span class="hs-identifier hs-var">Test_BOL</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DT -&gt; Bool
</span><a href="#local-6989586621679114162"><span class="hs-identifier hs-var">isDTLosing</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114160"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-303"></span><span>                                                          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DT -&gt; Bool
</span><a href="#local-6989586621679114157"><span class="hs-identifier hs-var">isDTFrontAnchored</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114159"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">DT -&gt; Bool
</span><a href="#local-6989586621679114157"><span class="hs-identifier hs-var">isDTFrontAnchored</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114160"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-304"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-comment">-- can DT never win or accept a character (when following trans_single)?</span><span>
</span><span id="line-306"></span><span>    </span><span class="annot"><a href="#local-6989586621679114162"><span class="hs-identifier hs-type">isDTLosing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DT"><span class="hs-identifier hs-type">DT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-307"></span><span>    </span><span id="local-6989586621679114162"><span class="annot"><span class="annottext">isDTLosing :: DT -&gt; Bool
</span><a href="#local-6989586621679114162"><span class="hs-identifier hs-var hs-var">isDTLosing</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing%27"><span class="hs-identifier hs-type">Testing'</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">dt_a :: DT -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#dt_a"><span class="hs-identifier hs-var">dt_a</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679114163"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114163"><span class="hs-identifier hs-var">a'</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">dt_b :: DT -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#dt_b"><span class="hs-identifier hs-var">dt_b</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679114164"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114164"><span class="hs-identifier hs-var">b'</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DT -&gt; Bool
</span><a href="#local-6989586621679114162"><span class="hs-identifier hs-var">isDTLosing</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114163"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">DT -&gt; Bool
</span><a href="#local-6989586621679114162"><span class="hs-identifier hs-var">isDTLosing</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679114164"><span class="hs-identifier hs-var">b'</span></a></span><span>
</span><span id="line-308"></span><span>    </span><span class="annot"><a href="#local-6989586621679114162"><span class="hs-identifier hs-var">isDTLosing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple%27"><span class="hs-identifier hs-type">Simple'</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">dt_win :: DT -&gt; IntMap Instructions
</span><a href="Text.Regex.TDFA.Common.html#dt_win"><span class="hs-identifier hs-var">dt_win</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679114165"><span class="annot"><span class="annottext">IntMap Instructions
</span><a href="#local-6989586621679114165"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntMap Instructions -&gt; Bool
forall a. IntMap a -&gt; Bool
</span><span class="hs-identifier hs-var">IMap.null</span></span><span> </span><span class="annot"><span class="annottext">IntMap Instructions
</span><a href="#local-6989586621679114165"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- can win with 0 characters</span><span>
</span><span id="line-309"></span><span>    </span><span class="annot"><a href="#local-6989586621679114162"><span class="hs-identifier hs-var">isDTLosing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple%27"><span class="hs-identifier hs-type">Simple'</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">dt_trans :: DT -&gt; CharMap Transition
</span><a href="Text.Regex.TDFA.Common.html#dt_trans"><span class="hs-identifier hs-var">dt_trans</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-type">CharMap</span></a></span><span> </span><span id="local-6989586621679114166"><span class="annot"><span class="annottext">IntMap Transition
</span><a href="#local-6989586621679114166"><span class="hs-identifier hs-var">mt</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">dt_other :: DT -&gt; Transition
</span><a href="Text.Regex.TDFA.Common.html#dt_other"><span class="hs-identifier hs-var">dt_other</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679114167"><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679114167"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-310"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679114168"><span class="annot"><span class="annottext">ts :: [Transition]
</span><a href="#local-6989586621679114168"><span class="hs-identifier hs-var hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679114167"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Transition -&gt; [Transition] -&gt; [Transition]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">IntMap Transition -&gt; [Transition]
forall a. IntMap a -&gt; [a]
</span><span class="hs-identifier hs-var">IMap.elems</span></span><span> </span><span class="annot"><span class="annottext">IntMap Transition
</span><a href="#local-6989586621679114166"><span class="hs-identifier hs-var">mt</span></a></span><span>
</span><span id="line-311"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Transition -&gt; Bool) -&gt; [Transition] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Transition -&gt; Bool
</span><a href="#local-6989586621679114170"><span class="hs-identifier hs-var">transLoses</span></a></span><span> </span><span class="annot"><span class="annottext">[Transition]
</span><a href="#local-6989586621679114168"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-312"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-313"></span><span>      </span><span class="annot"><a href="#local-6989586621679114170"><span class="hs-identifier hs-type">transLoses</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-314"></span><span>      </span><span id="local-6989586621679114170"><span class="annot"><span class="annottext">transLoses :: Transition -&gt; Bool
</span><a href="#local-6989586621679114170"><span class="hs-identifier hs-var hs-var">transLoses</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">trans_single :: Transition -&gt; DFA
</span><a href="Text.Regex.TDFA.Common.html#trans_single"><span class="hs-identifier hs-var">trans_single</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679114171"><span class="annot"><span class="annottext">DFA
</span><a href="#local-6989586621679114171"><span class="hs-identifier hs-var">dfa</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">trans_how :: Transition -&gt; DTrans
</span><a href="Text.Regex.TDFA.Common.html#trans_how"><span class="hs-identifier hs-var">trans_how</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679114172"><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679114172"><span class="hs-identifier hs-var">dtrans</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DFA -&gt; Bool
</span><a href="#local-6989586621679114173"><span class="hs-identifier hs-var">isDTLose</span></a></span><span> </span><span class="annot"><span class="annottext">DFA
</span><a href="#local-6989586621679114171"><span class="hs-identifier hs-var">dfa</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">DTrans -&gt; Bool
</span><a href="#local-6989586621679114175"><span class="hs-identifier hs-var">onlySpawns</span></a></span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679114172"><span class="hs-identifier hs-var">dtrans</span></a></span><span>
</span><span id="line-315"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-316"></span><span>        </span><span class="annot"><a href="#local-6989586621679114173"><span class="hs-identifier hs-type">isDTLose</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DFA"><span class="hs-identifier hs-type">DFA</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-317"></span><span>        </span><span id="local-6989586621679114173"><span class="annot"><span class="annottext">isDTLose :: DFA -&gt; Bool
</span><a href="#local-6989586621679114173"><span class="hs-identifier hs-var hs-var">isDTLose</span></a></span></span><span> </span><span id="local-6989586621679114176"><span class="annot"><span class="annottext">DFA
</span><a href="#local-6989586621679114176"><span class="hs-identifier hs-var">dfa'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SetIndex -&gt; Bool
</span><span class="hs-identifier hs-var">ISet.null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DFA -&gt; SetIndex
</span><a href="Text.Regex.TDFA.Common.html#d_id"><span class="hs-identifier hs-var">d_id</span></a></span><span> </span><span class="annot"><span class="annottext">DFA
</span><a href="#local-6989586621679114176"><span class="hs-identifier hs-var">dfa'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>        </span><span class="annot"><a href="#local-6989586621679114175"><span class="hs-identifier hs-type">onlySpawns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DTrans"><span class="hs-identifier hs-type">DTrans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-319"></span><span>        </span><span id="local-6989586621679114175"><span class="annot"><span class="annottext">onlySpawns :: DTrans -&gt; Bool
</span><a href="#local-6989586621679114175"><span class="hs-identifier hs-var hs-var">onlySpawns</span></a></span></span><span> </span><span id="local-6989586621679114177"><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679114177"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DTrans -&gt; [IntMap (DoPa, Instructions)]
forall a. IntMap a -&gt; [a]
</span><span class="hs-identifier hs-var">IMap.elems</span></span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679114177"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-320"></span><span>                         </span><span class="hs-special">[</span><span id="local-6989586621679114178"><span class="annot"><span class="annottext">IntMap (DoPa, Instructions)
</span><a href="#local-6989586621679114178"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IntMap (DoPa, Instructions) -&gt; Bool
forall a. IntMap a -&gt; Bool
</span><span class="hs-identifier hs-var">IMap.null</span></span><span> </span><span class="annot"><span class="annottext">IntMap (DoPa, Instructions)
</span><a href="#local-6989586621679114178"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-321"></span><span>                         </span><span class="annot"><span class="annottext">[IntMap (DoPa, Instructions)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="hs-comment">{- toInstructions -}</span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#toInstructions"><span class="hs-identifier hs-type">toInstructions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagList"><span class="hs-identifier hs-type">TagList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Instructions"><span class="hs-identifier hs-type">Instructions</span></a></span><span>
</span><span id="line-326"></span><span id="toInstructions"><span class="annot"><span class="annottext">toInstructions :: WinTags -&gt; Instructions
</span><a href="Text.Regex.TDFA.TDFA.html#toInstructions"><span class="hs-identifier hs-var hs-var">toInstructions</span></a></span></span><span> </span><span id="local-6989586621679114180"><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679114180"><span class="hs-identifier hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-327"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679114183"><span class="annot"><span class="annottext">IntMap Action
</span><a href="#local-6989586621679114183"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679114184"><span class="annot"><span class="annottext">IntMap AlterOrbit
</span><a href="#local-6989586621679114184"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State (IntMap Action, IntMap AlterOrbit) ()
-&gt; (IntMap Action, IntMap AlterOrbit)
-&gt; (IntMap Action, IntMap AlterOrbit)
forall s a. State s a -&gt; s -&gt; s
</span><span class="hs-identifier hs-var">execState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WinTags -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#assemble"><span class="hs-identifier hs-var">assemble</span></a></span><span> </span><span class="annot"><span class="annottext">WinTags
</span><a href="#local-6989586621679114180"><span class="hs-identifier hs-var">spec</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntMap Action
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">IntMap AlterOrbit
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Instructions"><span class="hs-identifier hs-type">Instructions</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">newPos :: [(Position, Action)]
</span><a href="Text.Regex.TDFA.Common.html#newPos"><span class="hs-identifier hs-var">newPos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap Action -&gt; [(Position, Action)]
forall a. IntMap a -&gt; [(Position, a)]
</span><span class="hs-identifier hs-var">IMap.toList</span></span><span> </span><span class="annot"><span class="annottext">IntMap Action
</span><a href="#local-6989586621679114183"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-329"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">newOrbits :: Maybe (Position -&gt; OrbitTransformer)
</span><a href="Text.Regex.TDFA.Common.html#newOrbits"><span class="hs-identifier hs-var">newOrbits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">IntMap AlterOrbit -&gt; Bool
forall a. IntMap a -&gt; Bool
</span><span class="hs-identifier hs-var">IMap.null</span></span><span> </span><span class="annot"><span class="annottext">IntMap AlterOrbit
</span><a href="#local-6989586621679114184"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe (Position -&gt; OrbitTransformer)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-330"></span><span>                                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(Position -&gt; OrbitTransformer)
-&gt; Maybe (Position -&gt; OrbitTransformer)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">((Position -&gt; OrbitTransformer)
 -&gt; Maybe (Position -&gt; OrbitTransformer))
-&gt; (Position -&gt; OrbitTransformer)
-&gt; Maybe (Position -&gt; OrbitTransformer)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Position, AlterOrbit)] -&gt; Position -&gt; OrbitTransformer
</span><a href="Text.Regex.TDFA.TDFA.html#alterOrbits"><span class="hs-identifier hs-var">alterOrbits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntMap AlterOrbit -&gt; [(Position, AlterOrbit)]
forall a. IntMap a -&gt; [(Position, a)]
</span><span class="hs-identifier hs-var">IMap.toList</span></span><span> </span><span class="annot"><span class="annottext">IntMap AlterOrbit
</span><a href="#local-6989586621679114184"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span class="hs-keyword">type</span><span> </span><span id="CompileInstructions"><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#CompileInstructions"><span class="hs-identifier hs-var">CompileInstructions</span></a></span></span><span> </span><span id="local-6989586621679114189"><span class="annot"><a href="#local-6989586621679114189"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="hs-comment">-- 2009: change to SetPre | SetPost enum</span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#AlterOrbit"><span class="hs-identifier hs-type">AlterOrbit</span></a></span><span>
</span><span id="line-336"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679114189"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span class="hs-keyword">data</span><span> </span><span id="AlterOrbit"><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#AlterOrbit"><span class="hs-identifier hs-var">AlterOrbit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AlterReset"><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#AlterReset"><span class="hs-identifier hs-var">AlterReset</span></a></span></span><span>                        </span><span class="hs-comment">-- removing the Orbits record from the OrbitLog</span><span>
</span><span id="line-339"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span id="AlterLeave"><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#AlterLeave"><span class="hs-identifier hs-var">AlterLeave</span></a></span></span><span>                        </span><span class="hs-comment">-- set inOrbit to False</span><span>
</span><span id="line-340"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span id="AlterModify"><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#AlterModify"><span class="hs-identifier hs-var">AlterModify</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="newInOrbit"><span class="annot"><span class="annottext">AlterOrbit -&gt; Bool
</span><a href="Text.Regex.TDFA.TDFA.html#newInOrbit"><span class="hs-identifier hs-var hs-var">newInOrbit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>   </span><span class="hs-comment">-- set inOrbit to the newInOrbit value</span><span>
</span><span id="line-341"></span><span>                              </span><span class="hs-special">,</span><span> </span><span id="freshOrbit"><span class="annot"><span class="annottext">AlterOrbit -&gt; Bool
</span><a href="Text.Regex.TDFA.TDFA.html#freshOrbit"><span class="hs-identifier hs-var hs-var">freshOrbit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">}</span><span>  </span><span class="hs-comment">-- freshOrbit of True means to set getOrbits to mempty</span><span>
</span><span id="line-342"></span><span>                  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679114196"><span id="local-6989586621679114202"><span id="local-6989586621679114206"><span class="annot"><span class="annottext">Position -&gt; AlterOrbit -&gt; String -&gt; String
[AlterOrbit] -&gt; String -&gt; String
AlterOrbit -&gt; String
(Position -&gt; AlterOrbit -&gt; String -&gt; String)
-&gt; (AlterOrbit -&gt; String)
-&gt; ([AlterOrbit] -&gt; String -&gt; String)
-&gt; Show AlterOrbit
forall a.
(Position -&gt; a -&gt; String -&gt; String)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; String -&gt; String) -&gt; Show a
$cshowsPrec :: Position -&gt; AlterOrbit -&gt; String -&gt; String
showsPrec :: Position -&gt; AlterOrbit -&gt; String -&gt; String
$cshow :: AlterOrbit -&gt; String
show :: AlterOrbit -&gt; String
$cshowList :: [AlterOrbit] -&gt; String -&gt; String
showList :: [AlterOrbit] -&gt; String -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>                   </span><span class="hs-comment">-- freshOrbit of False means try appending position or else Seq.empty</span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#assemble"><span class="hs-identifier hs-type">assemble</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagList"><span class="hs-identifier hs-type">TagList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#CompileInstructions"><span class="hs-identifier hs-type">CompileInstructions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span id="assemble"><span class="annot"><span class="annottext">assemble :: WinTags -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#assemble"><span class="hs-identifier hs-var hs-var">assemble</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Position, TagUpdate)
 -&gt; State (IntMap Action, IntMap AlterOrbit) ())
-&gt; WinTags -&gt; State (IntMap Action, IntMap AlterOrbit) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">(Position, TagUpdate)
-&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="#local-6989586621679114210"><span class="hs-identifier hs-var">oneInstruction</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-346"></span><span>  </span><span id="local-6989586621679114210"><span class="annot"><span class="annottext">oneInstruction :: (Position, TagUpdate)
-&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="#local-6989586621679114210"><span class="hs-identifier hs-var hs-var">oneInstruction</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679114216"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114216"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679114217"><span class="annot"><span class="annottext">TagUpdate
</span><a href="#local-6989586621679114217"><span class="hs-identifier hs-var">command</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TagUpdate
</span><a href="#local-6989586621679114217"><span class="hs-identifier hs-var">command</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-348"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-type">PreUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#TagTask"><span class="hs-identifier hs-var">TagTask</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#setPreTag"><span class="hs-identifier hs-var">setPreTag</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114216"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-349"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-type">PreUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#ResetGroupStopTask"><span class="hs-identifier hs-var">ResetGroupStopTask</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#resetGroupTag"><span class="hs-identifier hs-var">resetGroupTag</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114216"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-350"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-type">PreUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#SetGroupStopTask"><span class="hs-identifier hs-var">SetGroupStopTask</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#setGroupTag"><span class="hs-identifier hs-var">setGroupTag</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114216"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-351"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-type">PreUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#ResetOrbitTask"><span class="hs-identifier hs-var">ResetOrbitTask</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#resetOrbit"><span class="hs-identifier hs-var">resetOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114216"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-352"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-type">PreUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#EnterOrbitTask"><span class="hs-identifier hs-var">EnterOrbitTask</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#enterOrbit"><span class="hs-identifier hs-var">enterOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114216"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-353"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-type">PreUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#LeaveOrbitTask"><span class="hs-identifier hs-var">LeaveOrbitTask</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#leaveOrbit"><span class="hs-identifier hs-var">leaveOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114216"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-354"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#PostUpdate"><span class="hs-identifier hs-type">PostUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#TagTask"><span class="hs-identifier hs-var">TagTask</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#setPostTag"><span class="hs-identifier hs-var">setPostTag</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114216"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-355"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#PostUpdate"><span class="hs-identifier hs-type">PostUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#ResetGroupStopTask"><span class="hs-identifier hs-var">ResetGroupStopTask</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#resetGroupTag"><span class="hs-identifier hs-var">resetGroupTag</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114216"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-356"></span><span>      </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#PostUpdate"><span class="hs-identifier hs-type">PostUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#SetGroupStopTask"><span class="hs-identifier hs-var">SetGroupStopTask</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#setGroupTag"><span class="hs-identifier hs-var">setGroupTag</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114216"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-357"></span><span>      </span><span class="annot"><span class="annottext">TagUpdate
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; State (IntMap Action, IntMap AlterOrbit) ()
forall a. String -&gt; a
</span><a href="Text.Regex.TDFA.TDFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;assemble : Weird orbit command: &quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">(Position, TagUpdate) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114216"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagUpdate
</span><a href="#local-6989586621679114217"><span class="hs-identifier hs-var">command</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#setPreTag"><span class="hs-identifier hs-type">setPreTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#CompileInstructions"><span class="hs-identifier hs-type">CompileInstructions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span id="setPreTag"><span class="annot"><span class="annottext">setPreTag :: Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#setPreTag"><span class="hs-identifier hs-var hs-var">setPreTag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Action -&gt; Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#modifyPos"><span class="hs-identifier hs-var">modifyPos</span></a></span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPre"><span class="hs-identifier hs-var">SetPre</span></a></span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#setPostTag"><span class="hs-identifier hs-type">setPostTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#CompileInstructions"><span class="hs-identifier hs-type">CompileInstructions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span id="setPostTag"><span class="annot"><span class="annottext">setPostTag :: Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#setPostTag"><span class="hs-identifier hs-var hs-var">setPostTag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Action -&gt; Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#modifyPos"><span class="hs-identifier hs-var">modifyPos</span></a></span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPost"><span class="hs-identifier hs-var">SetPost</span></a></span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#resetGroupTag"><span class="hs-identifier hs-type">resetGroupTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#CompileInstructions"><span class="hs-identifier hs-type">CompileInstructions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span id="resetGroupTag"><span class="annot"><span class="annottext">resetGroupTag :: Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#resetGroupTag"><span class="hs-identifier hs-var hs-var">resetGroupTag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Action -&gt; Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#modifyPos"><span class="hs-identifier hs-var">modifyPos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position -&gt; Action
</span><a href="Text.Regex.TDFA.Common.html#SetVal"><span class="hs-identifier hs-var">SetVal</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Position
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#setGroupTag"><span class="hs-identifier hs-type">setGroupTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#CompileInstructions"><span class="hs-identifier hs-type">CompileInstructions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span id="setGroupTag"><span class="annot"><span class="annottext">setGroupTag :: Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#setGroupTag"><span class="hs-identifier hs-var hs-var">setGroupTag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Action -&gt; Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#modifyPos"><span class="hs-identifier hs-var">modifyPos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position -&gt; Action
</span><a href="Text.Regex.TDFA.Common.html#SetVal"><span class="hs-identifier hs-var">SetVal</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span class="hs-comment">-- The following is ten times more complicated than it ought to be.  Sorry, I was too new, and now</span><span>
</span><span id="line-372"></span><span class="hs-comment">-- too busy to clean this up.</span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#resetOrbit"><span class="hs-identifier hs-type">resetOrbit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#CompileInstructions"><span class="hs-identifier hs-type">CompileInstructions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span id="resetOrbit"><span class="annot"><span class="annottext">resetOrbit :: Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#resetOrbit"><span class="hs-identifier hs-var hs-var">resetOrbit</span></a></span></span><span> </span><span id="local-6989586621679114234"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114234"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Action -&gt; Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#modifyPos"><span class="hs-identifier hs-var">modifyPos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position -&gt; Action
</span><a href="Text.Regex.TDFA.Common.html#SetVal"><span class="hs-identifier hs-var">SetVal</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Position
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114234"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">State (IntMap Action, IntMap AlterOrbit) ()
-&gt; State (IntMap Action, IntMap AlterOrbit) ()
-&gt; State (IntMap Action, IntMap AlterOrbit) ()
forall a b.
StateT (IntMap Action, IntMap AlterOrbit) Identity a
-&gt; StateT (IntMap Action, IntMap AlterOrbit) Identity b
-&gt; StateT (IntMap Action, IntMap AlterOrbit) Identity b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(IntMap AlterOrbit -&gt; IntMap AlterOrbit)
-&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#modifyOrbit"><span class="hs-identifier hs-var">modifyOrbit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position -&gt; AlterOrbit -&gt; IntMap AlterOrbit -&gt; IntMap AlterOrbit
forall a. Position -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.insert</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114234"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">AlterOrbit
</span><a href="Text.Regex.TDFA.TDFA.html#AlterReset"><span class="hs-identifier hs-var">AlterReset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#enterOrbit"><span class="hs-identifier hs-type">enterOrbit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#CompileInstructions"><span class="hs-identifier hs-type">CompileInstructions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span id="enterOrbit"><span class="annot"><span class="annottext">enterOrbit :: Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#enterOrbit"><span class="hs-identifier hs-var hs-var">enterOrbit</span></a></span></span><span> </span><span id="local-6989586621679114236"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114236"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Action -&gt; Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#modifyPos"><span class="hs-identifier hs-var">modifyPos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position -&gt; Action
</span><a href="Text.Regex.TDFA.Common.html#SetVal"><span class="hs-identifier hs-var">SetVal</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114236"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">State (IntMap Action, IntMap AlterOrbit) ()
-&gt; State (IntMap Action, IntMap AlterOrbit) ()
-&gt; State (IntMap Action, IntMap AlterOrbit) ()
forall a b.
StateT (IntMap Action, IntMap AlterOrbit) Identity a
-&gt; StateT (IntMap Action, IntMap AlterOrbit) Identity b
-&gt; StateT (IntMap Action, IntMap AlterOrbit) Identity b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(IntMap AlterOrbit -&gt; IntMap AlterOrbit)
-&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#modifyOrbit"><span class="hs-identifier hs-var">modifyOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap AlterOrbit -&gt; IntMap AlterOrbit
</span><a href="#local-6989586621679114237"><span class="hs-identifier hs-var">changeOrbit</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-379"></span><span>  </span><span id="local-6989586621679114237"><span class="annot"><span class="annottext">changeOrbit :: IntMap AlterOrbit -&gt; IntMap AlterOrbit
</span><a href="#local-6989586621679114237"><span class="hs-identifier hs-var hs-var">changeOrbit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AlterOrbit -&gt; AlterOrbit -&gt; AlterOrbit)
-&gt; Position -&gt; AlterOrbit -&gt; IntMap AlterOrbit -&gt; IntMap AlterOrbit
forall a. (a -&gt; a -&gt; a) -&gt; Position -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.insertWith</span></span><span> </span><span class="annot"><span class="annottext">AlterOrbit -&gt; AlterOrbit -&gt; AlterOrbit
forall {p}. p -&gt; AlterOrbit -&gt; AlterOrbit
</span><a href="#local-6989586621679114238"><span class="hs-identifier hs-var">overwriteOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114236"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">AlterOrbit
</span><a href="#local-6989586621679114239"><span class="hs-identifier hs-var">appendNewOrbit</span></a></span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span>  </span><span id="local-6989586621679114239"><span class="annot"><span class="annottext">appendNewOrbit :: AlterOrbit
</span><a href="#local-6989586621679114239"><span class="hs-identifier hs-var hs-var">appendNewOrbit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#AlterModify"><span class="hs-identifier hs-type">AlterModify</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">newInOrbit :: Bool
</span><a href="Text.Regex.TDFA.TDFA.html#newInOrbit"><span class="hs-identifier hs-var">newInOrbit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">freshOrbit :: Bool
</span><a href="Text.Regex.TDFA.TDFA.html#freshOrbit"><span class="hs-identifier hs-var">freshOrbit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">}</span><span> </span><span class="hs-comment">-- try to append</span><span>
</span><span id="line-382"></span><span>  </span><span id="local-6989586621679114240"><span class="annot"><span class="annottext">startNewOrbit :: AlterOrbit
</span><a href="#local-6989586621679114240"><span class="hs-identifier hs-var hs-var">startNewOrbit</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#AlterModify"><span class="hs-identifier hs-type">AlterModify</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">newInOrbit :: Bool
</span><a href="Text.Regex.TDFA.TDFA.html#newInOrbit"><span class="hs-identifier hs-var">newInOrbit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">freshOrbit :: Bool
</span><a href="Text.Regex.TDFA.TDFA.html#freshOrbit"><span class="hs-identifier hs-var">freshOrbit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">}</span><span>  </span><span class="hs-comment">-- will start a new series</span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span>  </span><span id="local-6989586621679114238"><span class="annot"><span class="annottext">overwriteOrbit :: p -&gt; AlterOrbit -&gt; AlterOrbit
</span><a href="#local-6989586621679114238"><span class="hs-identifier hs-var hs-var">overwriteOrbit</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AlterOrbit
</span><a href="Text.Regex.TDFA.TDFA.html#AlterReset"><span class="hs-identifier hs-var">AlterReset</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AlterOrbit
</span><a href="#local-6989586621679114240"><span class="hs-identifier hs-var">startNewOrbit</span></a></span><span>
</span><span id="line-385"></span><span>  </span><span class="annot"><a href="#local-6989586621679114238"><span class="hs-identifier hs-var">overwriteOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AlterOrbit
</span><a href="Text.Regex.TDFA.TDFA.html#AlterLeave"><span class="hs-identifier hs-var">AlterLeave</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AlterOrbit
</span><a href="#local-6989586621679114240"><span class="hs-identifier hs-var">startNewOrbit</span></a></span><span>
</span><span id="line-386"></span><span>  </span><span class="annot"><a href="#local-6989586621679114238"><span class="hs-identifier hs-var">overwriteOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#AlterModify"><span class="hs-identifier hs-type">AlterModify</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">newInOrbit :: AlterOrbit -&gt; Bool
</span><a href="Text.Regex.TDFA.TDFA.html#newInOrbit"><span class="hs-identifier hs-var">newInOrbit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AlterOrbit
</span><a href="#local-6989586621679114240"><span class="hs-identifier hs-var">startNewOrbit</span></a></span><span>
</span><span id="line-387"></span><span>  </span><span class="annot"><a href="#local-6989586621679114238"><span class="hs-identifier hs-var">overwriteOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#AlterModify"><span class="hs-identifier hs-type">AlterModify</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">newInOrbit :: AlterOrbit -&gt; Bool
</span><a href="Text.Regex.TDFA.TDFA.html#newInOrbit"><span class="hs-identifier hs-var">newInOrbit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-388"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; AlterOrbit
forall a. String -&gt; a
</span><a href="Text.Regex.TDFA.TDFA.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; AlterOrbit) -&gt; String -&gt; AlterOrbit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;enterOrbit: Cannot enterOrbit twice in a row: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114236"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#leaveOrbit"><span class="hs-identifier hs-type">leaveOrbit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#CompileInstructions"><span class="hs-identifier hs-type">CompileInstructions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span id="leaveOrbit"><span class="annot"><span class="annottext">leaveOrbit :: Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#leaveOrbit"><span class="hs-identifier hs-var hs-var">leaveOrbit</span></a></span></span><span> </span><span id="local-6989586621679114242"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114242"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IntMap AlterOrbit -&gt; IntMap AlterOrbit)
-&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#modifyOrbit"><span class="hs-identifier hs-var">modifyOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap AlterOrbit -&gt; IntMap AlterOrbit
</span><a href="#local-6989586621679114243"><span class="hs-identifier hs-var">escapeOrbit</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-392"></span><span>  </span><span id="local-6989586621679114243"><span class="annot"><span class="annottext">escapeOrbit :: IntMap AlterOrbit -&gt; IntMap AlterOrbit
</span><a href="#local-6989586621679114243"><span class="hs-identifier hs-var hs-var">escapeOrbit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AlterOrbit -&gt; AlterOrbit -&gt; AlterOrbit)
-&gt; Position -&gt; AlterOrbit -&gt; IntMap AlterOrbit -&gt; IntMap AlterOrbit
forall a. (a -&gt; a -&gt; a) -&gt; Position -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.insertWith</span></span><span> </span><span class="annot"><span class="annottext">AlterOrbit -&gt; AlterOrbit -&gt; AlterOrbit
forall {p}. p -&gt; AlterOrbit -&gt; AlterOrbit
</span><a href="#local-6989586621679114244"><span class="hs-identifier hs-var">setInOrbitFalse</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114242"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">AlterOrbit
</span><a href="Text.Regex.TDFA.TDFA.html#AlterLeave"><span class="hs-identifier hs-var">AlterLeave</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-393"></span><span>    </span><span id="local-6989586621679114244"><span class="annot"><span class="annottext">setInOrbitFalse :: p -&gt; AlterOrbit -&gt; AlterOrbit
</span><a href="#local-6989586621679114244"><span class="hs-identifier hs-var hs-var">setInOrbitFalse</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679114245"><span class="annot"><span class="annottext">x :: AlterOrbit
</span><a href="#local-6989586621679114245"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#AlterModify"><span class="hs-identifier hs-type">AlterModify</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AlterOrbit
</span><a href="#local-6989586621679114245"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#newInOrbit"><span class="hs-identifier hs-var">newInOrbit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">}</span><span>
</span><span id="line-394"></span><span>    </span><span class="annot"><a href="#local-6989586621679114244"><span class="hs-identifier hs-var">setInOrbitFalse</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679114246"><span class="annot"><span class="annottext">AlterOrbit
</span><a href="#local-6989586621679114246"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AlterOrbit
</span><a href="#local-6989586621679114246"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#modifyPos"><span class="hs-identifier hs-type">modifyPos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#CompileInstructions"><span class="hs-identifier hs-type">CompileInstructions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span id="modifyPos"><span class="annot"><span class="annottext">modifyPos :: Action -&gt; Position -&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#modifyPos"><span class="hs-identifier hs-var hs-var">modifyPos</span></a></span></span><span> </span><span id="local-6989586621679114247"><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679114247"><span class="hs-identifier hs-var">todo</span></a></span></span><span> </span><span id="local-6989586621679114248"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114248"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-398"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679114249"><span class="annot"><span class="annottext">IntMap Action
</span><a href="#local-6989586621679114249"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679114250"><span class="annot"><span class="annottext">IntMap AlterOrbit
</span><a href="#local-6989586621679114250"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (IntMap Action, IntMap AlterOrbit)
  Identity
  (IntMap Action, IntMap AlterOrbit)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-399"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679114252"><span class="annot"><span class="annottext">a' :: IntMap Action
</span><a href="#local-6989586621679114252"><span class="hs-identifier hs-var hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; Action -&gt; IntMap Action -&gt; IntMap Action
forall a. Position -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.insert</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114248"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679114247"><span class="hs-identifier hs-var">todo</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Action
</span><a href="#local-6989586621679114249"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-400"></span><span>  </span><span class="annot"><span class="annottext">IntMap Action
-&gt; State (IntMap Action, IntMap AlterOrbit) ()
-&gt; State (IntMap Action, IntMap AlterOrbit) ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-identifier hs-var">seq</span></span><span> </span><span class="annot"><span class="annottext">IntMap Action
</span><a href="#local-6989586621679114252"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">(State (IntMap Action, IntMap AlterOrbit) ()
 -&gt; State (IntMap Action, IntMap AlterOrbit) ())
-&gt; State (IntMap Action, IntMap AlterOrbit) ()
-&gt; State (IntMap Action, IntMap AlterOrbit) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(IntMap Action, IntMap AlterOrbit)
-&gt; State (IntMap Action, IntMap AlterOrbit) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntMap Action
</span><a href="#local-6989586621679114252"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">IntMap AlterOrbit
</span><a href="#local-6989586621679114250"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#modifyOrbit"><span class="hs-identifier hs-type">modifyOrbit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IntMap</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#AlterOrbit"><span class="hs-identifier hs-type">AlterOrbit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#AlterOrbit"><span class="hs-identifier hs-type">AlterOrbit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#CompileInstructions"><span class="hs-identifier hs-type">CompileInstructions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span id="modifyOrbit"><span class="annot"><span class="annottext">modifyOrbit :: (IntMap AlterOrbit -&gt; IntMap AlterOrbit)
-&gt; State (IntMap Action, IntMap AlterOrbit) ()
</span><a href="Text.Regex.TDFA.TDFA.html#modifyOrbit"><span class="hs-identifier hs-var hs-var">modifyOrbit</span></a></span></span><span> </span><span id="local-6989586621679114254"><span class="annot"><span class="annottext">IntMap AlterOrbit -&gt; IntMap AlterOrbit
</span><a href="#local-6989586621679114254"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-404"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679114255"><span class="annot"><span class="annottext">IntMap Action
</span><a href="#local-6989586621679114255"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679114256"><span class="annot"><span class="annottext">IntMap AlterOrbit
</span><a href="#local-6989586621679114256"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (IntMap Action, IntMap AlterOrbit)
  Identity
  (IntMap Action, IntMap AlterOrbit)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-405"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679114257"><span class="annot"><span class="annottext">c' :: IntMap AlterOrbit
</span><a href="#local-6989586621679114257"><span class="hs-identifier hs-var hs-var">c'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap AlterOrbit -&gt; IntMap AlterOrbit
</span><a href="#local-6989586621679114254"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap AlterOrbit
</span><a href="#local-6989586621679114256"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-406"></span><span>  </span><span class="annot"><span class="annottext">IntMap AlterOrbit
-&gt; State (IntMap Action, IntMap AlterOrbit) ()
-&gt; State (IntMap Action, IntMap AlterOrbit) ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-identifier hs-var">seq</span></span><span> </span><span class="annot"><span class="annottext">IntMap AlterOrbit
</span><a href="#local-6989586621679114257"><span class="hs-identifier hs-var">c'</span></a></span><span> </span><span class="annot"><span class="annottext">(State (IntMap Action, IntMap AlterOrbit) ()
 -&gt; State (IntMap Action, IntMap AlterOrbit) ())
-&gt; State (IntMap Action, IntMap AlterOrbit) ()
-&gt; State (IntMap Action, IntMap AlterOrbit) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(IntMap Action, IntMap AlterOrbit)
-&gt; State (IntMap Action, IntMap AlterOrbit) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntMap Action
</span><a href="#local-6989586621679114255"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">IntMap AlterOrbit
</span><a href="#local-6989586621679114257"><span class="hs-identifier hs-var">c'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="hs-comment">----</span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#alterOrbits"><span class="hs-identifier hs-type">alterOrbits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#AlterOrbit"><span class="hs-identifier hs-type">AlterOrbit</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#OrbitTransformer"><span class="hs-identifier hs-type">OrbitTransformer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span id="alterOrbits"><span class="annot"><span class="annottext">alterOrbits :: [(Position, AlterOrbit)] -&gt; Position -&gt; OrbitTransformer
</span><a href="Text.Regex.TDFA.TDFA.html#alterOrbits"><span class="hs-identifier hs-var hs-var">alterOrbits</span></a></span></span><span> </span><span id="local-6989586621679114258"><span class="annot"><span class="annottext">[(Position, AlterOrbit)]
</span><a href="#local-6989586621679114258"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679114259"><span class="annot"><span class="annottext">items :: [Position -&gt; OrbitTransformer]
</span><a href="#local-6989586621679114259"><span class="hs-identifier hs-var hs-var">items</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Position, AlterOrbit) -&gt; Position -&gt; OrbitTransformer)
-&gt; [(Position, AlterOrbit)] -&gt; [Position -&gt; OrbitTransformer]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Position, AlterOrbit) -&gt; Position -&gt; OrbitTransformer
</span><a href="Text.Regex.TDFA.TDFA.html#alterOrbit"><span class="hs-identifier hs-var">alterOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">[(Position, AlterOrbit)]
</span><a href="#local-6989586621679114258"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-412"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679114261"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114261"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621679114262"><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679114262"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(OrbitLog -&gt; OrbitTransformer -&gt; OrbitLog)
-&gt; OrbitLog -&gt; [OrbitTransformer] -&gt; OrbitLog
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(OrbitTransformer -&gt; OrbitTransformer)
-&gt; OrbitLog -&gt; OrbitTransformer -&gt; OrbitLog
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">OrbitTransformer -&gt; OrbitTransformer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">($)</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679114262"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Position -&gt; OrbitTransformer) -&gt; OrbitTransformer)
-&gt; [Position -&gt; OrbitTransformer] -&gt; [OrbitTransformer]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Position -&gt; OrbitTransformer) -&gt; Position -&gt; OrbitTransformer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114261"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Position -&gt; OrbitTransformer]
</span><a href="#local-6989586621679114259"><span class="hs-identifier hs-var">items</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#alterOrbit"><span class="hs-identifier hs-type">alterOrbit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#AlterOrbit"><span class="hs-identifier hs-type">AlterOrbit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#OrbitTransformer"><span class="hs-identifier hs-type">OrbitTransformer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span id="alterOrbit"><span class="annot"><span class="annottext">alterOrbit :: (Position, AlterOrbit) -&gt; Position -&gt; OrbitTransformer
</span><a href="Text.Regex.TDFA.TDFA.html#alterOrbit"><span class="hs-identifier hs-var hs-var">alterOrbit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679114265"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114265"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#AlterModify"><span class="hs-identifier hs-type">AlterModify</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">newInOrbit :: AlterOrbit -&gt; Bool
</span><a href="Text.Regex.TDFA.TDFA.html#newInOrbit"><span class="hs-identifier hs-var">newInOrbit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679114266"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679114266"><span class="hs-identifier hs-var">inOrbit'</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">freshOrbit :: AlterOrbit -&gt; Bool
</span><a href="Text.Regex.TDFA.TDFA.html#freshOrbit"><span class="hs-identifier hs-var">freshOrbit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679114267"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114267"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621679114268"><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679114268"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Position -&gt; Orbits -&gt; OrbitTransformer
forall a. Position -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.insert</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114265"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Orbits"><span class="hs-identifier hs-type">Orbits</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inOrbit :: Bool
</span><a href="Text.Regex.TDFA.Common.html#inOrbit"><span class="hs-identifier hs-var">inOrbit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679114266"><span class="hs-identifier hs-var">inOrbit'</span></a></span><span>
</span><span id="line-418"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">basePos :: Position
</span><a href="Text.Regex.TDFA.Common.html#basePos"><span class="hs-identifier hs-var">basePos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114267"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-419"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ordinal :: Maybe Position
</span><a href="Text.Regex.TDFA.Common.html#ordinal"><span class="hs-identifier hs-var">ordinal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Position
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-420"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">getOrbits :: Seq Position
</span><a href="Text.Regex.TDFA.Common.html#getOrbits"><span class="hs-identifier hs-var">getOrbits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Seq Position
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679114268"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#alterOrbit"><span class="hs-identifier hs-var">alterOrbit</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679114274"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114274"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#AlterModify"><span class="hs-identifier hs-type">AlterModify</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">newInOrbit :: AlterOrbit -&gt; Bool
</span><a href="Text.Regex.TDFA.TDFA.html#newInOrbit"><span class="hs-identifier hs-var">newInOrbit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679114275"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679114275"><span class="hs-identifier hs-var">inOrbit'</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">freshOrbit :: AlterOrbit -&gt; Bool
</span><a href="Text.Regex.TDFA.TDFA.html#freshOrbit"><span class="hs-identifier hs-var">freshOrbit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679114276"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114276"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621679114277"><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679114277"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Position -&gt; Orbits -&gt; Orbits -&gt; Orbits)
-&gt; Position -&gt; Orbits -&gt; OrbitTransformer
forall a.
(Position -&gt; a -&gt; a -&gt; a) -&gt; Position -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.insertWithKey</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position -&gt; Position -&gt; Orbits -&gt; Orbits -&gt; Orbits
forall {p}. Position -&gt; p -&gt; Orbits -&gt; Orbits -&gt; Orbits
</span><a href="#local-6989586621679114278"><span class="hs-identifier hs-var">updateOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114276"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114274"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position -&gt; Orbits
</span><a href="#local-6989586621679114279"><span class="hs-identifier hs-var">newOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114276"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679114277"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-424"></span><span>  </span><span id="local-6989586621679114279"><span class="annot"><span class="annottext">newOrbit :: Position -&gt; Orbits
</span><a href="#local-6989586621679114279"><span class="hs-identifier hs-var hs-var">newOrbit</span></a></span></span><span> </span><span id="local-6989586621679114281"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114281"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Orbits"><span class="hs-identifier hs-type">Orbits</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inOrbit :: Bool
</span><a href="Text.Regex.TDFA.Common.html#inOrbit"><span class="hs-identifier hs-var">inOrbit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679114275"><span class="hs-identifier hs-var">inOrbit'</span></a></span><span>
</span><span id="line-425"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">basePos :: Position
</span><a href="Text.Regex.TDFA.Common.html#basePos"><span class="hs-identifier hs-var">basePos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114281"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-426"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ordinal :: Maybe Position
</span><a href="Text.Regex.TDFA.Common.html#ordinal"><span class="hs-identifier hs-var">ordinal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Position
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-427"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">getOrbits :: Seq Position
</span><a href="Text.Regex.TDFA.Common.html#getOrbits"><span class="hs-identifier hs-var">getOrbits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Seq Position
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">Mon.mempty</span></span><span class="hs-special">}</span><span>
</span><span id="line-428"></span><span>  </span><span id="local-6989586621679114278"><span class="annot"><span class="annottext">updateOrbit :: Position -&gt; p -&gt; Orbits -&gt; Orbits -&gt; Orbits
</span><a href="#local-6989586621679114278"><span class="hs-identifier hs-var hs-var">updateOrbit</span></a></span></span><span> </span><span id="local-6989586621679114282"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114282"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621679114283"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679114283"><span class="hs-identifier hs-var">_tag</span></a></span></span><span> </span><span id="local-6989586621679114284"><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679114284"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span id="local-6989586621679114285"><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679114285"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Orbits -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#inOrbit"><span class="hs-identifier hs-var">inOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679114285"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679114285"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#inOrbit"><span class="hs-identifier hs-var">inOrbit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679114275"><span class="hs-identifier hs-type">inOrbit'</span></a></span><span>
</span><span id="line-429"></span><span>                                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#getOrbits"><span class="hs-identifier hs-var">getOrbits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#getOrbits"><span class="hs-identifier hs-var">getOrbits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679114285"><span class="hs-identifier hs-type">old</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">|&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621679114282"><span class="hs-identifier hs-type">pos</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-430"></span><span>                               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679114284"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#alterOrbit"><span class="hs-identifier hs-var">alterOrbit</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679114286"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114286"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">AlterOrbit
</span><a href="Text.Regex.TDFA.TDFA.html#AlterReset"><span class="hs-identifier hs-var">AlterReset</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">Position
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679114287"><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679114287"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Position -&gt; OrbitTransformer
forall a. Position -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.delete</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114286"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679114287"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span class="annot"><a href="Text.Regex.TDFA.TDFA.html#alterOrbit"><span class="hs-identifier hs-var">alterOrbit</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679114288"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114288"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">AlterOrbit
</span><a href="Text.Regex.TDFA.TDFA.html#AlterLeave"><span class="hs-identifier hs-var">AlterLeave</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">Position
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679114289"><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679114289"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Position -&gt; OrbitLog -&gt; Maybe Orbits
forall a. Position -&gt; IntMap a -&gt; Maybe a
</span><span class="hs-identifier hs-var">IMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114288"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679114289"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-435"></span><span>                                         </span><span class="annot"><span class="annottext">Maybe Orbits
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679114289"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-436"></span><span>                                         </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679114290"><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679114290"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Position -&gt; Orbits -&gt; OrbitTransformer
forall a. Position -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.insert</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679114288"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679114290"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#inOrbit"><span class="hs-identifier hs-var">inOrbit</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679114289"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-437"></span></pre></body></html>