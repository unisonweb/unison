<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | The CorePattern module deconstructs the Pattern tree created by</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- ReadRegex.parseRegex and returns a simpler Q\/P tree with</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- annotations at each Q node.  This will be converted by the TNFA</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- module into a QNFA finite automata.</span><span>
</span><span id="line-5"></span><span class="hs-comment">--</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Of particular note, this Pattern to Q\/P conversion creates and</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- assigns all the internal Tags that will be used during the matching</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- process, and associates the captures groups with the tags that</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- represent their starting and ending locations and with their</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- immediate parent group.</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- Each Maximize and Minimize tag is held as either a preTag or a</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- postTag by one and only one location in the Q\/P tree.  The Orbit</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- tags are each held by one and only one Star node.  Tags that stop a</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- Group are also held in perhaps numerous preReset lists.</span><span>
</span><span id="line-16"></span><span class="hs-comment">--</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- The additional nullQ::nullView field of Q records the potentially</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- complex information about what tests and tags must be used if the</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- pattern unQ::P matches 0 zero characters.  There can be redundancy</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- in nullView, which is eliminated by cleanNullView.</span><span>
</span><span id="line-21"></span><span class="hs-comment">--</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- Uses recursive do notation.</span><span>
</span><span id="line-23"></span><span class="hs-comment">--</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- 2009 XXX TODO: we can avoid needing tags in the part of the pattern</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- after the last capturing group (when right-associative).  This is</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- flipped for left-associative where the front of the pattern before</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- the first capturing group needs no tags.  The edge of these regions</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- is subtle: both case needs a Maximize tag.  One ought to be able to</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- check the Pattern: if the root is PConcat then a scan from the end</span><span>
</span><span id="line-30"></span><span class="hs-comment">-- (start) looking for the first with an embedded PGroup can be found</span><span>
</span><span id="line-31"></span><span class="hs-comment">-- and the PGroup free elements can be wrapped in some new PNOTAG</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- semantic indicator.</span><span>
</span><span id="line-33"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Text.Regex.TDFA.CorePattern</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier">Q</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#P"><span class="hs-identifier">P</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#WhichTest"><span class="hs-identifier">WhichTest</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Wanted"><span class="hs-identifier">Wanted</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>                                  </span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#TestInfo"><span class="hs-identifier">TestInfo</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#OP"><span class="hs-identifier">OP</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier">SetTestInfo</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier">NullView</span></a></span><span>
</span><span id="line-35"></span><span>                                  </span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#patternToQ"><span class="hs-identifier">patternToQ</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#cleanNullView"><span class="hs-identifier">cleanNullView</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#cannotAccept"><span class="hs-identifier">cannotAccept</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#mustAccept"><span class="hs-identifier">mustAccept</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">liftM2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">forM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">replicateM</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.RWS</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">RWS</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runRWS</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ask</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">local</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">listens</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tell</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">get</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">put</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Array.IArray</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Array</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-operator">(!)</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">accumArray</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">listArray</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">partitionEithers</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">rights</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">sort</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.IntMap.EnumMap2.html"><span class="hs-identifier">Data.IntMap.EnumMap2</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Data.IntMap.EnumMap2.html#EnumMap"><span class="hs-identifier">EnumMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.IntMap.EnumMap2.html"><span class="hs-identifier">Data.IntMap.EnumMap2</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">(</span><span class="annot"><a href="Data.IntMap.EnumMap2.html#singleton"><span class="hs-identifier">singleton</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Data.IntMap.EnumMap2.html#null"><span class="hs-identifier">null</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Data.IntMap.EnumMap2.html#assocs"><span class="hs-identifier">assocs</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Data.IntMap.EnumMap2.html#keysSet"><span class="hs-identifier">keysSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-comment">--import Data.Maybe(isNothing)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.IntSet.EnumSet2.html"><span class="hs-identifier">Data.IntSet.EnumSet2</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Data.IntSet.EnumSet2.html#EnumSet"><span class="hs-identifier">EnumSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.IntSet.EnumSet2.html"><span class="hs-identifier">Data.IntSet.EnumSet2</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">(</span><span class="annot"><a href="Data.IntSet.EnumSet2.html#singleton"><span class="hs-identifier">singleton</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Data.IntSet.EnumSet2.html#toList"><span class="hs-identifier">toList</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Data.IntSet.EnumSet2.html#isSubsetOf"><span class="hs-identifier">isSubsetOf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Semigroup</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Sem</span></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html"><span class="hs-identifier">Text.Regex.TDFA.Common</span></a></span><span> </span><span class="hs-comment">{- all -}</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html"><span class="hs-identifier">Text.Regex.TDFA.Pattern</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#Pattern"><span class="hs-identifier">Pattern</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#starTrans"><span class="hs-identifier">starTrans</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- import Debug.Trace</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-comment">{- By Chris Kuklewicz, 2007. BSD License, see the LICENSE file. -}</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-comment">--err :: String -&gt; a</span><span>
</span><span id="line-58"></span><span class="hs-comment">--err = common_error &quot;Text.Regex.TDFA.CorePattern&quot;</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">--debug :: (Show a) =&gt; a -&gt; b -&gt; b</span><span>
</span><span id="line-61"></span><span class="hs-comment">--debug _ = id</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-comment">-- Core Pattern Language</span><span>
</span><span id="line-64"></span><span class="hs-keyword">data</span><span> </span><span id="P"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#P"><span class="hs-identifier hs-var">P</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Empty"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span></span><span>                       </span><span class="hs-comment">-- Could be replaced by (Test Nothing)??</span><span>
</span><span id="line-65"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span id="Or"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Or"><span class="hs-identifier hs-var">Or</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-66"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span id="Seq"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Seq"><span class="hs-identifier hs-var">Seq</span></a></span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span>
</span><span id="line-67"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span id="Star"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Star"><span class="hs-identifier hs-var">Star</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="getOrbit"><span class="annot"><span class="annottext">P -&gt; Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#getOrbit"><span class="hs-identifier hs-var hs-var">getOrbit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-comment">-- tag to prioritize the need to keep track of length of each pass though q</span><span>
</span><span id="line-68"></span><span>              </span><span class="hs-special">,</span><span> </span><span id="resetOrbits"><span class="annot"><span class="annottext">P -&gt; [GroupIndex]
</span><a href="Text.Regex.TDFA.CorePattern.html#resetOrbits"><span class="hs-identifier hs-var hs-var">resetOrbits</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- child star's orbits to reset (ResetOrbitTask) at all depths</span><span>
</span><span id="line-69"></span><span>              </span><span class="hs-special">,</span><span> </span><span id="firstNull"><span class="annot"><span class="annottext">P -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#firstNull"><span class="hs-identifier hs-var hs-var">firstNull</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>     </span><span class="hs-comment">-- Usually True to mean the first pass may match 0 characters</span><span>
</span><span id="line-70"></span><span>              </span><span class="hs-special">,</span><span> </span><span id="unStar"><span class="annot"><span class="annottext">P -&gt; Q
</span><a href="Text.Regex.TDFA.CorePattern.html#unStar"><span class="hs-identifier hs-var hs-var">unStar</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-71"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span id="Test"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Test"><span class="hs-identifier hs-var">Test</span></a></span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#TestInfo"><span class="hs-identifier hs-type">TestInfo</span></a></span><span>               </span><span class="hs-comment">-- Require the test to be true (merge with empty as (Test (Maybe TestInfo)) ??)</span><span>
</span><span id="line-72"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span id="OneChar"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#OneChar"><span class="hs-identifier hs-var">OneChar</span></a></span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a></span><span>             </span><span class="hs-comment">-- Bring the Pattern element that accepts a character</span><span>
</span><span id="line-73"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span id="NonEmpty"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NonEmpty"><span class="hs-identifier hs-var">NonEmpty</span></a></span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span>                  </span><span class="hs-comment">-- Don't let the Q pattern match nothing</span><span>
</span><span id="line-74"></span><span>         </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679111579"><span id="local-6989586621679111601"><span id="local-6989586621679111605"><span class="annot"><span class="annottext">GroupIndex -&gt; P -&gt; ShowS
[P] -&gt; ShowS
P -&gt; String
(GroupIndex -&gt; P -&gt; ShowS)
-&gt; (P -&gt; String) -&gt; ([P] -&gt; ShowS) -&gt; Show P
forall a.
(GroupIndex -&gt; a -&gt; ShowS)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: GroupIndex -&gt; P -&gt; ShowS
showsPrec :: GroupIndex -&gt; P -&gt; ShowS
$cshow :: P -&gt; String
show :: P -&gt; String
$cshowList :: [P] -&gt; ShowS
showList :: [P] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621679111612"><span id="local-6989586621679111632"><span class="annot"><span class="annottext">P -&gt; P -&gt; Bool
(P -&gt; P -&gt; Bool) -&gt; (P -&gt; P -&gt; Bool) -&gt; Eq P
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: P -&gt; P -&gt; Bool
== :: P -&gt; P -&gt; Bool
$c/= :: P -&gt; P -&gt; Bool
/= :: P -&gt; P -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-comment">-- The diagnostics about the pattern.  Note that when unQ is 'Seq' the</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- the preTag and postTag are Nothing but the preReset might have tags</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- from PGroup injecting them.</span><span>
</span><span id="line-79"></span><span class="hs-keyword">data</span><span> </span><span id="Q"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-var">Q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Q"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-var">Q</span></a></span></span><span> </span><span class="hs-special">{</span><span id="nullQ"><span class="annot"><span class="annottext">Q -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var hs-var">nullQ</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-type">NullView</span></a></span><span>                  </span><span class="hs-comment">-- Ordered list of nullable views</span><span>
</span><span id="line-80"></span><span>           </span><span class="hs-special">,</span><span id="takes"><span class="annot"><span class="annottext">Q -&gt; (GroupIndex, Maybe GroupIndex)
</span><a href="Text.Regex.TDFA.CorePattern.html#takes"><span class="hs-identifier hs-var hs-var">takes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Range of number of accepted characters</span><span>
</span><span id="line-81"></span><span>           </span><span class="hs-special">,</span><span id="preReset"><span class="annot"><span class="annottext">Q -&gt; [GroupIndex]
</span><a href="Text.Regex.TDFA.CorePattern.html#preReset"><span class="hs-identifier hs-var hs-var">preReset</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">]</span><span>                  </span><span class="hs-comment">-- Tags to &quot;reset&quot; (ResetGroupStopTask) (Only immediate children for efficiency)</span><span>
</span><span id="line-82"></span><span>           </span><span class="hs-special">,</span><span id="postSet"><span class="annot"><span class="annottext">Q -&gt; [GroupIndex]
</span><a href="Text.Regex.TDFA.CorePattern.html#postSet"><span class="hs-identifier hs-var hs-var">postSet</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">]</span><span>                   </span><span class="hs-comment">-- Tags to &quot;set&quot; (SetGroupStopTask)</span><span>
</span><span id="line-83"></span><span>           </span><span class="hs-special">,</span><span id="preTag"><span class="annot"><span class="annottext">Q -&gt; Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#preTag"><span class="hs-identifier hs-var hs-var">preTag</span></a></span></span><span class="hs-special">,</span><span id="postTag"><span class="annot"><span class="annottext">Q -&gt; Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#postTag"><span class="hs-identifier hs-var hs-var">postTag</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span>        </span><span class="hs-comment">-- Tags assigned around this pattern (TagTask)</span><span>
</span><span id="line-84"></span><span>           </span><span class="hs-special">,</span><span id="tagged"><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#tagged"><span class="hs-identifier hs-var hs-var">tagged</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                     </span><span class="hs-comment">-- Whether this node should be tagged -- patternToQ use only</span><span>
</span><span id="line-85"></span><span>           </span><span class="hs-special">,</span><span id="childGroups"><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#childGroups"><span class="hs-identifier hs-var hs-var">childGroups</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                </span><span class="hs-comment">-- Whether unQ has any PGroups -- patternToQ use only</span><span>
</span><span id="line-86"></span><span>           </span><span class="hs-special">,</span><span id="wants"><span class="annot"><span class="annottext">Q -&gt; Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#wants"><span class="hs-identifier hs-var hs-var">wants</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Wanted"><span class="hs-identifier hs-type">Wanted</span></a></span><span>                    </span><span class="hs-comment">-- What kind of continuation is used by this pattern</span><span>
</span><span id="line-87"></span><span>           </span><span class="hs-special">,</span><span id="unQ"><span class="annot"><span class="annottext">Q -&gt; P
</span><a href="Text.Regex.TDFA.CorePattern.html#unQ"><span class="hs-identifier hs-var hs-var">unQ</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#P"><span class="hs-identifier hs-type">P</span></a></span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679111652"><span id="local-6989586621679111667"><span class="annot"><span class="annottext">Q -&gt; Q -&gt; Bool
(Q -&gt; Q -&gt; Bool) -&gt; (Q -&gt; Q -&gt; Bool) -&gt; Eq Q
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Q -&gt; Q -&gt; Bool
== :: Q -&gt; Q -&gt; Bool
$c/= :: Q -&gt; Q -&gt; Bool
/= :: Q -&gt; Q -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-keyword">type</span><span> </span><span id="TestInfo"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#TestInfo"><span class="hs-identifier hs-var">TestInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#WhichTest"><span class="hs-identifier hs-type">WhichTest</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DoPa"><span class="hs-identifier hs-type">DoPa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">-- This is newtype'd to allow control over class instances</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- This is a set of WhichTest where each test has associated pattern location information</span><span>
</span><span id="line-93"></span><span class="hs-keyword">newtype</span><span> </span><span id="SetTestInfo"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier hs-var">SetTestInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SetTestInfo"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier hs-var">SetTestInfo</span></a></span></span><span> </span><span class="hs-special">{</span><span id="getTests"><span class="annot"><span class="annottext">SetTestInfo -&gt; EnumMap WhichTest (EnumSet DoPa)
</span><a href="Text.Regex.TDFA.CorePattern.html#getTests"><span class="hs-identifier hs-var hs-var">getTests</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.IntMap.EnumMap2.html#EnumMap"><span class="hs-identifier hs-type">EnumMap</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#WhichTest"><span class="hs-identifier hs-type">WhichTest</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.IntSet.EnumSet2.html#EnumSet"><span class="hs-identifier hs-type">EnumSet</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DoPa"><span class="hs-identifier hs-type">DoPa</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679111678"><span id="local-6989586621679111684"><span class="annot"><span class="annottext">SetTestInfo -&gt; SetTestInfo -&gt; Bool
(SetTestInfo -&gt; SetTestInfo -&gt; Bool)
-&gt; (SetTestInfo -&gt; SetTestInfo -&gt; Bool) -&gt; Eq SetTestInfo
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: SetTestInfo -&gt; SetTestInfo -&gt; Bool
== :: SetTestInfo -&gt; SetTestInfo -&gt; Bool
$c/= :: SetTestInfo -&gt; SetTestInfo -&gt; Bool
/= :: SetTestInfo -&gt; SetTestInfo -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679111691"><span id="local-6989586621679111695"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier hs-type">SetTestInfo</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier hs-type">SetTestInfo</span></a></span><span> </span><span id="local-6989586621679111704"><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa)
</span><a href="#local-6989586621679111704"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679111705"><span class="annot"><span class="annottext">&lt;&gt; :: SetTestInfo -&gt; SetTestInfo -&gt; SetTestInfo
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier hs-type">SetTestInfo</span></a></span><span> </span><span id="local-6989586621679111706"><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa)
</span><a href="#local-6989586621679111706"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa) -&gt; SetTestInfo
</span><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier hs-var">SetTestInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa)
</span><a href="#local-6989586621679111704"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa)
-&gt; EnumMap WhichTest (EnumSet DoPa)
-&gt; EnumMap WhichTest (EnumSet DoPa)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">Sem.&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa)
</span><a href="#local-6989586621679111706"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679111712"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier hs-type">SetTestInfo</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-99"></span><span>  </span><span id="local-6989586621679111718"><span class="annot"><span class="annottext">mempty :: SetTestInfo
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa) -&gt; SetTestInfo
</span><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier hs-var">SetTestInfo</span></a></span><span> </span><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-100"></span><span>  </span><span id="local-6989586621679111720"><span class="annot"><span class="annottext">mappend :: SetTestInfo -&gt; SetTestInfo -&gt; SetTestInfo
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mappend</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SetTestInfo -&gt; SetTestInfo -&gt; SetTestInfo
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(Sem.&lt;&gt;)</span></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679111722"><span id="local-6989586621679111726"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier hs-type">SetTestInfo</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-103"></span><span>  </span><span id="local-6989586621679111737"><span class="annot"><span class="annottext">show :: SetTestInfo -&gt; String
</span><a href="#local-6989586621679111737"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier hs-type">SetTestInfo</span></a></span><span> </span><span id="local-6989586621679111739"><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa)
</span><a href="#local-6989586621679111739"><span class="hs-identifier hs-var">sti</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SetTestInfo &quot;</span></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">[(WhichTest, [DoPa])] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EnumSet DoPa -&gt; [DoPa])
-&gt; [(WhichTest, EnumSet DoPa)] -&gt; [(WhichTest, [DoPa])]
forall (f :: * -&gt; *) t1 t2 t.
Functor f =&gt;
(t1 -&gt; t2) -&gt; f (t, t1) -&gt; f (t, t2)
</span><a href="Text.Regex.TDFA.Common.html#mapSnd"><span class="hs-identifier hs-var">mapSnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EnumSet DoPa -&gt; [DoPa]
forall e. Enum e =&gt; EnumSet e -&gt; [e]
</span><a href="Data.IntSet.EnumSet2.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(WhichTest, EnumSet DoPa)] -&gt; [(WhichTest, [DoPa])])
-&gt; [(WhichTest, EnumSet DoPa)] -&gt; [(WhichTest, [DoPa])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa) -&gt; [(WhichTest, EnumSet DoPa)]
forall key a. Enum key =&gt; EnumMap key a -&gt; [(key, a)]
</span><a href="Data.IntMap.EnumMap2.html#assocs"><span class="hs-identifier hs-var">Map.assocs</span></a></span><span> </span><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa)
</span><a href="#local-6989586621679111739"><span class="hs-identifier hs-var">sti</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-comment">-- There may be several distinct ways for a subtree to conditionally</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- (i.e. with a Test) or unconditionally accept 0 characters.  These</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- are in the list in order of preference, with most preferred listed</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- first.</span><span>
</span><span id="line-109"></span><span class="hs-keyword">type</span><span> </span><span id="NullView"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-var">NullView</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier hs-type">SetTestInfo</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagList"><span class="hs-identifier hs-type">TagList</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Ordered list of null views, each is a set of tests and tags</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-comment">-- During the depth first traversal, children are told about tags by the parent.</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- They may change Apply to Advice and they may generate new tags.</span><span>
</span><span id="line-113"></span><span class="hs-keyword">data</span><span> </span><span id="HandleTag"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HandleTag"><span class="hs-identifier hs-var">HandleTag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="NoTag"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NoTag"><span class="hs-identifier hs-var">NoTag</span></a></span></span><span>             </span><span class="hs-comment">-- No tag at this boundary</span><span>
</span><span id="line-114"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span id="Advice"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Advice"><span class="hs-identifier hs-var">Advice</span></a></span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span>        </span><span class="hs-comment">-- tag at this boundary, applied at higher level in tree</span><span>
</span><span id="line-115"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span id="Apply"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span>         </span><span class="hs-comment">-- tag at this boundary, may be applied at this node or passed to one child</span><span>
</span><span id="line-116"></span><span>                 </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679111745"><span id="local-6989586621679111751"><span id="local-6989586621679111755"><span class="annot"><span class="annottext">GroupIndex -&gt; HandleTag -&gt; ShowS
[HandleTag] -&gt; ShowS
HandleTag -&gt; String
(GroupIndex -&gt; HandleTag -&gt; ShowS)
-&gt; (HandleTag -&gt; String)
-&gt; ([HandleTag] -&gt; ShowS)
-&gt; Show HandleTag
forall a.
(GroupIndex -&gt; a -&gt; ShowS)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: GroupIndex -&gt; HandleTag -&gt; ShowS
showsPrec :: GroupIndex -&gt; HandleTag -&gt; ShowS
$cshow :: HandleTag -&gt; String
show :: HandleTag -&gt; String
$cshowList :: [HandleTag] -&gt; ShowS
showList :: [HandleTag] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">-- Nodes in the tree are labeled by the type kind of continuation they</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- prefer to be passed when processing.  This makes it possible to</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- create a smaller number of QNFA states and avoid creating wasteful</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- QNFA states that won't be reachable in the final automata.</span><span>
</span><span id="line-122"></span><span class="hs-comment">--</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- In practice WantsBoth is treated identically to WantsQNFA and</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- WantsBoth could be removed.</span><span>
</span><span id="line-125"></span><span class="hs-keyword">data</span><span> </span><span id="Wanted"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WantsQNFA"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#WantsQNFA"><span class="hs-identifier hs-var">WantsQNFA</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="WantsQT"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#WantsQT"><span class="hs-identifier hs-var">WantsQT</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="WantsBoth"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#WantsBoth"><span class="hs-identifier hs-var">WantsBoth</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="WantsEither"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#WantsEither"><span class="hs-identifier hs-var">WantsEither</span></a></span></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679111762"><span id="local-6989586621679111764"><span class="annot"><span class="annottext">Wanted -&gt; Wanted -&gt; Bool
(Wanted -&gt; Wanted -&gt; Bool)
-&gt; (Wanted -&gt; Wanted -&gt; Bool) -&gt; Eq Wanted
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Wanted -&gt; Wanted -&gt; Bool
== :: Wanted -&gt; Wanted -&gt; Bool
$c/= :: Wanted -&gt; Wanted -&gt; Bool
/= :: Wanted -&gt; Wanted -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span id="local-6989586621679111767"><span id="local-6989586621679111769"><span id="local-6989586621679111772"><span class="annot"><span class="annottext">GroupIndex -&gt; Wanted -&gt; ShowS
[Wanted] -&gt; ShowS
Wanted -&gt; String
(GroupIndex -&gt; Wanted -&gt; ShowS)
-&gt; (Wanted -&gt; String) -&gt; ([Wanted] -&gt; ShowS) -&gt; Show Wanted
forall a.
(GroupIndex -&gt; a -&gt; ShowS)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: GroupIndex -&gt; Wanted -&gt; ShowS
showsPrec :: GroupIndex -&gt; Wanted -&gt; ShowS
$cshow :: Wanted -&gt; String
show :: Wanted -&gt; String
$cshowList :: [Wanted] -&gt; ShowS
showList :: [Wanted] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679111775"><span id="local-6989586621679111779"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-128"></span><span>  </span><span id="local-6989586621679111781"><span class="annot"><span class="annottext">show :: Q -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Q -&gt; String
</span><a href="Text.Regex.TDFA.CorePattern.html#showQ"><span class="hs-identifier hs-var">showQ</span></a></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#showQ"><span class="hs-identifier hs-type">showQ</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-131"></span><span id="showQ"><span class="annot"><span class="annottext">showQ :: Q -&gt; String
</span><a href="Text.Regex.TDFA.CorePattern.html#showQ"><span class="hs-identifier hs-var hs-var">showQ</span></a></span></span><span> </span><span id="local-6989586621679111783"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111783"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Q { nullQ = &quot;</span></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">NullView -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111783"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-132"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n  , takes = &quot;</span></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">(GroupIndex, Maybe GroupIndex) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; (GroupIndex, Maybe GroupIndex)
</span><a href="Text.Regex.TDFA.CorePattern.html#takes"><span class="hs-identifier hs-var">takes</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111783"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n  , preReset = &quot;</span></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">[GroupIndex] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; [GroupIndex]
</span><a href="Text.Regex.TDFA.CorePattern.html#preReset"><span class="hs-identifier hs-var">preReset</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111783"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-134"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n  , postSet = &quot;</span></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">[GroupIndex] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; [GroupIndex]
</span><a href="Text.Regex.TDFA.CorePattern.html#postSet"><span class="hs-identifier hs-var">postSet</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111783"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-135"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n  , preTag = &quot;</span></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Maybe GroupIndex -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#preTag"><span class="hs-identifier hs-var">preTag</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111783"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-136"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n  , postTag = &quot;</span></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Maybe GroupIndex -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#postTag"><span class="hs-identifier hs-var">postTag</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111783"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-137"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n  , tagged = &quot;</span></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Bool -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#tagged"><span class="hs-identifier hs-var">tagged</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111783"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-138"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n  , wants = &quot;</span></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Wanted -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#wants"><span class="hs-identifier hs-var">wants</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111783"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-139"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n  , unQ = &quot;</span></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">P -&gt; String
</span><a href="#local-6989586621679111784"><span class="hs-identifier hs-var">indent'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; P
</span><a href="Text.Regex.TDFA.CorePattern.html#unQ"><span class="hs-identifier hs-var">unQ</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111783"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; }&quot;</span></span><span>
</span><span id="line-140"></span><span>   </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679111784"><span class="annot"><span class="annottext">indent' :: P -&gt; String
</span><a href="#local-6989586621679111784"><span class="hs-identifier hs-var hs-var">indent'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unlines</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; String) -&gt; (P -&gt; [String]) -&gt; P -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679111788"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679111788"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679111788"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-141"></span><span>                                      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-142"></span><span>                                      </span><span class="hs-special">(</span><span id="local-6989586621679111789"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679111789"><span class="hs-identifier hs-var">h</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679111790"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679111790"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679111789"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShowS -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679111791"><span class="hs-identifier hs-var">spaces</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679111790"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String]) -&gt; (P -&gt; [String]) -&gt; P -&gt; [String]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><span class="hs-identifier hs-var">lines</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; [String]) -&gt; (P -&gt; String) -&gt; P -&gt; [String]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">P -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span>
</span><span id="line-143"></span><span>         </span><span id="local-6989586621679111791"><span class="annot"><span class="annottext">spaces :: String
</span><a href="#local-6989586621679111791"><span class="hs-identifier hs-var hs-var">spaces</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GroupIndex -&gt; Char -&gt; String
forall a. GroupIndex -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="hs-comment">-- Smart constructors for NullView</span><span>
</span><span id="line-146"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#notNull"><span class="hs-identifier hs-type">notNull</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-type">NullView</span></a></span><span>
</span><span id="line-147"></span><span id="notNull"><span class="annot"><span class="annottext">notNull :: NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#notNull"><span class="hs-identifier hs-var hs-var">notNull</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="hs-comment">-- Shorthand for combining a preTag and a postTag</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- preTags :: Maybe Tag -&gt; Maybe Tag -&gt; TagList</span><span>
</span><span id="line-151"></span><span class="hs-comment">-- preTags a b = promote a `mappend` promote b</span><span>
</span><span id="line-152"></span><span class="hs-comment">--   where promote = maybe [] (\x -&gt; [(x,PreUpdate TagTask)])</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#promotePreTag"><span class="hs-identifier hs-type">promotePreTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HandleTag"><span class="hs-identifier hs-type">HandleTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#TagList"><span class="hs-identifier hs-type">TagList</span></a></span><span>
</span><span id="line-155"></span><span id="promotePreTag"><span class="annot"><span class="annottext">promotePreTag :: HandleTag -&gt; TagList
</span><a href="Text.Regex.TDFA.CorePattern.html#promotePreTag"><span class="hs-identifier hs-var hs-var">promotePreTag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TagList -&gt; (GroupIndex -&gt; TagList) -&gt; Maybe GroupIndex -&gt; TagList
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679111797"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111797"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111797"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagTask -&gt; TagUpdate
</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#TagTask"><span class="hs-identifier hs-var">TagTask</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe GroupIndex -&gt; TagList)
-&gt; (HandleTag -&gt; Maybe GroupIndex) -&gt; HandleTag -&gt; TagList
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#apply"><span class="hs-identifier hs-var">apply</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#makeEmptyNullView"><span class="hs-identifier hs-type">makeEmptyNullView</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HandleTag"><span class="hs-identifier hs-type">HandleTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HandleTag"><span class="hs-identifier hs-type">HandleTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-type">NullView</span></a></span><span>
</span><span id="line-158"></span><span id="makeEmptyNullView"><span class="annot"><span class="annottext">makeEmptyNullView :: HandleTag -&gt; HandleTag -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#makeEmptyNullView"><span class="hs-identifier hs-var hs-var">makeEmptyNullView</span></a></span></span><span> </span><span id="local-6989586621679111802"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111802"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679111803"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111803"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">SetTestInfo
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; TagList
</span><a href="Text.Regex.TDFA.CorePattern.html#promotePreTag"><span class="hs-identifier hs-var">promotePreTag</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111802"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">TagList -&gt; TagList -&gt; TagList
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; TagList
</span><a href="Text.Regex.TDFA.CorePattern.html#promotePreTag"><span class="hs-identifier hs-var">promotePreTag</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111803"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#makeTestNullView"><span class="hs-identifier hs-type">makeTestNullView</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#TestInfo"><span class="hs-identifier hs-type">TestInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HandleTag"><span class="hs-identifier hs-type">HandleTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HandleTag"><span class="hs-identifier hs-type">HandleTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-type">NullView</span></a></span><span>
</span><span id="line-161"></span><span id="makeTestNullView"><span class="annot"><span class="annottext">makeTestNullView :: TestInfo -&gt; HandleTag -&gt; HandleTag -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#makeTestNullView"><span class="hs-identifier hs-var hs-var">makeTestNullView</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679111805"><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679111805"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679111806"><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679111806"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679111807"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111807"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679111808"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111808"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa) -&gt; SetTestInfo
</span><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier hs-var">SetTestInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhichTest -&gt; EnumSet DoPa -&gt; EnumMap WhichTest (EnumSet DoPa)
forall key a. Enum key =&gt; key -&gt; a -&gt; EnumMap key a
</span><a href="Data.IntMap.EnumMap2.html#singleton"><span class="hs-identifier hs-var">Map.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679111805"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DoPa -&gt; EnumSet DoPa
forall e. Enum e =&gt; e -&gt; EnumSet e
</span><a href="Data.IntSet.EnumSet2.html#singleton"><span class="hs-identifier hs-var">Set.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679111806"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; TagList
</span><a href="Text.Regex.TDFA.CorePattern.html#promotePreTag"><span class="hs-identifier hs-var">promotePreTag</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111807"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">TagList -&gt; TagList -&gt; TagList
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; TagList
</span><a href="Text.Regex.TDFA.CorePattern.html#promotePreTag"><span class="hs-identifier hs-var">promotePreTag</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111808"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#tagWrapNullView"><span class="hs-identifier hs-type">tagWrapNullView</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HandleTag"><span class="hs-identifier hs-type">HandleTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HandleTag"><span class="hs-identifier hs-type">HandleTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-type">NullView</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-type">NullView</span></a></span><span>
</span><span id="line-164"></span><span id="tagWrapNullView"><span class="annot"><span class="annottext">tagWrapNullView :: HandleTag -&gt; HandleTag -&gt; NullView -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#tagWrapNullView"><span class="hs-identifier hs-var hs-var">tagWrapNullView</span></a></span></span><span> </span><span id="local-6989586621679111810"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111810"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679111811"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111811"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679111812"><span class="annot"><span class="annottext">NullView
</span><a href="#local-6989586621679111812"><span class="hs-identifier hs-var">oldNV</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HandleTag -&gt; TagList
</span><a href="Text.Regex.TDFA.CorePattern.html#promotePreTag"><span class="hs-identifier hs-var">promotePreTag</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111810"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; TagList
</span><a href="Text.Regex.TDFA.CorePattern.html#promotePreTag"><span class="hs-identifier hs-var">promotePreTag</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111811"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NullView
</span><a href="#local-6989586621679111812"><span class="hs-identifier hs-var">oldNV</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679111813"><span class="annot"><span class="annottext">TagList
</span><a href="#local-6989586621679111813"><span class="hs-identifier hs-var">pre</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679111814"><span class="annot"><span class="annottext">TagList
</span><a href="#local-6989586621679111814"><span class="hs-identifier hs-var">post</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-168"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679111815"><span class="annot"><span class="annottext">SetTestInfo
</span><a href="#local-6989586621679111815"><span class="hs-identifier hs-var">oldTests</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679111816"><span class="annot"><span class="annottext">TagList
</span><a href="#local-6989586621679111816"><span class="hs-identifier hs-var">oldTasks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NullView
</span><a href="#local-6989586621679111812"><span class="hs-identifier hs-var">oldNV</span></a></span><span>
</span><span id="line-169"></span><span>      </span><span class="annot"><span class="annottext">(SetTestInfo, TagList) -&gt; NullView
forall a. a -&gt; [a]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SetTestInfo
</span><a href="#local-6989586621679111815"><span class="hs-identifier hs-var">oldTests</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagList
</span><a href="#local-6989586621679111813"><span class="hs-identifier hs-var">pre</span></a></span><span class="annot"><span class="annottext">TagList -&gt; TagList -&gt; TagList
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">TagList
</span><a href="#local-6989586621679111816"><span class="hs-identifier hs-var">oldTasks</span></a></span><span class="annot"><span class="annottext">TagList -&gt; TagList -&gt; TagList
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">TagList
</span><a href="#local-6989586621679111814"><span class="hs-identifier hs-var">post</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-comment">-- For PGroup, need to prepend reset tasks before others in nullView</span><span>
</span><span id="line-172"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#addGroupResetsToNullView"><span class="hs-identifier hs-type">addGroupResetsToNullView</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-type">NullView</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-type">NullView</span></a></span><span>
</span><span id="line-173"></span><span id="addGroupResetsToNullView"><span class="annot"><span class="annottext">addGroupResetsToNullView :: [GroupIndex] -&gt; GroupIndex -&gt; NullView -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#addGroupResetsToNullView"><span class="hs-identifier hs-var hs-var">addGroupResetsToNullView</span></a></span></span><span> </span><span id="local-6989586621679111818"><span class="annot"><span class="annottext">[GroupIndex]
</span><a href="#local-6989586621679111818"><span class="hs-identifier hs-var">groupResets</span></a></span></span><span> </span><span id="local-6989586621679111819"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111819"><span class="hs-identifier hs-var">groupSet</span></a></span></span><span> </span><span id="local-6989586621679111820"><span class="annot"><span class="annottext">NullView
</span><a href="#local-6989586621679111820"><span class="hs-identifier hs-var">nv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SetTestInfo
</span><a href="#local-6989586621679111821"><span class="hs-identifier hs-var">test</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TagList -&gt; TagList
</span><a href="#local-6989586621679111822"><span class="hs-identifier hs-var">prepend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagList -&gt; TagList
</span><a href="#local-6989586621679111823"><span class="hs-identifier hs-var">append</span></a></span><span> </span><span class="annot"><span class="annottext">TagList
</span><a href="#local-6989586621679111824"><span class="hs-identifier hs-var">tags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679111821"><span class="annot"><span class="annottext">SetTestInfo
</span><a href="#local-6989586621679111821"><span class="hs-identifier hs-var">test</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679111824"><span class="annot"><span class="annottext">TagList
</span><a href="#local-6989586621679111824"><span class="hs-identifier hs-var">tags</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NullView
</span><a href="#local-6989586621679111820"><span class="hs-identifier hs-var">nv</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679111822"><span class="annot"><span class="annottext">prepend :: TagList -&gt; TagList
</span><a href="#local-6989586621679111822"><span class="hs-identifier hs-var hs-var">prepend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((GroupIndex, TagUpdate)
 -&gt; (TagList -&gt; TagList) -&gt; TagList -&gt; TagList)
-&gt; (TagList -&gt; TagList) -&gt; TagList -&gt; TagList -&gt; TagList
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679111827"><span class="annot"><span class="annottext">(GroupIndex, TagUpdate)
</span><a href="#local-6989586621679111827"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679111828"><span class="annot"><span class="annottext">TagList -&gt; TagList
</span><a href="#local-6989586621679111828"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GroupIndex, TagUpdate)
</span><a href="#local-6989586621679111827"><span class="hs-identifier hs-var">h</span></a></span><span class="annot"><span class="annottext">(GroupIndex, TagUpdate) -&gt; TagList -&gt; TagList
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(TagList -&gt; TagList) -&gt; (TagList -&gt; TagList) -&gt; TagList -&gt; TagList
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">TagList -&gt; TagList
</span><a href="#local-6989586621679111828"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TagList -&gt; TagList
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(TagList -&gt; TagList -&gt; TagList)
-&gt; ([GroupIndex] -&gt; TagList) -&gt; [GroupIndex] -&gt; TagList -&gt; TagList
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(GroupIndex -&gt; (GroupIndex, TagUpdate)) -&gt; [GroupIndex] -&gt; TagList
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679111830"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111830"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-glyph">-&gt;</span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111830"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagTask -&gt; TagUpdate
</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#ResetGroupStopTask"><span class="hs-identifier hs-var">ResetGroupStopTask</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([GroupIndex] -&gt; TagList -&gt; TagList)
-&gt; [GroupIndex] -&gt; TagList -&gt; TagList
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[GroupIndex]
</span><a href="#local-6989586621679111818"><span class="hs-identifier hs-var">groupResets</span></a></span><span>
</span><span id="line-175"></span><span>        </span><span id="local-6989586621679111823"><span class="annot"><span class="annottext">append :: TagList -&gt; TagList
</span><a href="#local-6989586621679111823"><span class="hs-identifier hs-var hs-var">append</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagList -&gt; TagList -&gt; TagList
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111819"><span class="hs-identifier hs-var">groupSet</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagTask -&gt; TagUpdate
</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#SetGroupStopTask"><span class="hs-identifier hs-var">SetGroupStopTask</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-comment">-- For PStar, need to put in the orbit TagTasks</span><span>
</span><span id="line-178"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#orbitWrapNullView"><span class="hs-identifier hs-type">orbitWrapNullView</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-type">NullView</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-type">NullView</span></a></span><span>
</span><span id="line-179"></span><span id="orbitWrapNullView"><span class="annot"><span class="annottext">orbitWrapNullView :: Maybe GroupIndex -&gt; [GroupIndex] -&gt; NullView -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#orbitWrapNullView"><span class="hs-identifier hs-var hs-var">orbitWrapNullView</span></a></span></span><span> </span><span id="local-6989586621679111834"><span class="annot"><span class="annottext">Maybe GroupIndex
</span><a href="#local-6989586621679111834"><span class="hs-identifier hs-var">mOrbit</span></a></span></span><span> </span><span id="local-6989586621679111835"><span class="annot"><span class="annottext">[GroupIndex]
</span><a href="#local-6989586621679111835"><span class="hs-identifier hs-var">orbitResets</span></a></span></span><span> </span><span id="local-6989586621679111836"><span class="annot"><span class="annottext">NullView
</span><a href="#local-6989586621679111836"><span class="hs-identifier hs-var">oldNV</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe GroupIndex
</span><a href="#local-6989586621679111834"><span class="hs-identifier hs-var">mOrbit</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[GroupIndex]
</span><a href="#local-6989586621679111835"><span class="hs-identifier hs-var">orbitResets</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe GroupIndex
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NullView
</span><a href="#local-6989586621679111836"><span class="hs-identifier hs-var">oldNV</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe GroupIndex
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[GroupIndex]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679111837"><span class="annot"><span class="annottext">SetTestInfo
</span><a href="#local-6989586621679111837"><span class="hs-identifier hs-var">oldTests</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679111838"><span class="annot"><span class="annottext">TagList
</span><a href="#local-6989586621679111838"><span class="hs-identifier hs-var">oldTasks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NullView
</span><a href="#local-6989586621679111836"><span class="hs-identifier hs-var">oldNV</span></a></span><span>
</span><span id="line-183"></span><span>                      </span><span class="annot"><span class="annottext">(SetTestInfo, TagList) -&gt; NullView
forall a. a -&gt; [a]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SetTestInfo
</span><a href="#local-6989586621679111837"><span class="hs-identifier hs-var">oldTests</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagList -&gt; TagList
</span><a href="#local-6989586621679111839"><span class="hs-identifier hs-var">prepend</span></a></span><span> </span><span class="annot"><span class="annottext">TagList
</span><a href="#local-6989586621679111838"><span class="hs-identifier hs-var">oldTasks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679111840"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111840"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[GroupIndex]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679111841"><span class="annot"><span class="annottext">SetTestInfo
</span><a href="#local-6989586621679111841"><span class="hs-identifier hs-var">oldTests</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679111842"><span class="annot"><span class="annottext">TagList
</span><a href="#local-6989586621679111842"><span class="hs-identifier hs-var">oldTasks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NullView
</span><a href="#local-6989586621679111836"><span class="hs-identifier hs-var">oldNV</span></a></span><span>
</span><span id="line-185"></span><span>                     </span><span class="annot"><span class="annottext">(SetTestInfo, TagList) -&gt; NullView
forall a. a -&gt; [a]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SetTestInfo
</span><a href="#local-6989586621679111841"><span class="hs-identifier hs-var">oldTests</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagList -&gt; TagList
</span><a href="#local-6989586621679111839"><span class="hs-identifier hs-var">prepend</span></a></span><span> </span><span class="annot"><span class="annottext">(TagList -&gt; TagList) -&gt; TagList -&gt; TagList
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111840"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagTask -&gt; TagUpdate
</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#EnterOrbitTask"><span class="hs-identifier hs-var">EnterOrbitTask</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TagList -&gt; TagList -&gt; TagList
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TagList
</span><a href="#local-6989586621679111842"><span class="hs-identifier hs-var">oldTasks</span></a></span><span> </span><span class="annot"><span class="annottext">TagList -&gt; TagList -&gt; TagList
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111840"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagTask -&gt; TagUpdate
</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#LeaveOrbitTask"><span class="hs-identifier hs-var">LeaveOrbitTask</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679111839"><span class="annot"><span class="annottext">prepend :: TagList -&gt; TagList
</span><a href="#local-6989586621679111839"><span class="hs-identifier hs-var hs-var">prepend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((GroupIndex, TagUpdate)
 -&gt; (TagList -&gt; TagList) -&gt; TagList -&gt; TagList)
-&gt; (TagList -&gt; TagList) -&gt; TagList -&gt; TagList -&gt; TagList
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679111846"><span class="annot"><span class="annottext">(GroupIndex, TagUpdate)
</span><a href="#local-6989586621679111846"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679111847"><span class="annot"><span class="annottext">TagList -&gt; TagList
</span><a href="#local-6989586621679111847"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GroupIndex, TagUpdate)
</span><a href="#local-6989586621679111846"><span class="hs-identifier hs-var">h</span></a></span><span class="annot"><span class="annottext">(GroupIndex, TagUpdate) -&gt; TagList -&gt; TagList
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(TagList -&gt; TagList) -&gt; (TagList -&gt; TagList) -&gt; TagList -&gt; TagList
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">TagList -&gt; TagList
</span><a href="#local-6989586621679111847"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TagList -&gt; TagList
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(TagList -&gt; TagList -&gt; TagList)
-&gt; ([GroupIndex] -&gt; TagList) -&gt; [GroupIndex] -&gt; TagList -&gt; TagList
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(GroupIndex -&gt; (GroupIndex, TagUpdate)) -&gt; [GroupIndex] -&gt; TagList
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679111848"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111848"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-glyph">-&gt;</span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111848"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagTask -&gt; TagUpdate
</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TagTask
</span><a href="Text.Regex.TDFA.Common.html#ResetOrbitTask"><span class="hs-identifier hs-var">ResetOrbitTask</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([GroupIndex] -&gt; TagList -&gt; TagList)
-&gt; [GroupIndex] -&gt; TagList -&gt; TagList
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[GroupIndex]
</span><a href="#local-6989586621679111835"><span class="hs-identifier hs-var">orbitResets</span></a></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-comment">-- The NullViews are ordered, and later test sets that contain the</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- tests from any earlier entry will never be chosen.  This function</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- returns a list with these redundant elements removed.  Note that</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- the first unconditional entry in the list will be the last entry of</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- the returned list since the empty set is a subset of any other set.</span><span>
</span><span id="line-193"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#cleanNullView"><span class="hs-identifier hs-type">cleanNullView</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-type">NullView</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-type">NullView</span></a></span><span>
</span><span id="line-194"></span><span id="cleanNullView"><span class="annot"><span class="annottext">cleanNullView :: NullView -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#cleanNullView"><span class="hs-identifier hs-var hs-var">cleanNullView</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-195"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#cleanNullView"><span class="hs-identifier hs-var">cleanNullView</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679111850"><span class="annot"><span class="annottext">first :: (SetTestInfo, TagList)
</span><a href="#local-6989586621679111850"><span class="hs-identifier hs-var">first</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier hs-type">SetTestInfo</span></a></span><span> </span><span id="local-6989586621679111851"><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa)
</span><a href="#local-6989586621679111851"><span class="hs-identifier hs-var">sti</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagList
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679111852"><span class="annot"><span class="annottext">NullView
</span><a href="#local-6989586621679111852"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa) -&gt; Bool
forall key a. Enum key =&gt; EnumMap key a -&gt; Bool
</span><a href="Data.IntMap.EnumMap2.html#null"><span class="hs-identifier hs-var">Map.null</span></a></span><span> </span><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa)
</span><a href="#local-6989586621679111851"><span class="hs-identifier hs-var">sti</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SetTestInfo, TagList)
</span><a href="#local-6989586621679111850"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">(SetTestInfo, TagList) -&gt; NullView -&gt; NullView
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- optimization</span><span>
</span><span id="line-196"></span><span>                                               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><span class="annottext">(SetTestInfo, TagList)
</span><a href="#local-6989586621679111850"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">(SetTestInfo, TagList) -&gt; NullView -&gt; NullView
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">NullView -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#cleanNullView"><span class="hs-identifier hs-var">cleanNullView</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((SetTestInfo, TagList) -&gt; Bool) -&gt; NullView -&gt; NullView
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ((SetTestInfo, TagList) -&gt; Bool)
-&gt; (SetTestInfo, TagList)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EnumSet WhichTest
</span><a href="#local-6989586621679111854"><span class="hs-identifier hs-var">setTI</span></a></span><span> </span><span class="annot"><span class="annottext">EnumSet WhichTest -&gt; EnumSet WhichTest -&gt; Bool
forall e. Enum e =&gt; EnumSet e -&gt; EnumSet e -&gt; Bool
</span><a href="Data.IntSet.EnumSet2.html#isSubsetOf"><span class="hs-operator hs-var">`Set.isSubsetOf`</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(EnumSet WhichTest -&gt; Bool)
-&gt; ((SetTestInfo, TagList) -&gt; EnumSet WhichTest)
-&gt; (SetTestInfo, TagList)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa) -&gt; EnumSet WhichTest
forall key a. Enum key =&gt; EnumMap key a -&gt; EnumSet key
</span><a href="Data.IntMap.EnumMap2.html#keysSet"><span class="hs-identifier hs-var">Map.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">(EnumMap WhichTest (EnumSet DoPa) -&gt; EnumSet WhichTest)
-&gt; ((SetTestInfo, TagList) -&gt; EnumMap WhichTest (EnumSet DoPa))
-&gt; (SetTestInfo, TagList)
-&gt; EnumSet WhichTest
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SetTestInfo -&gt; EnumMap WhichTest (EnumSet DoPa)
</span><a href="Text.Regex.TDFA.CorePattern.html#getTests"><span class="hs-identifier hs-var">getTests</span></a></span><span> </span><span class="annot"><span class="annottext">(SetTestInfo -&gt; EnumMap WhichTest (EnumSet DoPa))
-&gt; ((SetTestInfo, TagList) -&gt; SetTestInfo)
-&gt; (SetTestInfo, TagList)
-&gt; EnumMap WhichTest (EnumSet DoPa)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(SetTestInfo, TagList) -&gt; SetTestInfo
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NullView
</span><a href="#local-6989586621679111852"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679111854"><span class="annot"><span class="annottext">setTI :: EnumSet WhichTest
</span><a href="#local-6989586621679111854"><span class="hs-identifier hs-var hs-var">setTI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa) -&gt; EnumSet WhichTest
forall key a. Enum key =&gt; EnumMap key a -&gt; EnumSet key
</span><a href="Data.IntMap.EnumMap2.html#keysSet"><span class="hs-identifier hs-var">Map.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">EnumMap WhichTest (EnumSet DoPa)
</span><a href="#local-6989586621679111851"><span class="hs-identifier hs-var">sti</span></a></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-comment">-- Ordered Sequence of two NullViews: all ordered combinations of tests and tags.</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- Order of &lt;- s1 and &lt;- s2 is deliberately chosen to maintain preference priority</span><span>
</span><span id="line-202"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#mergeNullViews"><span class="hs-identifier hs-type">mergeNullViews</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-type">NullView</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-type">NullView</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-type">NullView</span></a></span><span>
</span><span id="line-203"></span><span id="mergeNullViews"><span class="annot"><span class="annottext">mergeNullViews :: NullView -&gt; NullView -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#mergeNullViews"><span class="hs-identifier hs-var hs-var">mergeNullViews</span></a></span></span><span> </span><span id="local-6989586621679111858"><span class="annot"><span class="annottext">NullView
</span><a href="#local-6989586621679111858"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621679111859"><span class="annot"><span class="annottext">NullView
</span><a href="#local-6989586621679111859"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NullView -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#cleanNullView"><span class="hs-identifier hs-var">cleanNullView</span></a></span><span> </span><span class="annot"><span class="annottext">(NullView -&gt; NullView) -&gt; NullView -&gt; NullView
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679111860"><span class="annot"><span class="annottext">SetTestInfo
</span><a href="#local-6989586621679111860"><span class="hs-identifier hs-var">test1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679111861"><span class="annot"><span class="annottext">TagList
</span><a href="#local-6989586621679111861"><span class="hs-identifier hs-var">tag1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NullView
</span><a href="#local-6989586621679111858"><span class="hs-identifier hs-var">s1</span></a></span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679111862"><span class="annot"><span class="annottext">SetTestInfo
</span><a href="#local-6989586621679111862"><span class="hs-identifier hs-var">test2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679111863"><span class="annot"><span class="annottext">TagList
</span><a href="#local-6989586621679111863"><span class="hs-identifier hs-var">tag2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NullView
</span><a href="#local-6989586621679111859"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-206"></span><span>  </span><span class="annot"><span class="annottext">(SetTestInfo, TagList) -&gt; NullView
forall a. a -&gt; [a]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SetTestInfo -&gt; SetTestInfo -&gt; SetTestInfo
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">mappend</span></span><span> </span><span class="annot"><span class="annottext">SetTestInfo
</span><a href="#local-6989586621679111860"><span class="hs-identifier hs-var">test1</span></a></span><span> </span><span class="annot"><span class="annottext">SetTestInfo
</span><a href="#local-6989586621679111862"><span class="hs-identifier hs-var">test2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TagList -&gt; TagList -&gt; TagList
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">mappend</span></span><span> </span><span class="annot"><span class="annottext">TagList
</span><a href="#local-6989586621679111861"><span class="hs-identifier hs-var">tag1</span></a></span><span> </span><span class="annot"><span class="annottext">TagList
</span><a href="#local-6989586621679111863"><span class="hs-identifier hs-var">tag2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- mergeNullViews = cleanNullView $ liftM2 (mappend *** mappend)</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="hs-comment">-- Concatenated two ranges of number of accepted characters</span><span>
</span><span id="line-210"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#seqTake"><span class="hs-identifier hs-type">seqTake</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span id="seqTake"><span class="annot"><span class="annottext">seqTake :: (GroupIndex, Maybe GroupIndex)
-&gt; (GroupIndex, Maybe GroupIndex) -&gt; (GroupIndex, Maybe GroupIndex)
</span><a href="Text.Regex.TDFA.CorePattern.html#seqTake"><span class="hs-identifier hs-var hs-var">seqTake</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679111865"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111865"><span class="hs-identifier hs-var">x1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679111866"><span class="annot"><span class="annottext">Maybe GroupIndex
</span><a href="#local-6989586621679111866"><span class="hs-identifier hs-var">y1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679111867"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111867"><span class="hs-identifier hs-var">x2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679111868"><span class="annot"><span class="annottext">Maybe GroupIndex
</span><a href="#local-6989586621679111868"><span class="hs-identifier hs-var">y2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111865"><span class="hs-identifier hs-var">x1</span></a></span><span class="annot"><span class="annottext">GroupIndex -&gt; GroupIndex -&gt; GroupIndex
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111867"><span class="hs-identifier hs-var">x2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">(GroupIndex -&gt; GroupIndex -&gt; GroupIndex)
-&gt; Maybe GroupIndex -&gt; Maybe GroupIndex -&gt; Maybe GroupIndex
forall (m :: * -&gt; *) a1 a2 r.
Monad m =&gt;
(a1 -&gt; a2 -&gt; r) -&gt; m a1 -&gt; m a2 -&gt; m r
</span><span class="hs-identifier hs-var">liftM2</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex -&gt; GroupIndex -&gt; GroupIndex
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span> </span><span class="annot"><span class="annottext">Maybe GroupIndex
</span><a href="#local-6989586621679111866"><span class="hs-identifier hs-var">y1</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe GroupIndex
</span><a href="#local-6989586621679111868"><span class="hs-identifier hs-var">y2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="hs-comment">-- Parallel combination of list of ranges of number of accepted characters</span><span>
</span><span id="line-214"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#orTakes"><span class="hs-identifier hs-type">orTakes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span id="orTakes"><span class="annot"><span class="annottext">orTakes :: [(GroupIndex, Maybe GroupIndex)] -&gt; (GroupIndex, Maybe GroupIndex)
</span><a href="Text.Regex.TDFA.CorePattern.html#orTakes"><span class="hs-identifier hs-var hs-var">orTakes</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">GroupIndex -&gt; Maybe GroupIndex
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#orTakes"><span class="hs-identifier hs-var">orTakes</span></a></span><span> </span><span id="local-6989586621679111871"><span class="annot"><span class="annottext">[(GroupIndex, Maybe GroupIndex)]
</span><a href="#local-6989586621679111871"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679111872"><span class="annot"><span class="annottext">[GroupIndex]
</span><a href="#local-6989586621679111872"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679111873"><span class="annot"><span class="annottext">[Maybe GroupIndex]
</span><a href="#local-6989586621679111873"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(GroupIndex, Maybe GroupIndex)]
-&gt; ([GroupIndex], [Maybe GroupIndex])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">[(GroupIndex, Maybe GroupIndex)]
</span><a href="#local-6989586621679111871"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-217"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GroupIndex] -&gt; GroupIndex
forall a. Ord a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">minimum</span></span><span> </span><span class="annot"><span class="annottext">[GroupIndex]
</span><a href="#local-6989586621679111872"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Maybe GroupIndex -&gt; Maybe GroupIndex -&gt; Maybe GroupIndex)
-&gt; [Maybe GroupIndex] -&gt; Maybe GroupIndex
forall a. (a -&gt; a -&gt; a) -&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">foldl1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GroupIndex -&gt; GroupIndex -&gt; GroupIndex)
-&gt; Maybe GroupIndex -&gt; Maybe GroupIndex -&gt; Maybe GroupIndex
forall (m :: * -&gt; *) a1 a2 r.
Monad m =&gt;
(a1 -&gt; a2 -&gt; r) -&gt; m a1 -&gt; m a2 -&gt; m r
</span><span class="hs-identifier hs-var">liftM2</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex -&gt; GroupIndex -&gt; GroupIndex
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Maybe GroupIndex]
</span><a href="#local-6989586621679111873"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-comment">-- Invariant: apply (toAdvice _ ) == mempty</span><span>
</span><span id="line-220"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#apply"><span class="hs-identifier hs-type">apply</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HandleTag"><span class="hs-identifier hs-type">HandleTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span>
</span><span id="line-221"></span><span id="apply"><span class="annot"><span class="annottext">apply :: HandleTag -&gt; Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#apply"><span class="hs-identifier hs-var hs-var">apply</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621679111878"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111878"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GroupIndex -&gt; Maybe GroupIndex
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111878"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-222"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#apply"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe GroupIndex
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-223"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#toAdvice"><span class="hs-identifier hs-type">toAdvice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HandleTag"><span class="hs-identifier hs-type">HandleTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HandleTag"><span class="hs-identifier hs-type">HandleTag</span></a></span><span>
</span><span id="line-224"></span><span id="toAdvice"><span class="annot"><span class="annottext">toAdvice :: HandleTag -&gt; HandleTag
</span><a href="Text.Regex.TDFA.CorePattern.html#toAdvice"><span class="hs-identifier hs-var hs-var">toAdvice</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621679111880"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111880"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GroupIndex -&gt; HandleTag
</span><a href="Text.Regex.TDFA.CorePattern.html#Advice"><span class="hs-identifier hs-var">Advice</span></a></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111880"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-225"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#toAdvice"><span class="hs-identifier hs-var">toAdvice</span></a></span><span> </span><span id="local-6989586621679111881"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111881"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111881"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-226"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#noTag"><span class="hs-identifier hs-type">noTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HandleTag"><span class="hs-identifier hs-type">HandleTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-227"></span><span id="noTag"><span class="annot"><span class="annottext">noTag :: HandleTag -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#noTag"><span class="hs-identifier hs-var hs-var">noTag</span></a></span></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="Text.Regex.TDFA.CorePattern.html#NoTag"><span class="hs-identifier hs-var">NoTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-228"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#noTag"><span class="hs-identifier hs-var">noTag</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-229"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#fromHandleTag"><span class="hs-identifier hs-type">fromHandleTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HandleTag"><span class="hs-identifier hs-type">HandleTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span>
</span><span id="line-230"></span><span id="fromHandleTag"><span class="annot"><span class="annottext">fromHandleTag :: HandleTag -&gt; GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#fromHandleTag"><span class="hs-identifier hs-var hs-var">fromHandleTag</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621679111884"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111884"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111884"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-231"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#fromHandleTag"><span class="hs-identifier hs-var">fromHandleTag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Advice"><span class="hs-identifier hs-type">Advice</span></a></span><span> </span><span id="local-6989586621679111885"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111885"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111885"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-232"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#fromHandleTag"><span class="hs-identifier hs-var">fromHandleTag</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; GroupIndex
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fromHandleTag&quot;</span></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="hs-comment">-- Predicates on the range of number of accepted  characters</span><span>
</span><span id="line-235"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#varies"><span class="hs-identifier hs-type">varies</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-236"></span><span id="varies"><span class="annot"><span class="annottext">varies :: Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#varies"><span class="hs-identifier hs-var hs-var">varies</span></a></span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">takes :: Q -&gt; (GroupIndex, Maybe GroupIndex)
</span><a href="Text.Regex.TDFA.CorePattern.html#takes"><span class="hs-identifier hs-var">takes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe GroupIndex
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-237"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#varies"><span class="hs-identifier hs-var">varies</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">takes :: Q -&gt; (GroupIndex, Maybe GroupIndex)
</span><a href="Text.Regex.TDFA.CorePattern.html#takes"><span class="hs-identifier hs-var">takes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679111888"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111888"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679111889"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111889"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111888"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">GroupIndex -&gt; GroupIndex -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111889"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#mustAccept"><span class="hs-identifier hs-type">mustAccept</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-240"></span><span id="mustAccept"><span class="annot"><span class="annottext">mustAccept :: Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#mustAccept"><span class="hs-identifier hs-var hs-var">mustAccept</span></a></span></span><span> </span><span id="local-6989586621679111891"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111891"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">0</span></span><span class="annot"><span class="annottext">GroupIndex -&gt; GroupIndex -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(GroupIndex -&gt; Bool) -&gt; (Q -&gt; GroupIndex) -&gt; Q -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(GroupIndex, Maybe GroupIndex) -&gt; GroupIndex
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((GroupIndex, Maybe GroupIndex) -&gt; GroupIndex)
-&gt; (Q -&gt; (GroupIndex, Maybe GroupIndex)) -&gt; Q -&gt; GroupIndex
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; (GroupIndex, Maybe GroupIndex)
</span><a href="Text.Regex.TDFA.CorePattern.html#takes"><span class="hs-identifier hs-var">takes</span></a></span><span> </span><span class="annot"><span class="annottext">(Q -&gt; Bool) -&gt; Q -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111891"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#canAccept"><span class="hs-identifier hs-type">canAccept</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-243"></span><span id="canAccept"><span class="annot"><span class="annottext">canAccept :: Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#canAccept"><span class="hs-identifier hs-var hs-var">canAccept</span></a></span></span><span> </span><span id="local-6989586621679111893"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111893"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (GroupIndex -&gt; Bool) -&gt; Maybe GroupIndex -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">0</span></span><span class="annot"><span class="annottext">GroupIndex -&gt; GroupIndex -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe GroupIndex -&gt; Bool) -&gt; Maybe GroupIndex -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(GroupIndex, Maybe GroupIndex) -&gt; Maybe GroupIndex
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((GroupIndex, Maybe GroupIndex) -&gt; Maybe GroupIndex)
-&gt; (Q -&gt; (GroupIndex, Maybe GroupIndex)) -&gt; Q -&gt; Maybe GroupIndex
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; (GroupIndex, Maybe GroupIndex)
</span><a href="Text.Regex.TDFA.CorePattern.html#takes"><span class="hs-identifier hs-var">takes</span></a></span><span> </span><span class="annot"><span class="annottext">(Q -&gt; Maybe GroupIndex) -&gt; Q -&gt; Maybe GroupIndex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111893"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#cannotAccept"><span class="hs-identifier hs-type">cannotAccept</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-246"></span><span id="cannotAccept"><span class="annot"><span class="annottext">cannotAccept :: Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#cannotAccept"><span class="hs-identifier hs-var hs-var">cannotAccept</span></a></span></span><span> </span><span id="local-6989586621679111895"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111895"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (GroupIndex -&gt; Bool) -&gt; Maybe GroupIndex -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">0</span></span><span class="annot"><span class="annottext">GroupIndex -&gt; GroupIndex -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe GroupIndex -&gt; Bool) -&gt; Maybe GroupIndex -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(GroupIndex, Maybe GroupIndex) -&gt; Maybe GroupIndex
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((GroupIndex, Maybe GroupIndex) -&gt; Maybe GroupIndex)
-&gt; (Q -&gt; (GroupIndex, Maybe GroupIndex)) -&gt; Q -&gt; Maybe GroupIndex
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; (GroupIndex, Maybe GroupIndex)
</span><a href="Text.Regex.TDFA.CorePattern.html#takes"><span class="hs-identifier hs-var">takes</span></a></span><span> </span><span class="annot"><span class="annottext">(Q -&gt; Maybe GroupIndex) -&gt; Q -&gt; Maybe GroupIndex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111895"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span class="hs-comment">-- This converts then input Pattern to an analyzed Q structure with</span><span>
</span><span id="line-249"></span><span class="hs-comment">-- the tags assigned.</span><span>
</span><span id="line-250"></span><span class="hs-comment">--</span><span>
</span><span id="line-251"></span><span class="hs-comment">-- The analysis is filled in by a depth first search and the tags are</span><span>
</span><span id="line-252"></span><span class="hs-comment">-- created top down and passed to children.  Thus information flows up</span><span>
</span><span id="line-253"></span><span class="hs-comment">-- from the dfs of the children and simultaneously down in the form of</span><span>
</span><span id="line-254"></span><span class="hs-comment">-- pre and post HandleTag data.  This bidirectional flow is handled</span><span>
</span><span id="line-255"></span><span class="hs-comment">-- declaratively by using the MonadFix (i.e. mdo).</span><span>
</span><span id="line-256"></span><span class="hs-comment">--</span><span>
</span><span id="line-257"></span><span class="hs-comment">-- Invariant: A tag should exist in Q in exactly one place (and will</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- be in a preTag,postTag, or getOrbit field).  This is partly because</span><span>
</span><span id="line-259"></span><span class="hs-comment">-- PGroup needs to know the tags are around precisely the expression</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- that it wants to record.  If the same tag were in other branches</span><span>
</span><span id="line-261"></span><span class="hs-comment">-- then this would no longer be true.  The tag may or may not also</span><span>
</span><span id="line-262"></span><span class="hs-comment">-- show up in one or more preReset list or resetOrbits list.</span><span>
</span><span id="line-263"></span><span class="hs-comment">--</span><span>
</span><span id="line-264"></span><span class="hs-comment">-- This invariant is enforced by each node either taking</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- responsibility (apply) for a passed in / created tag or sending it</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- to exactly one child node.  Other child nodes need to receive it</span><span>
</span><span id="line-267"></span><span class="hs-comment">-- via toAdvice.  Leaf nodes are forced to apply any passed tags.</span><span>
</span><span id="line-268"></span><span class="hs-comment">--</span><span>
</span><span id="line-269"></span><span class="hs-comment">-- There is a final &quot;qwin of Q {postTag=ISet.singleton 1}&quot; and an</span><span>
</span><span id="line-270"></span><span class="hs-comment">-- implied initial index tag of 0.</span><span>
</span><span id="line-271"></span><span class="hs-comment">--</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- favoring pushing Apply into the child postTag makes PGroup happier</span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span class="hs-keyword">type</span><span> </span><span id="PM"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#PM"><span class="hs-identifier hs-var">PM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RWS</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupIndex"><span class="hs-identifier hs-type">GroupIndex</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupInfo"><span class="hs-identifier hs-type">GroupInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#OP"><span class="hs-identifier hs-type">OP</span></a></span><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#OP"><span class="hs-identifier hs-type">OP</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span class="hs-keyword">type</span><span> </span><span id="HHQ"><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HHQ"><span class="hs-identifier hs-var">HHQ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HandleTag"><span class="hs-identifier hs-type">HandleTag</span></a></span><span>  </span><span class="hs-comment">-- m1 : info about left boundary / preTag</span><span>
</span><span id="line-276"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HandleTag"><span class="hs-identifier hs-type">HandleTag</span></a></span><span>  </span><span class="hs-comment">-- m2 : info about right boundary / postTag</span><span>
</span><span id="line-277"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#PM"><span class="hs-identifier hs-type">PM</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="hs-comment">-- There is no group 0 here, since it is always the whole match and has no parent of its own</span><span>
</span><span id="line-280"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#makeGroupArray"><span class="hs-identifier hs-type">makeGroupArray</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupIndex"><span class="hs-identifier hs-type">GroupIndex</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupInfo"><span class="hs-identifier hs-type">GroupInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupIndex"><span class="hs-identifier hs-type">GroupIndex</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupInfo"><span class="hs-identifier hs-type">GroupInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-281"></span><span id="makeGroupArray"><span class="annot"><span class="annottext">makeGroupArray :: GroupIndex -&gt; [GroupInfo] -&gt; Array GroupIndex [GroupInfo]
</span><a href="Text.Regex.TDFA.CorePattern.html#makeGroupArray"><span class="hs-identifier hs-var hs-var">makeGroupArray</span></a></span></span><span> </span><span id="local-6989586621679111897"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111897"><span class="hs-identifier hs-var">maxGroupIndex</span></a></span></span><span> </span><span id="local-6989586621679111898"><span class="annot"><span class="annottext">[GroupInfo]
</span><a href="#local-6989586621679111898"><span class="hs-identifier hs-var">groups</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([GroupInfo] -&gt; GroupInfo -&gt; [GroupInfo])
-&gt; [GroupInfo]
-&gt; (GroupIndex, GroupIndex)
-&gt; [(GroupIndex, GroupInfo)]
-&gt; Array GroupIndex [GroupInfo]
forall (a :: * -&gt; * -&gt; *) e i e'.
(IArray a e, Ix i) =&gt;
(e -&gt; e' -&gt; e) -&gt; e -&gt; (i, i) -&gt; [(i, e')] -&gt; a i e
</span><span class="hs-identifier hs-var">accumArray</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679111899"><span class="annot"><span class="annottext">[GroupInfo]
</span><a href="#local-6989586621679111899"><span class="hs-identifier hs-var">earlier</span></a></span></span><span> </span><span id="local-6989586621679111900"><span class="annot"><span class="annottext">GroupInfo
</span><a href="#local-6989586621679111900"><span class="hs-identifier hs-var">later</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GroupInfo
</span><a href="#local-6989586621679111900"><span class="hs-identifier hs-var">later</span></a></span><span class="annot"><span class="annottext">GroupInfo -&gt; [GroupInfo] -&gt; [GroupInfo]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[GroupInfo]
</span><a href="#local-6989586621679111899"><span class="hs-identifier hs-var">earlier</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111897"><span class="hs-identifier hs-var">maxGroupIndex</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(GroupIndex, GroupInfo)]
</span><a href="#local-6989586621679111901"><span class="hs-identifier hs-var">filler</span></a></span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679111901"><span class="annot"><span class="annottext">filler :: [(GroupIndex, GroupInfo)]
</span><a href="#local-6989586621679111901"><span class="hs-identifier hs-var hs-var">filler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GroupInfo -&gt; (GroupIndex, GroupInfo))
-&gt; [GroupInfo] -&gt; [(GroupIndex, GroupInfo)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679111902"><span class="annot"><span class="annottext">GroupInfo
</span><a href="#local-6989586621679111902"><span class="hs-identifier hs-var">gi</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupInfo -&gt; GroupIndex
</span><a href="Text.Regex.TDFA.Common.html#thisIndex"><span class="hs-identifier hs-var">thisIndex</span></a></span><span> </span><span class="annot"><span class="annottext">GroupInfo
</span><a href="#local-6989586621679111902"><span class="hs-identifier hs-var">gi</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">GroupInfo
</span><a href="#local-6989586621679111902"><span class="hs-identifier hs-var">gi</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GroupInfo]
</span><a href="#local-6989586621679111898"><span class="hs-identifier hs-var">groups</span></a></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="hs-comment">-- Partial function: assumes starTrans has been run on the Pattern</span><span>
</span><span id="line-285"></span><span class="hs-comment">-- Note that the lazy dependency chain for this very zigzag:</span><span>
</span><span id="line-286"></span><span class="hs-comment">--   varies information is sent up the tree</span><span>
</span><span id="line-287"></span><span class="hs-comment">--   handle tags depend on that and sends m1 m2 down the tree</span><span>
</span><span id="line-288"></span><span class="hs-comment">--     makeGroup sends some tags to the writer (Right _)</span><span>
</span><span id="line-289"></span><span class="hs-comment">--     withParent listens to children send group info to writer</span><span>
</span><span id="line-290"></span><span class="hs-comment">--       and lazily looks resetGroupTags from aGroups, the result of all writer (Right _)</span><span>
</span><span id="line-291"></span><span class="hs-comment">--       preReset stores the resetGroupTags result of the lookup in the tree</span><span>
</span><span id="line-292"></span><span class="hs-comment">--     makeOrbit sends some tags to the writer (Left _)</span><span>
</span><span id="line-293"></span><span class="hs-comment">--     withOrbit listens to children send orbit info to writer for resetOrbitTags</span><span>
</span><span id="line-294"></span><span class="hs-comment">--   nullQ depends m1 m2 and resetOrbitTags and resetGroupTags and is sent up the tree</span><span>
</span><span id="line-295"></span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#patternToQ"><span class="hs-identifier hs-type">patternToQ</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#CompOption"><span class="hs-identifier hs-type">CompOption</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupIndex"><span class="hs-identifier hs-type">GroupIndex</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DoPa"><span class="hs-identifier hs-type">DoPa</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#OP"><span class="hs-identifier hs-type">OP</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupIndex"><span class="hs-identifier hs-type">GroupIndex</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupInfo"><span class="hs-identifier hs-type">GroupInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span id="patternToQ"><span class="annot"><span class="annottext">patternToQ :: CompOption
-&gt; (Pattern, (GroupIndex, DoPa))
-&gt; (Q, Array GroupIndex OP, Array GroupIndex [GroupInfo])
</span><a href="Text.Regex.TDFA.CorePattern.html#patternToQ"><span class="hs-identifier hs-var hs-var">patternToQ</span></a></span></span><span> </span><span id="local-6989586621679111904"><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621679111904"><span class="hs-identifier hs-var">compOpt</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679111905"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679111905"><span class="hs-identifier hs-var">pOrig</span></a></span></span><span class="hs-special">,</span><span class="hs-special">(</span><span id="local-6989586621679111906"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111906"><span class="hs-identifier hs-var">maxGroupIndex</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">DoPa
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111907"><span class="hs-identifier hs-var">tnfa</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Array GroupIndex OP
</span><a href="#local-6989586621679111908"><span class="hs-identifier hs-var">aTags</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Array GroupIndex [GroupInfo]
</span><a href="#local-6989586621679111909"><span class="hs-identifier hs-var">aGroups</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679111907"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111907"><span class="hs-identifier hs-var">tnfa</span></a></span></span><span class="hs-special">,</span><span class="hs-special">(</span><span id="local-6989586621679111910"><span class="annot"><span class="annottext">[OP] -&gt; [OP]
</span><a href="#local-6989586621679111910"><span class="hs-identifier hs-var">tag_dlist</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679111911"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111911"><span class="hs-identifier hs-var">nextTag</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679111912"><span class="annot"><span class="annottext">[Either GroupIndex GroupInfo]
</span><a href="#local-6989586621679111912"><span class="hs-identifier hs-var">groups</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RWS
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Q
-&gt; Maybe GroupIndex
-&gt; ([OP] -&gt; [OP], GroupIndex)
-&gt; (Q, ([OP] -&gt; [OP], GroupIndex), [Either GroupIndex GroupInfo])
forall r w s a. RWS r w s a -&gt; r -&gt; s -&gt; (a, s, w)
</span><span class="hs-identifier hs-var">runRWS</span></span><span> </span><span class="annot"><span class="annottext">RWS
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Q
</span><a href="#local-6989586621679111913"><span class="hs-identifier hs-var">monad</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe GroupIndex
</span><a href="#local-6989586621679111914"><span class="hs-identifier hs-var">startReader</span></a></span><span> </span><span class="annot"><span class="annottext">([OP] -&gt; [OP], GroupIndex)
</span><a href="#local-6989586621679111915"><span class="hs-identifier hs-var">startState</span></a></span><span>
</span><span id="line-298"></span><span>  </span><span id="local-6989586621679111908"><span class="annot"><span class="annottext">aTags :: Array GroupIndex OP
</span><a href="#local-6989586621679111908"><span class="hs-identifier hs-var hs-var">aTags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GroupIndex, GroupIndex) -&gt; [OP] -&gt; Array GroupIndex OP
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
(i, i) -&gt; [e] -&gt; a i e
</span><span class="hs-identifier hs-var">listArray</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">GroupIndex -&gt; GroupIndex
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">pred</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111911"><span class="hs-identifier hs-var">nextTag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[OP] -&gt; [OP]
</span><a href="#local-6989586621679111910"><span class="hs-identifier hs-var">tag_dlist</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>  </span><span id="local-6989586621679111909"><span class="annot"><span class="annottext">aGroups :: Array GroupIndex [GroupInfo]
</span><a href="#local-6989586621679111909"><span class="hs-identifier hs-var hs-var">aGroups</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GroupIndex -&gt; [GroupInfo] -&gt; Array GroupIndex [GroupInfo]
</span><a href="Text.Regex.TDFA.CorePattern.html#makeGroupArray"><span class="hs-identifier hs-var">makeGroupArray</span></a></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111906"><span class="hs-identifier hs-var">maxGroupIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Either GroupIndex GroupInfo] -&gt; [GroupInfo]
forall a b. [Either a b] -&gt; [b]
</span><span class="hs-identifier hs-var">rights</span></span><span> </span><span class="annot"><span class="annottext">[Either GroupIndex GroupInfo]
</span><a href="#local-6989586621679111912"><span class="hs-identifier hs-var">groups</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-comment">-- implicitly inside a PGroup 0 converted into a GroupInfo 0 undefined 0 1</span><span>
</span><span id="line-302"></span><span>  </span><span id="local-6989586621679111913"><span class="annot"><span class="annottext">monad :: RWS
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Q
</span><a href="#local-6989586621679111913"><span class="hs-identifier hs-var hs-var">monad</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; HHQ
</span><a href="#local-6989586621679111921"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern -&gt; Pattern
</span><a href="Text.Regex.TDFA.Pattern.html#starTrans"><span class="hs-identifier hs-var">starTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679111905"><span class="hs-identifier hs-var">pOrig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex -&gt; HandleTag
</span><a href="Text.Regex.TDFA.CorePattern.html#Advice"><span class="hs-identifier hs-var">Advice</span></a></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex -&gt; HandleTag
</span><a href="Text.Regex.TDFA.CorePattern.html#Advice"><span class="hs-identifier hs-var">Advice</span></a></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-comment">-- startReader is accessed by getParentIndex and changed by nonCapture and withParent</span><span>
</span><span id="line-304"></span><span>  </span><span class="annot"><a href="#local-6989586621679111914"><span class="hs-identifier hs-type">startReader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupIndex"><span class="hs-identifier hs-type">GroupIndex</span></a></span><span>
</span><span id="line-305"></span><span>  </span><span id="local-6989586621679111914"><span class="annot"><span class="annottext">startReader :: Maybe GroupIndex
</span><a href="#local-6989586621679111914"><span class="hs-identifier hs-var hs-var">startReader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GroupIndex -&gt; Maybe GroupIndex
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">0</span></span><span>                           </span><span class="hs-comment">-- start inside group 0, capturing enabled</span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-comment">-- The startState is only acted upon in the &quot;uniq&quot; command</span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-comment">-- Tag 0 is Minimized and Tag 1 is maximized, next tag has value of 2</span><span>
</span><span id="line-308"></span><span>  </span><span class="hs-comment">-- This is regardless of right or left associativity</span><span>
</span><span id="line-309"></span><span>  </span><span class="annot"><a href="#local-6989586621679111915"><span class="hs-identifier hs-type">startState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#OP"><span class="hs-identifier hs-type">OP</span></a></span><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#OP"><span class="hs-identifier hs-type">OP</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>  </span><span id="local-6989586621679111915"><span class="annot"><span class="annottext">startState :: ([OP] -&gt; [OP], GroupIndex)
</span><a href="#local-6989586621679111915"><span class="hs-identifier hs-var hs-var">startState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OP
</span><a href="Text.Regex.TDFA.Common.html#Minimize"><span class="hs-identifier hs-var">Minimize</span></a></span><span class="annot"><span class="annottext">OP -&gt; [OP] -&gt; [OP]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([OP] -&gt; [OP]) -&gt; ([OP] -&gt; [OP]) -&gt; [OP] -&gt; [OP]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OP
</span><a href="Text.Regex.TDFA.Common.html#Maximize"><span class="hs-identifier hs-var">Maximize</span></a></span><span class="annot"><span class="annottext">OP -&gt; [OP] -&gt; [OP]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-comment">-- uniq uses MonadState and always returns an &quot;Apply _&quot; tag</span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679111924"><span class="hs-pragma hs-type">uniq</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-314"></span><span>  </span><span class="annot"><a href="#local-6989586621679111924"><span class="hs-identifier hs-type">uniq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#PM"><span class="hs-identifier hs-type">PM</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HandleTag"><span class="hs-identifier hs-type">HandleTag</span></a></span><span>
</span><span id="line-315"></span><span>  </span><span id="local-6989586621679111924"><span class="annot"><span class="annottext">uniq :: String -&gt; PM HandleTag
</span><a href="#local-6989586621679111924"><span class="hs-identifier hs-var hs-var">uniq</span></a></span></span><span> </span><span id="local-6989586621679111925"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679111925"><span class="hs-identifier hs-var">_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GroupIndex -&gt; HandleTag)
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     GroupIndex
-&gt; PM HandleTag
forall a b.
(a -&gt; b)
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex -&gt; HandleTag
</span><a href="Text.Regex.TDFA.CorePattern.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OP
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     GroupIndex
</span><a href="#local-6989586621679111926"><span class="hs-identifier hs-var">uniq'</span></a></span><span> </span><span class="annot"><span class="annottext">OP
</span><a href="Text.Regex.TDFA.Common.html#Maximize"><span class="hs-identifier hs-var">Maximize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span class="hs-comment">--  uniq _msg = do x &lt;- fmap Apply (uniq' Maximize)</span><span>
</span><span id="line-317"></span><span class="hs-comment">--                trace ('\n':msg ++ &quot; Maximize &quot;++show x) $ return x</span><span>
</span><span id="line-318"></span><span class="hs-comment">--                return x</span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span>  </span><span class="annot"><a href="#local-6989586621679111927"><span class="hs-identifier hs-type">ignore</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#PM"><span class="hs-identifier hs-type">PM</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span>
</span><span id="line-321"></span><span>  </span><span id="local-6989586621679111927"><span class="annot"><span class="annottext">ignore :: String
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     GroupIndex
</span><a href="#local-6989586621679111927"><span class="hs-identifier hs-var hs-var">ignore</span></a></span></span><span> </span><span id="local-6989586621679111928"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679111928"><span class="hs-identifier hs-var">_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OP
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     GroupIndex
</span><a href="#local-6989586621679111926"><span class="hs-identifier hs-var">uniq'</span></a></span><span> </span><span class="annot"><span class="annottext">OP
</span><a href="Text.Regex.TDFA.Common.html#Ignore"><span class="hs-identifier hs-var">Ignore</span></a></span><span>
</span><span id="line-322"></span><span class="hs-comment">--  ignore _msg = do x &lt;- uniq' Ignore</span><span>
</span><span id="line-323"></span><span class="hs-comment">--                  trace ('\n':msg ++ &quot; Ignore &quot;++show x) $ return x</span><span>
</span><span id="line-324"></span><span class="hs-comment">--                  return x</span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="#local-6989586621679111926"><span class="hs-pragma hs-type">uniq'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-327"></span><span>  </span><span class="annot"><a href="#local-6989586621679111926"><span class="hs-identifier hs-type">uniq'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#OP"><span class="hs-identifier hs-type">OP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#PM"><span class="hs-identifier hs-type">PM</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span>
</span><span id="line-328"></span><span>  </span><span id="local-6989586621679111926"><span class="annot"><span class="annottext">uniq' :: OP
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     GroupIndex
</span><a href="#local-6989586621679111926"><span class="hs-identifier hs-var hs-var">uniq'</span></a></span></span><span> </span><span id="local-6989586621679111930"><span class="annot"><span class="annottext">OP
</span><a href="#local-6989586621679111930"><span class="hs-identifier hs-var">newOp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-329"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679111931"><span class="annot"><span class="annottext">[OP] -&gt; [OP]
</span><a href="#local-6989586621679111931"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679111932"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111932"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RWST
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Identity
  ([OP] -&gt; [OP], GroupIndex)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>                </span><span class="hs-comment">-- generate the next tag with bias newOp</span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679111933"><span class="annot"><span class="annottext">op' :: [OP] -&gt; [OP]
</span><a href="#local-6989586621679111933"><span class="hs-identifier hs-var hs-var">op'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OP] -&gt; [OP]
</span><a href="#local-6989586621679111931"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">([OP] -&gt; [OP]) -&gt; ([OP] -&gt; [OP]) -&gt; [OP] -&gt; [OP]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OP
</span><a href="#local-6989586621679111930"><span class="hs-identifier hs-var">newOp</span></a></span><span class="annot"><span class="annottext">OP -&gt; [OP] -&gt; [OP]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>        </span><span id="local-6989586621679111935"><span class="annot"><span class="annottext">s' :: GroupIndex
</span><a href="#local-6989586621679111935"><span class="hs-identifier hs-var hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GroupIndex -&gt; GroupIndex
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111932"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-332"></span><span>    </span><span class="annot"><span class="annottext">([OP] -&gt; [OP], GroupIndex)
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">(([OP] -&gt; [OP], GroupIndex)
 -&gt; RWST
      (Maybe GroupIndex)
      [Either GroupIndex GroupInfo]
      ([OP] -&gt; [OP], GroupIndex)
      Identity
      ())
-&gt; ([OP] -&gt; [OP], GroupIndex)
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[OP] -&gt; [OP]
</span><a href="#local-6989586621679111933"><span class="hs-identifier hs-var">op'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111935"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>    </span><span class="annot"><span class="annottext">GroupIndex
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     GroupIndex
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111932"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679111938"><span class="hs-pragma hs-type">makeOrbit</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-336"></span><span>  </span><span class="hs-comment">-- Specialize the monad operations and give more meaningful names</span><span>
</span><span id="line-337"></span><span>  </span><span class="hs-comment">-- makeOrbit uses MonadState(uniq) and MonadWriter(tell/Left)</span><span>
</span><span id="line-338"></span><span>  </span><span class="annot"><a href="#local-6989586621679111938"><span class="hs-identifier hs-type">makeOrbit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#PM"><span class="hs-identifier hs-type">PM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>  </span><span id="local-6989586621679111938"><span class="annot"><span class="annottext">makeOrbit :: PM (Maybe GroupIndex)
</span><a href="#local-6989586621679111938"><span class="hs-identifier hs-var hs-var">makeOrbit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679111939"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111939"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OP
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     GroupIndex
</span><a href="#local-6989586621679111926"><span class="hs-identifier hs-var">uniq'</span></a></span><span> </span><span class="annot"><span class="annottext">OP
</span><a href="Text.Regex.TDFA.Common.html#Orbit"><span class="hs-identifier hs-var">Orbit</span></a></span><span>
</span><span id="line-340"></span><span class="hs-comment">--                 trace ('\n':&quot;PStar Orbit &quot;++show x) $ do</span><span>
</span><span id="line-341"></span><span>                 </span><span class="annot"><span class="annottext">[Either GroupIndex GroupInfo]
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     ()
forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><span class="hs-identifier hs-var">tell</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GroupIndex -&gt; Either GroupIndex GroupInfo
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111939"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-342"></span><span>                 </span><span class="annot"><span class="annottext">Maybe GroupIndex -&gt; PM (Maybe GroupIndex)
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex -&gt; Maybe GroupIndex
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111939"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679111941"><span class="hs-pragma hs-type">withOrbit</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-comment">-- withOrbit uses MonadWriter(listens to makeOrbit/Left), collects</span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-comment">-- children at all depths</span><span>
</span><span id="line-347"></span><span>  </span><span id="local-6989586621679111329"><span class="annot"><a href="#local-6989586621679111941"><span class="hs-identifier hs-type">withOrbit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#PM"><span class="hs-identifier hs-type">PM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111329"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#PM"><span class="hs-identifier hs-type">PM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679111329"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-348"></span><span>  </span><span id="local-6989586621679111941"><span class="annot"><span class="annottext">withOrbit :: forall a. PM a -&gt; PM (a, [GroupIndex])
</span><a href="#local-6989586621679111941"><span class="hs-identifier hs-var hs-var">withOrbit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Either GroupIndex GroupInfo] -&gt; [GroupIndex])
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     (a, [GroupIndex])
forall w (m :: * -&gt; *) b a.
MonadWriter w m =&gt;
(w -&gt; b) -&gt; m a -&gt; m (a, b)
</span><span class="hs-identifier hs-var">listens</span></span><span> </span><span class="annot"><span class="annottext">(([Either GroupIndex GroupInfo] -&gt; [GroupIndex])
 -&gt; RWST
      (Maybe GroupIndex)
      [Either GroupIndex GroupInfo]
      ([OP] -&gt; [OP], GroupIndex)
      Identity
      a
 -&gt; RWST
      (Maybe GroupIndex)
      [Either GroupIndex GroupInfo]
      ([OP] -&gt; [OP], GroupIndex)
      Identity
      (a, [GroupIndex]))
-&gt; ([Either GroupIndex GroupInfo] -&gt; [GroupIndex])
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     (a, [GroupIndex])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([GroupIndex], [GroupInfo]) -&gt; [GroupIndex]
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(([GroupIndex], [GroupInfo]) -&gt; [GroupIndex])
-&gt; ([Either GroupIndex GroupInfo] -&gt; ([GroupIndex], [GroupInfo]))
-&gt; [Either GroupIndex GroupInfo]
-&gt; [GroupIndex]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Either GroupIndex GroupInfo] -&gt; ([GroupIndex], [GroupInfo])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679111943"><span class="hs-pragma hs-type">makeGroup</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-351"></span><span>  </span><span class="hs-comment">-- makeGroup usesMonadWriter(tell/Right)</span><span>
</span><span id="line-352"></span><span>  </span><span class="annot"><a href="#local-6989586621679111943"><span class="hs-identifier hs-type">makeGroup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupInfo"><span class="hs-identifier hs-type">GroupInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#PM"><span class="hs-identifier hs-type">PM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>  </span><span id="local-6989586621679111943"><span class="annot"><span class="annottext">makeGroup :: GroupInfo
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     ()
</span><a href="#local-6989586621679111943"><span class="hs-identifier hs-var hs-var">makeGroup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either GroupIndex GroupInfo]
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     ()
forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><span class="hs-identifier hs-var">tell</span></span><span> </span><span class="annot"><span class="annottext">([Either GroupIndex GroupInfo]
 -&gt; RWST
      (Maybe GroupIndex)
      [Either GroupIndex GroupInfo]
      ([OP] -&gt; [OP], GroupIndex)
      Identity
      ())
-&gt; (GroupInfo -&gt; [Either GroupIndex GroupInfo])
-&gt; GroupInfo
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either GroupIndex GroupInfo
-&gt; [Either GroupIndex GroupInfo] -&gt; [Either GroupIndex GroupInfo]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either GroupIndex GroupInfo -&gt; [Either GroupIndex GroupInfo])
-&gt; (GroupInfo -&gt; Either GroupIndex GroupInfo)
-&gt; GroupInfo
-&gt; [Either GroupIndex GroupInfo]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GroupInfo -&gt; Either GroupIndex GroupInfo
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679111944"><span class="hs-pragma hs-type">getParentIndex</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-356"></span><span>  </span><span class="hs-comment">-- getParentIndex uses MonadReader(ask)</span><span>
</span><span id="line-357"></span><span>  </span><span class="annot"><a href="#local-6989586621679111944"><span class="hs-identifier hs-type">getParentIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#PM"><span class="hs-identifier hs-type">PM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupIndex"><span class="hs-identifier hs-type">GroupIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>  </span><span id="local-6989586621679111944"><span class="annot"><span class="annottext">getParentIndex :: PM (Maybe GroupIndex)
</span><a href="#local-6989586621679111944"><span class="hs-identifier hs-var hs-var">getParentIndex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PM (Maybe GroupIndex)
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679111945"><span class="hs-pragma hs-type">nonCapture</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-comment">-- nonCapture uses MonadReader(local) to suppress getParentIndex to return Nothing</span><span>
</span><span id="line-362"></span><span>  </span><span id="local-6989586621679111339"><span class="annot"><a href="#local-6989586621679111945"><span class="hs-identifier hs-type">nonCapture</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#PM"><span class="hs-identifier hs-type">PM</span></a></span><span>  </span><span class="annot"><a href="#local-6989586621679111339"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#PM"><span class="hs-identifier hs-type">PM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111339"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-363"></span><span>  </span><span id="local-6989586621679111945"><span class="annot"><span class="annottext">nonCapture :: forall a. PM a -&gt; PM a
</span><a href="#local-6989586621679111945"><span class="hs-identifier hs-var hs-var">nonCapture</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe GroupIndex -&gt; Maybe GroupIndex)
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall a.
(Maybe GroupIndex -&gt; Maybe GroupIndex)
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe GroupIndex -&gt; Maybe GroupIndex -&gt; Maybe GroupIndex
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Maybe GroupIndex
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span>  </span><span class="hs-comment">-- withParent uses MonadReader(local) to set getParentIndex to return (Just this)</span><span>
</span><span id="line-366"></span><span>  </span><span class="hs-comment">-- withParent uses MonadWriter(listens to makeGroup/Right) to return contained group indices (stopTag)</span><span>
</span><span id="line-367"></span><span>  </span><span class="hs-comment">-- withParent is only safe if getParentIndex has been checked to be not equal to Nothing (see PGroup below)</span><span>
</span><span id="line-368"></span><span>  </span><span class="hs-comment">-- Note use of laziness: the immediate children's group index is used to look up all copies of the</span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-comment">-- group in aGroups, including copies that are not immediate children.</span><span>
</span><span id="line-370"></span><span>  </span><span id="local-6989586621679111344"><span class="annot"><a href="#local-6989586621679111948"><span class="hs-identifier hs-type">withParent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupIndex"><span class="hs-identifier hs-type">GroupIndex</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#PM"><span class="hs-identifier hs-type">PM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111344"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#PM"><span class="hs-identifier hs-type">PM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679111344"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-371"></span><span>  </span><span id="local-6989586621679111948"><span class="annot"><span class="annottext">withParent :: forall a. GroupIndex -&gt; PM a -&gt; PM (a, [GroupIndex])
</span><a href="#local-6989586621679111948"><span class="hs-identifier hs-var hs-var">withParent</span></a></span></span><span> </span><span id="local-6989586621679111951"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111951"><span class="hs-identifier hs-var">this</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe GroupIndex -&gt; Maybe GroupIndex)
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     (a, [GroupIndex])
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     (a, [GroupIndex])
forall a.
(Maybe GroupIndex -&gt; Maybe GroupIndex)
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe GroupIndex -&gt; Maybe GroupIndex -&gt; Maybe GroupIndex
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex -&gt; Maybe GroupIndex
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111951"><span class="hs-identifier hs-var">this</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(RWST
   (Maybe GroupIndex)
   [Either GroupIndex GroupInfo]
   ([OP] -&gt; [OP], GroupIndex)
   Identity
   (a, [GroupIndex])
 -&gt; RWST
      (Maybe GroupIndex)
      [Either GroupIndex GroupInfo]
      ([OP] -&gt; [OP], GroupIndex)
      Identity
      (a, [GroupIndex]))
-&gt; (PM a
    -&gt; RWST
         (Maybe GroupIndex)
         [Either GroupIndex GroupInfo]
         ([OP] -&gt; [OP], GroupIndex)
         Identity
         (a, [GroupIndex]))
-&gt; PM a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     (a, [GroupIndex])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([Either GroupIndex GroupInfo] -&gt; [GroupIndex])
-&gt; PM a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     (a, [GroupIndex])
forall w (m :: * -&gt; *) b a.
MonadWriter w m =&gt;
(w -&gt; b) -&gt; m a -&gt; m (a, b)
</span><span class="hs-identifier hs-var">listens</span></span><span> </span><span class="annot"><span class="annottext">[Either GroupIndex GroupInfo] -&gt; [GroupIndex]
forall {a}. [Either a GroupInfo] -&gt; [GroupIndex]
</span><a href="#local-6989586621679111952"><span class="hs-identifier hs-var">childGroupInfo</span></a></span><span>
</span><span id="line-372"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679111952"><span class="annot"><span class="annottext">childGroupInfo :: [Either a GroupInfo] -&gt; [GroupIndex]
</span><a href="#local-6989586621679111952"><span class="hs-identifier hs-var hs-var">childGroupInfo</span></a></span></span><span> </span><span id="local-6989586621679111959"><span class="annot"><span class="annottext">[Either a GroupInfo]
</span><a href="#local-6989586621679111959"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-373"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679111960"><span class="annot"><span class="annottext">gs :: [GroupInfo]
</span><a href="#local-6989586621679111960"><span class="hs-identifier hs-var hs-var">gs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([a], [GroupInfo]) -&gt; [GroupInfo]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(([a], [GroupInfo]) -&gt; [GroupInfo])
-&gt; ([a], [GroupInfo]) -&gt; [GroupInfo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Either a GroupInfo] -&gt; ([a], [GroupInfo])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span> </span><span class="annot"><span class="annottext">[Either a GroupInfo]
</span><a href="#local-6989586621679111959"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-374"></span><span>                </span><span class="annot"><a href="#local-6989586621679111961"><span class="hs-identifier hs-type">children</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupIndex"><span class="hs-identifier hs-type">GroupIndex</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-375"></span><span>                </span><span id="local-6989586621679111961"><span class="annot"><span class="annottext">children :: [GroupIndex]
</span><a href="#local-6989586621679111961"><span class="hs-identifier hs-var hs-var">children</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GroupIndex] -&gt; [GroupIndex]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><a href="Text.Regex.TDFA.Common.html#norep"><span class="hs-identifier hs-var">norep</span></a></span><span> </span><span class="annot"><span class="annottext">([GroupIndex] -&gt; [GroupIndex])
-&gt; ([GroupInfo] -&gt; [GroupIndex]) -&gt; [GroupInfo] -&gt; [GroupIndex]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[GroupIndex] -&gt; [GroupIndex]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sort</span></span><span> </span><span class="annot"><span class="annottext">([GroupIndex] -&gt; [GroupIndex])
-&gt; ([GroupInfo] -&gt; [GroupIndex]) -&gt; [GroupInfo] -&gt; [GroupIndex]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(GroupInfo -&gt; GroupIndex) -&gt; [GroupInfo] -&gt; [GroupIndex]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GroupInfo -&gt; GroupIndex
</span><a href="Text.Regex.TDFA.Common.html#thisIndex"><span class="hs-identifier hs-var">thisIndex</span></a></span><span>
</span><span id="line-376"></span><span>                           </span><span class="hs-comment">-- filter to get only immediate children (efficiency)</span><span>
</span><span id="line-377"></span><span>                           </span><span class="annot"><span class="annottext">([GroupInfo] -&gt; [GroupIndex])
-&gt; ([GroupInfo] -&gt; [GroupInfo]) -&gt; [GroupInfo] -&gt; [GroupIndex]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(GroupInfo -&gt; Bool) -&gt; [GroupInfo] -&gt; [GroupInfo]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111951"><span class="hs-identifier hs-var">this</span></a></span><span class="annot"><span class="annottext">GroupIndex -&gt; GroupIndex -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(GroupIndex -&gt; Bool)
-&gt; (GroupInfo -&gt; GroupIndex) -&gt; GroupInfo -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">GroupInfo -&gt; GroupIndex
</span><a href="Text.Regex.TDFA.Common.html#parentIndex"><span class="hs-identifier hs-var">parentIndex</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([GroupInfo] -&gt; [GroupIndex]) -&gt; [GroupInfo] -&gt; [GroupIndex]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[GroupInfo]
</span><a href="#local-6989586621679111960"><span class="hs-identifier hs-var">gs</span></a></span><span>
</span><span id="line-378"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(GroupIndex -&gt; [GroupIndex]) -&gt; [GroupIndex] -&gt; [GroupIndex]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GroupInfo -&gt; GroupIndex) -&gt; [GroupInfo] -&gt; [GroupIndex]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">GroupInfo -&gt; GroupIndex
</span><a href="Text.Regex.TDFA.Common.html#flagTag"><span class="hs-identifier hs-var">flagTag</span></a></span><span> </span><span class="annot"><span class="annottext">([GroupInfo] -&gt; [GroupIndex])
-&gt; (GroupIndex -&gt; [GroupInfo]) -&gt; GroupIndex -&gt; [GroupIndex]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array GroupIndex [GroupInfo]
</span><a href="#local-6989586621679111909"><span class="hs-identifier hs-var">aGroups</span></a></span><span class="annot"><span class="annottext">Array GroupIndex [GroupInfo] -&gt; GroupIndex -&gt; [GroupInfo]
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679111951"><span class="hs-identifier hs-var">this</span></a></span><span class="annot"><span class="annottext">GroupIndex -&gt; [GroupIndex] -&gt; [GroupIndex]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[GroupIndex]
</span><a href="#local-6989586621679111961"><span class="hs-identifier hs-var">children</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-comment">-- combineConcat is a partial function: Must not pass in an empty list</span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-comment">-- Policy choices:</span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-comment">--  * pass tags to apply to children and have no preTag or postTag here (so none added to nullQ)</span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-comment">--  * middle 'mid' tag: give to left/front child as postTag so a Group there might claim it as a stopTag</span><span>
</span><span id="line-384"></span><span>  </span><span class="hs-comment">--  * if parent is Group then preReset will become non-empty</span><span>
</span><span id="line-385"></span><span>  </span><span class="annot"><a href="#local-6989586621679111966"><span class="hs-identifier hs-type">combineConcat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HHQ"><span class="hs-identifier hs-type">HHQ</span></a></span><span>
</span><span id="line-386"></span><span>  </span><span id="local-6989586621679111966"><span class="annot"><span class="annottext">combineConcat :: [Pattern] -&gt; HHQ
</span><a href="#local-6989586621679111966"><span class="hs-identifier hs-var hs-var">combineConcat</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CompOption -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#rightAssoc"><span class="hs-identifier hs-var">rightAssoc</span></a></span><span> </span><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621679111904"><span class="hs-identifier hs-var">compOpt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HHQ -&gt; HHQ -&gt; HHQ) -&gt; [HHQ] -&gt; HHQ
forall a. (a -&gt; a -&gt; a) -&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">foldr1</span></span><span> </span><span class="annot"><span class="annottext">HHQ -&gt; HHQ -&gt; HHQ
</span><a href="#local-6989586621679111969"><span class="hs-identifier hs-var">combineSeq</span></a></span><span> </span><span class="annot"><span class="annottext">([HHQ] -&gt; HHQ) -&gt; ([Pattern] -&gt; [HHQ]) -&gt; [Pattern] -&gt; HHQ
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Pattern -&gt; HHQ) -&gt; [Pattern] -&gt; [HHQ]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; HHQ
</span><a href="#local-6989586621679111921"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-387"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HHQ -&gt; HHQ -&gt; HHQ) -&gt; [HHQ] -&gt; HHQ
forall a. (a -&gt; a -&gt; a) -&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">foldl1</span></span><span> </span><span class="annot"><span class="annottext">HHQ -&gt; HHQ -&gt; HHQ
</span><a href="#local-6989586621679111969"><span class="hs-identifier hs-var">combineSeq</span></a></span><span> </span><span class="annot"><span class="annottext">([HHQ] -&gt; HHQ) -&gt; ([Pattern] -&gt; [HHQ]) -&gt; [Pattern] -&gt; HHQ
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Pattern -&gt; HHQ) -&gt; [Pattern] -&gt; [HHQ]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; HHQ
</span><a href="#local-6989586621679111921"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-comment">-- libtre default</span><span>
</span><span id="line-388"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679111970"><span class="hs-pragma hs-type">front'end</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-389"></span><span>          </span><span id="local-6989586621679111970"><span class="annot"><span class="annottext">front'end :: RWST
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Identity
  a1
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a2
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     (a1, a2)
</span><a href="#local-6989586621679111970"><span class="hs-identifier hs-var hs-var">front'end</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CompOption -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#rightAssoc"><span class="hs-identifier hs-var">rightAssoc</span></a></span><span> </span><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621679111904"><span class="hs-identifier hs-var">compOpt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a1 -&gt; a2 -&gt; (a1, a2))
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a1
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a2
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     (a1, a2)
forall (m :: * -&gt; *) a1 a2 r.
Monad m =&gt;
(a1 -&gt; a2 -&gt; r) -&gt; m a1 -&gt; m a2 -&gt; m r
</span><span class="hs-identifier hs-var">liftM2</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RWST
   (Maybe GroupIndex)
   [Either GroupIndex GroupInfo]
   ([OP] -&gt; [OP], GroupIndex)
   Identity
   a2
 -&gt; RWST
      (Maybe GroupIndex)
      [Either GroupIndex GroupInfo]
      ([OP] -&gt; [OP], GroupIndex)
      Identity
      a1
 -&gt; RWST
      (Maybe GroupIndex)
      [Either GroupIndex GroupInfo]
      ([OP] -&gt; [OP], GroupIndex)
      Identity
      (a1, a2))
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a1
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a2
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     (a1, a2)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a2 -&gt; a1 -&gt; (a1, a2))
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a2
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a1
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     (a1, a2)
forall (m :: * -&gt; *) a1 a2 r.
Monad m =&gt;
(a1 -&gt; a2 -&gt; r) -&gt; m a1 -&gt; m a2 -&gt; m r
</span><span class="hs-identifier hs-var">liftM2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a1 -&gt; a2 -&gt; (a1, a2)) -&gt; a2 -&gt; a1 -&gt; (a1, a2)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>          </span><span class="annot"><a href="#local-6989586621679111969"><span class="hs-identifier hs-type">combineSeq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HHQ"><span class="hs-identifier hs-type">HHQ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HHQ"><span class="hs-identifier hs-type">HHQ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HHQ"><span class="hs-identifier hs-type">HHQ</span></a></span><span>
</span><span id="line-392"></span><span>          </span><span id="local-6989586621679111969"><span class="annot"><span class="annottext">combineSeq :: HHQ -&gt; HHQ -&gt; HHQ
</span><a href="#local-6989586621679111969"><span class="hs-identifier hs-var hs-var">combineSeq</span></a></span></span><span> </span><span id="local-6989586621679111976"><span class="annot"><span class="annottext">HHQ
</span><a href="#local-6989586621679111976"><span class="hs-identifier hs-var">pFront</span></a></span></span><span> </span><span id="local-6989586621679111977"><span class="annot"><span class="annottext">HHQ
</span><a href="#local-6989586621679111977"><span class="hs-identifier hs-var">pEnd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679111978"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111978"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679111979"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111979"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">mdo</span><span>
</span><span id="line-393"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679111980"><span class="annot"><span class="annottext">bothVary :: Bool
</span><a href="#local-6989586621679111980"><span class="hs-identifier hs-var hs-var">bothVary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#varies"><span class="hs-identifier hs-var">varies</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111981"><span class="hs-identifier hs-var">qFront</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#varies"><span class="hs-identifier hs-var">varies</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111983"><span class="hs-identifier hs-var">qEnd</span></a></span><span>
</span><span id="line-394"></span><span>            </span><span id="local-6989586621679111984"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111984"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#noTag"><span class="hs-identifier hs-var">noTag</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111978"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679111980"><span class="hs-identifier hs-var">bothVary</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; PM HandleTag
</span><a href="#local-6989586621679111924"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;combineSeq start&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; PM HandleTag
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111978"><span class="hs-identifier hs-var">m1</span></a></span><span>
</span><span id="line-395"></span><span>            </span><span id="local-6989586621679111985"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111985"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#noTag"><span class="hs-identifier hs-var">noTag</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111979"><span class="hs-identifier hs-var">m2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679111980"><span class="hs-identifier hs-var">bothVary</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; PM HandleTag
</span><a href="#local-6989586621679111924"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;combineSeq stop&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; PM HandleTag
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111979"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-396"></span><span>            </span><span id="local-6989586621679111986"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111986"><span class="hs-identifier hs-var">mid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HandleTag -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#noTag"><span class="hs-identifier hs-var">noTag</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111984"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#canAccept"><span class="hs-identifier hs-var">canAccept</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111981"><span class="hs-identifier hs-var">qFront</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">HandleTag -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#noTag"><span class="hs-identifier hs-var">noTag</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111985"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#canAccept"><span class="hs-identifier hs-var">canAccept</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111983"><span class="hs-identifier hs-var">qEnd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-397"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; PM HandleTag
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HandleTag -&gt; HandleTag
</span><a href="Text.Regex.TDFA.CorePattern.html#toAdvice"><span class="hs-identifier hs-var">toAdvice</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111984"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; PM HandleTag
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HandleTag -&gt; HandleTag
</span><a href="Text.Regex.TDFA.CorePattern.html#toAdvice"><span class="hs-identifier hs-var">toAdvice</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111985"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>                     </span><span class="annot"><span class="annottext">(Bool, Bool, Bool, Bool)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#tagged"><span class="hs-identifier hs-var">tagged</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111981"><span class="hs-identifier hs-var">qFront</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#tagged"><span class="hs-identifier hs-var">tagged</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111983"><span class="hs-identifier hs-var">qEnd</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; PM HandleTag
</span><a href="#local-6989586621679111924"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;combineSeq mid&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; PM HandleTag
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="Text.Regex.TDFA.CorePattern.html#NoTag"><span class="hs-identifier hs-var">NoTag</span></a></span><span>
</span><span id="line-400"></span><span>      </span><span class="hs-comment">--      qFront &lt;- pFront a mid</span><span>
</span><span id="line-401"></span><span>      </span><span class="hs-comment">--      qEnd &lt;- pEnd (toAdvice mid) b</span><span>
</span><span id="line-402"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679111981"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111981"><span class="hs-identifier hs-var">qFront</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679111983"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111983"><span class="hs-identifier hs-var">qEnd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RWS
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Q
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     (Q, Q)
forall {a1} {a2}.
RWST
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Identity
  a1
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a2
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     (a1, a2)
</span><a href="#local-6989586621679111970"><span class="hs-identifier hs-var">front'end</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HHQ
</span><a href="#local-6989586621679111976"><span class="hs-identifier hs-var">pFront</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111984"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111986"><span class="hs-identifier hs-var">mid</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HHQ
</span><a href="#local-6989586621679111977"><span class="hs-identifier hs-var">pEnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HandleTag -&gt; HandleTag
</span><a href="Text.Regex.TDFA.CorePattern.html#toAdvice"><span class="hs-identifier hs-var">toAdvice</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111986"><span class="hs-identifier hs-var">mid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111985"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>            </span><span class="hs-comment">-- XXX: Perhaps a &quot;produces&quot; should be created to compliment &quot;wants&quot;,</span><span>
</span><span id="line-404"></span><span>            </span><span class="hs-comment">-- then &quot;produces qEnd&quot; could be compared to &quot;wants qFront&quot;</span><span>
</span><span id="line-405"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679111989"><span class="annot"><span class="annottext">wanted :: Wanted
</span><a href="#local-6989586621679111989"><span class="hs-identifier hs-var hs-var">wanted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#WantsEither"><span class="hs-identifier hs-var">WantsEither</span></a></span><span> </span><span class="annot"><span class="annottext">Wanted -&gt; Wanted -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#wants"><span class="hs-identifier hs-var">wants</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111983"><span class="hs-identifier hs-var">qEnd</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#wants"><span class="hs-identifier hs-var">wants</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111981"><span class="hs-identifier hs-var">qFront</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#wants"><span class="hs-identifier hs-var">wants</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111983"><span class="hs-identifier hs-var">qEnd</span></a></span><span>
</span><span id="line-406"></span><span>            </span><span class="annot"><span class="annottext">Q
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Q
 -&gt; RWS
      (Maybe GroupIndex)
      [Either GroupIndex GroupInfo]
      ([OP] -&gt; [OP], GroupIndex)
      Q)
-&gt; Q
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nullQ :: NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NullView -&gt; NullView -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#mergeNullViews"><span class="hs-identifier hs-var">mergeNullViews</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111981"><span class="hs-identifier hs-var">qFront</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111983"><span class="hs-identifier hs-var">qEnd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">takes :: (GroupIndex, Maybe GroupIndex)
</span><a href="Text.Regex.TDFA.CorePattern.html#takes"><span class="hs-identifier hs-var">takes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GroupIndex, Maybe GroupIndex)
-&gt; (GroupIndex, Maybe GroupIndex) -&gt; (GroupIndex, Maybe GroupIndex)
</span><a href="Text.Regex.TDFA.CorePattern.html#seqTake"><span class="hs-identifier hs-var">seqTake</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; (GroupIndex, Maybe GroupIndex)
</span><a href="Text.Regex.TDFA.CorePattern.html#takes"><span class="hs-identifier hs-var">takes</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111981"><span class="hs-identifier hs-var">qFront</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q -&gt; (GroupIndex, Maybe GroupIndex)
</span><a href="Text.Regex.TDFA.CorePattern.html#takes"><span class="hs-identifier hs-var">takes</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111983"><span class="hs-identifier hs-var">qEnd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">preReset :: [GroupIndex]
</span><a href="Text.Regex.TDFA.CorePattern.html#preReset"><span class="hs-identifier hs-var">preReset</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">postSet :: [GroupIndex]
</span><a href="Text.Regex.TDFA.CorePattern.html#postSet"><span class="hs-identifier hs-var">postSet</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">preTag :: Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#preTag"><span class="hs-identifier hs-var">preTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe GroupIndex
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">postTag :: Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#postTag"><span class="hs-identifier hs-var">postTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe GroupIndex
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-409"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tagged :: Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#tagged"><span class="hs-identifier hs-var">tagged</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679111980"><span class="hs-identifier hs-var">bothVary</span></a></span><span>
</span><span id="line-410"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">childGroups :: Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#childGroups"><span class="hs-identifier hs-var">childGroups</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#childGroups"><span class="hs-identifier hs-var">childGroups</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111981"><span class="hs-identifier hs-var">qFront</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#childGroups"><span class="hs-identifier hs-var">childGroups</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111983"><span class="hs-identifier hs-var">qEnd</span></a></span><span>
</span><span id="line-411"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wants :: Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#wants"><span class="hs-identifier hs-var">wants</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Wanted
</span><a href="#local-6989586621679111989"><span class="hs-identifier hs-var">wanted</span></a></span><span>
</span><span id="line-412"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unQ :: P
</span><a href="Text.Regex.TDFA.CorePattern.html#unQ"><span class="hs-identifier hs-var">unQ</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Q -&gt; P
</span><a href="Text.Regex.TDFA.CorePattern.html#Seq"><span class="hs-identifier hs-var">Seq</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111981"><span class="hs-identifier hs-var">qFront</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679111983"><span class="hs-identifier hs-var">qEnd</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-413"></span><span>                                   </span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>  </span><span class="annot"><a href="#local-6989586621679111921"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#HHQ"><span class="hs-identifier hs-type">HHQ</span></a></span><span>
</span><span id="line-415"></span><span>  </span><span id="local-6989586621679111921"><span class="annot"><span class="annottext">go :: Pattern -&gt; HHQ
</span><a href="#local-6989586621679111921"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679111990"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679111990"><span class="hs-identifier hs-var">pIn</span></a></span></span><span> </span><span id="local-6989586621679111991"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111991"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679111992"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111992"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-416"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679111996"><span class="annot"><span class="annottext">die :: a
</span><a href="#local-6989586621679111996"><span class="hs-identifier hs-var hs-var">die</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; a) -&gt; String -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;patternToQ cannot handle &quot;</span></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">Pattern -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679111990"><span class="hs-identifier hs-var">pIn</span></a></span><span>
</span><span id="line-417"></span><span>        </span><span id="local-6989586621679112001"><span class="annot"><span class="annottext">nil :: RWS
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Q
</span><a href="#local-6989586621679112001"><span class="hs-identifier hs-var hs-var">nil</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Q
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Q
 -&gt; RWS
      (Maybe GroupIndex)
      [Either GroupIndex GroupInfo]
      ([OP] -&gt; [OP], GroupIndex)
      Q)
-&gt; Q
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">nullQ :: NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">HandleTag -&gt; HandleTag -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#makeEmptyNullView"><span class="hs-identifier hs-var">makeEmptyNullView</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111991"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111992"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-418"></span><span>                         </span><span class="hs-special">,</span><span class="annot"><span class="annottext">takes :: (GroupIndex, Maybe GroupIndex)
</span><a href="Text.Regex.TDFA.CorePattern.html#takes"><span class="hs-identifier hs-var">takes</span></a></span><span class="hs-glyph">=</span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">GroupIndex -&gt; Maybe GroupIndex
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>                         </span><span class="hs-special">,</span><span class="annot"><span class="annottext">preReset :: [GroupIndex]
</span><a href="Text.Regex.TDFA.CorePattern.html#preReset"><span class="hs-identifier hs-var">preReset</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">postSet :: [GroupIndex]
</span><a href="Text.Regex.TDFA.CorePattern.html#postSet"><span class="hs-identifier hs-var">postSet</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">preTag :: Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#preTag"><span class="hs-identifier hs-var">preTag</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">HandleTag -&gt; Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#apply"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111991"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">postTag :: Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#postTag"><span class="hs-identifier hs-var">postTag</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">HandleTag -&gt; Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#apply"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111992"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-420"></span><span>                         </span><span class="hs-special">,</span><span class="annot"><span class="annottext">tagged :: Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#tagged"><span class="hs-identifier hs-var">tagged</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">childGroups :: Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#childGroups"><span class="hs-identifier hs-var">childGroups</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">wants :: Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#wants"><span class="hs-identifier hs-var">wants</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#WantsEither"><span class="hs-identifier hs-var">WantsEither</span></a></span><span>
</span><span id="line-421"></span><span>                         </span><span class="hs-special">,</span><span class="annot"><span class="annottext">unQ :: P
</span><a href="Text.Regex.TDFA.CorePattern.html#unQ"><span class="hs-identifier hs-var">unQ</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">P
</span><a href="Text.Regex.TDFA.CorePattern.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-422"></span><span>        </span><span id="local-6989586621679112006"><span class="annot"><span class="annottext">one :: RWS
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Q
</span><a href="#local-6989586621679112006"><span class="hs-identifier hs-var hs-var">one</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Q
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Q
 -&gt; RWS
      (Maybe GroupIndex)
      [Either GroupIndex GroupInfo]
      ([OP] -&gt; [OP], GroupIndex)
      Q)
-&gt; Q
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">nullQ :: NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#notNull"><span class="hs-identifier hs-var">notNull</span></a></span><span>
</span><span id="line-423"></span><span>                         </span><span class="hs-special">,</span><span class="annot"><span class="annottext">takes :: (GroupIndex, Maybe GroupIndex)
</span><a href="Text.Regex.TDFA.CorePattern.html#takes"><span class="hs-identifier hs-var">takes</span></a></span><span class="hs-glyph">=</span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">GroupIndex -&gt; Maybe GroupIndex
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span>                         </span><span class="hs-special">,</span><span class="annot"><span class="annottext">preReset :: [GroupIndex]
</span><a href="Text.Regex.TDFA.CorePattern.html#preReset"><span class="hs-identifier hs-var">preReset</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">postSet :: [GroupIndex]
</span><a href="Text.Regex.TDFA.CorePattern.html#postSet"><span class="hs-identifier hs-var">postSet</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">preTag :: Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#preTag"><span class="hs-identifier hs-var">preTag</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">HandleTag -&gt; Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#apply"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111991"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">postTag :: Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#postTag"><span class="hs-identifier hs-var">postTag</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">HandleTag -&gt; Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#apply"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111992"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-425"></span><span>                         </span><span class="hs-special">,</span><span class="annot"><span class="annottext">tagged :: Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#tagged"><span class="hs-identifier hs-var">tagged</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">childGroups :: Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#childGroups"><span class="hs-identifier hs-var">childGroups</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">wants :: Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#wants"><span class="hs-identifier hs-var">wants</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#WantsQNFA"><span class="hs-identifier hs-var">WantsQNFA</span></a></span><span>
</span><span id="line-426"></span><span>                         </span><span class="hs-special">,</span><span class="annot"><span class="annottext">unQ :: P
</span><a href="Text.Regex.TDFA.CorePattern.html#unQ"><span class="hs-identifier hs-var">unQ</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; P
</span><a href="Text.Regex.TDFA.CorePattern.html#OneChar"><span class="hs-identifier hs-var">OneChar</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679111990"><span class="hs-identifier hs-var">pIn</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-427"></span><span>        </span><span id="local-6989586621679112016"><span class="annot"><span class="annottext">test :: TestInfo -&gt; m Q
</span><a href="#local-6989586621679112016"><span class="hs-identifier hs-var hs-var">test</span></a></span></span><span> </span><span id="local-6989586621679112017"><span class="annot"><span class="annottext">TestInfo
</span><a href="#local-6989586621679112017"><span class="hs-identifier hs-var">myTest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Q -&gt; m Q
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Q -&gt; m Q) -&gt; Q -&gt; m Q
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">nullQ :: NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">TestInfo -&gt; HandleTag -&gt; HandleTag -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#makeTestNullView"><span class="hs-identifier hs-var">makeTestNullView</span></a></span><span> </span><span class="annot"><span class="annottext">TestInfo
</span><a href="#local-6989586621679112017"><span class="hs-identifier hs-var">myTest</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111991"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111992"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-428"></span><span>                                 </span><span class="hs-special">,</span><span class="annot"><span class="annottext">takes :: (GroupIndex, Maybe GroupIndex)
</span><a href="Text.Regex.TDFA.CorePattern.html#takes"><span class="hs-identifier hs-var">takes</span></a></span><span class="hs-glyph">=</span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">GroupIndex -&gt; Maybe GroupIndex
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>                                 </span><span class="hs-special">,</span><span class="annot"><span class="annottext">preReset :: [GroupIndex]
</span><a href="Text.Regex.TDFA.CorePattern.html#preReset"><span class="hs-identifier hs-var">preReset</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">postSet :: [GroupIndex]
</span><a href="Text.Regex.TDFA.CorePattern.html#postSet"><span class="hs-identifier hs-var">postSet</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">preTag :: Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#preTag"><span class="hs-identifier hs-var">preTag</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">HandleTag -&gt; Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#apply"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111991"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">postTag :: Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#postTag"><span class="hs-identifier hs-var">postTag</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">HandleTag -&gt; Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#apply"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111992"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-430"></span><span>                                 </span><span class="hs-special">,</span><span class="annot"><span class="annottext">tagged :: Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#tagged"><span class="hs-identifier hs-var">tagged</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">childGroups :: Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#childGroups"><span class="hs-identifier hs-var">childGroups</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">wants :: Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#wants"><span class="hs-identifier hs-var">wants</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#WantsQT"><span class="hs-identifier hs-var">WantsQT</span></a></span><span>
</span><span id="line-431"></span><span>                                 </span><span class="hs-special">,</span><span class="annot"><span class="annottext">unQ :: P
</span><a href="Text.Regex.TDFA.CorePattern.html#unQ"><span class="hs-identifier hs-var">unQ</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">TestInfo -&gt; P
</span><a href="Text.Regex.TDFA.CorePattern.html#Test"><span class="hs-identifier hs-var">Test</span></a></span><span> </span><span class="annot"><span class="annottext">TestInfo
</span><a href="#local-6989586621679112017"><span class="hs-identifier hs-var">myTest</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-432"></span><span>        </span><span id="local-6989586621679112018"><span class="annot"><span class="annottext">xtra :: Bool
</span><a href="#local-6989586621679112018"><span class="hs-identifier hs-var hs-var">xtra</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompOption -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#newSyntax"><span class="hs-identifier hs-var">newSyntax</span></a></span><span> </span><span class="annot"><span class="annottext">CompOption
</span><a href="#local-6989586621679111904"><span class="hs-identifier hs-var">compOpt</span></a></span><span>
</span><span id="line-433"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679111990"><span class="hs-identifier hs-var">pIn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-434"></span><span>         </span><span class="annot"><span class="annottext">Pattern
</span><a href="Text.Regex.TDFA.Pattern.html#PEmpty"><span class="hs-identifier hs-var">PEmpty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RWS
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Q
</span><a href="#local-6989586621679112001"><span class="hs-identifier hs-var">nil</span></a></span><span>
</span><span id="line-435"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#POr"><span class="hs-identifier hs-type">POr</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RWS
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Q
</span><a href="#local-6989586621679112001"><span class="hs-identifier hs-var">nil</span></a></span><span>
</span><span id="line-436"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#POr"><span class="hs-identifier hs-type">POr</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679112022"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679112022"><span class="hs-identifier hs-var">branch</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; HHQ
</span><a href="#local-6989586621679111921"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679112022"><span class="hs-identifier hs-var">branch</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111991"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111992"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-437"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#POr"><span class="hs-identifier hs-type">POr</span></a></span><span> </span><span id="local-6989586621679112023"><span class="annot"><span class="annottext">[Pattern]
</span><a href="#local-6989586621679112023"><span class="hs-identifier hs-var">branches</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">mdo</span><span>
</span><span id="line-438"></span><span>           </span><span class="hs-comment">-- 2009 : The PNonEmpty p as POr [PEmpty,p] takes no branch tracking tag.</span><span>
</span><span id="line-439"></span><span>           </span><span class="hs-comment">--        I claim this is because only accepting branches need tags,</span><span>
</span><span id="line-440"></span><span>           </span><span class="hs-comment">--        and the last accepting branch does not need a tag.</span><span>
</span><span id="line-441"></span><span>           </span><span class="hs-comment">--        Non-accepting possibilities can all commute to the front and</span><span>
</span><span id="line-442"></span><span>           </span><span class="hs-comment">--        become part of the nullQ.  The accepting bits then need prioritizing.</span><span>
</span><span id="line-443"></span><span>           </span><span class="hs-comment">--    Does the above require changes in POr handling in TNFA?  Yes.</span><span>
</span><span id="line-444"></span><span>           </span><span class="hs-comment">--    Have to always use nullQ instead of &quot;recapitulating&quot; it.</span><span>
</span><span id="line-445"></span><span>           </span><span class="hs-comment">--    Could also create a constant-writing tag instead of many index tags.</span><span>
</span><span id="line-446"></span><span>           </span><span class="hs-comment">-- Exasperation: This POr recursive mdo is very easy to make loop and lockup the program</span><span>
</span><span id="line-447"></span><span>           </span><span class="hs-comment">-- if needTags is False then there is no way to disambiguate branches so fewer tags are needed</span><span>
</span><span id="line-448"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679112024"><span class="annot"><span class="annottext">needUniqTags :: Bool
</span><a href="#local-6989586621679112024"><span class="hs-identifier hs-var hs-var">needUniqTags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#childGroups"><span class="hs-identifier hs-var">childGroups</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679112025"><span class="hs-identifier hs-var">ans</span></a></span><span>
</span><span id="line-449"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679112026"><span class="annot"><span class="annottext">needTags :: Bool
</span><a href="#local-6989586621679112026"><span class="hs-identifier hs-var hs-var">needTags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#varies"><span class="hs-identifier hs-var">varies</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679112025"><span class="hs-identifier hs-var">ans</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#childGroups"><span class="hs-identifier hs-var">childGroups</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679112025"><span class="hs-identifier hs-var">ans</span></a></span><span> </span><span class="hs-comment">-- childGroups detects that &quot;abc|a(b)c&quot; needs tags</span><span>
</span><span id="line-450"></span><span>           </span><span id="local-6989586621679112027"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112027"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#noTag"><span class="hs-identifier hs-var">noTag</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111991"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112026"><span class="hs-identifier hs-var">needTags</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; PM HandleTag
</span><a href="#local-6989586621679111924"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;POr start&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; PM HandleTag
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111991"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="hs-comment">-- whole POr</span><span>
</span><span id="line-451"></span><span>           </span><span id="local-6989586621679112028"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112028"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#noTag"><span class="hs-identifier hs-var">noTag</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111992"><span class="hs-identifier hs-var">m2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112026"><span class="hs-identifier hs-var">needTags</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; PM HandleTag
</span><a href="#local-6989586621679111924"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;POr stop&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; PM HandleTag
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111992"><span class="hs-identifier hs-var">m2</span></a></span><span> </span><span class="hs-comment">-- whole POr</span><span>
</span><span id="line-452"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679112029"><span class="annot"><span class="annottext">aAdvice :: HandleTag
</span><a href="#local-6989586621679112029"><span class="hs-identifier hs-var hs-var">aAdvice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; HandleTag
</span><a href="Text.Regex.TDFA.CorePattern.html#toAdvice"><span class="hs-identifier hs-var">toAdvice</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112027"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-comment">-- all branches share 'aAdvice'</span><span>
</span><span id="line-453"></span><span>               </span><span id="local-6989586621679112030"><span class="annot"><span class="annottext">bAdvice :: HandleTag
</span><a href="#local-6989586621679112030"><span class="hs-identifier hs-var hs-var">bAdvice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; HandleTag
</span><a href="Text.Regex.TDFA.CorePattern.html#toAdvice"><span class="hs-identifier hs-var">toAdvice</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112028"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-comment">-- last branch gets 'bAdvice', others may get own tag</span><span>
</span><span id="line-454"></span><span>               </span><span class="hs-comment">-- Due to the recursive-do, it seems that I have to put the if needTags into the op'</span><span>
</span><span id="line-455"></span><span>               </span><span id="local-6989586621679112034"><span class="annot"><span class="annottext">newUniq :: PM HandleTag
</span><a href="#local-6989586621679112034"><span class="hs-identifier hs-var hs-var">newUniq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112024"><span class="hs-identifier hs-var">needUniqTags</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; PM HandleTag
</span><a href="#local-6989586621679111924"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;POr branch&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; PM HandleTag
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112030"><span class="hs-identifier hs-var">bAdvice</span></a></span><span>
</span><span id="line-456"></span><span class="hs-comment">--           trace (&quot;\nPOr sub &quot;++show aAdvice++&quot; &quot;++show bAdvice++&quot;needsTags is &quot;++show needTags) $ return ()</span><span>
</span><span id="line-457"></span><span>           </span><span class="hs-comment">-- The &quot;bs&quot; values are allocated in left-to-right order before the children in &quot;qs&quot;</span><span>
</span><span id="line-458"></span><span>           </span><span class="hs-comment">-- optimization: low priority for last branch is implicit, do not create separate tag here.</span><span>
</span><span id="line-459"></span><span>           </span><span id="local-6989586621679112035"><span class="annot"><span class="annottext">[HandleTag]
</span><a href="#local-6989586621679112035"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([HandleTag] -&gt; [HandleTag])
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     [HandleTag]
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     [HandleTag]
forall a b.
(a -&gt; b)
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HandleTag] -&gt; [HandleTag] -&gt; [HandleTag]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">[</span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112030"><span class="hs-identifier hs-var">bAdvice</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(RWST
   (Maybe GroupIndex)
   [Either GroupIndex GroupInfo]
   ([OP] -&gt; [OP], GroupIndex)
   Identity
   [HandleTag]
 -&gt; RWST
      (Maybe GroupIndex)
      [Either GroupIndex GroupInfo]
      ([OP] -&gt; [OP], GroupIndex)
      Identity
      [HandleTag])
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     [HandleTag]
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     [HandleTag]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex
-&gt; PM HandleTag
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     [HandleTag]
forall (m :: * -&gt; *) a. Applicative m =&gt; GroupIndex -&gt; m a -&gt; m [a]
</span><span class="hs-identifier hs-var">replicateM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex -&gt; GroupIndex
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">pred</span></span><span> </span><span class="annot"><span class="annottext">(GroupIndex -&gt; GroupIndex) -&gt; GroupIndex -&gt; GroupIndex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pattern] -&gt; GroupIndex
forall a. [a] -&gt; GroupIndex
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; GroupIndex
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Pattern]
</span><a href="#local-6989586621679112023"><span class="hs-identifier hs-var">branches</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PM HandleTag
</span><a href="#local-6989586621679112034"><span class="hs-identifier hs-var">newUniq</span></a></span><span> </span><span class="hs-comment">-- 2 &lt;= length ps</span><span>
</span><span id="line-460"></span><span>           </span><span class="hs-comment">-- create all the child branches in left-to-right order after the &quot;bs&quot;</span><span>
</span><span id="line-461"></span><span>           </span><span id="local-6989586621679112037"><span class="annot"><span class="annottext">[Q]
</span><a href="#local-6989586621679112037"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Pattern, HandleTag)]
-&gt; ((Pattern, HandleTag)
    -&gt; RWS
         (Maybe GroupIndex)
         [Either GroupIndex GroupInfo]
         ([OP] -&gt; [OP], GroupIndex)
         Q)
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     [Q]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Pattern] -&gt; [HandleTag] -&gt; [(Pattern, HandleTag)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Pattern]
</span><a href="#local-6989586621679112023"><span class="hs-identifier hs-var">branches</span></a></span><span> </span><span class="annot"><span class="annottext">[HandleTag]
</span><a href="#local-6989586621679112035"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679112038"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679112038"><span class="hs-identifier hs-var">branch</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679112039"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112039"><span class="hs-identifier hs-var">bTag</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern -&gt; HHQ
</span><a href="#local-6989586621679111921"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679112038"><span class="hs-identifier hs-var">branch</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112029"><span class="hs-identifier hs-var">aAdvice</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112039"><span class="hs-identifier hs-var">bTag</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679112040"><span class="annot"><span class="annottext">wqs :: [Wanted]
</span><a href="#local-6989586621679112040"><span class="hs-identifier hs-var hs-var">wqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Q -&gt; Wanted) -&gt; [Q] -&gt; [Wanted]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#wants"><span class="hs-identifier hs-var">wants</span></a></span><span> </span><span class="annot"><span class="annottext">[Q]
</span><a href="#local-6989586621679112037"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-463"></span><span>               </span><span id="local-6989586621679112047"><span class="annot"><span class="annottext">wanted :: Wanted
</span><a href="#local-6989586621679112047"><span class="hs-identifier hs-var hs-var">wanted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(Wanted -&gt; Bool) -&gt; [Wanted] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#WantsBoth"><span class="hs-identifier hs-var">WantsBoth</span></a></span><span class="annot"><span class="annottext">Wanted -&gt; Wanted -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Wanted]
</span><a href="#local-6989586621679112040"><span class="hs-identifier hs-var">wqs</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#WantsBoth"><span class="hs-identifier hs-var">WantsBoth</span></a></span><span>
</span><span id="line-464"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Wanted -&gt; Bool) -&gt; [Wanted] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#WantsQNFA"><span class="hs-identifier hs-var">WantsQNFA</span></a></span><span class="annot"><span class="annottext">Wanted -&gt; Wanted -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Wanted]
</span><a href="#local-6989586621679112040"><span class="hs-identifier hs-var">wqs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">(Wanted -&gt; Bool) -&gt; [Wanted] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#WantsQT"><span class="hs-identifier hs-var">WantsQT</span></a></span><span class="annot"><span class="annottext">Wanted -&gt; Wanted -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Wanted]
</span><a href="#local-6989586621679112040"><span class="hs-identifier hs-var">wqs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-465"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#WantsBoth"><span class="hs-identifier hs-var">WantsBoth</span></a></span><span>
</span><span id="line-466"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#WantsQNFA"><span class="hs-identifier hs-var">WantsQNFA</span></a></span><span>
</span><span id="line-467"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#WantsQT"><span class="hs-identifier hs-var">WantsQT</span></a></span><span>
</span><span id="line-468"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#WantsEither"><span class="hs-identifier hs-var">WantsEither</span></a></span><span>
</span><span id="line-469"></span><span>               </span><span id="local-6989586621679112050"><span class="annot"><span class="annottext">nullView :: NullView
</span><a href="#local-6989586621679112050"><span class="hs-identifier hs-var hs-var">nullView</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NullView -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#cleanNullView"><span class="hs-identifier hs-var">cleanNullView</span></a></span><span> </span><span class="annot"><span class="annottext">(NullView -&gt; NullView) -&gt; ([Q] -&gt; NullView) -&gt; [Q] -&gt; NullView
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; HandleTag -&gt; NullView -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#tagWrapNullView"><span class="hs-identifier hs-var">tagWrapNullView</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112027"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112028"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">(NullView -&gt; NullView) -&gt; ([Q] -&gt; NullView) -&gt; [Q] -&gt; NullView
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Q -&gt; NullView) -&gt; [Q] -&gt; NullView
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span> </span><span class="annot"><span class="annottext">([Q] -&gt; NullView) -&gt; [Q] -&gt; NullView
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Q]
</span><a href="#local-6989586621679112037"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-470"></span><span>               </span><span class="hs-comment">-- The nullView computed above takes the nullQ of the branches and combines them.  This</span><span>
</span><span id="line-471"></span><span>               </span><span class="hs-comment">-- assumes that the pre/post tags of the children are also part of the nullQ values.  So</span><span>
</span><span id="line-472"></span><span>               </span><span class="hs-comment">-- for consistency, POr must then add its own pre/post tags to its nullQ value.  Note that</span><span>
</span><span id="line-473"></span><span>               </span><span class="hs-comment">-- concatMap sets the left-to-right preference when choosing the null views.</span><span>
</span><span id="line-474"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679112025"><span class="annot"><span class="annottext">ans :: Q
</span><a href="#local-6989586621679112025"><span class="hs-identifier hs-var hs-var">ans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nullQ :: NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NullView
</span><a href="#local-6989586621679112050"><span class="hs-identifier hs-var">nullView</span></a></span><span>
</span><span id="line-475"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">takes :: (GroupIndex, Maybe GroupIndex)
</span><a href="Text.Regex.TDFA.CorePattern.html#takes"><span class="hs-identifier hs-var">takes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(GroupIndex, Maybe GroupIndex)] -&gt; (GroupIndex, Maybe GroupIndex)
</span><a href="Text.Regex.TDFA.CorePattern.html#orTakes"><span class="hs-identifier hs-var">orTakes</span></a></span><span> </span><span class="annot"><span class="annottext">([(GroupIndex, Maybe GroupIndex)]
 -&gt; (GroupIndex, Maybe GroupIndex))
-&gt; ([Q] -&gt; [(GroupIndex, Maybe GroupIndex)])
-&gt; [Q]
-&gt; (GroupIndex, Maybe GroupIndex)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Q -&gt; (GroupIndex, Maybe GroupIndex))
-&gt; [Q] -&gt; [(GroupIndex, Maybe GroupIndex)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; (GroupIndex, Maybe GroupIndex)
</span><a href="Text.Regex.TDFA.CorePattern.html#takes"><span class="hs-identifier hs-var">takes</span></a></span><span> </span><span class="annot"><span class="annottext">([Q] -&gt; (GroupIndex, Maybe GroupIndex))
-&gt; [Q] -&gt; (GroupIndex, Maybe GroupIndex)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Q]
</span><a href="#local-6989586621679112037"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-476"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">preReset :: [GroupIndex]
</span><a href="Text.Regex.TDFA.CorePattern.html#preReset"><span class="hs-identifier hs-var">preReset</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">postSet :: [GroupIndex]
</span><a href="Text.Regex.TDFA.CorePattern.html#postSet"><span class="hs-identifier hs-var">postSet</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-477"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">preTag :: Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#preTag"><span class="hs-identifier hs-var">preTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#apply"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112027"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">postTag :: Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#postTag"><span class="hs-identifier hs-var">postTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#apply"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112028"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-478"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tagged :: Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#tagged"><span class="hs-identifier hs-var">tagged</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112026"><span class="hs-identifier hs-var">needTags</span></a></span><span>
</span><span id="line-479"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">childGroups :: Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#childGroups"><span class="hs-identifier hs-var">childGroups</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Q -&gt; Bool) -&gt; [Q] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#childGroups"><span class="hs-identifier hs-var">childGroups</span></a></span><span> </span><span class="annot"><span class="annottext">[Q]
</span><a href="#local-6989586621679112037"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-480"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wants :: Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#wants"><span class="hs-identifier hs-var">wants</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Wanted
</span><a href="#local-6989586621679112047"><span class="hs-identifier hs-var">wanted</span></a></span><span>
</span><span id="line-481"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unQ :: P
</span><a href="Text.Regex.TDFA.CorePattern.html#unQ"><span class="hs-identifier hs-var">unQ</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Q] -&gt; P
</span><a href="Text.Regex.TDFA.CorePattern.html#Or"><span class="hs-identifier hs-var">Or</span></a></span><span> </span><span class="annot"><span class="annottext">[Q]
</span><a href="#local-6989586621679112037"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-482"></span><span>           </span><span class="annot"><span class="annottext">Q
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679112025"><span class="hs-identifier hs-var">ans</span></a></span><span>
</span><span id="line-483"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PConcat"><span class="hs-identifier hs-type">PConcat</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RWS
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Q
</span><a href="#local-6989586621679112001"><span class="hs-identifier hs-var">nil</span></a></span><span> </span><span class="hs-comment">-- fatal to pass [] to combineConcat</span><span>
</span><span id="line-484"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PConcat"><span class="hs-identifier hs-type">PConcat</span></a></span><span> </span><span id="local-6989586621679112053"><span class="annot"><span class="annottext">[Pattern]
</span><a href="#local-6989586621679112053"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Pattern] -&gt; HHQ
</span><a href="#local-6989586621679111966"><span class="hs-identifier hs-var">combineConcat</span></a></span><span> </span><span class="annot"><span class="annottext">[Pattern]
</span><a href="#local-6989586621679112053"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111991"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111992"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-485"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PStar"><span class="hs-identifier hs-type">PStar</span></a></span><span> </span><span id="local-6989586621679112055"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112055"><span class="hs-identifier hs-var">mayFirstBeNull</span></a></span></span><span> </span><span id="local-6989586621679112056"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679112056"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">mdo</span><span>
</span><span id="line-486"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679112057"><span class="annot"><span class="annottext">accepts :: Bool
</span><a href="#local-6989586621679112057"><span class="hs-identifier hs-var hs-var">accepts</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#canAccept"><span class="hs-identifier hs-var">canAccept</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679112058"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-487"></span><span>               </span><span class="hs-comment">-- if needsOrbit is False then there is no need to disambiguate captures on each orbit</span><span>
</span><span id="line-488"></span><span>               </span><span class="hs-comment">-- Both checks are useful because (varies q) of True does not imply (childGroups q) of True when under PNonCapture</span><span>
</span><span id="line-489"></span><span>               </span><span id="local-6989586621679112059"><span class="annot"><span class="annottext">needsOrbit :: Bool
</span><a href="#local-6989586621679112059"><span class="hs-identifier hs-var hs-var">needsOrbit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#varies"><span class="hs-identifier hs-var">varies</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679112058"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#childGroups"><span class="hs-identifier hs-var">childGroups</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679112058"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-490"></span><span>               </span><span class="hs-comment">-- if needsOrbit then must check start/stop before the Orbit tag</span><span>
</span><span id="line-491"></span><span>               </span><span class="hs-comment">-- if accepts then must check start/stop of whole pattern</span><span>
</span><span id="line-492"></span><span>               </span><span id="local-6989586621679112060"><span class="annot"><span class="annottext">needsTags :: Bool
</span><a href="#local-6989586621679112060"><span class="hs-identifier hs-var hs-var">needsTags</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112059"><span class="hs-identifier hs-var">needsOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112057"><span class="hs-identifier hs-var">accepts</span></a></span><span>       </span><span class="hs-comment">-- important that needsOrbit implies needsTags</span><span>
</span><span id="line-493"></span><span>           </span><span id="local-6989586621679112061"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112061"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#noTag"><span class="hs-identifier hs-var">noTag</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111991"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112060"><span class="hs-identifier hs-var">needsTags</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; PM HandleTag
</span><a href="#local-6989586621679111924"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;PStar start&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; PM HandleTag
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111991"><span class="hs-identifier hs-var">m1</span></a></span><span>
</span><span id="line-494"></span><span>           </span><span id="local-6989586621679112062"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112062"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#noTag"><span class="hs-identifier hs-var">noTag</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111992"><span class="hs-identifier hs-var">m2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112060"><span class="hs-identifier hs-var">needsTags</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; PM HandleTag
</span><a href="#local-6989586621679111924"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;PStar stop&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; PM HandleTag
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111992"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-495"></span><span>           </span><span id="local-6989586621679112063"><span class="annot"><span class="annottext">Maybe GroupIndex
</span><a href="#local-6989586621679112063"><span class="hs-identifier hs-var">mOrbit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112059"><span class="hs-identifier hs-var">needsOrbit</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">PM (Maybe GroupIndex)
</span><a href="#local-6989586621679111938"><span class="hs-identifier hs-var">makeOrbit</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe GroupIndex -&gt; PM (Maybe GroupIndex)
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe GroupIndex
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-comment">-- any Orbit tag is created after the pre and post tags</span><span>
</span><span id="line-496"></span><span class="hs-comment">--           test1 &lt;- if tagged q then uniq &quot;not-TEST1&quot; Minimize else return NoTag</span><span>
</span><span id="line-497"></span><span class="hs-comment">-- XXX XXX 1.1.5 testing second NoTag replaced with (toAdvice b)</span><span>
</span><span id="line-498"></span><span>           </span><span class="hs-special">(</span><span id="local-6989586621679112058"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679112058"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679112064"><span class="annot"><span class="annottext">[GroupIndex]
</span><a href="#local-6989586621679112064"><span class="hs-identifier hs-var">resetOrbitTags</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RWS
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Q
-&gt; PM (Q, [GroupIndex])
forall a. PM a -&gt; PM (a, [GroupIndex])
</span><a href="#local-6989586621679111941"><span class="hs-identifier hs-var">withOrbit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern -&gt; HHQ
</span><a href="#local-6989586621679111921"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679112056"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="Text.Regex.TDFA.CorePattern.html#NoTag"><span class="hs-identifier hs-var">NoTag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HandleTag -&gt; HandleTag
</span><a href="Text.Regex.TDFA.CorePattern.html#toAdvice"><span class="hs-identifier hs-var">toAdvice</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112062"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- all contained orbit tags get listened to (not including this one).</span><span>
</span><span id="line-499"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679112065"><span class="annot"><span class="annottext">nullView :: NullView
</span><a href="#local-6989586621679112065"><span class="hs-identifier hs-var hs-var">nullView</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112055"><span class="hs-identifier hs-var">mayFirstBeNull</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NullView -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#cleanNullView"><span class="hs-identifier hs-var">cleanNullView</span></a></span><span> </span><span class="annot"><span class="annottext">(NullView -&gt; NullView) -&gt; NullView -&gt; NullView
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NullView
</span><a href="#local-6989586621679112066"><span class="hs-identifier hs-var">childViews</span></a></span><span> </span><span class="annot"><span class="annottext">NullView -&gt; NullView -&gt; NullView
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">NullView
</span><a href="#local-6989586621679112067"><span class="hs-identifier hs-var">skipView</span></a></span><span>
</span><span id="line-500"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NullView
</span><a href="#local-6989586621679112067"><span class="hs-identifier hs-var">skipView</span></a></span><span>
</span><span id="line-501"></span><span>                 </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679112066"><span class="annot"><span class="annottext">childViews :: NullView
</span><a href="#local-6989586621679112066"><span class="hs-identifier hs-var hs-var">childViews</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; HandleTag -&gt; NullView -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#tagWrapNullView"><span class="hs-identifier hs-var">tagWrapNullView</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112061"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112062"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">(NullView -&gt; NullView)
-&gt; (NullView -&gt; NullView) -&gt; NullView -&gt; NullView
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe GroupIndex -&gt; [GroupIndex] -&gt; NullView -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#orbitWrapNullView"><span class="hs-identifier hs-var">orbitWrapNullView</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe GroupIndex
</span><a href="#local-6989586621679112063"><span class="hs-identifier hs-var">mOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">[GroupIndex]
</span><a href="#local-6989586621679112064"><span class="hs-identifier hs-var">resetOrbitTags</span></a></span><span> </span><span class="annot"><span class="annottext">(NullView -&gt; NullView) -&gt; NullView -&gt; NullView
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Q -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679112058"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-502"></span><span>                       </span><span id="local-6989586621679112067"><span class="annot"><span class="annottext">skipView :: NullView
</span><a href="#local-6989586621679112067"><span class="hs-identifier hs-var hs-var">skipView</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; HandleTag -&gt; NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#makeEmptyNullView"><span class="hs-identifier hs-var">makeEmptyNullView</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112061"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112062"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-503"></span><span>           </span><span class="annot"><span class="annottext">Q
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Q
 -&gt; RWS
      (Maybe GroupIndex)
      [Either GroupIndex GroupInfo]
      ([OP] -&gt; [OP], GroupIndex)
      Q)
-&gt; Q
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nullQ :: NullView
</span><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NullView
</span><a href="#local-6989586621679112065"><span class="hs-identifier hs-var">nullView</span></a></span><span>
</span><span id="line-504"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">takes :: (GroupIndex, Maybe GroupIndex)
</span><a href="Text.Regex.TDFA.CorePattern.html#takes"><span class="hs-identifier hs-var">takes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112057"><span class="hs-identifier hs-var">accepts</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe GroupIndex
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex -&gt; Maybe GroupIndex
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-505"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">preReset :: [GroupIndex]
</span><a href="Text.Regex.TDFA.CorePattern.html#preReset"><span class="hs-identifier hs-var">preReset</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">postSet :: [GroupIndex]
</span><a href="Text.Regex.TDFA.CorePattern.html#postSet"><span class="hs-identifier hs-var">postSet</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-506"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">preTag :: Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#preTag"><span class="hs-identifier hs-var">preTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#apply"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112061"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">postTag :: Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#postTag"><span class="hs-identifier hs-var">postTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#apply"><span class="hs-identifier hs-var">apply</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112062"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-507"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tagged :: Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#tagged"><span class="hs-identifier hs-var">tagged</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112060"><span class="hs-identifier hs-var">needsTags</span></a></span><span>
</span><span id="line-508"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">childGroups :: Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#childGroups"><span class="hs-identifier hs-var">childGroups</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Q -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#childGroups"><span class="hs-identifier hs-var">childGroups</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679112058"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-509"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wants :: Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#wants"><span class="hs-identifier hs-var">wants</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Wanted
</span><a href="Text.Regex.TDFA.CorePattern.html#WantsQT"><span class="hs-identifier hs-var">WantsQT</span></a></span><span>
</span><span id="line-510"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unQ :: P
</span><a href="Text.Regex.TDFA.CorePattern.html#unQ"><span class="hs-identifier hs-var">unQ</span></a></span><span> </span><span class="hs-glyph">=</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#Star"><span class="hs-identifier hs-type">Star</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">getOrbit :: Maybe GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#getOrbit"><span class="hs-identifier hs-var">getOrbit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe GroupIndex
</span><a href="#local-6989586621679112063"><span class="hs-identifier hs-var">mOrbit</span></a></span><span>
</span><span id="line-511"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">resetOrbits :: [GroupIndex]
</span><a href="Text.Regex.TDFA.CorePattern.html#resetOrbits"><span class="hs-identifier hs-var">resetOrbits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GroupIndex]
</span><a href="#local-6989586621679112064"><span class="hs-identifier hs-var">resetOrbitTags</span></a></span><span>
</span><span id="line-512"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">firstNull :: Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#firstNull"><span class="hs-identifier hs-var">firstNull</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112055"><span class="hs-identifier hs-var">mayFirstBeNull</span></a></span><span>
</span><span id="line-513"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unStar :: Q
</span><a href="Text.Regex.TDFA.CorePattern.html#unStar"><span class="hs-identifier hs-var">unStar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679112058"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-514"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PCarat"><span class="hs-identifier hs-type">PCarat</span></a></span><span> </span><span id="local-6989586621679112069"><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679112069"><span class="hs-identifier hs-var">dopa</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TestInfo
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
forall {m :: * -&gt; *}. Monad m =&gt; TestInfo -&gt; m Q
</span><a href="#local-6989586621679112016"><span class="hs-identifier hs-var">test</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhichTest
</span><a href="Text.Regex.TDFA.Common.html#Test_BOL"><span class="hs-identifier hs-var">Test_BOL</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679112069"><span class="hs-identifier hs-var">dopa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PDollar"><span class="hs-identifier hs-type">PDollar</span></a></span><span> </span><span id="local-6989586621679112072"><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679112072"><span class="hs-identifier hs-var">dopa</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TestInfo
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
forall {m :: * -&gt; *}. Monad m =&gt; TestInfo -&gt; m Q
</span><a href="#local-6989586621679112016"><span class="hs-identifier hs-var">test</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhichTest
</span><a href="Text.Regex.TDFA.Common.html#Test_EOL"><span class="hs-identifier hs-var">Test_EOL</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679112072"><span class="hs-identifier hs-var">dopa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PChar"><span class="hs-identifier hs-type">PChar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RWS
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Q
</span><a href="#local-6989586621679112006"><span class="hs-identifier hs-var">one</span></a></span><span>
</span><span id="line-517"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PDot"><span class="hs-identifier hs-type">PDot</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RWS
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Q
</span><a href="#local-6989586621679112006"><span class="hs-identifier hs-var">one</span></a></span><span>
</span><span id="line-518"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PAny"><span class="hs-identifier hs-type">PAny</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RWS
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Q
</span><a href="#local-6989586621679112006"><span class="hs-identifier hs-var">one</span></a></span><span>
</span><span id="line-519"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PAnyNot"><span class="hs-identifier hs-type">PAnyNot</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RWS
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Q
</span><a href="#local-6989586621679112006"><span class="hs-identifier hs-var">one</span></a></span><span>
</span><span id="line-520"></span><span>         </span><span class="hs-comment">-- CompOption's newSyntax enables these escaped anchors</span><span>
</span><span id="line-521"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PEscape"><span class="hs-identifier hs-type">PEscape</span></a></span><span> </span><span id="local-6989586621679112079"><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679112079"><span class="hs-identifier hs-var">dopa</span></a></span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'`'</span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112018"><span class="hs-identifier hs-var">xtra</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TestInfo
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
forall {m :: * -&gt; *}. Monad m =&gt; TestInfo -&gt; m Q
</span><a href="#local-6989586621679112016"><span class="hs-identifier hs-var">test</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhichTest
</span><a href="Text.Regex.TDFA.Common.html#Test_BOB"><span class="hs-identifier hs-var">Test_BOB</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679112079"><span class="hs-identifier hs-var">dopa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-522"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PEscape"><span class="hs-identifier hs-type">PEscape</span></a></span><span> </span><span id="local-6989586621679112081"><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679112081"><span class="hs-identifier hs-var">dopa</span></a></span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\''</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112018"><span class="hs-identifier hs-var">xtra</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TestInfo
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
forall {m :: * -&gt; *}. Monad m =&gt; TestInfo -&gt; m Q
</span><a href="#local-6989586621679112016"><span class="hs-identifier hs-var">test</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhichTest
</span><a href="Text.Regex.TDFA.Common.html#Test_EOB"><span class="hs-identifier hs-var">Test_EOB</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679112081"><span class="hs-identifier hs-var">dopa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-523"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PEscape"><span class="hs-identifier hs-type">PEscape</span></a></span><span> </span><span id="local-6989586621679112083"><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679112083"><span class="hs-identifier hs-var">dopa</span></a></span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'&lt;'</span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112018"><span class="hs-identifier hs-var">xtra</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TestInfo
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
forall {m :: * -&gt; *}. Monad m =&gt; TestInfo -&gt; m Q
</span><a href="#local-6989586621679112016"><span class="hs-identifier hs-var">test</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhichTest
</span><a href="Text.Regex.TDFA.Common.html#Test_BOW"><span class="hs-identifier hs-var">Test_BOW</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679112083"><span class="hs-identifier hs-var">dopa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PEscape"><span class="hs-identifier hs-type">PEscape</span></a></span><span> </span><span id="local-6989586621679112085"><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679112085"><span class="hs-identifier hs-var">dopa</span></a></span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'&gt;'</span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112018"><span class="hs-identifier hs-var">xtra</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TestInfo
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
forall {m :: * -&gt; *}. Monad m =&gt; TestInfo -&gt; m Q
</span><a href="#local-6989586621679112016"><span class="hs-identifier hs-var">test</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhichTest
</span><a href="Text.Regex.TDFA.Common.html#Test_EOW"><span class="hs-identifier hs-var">Test_EOW</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679112085"><span class="hs-identifier hs-var">dopa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PEscape"><span class="hs-identifier hs-type">PEscape</span></a></span><span> </span><span id="local-6989586621679112087"><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679112087"><span class="hs-identifier hs-var">dopa</span></a></span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'b'</span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112018"><span class="hs-identifier hs-var">xtra</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TestInfo
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
forall {m :: * -&gt; *}. Monad m =&gt; TestInfo -&gt; m Q
</span><a href="#local-6989586621679112016"><span class="hs-identifier hs-var">test</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhichTest
</span><a href="Text.Regex.TDFA.Common.html#Test_EdgeWord"><span class="hs-identifier hs-var">Test_EdgeWord</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679112087"><span class="hs-identifier hs-var">dopa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PEscape"><span class="hs-identifier hs-type">PEscape</span></a></span><span> </span><span id="local-6989586621679112089"><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679112089"><span class="hs-identifier hs-var">dopa</span></a></span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'B'</span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679112018"><span class="hs-identifier hs-var">xtra</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TestInfo
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
forall {m :: * -&gt; *}. Monad m =&gt; TestInfo -&gt; m Q
</span><a href="#local-6989586621679112016"><span class="hs-identifier hs-var">test</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WhichTest
</span><a href="Text.Regex.TDFA.Common.html#Test_NotEdgeWord"><span class="hs-identifier hs-var">Test_NotEdgeWord</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">DoPa
</span><a href="#local-6989586621679112089"><span class="hs-identifier hs-var">dopa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-527"></span><span>         </span><span class="hs-comment">-- otherwise escape codes are just the escaped character</span><span>
</span><span id="line-528"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PEscape"><span class="hs-identifier hs-type">PEscape</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RWS
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Q
</span><a href="#local-6989586621679112006"><span class="hs-identifier hs-var">one</span></a></span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span>         </span><span class="hs-comment">-- A PGroup node in the Pattern tree does not become a node</span><span>
</span><span id="line-531"></span><span>         </span><span class="hs-comment">-- in the Q/P tree. A PGroup can share and pass along a</span><span>
</span><span id="line-532"></span><span>         </span><span class="hs-comment">-- preTag (with Advice) with other branches, but will pass</span><span>
</span><span id="line-533"></span><span>         </span><span class="hs-comment">-- down an Apply postTag.</span><span>
</span><span id="line-534"></span><span>         </span><span class="hs-comment">--</span><span>
</span><span id="line-535"></span><span>         </span><span class="hs-comment">-- If the parent index is Nothing then this is part of a</span><span>
</span><span id="line-536"></span><span>         </span><span class="hs-comment">-- non-capturing subtree and ignored.  This is a lazy and</span><span>
</span><span id="line-537"></span><span>         </span><span class="hs-comment">-- efficient alternative to rebuilding the tree with PGroup</span><span>
</span><span id="line-538"></span><span>         </span><span class="hs-comment">-- Nothing replacing PGroup (Just _).</span><span>
</span><span id="line-539"></span><span>         </span><span class="hs-comment">--</span><span>
</span><span id="line-540"></span><span>         </span><span class="hs-comment">-- Guarded by the getParentIndex /= Nothing check is the</span><span>
</span><span id="line-541"></span><span>         </span><span class="hs-comment">-- withParent command.</span><span>
</span><span id="line-542"></span><span>         </span><span class="hs-comment">--</span><span>
</span><span id="line-543"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PGroup"><span class="hs-identifier hs-type">PGroup</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe GroupIndex
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span id="local-6989586621679112092"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679112092"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; HHQ
</span><a href="#local-6989586621679111921"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679112092"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111991"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111992"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-544"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PGroup"><span class="hs-identifier hs-type">PGroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679112093"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679112093"><span class="hs-identifier hs-var">this</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679112094"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679112094"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-545"></span><span>           </span><span id="local-6989586621679112095"><span class="annot"><span class="annottext">Maybe GroupIndex
</span><a href="#local-6989586621679112095"><span class="hs-identifier hs-var">mParent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PM (Maybe GroupIndex)
</span><a href="#local-6989586621679111944"><span class="hs-identifier hs-var">getParentIndex</span></a></span><span>
</span><span id="line-546"></span><span>           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe GroupIndex
</span><a href="#local-6989586621679112095"><span class="hs-identifier hs-var">mParent</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-547"></span><span>             </span><span class="annot"><span class="annottext">Maybe GroupIndex
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pattern -&gt; HHQ
</span><a href="#local-6989586621679111921"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679112094"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111991"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111992"><span class="hs-identifier hs-var">m2</span></a></span><span> </span><span class="hs-comment">-- just like PGroup Nothing p</span><span>
</span><span id="line-548"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679112096"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679112096"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-549"></span><span>               </span><span class="hs-comment">-- 'a' may be Advice or Apply from parent or Apply created here</span><span>
</span><span id="line-550"></span><span>               </span><span id="local-6989586621679112097"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112097"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#noTag"><span class="hs-identifier hs-var">noTag</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111991"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; PM HandleTag
</span><a href="#local-6989586621679111924"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;PGroup start&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; PM HandleTag
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111991"><span class="hs-identifier hs-var">m1</span></a></span><span>
</span><span id="line-551"></span><span>               </span><span id="local-6989586621679112098"><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112098"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; Bool
</span><a href="Text.Regex.TDFA.CorePattern.html#noTag"><span class="hs-identifier hs-var">noTag</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111992"><span class="hs-identifier hs-var">m2</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; PM HandleTag
</span><a href="#local-6989586621679111924"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;PGroup stop&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HandleTag -&gt; PM HandleTag
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111992"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-552"></span><span>               </span><span id="local-6989586621679112099"><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679112099"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     GroupIndex
</span><a href="#local-6989586621679111927"><span class="hs-identifier hs-var">ignore</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;PGroup ignore&quot;</span></span><span>
</span><span id="line-553"></span><span class="hs-comment">{-
               -- 'b' may be Apply from parent or Apply created here
               b &lt;- if isNothing (apply m2) then uniq &quot;PGroup&quot; else return m2
-}</span><span>
</span><span id="line-557"></span><span>               </span><span class="hs-special">(</span><span id="local-6989586621679112100"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679112100"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679112101"><span class="annot"><span class="annottext">[GroupIndex]
</span><a href="#local-6989586621679112101"><span class="hs-identifier hs-var">resetGroupTags</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GroupIndex
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
-&gt; PM (Q, [GroupIndex])
forall a. GroupIndex -&gt; PM a -&gt; PM (a, [GroupIndex])
</span><a href="#local-6989586621679111948"><span class="hs-identifier hs-var">withParent</span></a></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679112093"><span class="hs-identifier hs-var">this</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern -&gt; HHQ
</span><a href="#local-6989586621679111921"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679112094"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112097"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112098"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- all immediate child groups stop tags get listened to.</span><span>
</span><span id="line-558"></span><span>               </span><span class="hs-comment">-- 2009: makeGroup performs a tell, why after withParent? I am no longer sure.</span><span>
</span><span id="line-559"></span><span>               </span><span class="annot"><span class="annottext">GroupInfo
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     ()
</span><a href="#local-6989586621679111943"><span class="hs-identifier hs-var">makeGroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupIndex
-&gt; GroupIndex
-&gt; GroupIndex
-&gt; GroupIndex
-&gt; GroupIndex
-&gt; GroupInfo
</span><a href="Text.Regex.TDFA.Common.html#GroupInfo"><span class="hs-identifier hs-var">GroupInfo</span></a></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679112093"><span class="hs-identifier hs-var">this</span></a></span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679112096"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HandleTag -&gt; GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#fromHandleTag"><span class="hs-identifier hs-var">fromHandleTag</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112097"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HandleTag -&gt; GroupIndex
</span><a href="Text.Regex.TDFA.CorePattern.html#fromHandleTag"><span class="hs-identifier hs-var">fromHandleTag</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679112098"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GroupIndex
</span><a href="#local-6989586621679112099"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-560"></span><span>               </span><span class="annot"><span class="annottext">Q
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
forall a.
a
-&gt; RWST
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Identity
     a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Q
 -&gt; RWS
      (Maybe GroupIndex)
      [Either GroupIndex GroupInfo]
      ([OP] -&gt; [OP], GroupIndex)
      Q)
-&gt; Q
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679112100"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#addGroupResetsToNullView"><span class="hs-identifier hs-type">addGroupResetsToNullView</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679112101"><span class="hs-identifier hs-type">resetGroupTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679112099"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#nullQ"><span class="hs-identifier hs-var">nullQ</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679112100"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#tagged"><span class="hs-identifier hs-var">tagged</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span>
</span><span id="line-562"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#childGroups"><span class="hs-identifier hs-var">childGroups</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span>
</span><span id="line-563"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#preReset"><span class="hs-identifier hs-var">preReset</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679112101"><span class="hs-identifier hs-type">resetGroupTags</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`mappend`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#preReset"><span class="hs-identifier hs-var">preReset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679112100"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-564"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#postSet"><span class="hs-identifier hs-var">postSet</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.CorePattern.html#postSet"><span class="hs-identifier hs-var">postSet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679112100"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">`mappend`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679112099"><span class="hs-identifier hs-type">flag</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-565"></span><span>                          </span><span class="hs-special">}</span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span>         </span><span class="hs-comment">-- A PNonCapture node in the Pattern tree does not become a</span><span>
</span><span id="line-568"></span><span>         </span><span class="hs-comment">-- node in the Q/P tree.  It sets the parent to Nothing while</span><span>
</span><span id="line-569"></span><span>         </span><span class="hs-comment">-- processing the sub-tree.</span><span>
</span><span id="line-570"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PNonCapture"><span class="hs-identifier hs-type">PNonCapture</span></a></span><span> </span><span id="local-6989586621679112104"><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679112104"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RWS
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Q
-&gt; RWS
     (Maybe GroupIndex)
     [Either GroupIndex GroupInfo]
     ([OP] -&gt; [OP], GroupIndex)
     Q
forall a. PM a -&gt; PM a
</span><a href="#local-6989586621679111945"><span class="hs-identifier hs-var">nonCapture</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern -&gt; HHQ
</span><a href="#local-6989586621679111921"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern
</span><a href="#local-6989586621679112104"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111991"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="annot"><span class="annottext">HandleTag
</span><a href="#local-6989586621679111992"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>
</span><span id="line-572"></span><span>         </span><span class="hs-comment">-- these are here for completeness of the case branches, currently starTrans replaces them all</span><span>
</span><span id="line-573"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PPlus"><span class="hs-identifier hs-type">PPlus</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RWS
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Q
forall {a}. a
</span><a href="#local-6989586621679111996"><span class="hs-identifier hs-var">die</span></a></span><span>
</span><span id="line-574"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PQuest"><span class="hs-identifier hs-type">PQuest</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RWS
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Q
forall {a}. a
</span><a href="#local-6989586621679111996"><span class="hs-identifier hs-var">die</span></a></span><span>
</span><span id="line-575"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PBound"><span class="hs-identifier hs-type">PBound</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RWS
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Q
forall {a}. a
</span><a href="#local-6989586621679111996"><span class="hs-identifier hs-var">die</span></a></span><span>
</span><span id="line-576"></span><span>         </span><span class="hs-comment">-- PNonEmpty is deprecated, and not produced in Pattern by starTrans anymore</span><span>
</span><span id="line-577"></span><span>         </span><span class="annot"><a href="Text.Regex.TDFA.Pattern.html#PNonEmpty"><span class="hs-identifier hs-type">PNonEmpty</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RWS
  (Maybe GroupIndex)
  [Either GroupIndex GroupInfo]
  ([OP] -&gt; [OP], GroupIndex)
  Q
forall {a}. a
</span><a href="#local-6989586621679111996"><span class="hs-identifier hs-var">die</span></a></span><span>
</span><span id="line-578"></span><span>
</span><span id="line-579"></span><span class="hs-comment">{-
Similar to change in WinTags for QT/QNFA:
Change the NullView to use a tasktags instead of wintags since they are all PreUpdate

         -- PNonEmpty means the child pattern p can be skipped by
         -- bypassing the pattern.  This is only used in the case p
         -- can accept 0 and can accept more than zero characters
         -- (thus the assertions, enforced by CorePattern.starTrans).
         -- The important thing about this case is intercept the
         -- &quot;accept 0&quot; possibility and replace with &quot;skip&quot;.
         PNonEmpty p -&gt; mdo
           let needsTags = canAccept q
           a &lt;- if noTag m1 &amp;&amp; needsTags then uniq Minimize else return m1
           b &lt;- if noTag m2 &amp;&amp; needsTags then uniq Maximize else return m2
           q &lt;- go p (toAdvice a) (toAdvice b)
           when (not needsTags) (err $ &quot;PNonEmpty could not accept characters: &quot;++show (p,pOrig))
           when (mustAccept q) (err $ &quot;patternToQ : PNonEmpty provided with a *mustAccept* pattern: &quot;++show (p,pOrig))
           return $ Q { nullQ = emptyNull (preTags (apply a) (apply b)) -- The meaning of NonEmpty
                      , takes = (0,snd (takes q))                       -- like Or, drop lower bound to 0
                      , preReset = []
                      , preTag = apply a, postTag = apply b             -- own the closing tag so it will not end a PGroup
                      , tagged = needsTags
                      , childGroups = childGroups q
                      , wants = wants q  -- the test case is &quot;x&quot; =~ &quot;(.|$){1,3}&quot;
                      , unQ = NonEmpty q }

-}</span><span>
</span><span id="line-606"></span><span class="hs-comment">{-
emptyNull :: TagList -&gt; NullView
emptyNull tags = (mempty, tags) : []

testNull :: TestInfo -&gt; TagList -&gt; NullView
testNull (w,d) tags = (SetTestInfo (Map.singleton w (Set.singleton d)), tags) : []

-- Prepend tags to nullView
addTagsToNullView :: TagList -&gt; NullView -&gt; NullView
addTagsToNullView [] oldNV = oldNV
addTagsToNullView tags oldNV= do
  (oldTest,oldTags) &lt;- oldNV
  return (oldTest,tags `mappend` oldTags)

-}</span><span>
</span><span id="line-621"></span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span class="hs-comment">-- xxx todo</span><span>
</span><span id="line-624"></span><span class="hs-comment">--</span><span>
</span><span id="line-625"></span><span class="hs-comment">-- see of PNonEmpty -&gt; NonEmpty -&gt; TNFA is really smarter than POr about tags</span><span>
</span><span id="line-626"></span></pre></body></html>