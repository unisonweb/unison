<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Unison.Util.RefPromise</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">unison-parser-typechecker-0.0.0</span><ul class="links" id="page-menu"><li><a href="src/Unison.Util.RefPromise.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Unison.Util.RefPromise</p></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:Ticket">Ticket</a> a</li><li class="src short"><a href="#v:peekTicket">peekTicket</a> :: <a href="Unison-Util-RefPromise.html#t:Ticket" title="Unison.Util.RefPromise">Ticket</a> a -&gt; a</li><li class="src short"><a href="#v:readForCAS">readForCAS</a> :: <a href="../base-4.18.2.1/Data-IORef.html#t:IORef" title="Data.IORef">IORef</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Unison-Util-RefPromise.html#t:Ticket" title="Unison.Util.RefPromise">Ticket</a> a)</li><li class="src short"><a href="#v:casIORef">casIORef</a> :: <a href="../base-4.18.2.1/Data-IORef.html#t:IORef" title="Data.IORef">IORef</a> a -&gt; <a href="Unison-Util-RefPromise.html#t:Ticket" title="Unison.Util.RefPromise">Ticket</a> a -&gt; a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>, <a href="Unison-Util-RefPromise.html#t:Ticket" title="Unison.Util.RefPromise">Ticket</a> a)</li><li class="src short"><span class="keyword">data</span> <a href="#t:Promise">Promise</a> a</li><li class="src short"><a href="#v:newPromise">newPromise</a> :: <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Unison-Util-RefPromise.html#t:Promise" title="Unison.Util.RefPromise">Promise</a> a)</li><li class="src short"><a href="#v:readPromise">readPromise</a> :: <a href="Unison-Util-RefPromise.html#t:Promise" title="Unison.Util.RefPromise">Promise</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a</li><li class="src short"><a href="#v:tryReadPromise">tryReadPromise</a> :: <a href="Unison-Util-RefPromise.html#t:Promise" title="Unison.Util.RefPromise">Promise</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../base-4.18.2.1/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> a)</li><li class="src short"><a href="#v:writePromise">writePromise</a> :: <a href="Unison-Util-RefPromise.html#t:Promise" title="Unison.Util.RefPromise">Promise</a> a -&gt; a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Ticket" class="def">Ticket</a> a <a href="#t:Ticket" class="selflink">#</a></p><div class="doc"><p>When performing compare-and-swaps, the <em>ticket</em> encapsulates proof
 that a thread observed a specific previous value of a mutable
 variable.  It is provided in lieu of the &quot;old&quot; value to
 compare-and-swap.</p><p>Design note: <code><a href="Unison-Util-RefPromise.html#t:Ticket" title="Unison.Util.RefPromise">Ticket</a></code>s exist to hide objects from the GHC compiler, which
 can normally perform many optimizations that change pointer equality.  A Ticket,
 on the other hand, is a first-class object that can be handled by the user,
 but will not have its pointer identity changed by compiler optimizations
 (but will of course, change addresses during garbage collection).</p></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:Ticket">Instances</h4><details id="i:Ticket" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Ticket:Show:1"></span> <a href="../base-4.18.2.1/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Unison-Util-RefPromise.html#t:Ticket" title="Unison.Util.RefPromise">Ticket</a> a)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Ticket:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="../atomic-primops-0.8.7/Data-Atomics-Internal.html">Data.Atomics.Internal</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Unison-Util-RefPromise.html#t:Ticket" title="Unison.Util.RefPromise">Ticket</a> a -&gt; <a href="../base-4.18.2.1/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Unison-Util-RefPromise.html#t:Ticket" title="Unison.Util.RefPromise">Ticket</a> a -&gt; <a href="../base-4.18.2.1/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Unison-Util-RefPromise.html#t:Ticket" title="Unison.Util.RefPromise">Ticket</a> a] -&gt; <a href="../base-4.18.2.1/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Ticket:Eq:2"></span> <a href="../base-4.18.2.1/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="Unison-Util-RefPromise.html#t:Ticket" title="Unison.Util.RefPromise">Ticket</a> a)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Ticket:Eq:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="../atomic-primops-0.8.7/Data-Atomics-Internal.html">Data.Atomics.Internal</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Unison-Util-RefPromise.html#t:Ticket" title="Unison.Util.RefPromise">Ticket</a> a -&gt; <a href="Unison-Util-RefPromise.html#t:Ticket" title="Unison.Util.RefPromise">Ticket</a> a -&gt; <a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Unison-Util-RefPromise.html#t:Ticket" title="Unison.Util.RefPromise">Ticket</a> a -&gt; <a href="Unison-Util-RefPromise.html#t:Ticket" title="Unison.Util.RefPromise">Ticket</a> a -&gt; <a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:peekTicket" class="def">peekTicket</a> :: <a href="Unison-Util-RefPromise.html#t:Ticket" title="Unison.Util.RefPromise">Ticket</a> a -&gt; a <a href="#v:peekTicket" class="selflink">#</a></p><div class="doc"><p>A ticket contains or can get the usable Haskell value.
   This function does just that.</p></div></div><div class="top"><p class="src"><a id="v:readForCAS" class="def">readForCAS</a> :: <a href="../base-4.18.2.1/Data-IORef.html#t:IORef" title="Data.IORef">IORef</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Unison-Util-RefPromise.html#t:Ticket" title="Unison.Util.RefPromise">Ticket</a> a) <a href="#v:readForCAS" class="selflink">#</a></p><div class="doc"><p>Ordinary processor load instruction (non-atomic, not implying any memory barriers).</p><p>The difference between this function and <code><a href="../base-4.18.2.1/Data-IORef.html#v:readIORef" title="Data.IORef">readIORef</a></code>, is that it returns a <em>ticket</em>,
   for use in future compare-and-swap operations.</p></div></div><div class="top"><p class="src"><a id="v:casIORef" class="def">casIORef</a> <a href="#v:casIORef" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.18.2.1/Data-IORef.html#t:IORef" title="Data.IORef">IORef</a> a</td><td class="doc"><p>The <code><a href="../base-4.18.2.1/Data-IORef.html#t:IORef" title="Data.IORef">IORef</a></code> containing a value <code>current</code></p></td></tr><tr><td class="src">-&gt; <a href="Unison-Util-RefPromise.html#t:Ticket" title="Unison.Util.RefPromise">Ticket</a> a</td><td class="doc"><p>A ticket for the <code>old</code> value</p></td></tr><tr><td class="src">-&gt; a</td><td class="doc"><p>The <code>new</code> value to replace <code>current</code> if <code>old == current</code></p></td></tr><tr><td class="src">-&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>, <a href="Unison-Util-RefPromise.html#t:Ticket" title="Unison.Util.RefPromise">Ticket</a> a)</td><td class="doc"><p>Success flag, plus ticket for the NEXT operation.</p></td></tr></table></div><div class="doc"><p>Performs a machine-level compare and swap (CAS) operation on an
 <code><a href="../base-4.18.2.1/Data-IORef.html#t:IORef" title="Data.IORef">IORef</a></code>. Returns a tuple containing a <code><a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></code> which is <code><a href="../base-4.18.2.1/Data-Bool.html#v:True" title="Data.Bool">True</a></code> when a
 swap is performed, along with the most <code>current</code> value from the <code><a href="../base-4.18.2.1/Data-IORef.html#t:IORef" title="Data.IORef">IORef</a></code>.
 Note that this differs from the more common CAS behavior, which is to
 return the <em>old</em> value before the CAS occured.</p><p>The reason for the difference is the ticket API.  This function always returns the
 ticket that you should use in your next CAS attempt.  In case of success, this ticket
 corresponds to the <code>new</code> value which you yourself installed in the <code><a href="../base-4.18.2.1/Data-IORef.html#t:IORef" title="Data.IORef">IORef</a></code>, whereas
 in the case of failure it represents the preexisting value currently in the IORef.</p><p>Note &quot;compare&quot; here means pointer equality in the sense of
 <code><a href="../ghc-prim-0.10.0/GHC-Prim.html#v:reallyUnsafePtrEquality-35-" title="GHC.Prim">reallyUnsafePtrEquality#</a></code>.  However, the ticket API absolves
 the user of this module from needing to worry about the pointer equality of their
 values, which in general requires reasoning about the details of the Haskell
 implementation (GHC).</p><p>By convention this function is strict in the &quot;new&quot; value argument.  This isn't
 absolutely necesary, but we think it's a bad habit to use unevaluated thunks in
 this context.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Promise" class="def">Promise</a> a <a href="src/Unison.Util.RefPromise.html#Promise" class="link">Source</a> <a href="#t:Promise" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:newPromise" class="def">newPromise</a> :: <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Unison-Util-RefPromise.html#t:Promise" title="Unison.Util.RefPromise">Promise</a> a) <a href="src/Unison.Util.RefPromise.html#newPromise" class="link">Source</a> <a href="#v:newPromise" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:readPromise" class="def">readPromise</a> :: <a href="Unison-Util-RefPromise.html#t:Promise" title="Unison.Util.RefPromise">Promise</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a <a href="src/Unison.Util.RefPromise.html#readPromise" class="link">Source</a> <a href="#v:readPromise" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:tryReadPromise" class="def">tryReadPromise</a> :: <a href="Unison-Util-RefPromise.html#t:Promise" title="Unison.Util.RefPromise">Promise</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../base-4.18.2.1/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> a) <a href="src/Unison.Util.RefPromise.html#tryReadPromise" class="link">Source</a> <a href="#v:tryReadPromise" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:writePromise" class="def">writePromise</a> :: <a href="Unison-Util-RefPromise.html#t:Promise" title="Unison.Util.RefPromise">Promise</a> a -&gt; a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="src/Unison.Util.RefPromise.html#writePromise" class="link">Source</a> <a href="#v:writePromise" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>