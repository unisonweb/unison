<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns, ScopedTypeVariables #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE MagicHash, UnboxedTuples, PatternGuards #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-unused-imports #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE Trustworthy #-}</span><span>
</span><span id="line-5"></span><span class="annot"><span class="hs-comment">{- | Copyright : (c) 2010-2011 Simon Meier
                 (c) 2010      Jasper van der Jeugt
License        : BSD3-style (see LICENSE)
Maintainer     : Simon Meier &lt;iridcode@gmail.com&gt;
Portability    : GHC

This module provides 'Builder' /primitives/, which are lower level building
blocks for constructing 'Builder's. You don't need to go down to this level but
it can be slightly faster.

Morally, builder primitives are like functions @a -&gt; Builder@, that is they
take a value and encode it as a sequence of bytes, represented as a 'Builder'.
Of course their implementation is a bit more specialised.

Builder primitives come in two forms: fixed-size and bounded-size.

* /Fixed(-size) primitives/ are builder primitives that always result in a
  sequence of bytes of a fixed length. That is, the length is independent of
  the value that is encoded. An example of a fixed size primitive is the
  big-endian encoding of a 'Word64', which always results in exactly 8 bytes.

* /Bounded(-size) primitives/ are builder primitives that always result in a
  sequence of bytes that is no larger than a predetermined bound. That is, the
  bound is independent of the value that is encoded but the actual length will
  depend on the value. An example for a bounded primitive is the UTF-8 encoding
  of a 'Char', which can be 1,2,3 or 4 bytes long, so the bound is 4 bytes.

Note that fixed primitives can be considered as a special case of bounded
primitives, and we can lift from fixed to bounded.

Because bounded primitives are the more general case, in this documentation we
only refer to fixed size primitives where it matters that the resulting
sequence of bytes is of a fixed length. Otherwise, we just refer to bounded
size primitives.

The purpose of using builder primitives is to improve the performance of
'Builder's. These improvements stem from making the two most common steps
performed by a 'Builder' more efficient. We explain these two steps in turn.

The first most common step is the concatenation of two 'Builder's. Internally,
concatenation corresponds to function composition. (Note that 'Builder's can
be seen as difference-lists of buffer-filling functions; cf.
&lt;http://hackage.haskell.org/cgi-bin/hackage-scripts/package/dlist&gt;. )
Function composition is a fast /O(1)/ operation. However, we can use bounded
primitives to remove some of these function compositions altogether, which is
more efficient.

The second most common step performed by a 'Builder' is to fill a buffer using
a bounded primitives, which works as follows. The 'Builder' checks whether
there is enough space left to execute the bounded primitive. If there is, then
the 'Builder' executes the bounded primitive and calls the next 'Builder' with
the updated buffer. Otherwise, the 'Builder' signals its driver that it
requires a new buffer. This buffer must be at least as large as the bound of
the primitive. We can use bounded primitives to reduce the number of
buffer-free checks by fusing the buffer-free checks of consecutive 'Builder's.
We can also use bounded primitives to simplify the control flow for signalling
that a buffer is full by ensuring that we check first that there is enough
space left and only then decide on how to encode a given value.

Let us illustrate these improvements on the CSV-table rendering example from
&quot;Data.ByteString.Builder&quot;. Its \&quot;hot code\&quot; is the rendering of a table's
cells, which we implement as follows using only the functions from the
'Builder' API.

@
import &quot;Data.ByteString.Builder&quot; as B

renderCell :: Cell -&gt; Builder
renderCell (StringC cs) = renderString cs
renderCell (IntC i)     = B.intDec i

renderString :: String -&gt; Builder
renderString cs = B.charUtf8 \'\&quot;\' \&lt;\&gt; foldMap escape cs \&lt;\&gt; B.charUtf8 \'\&quot;\'
  where
    escape \'\\\\\' = B.charUtf8 \'\\\\\' \&lt;\&gt; B.charUtf8 \'\\\\\'
    escape \'\\\&quot;\' = B.charUtf8 \'\\\\\' \&lt;\&gt; B.charUtf8 \'\\\&quot;\'
    escape c    = B.charUtf8 c
@

Efficient encoding of 'Int's as decimal numbers is performed by @intDec@.
Optimization potential exists for the escaping of 'String's. The above
implementation has two optimization opportunities. First, the buffer-free
checks of the 'Builder's for escaping double quotes and backslashes can be
fused. Second, the concatenations performed by 'foldMap' can be eliminated.
The following implementation exploits these optimizations.

@
import qualified Data.ByteString.Builder.Prim  as P
import           Data.ByteString.Builder.Prim
                 ( 'condB', 'liftFixedToBounded', ('&gt;*&lt;'), ('&gt;$&lt;') )

renderString :: String -\&gt; Builder
renderString cs =
    B.charUtf8 \'\&quot;\' \&lt;\&gt; 'P.primMapListBounded' escape cs \&lt;\&gt; B.charUtf8 \'\&quot;\'
  where
    escape :: 'P.BoundedPrim' Char
    escape =
      'condB' (== \'\\\\\') (fixed2 (\'\\\\\', \'\\\\\')) $
      'condB' (== \'\\\&quot;\') (fixed2 (\'\\\\\', \'\\\&quot;\')) $
      'charUtf8'
    &amp;#160;
    {&amp;#45;\# INLINE fixed2 \#&amp;#45;}
    fixed2 x = 'P.liftFixedToBounded' $ const x '&gt;$&lt;' 'P.char7' '&gt;*&lt;' 'P.char7'
@

The code should be mostly self-explanatory. The slightly awkward syntax is
because the combinators are written such that the size-bound of the resulting
'BoundedPrim' can be computed at compile time. We also explicitly inline the
@fixed2@ primitive, which encodes a fixed tuple of characters, to ensure that
the bound computation happens at compile time. When encoding the following list
of 'String's, the optimized implementation of @renderString@ is two times
faster.

@
maxiStrings :: [String]
maxiStrings = take 1000 $ cycle [\&quot;hello\&quot;, \&quot;\\\&quot;1\\\&quot;\&quot;, \&quot;&amp;#955;-w&amp;#246;rld\&quot;]
@

Most of the performance gain stems from using 'primMapListBounded', which
encodes a list of values from left-to-right with a 'BoundedPrim'. It exploits
the 'Builder' internals to avoid unnecessary function compositions (i.e.,
concatenations). In the future, we might expect the compiler to perform the
optimizations implemented in 'primMapListBounded'. However, it seems that the
code is currently to complicated for the compiler to see through. Therefore, we
provide the 'BoundedPrim' escape hatch, which allows data structures to provide
very efficient encoding traversals, like 'primMapListBounded' for lists.

Note that 'BoundedPrim's are a bit verbose, but quite versatile. Here is an
example of a 'BoundedPrim' for combined HTML escaping and UTF-8 encoding. It
exploits that the escaped character with the maximal Unicode codepoint is \'&gt;\'.

@
{&amp;#45;\# INLINE charUtf8HtmlEscaped \#&amp;#45;}
charUtf8HtmlEscaped :: 'BoundedPrim' Char
charUtf8HtmlEscaped =
    'condB' (&gt;  \'\&gt;\' ) 'charUtf8' $
    'condB' (== \'\&lt;\' ) (fixed4 (\'&amp;\',(\'l\',(\'t\',\';\')))) $        -- &amp;lt;
    'condB' (== \'\&gt;\' ) (fixed4 (\'&amp;\',(\'g\',(\'t\',\';\')))) $        -- &amp;gt;
    'condB' (== \'&amp;\' ) (fixed5 (\'&amp;\',(\'a\',(\'m\',(\'p\',\';\'))))) $  -- &amp;amp;
    'condB' (== \'\&quot;\' ) (fixed5 (\'&amp;\',(\'\#\',(\'3\',(\'4\',\';\'))))) $  -- &amp;\#34;
    'condB' (== \'\\\'\') (fixed5 (\'&amp;\',(\'\#\',(\'3\',(\'9\',\';\'))))) $  -- &amp;\#39;
    ('liftFixedToBounded' 'char7')         -- fallback for 'Char's smaller than \'\&gt;\'
  where
    {&amp;#45;\# INLINE fixed4 \#&amp;#45;}
    fixed4 x = 'liftFixedToBounded' $ const x '&gt;$&lt;'
      char7 '&gt;*&lt;' char7 '&gt;*&lt;' char7 '&gt;*&lt;' char7
    &amp;#160;
    {&amp;#45;\# INLINE fixed5 \#&amp;#45;}
    fixed5 x = 'liftFixedToBounded' $ const x '&gt;$&lt;'
      char7 '&gt;*&lt;' char7 '&gt;*&lt;' char7 '&gt;*&lt;' char7 '&gt;*&lt;' char7
@

This module currently does not expose functions that require the special
properties of fixed-size primitives. They are useful for prefixing 'Builder's
with their size or for implementing chunked encodings. We will expose the
corresponding functions in future releases of this library.
-}</span></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="hs-comment">{-
--
--
-- A /bounded primitive/ is a builder primitive that never results in a sequence
-- longer than some fixed number of bytes. This number of bytes must be
-- independent of the value being encoded. Typical examples of bounded
-- primitives are the big-endian encoding of a 'Word64', which results always
-- in exactly 8 bytes, or the UTF-8 encoding of a 'Char', which results always
-- in less or equal to 4 bytes.
--
-- Typically, primitives are implemented efficiently by allocating a buffer (an
-- array of bytes) and repeatedly executing the following two steps: (1)
-- writing to the buffer until it is full and (2) handing over the filled part
-- to the consumer of the encoded value. Step (1) is where bounded primitives
-- are used. We must use a bounded primitive, as we must check that there is
-- enough free space /before/ actually writing to the buffer.
--
-- In term of expressiveness, it would be sufficient to construct all encodings
-- from the single bounded encoding that encodes a 'Word8' as-is. However,
-- this is not sufficient in terms of efficiency. It results in unnecessary
-- buffer-full checks and it complicates the program-flow for writing to the
-- buffer, as buffer-full checks are interleaved with analysing the value to be
-- encoded (e.g., think about the program-flow for UTF-8 encoding). This has a
-- significant effect on overall encoding performance, as encoding primitive
-- Haskell values such as 'Word8's or 'Char's lies at the heart of every
-- encoding implementation.
--
-- The bounded 'Encoding's provided by this module remove this performance
-- problem. Intuitively, they consist of a tuple of the bound on the maximal
-- number of bytes written and the actual implementation of the encoding as a
-- function that modifies a mutable buffer. Hence when executing a bounded
-- 'Encoding', the buffer-full check can be done once before the actual writing
-- to the buffer. The provided 'Encoding's also take care to implement the
-- actual writing to the buffer efficiently. Moreover, combinators are
-- provided to construct new bounded encodings from the provided ones.
--
-- A typical example for using the combinators is a bounded 'Encoding' that
-- combines escaping the ' and \\ characters with UTF-8 encoding. More
-- precisely, the escaping to be done is the one implemented by the following
-- @escape@ function.
--
-- &gt; escape :: Char -&gt; [Char]
-- &gt; escape '\'' = &quot;\\'&quot;
-- &gt; escape '\\' = &quot;\\\\&quot;
-- &gt; escape c    = [c]
--
-- The bounded 'Encoding' that combines this escaping with UTF-8 encoding is
-- the following.
--
-- &gt; import Data.ByteString.Builder.Prim.Utf8 (char)
-- &gt;
-- &gt; {-# INLINE escapeChar #-}
-- &gt; escapeUtf8 :: BoundedPrim Char
-- &gt; escapeUtf8 =
-- &gt;     encodeIf ('\'' ==) (char &lt;#&gt; char #. const ('\\','\'')) $
-- &gt;     encodeIf ('\\' ==) (char &lt;#&gt; char #. const ('\\','\\')) $
-- &gt;     char
--
-- The definition of 'escapeUtf8' is more complicated than 'escape', because
-- the combinators ('encodeIf', 'encodePair', '#.', and 'char') used in
-- 'escapeChar' compute both the bound on the maximal number of bytes written
-- (8 for 'escapeUtf8') as well as the low-level buffer manipulation required
-- to implement the encoding. Bounded 'Encoding's should always be inlined.
-- Otherwise, the compiler cannot compute the bound on the maximal number of
-- bytes written at compile-time. Without inlinining, it would also fail to
-- optimize the constant encoding of the escape characters in the above
-- example. Functions that execute bounded 'Encoding's also perform
-- suboptimally, if the definition of the bounded 'Encoding' is not inlined.
-- Therefore we add an 'INLINE' pragma to 'escapeUtf8'.
--
-- Currently, the only library that executes bounded 'Encoding's is the
-- 'bytestring' library (&lt;http://hackage.haskell.org/package/bytestring&gt;). It
-- uses bounded 'Encoding's to implement most of its lazy bytestring builders.
-- Executing a bounded encoding should be done using the corresponding
-- functions in the lazy bytestring builder 'Extras' module.
--
-- TODO: Merge with explanation/example below
--
-- Bounded 'E.Encoding's abstract encodings of Haskell values that can be implemented by
-- writing a bounded-size sequence of bytes directly to memory. They are
-- lifted to conversions from Haskell values to 'Builder's by wrapping them
-- with a bound-check. The compiler can implement this bound-check very
-- efficiently (i.e, a single comparison of the difference of two pointers to a
-- constant), because the bound of a 'E.Encoding' is always independent of the
-- value being encoded and, in most cases, a literal constant.
--
-- 'E.Encoding's are the primary means for defining conversion functions from
-- primitive Haskell values to 'Builder's. Most 'Builder' constructors
-- provided by this library are implemented that way.
-- 'E.Encoding's are also used to construct conversions that exploit the internal
-- representation of data-structures.
--
-- For example, 'encodeByteStringWith' works directly on the underlying byte
-- array and uses some tricks to reduce the number of variables in its inner
-- loop. Its efficiency is exploited for implementing the @filter@ and @map@
-- functions in &quot;Data.ByteString.Lazy&quot; as
--
-- &gt; import qualified Codec.Bounded.Encoding as E
-- &gt;
-- &gt; filter :: (Word8 -&gt; Bool) -&gt; ByteString -&gt; ByteString
-- &gt; filter p = toLazyByteString . encodeLazyByteStringWithB write
-- &gt;   where
-- &gt;     write = E.encodeIf p E.word8 E.emptyEncoding
-- &gt;
-- &gt; map :: (Word8 -&gt; Word8) -&gt; ByteString -&gt; ByteString
-- &gt; map f = toLazyByteString . encodeLazyByteStringWithB (E.word8 E.#. f)
--
-- Compared to earlier versions of @filter@ and @map@ on lazy 'L.ByteString's,
-- these versions use a more efficient inner loop and have the additional
-- advantage that they always result in well-chunked 'L.ByteString's; i.e, they
-- also perform automatic defragmentation.
--
-- We can also use 'E.Encoding's to improve the efficiency of the following
-- 'renderString' function from our UTF-8 CSV table encoding example in
-- &quot;Data.ByteString.Builder&quot;.
--
-- &gt; renderString :: String -&gt; Builder
-- &gt; renderString cs = charUtf8 '&quot;' &lt;&gt; foldMap escape cs &lt;&gt; charUtf8 '&quot;'
-- &gt;   where
-- &gt;     escape '\\' = charUtf8 '\\' &lt;&gt; charUtf8 '\\'
-- &gt;     escape '\&quot;' = charUtf8 '\\' &lt;&gt; charUtf8 '\&quot;'
-- &gt;     escape c    = charUtf8 c
--
-- The idea is to save on 'mappend's by implementing a 'E.Encoding' that escapes
-- characters and using 'encodeListWith', which implements writing a list of
-- values with a tighter inner loop and no 'mappend'.
--
-- &gt; import Data.ByteString.Builder.Extra     -- assume these
-- &gt; import Data.ByteString.Builder.Prim      -- imports are present
-- &gt;        ( BoundedPrim, encodeIf, (&lt;#&gt;), (#.) )
-- &gt; import Data.ByteString.Builder.Prim.Utf8 (char)
-- &gt;
-- &gt; renderString :: String -&gt; Builder
-- &gt; renderString cs =
-- &gt;     charUtf8 '&quot;' &lt;&gt; primMapListBounded escapedUtf8 cs &lt;&gt; charUtf8 '&quot;'
-- &gt;   where
-- &gt;     escapedUtf8 :: BoundedPrim Char
-- &gt;     escapedUtf8 =
-- &gt;       encodeIf (== '\\') (char &lt;#&gt; char #. const ('\\', '\\')) $
-- &gt;       encodeIf (== '\&quot;') (char &lt;#&gt; char #. const ('\\', '\&quot;')) $
-- &gt;       char
--
-- This 'Builder' considers a buffer with less than 8 free bytes as full. As
-- all functions are inlined, the compiler is able to optimize the constant
-- 'E.Encoding's as two sequential 'poke's. Compared to the first implementation of
-- 'renderString' this implementation is 1.7x faster.
--
-}</span><span>
</span><span id="line-313"></span><span class="hs-comment">{-
Internally, 'Builder's are buffer-fill operations that are
given a continuation buffer-fill operation and a buffer-range to be filled.
A 'Builder' first checks if the buffer-range is large enough. If that's
the case, the 'Builder' writes the sequences of bytes to the buffer and
calls its continuation.  Otherwise, it returns a signal that it requires a
new buffer together with a continuation to be called on this new buffer.
Ignoring the rare case of a full buffer-range, the execution cost of a
'Builder' consists of three parts:

  1. The time taken to read the parameters; i.e., the buffer-fill
     operation to call after the 'Builder' is done and the buffer-range to
     fill.

  2. The time taken to check for the size of the buffer-range.

  3. The time taken for the actual encoding.

We can reduce cost (1) by ensuring that fewer buffer-fill function calls are
required. We can reduce cost (2) by fusing buffer-size checks of sequential
writes. For example, when escaping a 'String' using 'renderString', it would
be sufficient to check before encoding a character that at least 8 bytes are
free. We can reduce cost (3) by implementing better primitive 'Builder's.
For example, 'renderCell' builds an intermediate list containing the decimal
representation of an 'Int'. Implementing a direct decimal encoding of 'Int's
to memory would be more efficient, as it requires fewer buffer-size checks
and less allocation. It is also a planned extension of this library.

The first two cost reductions are supported for user code through functions
in &quot;Data.ByteString.Builder.Extra&quot;. There, we continue the above example
and drop the generation time to 0.8ms by implementing 'renderString' more
cleverly. The third reduction requires meddling with the internals of
'Builder's and is not recommended in code outside of this library. However,
patches to this library are very welcome.
-}</span><span>
</span><span id="line-348"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.ByteString.Builder.Prim</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Bounded-size primitives</span></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span>    </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#BoundedPrim"><span class="hs-identifier">BoundedPrim</span></a></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Combinators</span></span><span>
</span><span id="line-355"></span><span>  </span><span class="hs-comment">-- | The combinators for 'BoundedPrim's are implemented such that the</span><span>
</span><span id="line-356"></span><span>  </span><span class="hs-comment">-- size of the resulting 'BoundedPrim' can be computed at compile time.</span><span>
</span><span id="line-357"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#emptyB"><span class="hs-identifier">emptyB</span></a></span><span>
</span><span id="line-358"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#%3E%2A%3C"><span class="hs-operator">(&gt;*&lt;)</span></a></span><span>
</span><span id="line-359"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#%3E%24%3C"><span class="hs-operator">(&gt;$&lt;)</span></a></span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#eitherB"><span class="hs-identifier">eitherB</span></a></span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#condB"><span class="hs-identifier">condB</span></a></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Builder construction</span></span><span>
</span><span id="line-364"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primBounded"><span class="hs-identifier">primBounded</span></a></span><span>
</span><span id="line-365"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primMapListBounded"><span class="hs-identifier">primMapListBounded</span></a></span><span>
</span><span id="line-366"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primUnfoldrBounded"><span class="hs-identifier">primUnfoldrBounded</span></a></span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primMapByteStringBounded"><span class="hs-identifier">primMapByteStringBounded</span></a></span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primMapLazyByteStringBounded"><span class="hs-identifier">primMapLazyByteStringBounded</span></a></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Fixed-size primitives</span></span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#FixedPrim"><span class="hs-identifier">FixedPrim</span></a></span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Combinators</span></span><span>
</span><span id="line-375"></span><span>  </span><span class="hs-comment">-- | The combinators for 'FixedPrim's are implemented such that the</span><span>
</span><span id="line-376"></span><span>  </span><span class="hs-comment">-- 'Data.ByteString.Builder.Prim.size'</span><span>
</span><span id="line-377"></span><span>  </span><span class="hs-comment">-- of the resulting 'FixedPrim' is computed at compile time.</span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-379"></span><span>  </span><span class="hs-comment">-- The '(&gt;*&lt;)' and '(&gt;$&lt;)' pairing and mapping operators can be used</span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-comment">-- with 'FixedPrim'.</span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#emptyF"><span class="hs-identifier">emptyF</span></a></span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#liftFixedToBounded"><span class="hs-identifier">liftFixedToBounded</span></a></span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Builder construction</span></span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-comment">-- | In terms of expressivity, the function 'fixedPrim' would be sufficient</span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-comment">-- for constructing 'Builder's from 'FixedPrim's. The fused variants of</span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-comment">-- this function are provided because they allow for more efficient</span><span>
</span><span id="line-388"></span><span>  </span><span class="hs-comment">-- implementations. Our compilers are just not smart enough yet; and for some</span><span>
</span><span id="line-389"></span><span>  </span><span class="hs-comment">-- of the employed optimizations (see the code of 'primMapByteStringFixed')</span><span>
</span><span id="line-390"></span><span>  </span><span class="hs-comment">-- they will very likely never be.</span><span>
</span><span id="line-391"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-392"></span><span>  </span><span class="hs-comment">-- Note that functions marked with \&quot;/Heavy inlining./\&quot; are forced to be</span><span>
</span><span id="line-393"></span><span>  </span><span class="hs-comment">-- inlined because they must be specialized for concrete encodings,</span><span>
</span><span id="line-394"></span><span>  </span><span class="hs-comment">-- but are rather heavy in terms of code size. We recommend to define a</span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-comment">-- top-level function for every concrete instantiation of such a function in</span><span>
</span><span id="line-396"></span><span>  </span><span class="hs-comment">-- order to share its code. A typical example is the function</span><span>
</span><span id="line-397"></span><span>  </span><span class="hs-comment">-- 'Data.ByteString.Builder.byteStringHex' from &quot;Data.ByteString.Builder.ASCII&quot;,</span><span>
</span><span id="line-398"></span><span>  </span><span class="hs-comment">-- which is implemented as follows.</span><span>
</span><span id="line-399"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-400"></span><span>  </span><span class="hs-comment">-- @</span><span>
</span><span id="line-401"></span><span>  </span><span class="hs-comment">-- byteStringHex :: S.ByteString -&gt; Builder</span><span>
</span><span id="line-402"></span><span>  </span><span class="hs-comment">-- byteStringHex = 'primMapByteStringFixed' 'word8HexFixed'</span><span>
</span><span id="line-403"></span><span>  </span><span class="hs-comment">-- @</span><span>
</span><span id="line-404"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-405"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primFixed"><span class="hs-identifier">primFixed</span></a></span><span>
</span><span id="line-406"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primMapListFixed"><span class="hs-identifier">primMapListFixed</span></a></span><span>
</span><span id="line-407"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primUnfoldrFixed"><span class="hs-identifier">primUnfoldrFixed</span></a></span><span>
</span><span id="line-408"></span><span>
</span><span id="line-409"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primMapByteStringFixed"><span class="hs-identifier">primMapByteStringFixed</span></a></span><span>
</span><span id="line-410"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primMapLazyByteStringFixed"><span class="hs-identifier">primMapLazyByteStringFixed</span></a></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Standard encodings of Haskell values</span></span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Binary.html"><span class="hs-identifier">Data.ByteString.Builder.Prim.Binary</span></a></span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Character encodings</span></span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.ASCII.html"><span class="hs-identifier">Data.ByteString.Builder.Prim.ASCII</span></a></span><span>
</span><span id="line-418"></span><span>
</span><span id="line-419"></span><span>  </span><span class="annot"><span class="hs-comment">-- *** ISO/IEC 8859-1 (Char8)</span></span><span>
</span><span id="line-420"></span><span>  </span><span class="hs-comment">-- | The ISO/IEC 8859-1 encoding is an 8-bit encoding often known as Latin-1.</span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-comment">-- The /Char8/ encoding implemented here works by truncating the Unicode</span><span>
</span><span id="line-422"></span><span>  </span><span class="hs-comment">-- codepoint to 8-bits and encoding them as a single byte. For the codepoints</span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-comment">-- 0-255 this corresponds to the ISO/IEC 8859-1 encoding. Note that the</span><span>
</span><span id="line-424"></span><span>  </span><span class="hs-comment">-- Char8 encoding is equivalent to the ASCII encoding on the Unicode</span><span>
</span><span id="line-425"></span><span>  </span><span class="hs-comment">-- codepoints 0-127. Hence, functions such as 'intDec' can also be used for</span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-comment">-- encoding 'Int's as a decimal number with Char8 encoded characters.</span><span>
</span><span id="line-427"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#char8"><span class="hs-identifier">char8</span></a></span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span>  </span><span class="annot"><span class="hs-comment">-- *** UTF-8</span></span><span>
</span><span id="line-430"></span><span>  </span><span class="hs-comment">-- | The UTF-8 encoding can encode all Unicode codepoints.</span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-comment">-- It is equivalent to the ASCII encoding on the Unicode codepoints 0-127.</span><span>
</span><span id="line-432"></span><span>  </span><span class="hs-comment">-- Hence, functions such as 'intDec' can also be used for encoding 'Int's as</span><span>
</span><span id="line-433"></span><span>  </span><span class="hs-comment">-- a decimal number with UTF-8 encoded characters.</span><span>
</span><span id="line-434"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#charUtf8"><span class="hs-identifier">charUtf8</span></a></span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#cstring"><span class="hs-identifier">cstring</span></a></span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#cstringUtf8"><span class="hs-identifier">cstringUtf8</span></a></span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span class="hs-comment">{-
  -- * Testing support
  -- | The following four functions are intended for testing use
  -- only. They are /not/ efficient. Basic encodings are efficiently executed by
  -- creating 'Builder's from them using the @encodeXXX@ functions explained at
  -- the top of this module.

  , evalF
  , evalB

  , showF
  , showB
-}</span><span>
</span><span id="line-452"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html"><span class="hs-identifier">Data.ByteString.Builder.Internal</span></a></span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.ByteString.html"><span class="hs-identifier">Data.ByteString</span></a></span><span>               </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-457"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.ByteString.Internal.html"><span class="hs-identifier">Data.ByteString.Internal</span></a></span><span>      </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-458"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.Internal.html"><span class="hs-identifier">Data.ByteString.Lazy.Internal</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Monoid.html#/Data.Monoid.html"><span class="hs-identifier">Data.Monoid</span></a></span><span>
</span><span id="line-461"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Char.html#/Data.Char.html"><span class="hs-identifier">Data.Char</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Char.html#chr/GHC.Char.html#chr"><span class="hs-identifier">chr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#ord/GHC.Base.html#ord"><span class="hs-identifier">ord</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../base-4.18.2.1/src/Control.Monad.html#/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/Control.Monad.html#%3C%3D%3C/Control.Monad.html#%3C%3D%3C"><span class="hs-operator">(&lt;=&lt;)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Control.Monad.html#unless/Control.Monad.html#unless"><span class="hs-identifier">unless</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html"><span class="hs-identifier">Data.ByteString.Builder.Prim.Internal</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#size"><span class="hs-identifier">size</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#sizeBound"><span class="hs-identifier">sizeBound</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html"><span class="hs-identifier">Data.ByteString.Builder.Prim.Internal</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">I</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#size"><span class="hs-identifier">size</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#sizeBound"><span class="hs-identifier">sizeBound</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Binary.html"><span class="hs-identifier">Data.ByteString.Builder.Prim.Binary</span></a></span><span>
</span><span id="line-467"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.ByteString.Builder.Prim.ASCII.html"><span class="hs-identifier">Data.ByteString.Builder.Prim.ASCII</span></a></span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../base-4.18.2.1/src/Foreign.html#/Foreign.html"><span class="hs-identifier">Foreign</span></a></span><span>
</span><span id="line-470"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../base-4.18.2.1/src/Foreign.C.Types.html#/Foreign.C.Types.html"><span class="hs-identifier">Foreign.C.Types</span></a></span><span>
</span><span id="line-471"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../base-4.18.2.1/src/Foreign.ForeignPtr.Unsafe.html#/Foreign.ForeignPtr.Unsafe.html"><span class="hs-identifier">Foreign.ForeignPtr.Unsafe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.ForeignPtr.html#unsafeForeignPtrToPtr/GHC.ForeignPtr.html#unsafeForeignPtrToPtr"><span class="hs-identifier">unsafeForeignPtrToPtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#/GHC.Word.html"><span class="hs-identifier">GHC.Word</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word8/GHC.Word.html#Word8"><span class="hs-identifier">Word8</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-473"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Exts.html#/GHC.Exts.html"><span class="hs-identifier">GHC.Exts</span></a></span><span>
</span><span id="line-474"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#/GHC.IO.html"><span class="hs-identifier">GHC.IO</span></a></span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-477"></span><span class="hs-comment">-- Creating Builders from bounded primitives</span><span>
</span><span id="line-478"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-479"></span><span>
</span><span id="line-480"></span><span class="annot"><span class="hs-comment">-- | Encode a value with a 'FixedPrim'.</span></span><span>
</span><span id="line-481"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primFixed"><span class="hs-pragma hs-type">primFixed</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-482"></span><span id="local-6989586621679106623"><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primFixed"><span class="hs-identifier hs-type">primFixed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#FixedPrim"><span class="hs-identifier hs-type">FixedPrim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106623"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679106623"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#Builder"><span class="hs-identifier hs-type">Builder</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-483"></span><span id="primFixed"><span class="annot"><span class="annottext">primFixed :: forall a. FixedPrim a -&gt; a -&gt; Builder
</span><a href="Data.ByteString.Builder.Prim.html#primFixed"><span class="hs-identifier hs-var hs-var">primFixed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BoundedPrim a -&gt; a -&gt; Builder
forall a. BoundedPrim a -&gt; a -&gt; Builder
</span><a href="Data.ByteString.Builder.Prim.html#primBounded"><span class="hs-identifier hs-var">primBounded</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundedPrim a -&gt; a -&gt; Builder)
-&gt; (FixedPrim a -&gt; BoundedPrim a) -&gt; FixedPrim a -&gt; a -&gt; Builder
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">FixedPrim a -&gt; BoundedPrim a
forall a. FixedPrim a -&gt; BoundedPrim a
</span><a href="Data.ByteString.Builder.Prim.Internal.html#toB"><span class="hs-identifier hs-var">toB</span></a></span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span class="annot"><span class="hs-comment">-- | Encode a list of values from left-to-right with a 'FixedPrim'.</span></span><span>
</span><span id="line-486"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primMapListFixed"><span class="hs-pragma hs-type">primMapListFixed</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-487"></span><span id="local-6989586621679106631"><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primMapListFixed"><span class="hs-identifier hs-type">primMapListFixed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#FixedPrim"><span class="hs-identifier hs-type">FixedPrim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106631"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679106631"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#Builder"><span class="hs-identifier hs-type">Builder</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-488"></span><span id="primMapListFixed"><span class="annot"><span class="annottext">primMapListFixed :: forall a. FixedPrim a -&gt; [a] -&gt; Builder
</span><a href="Data.ByteString.Builder.Prim.html#primMapListFixed"><span class="hs-identifier hs-var hs-var">primMapListFixed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BoundedPrim a -&gt; [a] -&gt; Builder
forall a. BoundedPrim a -&gt; [a] -&gt; Builder
</span><a href="Data.ByteString.Builder.Prim.html#primMapListBounded"><span class="hs-identifier hs-var">primMapListBounded</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundedPrim a -&gt; [a] -&gt; Builder)
-&gt; (FixedPrim a -&gt; BoundedPrim a) -&gt; FixedPrim a -&gt; [a] -&gt; Builder
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">FixedPrim a -&gt; BoundedPrim a
forall a. FixedPrim a -&gt; BoundedPrim a
</span><a href="Data.ByteString.Builder.Prim.Internal.html#toB"><span class="hs-identifier hs-var">toB</span></a></span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span class="annot"><span class="hs-comment">-- | Encode a list of values represented as an 'Data.List.unfoldr' with a 'FixedPrim'.</span></span><span>
</span><span id="line-491"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primUnfoldrFixed"><span class="hs-pragma hs-type">primUnfoldrFixed</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-492"></span><span id="local-6989586621679106634"><span id="local-6989586621679106635"><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primUnfoldrFixed"><span class="hs-identifier hs-type">primUnfoldrFixed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#FixedPrim"><span class="hs-identifier hs-type">FixedPrim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106634"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679106635"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679106634"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679106635"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679106635"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#Builder"><span class="hs-identifier hs-type">Builder</span></a></span></span></span><span>
</span><span id="line-493"></span><span id="primUnfoldrFixed"><span class="annot"><span class="annottext">primUnfoldrFixed :: forall b a. FixedPrim b -&gt; (a -&gt; Maybe (b, a)) -&gt; a -&gt; Builder
</span><a href="Data.ByteString.Builder.Prim.html#primUnfoldrFixed"><span class="hs-identifier hs-var hs-var">primUnfoldrFixed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BoundedPrim b -&gt; (a -&gt; Maybe (b, a)) -&gt; a -&gt; Builder
forall b a. BoundedPrim b -&gt; (a -&gt; Maybe (b, a)) -&gt; a -&gt; Builder
</span><a href="Data.ByteString.Builder.Prim.html#primUnfoldrBounded"><span class="hs-identifier hs-var">primUnfoldrBounded</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundedPrim b -&gt; (a -&gt; Maybe (b, a)) -&gt; a -&gt; Builder)
-&gt; (FixedPrim b -&gt; BoundedPrim b)
-&gt; FixedPrim b
-&gt; (a -&gt; Maybe (b, a))
-&gt; a
-&gt; Builder
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">FixedPrim b -&gt; BoundedPrim b
forall a. FixedPrim a -&gt; BoundedPrim a
</span><a href="Data.ByteString.Builder.Prim.Internal.html#toB"><span class="hs-identifier hs-var">toB</span></a></span><span>
</span><span id="line-494"></span><span>
</span><span id="line-495"></span><span class="hs-comment">-- | /Heavy inlining./ Encode all bytes of a strict 'S.ByteString' from</span><span>
</span><span id="line-496"></span><span class="hs-comment">-- left-to-right with a 'FixedPrim'. This function is quite versatile. For</span><span>
</span><span id="line-497"></span><span class="hs-comment">-- example, we can use it to construct a 'Builder' that maps every byte before</span><span>
</span><span id="line-498"></span><span class="hs-comment">-- copying it to the buffer to be filled.</span><span>
</span><span id="line-499"></span><span class="hs-comment">--</span><span>
</span><span id="line-500"></span><span class="hs-comment">-- &gt; mapToBuilder :: (Word8 -&gt; Word8) -&gt; S.ByteString -&gt; Builder</span><span>
</span><span id="line-501"></span><span class="hs-comment">-- &gt; mapToBuilder f = primMapByteStringFixed (contramapF f word8)</span><span>
</span><span id="line-502"></span><span class="hs-comment">--</span><span>
</span><span id="line-503"></span><span class="hs-comment">-- We can also use it to hex-encode a strict 'S.ByteString' as shown by the</span><span>
</span><span id="line-504"></span><span class="hs-comment">-- 'Data.ByteString.Builder.ASCII.byteStringHex' example above.</span><span>
</span><span id="line-505"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primMapByteStringFixed"><span class="hs-pragma hs-type">primMapByteStringFixed</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-506"></span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primMapByteStringFixed"><span class="hs-identifier hs-type">primMapByteStringFixed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#FixedPrim"><span class="hs-identifier hs-type">FixedPrim</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word8/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#Builder"><span class="hs-identifier hs-type">Builder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span id="primMapByteStringFixed"><span class="annot"><span class="annottext">primMapByteStringFixed :: FixedPrim Word8 -&gt; ByteString -&gt; Builder
</span><a href="Data.ByteString.Builder.Prim.html#primMapByteStringFixed"><span class="hs-identifier hs-var hs-var">primMapByteStringFixed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BoundedPrim Word8 -&gt; ByteString -&gt; Builder
</span><a href="Data.ByteString.Builder.Prim.html#primMapByteStringBounded"><span class="hs-identifier hs-var">primMapByteStringBounded</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundedPrim Word8 -&gt; ByteString -&gt; Builder)
-&gt; (FixedPrim Word8 -&gt; BoundedPrim Word8)
-&gt; FixedPrim Word8
-&gt; ByteString
-&gt; Builder
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">FixedPrim Word8 -&gt; BoundedPrim Word8
forall a. FixedPrim a -&gt; BoundedPrim a
</span><a href="Data.ByteString.Builder.Prim.Internal.html#toB"><span class="hs-identifier hs-var">toB</span></a></span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span class="hs-comment">-- | /Heavy inlining./ Encode all bytes of a lazy 'L.ByteString' from</span><span>
</span><span id="line-510"></span><span class="hs-comment">-- left-to-right with a 'FixedPrim'.</span><span>
</span><span id="line-511"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primMapLazyByteStringFixed"><span class="hs-pragma hs-type">primMapLazyByteStringFixed</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-512"></span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primMapLazyByteStringFixed"><span class="hs-identifier hs-type">primMapLazyByteStringFixed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#FixedPrim"><span class="hs-identifier hs-type">FixedPrim</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word8/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">L.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#Builder"><span class="hs-identifier hs-type">Builder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span id="primMapLazyByteStringFixed"><span class="annot"><span class="annottext">primMapLazyByteStringFixed :: FixedPrim Word8 -&gt; ByteString -&gt; Builder
</span><a href="Data.ByteString.Builder.Prim.html#primMapLazyByteStringFixed"><span class="hs-identifier hs-var hs-var">primMapLazyByteStringFixed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BoundedPrim Word8 -&gt; ByteString -&gt; Builder
</span><a href="Data.ByteString.Builder.Prim.html#primMapLazyByteStringBounded"><span class="hs-identifier hs-var">primMapLazyByteStringBounded</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundedPrim Word8 -&gt; ByteString -&gt; Builder)
-&gt; (FixedPrim Word8 -&gt; BoundedPrim Word8)
-&gt; FixedPrim Word8
-&gt; ByteString
-&gt; Builder
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">FixedPrim Word8 -&gt; BoundedPrim Word8
forall a. FixedPrim a -&gt; BoundedPrim a
</span><a href="Data.ByteString.Builder.Prim.Internal.html#toB"><span class="hs-identifier hs-var">toB</span></a></span><span>
</span><span id="line-514"></span><span>
</span><span id="line-515"></span><span class="hs-comment">-- IMPLEMENTATION NOTE: Sadly, 'encodeListWith' cannot be used for foldr/build</span><span>
</span><span id="line-516"></span><span class="hs-comment">-- fusion. Its performance relies on hoisting several variables out of the</span><span>
</span><span id="line-517"></span><span class="hs-comment">-- inner loop.  That's not possible when writing 'encodeListWith' as a 'foldr'.</span><span>
</span><span id="line-518"></span><span class="hs-comment">-- If we had stream fusion for lists, then we could fuse 'encodeListWith', as</span><span>
</span><span id="line-519"></span><span class="hs-comment">-- 'encodeWithStream' can keep control over the execution.</span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span class="hs-comment">-- | Create a 'Builder' that encodes values with the given 'BoundedPrim'.</span><span>
</span><span id="line-523"></span><span class="hs-comment">--</span><span>
</span><span id="line-524"></span><span class="hs-comment">-- We rewrite consecutive uses of 'primBounded' such that the bound-checks are</span><span>
</span><span id="line-525"></span><span class="hs-comment">-- fused. For example,</span><span>
</span><span id="line-526"></span><span class="hs-comment">--</span><span>
</span><span id="line-527"></span><span class="hs-comment">-- &gt; primBounded (word32 c1) `mappend` primBounded (word32 c2)</span><span>
</span><span id="line-528"></span><span class="hs-comment">--</span><span>
</span><span id="line-529"></span><span class="hs-comment">-- is rewritten such that the resulting 'Builder' checks only once, if ther are</span><span>
</span><span id="line-530"></span><span class="hs-comment">-- at 8 free bytes, instead of checking twice, if there are 4 free bytes. This</span><span>
</span><span id="line-531"></span><span class="hs-comment">-- optimization is not observationally equivalent in a strict sense, as it</span><span>
</span><span id="line-532"></span><span class="hs-comment">-- influences the boundaries of the generated chunks. However, for a user of</span><span>
</span><span id="line-533"></span><span class="hs-comment">-- this library it is observationally equivalent, as chunk boundaries of a lazy</span><span>
</span><span id="line-534"></span><span class="hs-comment">-- 'L.ByteString' can only be observed through the internal interface.</span><span>
</span><span id="line-535"></span><span class="hs-comment">-- Moreover, we expect that all primitives write much fewer than 4kb (the</span><span>
</span><span id="line-536"></span><span class="hs-comment">-- default short buffer size). Hence, it is safe to ignore the additional</span><span>
</span><span id="line-537"></span><span class="hs-comment">-- memory spilled due to the more aggressive buffer wrapping introduced by this</span><span>
</span><span id="line-538"></span><span class="hs-comment">-- optimization.</span><span>
</span><span id="line-539"></span><span class="hs-comment">--</span><span>
</span><span id="line-540"></span><span class="hs-pragma">{-# INLINE</span><span class="hs-pragma">[</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primBounded"><span class="hs-pragma hs-type">primBounded</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-541"></span><span id="local-6989586621679106626"><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primBounded"><span class="hs-identifier hs-type">primBounded</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#BoundedPrim"><span class="hs-identifier hs-type">BoundedPrim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106626"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679106626"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#Builder"><span class="hs-identifier hs-type">Builder</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-542"></span><span id="primBounded"><span class="annot"><span class="annottext">primBounded :: forall a. BoundedPrim a -&gt; a -&gt; Builder
</span><a href="Data.ByteString.Builder.Prim.html#primBounded"><span class="hs-identifier hs-var hs-var">primBounded</span></a></span></span><span> </span><span id="local-6989586621679106784"><span class="annot"><span class="annottext">BoundedPrim a
</span><a href="#local-6989586621679106784"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621679106785"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106785"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-543"></span><span>    </span><span class="hs-comment">-- It is important to avoid recursive 'BuildStep's where possible, as</span><span>
</span><span id="line-544"></span><span>    </span><span class="hs-comment">-- their closure allocation is expensive. Using 'ensureFree' allows the</span><span>
</span><span id="line-545"></span><span>    </span><span class="hs-comment">-- 'step' to assume that at least 'sizeBound w' free space is available.</span><span>
</span><span id="line-546"></span><span>    </span><span class="annot"><span class="annottext">Int -&gt; Builder
</span><a href="Data.ByteString.Builder.Internal.html#ensureFree"><span class="hs-identifier hs-var">ensureFree</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BoundedPrim a -&gt; Int
forall a. BoundedPrim a -&gt; Int
</span><a href="Data.ByteString.Builder.Prim.Internal.html#sizeBound"><span class="hs-identifier hs-var">I.sizeBound</span></a></span><span> </span><span class="annot"><span class="annottext">BoundedPrim a
</span><a href="#local-6989586621679106784"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#mappend/GHC.Base.html#mappend"><span class="hs-operator hs-var">`mappend`</span></a></span><span> </span><span class="annot"><span class="annottext">(forall r. BuildStep r -&gt; BuildStep r) -&gt; Builder
</span><a href="Data.ByteString.Builder.Internal.html#builder"><span class="hs-identifier hs-var">builder</span></a></span><span> </span><span class="annot"><span class="annottext">(BufferRange -&gt; IO (BuildSignal r))
-&gt; BufferRange -&gt; IO (BuildSignal r)
forall {b}. (BufferRange -&gt; IO b) -&gt; BufferRange -&gt; IO b
forall r. BuildStep r -&gt; BuildStep r
</span><a href="#local-6989586621679106788"><span class="hs-identifier hs-var">step</span></a></span><span>
</span><span id="line-547"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-548"></span><span>    </span><span id="local-6989586621679106788"><span class="annot"><span class="annottext">step :: (BufferRange -&gt; IO b) -&gt; BufferRange -&gt; IO b
</span><a href="#local-6989586621679106788"><span class="hs-identifier hs-var hs-var">step</span></a></span></span><span> </span><span id="local-6989586621679106791"><span class="annot"><span class="annottext">BufferRange -&gt; IO b
</span><a href="#local-6989586621679106791"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#BufferRange"><span class="hs-identifier hs-type">BufferRange</span></a></span><span> </span><span id="local-6989586621679106793"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106793"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679106794"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106794"><span class="hs-identifier hs-var">ope</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-549"></span><span>        </span><span id="local-6989586621679106795"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106795"><span class="hs-identifier hs-var">op'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BoundedPrim a -&gt; a -&gt; Ptr Word8 -&gt; IO (Ptr Word8)
forall a. BoundedPrim a -&gt; a -&gt; Ptr Word8 -&gt; IO (Ptr Word8)
</span><a href="Data.ByteString.Builder.Prim.Internal.html#runB"><span class="hs-identifier hs-var">runB</span></a></span><span> </span><span class="annot"><span class="annottext">BoundedPrim a
</span><a href="#local-6989586621679106784"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106785"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106793"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-550"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679106797"><span class="annot"><span class="annottext">br' :: BufferRange
</span><a href="#local-6989586621679106797"><span class="hs-identifier hs-var hs-var">br'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Ptr Word8 -&gt; BufferRange
</span><a href="Data.ByteString.Builder.Internal.html#BufferRange"><span class="hs-identifier hs-var">BufferRange</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106795"><span class="hs-identifier hs-var">op'</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106794"><span class="hs-identifier hs-var">ope</span></a></span><span>
</span><span id="line-551"></span><span>        </span><span class="annot"><span class="annottext">BufferRange -&gt; IO b
</span><a href="#local-6989586621679106791"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">BufferRange
</span><a href="#local-6989586621679106797"><span class="hs-identifier hs-var">br'</span></a></span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span class="hs-pragma">{-# RULES</span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span class="annot"><span class="hs-pragma">&quot;append/primBounded&quot;</span></span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621679106798"><span class="annot"><a href="#local-6989586621679106798"><span class="hs-pragma hs-var">w1</span></a></span></span><span> </span><span id="local-6989586621679106799"><span class="annot"><a href="#local-6989586621679106799"><span class="hs-pragma hs-var">w2</span></a></span></span><span> </span><span id="local-6989586621679106800"><span class="annot"><a href="#local-6989586621679106800"><span class="hs-pragma hs-var">x1</span></a></span></span><span> </span><span id="local-6989586621679106801"><span class="annot"><a href="#local-6989586621679106801"><span class="hs-pragma hs-var">x2</span></a></span></span><span class="hs-pragma">.</span><span>
</span><span id="line-556"></span><span>       </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#append"><span class="hs-pragma hs-type">append</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primBounded"><span class="hs-pragma hs-type">primBounded</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106798"><span class="hs-pragma hs-type">w1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106800"><span class="hs-pragma hs-type">x1</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primBounded"><span class="hs-pragma hs-type">primBounded</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106799"><span class="hs-pragma hs-type">w2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106801"><span class="hs-pragma hs-type">x2</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-557"></span><span>     </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primBounded"><span class="hs-pragma hs-type">primBounded</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#pairB"><span class="hs-pragma hs-type">pairB</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106798"><span class="hs-pragma hs-type">w1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106799"><span class="hs-pragma hs-type">w2</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621679106800"><span class="hs-pragma hs-type">x1</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="#local-6989586621679106801"><span class="hs-pragma hs-type">x2</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-558"></span><span>
</span><span id="line-559"></span><span class="annot"><span class="hs-pragma">&quot;append/primBounded/assoc_r&quot;</span></span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621679106804"><span class="annot"><a href="#local-6989586621679106804"><span class="hs-pragma hs-var">w1</span></a></span></span><span> </span><span id="local-6989586621679106805"><span class="annot"><a href="#local-6989586621679106805"><span class="hs-pragma hs-var">w2</span></a></span></span><span> </span><span id="local-6989586621679106806"><span class="annot"><a href="#local-6989586621679106806"><span class="hs-pragma hs-var">x1</span></a></span></span><span> </span><span id="local-6989586621679106807"><span class="annot"><a href="#local-6989586621679106807"><span class="hs-pragma hs-var">x2</span></a></span></span><span> </span><span id="local-6989586621679106808"><span class="annot"><a href="#local-6989586621679106808"><span class="hs-pragma hs-var">b</span></a></span></span><span class="hs-pragma">.</span><span>
</span><span id="line-560"></span><span>       </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#append"><span class="hs-pragma hs-type">append</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primBounded"><span class="hs-pragma hs-type">primBounded</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106804"><span class="hs-pragma hs-type">w1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106806"><span class="hs-pragma hs-type">x1</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#append"><span class="hs-pragma hs-type">append</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primBounded"><span class="hs-pragma hs-type">primBounded</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106805"><span class="hs-pragma hs-type">w2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106807"><span class="hs-pragma hs-type">x2</span></a></span><span class="hs-pragma">)</span><span> </span><span class="annot"><a href="#local-6989586621679106808"><span class="hs-pragma hs-type">b</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-561"></span><span>     </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#append"><span class="hs-pragma hs-type">append</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primBounded"><span class="hs-pragma hs-type">primBounded</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#pairB"><span class="hs-pragma hs-type">pairB</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106804"><span class="hs-pragma hs-type">w1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106805"><span class="hs-pragma hs-type">w2</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621679106806"><span class="hs-pragma hs-type">x1</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="#local-6989586621679106807"><span class="hs-pragma hs-type">x2</span></a></span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="annot"><a href="#local-6989586621679106808"><span class="hs-pragma hs-type">b</span></a></span><span>
</span><span id="line-562"></span><span>
</span><span id="line-563"></span><span class="annot"><span class="hs-pragma">&quot;append/primBounded/assoc_l&quot;</span></span><span> </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621679106809"><span class="annot"><a href="#local-6989586621679106809"><span class="hs-pragma hs-var">w1</span></a></span></span><span> </span><span id="local-6989586621679106810"><span class="annot"><a href="#local-6989586621679106810"><span class="hs-pragma hs-var">w2</span></a></span></span><span> </span><span id="local-6989586621679106811"><span class="annot"><a href="#local-6989586621679106811"><span class="hs-pragma hs-var">x1</span></a></span></span><span> </span><span id="local-6989586621679106812"><span class="annot"><a href="#local-6989586621679106812"><span class="hs-pragma hs-var">x2</span></a></span></span><span> </span><span id="local-6989586621679106813"><span class="annot"><a href="#local-6989586621679106813"><span class="hs-pragma hs-var">b</span></a></span></span><span class="hs-pragma">.</span><span>
</span><span id="line-564"></span><span>       </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#append"><span class="hs-pragma hs-type">append</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#append"><span class="hs-pragma hs-type">append</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106813"><span class="hs-pragma hs-type">b</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primBounded"><span class="hs-pragma hs-type">primBounded</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106809"><span class="hs-pragma hs-type">w1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106811"><span class="hs-pragma hs-type">x1</span></a></span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primBounded"><span class="hs-pragma hs-type">primBounded</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106810"><span class="hs-pragma hs-type">w2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106812"><span class="hs-pragma hs-type">x2</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-565"></span><span>     </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#append"><span class="hs-pragma hs-type">append</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106813"><span class="hs-pragma hs-type">b</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primBounded"><span class="hs-pragma hs-type">primBounded</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#pairB"><span class="hs-pragma hs-type">pairB</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106809"><span class="hs-pragma hs-type">w1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106810"><span class="hs-pragma hs-type">w2</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621679106811"><span class="hs-pragma hs-type">x1</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="#local-6989586621679106812"><span class="hs-pragma hs-type">x2</span></a></span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span>
</span><span id="line-566"></span><span>  </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-567"></span><span>
</span><span id="line-568"></span><span class="hs-comment">-- TODO: The same rules for 'putBuilder (..) &gt;&gt; putBuilder (..)'</span><span>
</span><span id="line-569"></span><span>
</span><span id="line-570"></span><span class="hs-comment">-- | Create a 'Builder' that encodes a list of values consecutively using a</span><span>
</span><span id="line-571"></span><span class="hs-comment">-- 'BoundedPrim' for each element. This function is more efficient than</span><span>
</span><span id="line-572"></span><span class="hs-comment">--</span><span>
</span><span id="line-573"></span><span class="hs-comment">-- &gt; mconcat . map (primBounded w)</span><span>
</span><span id="line-574"></span><span class="hs-comment">--</span><span>
</span><span id="line-575"></span><span class="hs-comment">-- or</span><span>
</span><span id="line-576"></span><span class="hs-comment">--</span><span>
</span><span id="line-577"></span><span class="hs-comment">-- &gt; foldMap (primBounded w)</span><span>
</span><span id="line-578"></span><span class="hs-comment">--</span><span>
</span><span id="line-579"></span><span class="hs-comment">-- because it moves several variables out of the inner loop.</span><span>
</span><span id="line-580"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primMapListBounded"><span class="hs-pragma hs-type">primMapListBounded</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-581"></span><span id="local-6989586621679106633"><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primMapListBounded"><span class="hs-identifier hs-type">primMapListBounded</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#BoundedPrim"><span class="hs-identifier hs-type">BoundedPrim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106633"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679106633"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#Builder"><span class="hs-identifier hs-type">Builder</span></a></span></span><span>
</span><span id="line-582"></span><span id="primMapListBounded"><span class="annot"><span class="annottext">primMapListBounded :: forall a. BoundedPrim a -&gt; [a] -&gt; Builder
</span><a href="Data.ByteString.Builder.Prim.html#primMapListBounded"><span class="hs-identifier hs-var hs-var">primMapListBounded</span></a></span></span><span> </span><span id="local-6989586621679106814"><span class="annot"><span class="annottext">BoundedPrim a
</span><a href="#local-6989586621679106814"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621679106815"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679106815"><span class="hs-identifier hs-var">xs0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-583"></span><span>    </span><span class="annot"><span class="annottext">(forall r. BuildStep r -&gt; BuildStep r) -&gt; Builder
</span><a href="Data.ByteString.Builder.Internal.html#builder"><span class="hs-identifier hs-var">builder</span></a></span><span> </span><span class="annot"><span class="annottext">((forall r. BuildStep r -&gt; BuildStep r) -&gt; Builder)
-&gt; (forall r. BuildStep r -&gt; BuildStep r) -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
-&gt; (BufferRange -&gt; IO (BuildSignal r))
-&gt; BufferRange
-&gt; IO (BuildSignal r)
forall {a}.
[a]
-&gt; (BufferRange -&gt; IO (BuildSignal a))
-&gt; BufferRange
-&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106816"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679106815"><span class="hs-identifier hs-var">xs0</span></a></span><span>
</span><span id="line-584"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-585"></span><span>    </span><span id="local-6989586621679106816"><span class="annot"><span class="annottext">step :: [a]
-&gt; (BufferRange -&gt; IO (BuildSignal a))
-&gt; BufferRange
-&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106816"><span class="hs-identifier hs-var hs-var">step</span></a></span></span><span> </span><span id="local-6989586621679106817"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679106817"><span class="hs-identifier hs-var">xs1</span></a></span></span><span> </span><span id="local-6989586621679106818"><span class="annot"><span class="annottext">BufferRange -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106818"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#BufferRange"><span class="hs-identifier hs-type">BufferRange</span></a></span><span> </span><span id="local-6989586621679106819"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106819"><span class="hs-identifier hs-var">op0</span></a></span></span><span> </span><span id="local-6989586621679106820"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106820"><span class="hs-identifier hs-var">ope0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-586"></span><span>        </span><span class="annot"><span class="annottext">[a] -&gt; Ptr Word8 -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106821"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679106817"><span class="hs-identifier hs-var">xs1</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106819"><span class="hs-identifier hs-var">op0</span></a></span><span>
</span><span id="line-587"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-588"></span><span>        </span><span id="local-6989586621679106821"><span class="annot"><span class="annottext">go :: [a] -&gt; Ptr Word8 -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106821"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>          </span><span class="hs-glyph">!</span><span id="local-6989586621679106826"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106826"><span class="hs-identifier hs-var">op</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BufferRange -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106818"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Ptr Word8 -&gt; BufferRange
</span><a href="Data.ByteString.Builder.Internal.html#BufferRange"><span class="hs-identifier hs-var">BufferRange</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106826"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106820"><span class="hs-identifier hs-var">ope0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-589"></span><span>        </span><span class="annot"><a href="#local-6989586621679106821"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679106827"><span class="annot"><span class="annottext">xs :: [a]
</span><a href="#local-6989586621679106827"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679106828"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106828"><span class="hs-identifier hs-var">x'</span></a></span></span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#%3A/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621679106829"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679106829"><span class="hs-identifier hs-var">xs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679106830"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106830"><span class="hs-identifier hs-var">op</span></a></span></span><span>
</span><span id="line-590"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106830"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Ptr Word8
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><a href="../../base-4.18.2.1/src/GHC.Ptr.html#plusPtr/GHC.Ptr.html#plusPtr"><span class="hs-operator hs-var">`plusPtr`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679106832"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Ptr Word8 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106820"><span class="hs-identifier hs-var">ope0</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BoundedPrim a -&gt; a -&gt; Ptr Word8 -&gt; IO (Ptr Word8)
forall a. BoundedPrim a -&gt; a -&gt; Ptr Word8 -&gt; IO (Ptr Word8)
</span><a href="Data.ByteString.Builder.Prim.Internal.html#runB"><span class="hs-identifier hs-var">runB</span></a></span><span> </span><span class="annot"><span class="annottext">BoundedPrim a
</span><a href="#local-6989586621679106814"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106828"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106830"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Ptr Word8)
-&gt; (Ptr Word8 -&gt; IO (BuildSignal a)) -&gt; IO (BuildSignal a)
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3E%3E%3D/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Ptr Word8 -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106821"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679106829"><span class="hs-identifier hs-var">xs'</span></a></span><span>
</span><span id="line-591"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                  </span><span class="hs-glyph">=</span><span>
</span><span id="line-592"></span><span>             </span><span class="annot"><span class="annottext">BuildSignal a -&gt; IO (BuildSignal a)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(BuildSignal a -&gt; IO (BuildSignal a))
-&gt; BuildSignal a -&gt; IO (BuildSignal a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Ptr Word8
-&gt; (BufferRange -&gt; IO (BuildSignal a))
-&gt; BuildSignal a
forall a. Int -&gt; Ptr Word8 -&gt; BuildStep a -&gt; BuildSignal a
</span><a href="Data.ByteString.Builder.Internal.html#bufferFull"><span class="hs-identifier hs-var">bufferFull</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679106832"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106830"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
-&gt; (BufferRange -&gt; IO (BuildSignal a))
-&gt; BufferRange
-&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106816"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679106827"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">BufferRange -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106818"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span>
</span><span id="line-594"></span><span>    </span><span id="local-6989586621679106832"><span class="annot"><span class="annottext">bound :: Int
</span><a href="#local-6989586621679106832"><span class="hs-identifier hs-var hs-var">bound</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BoundedPrim a -&gt; Int
forall a. BoundedPrim a -&gt; Int
</span><a href="Data.ByteString.Builder.Prim.Internal.html#sizeBound"><span class="hs-identifier hs-var">I.sizeBound</span></a></span><span> </span><span class="annot"><span class="annottext">BoundedPrim a
</span><a href="#local-6989586621679106814"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span class="hs-comment">-- TODO: Add 'foldMap/encodeWith' its variants</span><span>
</span><span id="line-597"></span><span class="hs-comment">-- TODO: Ensure rewriting 'primBounded w . f = primBounded (w #. f)'</span><span>
</span><span id="line-598"></span><span>
</span><span id="line-599"></span><span class="hs-comment">-- | Create a 'Builder' that encodes a sequence generated from a seed value</span><span>
</span><span id="line-600"></span><span class="hs-comment">-- using a 'BoundedPrim' for each sequence element.</span><span>
</span><span id="line-601"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primUnfoldrBounded"><span class="hs-pragma hs-type">primUnfoldrBounded</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-602"></span><span id="local-6989586621679106638"><span id="local-6989586621679106639"><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primUnfoldrBounded"><span class="hs-identifier hs-type">primUnfoldrBounded</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#BoundedPrim"><span class="hs-identifier hs-type">BoundedPrim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106638"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679106639"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679106638"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679106639"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679106639"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#Builder"><span class="hs-identifier hs-type">Builder</span></a></span></span></span><span>
</span><span id="line-603"></span><span id="primUnfoldrBounded"><span class="annot"><span class="annottext">primUnfoldrBounded :: forall b a. BoundedPrim b -&gt; (a -&gt; Maybe (b, a)) -&gt; a -&gt; Builder
</span><a href="Data.ByteString.Builder.Prim.html#primUnfoldrBounded"><span class="hs-identifier hs-var hs-var">primUnfoldrBounded</span></a></span></span><span> </span><span id="local-6989586621679106835"><span class="annot"><span class="annottext">BoundedPrim b
</span><a href="#local-6989586621679106835"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621679106836"><span class="annot"><span class="annottext">a -&gt; Maybe (b, a)
</span><a href="#local-6989586621679106836"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679106837"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106837"><span class="hs-identifier hs-var">x0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-604"></span><span>    </span><span class="annot"><span class="annottext">(forall r. BuildStep r -&gt; BuildStep r) -&gt; Builder
</span><a href="Data.ByteString.Builder.Internal.html#builder"><span class="hs-identifier hs-var">builder</span></a></span><span> </span><span class="annot"><span class="annottext">((forall r. BuildStep r -&gt; BuildStep r) -&gt; Builder)
-&gt; (forall r. BuildStep r -&gt; BuildStep r) -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">a
-&gt; (BufferRange -&gt; IO (BuildSignal r))
-&gt; BufferRange
-&gt; IO (BuildSignal r)
forall {a}.
a
-&gt; (BufferRange -&gt; IO (BuildSignal a))
-&gt; BufferRange
-&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106838"><span class="hs-identifier hs-var">fillWith</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106837"><span class="hs-identifier hs-var">x0</span></a></span><span>
</span><span id="line-605"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-606"></span><span>    </span><span id="local-6989586621679106838"><span class="annot"><span class="annottext">fillWith :: a
-&gt; (BufferRange -&gt; IO (BuildSignal a))
-&gt; BufferRange
-&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106838"><span class="hs-identifier hs-var hs-var">fillWith</span></a></span></span><span> </span><span id="local-6989586621679106839"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106839"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679106840"><span class="annot"><span class="annottext">BufferRange -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106840"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#BufferRange"><span class="hs-identifier hs-type">BufferRange</span></a></span><span> </span><span id="local-6989586621679106841"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106841"><span class="hs-identifier hs-var">op0</span></a></span></span><span> </span><span id="local-6989586621679106842"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106842"><span class="hs-identifier hs-var">ope0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-607"></span><span>        </span><span class="annot"><span class="annottext">Maybe (b, a) -&gt; Ptr Word8 -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106843"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe (b, a)
</span><a href="#local-6989586621679106836"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106839"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106841"><span class="hs-identifier hs-var">op0</span></a></span><span>
</span><span id="line-608"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-609"></span><span>        </span><span id="local-6989586621679106843"><span class="annot"><span class="annottext">go :: Maybe (b, a) -&gt; Ptr Word8 -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106843"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (b, a)
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679106848"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106848"><span class="hs-identifier hs-var">op</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BufferRange -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106840"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Ptr Word8 -&gt; BufferRange
</span><a href="Data.ByteString.Builder.Internal.html#BufferRange"><span class="hs-identifier hs-var">BufferRange</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106848"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106842"><span class="hs-identifier hs-var">ope0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-610"></span><span>        </span><span class="annot"><a href="#local-6989586621679106843"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679106849"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679106849"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679106850"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106850"><span class="hs-identifier hs-var">x'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679106851"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106851"><span class="hs-identifier hs-var">op</span></a></span></span><span>
</span><span id="line-611"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106851"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Ptr Word8
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><a href="../../base-4.18.2.1/src/GHC.Ptr.html#plusPtr/GHC.Ptr.html#plusPtr"><span class="hs-operator hs-var">`plusPtr`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679106852"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Ptr Word8 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106842"><span class="hs-identifier hs-var">ope0</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BoundedPrim b -&gt; b -&gt; Ptr Word8 -&gt; IO (Ptr Word8)
forall a. BoundedPrim a -&gt; a -&gt; Ptr Word8 -&gt; IO (Ptr Word8)
</span><a href="Data.ByteString.Builder.Prim.Internal.html#runB"><span class="hs-identifier hs-var">runB</span></a></span><span> </span><span class="annot"><span class="annottext">BoundedPrim b
</span><a href="#local-6989586621679106835"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679106849"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106851"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Ptr Word8)
-&gt; (Ptr Word8 -&gt; IO (BuildSignal a)) -&gt; IO (BuildSignal a)
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3E%3E%3D/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (b, a) -&gt; Ptr Word8 -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106843"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe (b, a)
</span><a href="#local-6989586621679106836"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106850"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-612"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuildSignal a -&gt; IO (BuildSignal a)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(BuildSignal a -&gt; IO (BuildSignal a))
-&gt; BuildSignal a -&gt; IO (BuildSignal a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Ptr Word8
-&gt; (BufferRange -&gt; IO (BuildSignal a))
-&gt; BuildSignal a
forall a. Int -&gt; Ptr Word8 -&gt; BuildStep a -&gt; BuildSignal a
</span><a href="Data.ByteString.Builder.Internal.html#bufferFull"><span class="hs-identifier hs-var">bufferFull</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679106852"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106851"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">((BufferRange -&gt; IO (BuildSignal a)) -&gt; BuildSignal a)
-&gt; (BufferRange -&gt; IO (BuildSignal a)) -&gt; BuildSignal a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-613"></span><span>              </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#BufferRange"><span class="hs-identifier hs-type">BufferRange</span></a></span><span> </span><span id="local-6989586621679106853"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106853"><span class="hs-identifier hs-var">opNew</span></a></span></span><span> </span><span id="local-6989586621679106854"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106854"><span class="hs-identifier hs-var">opeNew</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-614"></span><span>                  </span><span class="hs-glyph">!</span><span id="local-6989586621679106855"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106855"><span class="hs-identifier hs-var">opNew'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BoundedPrim b -&gt; b -&gt; Ptr Word8 -&gt; IO (Ptr Word8)
forall a. BoundedPrim a -&gt; a -&gt; Ptr Word8 -&gt; IO (Ptr Word8)
</span><a href="Data.ByteString.Builder.Prim.Internal.html#runB"><span class="hs-identifier hs-var">runB</span></a></span><span> </span><span class="annot"><span class="annottext">BoundedPrim b
</span><a href="#local-6989586621679106835"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679106849"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106853"><span class="hs-identifier hs-var">opNew</span></a></span><span>
</span><span id="line-615"></span><span>                  </span><span class="annot"><span class="annottext">a
-&gt; (BufferRange -&gt; IO (BuildSignal a))
-&gt; BufferRange
-&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106838"><span class="hs-identifier hs-var">fillWith</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106850"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">BufferRange -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106840"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Ptr Word8 -&gt; BufferRange
</span><a href="Data.ByteString.Builder.Internal.html#BufferRange"><span class="hs-identifier hs-var">BufferRange</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106855"><span class="hs-identifier hs-var">opNew'</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106854"><span class="hs-identifier hs-var">opeNew</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-616"></span><span>    </span><span id="local-6989586621679106852"><span class="annot"><span class="annottext">bound :: Int
</span><a href="#local-6989586621679106852"><span class="hs-identifier hs-var hs-var">bound</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BoundedPrim b -&gt; Int
forall a. BoundedPrim a -&gt; Int
</span><a href="Data.ByteString.Builder.Prim.Internal.html#sizeBound"><span class="hs-identifier hs-var">I.sizeBound</span></a></span><span> </span><span class="annot"><span class="annottext">BoundedPrim b
</span><a href="#local-6989586621679106835"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-617"></span><span>
</span><span id="line-618"></span><span class="hs-comment">-- | Create a 'Builder' that encodes each 'Word8' of a strict 'S.ByteString'</span><span>
</span><span id="line-619"></span><span class="hs-comment">-- using a 'BoundedPrim'. For example, we can write a 'Builder' that filters</span><span>
</span><span id="line-620"></span><span class="hs-comment">-- a strict 'S.ByteString' as follows.</span><span>
</span><span id="line-621"></span><span class="hs-comment">--</span><span>
</span><span id="line-622"></span><span class="hs-comment">-- &gt; import qualified Data.ByteString.Builder.Prim as P</span><span>
</span><span id="line-623"></span><span class="hs-comment">--</span><span>
</span><span id="line-624"></span><span class="hs-comment">-- &gt; filterBS p = P.condB p (P.liftFixedToBounded P.word8) P.emptyB</span><span>
</span><span id="line-625"></span><span class="hs-comment">--</span><span>
</span><span id="line-626"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primMapByteStringBounded"><span class="hs-pragma hs-type">primMapByteStringBounded</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-627"></span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primMapByteStringBounded"><span class="hs-identifier hs-type">primMapByteStringBounded</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#BoundedPrim"><span class="hs-identifier hs-type">BoundedPrim</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word8/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#Builder"><span class="hs-identifier hs-type">Builder</span></a></span><span>
</span><span id="line-628"></span><span id="primMapByteStringBounded"><span class="annot"><span class="annottext">primMapByteStringBounded :: BoundedPrim Word8 -&gt; ByteString -&gt; Builder
</span><a href="Data.ByteString.Builder.Prim.html#primMapByteStringBounded"><span class="hs-identifier hs-var hs-var">primMapByteStringBounded</span></a></span></span><span> </span><span id="local-6989586621679106856"><span class="annot"><span class="annottext">BoundedPrim Word8
</span><a href="#local-6989586621679106856"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-629"></span><span>    </span><span class="hs-glyph">\</span><span id="local-6989586621679106857"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679106857"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall r. BuildStep r -&gt; BuildStep r) -&gt; Builder
</span><a href="Data.ByteString.Builder.Internal.html#builder"><span class="hs-identifier hs-var">builder</span></a></span><span> </span><span class="annot"><span class="annottext">((forall r. BuildStep r -&gt; BuildStep r) -&gt; Builder)
-&gt; (forall r. BuildStep r -&gt; BuildStep r) -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
-&gt; (BufferRange -&gt; IO (BuildSignal r))
-&gt; BufferRange
-&gt; IO (BuildSignal r)
forall {a}.
ByteString
-&gt; (BufferRange -&gt; IO (BuildSignal a))
-&gt; BufferRange
-&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106858"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679106857"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-630"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-631"></span><span>    </span><span id="local-6989586621679106859"><span class="annot"><span class="annottext">bound :: Int
</span><a href="#local-6989586621679106859"><span class="hs-identifier hs-var hs-var">bound</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BoundedPrim Word8 -&gt; Int
forall a. BoundedPrim a -&gt; Int
</span><a href="Data.ByteString.Builder.Prim.Internal.html#sizeBound"><span class="hs-identifier hs-var">I.sizeBound</span></a></span><span> </span><span class="annot"><span class="annottext">BoundedPrim Word8
</span><a href="#local-6989586621679106856"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-632"></span><span>    </span><span id="local-6989586621679106858"><span class="annot"><span class="annottext">step :: ByteString
-&gt; (BufferRange -&gt; IO (BuildSignal a))
-&gt; BufferRange
-&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106858"><span class="hs-identifier hs-var hs-var">step</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.ByteString.Internal.Type.html#BS"><span class="hs-identifier hs-type">S.BS</span></a></span><span> </span><span id="local-6989586621679106861"><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679106861"><span class="hs-identifier hs-var">ifp</span></a></span></span><span> </span><span id="local-6989586621679106862"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679106862"><span class="hs-identifier hs-var">isize</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679106863"><span class="annot"><span class="annottext">BufferRange -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106863"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-633"></span><span>        </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; BufferRange -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106864"><span class="hs-identifier hs-var">goBS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; Ptr Word8
forall a. ForeignPtr a -&gt; Ptr a
</span><a href="../../base-4.18.2.1/src/GHC.ForeignPtr.html#unsafeForeignPtrToPtr/GHC.ForeignPtr.html#unsafeForeignPtrToPtr"><span class="hs-identifier hs-var">unsafeForeignPtrToPtr</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679106861"><span class="hs-identifier hs-var">ifp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-634"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-635"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679106865"><span class="annot"><span class="annottext">ipe :: Ptr b
</span><a href="#local-6989586621679106865"><span class="hs-identifier hs-var hs-var">ipe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; Ptr Word8
forall a. ForeignPtr a -&gt; Ptr a
</span><a href="../../base-4.18.2.1/src/GHC.ForeignPtr.html#unsafeForeignPtrToPtr/GHC.ForeignPtr.html#unsafeForeignPtrToPtr"><span class="hs-identifier hs-var">unsafeForeignPtrToPtr</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679106861"><span class="hs-identifier hs-var">ifp</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Ptr b
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><a href="../../base-4.18.2.1/src/GHC.Ptr.html#plusPtr/GHC.Ptr.html#plusPtr"><span class="hs-operator hs-var">`plusPtr`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679106862"><span class="hs-identifier hs-var">isize</span></a></span><span>
</span><span id="line-636"></span><span>        </span><span id="local-6989586621679106864"><span class="annot"><span class="annottext">goBS :: Ptr Word8 -&gt; BufferRange -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106864"><span class="hs-identifier hs-var hs-var">goBS</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679106872"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106872"><span class="hs-identifier hs-var">ip0</span></a></span></span><span> </span><span id="local-6989586621679106873"><span class="annot"><span class="annottext">br :: BufferRange
</span><a href="#local-6989586621679106873"><span class="hs-identifier hs-var">br</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#BufferRange"><span class="hs-identifier hs-type">BufferRange</span></a></span><span> </span><span id="local-6989586621679106874"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106874"><span class="hs-identifier hs-var">op0</span></a></span></span><span> </span><span id="local-6989586621679106875"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106875"><span class="hs-identifier hs-var">ope</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-637"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106872"><span class="hs-identifier hs-var">ip0</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Ptr Word8 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3E%3D/GHC.Classes.html#%3E%3D"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
forall {b}. Ptr b
</span><a href="#local-6989586621679106865"><span class="hs-identifier hs-var">ipe</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-638"></span><span>              </span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; IO ()
forall a. ForeignPtr a -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/GHC.ForeignPtr.html#touchForeignPtr/GHC.ForeignPtr.html#touchForeignPtr"><span class="hs-identifier hs-var">touchForeignPtr</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679106861"><span class="hs-identifier hs-var">ifp</span></a></span><span> </span><span class="hs-comment">-- input buffer consumed</span><span>
</span><span id="line-639"></span><span>              </span><span class="annot"><span class="annottext">BufferRange -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106863"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">BufferRange
</span><a href="#local-6989586621679106873"><span class="hs-identifier hs-var">br</span></a></span><span>
</span><span id="line-640"></span><span>
</span><span id="line-641"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106874"><span class="hs-identifier hs-var">op0</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Ptr Word8
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><a href="../../base-4.18.2.1/src/GHC.Ptr.html#plusPtr/GHC.Ptr.html#plusPtr"><span class="hs-operator hs-var">`plusPtr`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679106859"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Ptr Word8 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106875"><span class="hs-identifier hs-var">ope</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-642"></span><span>              </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106877"><span class="hs-identifier hs-var">goPartial</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106872"><span class="hs-identifier hs-var">ip0</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Ptr Word8
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><a href="../../base-4.18.2.1/src/GHC.Ptr.html#plusPtr/GHC.Ptr.html#plusPtr"><span class="hs-operator hs-var">`plusPtr`</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#min/GHC.Classes.html#min"><span class="hs-identifier hs-var">min</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679106879"><span class="hs-identifier hs-var">outRemaining</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679106880"><span class="hs-identifier hs-var">inpRemaining</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span>
</span><span id="line-644"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuildSignal a -&gt; IO (BuildSignal a)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(BuildSignal a -&gt; IO (BuildSignal a))
-&gt; BuildSignal a -&gt; IO (BuildSignal a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Ptr Word8
-&gt; (BufferRange -&gt; IO (BuildSignal a))
-&gt; BuildSignal a
forall a. Int -&gt; Ptr Word8 -&gt; BuildStep a -&gt; BuildSignal a
</span><a href="Data.ByteString.Builder.Internal.html#bufferFull"><span class="hs-identifier hs-var">bufferFull</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679106859"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106874"><span class="hs-identifier hs-var">op0</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8 -&gt; BufferRange -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106864"><span class="hs-identifier hs-var">goBS</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106872"><span class="hs-identifier hs-var">ip0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-645"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-646"></span><span>            </span><span id="local-6989586621679106879"><span class="annot"><span class="annottext">outRemaining :: Int
</span><a href="#local-6989586621679106879"><span class="hs-identifier hs-var hs-var">outRemaining</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106875"><span class="hs-identifier hs-var">ope</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Ptr Word8 -&gt; Int
forall a b. Ptr a -&gt; Ptr b -&gt; Int
</span><a href="../../base-4.18.2.1/src/GHC.Ptr.html#minusPtr/GHC.Ptr.html#minusPtr"><span class="hs-operator hs-var">`minusPtr`</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106874"><span class="hs-identifier hs-var">op0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#div/GHC.Real.html#div"><span class="hs-operator hs-var">`div`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679106859"><span class="hs-identifier hs-var">bound</span></a></span><span>
</span><span id="line-647"></span><span>            </span><span id="local-6989586621679106880"><span class="annot"><span class="annottext">inpRemaining :: Int
</span><a href="#local-6989586621679106880"><span class="hs-identifier hs-var hs-var">inpRemaining</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Any
forall {b}. Ptr b
</span><a href="#local-6989586621679106865"><span class="hs-identifier hs-var">ipe</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Any -&gt; Ptr Word8 -&gt; Int
forall a b. Ptr a -&gt; Ptr b -&gt; Int
</span><a href="../../base-4.18.2.1/src/GHC.Ptr.html#minusPtr/GHC.Ptr.html#minusPtr"><span class="hs-operator hs-var">`minusPtr`</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106872"><span class="hs-identifier hs-var">ip0</span></a></span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span>            </span><span id="local-6989586621679106877"><span class="annot"><span class="annottext">goPartial :: Ptr Word8 -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106877"><span class="hs-identifier hs-var hs-var">goPartial</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679106884"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106884"><span class="hs-identifier hs-var">ipeTmp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Ptr Word8 -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106885"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106872"><span class="hs-identifier hs-var">ip0</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106874"><span class="hs-identifier hs-var">op0</span></a></span><span>
</span><span id="line-650"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-651"></span><span>                </span><span id="local-6989586621679106885"><span class="annot"><span class="annottext">go :: Ptr Word8 -&gt; Ptr Word8 -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106885"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679106890"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106890"><span class="hs-identifier hs-var">ip</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679106891"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106891"><span class="hs-identifier hs-var">op</span></a></span></span><span>
</span><span id="line-652"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106890"><span class="hs-identifier hs-var">ip</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Ptr Word8 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3C/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106884"><span class="hs-identifier hs-var">ipeTmp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-653"></span><span>                      </span><span id="local-6989586621679106893"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679106893"><span class="hs-identifier hs-var">x</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; IO Word8
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><a href="../../base-4.18.2.1/src/Foreign.Storable.html#peek/Foreign.Storable.html#peek"><span class="hs-identifier hs-var">peek</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106890"><span class="hs-identifier hs-var">ip</span></a></span><span>
</span><span id="line-654"></span><span>                      </span><span id="local-6989586621679106895"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106895"><span class="hs-identifier hs-var">op'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BoundedPrim Word8 -&gt; Word8 -&gt; Ptr Word8 -&gt; IO (Ptr Word8)
forall a. BoundedPrim a -&gt; a -&gt; Ptr Word8 -&gt; IO (Ptr Word8)
</span><a href="Data.ByteString.Builder.Prim.Internal.html#runB"><span class="hs-identifier hs-var">runB</span></a></span><span> </span><span class="annot"><span class="annottext">BoundedPrim Word8
</span><a href="#local-6989586621679106856"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679106893"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106891"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-655"></span><span>                      </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Ptr Word8 -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106885"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106890"><span class="hs-identifier hs-var">ip</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Ptr Word8
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><a href="../../base-4.18.2.1/src/GHC.Ptr.html#plusPtr/GHC.Ptr.html#plusPtr"><span class="hs-operator hs-var">`plusPtr`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106895"><span class="hs-identifier hs-var">op'</span></a></span><span>
</span><span id="line-656"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-657"></span><span>                      </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; BufferRange -&gt; IO (BuildSignal a)
</span><a href="#local-6989586621679106864"><span class="hs-identifier hs-var">goBS</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106890"><span class="hs-identifier hs-var">ip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Ptr Word8 -&gt; BufferRange
</span><a href="Data.ByteString.Builder.Internal.html#BufferRange"><span class="hs-identifier hs-var">BufferRange</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106891"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106875"><span class="hs-identifier hs-var">ope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-658"></span><span>
</span><span id="line-659"></span><span class="annot"><span class="hs-comment">-- | Chunk-wise application of 'primMapByteStringBounded'.</span></span><span>
</span><span id="line-660"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primMapLazyByteStringBounded"><span class="hs-pragma hs-type">primMapLazyByteStringBounded</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-661"></span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#primMapLazyByteStringBounded"><span class="hs-identifier hs-type">primMapLazyByteStringBounded</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#BoundedPrim"><span class="hs-identifier hs-type">BoundedPrim</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word8/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">L.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#Builder"><span class="hs-identifier hs-type">Builder</span></a></span><span>
</span><span id="line-662"></span><span id="primMapLazyByteStringBounded"><span class="annot"><span class="annottext">primMapLazyByteStringBounded :: BoundedPrim Word8 -&gt; ByteString -&gt; Builder
</span><a href="Data.ByteString.Builder.Prim.html#primMapLazyByteStringBounded"><span class="hs-identifier hs-var hs-var">primMapLazyByteStringBounded</span></a></span></span><span> </span><span id="local-6989586621679106896"><span class="annot"><span class="annottext">BoundedPrim Word8
</span><a href="#local-6989586621679106896"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-663"></span><span>    </span><span class="annot"><span class="annottext">(ByteString -&gt; Builder -&gt; Builder)
-&gt; Builder -&gt; ByteString -&gt; Builder
forall a. (ByteString -&gt; a -&gt; a) -&gt; a -&gt; ByteString -&gt; a
</span><a href="Data.ByteString.Lazy.Internal.html#foldrChunks"><span class="hs-identifier hs-var">L.foldrChunks</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679106898"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679106898"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679106899"><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679106899"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BoundedPrim Word8 -&gt; ByteString -&gt; Builder
</span><a href="Data.ByteString.Builder.Prim.html#primMapByteStringBounded"><span class="hs-identifier hs-var">primMapByteStringBounded</span></a></span><span> </span><span class="annot"><span class="annottext">BoundedPrim Word8
</span><a href="#local-6989586621679106896"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679106898"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#mappend/GHC.Base.html#mappend"><span class="hs-operator hs-var">`mappend`</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679106899"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Builder
forall a. Monoid a =&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#mempty/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-664"></span><span>
</span><span id="line-665"></span><span>
</span><span id="line-666"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-667"></span><span class="hs-comment">-- Raw CString encoding</span><span>
</span><span id="line-668"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-669"></span><span>
</span><span id="line-670"></span><span class="hs-comment">-- | A null-terminated ASCII encoded 'Foreign.C.String.CString'.</span><span>
</span><span id="line-671"></span><span class="hs-comment">-- Null characters are not representable.</span><span>
</span><span id="line-672"></span><span class="hs-comment">--</span><span>
</span><span id="line-673"></span><span class="hs-comment">-- @since 0.11.0.0</span><span>
</span><span id="line-674"></span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#cstring"><span class="hs-identifier hs-type">cstring</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Prim.html#Addr%23/GHC.Prim.html#Addr%23"><span class="hs-identifier hs-type">Addr#</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#Builder"><span class="hs-identifier hs-type">Builder</span></a></span><span>
</span><span id="line-675"></span><span id="cstring"><span class="annot"><span class="annottext">cstring :: Addr# -&gt; Builder
</span><a href="Data.ByteString.Builder.Prim.html#cstring"><span class="hs-identifier hs-var hs-var">cstring</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-676"></span><span>    </span><span class="hs-glyph">\</span><span id="local-6989586621679106900"><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621679106900"><span class="hs-identifier hs-var">addr0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall r. BuildStep r -&gt; BuildStep r) -&gt; Builder
</span><a href="Data.ByteString.Builder.Internal.html#builder"><span class="hs-identifier hs-var">builder</span></a></span><span> </span><span class="annot"><span class="annottext">((forall r. BuildStep r -&gt; BuildStep r) -&gt; Builder)
-&gt; (forall r. BuildStep r -&gt; BuildStep r) -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Addr# -&gt; BuildStep r -&gt; BuildStep r
forall r. Addr# -&gt; BuildStep r -&gt; BuildStep r
</span><a href="#local-6989586621679106901"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621679106900"><span class="hs-identifier hs-var">addr0</span></a></span><span>
</span><span id="line-677"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-678"></span><span>    </span><span id="local-6989586621679106683"><span class="annot"><a href="#local-6989586621679106901"><span class="hs-identifier hs-type">step</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Prim.html#Addr%23/GHC.Prim.html#Addr%23"><span class="hs-identifier hs-type">Addr#</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#BuildStep"><span class="hs-identifier hs-type">BuildStep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106683"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#BuildStep"><span class="hs-identifier hs-type">BuildStep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106683"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-679"></span><span>    </span><span id="local-6989586621679106901"><span class="annot"><span class="annottext">step :: forall r. Addr# -&gt; BuildStep r -&gt; BuildStep r
</span><a href="#local-6989586621679106901"><span class="hs-identifier hs-var hs-var">step</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679106909"><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621679106909"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679106910"><span class="annot"><span class="annottext">BuildStep r
</span><a href="#local-6989586621679106910"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679106911"><span class="annot"><span class="annottext">br :: BufferRange
</span><a href="#local-6989586621679106911"><span class="hs-identifier hs-var">br</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#BufferRange"><span class="hs-identifier hs-type">BufferRange</span></a></span><span> </span><span id="local-6989586621679106912"><span class="annot"><span class="annottext">op0 :: Ptr Word8
</span><a href="#local-6989586621679106912"><span class="hs-identifier hs-var">op0</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Ptr.html#Ptr/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span id="local-6989586621679106914"><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621679106914"><span class="hs-identifier hs-var">op0#</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679106915"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106915"><span class="hs-identifier hs-var">ope</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-680"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word8# -&gt; Word8
</span><a href="../../base-4.18.2.1/src/GHC.Word.html#W8%23/GHC.Word.html#W8%23"><span class="hs-identifier hs-var">W8#</span></a></span><span> </span><span class="annot"><span class="annottext">Word8#
</span><a href="#local-6989586621679106917"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuildStep r
</span><a href="#local-6989586621679106910"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">BufferRange
</span><a href="#local-6989586621679106911"><span class="hs-identifier hs-var">br</span></a></span><span>
</span><span id="line-681"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106912"><span class="hs-identifier hs-var">op0</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Ptr Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106915"><span class="hs-identifier hs-var">ope</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-682"></span><span>          </span><span class="annot"><span class="annottext">BuildSignal r -&gt; IO (BuildSignal r)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(BuildSignal r -&gt; IO (BuildSignal r))
-&gt; BuildSignal r -&gt; IO (BuildSignal r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ptr Word8 -&gt; BuildStep r -&gt; BuildSignal r
forall a. Int -&gt; Ptr Word8 -&gt; BuildStep a -&gt; BuildSignal a
</span><a href="Data.ByteString.Builder.Internal.html#bufferFull"><span class="hs-identifier hs-var">bufferFull</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106912"><span class="hs-identifier hs-var">op0</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Addr# -&gt; BuildStep r -&gt; BuildStep r
forall r. Addr# -&gt; BuildStep r -&gt; BuildStep r
</span><a href="#local-6989586621679106901"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621679106909"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">BuildStep r
</span><a href="#local-6989586621679106910"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-683"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-684"></span><span>          </span><span class="annot"><span class="annottext">(State# RealWorld -&gt; (# State# RealWorld, () #)) -&gt; IO ()
forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#IO/GHC.Types.html#IO"><span class="hs-identifier hs-var">IO</span></a></span><span> </span><span class="annot"><span class="annottext">((State# RealWorld -&gt; (# State# RealWorld, () #)) -&gt; IO ())
-&gt; (State# RealWorld -&gt; (# State# RealWorld, () #)) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679106918"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621679106918"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Addr# -&gt; Int# -&gt; Word8# -&gt; State# RealWorld -&gt; State# RealWorld
forall d. Addr# -&gt; Int# -&gt; Word8# -&gt; State# d -&gt; State# d
</span><a href="../../ghc-prim-0.10.0/src/GHC.Prim.html#writeWord8OffAddr%23/GHC.Prim.html#writeWord8OffAddr%23"><span class="hs-identifier hs-var">writeWord8OffAddr#</span></a></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621679106914"><span class="hs-identifier hs-var">op0#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="annot"><span class="annottext">Word8#
</span><a href="#local-6989586621679106917"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621679106918"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-685"></span><span>                       </span><span id="local-6989586621679106919"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621679106919"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621679106919"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-686"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679106920"><span class="annot"><span class="annottext">br' :: BufferRange
</span><a href="#local-6989586621679106920"><span class="hs-identifier hs-var hs-var">br'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Ptr Word8 -&gt; BufferRange
</span><a href="Data.ByteString.Builder.Internal.html#BufferRange"><span class="hs-identifier hs-var">BufferRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106912"><span class="hs-identifier hs-var">op0</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Ptr Word8
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><a href="../../base-4.18.2.1/src/GHC.Ptr.html#plusPtr/GHC.Ptr.html#plusPtr"><span class="hs-operator hs-var">`plusPtr`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106915"><span class="hs-identifier hs-var">ope</span></a></span><span>
</span><span id="line-687"></span><span>          </span><span class="annot"><span class="annottext">Addr# -&gt; BuildStep r -&gt; BuildStep r
forall r. Addr# -&gt; BuildStep r -&gt; BuildStep r
</span><a href="#local-6989586621679106901"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621679106909"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Addr# -&gt; Int# -&gt; Addr#
</span><a href="../../ghc-prim-0.10.0/src/GHC.Prim.html#plusAddr%23/GHC.Prim.html#plusAddr%23"><span class="hs-operator hs-var">`plusAddr#`</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">1#</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BuildStep r
</span><a href="#local-6989586621679106910"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">BufferRange
</span><a href="#local-6989586621679106920"><span class="hs-identifier hs-var">br'</span></a></span><span>
</span><span id="line-688"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-689"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679106917"><span class="annot"><span class="annottext">ch :: Word8#
</span><a href="#local-6989586621679106917"><span class="hs-identifier hs-var hs-var">ch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Addr# -&gt; Int# -&gt; Word8#
</span><a href="../../ghc-prim-0.10.0/src/GHC.Prim.html#indexWord8OffAddr%23/GHC.Prim.html#indexWord8OffAddr%23"><span class="hs-identifier hs-var">indexWord8OffAddr#</span></a></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621679106909"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span>
</span><span id="line-690"></span><span>
</span><span id="line-691"></span><span class="hs-comment">-- | A null-terminated UTF-8 encoded 'Foreign.C.String.CString'.</span><span>
</span><span id="line-692"></span><span class="hs-comment">-- Null characters can be encoded as @0xc0 0x80@.</span><span>
</span><span id="line-693"></span><span class="hs-comment">--</span><span>
</span><span id="line-694"></span><span class="hs-comment">-- @since 0.11.0.0</span><span>
</span><span id="line-695"></span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#cstringUtf8"><span class="hs-identifier hs-type">cstringUtf8</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Prim.html#Addr%23/GHC.Prim.html#Addr%23"><span class="hs-identifier hs-type">Addr#</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#Builder"><span class="hs-identifier hs-type">Builder</span></a></span><span>
</span><span id="line-696"></span><span id="cstringUtf8"><span class="annot"><span class="annottext">cstringUtf8 :: Addr# -&gt; Builder
</span><a href="Data.ByteString.Builder.Prim.html#cstringUtf8"><span class="hs-identifier hs-var hs-var">cstringUtf8</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-697"></span><span>    </span><span class="hs-glyph">\</span><span id="local-6989586621679106921"><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621679106921"><span class="hs-identifier hs-var">addr0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall r. BuildStep r -&gt; BuildStep r) -&gt; Builder
</span><a href="Data.ByteString.Builder.Internal.html#builder"><span class="hs-identifier hs-var">builder</span></a></span><span> </span><span class="annot"><span class="annottext">((forall r. BuildStep r -&gt; BuildStep r) -&gt; Builder)
-&gt; (forall r. BuildStep r -&gt; BuildStep r) -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Addr# -&gt; BuildStep r -&gt; BuildStep r
forall r. Addr# -&gt; BuildStep r -&gt; BuildStep r
</span><a href="#local-6989586621679106922"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621679106921"><span class="hs-identifier hs-var">addr0</span></a></span><span>
</span><span id="line-698"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-699"></span><span>    </span><span id="local-6989586621679106923"><span class="annot"><a href="#local-6989586621679106922"><span class="hs-identifier hs-type">step</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Prim.html#Addr%23/GHC.Prim.html#Addr%23"><span class="hs-identifier hs-type">Addr#</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#BuildStep"><span class="hs-identifier hs-type">BuildStep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106923"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#BuildStep"><span class="hs-identifier hs-type">BuildStep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679106923"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-700"></span><span>    </span><span id="local-6989586621679106922"><span class="annot"><span class="annottext">step :: forall r. Addr# -&gt; BuildStep r -&gt; BuildStep r
</span><a href="#local-6989586621679106922"><span class="hs-identifier hs-var hs-var">step</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679106934"><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621679106934"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679106935"><span class="annot"><span class="annottext">BuildStep r
</span><a href="#local-6989586621679106935"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679106936"><span class="annot"><span class="annottext">br :: BufferRange
</span><a href="#local-6989586621679106936"><span class="hs-identifier hs-var">br</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Data.ByteString.Builder.Internal.html#BufferRange"><span class="hs-identifier hs-type">BufferRange</span></a></span><span> </span><span id="local-6989586621679106937"><span class="annot"><span class="annottext">op0 :: Ptr Word8
</span><a href="#local-6989586621679106937"><span class="hs-identifier hs-var">op0</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Ptr.html#Ptr/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span id="local-6989586621679106938"><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621679106938"><span class="hs-identifier hs-var">op0#</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679106939"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106939"><span class="hs-identifier hs-var">ope</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word8# -&gt; Word8
</span><a href="../../base-4.18.2.1/src/GHC.Word.html#W8%23/GHC.Word.html#W8%23"><span class="hs-identifier hs-var">W8#</span></a></span><span> </span><span class="annot"><span class="annottext">Word8#
</span><a href="#local-6989586621679106940"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuildStep r
</span><a href="#local-6989586621679106935"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">BufferRange
</span><a href="#local-6989586621679106936"><span class="hs-identifier hs-var">br</span></a></span><span>
</span><span id="line-702"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106937"><span class="hs-identifier hs-var">op0</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Ptr Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106939"><span class="hs-identifier hs-var">ope</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-703"></span><span>          </span><span class="annot"><span class="annottext">BuildSignal r -&gt; IO (BuildSignal r)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(BuildSignal r -&gt; IO (BuildSignal r))
-&gt; BuildSignal r -&gt; IO (BuildSignal r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ptr Word8 -&gt; BuildStep r -&gt; BuildSignal r
forall a. Int -&gt; Ptr Word8 -&gt; BuildStep a -&gt; BuildSignal a
</span><a href="Data.ByteString.Builder.Internal.html#bufferFull"><span class="hs-identifier hs-var">bufferFull</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106937"><span class="hs-identifier hs-var">op0</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Addr# -&gt; BuildStep r -&gt; BuildStep r
forall r. Addr# -&gt; BuildStep r -&gt; BuildStep r
</span><a href="#local-6989586621679106922"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621679106934"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">BuildStep r
</span><a href="#local-6989586621679106935"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-704"></span><span>        </span><span class="hs-comment">-- NULL is encoded as 0xc0 0x80</span><span>
</span><span id="line-705"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word8# -&gt; Word8
</span><a href="../../base-4.18.2.1/src/GHC.Word.html#W8%23/GHC.Word.html#W8%23"><span class="hs-identifier hs-var">W8#</span></a></span><span> </span><span class="annot"><span class="annottext">Word8#
</span><a href="#local-6989586621679106940"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0xc0</span></span><span>
</span><span id="line-706"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8# -&gt; Word8
</span><a href="../../base-4.18.2.1/src/GHC.Word.html#W8%23/GHC.Word.html#W8%23"><span class="hs-identifier hs-var">W8#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Addr# -&gt; Int# -&gt; Word8#
</span><a href="../../ghc-prim-0.10.0/src/GHC.Prim.html#indexWord8OffAddr%23/GHC.Prim.html#indexWord8OffAddr%23"><span class="hs-identifier hs-var">indexWord8OffAddr#</span></a></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621679106934"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">1#</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x80</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-707"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#W8%23/GHC.Word.html#W8%23"><span class="hs-identifier hs-type">W8#</span></a></span><span> </span><span id="local-6989586621679106942"><span class="annot"><span class="annottext">Word8#
</span><a href="#local-6989586621679106942"><span class="hs-identifier hs-var">nullByte#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span>
</span><span id="line-708"></span><span>          </span><span class="annot"><span class="annottext">(State# RealWorld -&gt; (# State# RealWorld, () #)) -&gt; IO ()
forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#IO/GHC.Types.html#IO"><span class="hs-identifier hs-var">IO</span></a></span><span> </span><span class="annot"><span class="annottext">((State# RealWorld -&gt; (# State# RealWorld, () #)) -&gt; IO ())
-&gt; (State# RealWorld -&gt; (# State# RealWorld, () #)) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679106943"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621679106943"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Addr# -&gt; Int# -&gt; Word8# -&gt; State# RealWorld -&gt; State# RealWorld
forall d. Addr# -&gt; Int# -&gt; Word8# -&gt; State# d -&gt; State# d
</span><a href="../../ghc-prim-0.10.0/src/GHC.Prim.html#writeWord8OffAddr%23/GHC.Prim.html#writeWord8OffAddr%23"><span class="hs-identifier hs-var">writeWord8OffAddr#</span></a></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621679106938"><span class="hs-identifier hs-var">op0#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="annot"><span class="annottext">Word8#
</span><a href="#local-6989586621679106942"><span class="hs-identifier hs-var">nullByte#</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621679106943"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-709"></span><span>                       </span><span id="local-6989586621679106944"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621679106944"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621679106944"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-710"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679106945"><span class="annot"><span class="annottext">br' :: BufferRange
</span><a href="#local-6989586621679106945"><span class="hs-identifier hs-var hs-var">br'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Ptr Word8 -&gt; BufferRange
</span><a href="Data.ByteString.Builder.Internal.html#BufferRange"><span class="hs-identifier hs-var">BufferRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106937"><span class="hs-identifier hs-var">op0</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Ptr Word8
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><a href="../../base-4.18.2.1/src/GHC.Ptr.html#plusPtr/GHC.Ptr.html#plusPtr"><span class="hs-operator hs-var">`plusPtr`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106939"><span class="hs-identifier hs-var">ope</span></a></span><span>
</span><span id="line-711"></span><span>          </span><span class="annot"><span class="annottext">Addr# -&gt; BuildStep r -&gt; BuildStep r
forall r. Addr# -&gt; BuildStep r -&gt; BuildStep r
</span><a href="#local-6989586621679106922"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621679106934"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Addr# -&gt; Int# -&gt; Addr#
</span><a href="../../ghc-prim-0.10.0/src/GHC.Prim.html#plusAddr%23/GHC.Prim.html#plusAddr%23"><span class="hs-operator hs-var">`plusAddr#`</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">2#</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BuildStep r
</span><a href="#local-6989586621679106935"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">BufferRange
</span><a href="#local-6989586621679106945"><span class="hs-identifier hs-var">br'</span></a></span><span>
</span><span id="line-712"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-713"></span><span>          </span><span class="annot"><span class="annottext">(State# RealWorld -&gt; (# State# RealWorld, () #)) -&gt; IO ()
forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#IO/GHC.Types.html#IO"><span class="hs-identifier hs-var">IO</span></a></span><span> </span><span class="annot"><span class="annottext">((State# RealWorld -&gt; (# State# RealWorld, () #)) -&gt; IO ())
-&gt; (State# RealWorld -&gt; (# State# RealWorld, () #)) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679106946"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621679106946"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Addr# -&gt; Int# -&gt; Word8# -&gt; State# RealWorld -&gt; State# RealWorld
forall d. Addr# -&gt; Int# -&gt; Word8# -&gt; State# d -&gt; State# d
</span><a href="../../ghc-prim-0.10.0/src/GHC.Prim.html#writeWord8OffAddr%23/GHC.Prim.html#writeWord8OffAddr%23"><span class="hs-identifier hs-var">writeWord8OffAddr#</span></a></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621679106938"><span class="hs-identifier hs-var">op0#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="annot"><span class="annottext">Word8#
</span><a href="#local-6989586621679106940"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621679106946"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-714"></span><span>                       </span><span id="local-6989586621679106947"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621679106947"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621679106947"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-715"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679106948"><span class="annot"><span class="annottext">br' :: BufferRange
</span><a href="#local-6989586621679106948"><span class="hs-identifier hs-var hs-var">br'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Ptr Word8 -&gt; BufferRange
</span><a href="Data.ByteString.Builder.Internal.html#BufferRange"><span class="hs-identifier hs-var">BufferRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106937"><span class="hs-identifier hs-var">op0</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Ptr Word8
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><a href="../../base-4.18.2.1/src/GHC.Ptr.html#plusPtr/GHC.Ptr.html#plusPtr"><span class="hs-operator hs-var">`plusPtr`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679106939"><span class="hs-identifier hs-var">ope</span></a></span><span>
</span><span id="line-716"></span><span>          </span><span class="annot"><span class="annottext">Addr# -&gt; BuildStep r -&gt; BuildStep r
forall r. Addr# -&gt; BuildStep r -&gt; BuildStep r
</span><a href="#local-6989586621679106922"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621679106934"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Addr# -&gt; Int# -&gt; Addr#
</span><a href="../../ghc-prim-0.10.0/src/GHC.Prim.html#plusAddr%23/GHC.Prim.html#plusAddr%23"><span class="hs-operator hs-var">`plusAddr#`</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">1#</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BuildStep r
</span><a href="#local-6989586621679106935"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">BufferRange
</span><a href="#local-6989586621679106948"><span class="hs-identifier hs-var">br'</span></a></span><span>
</span><span id="line-717"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-718"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679106940"><span class="annot"><span class="annottext">ch :: Word8#
</span><a href="#local-6989586621679106940"><span class="hs-identifier hs-var hs-var">ch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Addr# -&gt; Int# -&gt; Word8#
</span><a href="../../ghc-prim-0.10.0/src/GHC.Prim.html#indexWord8OffAddr%23/GHC.Prim.html#indexWord8OffAddr%23"><span class="hs-identifier hs-var">indexWord8OffAddr#</span></a></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621679106934"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-721"></span><span class="hs-comment">-- Char8 encoding</span><span>
</span><span id="line-722"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-723"></span><span>
</span><span id="line-724"></span><span class="annot"><span class="hs-comment">-- | Char8 encode a 'Char'.</span></span><span>
</span><span id="line-725"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#char8"><span class="hs-pragma hs-type">char8</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-726"></span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#char8"><span class="hs-identifier hs-type">char8</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#FixedPrim"><span class="hs-identifier hs-type">FixedPrim</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#Char/GHC.Types.html#Char"><span class="hs-identifier hs-type">Char</span></a></span><span>
</span><span id="line-727"></span><span id="char8"><span class="annot"><span class="annottext">char8 :: FixedPrim Char
</span><a href="Data.ByteString.Builder.Prim.html#char8"><span class="hs-identifier hs-var hs-var">char8</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word8
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word8) -&gt; (Char -&gt; Int) -&gt; Char -&gt; Word8
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Int
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#ord/GHC.Base.html#ord"><span class="hs-identifier hs-var">ord</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Word8) -&gt; FixedPrim Word8 -&gt; FixedPrim Char
forall (f :: * -&gt; *) b a. Contravariant f =&gt; (b -&gt; a) -&gt; f a -&gt; f b
</span><a href="Data.ByteString.Builder.Prim.Internal.html#%3E%24%3C"><span class="hs-operator hs-var">&gt;$&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">FixedPrim Word8
</span><a href="Data.ByteString.Builder.Prim.Binary.html#word8"><span class="hs-identifier hs-var">word8</span></a></span><span>
</span><span id="line-728"></span><span>
</span><span id="line-729"></span><span>
</span><span id="line-730"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-731"></span><span class="hs-comment">-- UTF-8 encoding</span><span>
</span><span id="line-732"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span class="annot"><span class="hs-comment">-- | UTF-8 encode a 'Char'.</span></span><span>
</span><span id="line-735"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#charUtf8"><span class="hs-pragma hs-type">charUtf8</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-736"></span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#charUtf8"><span class="hs-identifier hs-type">charUtf8</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.Internal.html#BoundedPrim"><span class="hs-identifier hs-type">BoundedPrim</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#Char/GHC.Types.html#Char"><span class="hs-identifier hs-type">Char</span></a></span><span>
</span><span id="line-737"></span><span id="charUtf8"><span class="annot"><span class="annottext">charUtf8 :: BoundedPrim Char
</span><a href="Data.ByteString.Builder.Prim.html#charUtf8"><span class="hs-identifier hs-var hs-var">charUtf8</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Char -&gt; Ptr Word8 -&gt; IO (Ptr Word8)) -&gt; BoundedPrim Char
forall a.
Int -&gt; (a -&gt; Ptr Word8 -&gt; IO (Ptr Word8)) -&gt; BoundedPrim a
</span><a href="Data.ByteString.Builder.Prim.Internal.html#boundedPrim"><span class="hs-identifier hs-var">boundedPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Word8 -&gt; Ptr Word8 -&gt; IO (Ptr Word8))
-&gt; (Word8 -&gt; Word8 -&gt; Ptr Word8 -&gt; IO (Ptr Word8))
-&gt; (Word8 -&gt; Word8 -&gt; Word8 -&gt; Ptr Word8 -&gt; IO (Ptr Word8))
-&gt; (Word8
    -&gt; Word8 -&gt; Word8 -&gt; Word8 -&gt; Ptr Word8 -&gt; IO (Ptr Word8))
-&gt; Char
-&gt; Ptr Word8
-&gt; IO (Ptr Word8)
forall a.
(Word8 -&gt; a)
-&gt; (Word8 -&gt; Word8 -&gt; a)
-&gt; (Word8 -&gt; Word8 -&gt; Word8 -&gt; a)
-&gt; (Word8 -&gt; Word8 -&gt; Word8 -&gt; Word8 -&gt; a)
-&gt; Char
-&gt; a
</span><a href="Data.ByteString.Builder.Prim.html#encodeCharUtf8"><span class="hs-identifier hs-var">encodeCharUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Ptr Word8 -&gt; IO (Ptr Word8)
forall {a} {b} {b}. Storable a =&gt; a -&gt; Ptr b -&gt; IO (Ptr b)
</span><a href="#local-6989586621679106952"><span class="hs-identifier hs-var">f1</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Ptr Word8 -&gt; IO (Ptr Word8)
forall {a} {a} {b} {b}.
(Storable a, Storable a) =&gt;
a -&gt; a -&gt; Ptr b -&gt; IO (Ptr b)
</span><a href="#local-6989586621679106953"><span class="hs-identifier hs-var">f2</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8 -&gt; Ptr Word8 -&gt; IO (Ptr Word8)
forall {a} {a} {a} {b} {b}.
(Storable a, Storable a, Storable a) =&gt;
a -&gt; a -&gt; a -&gt; Ptr b -&gt; IO (Ptr b)
</span><a href="#local-6989586621679106954"><span class="hs-identifier hs-var">f3</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8 -&gt; Word8 -&gt; Ptr Word8 -&gt; IO (Ptr Word8)
forall {a} {a} {a} {a} {b} {b}.
(Storable a, Storable a, Storable a, Storable a) =&gt;
a -&gt; a -&gt; a -&gt; a -&gt; Ptr b -&gt; IO (Ptr b)
</span><a href="#local-6989586621679106955"><span class="hs-identifier hs-var">f4</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-738"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-739"></span><span>    </span><span id="local-6989586621679106965"><span class="annot"><span class="annottext">pokeN :: Int -&gt; (Ptr a -&gt; m a) -&gt; Ptr a -&gt; m (Ptr b)
</span><a href="#local-6989586621679106965"><span class="hs-identifier hs-var hs-var">pokeN</span></a></span></span><span> </span><span id="local-6989586621679106966"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679106966"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679106967"><span class="annot"><span class="annottext">Ptr a -&gt; m a
</span><a href="#local-6989586621679106967"><span class="hs-identifier hs-var">io</span></a></span></span><span> </span><span id="local-6989586621679106968"><span class="annot"><span class="annottext">Ptr a
</span><a href="#local-6989586621679106968"><span class="hs-identifier hs-var">op</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr a -&gt; m a
</span><a href="#local-6989586621679106967"><span class="hs-identifier hs-var">io</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr a
</span><a href="#local-6989586621679106968"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; m (Ptr b) -&gt; m (Ptr b)
forall a b. m a -&gt; m b -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3E%3E/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr b -&gt; m (Ptr b)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr a
</span><a href="#local-6989586621679106968"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr a -&gt; Int -&gt; Ptr b
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><a href="../../base-4.18.2.1/src/GHC.Ptr.html#plusPtr/GHC.Ptr.html#plusPtr"><span class="hs-operator hs-var">`plusPtr`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679106966"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-740"></span><span>
</span><span id="line-741"></span><span>    </span><span id="local-6989586621679106952"><span class="annot"><span class="annottext">f1 :: a -&gt; Ptr b -&gt; IO (Ptr b)
</span><a href="#local-6989586621679106952"><span class="hs-identifier hs-var hs-var">f1</span></a></span></span><span> </span><span id="local-6989586621679106972"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106972"><span class="hs-identifier hs-var">x1</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Ptr b -&gt; IO ()) -&gt; Ptr b -&gt; IO (Ptr b)
forall {m :: * -&gt; *} {a} {a} {b}.
Monad m =&gt;
Int -&gt; (Ptr a -&gt; m a) -&gt; Ptr a -&gt; m (Ptr b)
</span><a href="#local-6989586621679106965"><span class="hs-identifier hs-var">pokeN</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">((Ptr b -&gt; IO ()) -&gt; Ptr b -&gt; IO (Ptr b))
-&gt; (Ptr b -&gt; IO ()) -&gt; Ptr b -&gt; IO (Ptr b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679106973"><span class="annot"><span class="annottext">Ptr b
</span><a href="#local-6989586621679106973"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>    </span><span class="annot"><span class="annottext">Ptr b -&gt; Int -&gt; a -&gt; IO ()
forall b. Ptr b -&gt; Int -&gt; a -&gt; IO ()
forall a b. Storable a =&gt; Ptr b -&gt; Int -&gt; a -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/Foreign.Storable.html#pokeByteOff/Foreign.Storable.html#pokeByteOff"><span class="hs-identifier hs-var">pokeByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr b
</span><a href="#local-6989586621679106973"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106972"><span class="hs-identifier hs-var">x1</span></a></span><span>
</span><span id="line-742"></span><span>
</span><span id="line-743"></span><span>    </span><span id="local-6989586621679106953"><span class="annot"><span class="annottext">f2 :: a -&gt; a -&gt; Ptr b -&gt; IO (Ptr b)
</span><a href="#local-6989586621679106953"><span class="hs-identifier hs-var hs-var">f2</span></a></span></span><span> </span><span id="local-6989586621679106981"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106981"><span class="hs-identifier hs-var">x1</span></a></span></span><span> </span><span id="local-6989586621679106982"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106982"><span class="hs-identifier hs-var">x2</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Ptr b -&gt; IO ()) -&gt; Ptr b -&gt; IO (Ptr b)
forall {m :: * -&gt; *} {a} {a} {b}.
Monad m =&gt;
Int -&gt; (Ptr a -&gt; m a) -&gt; Ptr a -&gt; m (Ptr b)
</span><a href="#local-6989586621679106965"><span class="hs-identifier hs-var">pokeN</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">((Ptr b -&gt; IO ()) -&gt; Ptr b -&gt; IO (Ptr b))
-&gt; (Ptr b -&gt; IO ()) -&gt; Ptr b -&gt; IO (Ptr b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679106983"><span class="annot"><span class="annottext">Ptr b
</span><a href="#local-6989586621679106983"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Ptr b -&gt; Int -&gt; a -&gt; IO ()
forall b. Ptr b -&gt; Int -&gt; a -&gt; IO ()
forall a b. Storable a =&gt; Ptr b -&gt; Int -&gt; a -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/Foreign.Storable.html#pokeByteOff/Foreign.Storable.html#pokeByteOff"><span class="hs-identifier hs-var">pokeByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr b
</span><a href="#local-6989586621679106983"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106981"><span class="hs-identifier hs-var">x1</span></a></span><span>
</span><span id="line-744"></span><span>                                         </span><span class="annot"><span class="annottext">Ptr b -&gt; Int -&gt; a -&gt; IO ()
forall b. Ptr b -&gt; Int -&gt; a -&gt; IO ()
forall a b. Storable a =&gt; Ptr b -&gt; Int -&gt; a -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/Foreign.Storable.html#pokeByteOff/Foreign.Storable.html#pokeByteOff"><span class="hs-identifier hs-var">pokeByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr b
</span><a href="#local-6989586621679106983"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106982"><span class="hs-identifier hs-var">x2</span></a></span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span>    </span><span id="local-6989586621679106954"><span class="annot"><span class="annottext">f3 :: a -&gt; a -&gt; a -&gt; Ptr b -&gt; IO (Ptr b)
</span><a href="#local-6989586621679106954"><span class="hs-identifier hs-var hs-var">f3</span></a></span></span><span> </span><span id="local-6989586621679106993"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106993"><span class="hs-identifier hs-var">x1</span></a></span></span><span> </span><span id="local-6989586621679106994"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106994"><span class="hs-identifier hs-var">x2</span></a></span></span><span> </span><span id="local-6989586621679106995"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106995"><span class="hs-identifier hs-var">x3</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Ptr b -&gt; IO ()) -&gt; Ptr b -&gt; IO (Ptr b)
forall {m :: * -&gt; *} {a} {a} {b}.
Monad m =&gt;
Int -&gt; (Ptr a -&gt; m a) -&gt; Ptr a -&gt; m (Ptr b)
</span><a href="#local-6989586621679106965"><span class="hs-identifier hs-var">pokeN</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">((Ptr b -&gt; IO ()) -&gt; Ptr b -&gt; IO (Ptr b))
-&gt; (Ptr b -&gt; IO ()) -&gt; Ptr b -&gt; IO (Ptr b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679106996"><span class="annot"><span class="annottext">Ptr b
</span><a href="#local-6989586621679106996"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Ptr b -&gt; Int -&gt; a -&gt; IO ()
forall b. Ptr b -&gt; Int -&gt; a -&gt; IO ()
forall a b. Storable a =&gt; Ptr b -&gt; Int -&gt; a -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/Foreign.Storable.html#pokeByteOff/Foreign.Storable.html#pokeByteOff"><span class="hs-identifier hs-var">pokeByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr b
</span><a href="#local-6989586621679106996"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106993"><span class="hs-identifier hs-var">x1</span></a></span><span>
</span><span id="line-747"></span><span>                                         </span><span class="annot"><span class="annottext">Ptr b -&gt; Int -&gt; a -&gt; IO ()
forall b. Ptr b -&gt; Int -&gt; a -&gt; IO ()
forall a b. Storable a =&gt; Ptr b -&gt; Int -&gt; a -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/Foreign.Storable.html#pokeByteOff/Foreign.Storable.html#pokeByteOff"><span class="hs-identifier hs-var">pokeByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr b
</span><a href="#local-6989586621679106996"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106994"><span class="hs-identifier hs-var">x2</span></a></span><span>
</span><span id="line-748"></span><span>                                         </span><span class="annot"><span class="annottext">Ptr b -&gt; Int -&gt; a -&gt; IO ()
forall b. Ptr b -&gt; Int -&gt; a -&gt; IO ()
forall a b. Storable a =&gt; Ptr b -&gt; Int -&gt; a -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/Foreign.Storable.html#pokeByteOff/Foreign.Storable.html#pokeByteOff"><span class="hs-identifier hs-var">pokeByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr b
</span><a href="#local-6989586621679106996"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679106995"><span class="hs-identifier hs-var">x3</span></a></span><span>
</span><span id="line-749"></span><span>
</span><span id="line-750"></span><span>    </span><span id="local-6989586621679106955"><span class="annot"><span class="annottext">f4 :: a -&gt; a -&gt; a -&gt; a -&gt; Ptr b -&gt; IO (Ptr b)
</span><a href="#local-6989586621679106955"><span class="hs-identifier hs-var hs-var">f4</span></a></span></span><span> </span><span id="local-6989586621679107009"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679107009"><span class="hs-identifier hs-var">x1</span></a></span></span><span> </span><span id="local-6989586621679107010"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679107010"><span class="hs-identifier hs-var">x2</span></a></span></span><span> </span><span id="local-6989586621679107011"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679107011"><span class="hs-identifier hs-var">x3</span></a></span></span><span> </span><span id="local-6989586621679107012"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679107012"><span class="hs-identifier hs-var">x4</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Ptr b -&gt; IO ()) -&gt; Ptr b -&gt; IO (Ptr b)
forall {m :: * -&gt; *} {a} {a} {b}.
Monad m =&gt;
Int -&gt; (Ptr a -&gt; m a) -&gt; Ptr a -&gt; m (Ptr b)
</span><a href="#local-6989586621679106965"><span class="hs-identifier hs-var">pokeN</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">((Ptr b -&gt; IO ()) -&gt; Ptr b -&gt; IO (Ptr b))
-&gt; (Ptr b -&gt; IO ()) -&gt; Ptr b -&gt; IO (Ptr b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679107013"><span class="annot"><span class="annottext">Ptr b
</span><a href="#local-6989586621679107013"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Ptr b -&gt; Int -&gt; a -&gt; IO ()
forall b. Ptr b -&gt; Int -&gt; a -&gt; IO ()
forall a b. Storable a =&gt; Ptr b -&gt; Int -&gt; a -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/Foreign.Storable.html#pokeByteOff/Foreign.Storable.html#pokeByteOff"><span class="hs-identifier hs-var">pokeByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr b
</span><a href="#local-6989586621679107013"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679107009"><span class="hs-identifier hs-var">x1</span></a></span><span>
</span><span id="line-751"></span><span>                                         </span><span class="annot"><span class="annottext">Ptr b -&gt; Int -&gt; a -&gt; IO ()
forall b. Ptr b -&gt; Int -&gt; a -&gt; IO ()
forall a b. Storable a =&gt; Ptr b -&gt; Int -&gt; a -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/Foreign.Storable.html#pokeByteOff/Foreign.Storable.html#pokeByteOff"><span class="hs-identifier hs-var">pokeByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr b
</span><a href="#local-6989586621679107013"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679107010"><span class="hs-identifier hs-var">x2</span></a></span><span>
</span><span id="line-752"></span><span>                                         </span><span class="annot"><span class="annottext">Ptr b -&gt; Int -&gt; a -&gt; IO ()
forall b. Ptr b -&gt; Int -&gt; a -&gt; IO ()
forall a b. Storable a =&gt; Ptr b -&gt; Int -&gt; a -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/Foreign.Storable.html#pokeByteOff/Foreign.Storable.html#pokeByteOff"><span class="hs-identifier hs-var">pokeByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr b
</span><a href="#local-6989586621679107013"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679107011"><span class="hs-identifier hs-var">x3</span></a></span><span>
</span><span id="line-753"></span><span>                                         </span><span class="annot"><span class="annottext">Ptr b -&gt; Int -&gt; a -&gt; IO ()
forall b. Ptr b -&gt; Int -&gt; a -&gt; IO ()
forall a b. Storable a =&gt; Ptr b -&gt; Int -&gt; a -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/Foreign.Storable.html#pokeByteOff/Foreign.Storable.html#pokeByteOff"><span class="hs-identifier hs-var">pokeByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr b
</span><a href="#local-6989586621679107013"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679107012"><span class="hs-identifier hs-var">x4</span></a></span><span>
</span><span id="line-754"></span><span>
</span><span id="line-755"></span><span class="hs-comment">-- | Encode a Unicode character to another datatype, using UTF-8. This function</span><span>
</span><span id="line-756"></span><span class="hs-comment">-- acts as an abstract way of encoding characters, as it is unaware of what</span><span>
</span><span id="line-757"></span><span class="hs-comment">-- needs to happen with the resulting bytes: you have to specify functions to</span><span>
</span><span id="line-758"></span><span class="hs-comment">-- deal with those.</span><span>
</span><span id="line-759"></span><span class="hs-comment">--</span><span>
</span><span id="line-760"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.ByteString.Builder.Prim.html#encodeCharUtf8"><span class="hs-pragma hs-type">encodeCharUtf8</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-761"></span><span id="local-6989586621679106697"><span class="annot"><a href="Data.ByteString.Builder.Prim.html#encodeCharUtf8"><span class="hs-identifier hs-type">encodeCharUtf8</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word8/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679106697"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>                             </span><span class="annot"><span class="hs-comment">-- ^ 1-byte UTF-8</span></span><span>
</span><span id="line-762"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word8/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word8/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679106697"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>                    </span><span class="annot"><span class="hs-comment">-- ^ 2-byte UTF-8</span></span><span>
</span><span id="line-763"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word8/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word8/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word8/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679106697"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>           </span><span class="annot"><span class="hs-comment">-- ^ 3-byte UTF-8</span></span><span>
</span><span id="line-764"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word8/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word8/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word8/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word8/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679106697"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ 4-byte UTF-8</span></span><span>
</span><span id="line-765"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#Char/GHC.Types.html#Char"><span class="hs-identifier hs-type">Char</span></a></span><span>                                     </span><span class="annot"><span class="hs-comment">-- ^ Input 'Char'</span></span><span>
</span><span id="line-766"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679106697"><span class="hs-identifier hs-type">a</span></a></span></span><span>                                        </span><span class="annot"><span class="hs-comment">-- ^ Result</span></span><span>
</span><span id="line-767"></span><span id="encodeCharUtf8"><span class="annot"><span class="annottext">encodeCharUtf8 :: forall a.
(Word8 -&gt; a)
-&gt; (Word8 -&gt; Word8 -&gt; a)
-&gt; (Word8 -&gt; Word8 -&gt; Word8 -&gt; a)
-&gt; (Word8 -&gt; Word8 -&gt; Word8 -&gt; Word8 -&gt; a)
-&gt; Char
-&gt; a
</span><a href="Data.ByteString.Builder.Prim.html#encodeCharUtf8"><span class="hs-identifier hs-var hs-var">encodeCharUtf8</span></a></span></span><span> </span><span id="local-6989586621679107023"><span class="annot"><span class="annottext">Word8 -&gt; a
</span><a href="#local-6989586621679107023"><span class="hs-identifier hs-var">f1</span></a></span></span><span> </span><span id="local-6989586621679107024"><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; a
</span><a href="#local-6989586621679107024"><span class="hs-identifier hs-var">f2</span></a></span></span><span> </span><span id="local-6989586621679107025"><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8 -&gt; a
</span><a href="#local-6989586621679107025"><span class="hs-identifier hs-var">f3</span></a></span></span><span> </span><span id="local-6989586621679107026"><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8 -&gt; Word8 -&gt; a
</span><a href="#local-6989586621679107026"><span class="hs-identifier hs-var">f4</span></a></span></span><span> </span><span id="local-6989586621679107027"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679107027"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Int
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#ord/GHC.Base.html#ord"><span class="hs-identifier hs-var">ord</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679107027"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-768"></span><span>    </span><span id="local-6989586621679107028"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679107028"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679107028"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x7F</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; a
</span><a href="#local-6989586621679107023"><span class="hs-identifier hs-var">f1</span></a></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; a) -&gt; Word8 -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word8
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679107028"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-769"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679107028"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x07FF</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-770"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679107035"><span class="annot"><span class="annottext">x1 :: Word8
</span><a href="#local-6989586621679107035"><span class="hs-identifier hs-var hs-var">x1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word8
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word8) -&gt; Int -&gt; Word8
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679107028"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#shiftR/GHC.Bits.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0xC0</span></span><span>
</span><span id="line-771"></span><span>               </span><span id="local-6989586621679107044"><span class="annot"><span class="annottext">x2 :: Word8
</span><a href="#local-6989586621679107044"><span class="hs-identifier hs-var hs-var">x2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word8
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word8) -&gt; Int -&gt; Word8
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679107028"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x3F</span></span><span class="hs-special">)</span><span>   </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x80</span></span><span>
</span><span id="line-772"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; a
</span><a href="#local-6989586621679107024"><span class="hs-identifier hs-var">f2</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679107035"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679107044"><span class="hs-identifier hs-var">x2</span></a></span><span>
</span><span id="line-773"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679107028"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0xFFFF</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-774"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679107051"><span class="annot"><span class="annottext">x1 :: Word8
</span><a href="#local-6989586621679107051"><span class="hs-identifier hs-var hs-var">x1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word8
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word8) -&gt; Int -&gt; Word8
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679107028"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#shiftR/GHC.Bits.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">12</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0xE0</span></span><span>
</span><span id="line-775"></span><span>               </span><span id="local-6989586621679107059"><span class="annot"><span class="annottext">x2 :: Word8
</span><a href="#local-6989586621679107059"><span class="hs-identifier hs-var hs-var">x2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word8
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word8) -&gt; Int -&gt; Word8
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679107028"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#shiftR/GHC.Bits.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x3F</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x80</span></span><span>
</span><span id="line-776"></span><span>               </span><span id="local-6989586621679107066"><span class="annot"><span class="annottext">x3 :: Word8
</span><a href="#local-6989586621679107066"><span class="hs-identifier hs-var hs-var">x3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word8
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word8) -&gt; Int -&gt; Word8
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679107028"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x3F</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x80</span></span><span>
</span><span id="line-777"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8 -&gt; a
</span><a href="#local-6989586621679107025"><span class="hs-identifier hs-var">f3</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679107051"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679107059"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679107066"><span class="hs-identifier hs-var">x3</span></a></span><span>
</span><span id="line-778"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-779"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679107072"><span class="annot"><span class="annottext">x1 :: Word8
</span><a href="#local-6989586621679107072"><span class="hs-identifier hs-var hs-var">x1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word8
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word8) -&gt; Int -&gt; Word8
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679107028"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#shiftR/GHC.Bits.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">18</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0xF0</span></span><span>
</span><span id="line-780"></span><span>               </span><span id="local-6989586621679107080"><span class="annot"><span class="annottext">x2 :: Word8
</span><a href="#local-6989586621679107080"><span class="hs-identifier hs-var hs-var">x2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word8
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word8) -&gt; Int -&gt; Word8
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679107028"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#shiftR/GHC.Bits.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">12</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x3F</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x80</span></span><span>
</span><span id="line-781"></span><span>               </span><span id="local-6989586621679107088"><span class="annot"><span class="annottext">x3 :: Word8
</span><a href="#local-6989586621679107088"><span class="hs-identifier hs-var hs-var">x3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word8
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word8) -&gt; Int -&gt; Word8
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679107028"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#shiftR/GHC.Bits.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x3F</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x80</span></span><span>
</span><span id="line-782"></span><span>               </span><span id="local-6989586621679107095"><span class="annot"><span class="annottext">x4 :: Word8
</span><a href="#local-6989586621679107095"><span class="hs-identifier hs-var hs-var">x4</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word8
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word8) -&gt; Int -&gt; Word8
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679107028"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x3F</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x80</span></span><span>
</span><span id="line-783"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8 -&gt; Word8 -&gt; a
</span><a href="#local-6989586621679107026"><span class="hs-identifier hs-var">f4</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679107072"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679107080"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679107088"><span class="hs-identifier hs-var">x3</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679107095"><span class="hs-identifier hs-var">x4</span></a></span><span>
</span><span id="line-784"></span></pre></body></html>