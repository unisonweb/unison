<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Network.Wai.Middleware.Approot</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">wai-extra-3.1.15: Provides some basic WAI handlers and middleware.</span><ul class="links" id="page-menu"><li><a href="src/Network.Wai.Middleware.Approot.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Network.Wai.Middleware.Approot</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Middleware</a></li><li><a href="#g:2">Common providers</a></li><li><a href="#g:3">Functions for applications</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Middleware for establishing the root of the application.</p><p>Many application need the ability to create URLs referring back to the
 application itself. For example: generate RSS feeds or sitemaps, giving
 users copy-paste links, or sending emails. In many cases, the approot can be
 determined correctly from the request headers. However, some things can
 prevent this, especially reverse proxies. This module provides multiple ways
 of configuring approot discovery, and functions for applications to get that
 approot.</p><p>Approots are structured such that they can be prepended to a string such as
 <code><em>foo</em>bar?baz=bin</code>. For example, if your application is hosted on
 example.com using HTTPS, the approot would be <code><a href="https://example.com">https://example.com</a></code>. Note
 the lack of a trailing slash.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:approotMiddleware">approotMiddleware</a> :: (<a href="../wai-3.2.4/Network-Wai.html#t:Request" title="Network.Wai">Request</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a>) -&gt; <a href="../wai-3.2.4/Network-Wai.html#t:Middleware" title="Network.Wai">Middleware</a></li><li class="src short"><a href="#v:envFallback">envFallback</a> :: <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../wai-3.2.4/Network-Wai.html#t:Middleware" title="Network.Wai">Middleware</a></li><li class="src short"><a href="#v:envFallbackNamed">envFallbackNamed</a> :: <a href="../base-4.18.2.1/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../wai-3.2.4/Network-Wai.html#t:Middleware" title="Network.Wai">Middleware</a></li><li class="src short"><a href="#v:hardcoded">hardcoded</a> :: <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a> -&gt; <a href="../wai-3.2.4/Network-Wai.html#t:Middleware" title="Network.Wai">Middleware</a></li><li class="src short"><a href="#v:fromRequest">fromRequest</a> :: <a href="../wai-3.2.4/Network-Wai.html#t:Middleware" title="Network.Wai">Middleware</a></li><li class="src short"><a href="#v:getApproot">getApproot</a> :: <a href="../wai-3.2.4/Network-Wai.html#t:Request" title="Network.Wai">Request</a> -&gt; <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a></li><li class="src short"><a href="#v:getApprootMay">getApprootMay</a> :: <a href="../wai-3.2.4/Network-Wai.html#t:Request" title="Network.Wai">Request</a> -&gt; <a href="../base-4.18.2.1/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a></li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Middleware</h1></a><div class="top"><p class="src"><a id="v:approotMiddleware" class="def">approotMiddleware</a> <a href="src/Network.Wai.Middleware.Approot.html#approotMiddleware" class="link">Source</a> <a href="#v:approotMiddleware" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="../wai-3.2.4/Network-Wai.html#t:Request" title="Network.Wai">Request</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a>)</td><td class="doc"><p>get the approot</p></td></tr><tr><td class="src">-&gt; <a href="../wai-3.2.4/Network-Wai.html#t:Middleware" title="Network.Wai">Middleware</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>The most generic version of the middleware, allowing you to provide a
 function to get the approot for each request. For many use cases, one of the
 helper functions provided by this module will give the necessary
 functionality more conveniently.</p><p>Since 3.0.7</p></div></div><a href="#g:2" id="g:2"><h1>Common providers</h1></a><div class="top"><p class="src"><a id="v:envFallback" class="def">envFallback</a> :: <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../wai-3.2.4/Network-Wai.html#t:Middleware" title="Network.Wai">Middleware</a> <a href="src/Network.Wai.Middleware.Approot.html#envFallback" class="link">Source</a> <a href="#v:envFallback" class="selflink">#</a></p><div class="doc"><p>Same as <code><code><a href="Network-Wai-Middleware-Approot.html#v:envFallbackNamed" title="Network.Wai.Middleware.Approot">envFallbackNamed</a></code> <a href="APPROOT.html">APPROOT</a></code>.</p><p>The environment variable <code>APPROOT</code> is used by Keter, School of Haskell, and yesod-devel.</p><p>Since 3.0.7</p></div></div><div class="top"><p class="src"><a id="v:envFallbackNamed" class="def">envFallbackNamed</a> :: <a href="../base-4.18.2.1/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../wai-3.2.4/Network-Wai.html#t:Middleware" title="Network.Wai">Middleware</a> <a href="src/Network.Wai.Middleware.Approot.html#envFallbackNamed" class="link">Source</a> <a href="#v:envFallbackNamed" class="selflink">#</a></p><div class="doc"><p>Produce a middleware that takes the approot from the given environment
 variable, falling back to the behavior of <code><a href="Network-Wai-Middleware-Approot.html#v:fromRequest" title="Network.Wai.Middleware.Approot">fromRequest</a></code> if the variable is
 not set.</p><p>Since 3.0.7</p></div></div><div class="top"><p class="src"><a id="v:hardcoded" class="def">hardcoded</a> :: <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a> -&gt; <a href="../wai-3.2.4/Network-Wai.html#t:Middleware" title="Network.Wai">Middleware</a> <a href="src/Network.Wai.Middleware.Approot.html#hardcoded" class="link">Source</a> <a href="#v:hardcoded" class="selflink">#</a></p><div class="doc"><p>Hard-code the given value as the approot.</p><p>Since 3.0.7</p></div></div><div class="top"><p class="src"><a id="v:fromRequest" class="def">fromRequest</a> :: <a href="../wai-3.2.4/Network-Wai.html#t:Middleware" title="Network.Wai">Middleware</a> <a href="src/Network.Wai.Middleware.Approot.html#fromRequest" class="link">Source</a> <a href="#v:fromRequest" class="selflink">#</a></p><div class="doc"><p>Get the approot by analyzing the request. This is not a full-proof
 approach, but in many common cases will work. Situations that can break this
 are:</p><ul><li>Requests which spoof headers and imply the connection is over HTTPS</li><li>Reverse proxies that change ports in surprising ways</li><li>Invalid Host headers</li><li>Reverse proxies which modify the path info</li></ul><p>Normally trusting headers in this way is insecure, however in the case of
 approot, the worst that can happen is that the client will get an incorrect
 URL. If you are relying on the approot for some security-sensitive purpose,
 it is highly recommended to use <code>hardcoded</code>, which cannot be spoofed.</p><p>Since 3.0.7</p></div></div><a href="#g:3" id="g:3"><h1>Functions for applications</h1></a><div class="top"><p class="src"><a id="v:getApproot" class="def">getApproot</a> :: <a href="../wai-3.2.4/Network-Wai.html#t:Request" title="Network.Wai">Request</a> -&gt; <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a> <a href="src/Network.Wai.Middleware.Approot.html#getApproot" class="link">Source</a> <a href="#v:getApproot" class="selflink">#</a></p><div class="doc"><p>Get the approot set by the middleware. If the middleware is not in use,
 then this function will return an exception. For a total version of the
 function, see <code><a href="Network-Wai-Middleware-Approot.html#v:getApprootMay" title="Network.Wai.Middleware.Approot">getApprootMay</a></code>.</p><p>Since 3.0.7</p></div></div><div class="top"><p class="src"><a id="v:getApprootMay" class="def">getApprootMay</a> :: <a href="../wai-3.2.4/Network-Wai.html#t:Request" title="Network.Wai">Request</a> -&gt; <a href="../base-4.18.2.1/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a> <a href="src/Network.Wai.Middleware.Approot.html#getApprootMay" class="link">Source</a> <a href="#v:getApprootMay" class="selflink">#</a></p><div class="doc"><p>A total version of <code><a href="Network-Wai-Middleware-Approot.html#v:getApproot" title="Network.Wai.Middleware.Approot">getApproot</a></code>, which returns <code><a href="../base-4.18.2.1/Data-Maybe.html#v:Nothing" title="Data.Maybe">Nothing</a></code> if the middleware
 is not in use.</p><p>Since 3.0.7</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>