<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Server.Local.Definitions</span><span>
</span><span id="line-2"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Server.Local.Definitions.html#prettyDefinitionsForHQName"><span class="hs-identifier">prettyDefinitionsForHQName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-3"></span><span>    </span><span class="annot"><a href="Unison.Server.Local.Definitions.html#termDefinitionByName"><span class="hs-identifier">termDefinitionByName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-4"></span><span>    </span><span class="annot"><a href="Unison.Server.Local.Definitions.html#typeDefinitionByName"><span class="hs-identifier">typeDefinitionByName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span class="hs-keyword">where</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(??)</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapMaybeT</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set.NonEmpty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NESet</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Branch</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2Branch</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Causal</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2Causal</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TermReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TypeReference</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Codebase</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Codebase</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Editor.DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DisplayObject</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Path</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Path</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Runtime</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Rt</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DataDeclaration</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DD</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.HashQualified</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HQ</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.HashQualifiedPrime</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HQ'</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NamesWithHistory</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NS</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NamesWithHistory</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Names</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnv</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPE</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPED</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Reference</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Referent</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html"><span class="hs-identifier">Unison.Server.Backend</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html"><span class="hs-identifier">Unison.Server.Backend</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Backend</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Doc.html"><span class="hs-identifier">Unison.Server.Doc</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Doc</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Local.html"><span class="hs-identifier">Unison.Server.Local</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Local</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.html"><span class="hs-identifier">Unison.Server.NameSearch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.NameSearch.html#NameSearch"><span class="hs-identifier">NameSearch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.html"><span class="hs-identifier">Unison.Server.NameSearch</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NS</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.html"><span class="hs-identifier">Unison.Server.NameSearch</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NameSearch</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.FromNames.html"><span class="hs-identifier">Unison.Server.NameSearch.FromNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.NameSearch.FromNames.html#makeNameSearch"><span class="hs-identifier">makeNameSearch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Types.html"><span class="hs-identifier">Unison.Server.Types</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Sqlite</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Sqlite</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.HashQualified</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HQ</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toText</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Term</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Term</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Type</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Width</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="annot"><span class="hs-comment">-- | Renders a definition for the given name or hash alongside its documentation.</span></span><span>
</span><span id="line-51"></span><span class="annot"><a href="Unison.Server.Local.Definitions.html#prettyDefinitionsForHQName"><span class="hs-identifier hs-type">prettyDefinitionsForHQName</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-comment">-- | The path representing the user's current perspective.</span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-comment">-- Searches will be limited to definitions within this path, and names will be relative to</span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-comment">-- this path.</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The root branch to use</span></span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">V2Branch.CausalBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Whether to suffixify bindings in the rendered syntax</span></span><span>
</span><span id="line-60"></span><span>  </span><span class="annot"><a href="Unison.Server.Types.html#Suffixify"><span class="hs-identifier hs-type">Suffixify</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Runtime used to evaluate docs. This should be sandboxed if run on the server.</span></span><span>
</span><span id="line-62"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-63"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The name, hash, or both, of the definition to display.</span></span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#DefinitionDisplayResults"><span class="hs-identifier hs-type">DefinitionDisplayResults</span></a></span><span>
</span><span id="line-67"></span><span id="prettyDefinitionsForHQName"><span class="annot"><span class="annottext">prettyDefinitionsForHQName :: Path
-&gt; CausalBranch Transaction
-&gt; Maybe Width
-&gt; Suffixify
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; HashQualified Name
-&gt; Backend IO DefinitionDisplayResults
</span><a href="Unison.Server.Local.Definitions.html#prettyDefinitionsForHQName"><span class="hs-identifier hs-var hs-var">prettyDefinitionsForHQName</span></a></span></span><span> </span><span id="local-6989586621679353596"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679353596"><span class="hs-identifier hs-var">perspective</span></a></span></span><span> </span><span id="local-6989586621679353597"><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679353597"><span class="hs-identifier hs-var">shallowRoot</span></a></span></span><span> </span><span id="local-6989586621679353598"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679353598"><span class="hs-identifier hs-var">renderWidth</span></a></span></span><span> </span><span id="local-6989586621679353599"><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621679353599"><span class="hs-identifier hs-var">suffixifyBindings</span></a></span></span><span> </span><span id="local-6989586621679353600"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679353600"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679353601"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353601"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679353602"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679353602"><span class="hs-identifier hs-var">perspectiveQuery</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-68"></span><span>  </span><span id="local-6989586621679353603"><span class="annot"><span class="annottext">Either
  BackendError (CausalBranch Transaction, Path, HashQualified Name)
</span><a href="#local-6989586621679353603"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO
  (Either
     BackendError (CausalBranch Transaction, Path, HashQualified Name))
-&gt; Backend
     IO
     (Either
        BackendError (CausalBranch Transaction, Path, HashQualified Name))
forall a. IO a -&gt; Backend IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO
   (Either
      BackendError (CausalBranch Transaction, Path, HashQualified Name))
 -&gt; Backend
      IO
      (Either
         BackendError (CausalBranch Transaction, Path, HashQualified Name)))
-&gt; (Transaction
      (Either
         BackendError (CausalBranch Transaction, Path, HashQualified Name))
    -&gt; IO
         (Either
            BackendError (CausalBranch Transaction, Path, HashQualified Name)))
-&gt; Transaction
     (Either
        BackendError (CausalBranch Transaction, Path, HashQualified Name))
-&gt; Backend
     IO
     (Either
        BackendError (CausalBranch Transaction, Path, HashQualified Name))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Transaction
     (Either
        BackendError (CausalBranch Transaction, Path, HashQualified Name))
-&gt; IO
     (Either
        BackendError (CausalBranch Transaction, Path, HashQualified Name))
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353601"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">(Transaction
   (Either
      BackendError (CausalBranch Transaction, Path, HashQualified Name))
 -&gt; Backend
      IO
      (Either
         BackendError (CausalBranch Transaction, Path, HashQualified Name)))
-&gt; Transaction
     (Either
        BackendError (CausalBranch Transaction, Path, HashQualified Name))
-&gt; Backend
     IO
     (Either
        BackendError (CausalBranch Transaction, Path, HashQualified Name))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-69"></span><span>    </span><span id="local-6989586621679353607"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621679353607"><span class="hs-identifier hs-var">shallowBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction -&gt; Transaction (Branch Transaction)
forall (m :: * -&gt; *) hc he pe e. Causal m hc he pe e -&gt; m e
</span><span class="hs-identifier hs-var">V2Causal.value</span></span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679353597"><span class="hs-identifier hs-var">shallowRoot</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="annottext">Path
-&gt; HashQualified Name
-&gt; Branch Transaction
-&gt; Transaction (Either BackendError (Path, HashQualified Name))
</span><a href="Unison.Server.Local.html#relocateToNameRoot"><span class="hs-identifier hs-var">Local.relocateToNameRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679353596"><span class="hs-identifier hs-var">perspective</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679353602"><span class="hs-identifier hs-var">perspectiveQuery</span></a></span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621679353607"><span class="hs-identifier hs-var">shallowBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Transaction (Either BackendError (Path, HashQualified Name))
-&gt; (Either BackendError (Path, HashQualified Name)
    -&gt; Transaction
         (Either
            BackendError (CausalBranch Transaction, Path, HashQualified Name)))
-&gt; Transaction
     (Either
        BackendError (CausalBranch Transaction, Path, HashQualified Name))
forall a b. Transaction a -&gt; (a -&gt; Transaction b) -&gt; Transaction b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-71"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679353610"><span class="annot"><span class="annottext">BackendError
</span><a href="#local-6989586621679353610"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  BackendError (CausalBranch Transaction, Path, HashQualified Name)
-&gt; Transaction
     (Either
        BackendError (CausalBranch Transaction, Path, HashQualified Name))
forall a. a -&gt; Transaction a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either
   BackendError (CausalBranch Transaction, Path, HashQualified Name)
 -&gt; Transaction
      (Either
         BackendError (CausalBranch Transaction, Path, HashQualified Name)))
-&gt; Either
     BackendError (CausalBranch Transaction, Path, HashQualified Name)
-&gt; Transaction
     (Either
        BackendError (CausalBranch Transaction, Path, HashQualified Name))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BackendError
-&gt; Either
     BackendError (CausalBranch Transaction, Path, HashQualified Name)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">BackendError
</span><a href="#local-6989586621679353610"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-72"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679353611"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679353611"><span class="hs-identifier hs-var">namesRoot</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353612"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679353612"><span class="hs-identifier hs-var">locatedQuery</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-73"></span><span>        </span><span class="annot"><span class="annottext">Either
  BackendError (CausalBranch Transaction, Path, HashQualified Name)
-&gt; Transaction
     (Either
        BackendError (CausalBranch Transaction, Path, HashQualified Name))
forall a. a -&gt; Transaction a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either
   BackendError (CausalBranch Transaction, Path, HashQualified Name)
 -&gt; Transaction
      (Either
         BackendError (CausalBranch Transaction, Path, HashQualified Name)))
-&gt; Either
     BackendError (CausalBranch Transaction, Path, HashQualified Name)
-&gt; Transaction
     (Either
        BackendError (CausalBranch Transaction, Path, HashQualified Name))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(CausalBranch Transaction, Path, HashQualified Name)
-&gt; Either
     BackendError (CausalBranch Transaction, Path, HashQualified Name)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679353597"><span class="hs-identifier hs-var">shallowRoot</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679353611"><span class="hs-identifier hs-var">namesRoot</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679353612"><span class="hs-identifier hs-var">locatedQuery</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679353613"><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679353613"><span class="hs-identifier hs-var">shallowRoot</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353614"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679353614"><span class="hs-identifier hs-var">namesRoot</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353615"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679353615"><span class="hs-identifier hs-var">query</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(BackendError
 -&gt; Backend IO (CausalBranch Transaction, Path, HashQualified Name))
-&gt; ((CausalBranch Transaction, Path, HashQualified Name)
    -&gt; Backend IO (CausalBranch Transaction, Path, HashQualified Name))
-&gt; Either
     BackendError (CausalBranch Transaction, Path, HashQualified Name)
-&gt; Backend IO (CausalBranch Transaction, Path, HashQualified Name)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">BackendError
-&gt; Backend IO (CausalBranch Transaction, Path, HashQualified Name)
forall a. BackendError -&gt; Backend IO a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CausalBranch Transaction, Path, HashQualified Name)
-&gt; Backend IO (CausalBranch Transaction, Path, HashQualified Name)
forall a. a -&gt; Backend IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Either
  BackendError (CausalBranch Transaction, Path, HashQualified Name)
</span><a href="#local-6989586621679353603"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-comment">-- Bias towards both relative and absolute path to queries,</span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-comment">-- This allows us to still bias towards definitions outside our perspective but within the</span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-comment">-- same tree;</span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-comment">-- e.g. if the query is `map` and we're in `base.trunk.List`,</span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-comment">-- we bias towards `map` and `.base.trunk.List.map` which ensures we still prefer names in</span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-comment">-- `trunk` over those in other releases.</span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-comment">-- ppe which returns names fully qualified to the current perspective,  not to the codebase root.</span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679353618"><span class="annot"><span class="annottext">biases :: [Name]
</span><a href="#local-6989586621679353618"><span class="hs-identifier hs-var hs-var">biases</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; [Name]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Name -&gt; [Name]) -&gt; Maybe Name -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Maybe Name
forall n. HashQualified n -&gt; Maybe n
</span><span class="hs-identifier hs-var">HQ.toName</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679353615"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span id="local-6989586621679353621"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679353621"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Backend IO Int
forall a. IO a -&gt; Backend IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Int -&gt; Backend IO Int) -&gt; IO Int -&gt; Backend IO Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Transaction Int -&gt; IO Int
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353601"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">(Transaction Int -&gt; IO Int) -&gt; Transaction Int -&gt; IO Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Transaction Int
</span><span class="hs-identifier hs-var">Codebase.hashLength</span></span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679353623"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679353623"><span class="hs-identifier hs-var">localNamesOnly</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353624"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679353624"><span class="hs-identifier hs-var">unbiasedPPED</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; CausalBranch Transaction
-&gt; Path
-&gt; Backend IO (Names, PrettyPrintEnvDecl)
forall (m :: * -&gt; *) (n :: * -&gt; *) v a.
MonadIO m =&gt;
Codebase m v a
-&gt; CausalBranch n -&gt; Path -&gt; Backend m (Names, PrettyPrintEnvDecl)
</span><a href="Unison.Server.Backend.html#namesAtPathFromRootBranchHash"><span class="hs-identifier hs-var">namesAtPathFromRootBranchHash</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353601"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679353613"><span class="hs-identifier hs-var">shallowRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679353614"><span class="hs-identifier hs-var">namesRoot</span></a></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679353626"><span class="annot"><span class="annottext">pped :: PrettyPrintEnvDecl
</span><a href="#local-6989586621679353626"><span class="hs-identifier hs-var hs-var">pped</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; PrettyPrintEnvDecl -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.biasTo</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679353618"><span class="hs-identifier hs-var">biases</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679353624"><span class="hs-identifier hs-var">unbiasedPPED</span></a></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679353628"><span class="annot"><span class="annottext">nameSearch :: NameSearch Transaction
</span><a href="#local-6989586621679353628"><span class="hs-identifier hs-var hs-var">nameSearch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Names -&gt; NameSearch Transaction
forall (m :: * -&gt; *). Applicative m =&gt; Int -&gt; Names -&gt; NameSearch m
</span><a href="Unison.Server.NameSearch.FromNames.html#makeNameSearch"><span class="hs-identifier hs-var">makeNameSearch</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679353621"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679353623"><span class="hs-identifier hs-var">localNamesOnly</span></a></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier hs-type">DefinitionResults</span></a></span><span> </span><span id="local-6989586621679353630"><span class="annot"><span class="annottext">Map Reference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="#local-6989586621679353630"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span id="local-6989586621679353631"><span class="annot"><span class="annottext">Map Reference (DisplayObject () (Decl Symbol Ann))
</span><a href="#local-6989586621679353631"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span id="local-6989586621679353632"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679353632"><span class="hs-identifier hs-var">misses</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO DefinitionResults -&gt; Backend IO DefinitionResults
forall a. IO a -&gt; Backend IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO DefinitionResults -&gt; Backend IO DefinitionResults)
-&gt; IO DefinitionResults -&gt; Backend IO DefinitionResults
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Transaction DefinitionResults -&gt; IO DefinitionResults
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353601"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; NameSearch Transaction
-&gt; IncludeCycles
-&gt; SearchType
-&gt; [HashQualified Name]
-&gt; Transaction DefinitionResults
forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; NameSearch Transaction
-&gt; IncludeCycles
-&gt; SearchType
-&gt; [HashQualified Name]
-&gt; Transaction DefinitionResults
</span><a href="Unison.Server.Backend.html#definitionsByName"><span class="hs-identifier hs-var">definitionsByName</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353601"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679353628"><span class="hs-identifier hs-var">nameSearch</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeCycles
</span><a href="Unison.Server.Backend.html#DontIncludeCycles"><span class="hs-identifier hs-var">DontIncludeCycles</span></a></span><span> </span><span class="annot"><span class="annottext">SearchType
</span><span class="hs-identifier hs-var">Names.ExactName</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679353615"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679353636"><span class="annot"><span class="annottext">width :: Width
</span><a href="#local-6989586621679353636"><span class="hs-identifier hs-var hs-var">width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Width -&gt; Width
</span><a href="Unison.Server.Types.html#mayDefaultWidth"><span class="hs-identifier hs-var">mayDefaultWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679353598"><span class="hs-identifier hs-var">renderWidth</span></a></span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679353638"><span class="hs-identifier hs-type">docResults</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Types.html#HashQualifiedName"><span class="hs-identifier hs-type">HashQualifiedName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#UnisonHash"><span class="hs-identifier hs-type">UnisonHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Doc.html#Doc"><span class="hs-identifier hs-type">Doc.Doc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-91"></span><span>      </span><span id="local-6989586621679353638"><span class="annot"><span class="annottext">docResults :: Name -&gt; IO [(Text, Text, Doc)]
</span><a href="#local-6989586621679353638"><span class="hs-identifier hs-var hs-var">docResults</span></a></span></span><span> </span><span id="local-6989586621679353641"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679353641"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-92"></span><span>        </span><span id="local-6989586621679353642"><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679353642"><span class="hs-identifier hs-var">docRefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Transaction [Reference] -&gt; IO [Reference]
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353601"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">(Transaction [Reference] -&gt; IO [Reference])
-&gt; Transaction [Reference] -&gt; IO [Reference]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; NameSearch Transaction
-&gt; SearchType
-&gt; Name
-&gt; Transaction [Reference]
</span><a href="Unison.Server.Backend.html#docsForDefinitionName"><span class="hs-identifier hs-var">docsForDefinitionName</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353601"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679353628"><span class="hs-identifier hs-var">nameSearch</span></a></span><span> </span><span class="annot"><span class="annottext">SearchType
</span><span class="hs-identifier hs-var">Names.ExactName</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679353641"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-93"></span><span>        </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
-&gt; Width
-&gt; Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; [Reference]
-&gt; IO [(Text, Text, Doc, [Error])]
forall (t :: * -&gt; *).
Traversable t =&gt;
PrettyPrintEnvDecl
-&gt; Width
-&gt; Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; t Reference
-&gt; IO (t (Text, Text, Doc, [Error]))
</span><a href="Unison.Server.Backend.html#renderDocRefs"><span class="hs-identifier hs-var">renderDocRefs</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679353626"><span class="hs-identifier hs-var">pped</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679353636"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353601"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679353600"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679353642"><span class="hs-identifier hs-var">docRefs</span></a></span><span>
</span><span id="line-94"></span><span>          </span><span class="hs-comment">-- local server currently ignores doc eval errors</span><span>
</span><span id="line-95"></span><span>          </span><span class="annot"><span class="annottext">IO [(Text, Text, Doc, [Error])]
-&gt; ([(Text, Text, Doc, [Error])] -&gt; [(Text, Text, Doc)])
-&gt; IO [(Text, Text, Doc)]
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">((Text, Text, Doc, [Error]) -&gt; (Text, Text, Doc))
-&gt; [(Text, Text, Doc, [Error])] -&gt; [(Text, Text, Doc)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679353646"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679353646"><span class="hs-identifier hs-var">hqn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353647"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679353647"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353648"><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621679353648"><span class="hs-identifier hs-var">doc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353649"><span class="annot"><span class="annottext">[Error]
</span><a href="#local-6989586621679353649"><span class="hs-identifier hs-var">_errs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679353646"><span class="hs-identifier hs-var">hqn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679353647"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621679353648"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679353650"><span class="annot"><span class="annottext">fqnPPE :: PrettyPrintEnv
</span><a href="#local-6989586621679353650"><span class="hs-identifier hs-var hs-var">fqnPPE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.unsuffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679353626"><span class="hs-identifier hs-var">pped</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span id="local-6989586621679353652"><span class="annot"><span class="annottext">Map Reference TypeDefinition
</span><a href="#local-6989586621679353652"><span class="hs-identifier hs-var">typeDefinitions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><span class="annottext">Map
  Reference
  (DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference)))
-&gt; (Reference
    -&gt; DisplayObject
         (AnnotatedText (Element Reference))
         (AnnotatedText (Element Reference))
    -&gt; Backend IO TypeDefinition)
-&gt; Backend IO (Map Reference TypeDefinition)
forall i (t :: * -&gt; *) (f :: * -&gt; *) a b.
(TraversableWithIndex i t, Applicative f) =&gt;
t a -&gt; (i -&gt; a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">ifor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; Traversal
     (Map Reference (DisplayObject () (Decl Symbol Ann)))
     (Map
        Reference
        (DisplayObject
           (AnnotatedText (Element Reference))
           (AnnotatedText (Element Reference))))
     (Reference, DisplayObject () (Decl Symbol Ann))
     (Reference,
      DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
-&gt; Map Reference (DisplayObject () (Decl Symbol Ann))
-&gt; Map
     Reference
     (DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
forall v a s t.
(Var v, Ord a) =&gt;
Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; Traversal
     s
     t
     (Reference, DisplayObject () (Decl v a))
     (Reference,
      DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
-&gt; s
-&gt; t
</span><a href="Unison.Server.Backend.html#typesToSyntaxOf"><span class="hs-identifier hs-var">typesToSyntaxOf</span></a></span><span> </span><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621679353599"><span class="hs-identifier hs-var">suffixifyBindings</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679353636"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679353626"><span class="hs-identifier hs-var">pped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([(Reference, DisplayObject () (Decl Symbol Ann))]
 -&gt; f [(Reference,
        DisplayObject
          (AnnotatedText (Element Reference))
          (AnnotatedText (Element Reference)))])
-&gt; Map Reference (DisplayObject () (Decl Symbol Ann))
-&gt; f (Map
        Reference
        (DisplayObject
           (AnnotatedText (Element Reference))
           (AnnotatedText (Element Reference))))
forall k' k v v'.
Ord k' =&gt;
Traversal (Map k v) (Map k' v') [(k, v)] [(k', v')]
Traversal
  (Map Reference (DisplayObject () (Decl Symbol Ann)))
  (Map
     Reference
     (DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference))))
  [(Reference, DisplayObject () (Decl Symbol Ann))]
  [(Reference,
    DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))]
</span><span class="hs-identifier hs-var">Map.asList_</span></span><span> </span><span class="annot"><span class="annottext">(([(Reference, DisplayObject () (Decl Symbol Ann))]
  -&gt; f [(Reference,
         DisplayObject
           (AnnotatedText (Element Reference))
           (AnnotatedText (Element Reference)))])
 -&gt; Map Reference (DisplayObject () (Decl Symbol Ann))
 -&gt; f (Map
         Reference
         (DisplayObject
            (AnnotatedText (Element Reference))
            (AnnotatedText (Element Reference)))))
-&gt; (((Reference, DisplayObject () (Decl Symbol Ann))
     -&gt; f (Reference,
           DisplayObject
             (AnnotatedText (Element Reference))
             (AnnotatedText (Element Reference))))
    -&gt; [(Reference, DisplayObject () (Decl Symbol Ann))]
    -&gt; f [(Reference,
           DisplayObject
             (AnnotatedText (Element Reference))
             (AnnotatedText (Element Reference)))])
-&gt; ((Reference, DisplayObject () (Decl Symbol Ann))
    -&gt; f (Reference,
          DisplayObject
            (AnnotatedText (Element Reference))
            (AnnotatedText (Element Reference))))
-&gt; Map Reference (DisplayObject () (Decl Symbol Ann))
-&gt; f (Map
        Reference
        (DisplayObject
           (AnnotatedText (Element Reference))
           (AnnotatedText (Element Reference))))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Reference, DisplayObject () (Decl Symbol Ann))
 -&gt; f (Reference,
       DisplayObject
         (AnnotatedText (Element Reference))
         (AnnotatedText (Element Reference))))
-&gt; [(Reference, DisplayObject () (Decl Symbol Ann))]
-&gt; f [(Reference,
       DisplayObject
         (AnnotatedText (Element Reference))
         (AnnotatedText (Element Reference)))]
forall (f :: * -&gt; *) a b.
Traversable f =&gt;
IndexedTraversal Int (f a) (f b) a b
IndexedTraversal
  Int
  [(Reference, DisplayObject () (Decl Symbol Ann))]
  [(Reference,
    DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))]
  (Reference, DisplayObject () (Decl Symbol Ann))
  (Reference,
   DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference)))
</span><span class="hs-identifier hs-var">traversed</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Reference (DisplayObject () (Decl Symbol Ann))
</span><a href="#local-6989586621679353631"><span class="hs-identifier hs-var">types</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679353667"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353667"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621679353668"><span class="annot"><span class="annottext">DisplayObject
  (AnnotatedText (Element Reference))
  (AnnotatedText (Element Reference))
</span><a href="#local-6989586621679353668"><span class="hs-identifier hs-var">tp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-100"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679353669"><span class="annot"><span class="annottext">hqTypeName :: HashQualified Name
</span><a href="#local-6989586621679353669"><span class="hs-identifier hs-var hs-var">hqTypeName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Reference -&gt; HashQualified Name
</span><span class="hs-identifier hs-var">PPE.typeNameOrHashOnly</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679353650"><span class="hs-identifier hs-var">fqnPPE</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353667"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-101"></span><span>      </span><span id="local-6989586621679353671"><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621679353671"><span class="hs-identifier hs-var">docs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [(Text, Text, Doc)] -&gt; Backend IO [(Text, Text, Doc)]
forall a. IO a -&gt; Backend IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [(Text, Text, Doc)] -&gt; Backend IO [(Text, Text, Doc)])
-&gt; IO [(Text, Text, Doc)] -&gt; Backend IO [(Text, Text, Doc)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO [(Text, Text, Doc)]
-&gt; (Name -&gt; IO [(Text, Text, Doc)])
-&gt; Maybe Name
-&gt; IO [(Text, Text, Doc)]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Text, Text, Doc)] -&gt; IO [(Text, Text, Doc)]
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IO [(Text, Text, Doc)]
</span><a href="#local-6989586621679353638"><span class="hs-identifier hs-var">docResults</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; Maybe Name
forall n. HashQualified n -&gt; Maybe n
</span><span class="hs-identifier hs-var">HQ.toName</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679353669"><span class="hs-identifier hs-var">hqTypeName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>      </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; PrettyPrintEnvDecl
-&gt; Width
-&gt; Reference
-&gt; [(Text, Text, Doc)]
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
-&gt; Backend IO TypeDefinition
forall (m :: * -&gt; *).
MonadIO m =&gt;
Codebase IO Symbol Ann
-&gt; PrettyPrintEnvDecl
-&gt; Width
-&gt; Reference
-&gt; [(Text, Text, Doc)]
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
-&gt; m TypeDefinition
</span><a href="Unison.Server.Backend.html#mkTypeDefinition"><span class="hs-identifier hs-var">mkTypeDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353601"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679353626"><span class="hs-identifier hs-var">pped</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679353636"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353667"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621679353671"><span class="hs-identifier hs-var">docs</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayObject
  (AnnotatedText (Element Reference))
  (AnnotatedText (Element Reference))
</span><a href="#local-6989586621679353668"><span class="hs-identifier hs-var">tp</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span id="local-6989586621679353674"><span class="annot"><span class="annottext">Map Reference TermDefinition
</span><a href="#local-6989586621679353674"><span class="hs-identifier hs-var">termDefinitions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><span class="annottext">Map
  Reference
  (DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference)))
-&gt; (Reference
    -&gt; DisplayObject
         (AnnotatedText (Element Reference))
         (AnnotatedText (Element Reference))
    -&gt; Backend IO TermDefinition)
-&gt; Backend IO (Map Reference TermDefinition)
forall i (t :: * -&gt; *) (f :: * -&gt; *) a b.
(TraversableWithIndex i t, Applicative f) =&gt;
t a -&gt; (i -&gt; a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">ifor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; Traversal
     (Map Reference (DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
     (Map
        Reference
        (DisplayObject
           (AnnotatedText (Element Reference))
           (AnnotatedText (Element Reference))))
     (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))
     (Reference,
      DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
-&gt; Map
     Reference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
-&gt; Map
     Reference
     (DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
forall v a s t.
(Var v, Ord a) =&gt;
Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; Traversal
     s
     t
     (Reference, DisplayObject (Type v a) (Term v a))
     (Reference,
      DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
-&gt; s
-&gt; t
</span><a href="Unison.Server.Backend.html#termsToSyntaxOf"><span class="hs-identifier hs-var">termsToSyntaxOf</span></a></span><span> </span><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621679353599"><span class="hs-identifier hs-var">suffixifyBindings</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679353636"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679353626"><span class="hs-identifier hs-var">pped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([(Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))]
 -&gt; f [(Reference,
        DisplayObject
          (AnnotatedText (Element Reference))
          (AnnotatedText (Element Reference)))])
-&gt; Map
     Reference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
-&gt; f (Map
        Reference
        (DisplayObject
           (AnnotatedText (Element Reference))
           (AnnotatedText (Element Reference))))
forall k' k v v'.
Ord k' =&gt;
Traversal (Map k v) (Map k' v') [(k, v)] [(k', v')]
Traversal
  (Map Reference (DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
  (Map
     Reference
     (DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference))))
  [(Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))]
  [(Reference,
    DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))]
</span><span class="hs-identifier hs-var">Map.asList_</span></span><span> </span><span class="annot"><span class="annottext">(([(Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))]
  -&gt; f [(Reference,
         DisplayObject
           (AnnotatedText (Element Reference))
           (AnnotatedText (Element Reference)))])
 -&gt; Map
      Reference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
 -&gt; f (Map
         Reference
         (DisplayObject
            (AnnotatedText (Element Reference))
            (AnnotatedText (Element Reference)))))
-&gt; (((Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))
     -&gt; f (Reference,
           DisplayObject
             (AnnotatedText (Element Reference))
             (AnnotatedText (Element Reference))))
    -&gt; [(Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))]
    -&gt; f [(Reference,
           DisplayObject
             (AnnotatedText (Element Reference))
             (AnnotatedText (Element Reference)))])
-&gt; ((Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))
    -&gt; f (Reference,
          DisplayObject
            (AnnotatedText (Element Reference))
            (AnnotatedText (Element Reference))))
-&gt; Map
     Reference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
-&gt; f (Map
        Reference
        (DisplayObject
           (AnnotatedText (Element Reference))
           (AnnotatedText (Element Reference))))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))
 -&gt; f (Reference,
       DisplayObject
         (AnnotatedText (Element Reference))
         (AnnotatedText (Element Reference))))
-&gt; [(Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))]
-&gt; f [(Reference,
       DisplayObject
         (AnnotatedText (Element Reference))
         (AnnotatedText (Element Reference)))]
forall (f :: * -&gt; *) a b.
Traversable f =&gt;
IndexedTraversal Int (f a) (f b) a b
IndexedTraversal
  Int
  [(Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))]
  [(Reference,
    DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))]
  (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))
  (Reference,
   DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference)))
</span><span class="hs-identifier hs-var">traversed</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Reference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="#local-6989586621679353630"><span class="hs-identifier hs-var">terms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679353683"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353683"><span class="hs-identifier hs-var">reference</span></a></span></span><span> </span><span id="local-6989586621679353684"><span class="annot"><span class="annottext">DisplayObject
  (AnnotatedText (Element Reference))
  (AnnotatedText (Element Reference))
</span><a href="#local-6989586621679353684"><span class="hs-identifier hs-var">trm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-105"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679353685"><span class="annot"><span class="annottext">referent :: Referent
</span><a href="#local-6989586621679353685"><span class="hs-identifier hs-var hs-var">referent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353683"><span class="hs-identifier hs-var">reference</span></a></span><span>
</span><span id="line-106"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679353687"><span class="annot"><span class="annottext">hqTermName :: HashQualified Name
</span><a href="#local-6989586621679353687"><span class="hs-identifier hs-var hs-var">hqTermName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Referent -&gt; HashQualified Name
</span><span class="hs-identifier hs-var">PPE.termNameOrHashOnly</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679353650"><span class="hs-identifier hs-var">fqnPPE</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679353685"><span class="hs-identifier hs-var">referent</span></a></span><span>
</span><span id="line-107"></span><span>      </span><span id="local-6989586621679353689"><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621679353689"><span class="hs-identifier hs-var">docs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [(Text, Text, Doc)] -&gt; Backend IO [(Text, Text, Doc)]
forall a. IO a -&gt; Backend IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [(Text, Text, Doc)] -&gt; Backend IO [(Text, Text, Doc)])
-&gt; IO [(Text, Text, Doc)] -&gt; Backend IO [(Text, Text, Doc)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO [(Text, Text, Doc)]
-&gt; (Name -&gt; IO [(Text, Text, Doc)])
-&gt; Maybe Name
-&gt; IO [(Text, Text, Doc)]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Text, Text, Doc)] -&gt; IO [(Text, Text, Doc)]
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IO [(Text, Text, Doc)]
</span><a href="#local-6989586621679353638"><span class="hs-identifier hs-var">docResults</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; Maybe Name
forall n. HashQualified n -&gt; Maybe n
</span><span class="hs-identifier hs-var">HQ.toName</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679353687"><span class="hs-identifier hs-var">hqTermName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>      </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; PrettyPrintEnvDecl
-&gt; Width
-&gt; Reference
-&gt; [(Text, Text, Doc)]
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
-&gt; Backend IO TermDefinition
</span><a href="Unison.Server.Backend.html#mkTermDefinition"><span class="hs-identifier hs-var">mkTermDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353601"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679353626"><span class="hs-identifier hs-var">pped</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679353636"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353683"><span class="hs-identifier hs-var">reference</span></a></span><span> </span><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621679353689"><span class="hs-identifier hs-var">docs</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayObject
  (AnnotatedText (Element Reference))
  (AnnotatedText (Element Reference))
</span><a href="#local-6989586621679353684"><span class="hs-identifier hs-var">trm</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679353691"><span class="annot"><span class="annottext">renderedDisplayTerms :: Map Text TermDefinition
</span><a href="#local-6989586621679353691"><span class="hs-identifier hs-var hs-var">renderedDisplayTerms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Text)
-&gt; Map Reference TermDefinition -&gt; Map Text TermDefinition
forall k2 k1 a. Ord k2 =&gt; (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">Map.mapKeys</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">Map Reference TermDefinition
</span><a href="#local-6989586621679353674"><span class="hs-identifier hs-var">termDefinitions</span></a></span><span>
</span><span id="line-110"></span><span>      </span><span id="local-6989586621679353694"><span class="annot"><span class="annottext">renderedDisplayTypes :: Map Text TypeDefinition
</span><a href="#local-6989586621679353694"><span class="hs-identifier hs-var hs-var">renderedDisplayTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Text)
-&gt; Map Reference TypeDefinition -&gt; Map Text TypeDefinition
forall k2 k1 a. Ord k2 =&gt; (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">Map.mapKeys</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">Map Reference TypeDefinition
</span><a href="#local-6989586621679353652"><span class="hs-identifier hs-var">typeDefinitions</span></a></span><span>
</span><span id="line-111"></span><span>      </span><span id="local-6989586621679353695"><span class="annot"><span class="annottext">renderedMisses :: [Text]
</span><a href="#local-6989586621679353695"><span class="hs-identifier hs-var hs-var">renderedMisses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; Text) -&gt; [HashQualified Name] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
</span><span class="hs-identifier hs-var">HQ.toText</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679353632"><span class="hs-identifier hs-var">misses</span></a></span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><span class="annottext">DefinitionDisplayResults -&gt; Backend IO DefinitionDisplayResults
forall a. a -&gt; Backend IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(DefinitionDisplayResults -&gt; Backend IO DefinitionDisplayResults)
-&gt; DefinitionDisplayResults -&gt; Backend IO DefinitionDisplayResults
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><span class="annottext">Map Text TermDefinition
-&gt; Map Text TypeDefinition -&gt; [Text] -&gt; DefinitionDisplayResults
</span><a href="Unison.Server.Types.html#DefinitionDisplayResults"><span class="hs-identifier hs-var">DefinitionDisplayResults</span></a></span><span>
</span><span id="line-114"></span><span>      </span><span class="annot"><span class="annottext">Map Text TermDefinition
</span><a href="#local-6989586621679353691"><span class="hs-identifier hs-var">renderedDisplayTerms</span></a></span><span>
</span><span id="line-115"></span><span>      </span><span class="annot"><span class="annottext">Map Text TypeDefinition
</span><a href="#local-6989586621679353694"><span class="hs-identifier hs-var">renderedDisplayTypes</span></a></span><span>
</span><span id="line-116"></span><span>      </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679353695"><span class="hs-identifier hs-var">renderedMisses</span></a></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="annot"><span class="hs-comment">-- | Find the term referenced by the given name and return a display object for it.</span></span><span>
</span><span id="line-119"></span><span id="local-6989586621679353438"><span class="annot"><a href="Unison.Server.Local.Definitions.html#termDisplayObjectByName"><span class="hs-identifier hs-type">termDisplayObjectByName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679353438"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.html#NameSearch"><span class="hs-identifier hs-type">NameSearch</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-120"></span><span id="termDisplayObjectByName"><span class="annot"><span class="annottext">termDisplayObjectByName :: forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; NameSearch Transaction
-&gt; Name
-&gt; Transaction
     (Maybe
        (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
</span><a href="Unison.Server.Local.Definitions.html#termDisplayObjectByName"><span class="hs-identifier hs-var hs-var">termDisplayObjectByName</span></a></span></span><span> </span><span id="local-6989586621679353710"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679353710"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679353711"><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679353711"><span class="hs-identifier hs-var">nameSearch</span></a></span></span><span> </span><span id="local-6989586621679353712"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679353712"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT
  Transaction
  (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))
-&gt; Transaction
     (Maybe
        (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-121"></span><span>  </span><span id="local-6989586621679353714"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679353714"><span class="hs-identifier hs-var">refs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Transaction (Set Referent) -&gt; MaybeT Transaction (Set Referent)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MaybeT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Transaction (Set Referent) -&gt; MaybeT Transaction (Set Referent))
-&gt; Transaction (Set Referent) -&gt; MaybeT Transaction (Set Referent)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Search Transaction Referent
-&gt; SearchType -&gt; HashQualified Name -&gt; Transaction (Set Referent)
forall (m :: * -&gt; *) r.
Search m r -&gt; SearchType -&gt; HashQualified Name -&gt; m (Set r)
</span><a href="Unison.Server.NameSearch.html#%24sel%3AlookupRelativeHQRefs%27%3ASearch"><span class="hs-identifier hs-var">NameSearch.lookupRelativeHQRefs'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSearch Transaction -&gt; Search Transaction Referent
forall (m :: * -&gt; *). NameSearch m -&gt; Search m Referent
</span><a href="Unison.Server.NameSearch.html#%24sel%3AtermSearch%3ANameSearch"><span class="hs-identifier hs-var">NS.termSearch</span></a></span><span> </span><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679353711"><span class="hs-identifier hs-var">nameSearch</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SearchType
</span><span class="hs-identifier hs-var">NS.ExactName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; HashQualified Name
forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.NameOnly</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679353712"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>  </span><span id="local-6989586621679353719"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679353719"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(NESet Referent -&gt; Referent)
-&gt; MaybeT Transaction (NESet Referent)
-&gt; MaybeT Transaction Referent
forall a b.
(a -&gt; b) -&gt; MaybeT Transaction a -&gt; MaybeT Transaction b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">NESet Referent -&gt; Referent
forall a. NESet a -&gt; a
</span><span class="hs-identifier hs-var">NESet.findMin</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT Transaction (NESet Referent)
 -&gt; MaybeT Transaction Referent)
-&gt; (Maybe (NESet Referent) -&gt; MaybeT Transaction (NESet Referent))
-&gt; Maybe (NESet Referent)
-&gt; MaybeT Transaction Referent
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe (NESet Referent) -&gt; MaybeT Transaction (NESet Referent)
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">hoistMaybe</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (NESet Referent) -&gt; MaybeT Transaction Referent)
-&gt; Maybe (NESet Referent) -&gt; MaybeT Transaction Referent
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; Maybe (NESet Referent)
forall a. Set a -&gt; Maybe (NESet a)
</span><span class="hs-identifier hs-var">NESet.nonEmptySet</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679353714"><span class="hs-identifier hs-var">refs</span></a></span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679353719"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-124"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span id="local-6989586621679353723"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353723"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353723"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DisplayObject (Type Symbol Ann) (Term Symbol Ann)
 -&gt; (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
-&gt; MaybeT
     Transaction (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
-&gt; MaybeT
     Transaction
     (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Transaction (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
-&gt; MaybeT
     Transaction (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MaybeT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; Reference
-&gt; Transaction (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; Reference
-&gt; Transaction (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="Unison.Server.Backend.html#displayTerm"><span class="hs-identifier hs-var">Backend.displayTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679353710"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353723"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Referent.Con</span></span><span> </span><span class="annot"><span class="annottext">ConstructorReference
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ConstructorType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-126"></span><span>      </span><span class="hs-comment">-- TODO: Should we error here or some other sensible thing rather than returning no</span><span>
</span><span id="line-127"></span><span>      </span><span class="hs-comment">-- result?</span><span>
</span><span id="line-128"></span><span>      </span><span class="annot"><span class="annottext">MaybeT
  Transaction
  (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))
forall a. MaybeT Transaction a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a
</span><span class="hs-identifier hs-var">empty</span></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="annot"><a href="Unison.Server.Local.Definitions.html#termDefinitionByName"><span class="hs-identifier hs-type">termDefinitionByName</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><a href="Unison.Server.NameSearch.html#NameSearch"><span class="hs-identifier hs-type">NameSearch</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-134"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-136"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-137"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TermDefinition"><span class="hs-identifier hs-type">TermDefinition</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span id="termDefinitionByName"><span class="annot"><span class="annottext">termDefinitionByName :: Codebase IO Symbol Ann
-&gt; PrettyPrintEnvDecl
-&gt; NameSearch Transaction
-&gt; Width
-&gt; Runtime Symbol
-&gt; Name
-&gt; Backend IO (Maybe TermDefinition)
</span><a href="Unison.Server.Local.Definitions.html#termDefinitionByName"><span class="hs-identifier hs-var hs-var">termDefinitionByName</span></a></span></span><span> </span><span id="local-6989586621679353728"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353728"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679353729"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679353729"><span class="hs-identifier hs-var">pped</span></a></span></span><span> </span><span id="local-6989586621679353730"><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679353730"><span class="hs-identifier hs-var">nameSearch</span></a></span></span><span> </span><span id="local-6989586621679353731"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679353731"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621679353732"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679353732"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679353733"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679353733"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT (Backend IO) TermDefinition
-&gt; Backend IO (Maybe TermDefinition)
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT (Backend IO) TermDefinition
 -&gt; Backend IO (Maybe TermDefinition))
-&gt; MaybeT (Backend IO) TermDefinition
-&gt; Backend IO (Maybe TermDefinition)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679353734"><span class="annot"><span class="annottext">biasedPPED :: PrettyPrintEnvDecl
</span><a href="#local-6989586621679353734"><span class="hs-identifier hs-var hs-var">biasedPPED</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; PrettyPrintEnvDecl -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.biasTo</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679353733"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679353729"><span class="hs-identifier hs-var">pped</span></a></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679353735"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353735"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353736"><span class="annot"><span class="annottext">DisplayObject (Type Symbol Ann) (Term Symbol Ann)
</span><a href="#local-6989586621679353736"><span class="hs-identifier hs-var">displayObject</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353737"><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679353737"><span class="hs-identifier hs-var">docRefs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Transaction
   (Maybe
      (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann),
       [Reference]))
 -&gt; Backend
      IO
      (Maybe
         (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann),
          [Reference])))
-&gt; MaybeT
     Transaction
     (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann),
      [Reference])
-&gt; MaybeT
     (Backend IO)
     (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann),
      [Reference])
forall (m :: * -&gt; *) a (n :: * -&gt; *) b.
(m (Maybe a) -&gt; n (Maybe b)) -&gt; MaybeT m a -&gt; MaybeT n b
</span><span class="hs-identifier hs-var">mapMaybeT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO
  (Maybe
     (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann),
      [Reference]))
-&gt; Backend
     IO
     (Maybe
        (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann),
         [Reference]))
forall a. IO a -&gt; Backend IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO
   (Maybe
      (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann),
       [Reference]))
 -&gt; Backend
      IO
      (Maybe
         (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann),
          [Reference])))
-&gt; (Transaction
      (Maybe
         (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann),
          [Reference]))
    -&gt; IO
         (Maybe
            (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann),
             [Reference])))
-&gt; Transaction
     (Maybe
        (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann),
         [Reference]))
-&gt; Backend
     IO
     (Maybe
        (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann),
         [Reference]))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Transaction
     (Maybe
        (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann),
         [Reference]))
-&gt; IO
     (Maybe
        (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann),
         [Reference]))
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353728"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(MaybeT
   Transaction
   (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann),
    [Reference])
 -&gt; MaybeT
      (Backend IO)
      (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann),
       [Reference]))
-&gt; MaybeT
     Transaction
     (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann),
      [Reference])
-&gt; MaybeT
     (Backend IO)
     (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann),
      [Reference])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679353738"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353738"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353739"><span class="annot"><span class="annottext">DisplayObject (Type Symbol Ann) (Term Symbol Ann)
</span><a href="#local-6989586621679353739"><span class="hs-identifier hs-var">displayObject</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Transaction
  (Maybe
     (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
-&gt; MaybeT
     Transaction
     (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="annot"><span class="annottext">(Transaction
   (Maybe
      (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
 -&gt; MaybeT
      Transaction
      (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
-&gt; Transaction
     (Maybe
        (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
-&gt; MaybeT
     Transaction
     (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; NameSearch Transaction
-&gt; Name
-&gt; Transaction
     (Maybe
        (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; NameSearch Transaction
-&gt; Name
-&gt; Transaction
     (Maybe
        (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
</span><a href="Unison.Server.Local.Definitions.html#termDisplayObjectByName"><span class="hs-identifier hs-var">termDisplayObjectByName</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353728"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679353730"><span class="hs-identifier hs-var">nameSearch</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679353733"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-142"></span><span>    </span><span id="local-6989586621679353741"><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679353741"><span class="hs-identifier hs-var">docRefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Transaction [Reference] -&gt; MaybeT Transaction [Reference]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MaybeT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Transaction [Reference] -&gt; MaybeT Transaction [Reference])
-&gt; Transaction [Reference] -&gt; MaybeT Transaction [Reference]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; NameSearch Transaction
-&gt; SearchType
-&gt; Name
-&gt; Transaction [Reference]
</span><a href="Unison.Server.Backend.html#docsForDefinitionName"><span class="hs-identifier hs-var">Backend.docsForDefinitionName</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353728"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679353730"><span class="hs-identifier hs-var">nameSearch</span></a></span><span> </span><span class="annot"><span class="annottext">SearchType
</span><span class="hs-identifier hs-var">NS.ExactName</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679353733"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><span class="annottext">(Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann),
 [Reference])
-&gt; MaybeT
     Transaction
     (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann),
      [Reference])
forall a. a -&gt; MaybeT Transaction a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353738"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DisplayObject (Type Symbol Ann) (Term Symbol Ann)
</span><a href="#local-6989586621679353739"><span class="hs-identifier hs-var">displayObject</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679353741"><span class="hs-identifier hs-var">docRefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>  </span><span id="local-6989586621679353742"><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621679353742"><span class="hs-identifier hs-var">renderedDocs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><span class="annottext">IO [(Text, Text, Doc)] -&gt; MaybeT (Backend IO) [(Text, Text, Doc)]
forall a. IO a -&gt; MaybeT (Backend IO) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [(Text, Text, Doc)] -&gt; MaybeT (Backend IO) [(Text, Text, Doc)])
-&gt; IO [(Text, Text, Doc)]
-&gt; MaybeT (Backend IO) [(Text, Text, Doc)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-146"></span><span>      </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
-&gt; Width
-&gt; Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; [Reference]
-&gt; IO [(Text, Text, Doc, [Error])]
forall (t :: * -&gt; *).
Traversable t =&gt;
PrettyPrintEnvDecl
-&gt; Width
-&gt; Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; t Reference
-&gt; IO (t (Text, Text, Doc, [Error]))
</span><a href="Unison.Server.Backend.html#renderDocRefs"><span class="hs-identifier hs-var">renderDocRefs</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679353729"><span class="hs-identifier hs-var">pped</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679353731"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353728"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679353732"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679353737"><span class="hs-identifier hs-var">docRefs</span></a></span><span>
</span><span id="line-147"></span><span>        </span><span class="hs-comment">-- local server currently ignores doc eval errors</span><span>
</span><span id="line-148"></span><span>        </span><span class="annot"><span class="annottext">IO [(Text, Text, Doc, [Error])]
-&gt; ([(Text, Text, Doc, [Error])] -&gt; [(Text, Text, Doc)])
-&gt; IO [(Text, Text, Doc)]
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">((Text, Text, Doc, [Error]) -&gt; (Text, Text, Doc))
-&gt; [(Text, Text, Doc, [Error])] -&gt; [(Text, Text, Doc)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679353743"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679353743"><span class="hs-identifier hs-var">hqn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353744"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679353744"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353745"><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621679353745"><span class="hs-identifier hs-var">doc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353746"><span class="annot"><span class="annottext">[Error]
</span><a href="#local-6989586621679353746"><span class="hs-identifier hs-var">_errs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679353743"><span class="hs-identifier hs-var">hqn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679353744"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621679353745"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679353747"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353747"><span class="hs-identifier hs-var">_ref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353748"><span class="annot"><span class="annottext">DisplayObject
  (AnnotatedText (Element Reference))
  (AnnotatedText (Element Reference))
</span><a href="#local-6989586621679353748"><span class="hs-identifier hs-var">syntaxDO</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; Traversal
     (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))
     (Reference,
      DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
     (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))
     (Reference,
      DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
-&gt; (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))
-&gt; (Reference,
    DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))
forall v a s t.
(Var v, Ord a) =&gt;
Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; Traversal
     s
     t
     (Reference, DisplayObject (Type v a) (Term v a))
     (Reference,
      DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
-&gt; s
-&gt; t
</span><a href="Unison.Server.Backend.html#termsToSyntaxOf"><span class="hs-identifier hs-var">Backend.termsToSyntaxOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Suffixify
</span><a href="Unison.Server.Types.html#Suffixify"><span class="hs-identifier hs-var">Suffixify</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679353731"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679353729"><span class="hs-identifier hs-var">pped</span></a></span><span> </span><span class="annot"><span class="annottext">((Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))
 -&gt; f (Reference,
       DisplayObject
         (AnnotatedText (Element Reference))
         (AnnotatedText (Element Reference))))
-&gt; (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))
-&gt; f (Reference,
      DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
forall a. a -&gt; a
Traversal
  (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))
  (Reference,
   DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference)))
  (Reference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))
  (Reference,
   DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference)))
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353735"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DisplayObject (Type Symbol Ann) (Term Symbol Ann)
</span><a href="#local-6989586621679353736"><span class="hs-identifier hs-var">displayObject</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><span class="annottext">Backend IO TermDefinition -&gt; MaybeT (Backend IO) TermDefinition
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MaybeT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Backend IO TermDefinition -&gt; MaybeT (Backend IO) TermDefinition)
-&gt; Backend IO TermDefinition -&gt; MaybeT (Backend IO) TermDefinition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; PrettyPrintEnvDecl
-&gt; Width
-&gt; Reference
-&gt; [(Text, Text, Doc)]
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
-&gt; Backend IO TermDefinition
</span><a href="Unison.Server.Backend.html#mkTermDefinition"><span class="hs-identifier hs-var">Backend.mkTermDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353728"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679353734"><span class="hs-identifier hs-var">biasedPPED</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679353731"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353735"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621679353742"><span class="hs-identifier hs-var">renderedDocs</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayObject
  (AnnotatedText (Element Reference))
  (AnnotatedText (Element Reference))
</span><a href="#local-6989586621679353748"><span class="hs-identifier hs-var">syntaxDO</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="annot"><span class="hs-comment">-- | Find the type referenced by the given name and return a display object for it.</span></span><span>
</span><span id="line-153"></span><span id="local-6989586621679353476"><span class="annot"><a href="Unison.Server.Local.Definitions.html#typeDisplayObjectByName"><span class="hs-identifier hs-type">typeDisplayObjectByName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679353476"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.html#NameSearch"><span class="hs-identifier hs-type">NameSearch</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DD.Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-154"></span><span id="typeDisplayObjectByName"><span class="annot"><span class="annottext">typeDisplayObjectByName :: forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; NameSearch Transaction
-&gt; Name
-&gt; Transaction
     (Maybe (Reference, DisplayObject () (Decl Symbol Ann)))
</span><a href="Unison.Server.Local.Definitions.html#typeDisplayObjectByName"><span class="hs-identifier hs-var hs-var">typeDisplayObjectByName</span></a></span></span><span> </span><span id="local-6989586621679353762"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679353762"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679353763"><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679353763"><span class="hs-identifier hs-var">nameSearch</span></a></span></span><span> </span><span id="local-6989586621679353764"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679353764"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT Transaction (Reference, DisplayObject () (Decl Symbol Ann))
-&gt; Transaction
     (Maybe (Reference, DisplayObject () (Decl Symbol Ann)))
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-155"></span><span>  </span><span id="local-6989586621679353765"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679353765"><span class="hs-identifier hs-var">refs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Transaction (Set Reference) -&gt; MaybeT Transaction (Set Reference)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MaybeT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Transaction (Set Reference) -&gt; MaybeT Transaction (Set Reference))
-&gt; Transaction (Set Reference)
-&gt; MaybeT Transaction (Set Reference)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Search Transaction Reference
-&gt; SearchType -&gt; HashQualified Name -&gt; Transaction (Set Reference)
forall (m :: * -&gt; *) r.
Search m r -&gt; SearchType -&gt; HashQualified Name -&gt; m (Set r)
</span><a href="Unison.Server.NameSearch.html#%24sel%3AlookupRelativeHQRefs%27%3ASearch"><span class="hs-identifier hs-var">NameSearch.lookupRelativeHQRefs'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSearch Transaction -&gt; Search Transaction Reference
forall (m :: * -&gt; *). NameSearch m -&gt; Search m Reference
</span><a href="Unison.Server.NameSearch.html#%24sel%3AtypeSearch%3ANameSearch"><span class="hs-identifier hs-var">NS.typeSearch</span></a></span><span> </span><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679353763"><span class="hs-identifier hs-var">nameSearch</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SearchType
</span><span class="hs-identifier hs-var">NS.ExactName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; HashQualified Name
forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.NameOnly</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679353764"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>  </span><span id="local-6989586621679353767"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353767"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(NESet Reference -&gt; Reference)
-&gt; MaybeT Transaction (NESet Reference)
-&gt; MaybeT Transaction Reference
forall a b.
(a -&gt; b) -&gt; MaybeT Transaction a -&gt; MaybeT Transaction b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">NESet Reference -&gt; Reference
forall a. NESet a -&gt; a
</span><span class="hs-identifier hs-var">NESet.findMin</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT Transaction (NESet Reference)
 -&gt; MaybeT Transaction Reference)
-&gt; (Maybe (NESet Reference)
    -&gt; MaybeT Transaction (NESet Reference))
-&gt; Maybe (NESet Reference)
-&gt; MaybeT Transaction Reference
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe (NESet Reference) -&gt; MaybeT Transaction (NESet Reference)
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">hoistMaybe</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (NESet Reference) -&gt; MaybeT Transaction Reference)
-&gt; Maybe (NESet Reference) -&gt; MaybeT Transaction Reference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; Maybe (NESet Reference)
forall a. Set a -&gt; Maybe (NESet a)
</span><span class="hs-identifier hs-var">NESet.nonEmptySet</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679353765"><span class="hs-identifier hs-var">refs</span></a></span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><span class="annottext">(DisplayObject () (Decl Symbol Ann)
 -&gt; (Reference, DisplayObject () (Decl Symbol Ann)))
-&gt; MaybeT Transaction (DisplayObject () (Decl Symbol Ann))
-&gt; MaybeT
     Transaction (Reference, DisplayObject () (Decl Symbol Ann))
forall a b.
(a -&gt; b) -&gt; MaybeT Transaction a -&gt; MaybeT Transaction b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353767"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(MaybeT Transaction (DisplayObject () (Decl Symbol Ann))
 -&gt; MaybeT
      Transaction (Reference, DisplayObject () (Decl Symbol Ann)))
-&gt; (Transaction (DisplayObject () (Decl Symbol Ann))
    -&gt; MaybeT Transaction (DisplayObject () (Decl Symbol Ann)))
-&gt; Transaction (DisplayObject () (Decl Symbol Ann))
-&gt; MaybeT
     Transaction (Reference, DisplayObject () (Decl Symbol Ann))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Transaction (DisplayObject () (Decl Symbol Ann))
-&gt; MaybeT Transaction (DisplayObject () (Decl Symbol Ann))
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MaybeT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Transaction (DisplayObject () (Decl Symbol Ann))
 -&gt; MaybeT
      Transaction (Reference, DisplayObject () (Decl Symbol Ann)))
-&gt; Transaction (DisplayObject () (Decl Symbol Ann))
-&gt; MaybeT
     Transaction (Reference, DisplayObject () (Decl Symbol Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; Reference -&gt; Transaction (DisplayObject () (Decl Symbol Ann))
forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; Reference -&gt; Transaction (DisplayObject () (Decl Symbol Ann))
</span><a href="Unison.Server.Backend.html#displayType"><span class="hs-identifier hs-var">Backend.displayType</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679353762"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353767"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="annot"><a href="Unison.Server.Local.Definitions.html#typeDefinitionByName"><span class="hs-identifier hs-type">typeDefinitionByName</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-160"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-161"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-162"></span><span>  </span><span class="annot"><a href="Unison.Server.NameSearch.html#NameSearch"><span class="hs-identifier hs-type">NameSearch</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-166"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TypeDefinition"><span class="hs-identifier hs-type">TypeDefinition</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span id="typeDefinitionByName"><span class="annot"><span class="annottext">typeDefinitionByName :: Codebase IO Symbol Ann
-&gt; PrettyPrintEnvDecl
-&gt; NameSearch Transaction
-&gt; Width
-&gt; Runtime Symbol
-&gt; Name
-&gt; Backend IO (Maybe TypeDefinition)
</span><a href="Unison.Server.Local.Definitions.html#typeDefinitionByName"><span class="hs-identifier hs-var hs-var">typeDefinitionByName</span></a></span></span><span> </span><span id="local-6989586621679353769"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353769"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679353770"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679353770"><span class="hs-identifier hs-var">pped</span></a></span></span><span> </span><span id="local-6989586621679353771"><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679353771"><span class="hs-identifier hs-var">nameSearch</span></a></span></span><span> </span><span id="local-6989586621679353772"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679353772"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621679353773"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679353773"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679353774"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679353774"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT (Backend IO) TypeDefinition
-&gt; Backend IO (Maybe TypeDefinition)
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT (Backend IO) TypeDefinition
 -&gt; Backend IO (Maybe TypeDefinition))
-&gt; MaybeT (Backend IO) TypeDefinition
-&gt; Backend IO (Maybe TypeDefinition)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679353775"><span class="annot"><span class="annottext">biasedPPED :: PrettyPrintEnvDecl
</span><a href="#local-6989586621679353775"><span class="hs-identifier hs-var hs-var">biasedPPED</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; PrettyPrintEnvDecl -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.biasTo</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679353774"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679353770"><span class="hs-identifier hs-var">pped</span></a></span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679353776"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353776"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353777"><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
</span><a href="#local-6989586621679353777"><span class="hs-identifier hs-var">displayObject</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353778"><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679353778"><span class="hs-identifier hs-var">docRefs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Transaction
   (Maybe
      (Reference, DisplayObject () (Decl Symbol Ann), [Reference]))
 -&gt; Backend
      IO
      (Maybe
         (Reference, DisplayObject () (Decl Symbol Ann), [Reference])))
-&gt; MaybeT
     Transaction
     (Reference, DisplayObject () (Decl Symbol Ann), [Reference])
-&gt; MaybeT
     (Backend IO)
     (Reference, DisplayObject () (Decl Symbol Ann), [Reference])
forall (m :: * -&gt; *) a (n :: * -&gt; *) b.
(m (Maybe a) -&gt; n (Maybe b)) -&gt; MaybeT m a -&gt; MaybeT n b
</span><span class="hs-identifier hs-var">mapMaybeT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO
  (Maybe
     (Reference, DisplayObject () (Decl Symbol Ann), [Reference]))
-&gt; Backend
     IO
     (Maybe
        (Reference, DisplayObject () (Decl Symbol Ann), [Reference]))
forall a. IO a -&gt; Backend IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO
   (Maybe
      (Reference, DisplayObject () (Decl Symbol Ann), [Reference]))
 -&gt; Backend
      IO
      (Maybe
         (Reference, DisplayObject () (Decl Symbol Ann), [Reference])))
-&gt; (Transaction
      (Maybe
         (Reference, DisplayObject () (Decl Symbol Ann), [Reference]))
    -&gt; IO
         (Maybe
            (Reference, DisplayObject () (Decl Symbol Ann), [Reference])))
-&gt; Transaction
     (Maybe
        (Reference, DisplayObject () (Decl Symbol Ann), [Reference]))
-&gt; Backend
     IO
     (Maybe
        (Reference, DisplayObject () (Decl Symbol Ann), [Reference]))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Transaction
     (Maybe
        (Reference, DisplayObject () (Decl Symbol Ann), [Reference]))
-&gt; IO
     (Maybe
        (Reference, DisplayObject () (Decl Symbol Ann), [Reference]))
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353769"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(MaybeT
   Transaction
   (Reference, DisplayObject () (Decl Symbol Ann), [Reference])
 -&gt; MaybeT
      (Backend IO)
      (Reference, DisplayObject () (Decl Symbol Ann), [Reference]))
-&gt; MaybeT
     Transaction
     (Reference, DisplayObject () (Decl Symbol Ann), [Reference])
-&gt; MaybeT
     (Backend IO)
     (Reference, DisplayObject () (Decl Symbol Ann), [Reference])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679353779"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353779"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353780"><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
</span><a href="#local-6989586621679353780"><span class="hs-identifier hs-var">displayObject</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Transaction (Maybe (Reference, DisplayObject () (Decl Symbol Ann)))
-&gt; MaybeT
     Transaction (Reference, DisplayObject () (Decl Symbol Ann))
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="annot"><span class="annottext">(Transaction
   (Maybe (Reference, DisplayObject () (Decl Symbol Ann)))
 -&gt; MaybeT
      Transaction (Reference, DisplayObject () (Decl Symbol Ann)))
-&gt; Transaction
     (Maybe (Reference, DisplayObject () (Decl Symbol Ann)))
-&gt; MaybeT
     Transaction (Reference, DisplayObject () (Decl Symbol Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; NameSearch Transaction
-&gt; Name
-&gt; Transaction
     (Maybe (Reference, DisplayObject () (Decl Symbol Ann)))
forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; NameSearch Transaction
-&gt; Name
-&gt; Transaction
     (Maybe (Reference, DisplayObject () (Decl Symbol Ann)))
</span><a href="Unison.Server.Local.Definitions.html#typeDisplayObjectByName"><span class="hs-identifier hs-var">typeDisplayObjectByName</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353769"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679353771"><span class="hs-identifier hs-var">nameSearch</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679353774"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span id="local-6989586621679353781"><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679353781"><span class="hs-identifier hs-var">docRefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Transaction [Reference] -&gt; MaybeT Transaction [Reference]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MaybeT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Transaction [Reference] -&gt; MaybeT Transaction [Reference])
-&gt; Transaction [Reference] -&gt; MaybeT Transaction [Reference]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; NameSearch Transaction
-&gt; SearchType
-&gt; Name
-&gt; Transaction [Reference]
</span><a href="Unison.Server.Backend.html#docsForDefinitionName"><span class="hs-identifier hs-var">Backend.docsForDefinitionName</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353769"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679353771"><span class="hs-identifier hs-var">nameSearch</span></a></span><span> </span><span class="annot"><span class="annottext">SearchType
</span><span class="hs-identifier hs-var">NS.ExactName</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679353774"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="annot"><span class="annottext">(Reference, DisplayObject () (Decl Symbol Ann), [Reference])
-&gt; MaybeT
     Transaction
     (Reference, DisplayObject () (Decl Symbol Ann), [Reference])
forall a. a -&gt; MaybeT Transaction a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353779"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
</span><a href="#local-6989586621679353780"><span class="hs-identifier hs-var">displayObject</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679353781"><span class="hs-identifier hs-var">docRefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>  </span><span id="local-6989586621679353782"><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621679353782"><span class="hs-identifier hs-var">renderedDocs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><span class="annottext">IO [(Text, Text, Doc)] -&gt; MaybeT (Backend IO) [(Text, Text, Doc)]
forall a. IO a -&gt; MaybeT (Backend IO) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [(Text, Text, Doc)] -&gt; MaybeT (Backend IO) [(Text, Text, Doc)])
-&gt; IO [(Text, Text, Doc)]
-&gt; MaybeT (Backend IO) [(Text, Text, Doc)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-175"></span><span>      </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
-&gt; Width
-&gt; Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; [Reference]
-&gt; IO [(Text, Text, Doc, [Error])]
forall (t :: * -&gt; *).
Traversable t =&gt;
PrettyPrintEnvDecl
-&gt; Width
-&gt; Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; t Reference
-&gt; IO (t (Text, Text, Doc, [Error]))
</span><a href="Unison.Server.Backend.html#renderDocRefs"><span class="hs-identifier hs-var">renderDocRefs</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679353770"><span class="hs-identifier hs-var">pped</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679353772"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353769"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679353773"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679353778"><span class="hs-identifier hs-var">docRefs</span></a></span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-comment">-- local server currently ignores doc eval errors</span><span>
</span><span id="line-177"></span><span>        </span><span class="annot"><span class="annottext">IO [(Text, Text, Doc, [Error])]
-&gt; ([(Text, Text, Doc, [Error])] -&gt; [(Text, Text, Doc)])
-&gt; IO [(Text, Text, Doc)]
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">((Text, Text, Doc, [Error]) -&gt; (Text, Text, Doc))
-&gt; [(Text, Text, Doc, [Error])] -&gt; [(Text, Text, Doc)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679353783"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679353783"><span class="hs-identifier hs-var">hqn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353784"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679353784"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353785"><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621679353785"><span class="hs-identifier hs-var">doc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353786"><span class="annot"><span class="annottext">[Error]
</span><a href="#local-6989586621679353786"><span class="hs-identifier hs-var">_errs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679353783"><span class="hs-identifier hs-var">hqn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679353784"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621679353785"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679353787"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353787"><span class="hs-identifier hs-var">_ref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679353788"><span class="annot"><span class="annottext">DisplayObject
  (AnnotatedText (Element Reference))
  (AnnotatedText (Element Reference))
</span><a href="#local-6989586621679353788"><span class="hs-identifier hs-var">syntaxDO</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; Traversal
     (Reference, DisplayObject () (Decl Symbol Ann))
     (Reference,
      DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
     (Reference, DisplayObject () (Decl Symbol Ann))
     (Reference,
      DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
-&gt; (Reference, DisplayObject () (Decl Symbol Ann))
-&gt; (Reference,
    DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))
forall v a s t.
(Var v, Ord a) =&gt;
Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; Traversal
     s
     t
     (Reference, DisplayObject () (Decl v a))
     (Reference,
      DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
-&gt; s
-&gt; t
</span><a href="Unison.Server.Backend.html#typesToSyntaxOf"><span class="hs-identifier hs-var">Backend.typesToSyntaxOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Suffixify
</span><a href="Unison.Server.Types.html#Suffixify"><span class="hs-identifier hs-var">Suffixify</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679353772"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679353770"><span class="hs-identifier hs-var">pped</span></a></span><span> </span><span class="annot"><span class="annottext">((Reference, DisplayObject () (Decl Symbol Ann))
 -&gt; f (Reference,
       DisplayObject
         (AnnotatedText (Element Reference))
         (AnnotatedText (Element Reference))))
-&gt; (Reference, DisplayObject () (Decl Symbol Ann))
-&gt; f (Reference,
      DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
forall a. a -&gt; a
Traversal
  (Reference, DisplayObject () (Decl Symbol Ann))
  (Reference,
   DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference)))
  (Reference, DisplayObject () (Decl Symbol Ann))
  (Reference,
   DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference)))
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353776"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
</span><a href="#local-6989586621679353777"><span class="hs-identifier hs-var">displayObject</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>  </span><span class="annot"><span class="annottext">Backend IO TypeDefinition -&gt; MaybeT (Backend IO) TypeDefinition
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MaybeT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Backend IO TypeDefinition -&gt; MaybeT (Backend IO) TypeDefinition)
-&gt; Backend IO TypeDefinition -&gt; MaybeT (Backend IO) TypeDefinition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; PrettyPrintEnvDecl
-&gt; Width
-&gt; Reference
-&gt; [(Text, Text, Doc)]
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
-&gt; Backend IO TypeDefinition
forall (m :: * -&gt; *).
MonadIO m =&gt;
Codebase IO Symbol Ann
-&gt; PrettyPrintEnvDecl
-&gt; Width
-&gt; Reference
-&gt; [(Text, Text, Doc)]
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
-&gt; m TypeDefinition
</span><a href="Unison.Server.Backend.html#mkTypeDefinition"><span class="hs-identifier hs-var">Backend.mkTypeDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679353769"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679353775"><span class="hs-identifier hs-var">biasedPPED</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679353772"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679353776"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621679353782"><span class="hs-identifier hs-var">renderedDocs</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayObject
  (AnnotatedText (Element Reference))
  (AnnotatedText (Element Reference))
</span><a href="#local-6989586621679353788"><span class="hs-identifier hs-var">syntaxDO</span></a></span><span>
</span><span id="line-180"></span></pre></body></html>