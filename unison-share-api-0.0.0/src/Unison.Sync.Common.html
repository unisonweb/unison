<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="annot"><span class="hs-comment">-- | Combinators or utilities shared by sync server AND client</span></span><span>
</span><span id="line-2"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Sync.Common</span><span>
</span><span id="line-3"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Sync.Common.html#expectEntity"><span class="hs-identifier">expectEntity</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Type conversions</span></span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Unison.Sync.Common.html#causalHashToHash32"><span class="hs-identifier">causalHashToHash32</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Unison.Sync.Common.html#hash32ToCausalHash"><span class="hs-identifier">hash32ToCausalHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Unison.Sync.Common.html#entityToTempEntity"><span class="hs-identifier">entityToTempEntity</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Unison.Sync.Common.html#tempEntityToEntity"><span class="hs-identifier">tempEntityToEntity</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">where</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Lens</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Vector</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.HashTags</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CausalHash</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.Branch.Format</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NamespaceFormat</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.Causal</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Causal</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.Decl.Format</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DeclFormat</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.Entity</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Entity</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.LocalIds</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.Patch.Format</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PatchFormat</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.Queries</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Q</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.TempEntity</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TempEntity</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.TempEntity</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Sqlite</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.TempEntity</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TempEntity</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.Term.Format</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TermFormat</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Hash32</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Hash32</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Hash32</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Hash32</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Sqlite</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Sqlite</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Sync.Types.html"><span class="hs-identifier">Unison.Sync.Types</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Share</span></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="annot"><span class="hs-comment">-- | Read an entity out of the database that we know is in main storage.</span></span><span>
</span><span id="line-35"></span><span class="annot"><a href="Unison.Sync.Common.html#expectEntity"><span class="hs-identifier hs-type">expectEntity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hash32</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Sync.Types.html#Entity"><span class="hs-identifier hs-type">Share.Entity</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hash32</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hash32</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span id="expectEntity"><span class="annot"><span class="annottext">expectEntity :: Hash32 -&gt; Transaction (Entity Text Hash32 Hash32)
</span><a href="Unison.Sync.Common.html#expectEntity"><span class="hs-identifier hs-var hs-var">expectEntity</span></a></span></span><span> </span><span id="local-6989586621679360153"><span class="annot"><span class="annottext">Hash32
</span><a href="#local-6989586621679360153"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-37"></span><span>  </span><span id="local-6989586621679360154"><span class="annot"><span class="annottext">SyncEntity
</span><a href="#local-6989586621679360154"><span class="hs-identifier hs-var">syncEntity</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hash32 -&gt; Transaction SyncEntity
</span><span class="hs-identifier hs-var">Q.expectEntity</span></span><span> </span><span class="annot"><span class="annottext">Hash32
</span><a href="#local-6989586621679360153"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span id="local-6989586621679360156"><span class="annot"><span class="annottext">TempEntity
</span><a href="#local-6989586621679360156"><span class="hs-identifier hs-var">tempEntity</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SyncEntity -&gt; Transaction TempEntity
</span><span class="hs-identifier hs-var">Q.syncToTempEntity</span></span><span> </span><span class="annot"><span class="annottext">SyncEntity
</span><a href="#local-6989586621679360154"><span class="hs-identifier hs-var">syncEntity</span></a></span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><span class="annottext">Entity Text Hash32 Hash32
-&gt; Transaction (Entity Text Hash32 Hash32)
forall a. a -&gt; Transaction a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TempEntity -&gt; Entity Text Hash32 Hash32
</span><a href="Unison.Sync.Common.html#tempEntityToEntity"><span class="hs-identifier hs-var">tempEntityToEntity</span></a></span><span> </span><span class="annot"><span class="annottext">TempEntity
</span><a href="#local-6989586621679360156"><span class="hs-identifier hs-var">tempEntity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-comment">-- FIXME this isn't the right module  for this conversion</span><span>
</span><span id="line-42"></span><span class="annot"><a href="Unison.Sync.Common.html#causalHashToHash32"><span class="hs-identifier hs-type">causalHashToHash32</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hash32</span></span><span>
</span><span id="line-43"></span><span id="causalHashToHash32"><span class="annot"><span class="annottext">causalHashToHash32 :: CausalHash -&gt; Hash32
</span><a href="Unison.Sync.Common.html#causalHashToHash32"><span class="hs-identifier hs-var hs-var">causalHashToHash32</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><span class="annottext">Hash -&gt; Hash32
</span><span class="hs-identifier hs-var">Hash32.fromHash</span></span><span> </span><span class="annot"><span class="annottext">(Hash -&gt; Hash32) -&gt; (CausalHash -&gt; Hash) -&gt; CausalHash -&gt; Hash32
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CausalHash -&gt; Hash
</span><span class="hs-identifier hs-var">unCausalHash</span></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-comment">-- FIXME this isn't the right module  for this conversion</span><span>
</span><span id="line-47"></span><span class="annot"><a href="Unison.Sync.Common.html#hash32ToCausalHash"><span class="hs-identifier hs-type">hash32ToCausalHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hash32</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span>
</span><span id="line-48"></span><span id="hash32ToCausalHash"><span class="annot"><span class="annottext">hash32ToCausalHash :: Hash32 -&gt; CausalHash
</span><a href="Unison.Sync.Common.html#hash32ToCausalHash"><span class="hs-identifier hs-var hs-var">hash32ToCausalHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><span class="annottext">Hash -&gt; CausalHash
</span><span class="hs-identifier hs-var">CausalHash</span></span><span> </span><span class="annot"><span class="annottext">(Hash -&gt; CausalHash) -&gt; (Hash32 -&gt; Hash) -&gt; Hash32 -&gt; CausalHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Hash32 -&gt; Hash
</span><span class="hs-identifier hs-var">Hash32.toHash</span></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-comment">-- | Convert an entity that came over the wire from Unison Share into an equivalent type that we can store in the</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- `temp_entity` table.</span><span>
</span><span id="line-53"></span><span class="annot"><a href="Unison.Sync.Common.html#entityToTempEntity"><span class="hs-identifier hs-type">entityToTempEntity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679359978"><span class="annot"><a href="#local-6989586621679359978"><span class="hs-identifier hs-type">hash</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679359978"><span class="hs-identifier hs-type">hash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hash32</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Sync.Types.html#Entity"><span class="hs-identifier hs-type">Share.Entity</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hash32</span></span><span> </span><span class="annot"><a href="#local-6989586621679359978"><span class="hs-identifier hs-type">hash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TempEntity</span></span><span>
</span><span id="line-54"></span><span id="entityToTempEntity"><span class="annot"><span class="annottext">entityToTempEntity :: forall hash.
(hash -&gt; Hash32) -&gt; Entity Text Hash32 hash -&gt; TempEntity
</span><a href="Unison.Sync.Common.html#entityToTempEntity"><span class="hs-identifier hs-var hs-var">entityToTempEntity</span></a></span></span><span> </span><span id="local-6989586621679360167"><span class="annot"><span class="annottext">hash -&gt; Hash32
</span><a href="#local-6989586621679360167"><span class="hs-identifier hs-var">toHash32</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><a href="Unison.Sync.Types.html#TC"><span class="hs-identifier hs-type">Share.TC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Sync.Types.html#TermComponent"><span class="hs-identifier hs-type">Share.TermComponent</span></a></span><span> </span><span id="local-6989586621679360170"><span class="annot"><span class="annottext">[(LocalIds Text hash, ByteString)]
</span><a href="#local-6989586621679360170"><span class="hs-identifier hs-var">terms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><span class="annottext">[(LocalIds Text hash, ByteString)]
</span><a href="#local-6989586621679360170"><span class="hs-identifier hs-var">terms</span></a></span><span>
</span><span id="line-57"></span><span>      </span><span class="annot"><span class="annottext">[(LocalIds Text hash, ByteString)]
-&gt; ([(LocalIds Text hash, ByteString)]
    -&gt; Vector (LocalIds Text hash, ByteString))
-&gt; Vector (LocalIds Text hash, ByteString)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[(LocalIds Text hash, ByteString)]
-&gt; Vector (LocalIds Text hash, ByteString)
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">Vector.fromList</span></span><span>
</span><span id="line-58"></span><span>      </span><span class="annot"><span class="annottext">Vector (LocalIds Text hash, ByteString)
-&gt; (Vector (LocalIds Text hash, ByteString)
    -&gt; Vector (LocalIds' Text Hash32, ByteString))
-&gt; Vector (LocalIds' Text Hash32, ByteString)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">((LocalIds Text hash, ByteString)
 -&gt; (LocalIds' Text Hash32, ByteString))
-&gt; Vector (LocalIds Text hash, ByteString)
-&gt; Vector (LocalIds' Text Hash32, ByteString)
forall a b. (a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><span class="hs-identifier hs-var">Vector.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ASetter
  (LocalIds Text hash, ByteString)
  (LocalIds' Text Hash32, ByteString)
  (LocalIds Text hash)
  (LocalIds' Text Hash32)
-&gt; (LocalIds Text hash -&gt; LocalIds' Text Hash32)
-&gt; (LocalIds Text hash, ByteString)
-&gt; (LocalIds' Text Hash32, ByteString)
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">Lens.over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (LocalIds Text hash, ByteString)
  (LocalIds' Text Hash32, ByteString)
  (LocalIds Text hash)
  (LocalIds' Text Hash32)
forall s t a b. Field1 s t a b =&gt; Lens s t a b
Lens
  (LocalIds Text hash, ByteString)
  (LocalIds' Text Hash32, ByteString)
  (LocalIds Text hash)
  (LocalIds' Text Hash32)
</span><span class="hs-identifier hs-var">Lens._1</span></span><span> </span><span class="annot"><span class="annottext">LocalIds Text hash -&gt; LocalIds' Text Hash32
</span><a href="#local-6989586621679360176"><span class="hs-identifier hs-var">mungeLocalIds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>      </span><span class="annot"><span class="annottext">Vector (LocalIds' Text Hash32, ByteString)
-&gt; (Vector (LocalIds' Text Hash32, ByteString)
    -&gt; SyncLocallyIndexedComponent' Text Hash32)
-&gt; SyncLocallyIndexedComponent' Text Hash32
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Vector (LocalIds' Text Hash32, ByteString)
-&gt; SyncLocallyIndexedComponent' Text Hash32
forall t d.
Vector (LocalIds' t d, ByteString)
-&gt; SyncLocallyIndexedComponent' t d
</span><span class="hs-identifier hs-var">TermFormat.SyncLocallyIndexedComponent</span></span><span>
</span><span id="line-60"></span><span>      </span><span class="annot"><span class="annottext">SyncLocallyIndexedComponent' Text Hash32
-&gt; (SyncLocallyIndexedComponent' Text Hash32
    -&gt; SyncTermFormat' Text Hash32)
-&gt; SyncTermFormat' Text Hash32
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">SyncLocallyIndexedComponent' Text Hash32
-&gt; SyncTermFormat' Text Hash32
forall t d. SyncLocallyIndexedComponent' t d -&gt; SyncTermFormat' t d
</span><span class="hs-identifier hs-var">TermFormat.SyncTerm</span></span><span>
</span><span id="line-61"></span><span>      </span><span class="annot"><span class="annottext">SyncTermFormat' Text Hash32
-&gt; (SyncTermFormat' Text Hash32 -&gt; TempEntity) -&gt; TempEntity
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">SyncTermFormat' Text Hash32 -&gt; TempEntity
forall text hash defn patch branchh branch causal.
SyncTermFormat' text defn
-&gt; SyncEntity' text hash defn patch branchh branch causal
</span><span class="hs-identifier hs-var">Entity.TC</span></span><span>
</span><span id="line-62"></span><span>  </span><span class="annot"><a href="Unison.Sync.Types.html#DC"><span class="hs-identifier hs-type">Share.DC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Sync.Types.html#DeclComponent"><span class="hs-identifier hs-type">Share.DeclComponent</span></a></span><span> </span><span id="local-6989586621679360182"><span class="annot"><span class="annottext">[(LocalIds Text hash, ByteString)]
</span><a href="#local-6989586621679360182"><span class="hs-identifier hs-var">decls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><span class="annottext">[(LocalIds Text hash, ByteString)]
</span><a href="#local-6989586621679360182"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-64"></span><span>      </span><span class="annot"><span class="annottext">[(LocalIds Text hash, ByteString)]
-&gt; ([(LocalIds Text hash, ByteString)]
    -&gt; Vector (LocalIds Text hash, ByteString))
-&gt; Vector (LocalIds Text hash, ByteString)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[(LocalIds Text hash, ByteString)]
-&gt; Vector (LocalIds Text hash, ByteString)
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">Vector.fromList</span></span><span>
</span><span id="line-65"></span><span>      </span><span class="annot"><span class="annottext">Vector (LocalIds Text hash, ByteString)
-&gt; (Vector (LocalIds Text hash, ByteString)
    -&gt; Vector (LocalIds' Text Hash32, ByteString))
-&gt; Vector (LocalIds' Text Hash32, ByteString)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">((LocalIds Text hash, ByteString)
 -&gt; (LocalIds' Text Hash32, ByteString))
-&gt; Vector (LocalIds Text hash, ByteString)
-&gt; Vector (LocalIds' Text Hash32, ByteString)
forall a b. (a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><span class="hs-identifier hs-var">Vector.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ASetter
  (LocalIds Text hash, ByteString)
  (LocalIds' Text Hash32, ByteString)
  (LocalIds Text hash)
  (LocalIds' Text Hash32)
-&gt; (LocalIds Text hash -&gt; LocalIds' Text Hash32)
-&gt; (LocalIds Text hash, ByteString)
-&gt; (LocalIds' Text Hash32, ByteString)
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">Lens.over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (LocalIds Text hash, ByteString)
  (LocalIds' Text Hash32, ByteString)
  (LocalIds Text hash)
  (LocalIds' Text Hash32)
forall s t a b. Field1 s t a b =&gt; Lens s t a b
Lens
  (LocalIds Text hash, ByteString)
  (LocalIds' Text Hash32, ByteString)
  (LocalIds Text hash)
  (LocalIds' Text Hash32)
</span><span class="hs-identifier hs-var">Lens._1</span></span><span> </span><span class="annot"><span class="annottext">LocalIds Text hash -&gt; LocalIds' Text Hash32
</span><a href="#local-6989586621679360176"><span class="hs-identifier hs-var">mungeLocalIds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>      </span><span class="annot"><span class="annottext">Vector (LocalIds' Text Hash32, ByteString)
-&gt; (Vector (LocalIds' Text Hash32, ByteString)
    -&gt; SyncLocallyIndexedComponent' Text Hash32)
-&gt; SyncLocallyIndexedComponent' Text Hash32
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Vector (LocalIds' Text Hash32, ByteString)
-&gt; SyncLocallyIndexedComponent' Text Hash32
forall t d.
Vector (LocalIds' t d, ByteString)
-&gt; SyncLocallyIndexedComponent' t d
</span><span class="hs-identifier hs-var">DeclFormat.SyncLocallyIndexedComponent</span></span><span>
</span><span id="line-67"></span><span>      </span><span class="annot"><span class="annottext">SyncLocallyIndexedComponent' Text Hash32
-&gt; (SyncLocallyIndexedComponent' Text Hash32
    -&gt; SyncDeclFormat' Text Hash32)
-&gt; SyncDeclFormat' Text Hash32
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">SyncLocallyIndexedComponent' Text Hash32
-&gt; SyncDeclFormat' Text Hash32
forall t d. SyncLocallyIndexedComponent' t d -&gt; SyncDeclFormat' t d
</span><span class="hs-identifier hs-var">DeclFormat.SyncDecl</span></span><span>
</span><span id="line-68"></span><span>      </span><span class="annot"><span class="annottext">SyncDeclFormat' Text Hash32
-&gt; (SyncDeclFormat' Text Hash32 -&gt; TempEntity) -&gt; TempEntity
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">SyncDeclFormat' Text Hash32 -&gt; TempEntity
forall text hash defn patch branchh branch causal.
SyncDeclFormat' text defn
-&gt; SyncEntity' text hash defn patch branchh branch causal
</span><span class="hs-identifier hs-var">Entity.DC</span></span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><a href="Unison.Sync.Types.html#P"><span class="hs-identifier hs-type">Share.P</span></a></span><span> </span><span class="annot"><a href="Unison.Sync.Types.html#Patch"><span class="hs-identifier hs-type">Share.Patch</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679360188"><span class="annot"><span class="annottext">[Text]
textLookup :: [Text]
$sel:textLookup:Patch :: forall text oldHash newHash. Patch text oldHash newHash -&gt; [text]
</span><a href="#local-6989586621679360188"><span class="hs-identifier hs-var hs-var">textLookup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360190"><span class="annot"><span class="annottext">[Hash32]
oldHashLookup :: [Hash32]
$sel:oldHashLookup:Patch :: forall text oldHash newHash.
Patch text oldHash newHash -&gt; [oldHash]
</span><a href="#local-6989586621679360190"><span class="hs-identifier hs-var hs-var">oldHashLookup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360192"><span class="annot"><span class="annottext">[hash]
newHashLookup :: [hash]
$sel:newHashLookup:Patch :: forall text oldHash newHash.
Patch text oldHash newHash -&gt; [newHash]
</span><a href="#local-6989586621679360192"><span class="hs-identifier hs-var hs-var">newHashLookup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360194"><span class="annot"><span class="annottext">ByteString
bytes :: ByteString
$sel:bytes:Patch :: forall text oldHash newHash.
Patch text oldHash newHash -&gt; ByteString
</span><a href="#local-6989586621679360194"><span class="hs-identifier hs-var hs-var">bytes</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="annottext">SyncPatchFormat' Hash32 Text Hash32 Hash32 -&gt; TempEntity
forall text hash defn patch branchh branch causal.
SyncPatchFormat' patch text hash defn
-&gt; SyncEntity' text hash defn patch branchh branch causal
</span><span class="hs-identifier hs-var">Entity.P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatchLocalIds' Text Hash32 Hash32
-&gt; ByteString -&gt; SyncPatchFormat' Hash32 Text Hash32 Hash32
forall parent text hash defn.
PatchLocalIds' text hash defn
-&gt; ByteString -&gt; SyncPatchFormat' parent text hash defn
</span><span class="hs-identifier hs-var">PatchFormat.SyncFull</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; [Hash32] -&gt; [hash] -&gt; PatchLocalIds' Text Hash32 Hash32
</span><a href="#local-6989586621679360198"><span class="hs-identifier hs-var">mungePatchLocalIds</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679360188"><span class="hs-identifier hs-var">textLookup</span></a></span><span> </span><span class="annot"><span class="annottext">[Hash32]
</span><a href="#local-6989586621679360190"><span class="hs-identifier hs-var">oldHashLookup</span></a></span><span> </span><span class="annot"><span class="annottext">[hash]
</span><a href="#local-6989586621679360192"><span class="hs-identifier hs-var">newHashLookup</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679360194"><span class="hs-identifier hs-var">bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>  </span><span class="annot"><a href="Unison.Sync.Types.html#PD"><span class="hs-identifier hs-type">Share.PD</span></a></span><span> </span><span class="annot"><a href="Unison.Sync.Types.html#PatchDiff"><span class="hs-identifier hs-type">Share.PatchDiff</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679360201"><span class="annot"><span class="annottext">hash
parent :: hash
$sel:parent:PatchDiff :: forall text oldHash hash. PatchDiff text oldHash hash -&gt; hash
</span><a href="#local-6989586621679360201"><span class="hs-identifier hs-var hs-var">parent</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360203"><span class="annot"><span class="annottext">[Text]
textLookup :: [Text]
$sel:textLookup:PatchDiff :: forall text oldHash hash. PatchDiff text oldHash hash -&gt; [text]
</span><a href="#local-6989586621679360203"><span class="hs-identifier hs-var hs-var">textLookup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360205"><span class="annot"><span class="annottext">[Hash32]
oldHashLookup :: [Hash32]
$sel:oldHashLookup:PatchDiff :: forall text oldHash hash. PatchDiff text oldHash hash -&gt; [oldHash]
</span><a href="#local-6989586621679360205"><span class="hs-identifier hs-var hs-var">oldHashLookup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360207"><span class="annot"><span class="annottext">[hash]
newHashLookup :: [hash]
$sel:newHashLookup:PatchDiff :: forall text oldHash hash. PatchDiff text oldHash hash -&gt; [hash]
</span><a href="#local-6989586621679360207"><span class="hs-identifier hs-var hs-var">newHashLookup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360209"><span class="annot"><span class="annottext">ByteString
bytes :: ByteString
$sel:bytes:PatchDiff :: forall text oldHash hash. PatchDiff text oldHash hash -&gt; ByteString
</span><a href="#local-6989586621679360209"><span class="hs-identifier hs-var hs-var">bytes</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><span class="annottext">SyncPatchFormat' Hash32 Text Hash32 Hash32 -&gt; TempEntity
forall text hash defn patch branchh branch causal.
SyncPatchFormat' patch text hash defn
-&gt; SyncEntity' text hash defn patch branchh branch causal
</span><span class="hs-identifier hs-var">Entity.P</span></span><span>
</span><span id="line-73"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Hash32
-&gt; PatchLocalIds' Text Hash32 Hash32
-&gt; ByteString
-&gt; SyncPatchFormat' Hash32 Text Hash32 Hash32
forall parent text hash defn.
parent
-&gt; PatchLocalIds' text hash defn
-&gt; ByteString
-&gt; SyncPatchFormat' parent text hash defn
</span><span class="hs-identifier hs-var">PatchFormat.SyncDiff</span></span><span>
</span><span id="line-74"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">hash -&gt; Hash32
</span><a href="#local-6989586621679360167"><span class="hs-identifier hs-var">toHash32</span></a></span><span> </span><span class="annot"><span class="annottext">hash
</span><a href="#local-6989586621679360201"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; [Hash32] -&gt; [hash] -&gt; PatchLocalIds' Text Hash32 Hash32
</span><a href="#local-6989586621679360198"><span class="hs-identifier hs-var">mungePatchLocalIds</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679360203"><span class="hs-identifier hs-var">textLookup</span></a></span><span> </span><span class="annot"><span class="annottext">[Hash32]
</span><a href="#local-6989586621679360205"><span class="hs-identifier hs-var">oldHashLookup</span></a></span><span> </span><span class="annot"><span class="annottext">[hash]
</span><a href="#local-6989586621679360207"><span class="hs-identifier hs-var">newHashLookup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>          </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679360209"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-77"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><a href="Unison.Sync.Types.html#N"><span class="hs-identifier hs-type">Share.N</span></a></span><span> </span><span class="annot"><a href="Unison.Sync.Types.html#Namespace"><span class="hs-identifier hs-type">Share.Namespace</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679360214"><span class="annot"><span class="annottext">[Text]
textLookup :: [Text]
$sel:textLookup:Namespace :: forall text hash. Namespace text hash -&gt; [text]
</span><a href="#local-6989586621679360214"><span class="hs-identifier hs-var hs-var">textLookup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360216"><span class="annot"><span class="annottext">[hash]
defnLookup :: [hash]
$sel:defnLookup:Namespace :: forall text hash. Namespace text hash -&gt; [hash]
</span><a href="#local-6989586621679360216"><span class="hs-identifier hs-var hs-var">defnLookup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360218"><span class="annot"><span class="annottext">[hash]
patchLookup :: [hash]
$sel:patchLookup:Namespace :: forall text hash. Namespace text hash -&gt; [hash]
</span><a href="#local-6989586621679360218"><span class="hs-identifier hs-var hs-var">patchLookup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360220"><span class="annot"><span class="annottext">[(hash, hash)]
childLookup :: [(hash, hash)]
$sel:childLookup:Namespace :: forall text hash. Namespace text hash -&gt; [(hash, hash)]
</span><a href="#local-6989586621679360220"><span class="hs-identifier hs-var hs-var">childLookup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360222"><span class="annot"><span class="annottext">LocalBranchBytes
bytes :: LocalBranchBytes
$sel:bytes:Namespace :: forall text hash. Namespace text hash -&gt; LocalBranchBytes
</span><a href="#local-6989586621679360222"><span class="hs-identifier hs-var hs-var">bytes</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><span class="annottext">SyncBranchFormat' Hash32 Text Hash32 Hash32 (Hash32, Hash32)
-&gt; TempEntity
forall text hash defn patch branchh branch causal.
SyncBranchFormat' branch text defn patch (branch, causal)
-&gt; SyncEntity' text hash defn patch branchh branch causal
</span><span class="hs-identifier hs-var">Entity.N</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BranchLocalIds' Text Hash32 Hash32 (Hash32, Hash32)
-&gt; LocalBranchBytes
-&gt; SyncBranchFormat' Hash32 Text Hash32 Hash32 (Hash32, Hash32)
forall parent text defn patch child.
BranchLocalIds' text defn patch child
-&gt; LocalBranchBytes
-&gt; SyncBranchFormat' parent text defn patch child
</span><span class="hs-identifier hs-var">NamespaceFormat.SyncFull</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text]
-&gt; [hash]
-&gt; [hash]
-&gt; [(hash, hash)]
-&gt; BranchLocalIds' Text Hash32 Hash32 (Hash32, Hash32)
</span><a href="#local-6989586621679360226"><span class="hs-identifier hs-var">mungeNamespaceLocalIds</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679360214"><span class="hs-identifier hs-var">textLookup</span></a></span><span> </span><span class="annot"><span class="annottext">[hash]
</span><a href="#local-6989586621679360216"><span class="hs-identifier hs-var">defnLookup</span></a></span><span> </span><span class="annot"><span class="annottext">[hash]
</span><a href="#local-6989586621679360218"><span class="hs-identifier hs-var">patchLookup</span></a></span><span> </span><span class="annot"><span class="annottext">[(hash, hash)]
</span><a href="#local-6989586621679360220"><span class="hs-identifier hs-var">childLookup</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalBranchBytes
</span><a href="#local-6989586621679360222"><span class="hs-identifier hs-var">bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><a href="Unison.Sync.Types.html#ND"><span class="hs-identifier hs-type">Share.ND</span></a></span><span> </span><span class="annot"><a href="Unison.Sync.Types.html#NamespaceDiff"><span class="hs-identifier hs-type">Share.NamespaceDiff</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679360229"><span class="annot"><span class="annottext">hash
parent :: hash
$sel:parent:NamespaceDiff :: forall text hash. NamespaceDiff text hash -&gt; hash
</span><a href="#local-6989586621679360229"><span class="hs-identifier hs-var hs-var">parent</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360231"><span class="annot"><span class="annottext">[Text]
textLookup :: [Text]
$sel:textLookup:NamespaceDiff :: forall text hash. NamespaceDiff text hash -&gt; [text]
</span><a href="#local-6989586621679360231"><span class="hs-identifier hs-var hs-var">textLookup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360233"><span class="annot"><span class="annottext">[hash]
defnLookup :: [hash]
$sel:defnLookup:NamespaceDiff :: forall text hash. NamespaceDiff text hash -&gt; [hash]
</span><a href="#local-6989586621679360233"><span class="hs-identifier hs-var hs-var">defnLookup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360235"><span class="annot"><span class="annottext">[hash]
patchLookup :: [hash]
$sel:patchLookup:NamespaceDiff :: forall text hash. NamespaceDiff text hash -&gt; [hash]
</span><a href="#local-6989586621679360235"><span class="hs-identifier hs-var hs-var">patchLookup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360237"><span class="annot"><span class="annottext">[(hash, hash)]
childLookup :: [(hash, hash)]
$sel:childLookup:NamespaceDiff :: forall text hash. NamespaceDiff text hash -&gt; [(hash, hash)]
</span><a href="#local-6989586621679360237"><span class="hs-identifier hs-var hs-var">childLookup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360239"><span class="annot"><span class="annottext">LocalBranchBytes
bytes :: LocalBranchBytes
$sel:bytes:NamespaceDiff :: forall text hash. NamespaceDiff text hash -&gt; LocalBranchBytes
</span><a href="#local-6989586621679360239"><span class="hs-identifier hs-var hs-var">bytes</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><span class="annottext">SyncBranchFormat' Hash32 Text Hash32 Hash32 (Hash32, Hash32)
-&gt; TempEntity
forall text hash defn patch branchh branch causal.
SyncBranchFormat' branch text defn patch (branch, causal)
-&gt; SyncEntity' text hash defn patch branchh branch causal
</span><span class="hs-identifier hs-var">Entity.N</span></span><span>
</span><span id="line-82"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Hash32
-&gt; BranchLocalIds' Text Hash32 Hash32 (Hash32, Hash32)
-&gt; LocalBranchBytes
-&gt; SyncBranchFormat' Hash32 Text Hash32 Hash32 (Hash32, Hash32)
forall parent text defn patch child.
parent
-&gt; BranchLocalIds' text defn patch child
-&gt; LocalBranchBytes
-&gt; SyncBranchFormat' parent text defn patch child
</span><span class="hs-identifier hs-var">NamespaceFormat.SyncDiff</span></span><span>
</span><span id="line-83"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">hash -&gt; Hash32
</span><a href="#local-6989586621679360167"><span class="hs-identifier hs-var">toHash32</span></a></span><span> </span><span class="annot"><span class="annottext">hash
</span><a href="#local-6989586621679360229"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text]
-&gt; [hash]
-&gt; [hash]
-&gt; [(hash, hash)]
-&gt; BranchLocalIds' Text Hash32 Hash32 (Hash32, Hash32)
</span><a href="#local-6989586621679360226"><span class="hs-identifier hs-var">mungeNamespaceLocalIds</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679360231"><span class="hs-identifier hs-var">textLookup</span></a></span><span> </span><span class="annot"><span class="annottext">[hash]
</span><a href="#local-6989586621679360233"><span class="hs-identifier hs-var">defnLookup</span></a></span><span> </span><span class="annot"><span class="annottext">[hash]
</span><a href="#local-6989586621679360235"><span class="hs-identifier hs-var">patchLookup</span></a></span><span> </span><span class="annot"><span class="annottext">[(hash, hash)]
</span><a href="#local-6989586621679360237"><span class="hs-identifier hs-var">childLookup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>          </span><span class="annot"><span class="annottext">LocalBranchBytes
</span><a href="#local-6989586621679360239"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-86"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><a href="Unison.Sync.Types.html#C"><span class="hs-identifier hs-type">Share.C</span></a></span><span> </span><span class="annot"><a href="Unison.Sync.Types.html#Causal"><span class="hs-identifier hs-type">Share.Causal</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679360244"><span class="annot"><span class="annottext">hash
namespaceHash :: hash
$sel:namespaceHash:Causal :: forall hash. Causal hash -&gt; hash
</span><a href="#local-6989586621679360244"><span class="hs-identifier hs-var hs-var">namespaceHash</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360246"><span class="annot"><span class="annottext">Set hash
parents :: Set hash
$sel:parents:Causal :: forall hash. Causal hash -&gt; Set hash
</span><a href="#local-6989586621679360246"><span class="hs-identifier hs-var hs-var">parents</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><span class="annottext">SyncCausalFormat' Hash32 Hash32 -&gt; TempEntity
forall text hash defn patch branchh branch causal.
SyncCausalFormat' causal branchh
-&gt; SyncEntity' text hash defn patch branchh branch causal
</span><span class="hs-identifier hs-var">Entity.C</span></span><span>
</span><span id="line-89"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Causal.SyncCausalFormat</span></span><span>
</span><span id="line-90"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:valueHash:SyncCausalFormat :: Hash32
</span><span class="hs-identifier hs-var">valueHash</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">hash -&gt; Hash32
</span><a href="#local-6989586621679360167"><span class="hs-identifier hs-var">toHash32</span></a></span><span> </span><span class="annot"><span class="annottext">hash
</span><a href="#local-6989586621679360244"><span class="hs-identifier hs-var">namespaceHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>          </span><span class="annot"><span class="annottext">$sel:parents:SyncCausalFormat :: Vector Hash32
</span><span class="hs-identifier hs-var">parents</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Hash32] -&gt; Vector Hash32
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">Vector.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(hash -&gt; Hash32) -&gt; [hash] -&gt; [Hash32]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">hash -&gt; Hash32
</span><a href="#local-6989586621679360167"><span class="hs-identifier hs-var">toHash32</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set hash -&gt; [hash]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set hash
</span><a href="#local-6989586621679360246"><span class="hs-identifier hs-var">parents</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><a href="#local-6989586621679360176"><span class="hs-identifier hs-type">mungeLocalIds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Sync.Types.html#LocalIds"><span class="hs-identifier hs-type">Share.LocalIds</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="#local-6989586621679359978"><span class="hs-identifier hs-type">hash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TempEntity.TempLocalIds</span></span><span>
</span><span id="line-95"></span><span>    </span><span id="local-6989586621679360176"><span class="annot"><span class="annottext">mungeLocalIds :: LocalIds Text hash -&gt; LocalIds' Text Hash32
</span><a href="#local-6989586621679360176"><span class="hs-identifier hs-var hs-var">mungeLocalIds</span></a></span></span><span> </span><span class="annot"><a href="Unison.Sync.Types.html#LocalIds"><span class="hs-identifier hs-type">Share.LocalIds</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679360255"><span class="annot"><span class="annottext">[Text]
texts :: [Text]
$sel:texts:LocalIds :: forall text hash. LocalIds text hash -&gt; [text]
</span><a href="#local-6989586621679360255"><span class="hs-identifier hs-var hs-var">texts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360257"><span class="annot"><span class="annottext">[hash]
hashes :: [hash]
$sel:hashes:LocalIds :: forall text hash. LocalIds text hash -&gt; [hash]
</span><a href="#local-6989586621679360257"><span class="hs-identifier hs-var hs-var">hashes</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-96"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">LocalIds</span></span><span>
</span><span id="line-97"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:textLookup:LocalIds :: Vector Text
</span><span class="hs-identifier hs-var">textLookup</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Vector Text
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">Vector.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679360255"><span class="hs-identifier hs-var">texts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>          </span><span class="annot"><span class="annottext">$sel:defnLookup:LocalIds :: Vector Hash32
</span><span class="hs-identifier hs-var">defnLookup</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(hash -&gt; Hash32) -&gt; Vector hash -&gt; Vector Hash32
forall a b. (a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><span class="hs-identifier hs-var">Vector.map</span></span><span> </span><span class="annot"><span class="annottext">hash -&gt; Hash32
</span><a href="#local-6989586621679360167"><span class="hs-identifier hs-var">toHash32</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[hash] -&gt; Vector hash
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">Vector.fromList</span></span><span> </span><span class="annot"><span class="annottext">[hash]
</span><a href="#local-6989586621679360257"><span class="hs-identifier hs-var">hashes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>    </span><span class="annot"><a href="#local-6989586621679360226"><span class="hs-identifier hs-type">mungeNamespaceLocalIds</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-102"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-103"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679359978"><span class="hs-identifier hs-type">hash</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-104"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679359978"><span class="hs-identifier hs-type">hash</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-105"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679359978"><span class="hs-identifier hs-type">hash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679359978"><span class="hs-identifier hs-type">hash</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-106"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">TempEntity.TempNamespaceLocalIds</span></span><span>
</span><span id="line-107"></span><span>    </span><span id="local-6989586621679360226"><span class="annot"><span class="annottext">mungeNamespaceLocalIds :: [Text]
-&gt; [hash]
-&gt; [hash]
-&gt; [(hash, hash)]
-&gt; BranchLocalIds' Text Hash32 Hash32 (Hash32, Hash32)
</span><a href="#local-6989586621679360226"><span class="hs-identifier hs-var hs-var">mungeNamespaceLocalIds</span></a></span></span><span> </span><span id="local-6989586621679360263"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679360263"><span class="hs-identifier hs-var">textLookup</span></a></span></span><span> </span><span id="local-6989586621679360264"><span class="annot"><span class="annottext">[hash]
</span><a href="#local-6989586621679360264"><span class="hs-identifier hs-var">defnLookup</span></a></span></span><span> </span><span id="local-6989586621679360265"><span class="annot"><span class="annottext">[hash]
</span><a href="#local-6989586621679360265"><span class="hs-identifier hs-var">patchLookup</span></a></span></span><span> </span><span id="local-6989586621679360266"><span class="annot"><span class="annottext">[(hash, hash)]
</span><a href="#local-6989586621679360266"><span class="hs-identifier hs-var">childLookup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-108"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">NamespaceFormat.LocalIds</span></span><span>
</span><span id="line-109"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:branchTextLookup:LocalIds :: Vector Text
</span><span class="hs-identifier hs-var">branchTextLookup</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Vector Text
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">Vector.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679360263"><span class="hs-identifier hs-var">textLookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>          </span><span class="annot"><span class="annottext">$sel:branchDefnLookup:LocalIds :: Vector Hash32
</span><span class="hs-identifier hs-var">branchDefnLookup</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Hash32] -&gt; Vector Hash32
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">Vector.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(hash -&gt; Hash32) -&gt; [hash] -&gt; [Hash32]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">hash -&gt; Hash32
</span><a href="#local-6989586621679360167"><span class="hs-identifier hs-var">toHash32</span></a></span><span> </span><span class="annot"><span class="annottext">[hash]
</span><a href="#local-6989586621679360264"><span class="hs-identifier hs-var">defnLookup</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>          </span><span class="annot"><span class="annottext">$sel:branchPatchLookup:LocalIds :: Vector Hash32
</span><span class="hs-identifier hs-var">branchPatchLookup</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Hash32] -&gt; Vector Hash32
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">Vector.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(hash -&gt; Hash32) -&gt; [hash] -&gt; [Hash32]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">hash -&gt; Hash32
</span><a href="#local-6989586621679360167"><span class="hs-identifier hs-var">toHash32</span></a></span><span> </span><span class="annot"><span class="annottext">[hash]
</span><a href="#local-6989586621679360265"><span class="hs-identifier hs-var">patchLookup</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>          </span><span class="annot"><span class="annottext">$sel:branchChildLookup:LocalIds :: Vector (Hash32, Hash32)
</span><span class="hs-identifier hs-var">branchChildLookup</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Hash32, Hash32)] -&gt; Vector (Hash32, Hash32)
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">Vector.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((hash, hash) -&gt; (Hash32, Hash32))
-&gt; [(hash, hash)] -&gt; [(Hash32, Hash32)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679360272"><span class="annot"><span class="annottext">hash
</span><a href="#local-6989586621679360272"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360273"><span class="annot"><span class="annottext">hash
</span><a href="#local-6989586621679360273"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">hash -&gt; Hash32
</span><a href="#local-6989586621679360167"><span class="hs-identifier hs-var">toHash32</span></a></span><span> </span><span class="annot"><span class="annottext">hash
</span><a href="#local-6989586621679360272"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hash -&gt; Hash32
</span><a href="#local-6989586621679360167"><span class="hs-identifier hs-var">toHash32</span></a></span><span> </span><span class="annot"><span class="annottext">hash
</span><a href="#local-6989586621679360273"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(hash, hash)]
</span><a href="#local-6989586621679360266"><span class="hs-identifier hs-var">childLookup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>    </span><span class="annot"><a href="#local-6989586621679360198"><span class="hs-identifier hs-type">mungePatchLocalIds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Hash32</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679359978"><span class="hs-identifier hs-type">hash</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TempEntity.TempPatchLocalIds</span></span><span>
</span><span id="line-116"></span><span>    </span><span id="local-6989586621679360198"><span class="annot"><span class="annottext">mungePatchLocalIds :: [Text] -&gt; [Hash32] -&gt; [hash] -&gt; PatchLocalIds' Text Hash32 Hash32
</span><a href="#local-6989586621679360198"><span class="hs-identifier hs-var hs-var">mungePatchLocalIds</span></a></span></span><span> </span><span id="local-6989586621679360275"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679360275"><span class="hs-identifier hs-var">textLookup</span></a></span></span><span> </span><span id="local-6989586621679360276"><span class="annot"><span class="annottext">[Hash32]
</span><a href="#local-6989586621679360276"><span class="hs-identifier hs-var">oldHashLookup</span></a></span></span><span> </span><span id="local-6989586621679360277"><span class="annot"><span class="annottext">[hash]
</span><a href="#local-6989586621679360277"><span class="hs-identifier hs-var">newHashLookup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-117"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">PatchFormat.LocalIds</span></span><span>
</span><span id="line-118"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:patchTextLookup:LocalIds :: Vector Text
</span><span class="hs-identifier hs-var">patchTextLookup</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Vector Text
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">Vector.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679360275"><span class="hs-identifier hs-var">textLookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-119"></span><span>          </span><span class="annot"><span class="annottext">$sel:patchHashLookup:LocalIds :: Vector Hash32
</span><span class="hs-identifier hs-var">patchHashLookup</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Hash32] -&gt; Vector Hash32
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">Vector.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Hash32]
</span><a href="#local-6989586621679360276"><span class="hs-identifier hs-var">oldHashLookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-120"></span><span>          </span><span class="annot"><span class="annottext">$sel:patchDefnLookup:LocalIds :: Vector Hash32
</span><span class="hs-identifier hs-var">patchDefnLookup</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Hash32] -&gt; Vector Hash32
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">Vector.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(hash -&gt; Hash32) -&gt; [hash] -&gt; [Hash32]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">hash -&gt; Hash32
</span><a href="#local-6989586621679360167"><span class="hs-identifier hs-var">toHash32</span></a></span><span> </span><span class="annot"><span class="annottext">[hash]
</span><a href="#local-6989586621679360277"><span class="hs-identifier hs-var">newHashLookup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="annot"><a href="Unison.Sync.Common.html#tempEntityToEntity"><span class="hs-identifier hs-type">tempEntityToEntity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.TempEntity</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Sync.Types.html#Entity"><span class="hs-identifier hs-type">Share.Entity</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hash32</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hash32</span></span><span>
</span><span id="line-124"></span><span id="tempEntityToEntity"><span class="annot"><span class="annottext">tempEntityToEntity :: TempEntity -&gt; Entity Text Hash32 Hash32
</span><a href="Unison.Sync.Common.html#tempEntityToEntity"><span class="hs-identifier hs-var hs-var">tempEntityToEntity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Entity.TC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermFormat.SyncTerm</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermFormat.SyncLocallyIndexedComponent</span></span><span> </span><span id="local-6989586621679360282"><span class="annot"><span class="annottext">Vector (LocalIds' Text Hash32, ByteString)
</span><a href="#local-6989586621679360282"><span class="hs-identifier hs-var">terms</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><span class="annottext">Vector (LocalIds' Text Hash32, ByteString)
</span><a href="#local-6989586621679360282"><span class="hs-identifier hs-var">terms</span></a></span><span>
</span><span id="line-127"></span><span>      </span><span class="annot"><span class="annottext">Vector (LocalIds' Text Hash32, ByteString)
-&gt; (Vector (LocalIds' Text Hash32, ByteString)
    -&gt; Vector (LocalIds Text Hash32, ByteString))
-&gt; Vector (LocalIds Text Hash32, ByteString)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">((LocalIds' Text Hash32, ByteString)
 -&gt; (LocalIds Text Hash32, ByteString))
-&gt; Vector (LocalIds' Text Hash32, ByteString)
-&gt; Vector (LocalIds Text Hash32, ByteString)
forall a b. (a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><span class="hs-identifier hs-var">Vector.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ASetter
  (LocalIds' Text Hash32, ByteString)
  (LocalIds Text Hash32, ByteString)
  (LocalIds' Text Hash32)
  (LocalIds Text Hash32)
-&gt; (LocalIds' Text Hash32 -&gt; LocalIds Text Hash32)
-&gt; (LocalIds' Text Hash32, ByteString)
-&gt; (LocalIds Text Hash32, ByteString)
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">Lens.over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (LocalIds' Text Hash32, ByteString)
  (LocalIds Text Hash32, ByteString)
  (LocalIds' Text Hash32)
  (LocalIds Text Hash32)
forall s t a b. Field1 s t a b =&gt; Lens s t a b
Lens
  (LocalIds' Text Hash32, ByteString)
  (LocalIds Text Hash32, ByteString)
  (LocalIds' Text Hash32)
  (LocalIds Text Hash32)
</span><span class="hs-identifier hs-var">Lens._1</span></span><span> </span><span class="annot"><span class="annottext">LocalIds' Text Hash32 -&gt; LocalIds Text Hash32
</span><a href="#local-6989586621679360283"><span class="hs-identifier hs-var">mungeLocalIds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>      </span><span class="annot"><span class="annottext">Vector (LocalIds Text Hash32, ByteString)
-&gt; (Vector (LocalIds Text Hash32, ByteString)
    -&gt; [(LocalIds Text Hash32, ByteString)])
-&gt; [(LocalIds Text Hash32, ByteString)]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Vector (LocalIds Text Hash32, ByteString)
-&gt; [(LocalIds Text Hash32, ByteString)]
forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">Vector.toList</span></span><span>
</span><span id="line-129"></span><span>      </span><span class="annot"><span class="annottext">[(LocalIds Text Hash32, ByteString)]
-&gt; ([(LocalIds Text Hash32, ByteString)]
    -&gt; TermComponent Text Hash32)
-&gt; TermComponent Text Hash32
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[(LocalIds Text Hash32, ByteString)] -&gt; TermComponent Text Hash32
forall text hash.
[(LocalIds text hash, ByteString)] -&gt; TermComponent text hash
</span><a href="Unison.Sync.Types.html#TermComponent"><span class="hs-identifier hs-var">Share.TermComponent</span></a></span><span>
</span><span id="line-130"></span><span>      </span><span class="annot"><span class="annottext">TermComponent Text Hash32
-&gt; (TermComponent Text Hash32 -&gt; Entity Text Hash32 Hash32)
-&gt; Entity Text Hash32 Hash32
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">TermComponent Text Hash32 -&gt; Entity Text Hash32 Hash32
forall text noSyncHash hash.
TermComponent text hash -&gt; Entity text noSyncHash hash
</span><a href="Unison.Sync.Types.html#TC"><span class="hs-identifier hs-var">Share.TC</span></a></span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Entity.DC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DeclFormat.SyncDecl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DeclFormat.SyncLocallyIndexedComponent</span></span><span> </span><span id="local-6989586621679360285"><span class="annot"><span class="annottext">Vector (LocalIds' Text Hash32, ByteString)
</span><a href="#local-6989586621679360285"><span class="hs-identifier hs-var">decls</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><span class="annottext">Vector (LocalIds' Text Hash32, ByteString)
</span><a href="#local-6989586621679360285"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-133"></span><span>      </span><span class="annot"><span class="annottext">Vector (LocalIds' Text Hash32, ByteString)
-&gt; (Vector (LocalIds' Text Hash32, ByteString)
    -&gt; Vector (LocalIds Text Hash32, ByteString))
-&gt; Vector (LocalIds Text Hash32, ByteString)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">((LocalIds' Text Hash32, ByteString)
 -&gt; (LocalIds Text Hash32, ByteString))
-&gt; Vector (LocalIds' Text Hash32, ByteString)
-&gt; Vector (LocalIds Text Hash32, ByteString)
forall a b. (a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><span class="hs-identifier hs-var">Vector.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ASetter
  (LocalIds' Text Hash32, ByteString)
  (LocalIds Text Hash32, ByteString)
  (LocalIds' Text Hash32)
  (LocalIds Text Hash32)
-&gt; (LocalIds' Text Hash32 -&gt; LocalIds Text Hash32)
-&gt; (LocalIds' Text Hash32, ByteString)
-&gt; (LocalIds Text Hash32, ByteString)
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">Lens.over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (LocalIds' Text Hash32, ByteString)
  (LocalIds Text Hash32, ByteString)
  (LocalIds' Text Hash32)
  (LocalIds Text Hash32)
forall s t a b. Field1 s t a b =&gt; Lens s t a b
Lens
  (LocalIds' Text Hash32, ByteString)
  (LocalIds Text Hash32, ByteString)
  (LocalIds' Text Hash32)
  (LocalIds Text Hash32)
</span><span class="hs-identifier hs-var">Lens._1</span></span><span> </span><span class="annot"><span class="annottext">LocalIds' Text Hash32 -&gt; LocalIds Text Hash32
</span><a href="#local-6989586621679360283"><span class="hs-identifier hs-var">mungeLocalIds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>      </span><span class="annot"><span class="annottext">Vector (LocalIds Text Hash32, ByteString)
-&gt; (Vector (LocalIds Text Hash32, ByteString)
    -&gt; [(LocalIds Text Hash32, ByteString)])
-&gt; [(LocalIds Text Hash32, ByteString)]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Vector (LocalIds Text Hash32, ByteString)
-&gt; [(LocalIds Text Hash32, ByteString)]
forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">Vector.toList</span></span><span>
</span><span id="line-135"></span><span>      </span><span class="annot"><span class="annottext">[(LocalIds Text Hash32, ByteString)]
-&gt; ([(LocalIds Text Hash32, ByteString)]
    -&gt; DeclComponent Text Hash32)
-&gt; DeclComponent Text Hash32
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[(LocalIds Text Hash32, ByteString)] -&gt; DeclComponent Text Hash32
forall text hash.
[(LocalIds text hash, ByteString)] -&gt; DeclComponent text hash
</span><a href="Unison.Sync.Types.html#DeclComponent"><span class="hs-identifier hs-var">Share.DeclComponent</span></a></span><span>
</span><span id="line-136"></span><span>      </span><span class="annot"><span class="annottext">DeclComponent Text Hash32
-&gt; (DeclComponent Text Hash32 -&gt; Entity Text Hash32 Hash32)
-&gt; Entity Text Hash32 Hash32
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">DeclComponent Text Hash32 -&gt; Entity Text Hash32 Hash32
forall text noSyncHash hash.
DeclComponent text hash -&gt; Entity text noSyncHash hash
</span><a href="Unison.Sync.Types.html#DC"><span class="hs-identifier hs-var">Share.DC</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Entity.P</span></span><span> </span><span id="local-6989586621679360286"><span class="annot"><span class="annottext">SyncPatchFormat' Hash32 Text Hash32 Hash32
</span><a href="#local-6989586621679360286"><span class="hs-identifier hs-var">format</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SyncPatchFormat' Hash32 Text Hash32 Hash32
</span><a href="#local-6989586621679360286"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-139"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">PatchFormat.SyncFull</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PatchFormat.LocalIds</span></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679360287"><span class="annot"><span class="annottext">Vector Text
$sel:patchTextLookup:LocalIds :: forall t h d. PatchLocalIds' t h d -&gt; Vector t
patchTextLookup :: Vector Text
</span><span class="hs-identifier hs-var hs-var">patchTextLookup</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360288"><span class="annot"><span class="annottext">Vector Hash32
$sel:patchHashLookup:LocalIds :: forall t h d. PatchLocalIds' t h d -&gt; Vector h
patchHashLookup :: Vector Hash32
</span><span class="hs-identifier hs-var hs-var">patchHashLookup</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360289"><span class="annot"><span class="annottext">Vector Hash32
$sel:patchDefnLookup:LocalIds :: forall t h d. PatchLocalIds' t h d -&gt; Vector d
patchDefnLookup :: Vector Hash32
</span><span class="hs-identifier hs-var hs-var">patchDefnLookup</span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679360290"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679360290"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-140"></span><span>        </span><span class="annot"><span class="annottext">Patch Text Hash32 Hash32 -&gt; Entity Text Hash32 Hash32
forall text noSyncHash hash.
Patch text noSyncHash hash -&gt; Entity text noSyncHash hash
</span><a href="Unison.Sync.Types.html#P"><span class="hs-identifier hs-var">Share.P</span></a></span><span>
</span><span id="line-141"></span><span>          </span><span class="annot"><a href="Unison.Sync.Types.html#Patch"><span class="hs-identifier hs-type">Share.Patch</span></a></span><span>
</span><span id="line-142"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:textLookup:Patch :: [Text]
</span><a href="Unison.Sync.Types.html#%24sel%3AtextLookup%3APatch"><span class="hs-identifier hs-var">textLookup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Text -&gt; [Text]
forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">Vector.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector Text
</span><a href="#local-6989586621679360287"><span class="hs-identifier hs-var">patchTextLookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-143"></span><span>              </span><span class="annot"><span class="annottext">$sel:oldHashLookup:Patch :: [Hash32]
</span><a href="Unison.Sync.Types.html#%24sel%3AoldHashLookup%3APatch"><span class="hs-identifier hs-var">oldHashLookup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Hash32 -&gt; [Hash32]
forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">Vector.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector Hash32
</span><a href="#local-6989586621679360288"><span class="hs-identifier hs-var">patchHashLookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-144"></span><span>              </span><span class="annot"><span class="annottext">$sel:newHashLookup:Patch :: [Hash32]
</span><a href="Unison.Sync.Types.html#%24sel%3AnewHashLookup%3APatch"><span class="hs-identifier hs-var">newHashLookup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Hash32 -&gt; [Hash32]
forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">Vector.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector Hash32
</span><a href="#local-6989586621679360289"><span class="hs-identifier hs-var">patchDefnLookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-145"></span><span>              </span><span class="annot"><span class="annottext">ByteString
$sel:bytes:Patch :: ByteString
bytes :: ByteString
</span><a href="Unison.Sync.Types.html#%24sel%3Abytes%3APatch"><span class="hs-identifier hs-var hs-var">bytes</span></a></span><span>
</span><span id="line-146"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-147"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">PatchFormat.SyncDiff</span></span><span> </span><span id="local-6989586621679360291"><span class="annot"><span class="annottext">Hash32
</span><a href="#local-6989586621679360291"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PatchFormat.LocalIds</span></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679360292"><span class="annot"><span class="annottext">Vector Text
$sel:patchTextLookup:LocalIds :: forall t h d. PatchLocalIds' t h d -&gt; Vector t
patchTextLookup :: Vector Text
</span><span class="hs-identifier hs-var hs-var">patchTextLookup</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360293"><span class="annot"><span class="annottext">Vector Hash32
$sel:patchHashLookup:LocalIds :: forall t h d. PatchLocalIds' t h d -&gt; Vector h
patchHashLookup :: Vector Hash32
</span><span class="hs-identifier hs-var hs-var">patchHashLookup</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360294"><span class="annot"><span class="annottext">Vector Hash32
$sel:patchDefnLookup:LocalIds :: forall t h d. PatchLocalIds' t h d -&gt; Vector d
patchDefnLookup :: Vector Hash32
</span><span class="hs-identifier hs-var hs-var">patchDefnLookup</span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679360295"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679360295"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-148"></span><span>        </span><span class="annot"><span class="annottext">PatchDiff Text Hash32 Hash32 -&gt; Entity Text Hash32 Hash32
forall text noSyncHash hash.
PatchDiff text noSyncHash hash -&gt; Entity text noSyncHash hash
</span><a href="Unison.Sync.Types.html#PD"><span class="hs-identifier hs-var">Share.PD</span></a></span><span>
</span><span id="line-149"></span><span>          </span><span class="annot"><a href="Unison.Sync.Types.html#PatchDiff"><span class="hs-identifier hs-type">Share.PatchDiff</span></a></span><span>
</span><span id="line-150"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Hash32
$sel:parent:PatchDiff :: Hash32
parent :: Hash32
</span><a href="Unison.Sync.Types.html#%24sel%3Aparent%3APatchDiff"><span class="hs-identifier hs-var hs-var">parent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-151"></span><span>              </span><span class="annot"><span class="annottext">$sel:textLookup:PatchDiff :: [Text]
</span><a href="Unison.Sync.Types.html#%24sel%3AtextLookup%3APatchDiff"><span class="hs-identifier hs-var">textLookup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Text -&gt; [Text]
forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">Vector.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector Text
</span><a href="#local-6989586621679360292"><span class="hs-identifier hs-var">patchTextLookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-152"></span><span>              </span><span class="annot"><span class="annottext">$sel:oldHashLookup:PatchDiff :: [Hash32]
</span><a href="Unison.Sync.Types.html#%24sel%3AoldHashLookup%3APatchDiff"><span class="hs-identifier hs-var">oldHashLookup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Hash32 -&gt; [Hash32]
forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">Vector.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector Hash32
</span><a href="#local-6989586621679360293"><span class="hs-identifier hs-var">patchHashLookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-153"></span><span>              </span><span class="annot"><span class="annottext">$sel:newHashLookup:PatchDiff :: [Hash32]
</span><a href="Unison.Sync.Types.html#%24sel%3AnewHashLookup%3APatchDiff"><span class="hs-identifier hs-var">newHashLookup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Hash32 -&gt; [Hash32]
forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">Vector.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector Hash32
</span><a href="#local-6989586621679360294"><span class="hs-identifier hs-var">patchDefnLookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-154"></span><span>              </span><span class="annot"><span class="annottext">ByteString
$sel:bytes:PatchDiff :: ByteString
bytes :: ByteString
</span><a href="Unison.Sync.Types.html#%24sel%3Abytes%3APatchDiff"><span class="hs-identifier hs-var hs-var">bytes</span></a></span><span>
</span><span id="line-155"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-156"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Entity.N</span></span><span> </span><span id="local-6989586621679360296"><span class="annot"><span class="annottext">SyncBranchFormat' Hash32 Text Hash32 Hash32 (Hash32, Hash32)
</span><a href="#local-6989586621679360296"><span class="hs-identifier hs-var">format</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SyncBranchFormat' Hash32 Text Hash32 Hash32 (Hash32, Hash32)
</span><a href="#local-6989586621679360296"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-158"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">NamespaceFormat.SyncFull</span></span><span>
</span><span id="line-159"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">NamespaceFormat.LocalIds</span></span><span>
</span><span id="line-160"></span><span>          </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679360297"><span class="annot"><span class="annottext">Vector Text
$sel:branchTextLookup:LocalIds :: forall t d p c. BranchLocalIds' t d p c -&gt; Vector t
branchTextLookup :: Vector Text
</span><span class="hs-identifier hs-var hs-var">branchTextLookup</span></span></span><span class="hs-special">,</span><span>
</span><span id="line-161"></span><span>            </span><span id="local-6989586621679360298"><span class="annot"><span class="annottext">Vector Hash32
$sel:branchDefnLookup:LocalIds :: forall t d p c. BranchLocalIds' t d p c -&gt; Vector d
branchDefnLookup :: Vector Hash32
</span><span class="hs-identifier hs-var hs-var">branchDefnLookup</span></span></span><span class="hs-special">,</span><span>
</span><span id="line-162"></span><span>            </span><span id="local-6989586621679360299"><span class="annot"><span class="annottext">Vector Hash32
$sel:branchPatchLookup:LocalIds :: forall t d p c. BranchLocalIds' t d p c -&gt; Vector p
branchPatchLookup :: Vector Hash32
</span><span class="hs-identifier hs-var hs-var">branchPatchLookup</span></span></span><span class="hs-special">,</span><span>
</span><span id="line-163"></span><span>            </span><span id="local-6989586621679360300"><span class="annot"><span class="annottext">Vector (Hash32, Hash32)
$sel:branchChildLookup:LocalIds :: forall t d p c. BranchLocalIds' t d p c -&gt; Vector c
branchChildLookup :: Vector (Hash32, Hash32)
</span><span class="hs-identifier hs-var hs-var">branchChildLookup</span></span></span><span>
</span><span id="line-164"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-165"></span><span>        </span><span id="local-6989586621679360301"><span class="annot"><span class="annottext">LocalBranchBytes
</span><a href="#local-6989586621679360301"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-166"></span><span>          </span><span class="annot"><span class="annottext">Namespace Text Hash32 -&gt; Entity Text Hash32 Hash32
forall text noSyncHash hash.
Namespace text hash -&gt; Entity text noSyncHash hash
</span><a href="Unison.Sync.Types.html#N"><span class="hs-identifier hs-var">Share.N</span></a></span><span>
</span><span id="line-167"></span><span>            </span><span class="annot"><a href="Unison.Sync.Types.html#Namespace"><span class="hs-identifier hs-type">Share.Namespace</span></a></span><span>
</span><span id="line-168"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:textLookup:Namespace :: [Text]
</span><a href="Unison.Sync.Types.html#%24sel%3AtextLookup%3ANamespace"><span class="hs-identifier hs-var">textLookup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Text -&gt; [Text]
forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">Vector.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector Text
</span><a href="#local-6989586621679360297"><span class="hs-identifier hs-var">branchTextLookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-169"></span><span>                </span><span class="annot"><span class="annottext">$sel:defnLookup:Namespace :: [Hash32]
</span><a href="Unison.Sync.Types.html#%24sel%3AdefnLookup%3ANamespace"><span class="hs-identifier hs-var">defnLookup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Hash32 -&gt; [Hash32]
forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">Vector.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector Hash32
</span><a href="#local-6989586621679360298"><span class="hs-identifier hs-var">branchDefnLookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-170"></span><span>                </span><span class="annot"><span class="annottext">$sel:patchLookup:Namespace :: [Hash32]
</span><a href="Unison.Sync.Types.html#%24sel%3ApatchLookup%3ANamespace"><span class="hs-identifier hs-var">patchLookup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Hash32 -&gt; [Hash32]
forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">Vector.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector Hash32
</span><a href="#local-6989586621679360299"><span class="hs-identifier hs-var">branchPatchLookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-171"></span><span>                </span><span class="annot"><span class="annottext">$sel:childLookup:Namespace :: [(Hash32, Hash32)]
</span><a href="Unison.Sync.Types.html#%24sel%3AchildLookup%3ANamespace"><span class="hs-identifier hs-var">childLookup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (Hash32, Hash32) -&gt; [(Hash32, Hash32)]
forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">Vector.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector (Hash32, Hash32)
</span><a href="#local-6989586621679360300"><span class="hs-identifier hs-var">branchChildLookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-172"></span><span>                </span><span class="annot"><span class="annottext">LocalBranchBytes
$sel:bytes:Namespace :: LocalBranchBytes
bytes :: LocalBranchBytes
</span><a href="Unison.Sync.Types.html#%24sel%3Abytes%3ANamespace"><span class="hs-identifier hs-var hs-var">bytes</span></a></span><span>
</span><span id="line-173"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-174"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">NamespaceFormat.SyncDiff</span></span><span>
</span><span id="line-175"></span><span>        </span><span id="local-6989586621679360302"><span class="annot"><span class="annottext">Hash32
</span><a href="#local-6989586621679360302"><span class="hs-identifier hs-var">parent</span></a></span></span><span>
</span><span id="line-176"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">NamespaceFormat.LocalIds</span></span><span>
</span><span id="line-177"></span><span>          </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679360303"><span class="annot"><span class="annottext">Vector Text
$sel:branchTextLookup:LocalIds :: forall t d p c. BranchLocalIds' t d p c -&gt; Vector t
branchTextLookup :: Vector Text
</span><span class="hs-identifier hs-var hs-var">branchTextLookup</span></span></span><span class="hs-special">,</span><span>
</span><span id="line-178"></span><span>            </span><span id="local-6989586621679360304"><span class="annot"><span class="annottext">Vector Hash32
$sel:branchDefnLookup:LocalIds :: forall t d p c. BranchLocalIds' t d p c -&gt; Vector d
branchDefnLookup :: Vector Hash32
</span><span class="hs-identifier hs-var hs-var">branchDefnLookup</span></span></span><span class="hs-special">,</span><span>
</span><span id="line-179"></span><span>            </span><span id="local-6989586621679360305"><span class="annot"><span class="annottext">Vector Hash32
$sel:branchPatchLookup:LocalIds :: forall t d p c. BranchLocalIds' t d p c -&gt; Vector p
branchPatchLookup :: Vector Hash32
</span><span class="hs-identifier hs-var hs-var">branchPatchLookup</span></span></span><span class="hs-special">,</span><span>
</span><span id="line-180"></span><span>            </span><span id="local-6989586621679360306"><span class="annot"><span class="annottext">Vector (Hash32, Hash32)
$sel:branchChildLookup:LocalIds :: forall t d p c. BranchLocalIds' t d p c -&gt; Vector c
branchChildLookup :: Vector (Hash32, Hash32)
</span><span class="hs-identifier hs-var hs-var">branchChildLookup</span></span></span><span>
</span><span id="line-181"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-182"></span><span>        </span><span id="local-6989586621679360307"><span class="annot"><span class="annottext">LocalBranchBytes
</span><a href="#local-6989586621679360307"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-183"></span><span>          </span><span class="annot"><span class="annottext">NamespaceDiff Text Hash32 -&gt; Entity Text Hash32 Hash32
forall text noSyncHash hash.
NamespaceDiff text hash -&gt; Entity text noSyncHash hash
</span><a href="Unison.Sync.Types.html#ND"><span class="hs-identifier hs-var">Share.ND</span></a></span><span>
</span><span id="line-184"></span><span>            </span><span class="annot"><a href="Unison.Sync.Types.html#NamespaceDiff"><span class="hs-identifier hs-type">Share.NamespaceDiff</span></a></span><span>
</span><span id="line-185"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Hash32
$sel:parent:NamespaceDiff :: Hash32
parent :: Hash32
</span><a href="Unison.Sync.Types.html#%24sel%3Aparent%3ANamespaceDiff"><span class="hs-identifier hs-var hs-var">parent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-186"></span><span>                </span><span class="annot"><span class="annottext">$sel:textLookup:NamespaceDiff :: [Text]
</span><a href="Unison.Sync.Types.html#%24sel%3AtextLookup%3ANamespaceDiff"><span class="hs-identifier hs-var">textLookup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Text -&gt; [Text]
forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">Vector.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector Text
</span><a href="#local-6989586621679360303"><span class="hs-identifier hs-var">branchTextLookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-187"></span><span>                </span><span class="annot"><span class="annottext">$sel:defnLookup:NamespaceDiff :: [Hash32]
</span><a href="Unison.Sync.Types.html#%24sel%3AdefnLookup%3ANamespaceDiff"><span class="hs-identifier hs-var">defnLookup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Hash32 -&gt; [Hash32]
forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">Vector.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector Hash32
</span><a href="#local-6989586621679360304"><span class="hs-identifier hs-var">branchDefnLookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-188"></span><span>                </span><span class="annot"><span class="annottext">$sel:patchLookup:NamespaceDiff :: [Hash32]
</span><a href="Unison.Sync.Types.html#%24sel%3ApatchLookup%3ANamespaceDiff"><span class="hs-identifier hs-var">patchLookup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Hash32 -&gt; [Hash32]
forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">Vector.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector Hash32
</span><a href="#local-6989586621679360305"><span class="hs-identifier hs-var">branchPatchLookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-189"></span><span>                </span><span class="annot"><span class="annottext">$sel:childLookup:NamespaceDiff :: [(Hash32, Hash32)]
</span><a href="Unison.Sync.Types.html#%24sel%3AchildLookup%3ANamespaceDiff"><span class="hs-identifier hs-var">childLookup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (Hash32, Hash32) -&gt; [(Hash32, Hash32)]
forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">Vector.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector (Hash32, Hash32)
</span><a href="#local-6989586621679360306"><span class="hs-identifier hs-var">branchChildLookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-190"></span><span>                </span><span class="annot"><span class="annottext">LocalBranchBytes
$sel:bytes:NamespaceDiff :: LocalBranchBytes
bytes :: LocalBranchBytes
</span><a href="Unison.Sync.Types.html#%24sel%3Abytes%3ANamespaceDiff"><span class="hs-identifier hs-var hs-var">bytes</span></a></span><span>
</span><span id="line-191"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-192"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Entity.C</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Causal.SyncCausalFormat</span></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679360308"><span class="annot"><span class="annottext">Hash32
$sel:valueHash:SyncCausalFormat :: forall causalHash valueHash.
SyncCausalFormat' causalHash valueHash -&gt; valueHash
valueHash :: Hash32
</span><span class="hs-identifier hs-var hs-var">valueHash</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360309"><span class="annot"><span class="annottext">Vector Hash32
$sel:parents:SyncCausalFormat :: forall causalHash valueHash.
SyncCausalFormat' causalHash valueHash -&gt; Vector causalHash
parents :: Vector Hash32
</span><span class="hs-identifier hs-var hs-var">parents</span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-193"></span><span>    </span><span class="annot"><span class="annottext">Causal Hash32 -&gt; Entity Text Hash32 Hash32
forall text noSyncHash hash.
Causal hash -&gt; Entity text noSyncHash hash
</span><a href="Unison.Sync.Types.html#C"><span class="hs-identifier hs-var">Share.C</span></a></span><span>
</span><span id="line-194"></span><span>      </span><span class="annot"><a href="Unison.Sync.Types.html#Causal"><span class="hs-identifier hs-type">Share.Causal</span></a></span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:namespaceHash:Causal :: Hash32
</span><a href="Unison.Sync.Types.html#%24sel%3AnamespaceHash%3ACausal"><span class="hs-identifier hs-var">namespaceHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash32
</span><a href="#local-6989586621679360308"><span class="hs-identifier hs-var">valueHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-196"></span><span>          </span><span class="annot"><span class="annottext">$sel:parents:Causal :: Set Hash32
</span><a href="Unison.Sync.Types.html#%24sel%3Aparents%3ACausal"><span class="hs-identifier hs-var">parents</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Hash32] -&gt; Set Hash32
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Hash32 -&gt; [Hash32]
forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">Vector.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector Hash32
</span><a href="#local-6989586621679360309"><span class="hs-identifier hs-var">parents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><a href="#local-6989586621679360283"><span class="hs-identifier hs-type">mungeLocalIds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LocalIds'</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hash32</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Sync.Types.html#LocalIds"><span class="hs-identifier hs-type">Share.LocalIds</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hash32</span></span><span>
</span><span id="line-200"></span><span>    </span><span id="local-6989586621679360283"><span class="annot"><span class="annottext">mungeLocalIds :: LocalIds' Text Hash32 -&gt; LocalIds Text Hash32
</span><a href="#local-6989586621679360283"><span class="hs-identifier hs-var hs-var">mungeLocalIds</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LocalIds</span></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679360311"><span class="annot"><span class="annottext">Vector Text
$sel:textLookup:LocalIds :: forall t h. LocalIds' t h -&gt; Vector t
textLookup :: Vector Text
</span><span class="hs-identifier hs-var hs-var">textLookup</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679360312"><span class="annot"><span class="annottext">Vector Hash32
$sel:defnLookup:LocalIds :: forall t h. LocalIds' t h -&gt; Vector h
defnLookup :: Vector Hash32
</span><span class="hs-identifier hs-var hs-var">defnLookup</span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-201"></span><span>      </span><span class="annot"><a href="Unison.Sync.Types.html#LocalIds"><span class="hs-identifier hs-type">Share.LocalIds</span></a></span><span>
</span><span id="line-202"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:texts:LocalIds :: [Text]
</span><a href="Unison.Sync.Types.html#%24sel%3Atexts%3ALocalIds"><span class="hs-identifier hs-var">texts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Text -&gt; [Text]
forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">Vector.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector Text
</span><a href="#local-6989586621679360311"><span class="hs-identifier hs-var">textLookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-203"></span><span>          </span><span class="annot"><span class="annottext">$sel:hashes:LocalIds :: [Hash32]
</span><a href="Unison.Sync.Types.html#%24sel%3Ahashes%3ALocalIds"><span class="hs-identifier hs-var">hashes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Hash32 -&gt; [Hash32]
forall a. Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">Vector.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector Hash32
</span><a href="#local-6989586621679360312"><span class="hs-identifier hs-var">defnLookup</span></a></span><span>
</span><span id="line-204"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-205"></span></pre></body></html>