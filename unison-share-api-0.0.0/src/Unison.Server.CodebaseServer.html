<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Server.CodebaseServer</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">newEmptyMVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">putMVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">readMVar</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.Async</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">race</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ErrorCall</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Except</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Crypto.Random</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Crypto</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteArray.Encoding</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BE</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Strict</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unpack</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C8</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Lazy</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy.UTF8</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BLU</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.OpenApi</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Info</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">License</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">OpenApi</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">URL</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.OpenApi.Lens</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OpenApi</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Media</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(//)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(/:)</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HeaderName</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Types.Status</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ok200</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.URI.Encode</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UriEncode</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.URI.Encode</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">URI</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Middleware</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">responseLBS</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai.Handler.Warp</span></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Port</span></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><span class="hs-identifier">defaultSettings</span></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><span class="hs-identifier">runSettings</span></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><span class="hs-identifier">setBeforeMainLoop</span></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><span class="hs-identifier">setHost</span></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><span class="hs-identifier">setPort</span></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><span class="hs-identifier">withApplicationSettings</span></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai.Middleware.Cors</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">cors</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">corsMethods</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">corsOrigins</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">simpleCorsResourcePolicy</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant</span></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Handler</span></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><span class="hs-identifier">HasServer</span></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><span class="hs-identifier">MimeRender</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><span class="hs-identifier">ServerT</span></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><span class="hs-identifier">serve</span></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><span class="hs-identifier">throwError</span></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Servant</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.API</span></span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Accept</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><span class="hs-identifier">Capture</span></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="hs-identifier">CaptureAll</span></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><span class="hs-identifier">Get</span></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><span class="hs-identifier">JSON</span></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><span class="hs-identifier">Raw</span></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><span class="hs-operator">(:&gt;)</span></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span class="annot"><span class="hs-operator">(:&lt;|&gt;)</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.Docs</span></span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">DocIntro</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DocIntro</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><span class="hs-identifier">ToParam</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><span class="hs-identifier">ToSample</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><span class="hs-identifier">docsWithIntros</span></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><span class="hs-identifier">markdown</span></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><span class="hs-identifier">singleSample</span></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.Docs</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Servant</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.OpenApi</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HasOpenApi</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toOpenApi</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.Server</span></span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Application</span></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><span class="hs-identifier">Handler</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Handler</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><span class="hs-identifier">Server</span></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><span class="hs-identifier">ServerError</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><span class="hs-identifier">Tagged</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Tagged</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><span class="hs-identifier">err401</span></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><span class="hs-identifier">err404</span></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><span class="hs-identifier">hoistServer</span></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.Server.StaticFiles</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">serveDirectoryWebApp</span></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">canonicalizePath</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">doesFileExist</span></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Environment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getExecutablePath</span></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;/&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FilePath</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Branch</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Causal</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Causal</span></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.HashTags</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CausalHash</span></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Codebase</span></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Codebase</span></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Branch</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Branch</span></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Branch.Names</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Branch</span></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Path</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Path</span></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Runtime</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Rt</span></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.HashQualified</span></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.HashQualified</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HQ</span></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">segments</span></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnv.Names</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPE</span></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PrettyPrintEnvDecl</span></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnvDecl.Names</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPED</span></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Project</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ProjectAndBranch</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ProjectBranchName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ProjectName</span></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html"><span class="hs-identifier">Unison.Server.Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier">Backend</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier">BackendEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#%24sel%3ArunBackend%3ABackend"><span class="hs-identifier">runBackend</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html"><span class="hs-identifier">Unison.Server.Backend</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Backend</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Backend.DefinitionDiff.html"><span class="hs-identifier">Unison.Server.Backend.DefinitionDiff</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DefinitionDiff</span></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Errors.html"><span class="hs-identifier">Unison.Server.Errors</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Errors.html#backendError"><span class="hs-identifier">backendError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Local.Definitions.html"><span class="hs-identifier">Unison.Server.Local.Definitions</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Defn</span></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.DefinitionSummary.html"><span class="hs-identifier">Unison.Server.Local.Endpoints.DefinitionSummary</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Local.Endpoints.DefinitionSummary.html#TermSummaryAPI"><span class="hs-identifier">TermSummaryAPI</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.DefinitionSummary.html#TypeSummaryAPI"><span class="hs-identifier">TypeSummaryAPI</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.DefinitionSummary.html#serveTermSummary"><span class="hs-identifier">serveTermSummary</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.DefinitionSummary.html#serveTypeSummary"><span class="hs-identifier">serveTypeSummary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.FuzzyFind.html"><span class="hs-identifier">Unison.Server.Local.Endpoints.FuzzyFind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Local.Endpoints.FuzzyFind.html#FuzzyFindAPI"><span class="hs-identifier">FuzzyFindAPI</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.FuzzyFind.html#serveFuzzyFind"><span class="hs-identifier">serveFuzzyFind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.GetDefinitions.html"><span class="hs-identifier">Unison.Server.Local.Endpoints.GetDefinitions</span></a></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.GetDefinitions.html#DefinitionsAPI"><span class="hs-identifier">DefinitionsAPI</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><a href="Unison.Server.Local.Endpoints.GetDefinitions.html#serveDefinitions"><span class="hs-identifier">serveDefinitions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.NamespaceDetails.html"><span class="hs-identifier">Unison.Server.Local.Endpoints.NamespaceDetails</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NamespaceDetails</span></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.NamespaceListing.html"><span class="hs-identifier">Unison.Server.Local.Endpoints.NamespaceListing</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NamespaceListing</span></span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.Projects.html"><span class="hs-identifier">Unison.Server.Local.Endpoints.Projects</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Local.Endpoints.Projects.html#ListProjectBranchesEndpoint"><span class="hs-identifier">ListProjectBranchesEndpoint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.Projects.html#ListProjectsEndpoint"><span class="hs-identifier">ListProjectsEndpoint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.Projects.html#projectBranchListingEndpoint"><span class="hs-identifier">projectBranchListingEndpoint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.Projects.html#projectListingEndpoint"><span class="hs-identifier">projectListingEndpoint</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.UCM.html"><span class="hs-identifier">Unison.Server.Local.Endpoints.UCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Local.Endpoints.UCM.html#UCMAPI"><span class="hs-identifier">UCMAPI</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.UCM.html#ucmServer"><span class="hs-identifier">ucmServer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.html"><span class="hs-identifier">Unison.Server.NameSearch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.NameSearch.html#NameSearch"><span class="hs-identifier">NameSearch</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.FromNames.html"><span class="hs-identifier">Unison.Server.NameSearch.FromNames</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Names</span></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Types.html"><span class="hs-identifier">Unison.Server.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Types.html#RequiredQueryParam"><span class="hs-identifier">RequiredQueryParam</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TermDefinition"><span class="hs-identifier">TermDefinition</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TermDiffResponse"><span class="hs-identifier">TermDiffResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TypeDefinition"><span class="hs-identifier">TypeDefinition</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TypeDiffResponse"><span class="hs-identifier">TypeDiffResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#mungeString"><span class="hs-identifier">mungeString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier">setCacheControl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ShortHash</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ShortHash</span></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Sqlite</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Sqlite</span></span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.NameSegment</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Pretty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pretty</span></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-comment">-- HTML content type</span><span>
</span><span id="line-130"></span><span class="hs-keyword">data</span><span> </span><span id="HTML"><span class="annot"><a href="Unison.Server.CodebaseServer.html#HTML"><span class="hs-identifier hs-var">HTML</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HTML"><span class="annot"><a href="Unison.Server.CodebaseServer.html#HTML"><span class="hs-identifier hs-var">HTML</span></a></span></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-keyword">newtype</span><span> </span><span id="RawHtml"><span class="annot"><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-var">RawHtml</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RawHtml"><span class="annot"><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-var">RawHtml</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AunRaw%3ARawHtml"><span class="annot"><span class="annottext">RawHtml -&gt; ByteString
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AunRaw%3ARawHtml"><span class="hs-identifier hs-var hs-var">unRaw</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lazy.ByteString</span></span><span class="hs-special">}</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679355571"><span class="annot"><span class="hs-identifier hs-type">Accept</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#HTML"><span class="hs-identifier hs-type">HTML</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-135"></span><span>  </span><span id="local-6989586621679355578"><span class="annot"><span class="annottext">contentType :: Proxy HTML -&gt; MediaType
</span><a href="#local-6989586621679355578"><span class="hs-identifier hs-var hs-var hs-var hs-var">contentType</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy HTML
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;text&quot;</span></span><span> </span><span class="annot"><span class="annottext">Method -&gt; Method -&gt; MediaType
</span><span class="hs-operator hs-var">//</span></span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;html&quot;</span></span><span> </span><span class="annot"><span class="annottext">MediaType -&gt; (Method, Method) -&gt; MediaType
</span><span class="hs-operator hs-var">/:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;charset&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;utf-8&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MimeRender</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#HTML"><span class="hs-identifier hs-type">HTML</span></a></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-type">RawHtml</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-138"></span><span>  </span><span id="local-6989586621679355584"><span class="annot"><span class="annottext">mimeRender :: Proxy HTML -&gt; RawHtml -&gt; ByteString
</span><a href="#local-6989586621679355584"><span class="hs-identifier hs-var hs-var hs-var hs-var">mimeRender</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy HTML
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RawHtml -&gt; ByteString
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AunRaw%3ARawHtml"><span class="hs-identifier hs-var">unRaw</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-keyword">type</span><span> </span><span id="OpenApiJSON"><span class="annot"><a href="Unison.Server.CodebaseServer.html#OpenApiJSON"><span class="hs-identifier hs-var">OpenApiJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;openapi.json&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Get</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">JSON</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OpenApi</span></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="hs-keyword">type</span><span> </span><span id="UnisonAndDocsAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAndDocsAPI"><span class="hs-identifier hs-var">UnisonAndDocsAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonLocalAPI"><span class="hs-identifier hs-type">UnisonLocalAPI</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#OpenApiJSON"><span class="hs-identifier hs-type">OpenApiJSON</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Raw</span></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="hs-keyword">type</span><span> </span><span id="UnisonLocalAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonLocalAPI"><span class="hs-identifier hs-var">UnisonLocalAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;projects&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ProjectsAPI"><span class="hs-identifier hs-type">ProjectsAPI</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;ucm&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.UCM.html#UCMAPI"><span class="hs-identifier hs-type">UCMAPI</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-keyword">type</span><span> </span><span id="CodebaseServerAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#CodebaseServerAPI"><span class="hs-identifier hs-var">CodebaseServerAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-149"></span><span>  </span><span class="annot"><a href="Unison.Server.Local.Endpoints.NamespaceListing.html#NamespaceListingAPI"><span class="hs-identifier hs-type">NamespaceListing.NamespaceListingAPI</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.NamespaceDetails.html#NamespaceDetailsAPI"><span class="hs-identifier hs-type">NamespaceDetails.NamespaceDetailsAPI</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.GetDefinitions.html#DefinitionsAPI"><span class="hs-identifier hs-type">DefinitionsAPI</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.FuzzyFind.html#FuzzyFindAPI"><span class="hs-identifier hs-type">FuzzyFindAPI</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.DefinitionSummary.html#TermSummaryAPI"><span class="hs-identifier hs-type">TermSummaryAPI</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.DefinitionSummary.html#TypeSummaryAPI"><span class="hs-identifier hs-type">TypeSummaryAPI</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-keyword">type</span><span> </span><span id="ProjectsAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#ProjectsAPI"><span class="hs-identifier hs-var">ProjectsAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><a href="Unison.Server.Local.Endpoints.Projects.html#ListProjectsEndpoint"><span class="hs-identifier hs-type">ListProjectsEndpoint</span></a></span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Capture</span></span><span> </span><span class="annot"><span class="hs-string">&quot;project-name&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectName</span></span><span>
</span><span id="line-159"></span><span>             </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-string">&quot;branches&quot;</span></span><span>
</span><span id="line-160"></span><span>                      </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Server.Local.Endpoints.Projects.html#ListProjectBranchesEndpoint"><span class="hs-identifier hs-type">ListProjectBranchesEndpoint</span></a></span><span>
</span><span id="line-161"></span><span>                             </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Capture</span></span><span> </span><span class="annot"><span class="hs-string">&quot;branch-name&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchName</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#CodebaseServerAPI"><span class="hs-identifier hs-type">CodebaseServerAPI</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>                         </span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>                    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-string">&quot;diff&quot;</span></span><span>
</span><span id="line-165"></span><span>                             </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-string">&quot;terms&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ProjectDiffTermsEndpoint"><span class="hs-identifier hs-type">ProjectDiffTermsEndpoint</span></a></span><span>
</span><span id="line-166"></span><span>                                    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;types&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ProjectDiffTypesEndpoint"><span class="hs-identifier hs-type">ProjectDiffTypesEndpoint</span></a></span><span>
</span><span id="line-167"></span><span>                                </span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>                         </span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>         </span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="hs-keyword">type</span><span> </span><span id="ProjectDiffTermsEndpoint"><span class="annot"><a href="Unison.Server.CodebaseServer.html#ProjectDiffTermsEndpoint"><span class="hs-identifier hs-var">ProjectDiffTermsEndpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-173"></span><span>  </span><span class="annot"><a href="Unison.Server.Types.html#RequiredQueryParam"><span class="hs-identifier hs-type">RequiredQueryParam</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;oldBranchRef&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchName</span></span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#RequiredQueryParam"><span class="hs-identifier hs-type">RequiredQueryParam</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;newBranchRef&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchName</span></span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#RequiredQueryParam"><span class="hs-identifier hs-type">RequiredQueryParam</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;oldTerm&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-176"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#RequiredQueryParam"><span class="hs-identifier hs-type">RequiredQueryParam</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;newTerm&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-177"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Get</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">JSON</span></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TermDiffResponse"><span class="hs-identifier hs-type">TermDiffResponse</span></a></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="hs-keyword">type</span><span> </span><span id="ProjectDiffTypesEndpoint"><span class="annot"><a href="Unison.Server.CodebaseServer.html#ProjectDiffTypesEndpoint"><span class="hs-identifier hs-var">ProjectDiffTypesEndpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-180"></span><span>  </span><span class="annot"><a href="Unison.Server.Types.html#RequiredQueryParam"><span class="hs-identifier hs-type">RequiredQueryParam</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;oldBranchRef&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchName</span></span><span>
</span><span id="line-181"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#RequiredQueryParam"><span class="hs-identifier hs-type">RequiredQueryParam</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;newBranchRef&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchName</span></span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#RequiredQueryParam"><span class="hs-identifier hs-type">RequiredQueryParam</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;oldType&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#RequiredQueryParam"><span class="hs-identifier hs-type">RequiredQueryParam</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;newType&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-184"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Get</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">JSON</span></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TypeDiffResponse"><span class="hs-identifier hs-type">TypeDiffResponse</span></a></span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679354402"><span id="local-6989586621679354403"><span class="annot"><span class="hs-identifier hs-type">ToParam</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Servant.QueryParam'</span></span><span> </span><span class="annot"><a href="#local-6989586621679354402"><span class="hs-identifier hs-type">mods</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;oldBranchRef&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679354403"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-187"></span><span>  </span><span id="local-6989586621679355589"><span class="annot"><span class="annottext">toParam :: Proxy (QueryParam' mods &quot;oldBranchRef&quot; a) -&gt; DocQueryParam
</span><a href="#local-6989586621679355589"><span class="hs-identifier hs-var hs-var hs-var hs-var">toParam</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy (QueryParam' mods &quot;oldBranchRef&quot; a)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String -&gt; ParamKind -&gt; DocQueryParam
</span><span class="hs-identifier hs-var">Servant.DocQueryParam</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;oldBranchRef&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;main&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The name of the old branch&quot;</span></span><span> </span><span class="annot"><span class="annottext">ParamKind
</span><span class="hs-identifier hs-var">Servant.Normal</span></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679354400"><span id="local-6989586621679354401"><span class="annot"><span class="hs-identifier hs-type">ToParam</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Servant.QueryParam'</span></span><span> </span><span class="annot"><a href="#local-6989586621679354400"><span class="hs-identifier hs-type">mods</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;newBranchRef&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679354401"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-190"></span><span>  </span><span id="local-6989586621679355594"><span class="annot"><span class="annottext">toParam :: Proxy (QueryParam' mods &quot;newBranchRef&quot; a) -&gt; DocQueryParam
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toParam</span></span></span><span> </span><span class="annot"><span class="annottext">Proxy (QueryParam' mods &quot;newBranchRef&quot; a)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String -&gt; ParamKind -&gt; DocQueryParam
</span><span class="hs-identifier hs-var">Servant.DocQueryParam</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;newBranchRef&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;main&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The name of the new branch&quot;</span></span><span> </span><span class="annot"><span class="annottext">ParamKind
</span><span class="hs-identifier hs-var">Servant.Normal</span></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679354398"><span id="local-6989586621679354399"><span class="annot"><span class="hs-identifier hs-type">ToParam</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Servant.QueryParam'</span></span><span> </span><span class="annot"><a href="#local-6989586621679354398"><span class="hs-identifier hs-type">mods</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;oldTerm&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679354399"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-193"></span><span>  </span><span id="local-6989586621679355596"><span class="annot"><span class="annottext">toParam :: Proxy (QueryParam' mods &quot;oldTerm&quot; a) -&gt; DocQueryParam
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toParam</span></span></span><span> </span><span class="annot"><span class="annottext">Proxy (QueryParam' mods &quot;oldTerm&quot; a)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String -&gt; ParamKind -&gt; DocQueryParam
</span><span class="hs-identifier hs-var">Servant.DocQueryParam</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;oldTerm&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;main&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The name of the old term&quot;</span></span><span> </span><span class="annot"><span class="annottext">ParamKind
</span><span class="hs-identifier hs-var">Servant.Normal</span></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679354396"><span id="local-6989586621679354397"><span class="annot"><span class="hs-identifier hs-type">ToParam</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Servant.QueryParam'</span></span><span> </span><span class="annot"><a href="#local-6989586621679354396"><span class="hs-identifier hs-type">mods</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;newTerm&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679354397"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-196"></span><span>  </span><span id="local-6989586621679355598"><span class="annot"><span class="annottext">toParam :: Proxy (QueryParam' mods &quot;newTerm&quot; a) -&gt; DocQueryParam
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toParam</span></span></span><span> </span><span class="annot"><span class="annottext">Proxy (QueryParam' mods &quot;newTerm&quot; a)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String -&gt; ParamKind -&gt; DocQueryParam
</span><span class="hs-identifier hs-var">Servant.DocQueryParam</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;newTerm&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;main&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The name of the new term&quot;</span></span><span> </span><span class="annot"><span class="annottext">ParamKind
</span><span class="hs-identifier hs-var">Servant.Normal</span></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679354394"><span id="local-6989586621679354395"><span class="annot"><span class="hs-identifier hs-type">ToParam</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Servant.QueryParam'</span></span><span> </span><span class="annot"><a href="#local-6989586621679354394"><span class="hs-identifier hs-type">mods</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;oldType&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679354395"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-199"></span><span>  </span><span id="local-6989586621679355600"><span class="annot"><span class="annottext">toParam :: Proxy (QueryParam' mods &quot;oldType&quot; a) -&gt; DocQueryParam
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toParam</span></span></span><span> </span><span class="annot"><span class="annottext">Proxy (QueryParam' mods &quot;oldType&quot; a)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String -&gt; ParamKind -&gt; DocQueryParam
</span><span class="hs-identifier hs-var">Servant.DocQueryParam</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;oldType&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;main&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The name of the old type&quot;</span></span><span> </span><span class="annot"><span class="annottext">ParamKind
</span><span class="hs-identifier hs-var">Servant.Normal</span></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679354392"><span id="local-6989586621679354393"><span class="annot"><span class="hs-identifier hs-type">ToParam</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Servant.QueryParam'</span></span><span> </span><span class="annot"><a href="#local-6989586621679354392"><span class="hs-identifier hs-type">mods</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;newType&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679354393"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-202"></span><span>  </span><span id="local-6989586621679355602"><span class="annot"><span class="annottext">toParam :: Proxy (QueryParam' mods &quot;newType&quot; a) -&gt; DocQueryParam
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toParam</span></span></span><span> </span><span class="annot"><span class="annottext">Proxy (QueryParam' mods &quot;newType&quot; a)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String -&gt; ParamKind -&gt; DocQueryParam
</span><span class="hs-identifier hs-var">Servant.DocQueryParam</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;newType&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;main&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The name of the new type&quot;</span></span><span> </span><span class="annot"><span class="annottext">ParamKind
</span><span class="hs-identifier hs-var">Servant.Normal</span></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="hs-keyword">type</span><span> </span><span id="WebUI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#WebUI"><span class="hs-identifier hs-var">WebUI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CaptureAll</span></span><span> </span><span class="annot"><span class="hs-string">&quot;route&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Get</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#HTML"><span class="hs-identifier hs-type">HTML</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-type">RawHtml</span></a></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="hs-keyword">type</span><span> </span><span id="ServerAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#ServerAPI"><span class="hs-identifier hs-var">ServerAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;ui&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#WebUI"><span class="hs-identifier hs-type">WebUI</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;api&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAndDocsAPI"><span class="hs-identifier hs-type">UnisonAndDocsAPI</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-keyword">type</span><span> </span><span id="StaticAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#StaticAPI"><span class="hs-identifier hs-var">StaticAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;static&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Raw</span></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="hs-keyword">type</span><span> </span><span id="Authed"><span class="annot"><a href="Unison.Server.CodebaseServer.html#Authed"><span class="hs-identifier hs-var">Authed</span></a></span></span><span> </span><span id="local-6989586621679355604"><span class="annot"><a href="#local-6989586621679355604"><span class="hs-identifier hs-type">api</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Capture</span></span><span> </span><span class="annot"><span class="hs-string">&quot;token&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621679355604"><span class="hs-identifier hs-type">api</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-keyword">type</span><span> </span><span id="AppAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#AppAPI"><span class="hs-identifier hs-var">AppAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#StaticAPI"><span class="hs-identifier hs-type">StaticAPI</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#Authed"><span class="hs-identifier hs-type">Authed</span></a></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ServerAPI"><span class="hs-identifier hs-type">ServerAPI</span></a></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToSample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-215"></span><span>  </span><span id="local-6989586621679355607"><span class="annot"><span class="annottext">toSamples :: Proxy Char -&gt; [(Text, Char)]
</span><a href="#local-6989586621679355607"><span class="hs-identifier hs-var hs-var hs-var hs-var">toSamples</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy Char
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; [(Text, Char)]
forall a. a -&gt; [(Text, a)]
</span><span class="hs-identifier hs-var">singleSample</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'x'</span></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-comment">-- BaseUrl and helpers</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-keyword">data</span><span> </span><span id="BaseUrl"><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-var">BaseUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BaseUrl"><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-var">BaseUrl</span></a></span></span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AurlHost%3ABaseUrl"><span class="annot"><span class="annottext">BaseUrl -&gt; String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AurlHost%3ABaseUrl"><span class="hs-identifier hs-var hs-var">urlHost</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span>
</span><span id="line-221"></span><span>    </span><span id="%24sel%3AurlToken%3ABaseUrl"><span class="annot"><span class="annottext">BaseUrl -&gt; Method
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AurlToken%3ABaseUrl"><span class="hs-identifier hs-var hs-var">urlToken</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Strict.ByteString</span></span><span class="hs-special">,</span><span>
</span><span id="line-222"></span><span>    </span><span id="%24sel%3AurlPort%3ABaseUrl"><span class="annot"><span class="annottext">BaseUrl -&gt; Int
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AurlPort%3ABaseUrl"><span class="hs-identifier hs-var hs-var">urlPort</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Port</span></span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="hs-keyword">data</span><span> </span><span id="DefinitionReference"><span class="annot"><a href="Unison.Server.CodebaseServer.html#DefinitionReference"><span class="hs-identifier hs-var">DefinitionReference</span></a></span></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TermReference"><span class="annot"><a href="Unison.Server.CodebaseServer.html#TermReference"><span class="hs-identifier hs-var">TermReference</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- /terms/...</span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TypeReference"><span class="annot"><a href="Unison.Server.CodebaseServer.html#TypeReference"><span class="hs-identifier hs-var">TypeReference</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- /types/...</span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="AbilityConstructorReference"><span class="annot"><a href="Unison.Server.CodebaseServer.html#AbilityConstructorReference"><span class="hs-identifier hs-var">AbilityConstructorReference</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- /ability-constructors/...</span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="DataConstructorReference"><span class="annot"><a href="Unison.Server.CodebaseServer.html#DataConstructorReference"><span class="hs-identifier hs-var">DataConstructorReference</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- /data-constructors/...</span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679355619"><span id="local-6989586621679355632"><span id="local-6989586621679355636"><span class="annot"><span class="annottext">Int -&gt; DefinitionReference -&gt; ShowS
[DefinitionReference] -&gt; ShowS
DefinitionReference -&gt; String
(Int -&gt; DefinitionReference -&gt; ShowS)
-&gt; (DefinitionReference -&gt; String)
-&gt; ([DefinitionReference] -&gt; ShowS)
-&gt; Show DefinitionReference
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; DefinitionReference -&gt; ShowS
showsPrec :: Int -&gt; DefinitionReference -&gt; ShowS
$cshow :: DefinitionReference -&gt; String
show :: DefinitionReference -&gt; String
$cshowList :: [DefinitionReference] -&gt; ShowS
showList :: [DefinitionReference] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="hs-keyword">data</span><span> </span><span id="Service"><span class="annot"><a href="Unison.Server.CodebaseServer.html#Service"><span class="hs-identifier hs-var">Service</span></a></span></span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- (Project branch names, perspective within project, definition reference)</span><span>
</span><span id="line-234"></span><span>    </span><span id="ProjectBranchUI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#ProjectBranchUI"><span class="hs-identifier hs-var">ProjectBranchUI</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ProjectAndBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectName</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchName</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#DefinitionReference"><span class="hs-identifier hs-type">DefinitionReference</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Api"><span class="annot"><a href="Unison.Server.CodebaseServer.html#Api"><span class="hs-identifier hs-var">Api</span></a></span></span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679355643"><span id="local-6989586621679355655"><span id="local-6989586621679355659"><span class="annot"><span class="annottext">Int -&gt; Service -&gt; ShowS
[Service] -&gt; ShowS
Service -&gt; String
(Int -&gt; Service -&gt; ShowS)
-&gt; (Service -&gt; String) -&gt; ([Service] -&gt; ShowS) -&gt; Show Service
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Service -&gt; ShowS
showsPrec :: Int -&gt; Service -&gt; ShowS
$cshow :: Service -&gt; String
show :: Service -&gt; String
$cshowList :: [Service] -&gt; ShowS
showList :: [Service] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679355664"><span id="local-6989586621679355668"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-type">BaseUrl</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-239"></span><span>  </span><span id="local-6989586621679355680"><span class="annot"><span class="annottext">show :: BaseUrl -&gt; String
</span><a href="#local-6989586621679355680"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span id="local-6989586621679355682"><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679355682"><span class="hs-identifier hs-var">url</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AurlHost%3ABaseUrl"><span class="hs-identifier hs-var">urlHost</span></a></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679355682"><span class="hs-identifier hs-var">url</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BaseUrl -&gt; Int
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AurlPort%3ABaseUrl"><span class="hs-identifier hs-var">urlPort</span></a></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679355682"><span class="hs-identifier hs-var">url</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">URI.encode</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; (BaseUrl -&gt; String) -&gt; BaseUrl -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Method -&gt; String
</span><span class="hs-identifier hs-var">unpack</span></span><span> </span><span class="annot"><span class="annottext">(Method -&gt; String) -&gt; (BaseUrl -&gt; Method) -&gt; BaseUrl -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; Method
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AurlToken%3ABaseUrl"><span class="hs-identifier hs-var">urlToken</span></a></span><span> </span><span class="annot"><span class="annottext">(BaseUrl -&gt; String) -&gt; BaseUrl -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679355682"><span class="hs-identifier hs-var">url</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="hs-keyword">data</span><span> </span><span id="URISegment"><span class="annot"><a href="Unison.Server.CodebaseServer.html#URISegment"><span class="hs-identifier hs-var">URISegment</span></a></span></span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="EscapeMe"><span class="annot"><a href="Unison.Server.CodebaseServer.html#EscapeMe"><span class="hs-identifier hs-var">EscapeMe</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="DontEscape"><span class="annot"><a href="Unison.Server.CodebaseServer.html#DontEscape"><span class="hs-identifier hs-var">DontEscape</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679355688"><span id="local-6989586621679355695"><span id="local-6989586621679355699"><span class="annot"><span class="annottext">Int -&gt; URISegment -&gt; ShowS
[URISegment] -&gt; ShowS
URISegment -&gt; String
(Int -&gt; URISegment -&gt; ShowS)
-&gt; (URISegment -&gt; String)
-&gt; ([URISegment] -&gt; ShowS)
-&gt; Show URISegment
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; URISegment -&gt; ShowS
showsPrec :: Int -&gt; URISegment -&gt; ShowS
$cshow :: URISegment -&gt; String
show :: URISegment -&gt; String
$cshowList :: [URISegment] -&gt; ShowS
showList :: [URISegment] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span class="hs-comment">-- | Create a Service URL, either for the UI or the API</span><span>
</span><span id="line-247"></span><span class="hs-comment">--</span><span>
</span><span id="line-248"></span><span class="hs-comment">-- Examples:</span><span>
</span><span id="line-249"></span><span class="hs-comment">--</span><span>
</span><span id="line-250"></span><span class="hs-comment">-- &gt;&gt;&gt; urlFor Api (BaseUrl{ urlHost = &quot;http://localhost&quot;, urlToken = &quot;asdf&quot;, urlPort = 1234 })</span><span>
</span><span id="line-251"></span><span class="hs-comment">-- &quot;http://localhost:1234/asdf/api&quot;</span><span>
</span><span id="line-252"></span><span class="hs-comment">--</span><span>
</span><span id="line-253"></span><span class="hs-comment">-- Loose code with definition but no perspective</span><span>
</span><span id="line-254"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Unison.Syntax.Name as Name</span><span>
</span><span id="line-255"></span><span class="hs-comment">-- &gt;&gt;&gt; let service = LooseCodeUI (Path.absoluteEmpty) (Just (TermReference (NameOnly (Name.unsafeFromText &quot;base.data.List.map&quot;))))</span><span>
</span><span id="line-256"></span><span class="hs-comment">-- &gt;&gt;&gt; let baseUrl = (BaseUrl{ urlHost = &quot;http://localhost&quot;, urlToken = &quot;asdf&quot;, urlPort = 1234 })</span><span>
</span><span id="line-257"></span><span class="hs-comment">-- &gt;&gt;&gt; urlFor service baseUrl</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- &quot;http://localhost:1234/asdf/ui/non-project-code/latest/terms/base/data/List/map&quot;</span><span>
</span><span id="line-259"></span><span class="hs-comment">--</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- Loose code with definition and perspective</span><span>
</span><span id="line-261"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Unison.Syntax.Name as Name</span><span>
</span><span id="line-262"></span><span class="hs-comment">-- &gt;&gt;&gt; let service = LooseCodeUI (Path.Absolute (Path.fromText &quot;base.data&quot;)) (Just (TermReference (NameOnly (Name.unsafeFromText &quot;List.map&quot;))))</span><span>
</span><span id="line-263"></span><span class="hs-comment">-- &gt;&gt;&gt; let baseUrl = (BaseUrl{ urlHost = &quot;http://localhost&quot;, urlToken = &quot;asdf&quot;, urlPort = 1234 })</span><span>
</span><span id="line-264"></span><span class="hs-comment">-- &gt;&gt;&gt; urlFor service baseUrl</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- &quot;http://localhost:1234/asdf/ui/non-project-code/latest/namespaces/base/data/;/terms/List/map&quot;</span><span>
</span><span id="line-266"></span><span class="hs-comment">--</span><span>
</span><span id="line-267"></span><span class="hs-comment">-- Project with definition but no perspective</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Unison.Syntax.Name as Name</span><span>
</span><span id="line-269"></span><span class="hs-comment">-- &gt;&gt;&gt; import Unison.Core.Project (ProjectName (..), ProjectBranchName (..), ProjectAndBranch (..))</span><span>
</span><span id="line-270"></span><span class="hs-comment">-- &gt;&gt;&gt; let service = ProjectBranchUI (ProjectAndBranch (UnsafeProjectName &quot;base&quot;) (UnsafeProjectBranchName &quot;main&quot;)) (Path.empty) (Just (TermReference (NameOnly (Name.unsafeFromText &quot;List.map&quot;))))</span><span>
</span><span id="line-271"></span><span class="hs-comment">-- &gt;&gt;&gt; let baseUrl = (BaseUrl{ urlHost = &quot;http://localhost&quot;, urlToken = &quot;asdf&quot;, urlPort = 1234 })</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- &gt;&gt;&gt; urlFor service baseUrl</span><span>
</span><span id="line-273"></span><span class="hs-comment">-- &quot;http://localhost:1234/asdf/ui/projects/base/main/latest/terms/List/map&quot;</span><span>
</span><span id="line-274"></span><span class="hs-comment">--</span><span>
</span><span id="line-275"></span><span class="hs-comment">-- Project with definition but no perspective, contributor branch</span><span>
</span><span id="line-276"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Unison.Syntax.Name as Name</span><span>
</span><span id="line-277"></span><span class="hs-comment">-- &gt;&gt;&gt; import Unison.Core.Project (ProjectName (..), ProjectBranchName (..), ProjectAndBranch (..))</span><span>
</span><span id="line-278"></span><span class="hs-comment">-- &gt;&gt;&gt; let service = ProjectBranchUI (ProjectAndBranch (UnsafeProjectName &quot;@unison/base&quot;) (UnsafeProjectBranchName &quot;@runarorama/contribution&quot;)) (Path.empty) (Just (TermReference (NameOnly (Name.unsafeFromText &quot;List.map&quot;))))</span><span>
</span><span id="line-279"></span><span class="hs-comment">-- &gt;&gt;&gt; let baseUrl = (BaseUrl{ urlHost = &quot;http://localhost&quot;, urlToken = &quot;asdf&quot;, urlPort = 1234 })</span><span>
</span><span id="line-280"></span><span class="hs-comment">-- &gt;&gt;&gt; urlFor service baseUrl</span><span>
</span><span id="line-281"></span><span class="hs-comment">-- &quot;http://localhost:1234/asdf/ui/projects/@unison/base/@runarorama/contribution/latest/terms/List/map&quot;</span><span>
</span><span id="line-282"></span><span class="hs-comment">--</span><span>
</span><span id="line-283"></span><span class="hs-comment">-- Project with definition and perspective</span><span>
</span><span id="line-284"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Unison.Syntax.Name as Name</span><span>
</span><span id="line-285"></span><span class="hs-comment">-- &gt;&gt;&gt; import Unison.Core.Project (ProjectName (..), ProjectBranchName (..), ProjectAndBranch (..))</span><span>
</span><span id="line-286"></span><span class="hs-comment">-- &gt;&gt;&gt; let service = ProjectBranchUI (ProjectAndBranch (UnsafeProjectName &quot;@unison/base&quot;) (UnsafeProjectBranchName &quot;@runarorama/contribution&quot;)) (Path.fromList [&quot;data&quot;]) (Just (TermReference (NameOnly (Name.unsafeFromText &quot;List.map&quot;))))</span><span>
</span><span id="line-287"></span><span class="hs-comment">-- &gt;&gt;&gt; let baseUrl = (BaseUrl{ urlHost = &quot;http://localhost&quot;, urlToken = &quot;asdf&quot;, urlPort = 1234 })</span><span>
</span><span id="line-288"></span><span class="hs-comment">-- &gt;&gt;&gt; urlFor service baseUrl</span><span>
</span><span id="line-289"></span><span class="hs-comment">-- &quot;http://localhost:1234/asdf/ui/projects/@unison/base/@runarorama/contribution/latest/namespaces/data/;/terms/List/map&quot;</span><span>
</span><span id="line-290"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#urlFor"><span class="hs-identifier hs-type">urlFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#Service"><span class="hs-identifier hs-type">Service</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-type">BaseUrl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-291"></span><span id="urlFor"><span class="annot"><span class="annottext">urlFor :: Service -&gt; BaseUrl -&gt; Text
</span><a href="Unison.Server.CodebaseServer.html#urlFor"><span class="hs-identifier hs-var hs-var">urlFor</span></a></span></span><span> </span><span id="local-6989586621679355702"><span class="annot"><span class="annottext">Service
</span><a href="#local-6989586621679355702"><span class="hs-identifier hs-var">service</span></a></span></span><span> </span><span id="local-6989586621679355703"><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679355703"><span class="hs-identifier hs-var">baseUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Service
</span><a href="#local-6989586621679355702"><span class="hs-identifier hs-var">service</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-293"></span><span>    </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ProjectBranchUI"><span class="hs-identifier hs-type">ProjectBranchUI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ProjectAndBranch</span></span><span> </span><span id="local-6989586621679355705"><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679355705"><span class="hs-identifier hs-var">projectName</span></a></span></span><span> </span><span id="local-6989586621679355706"><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621679355706"><span class="hs-identifier hs-var">branchName</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679355707"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679355707"><span class="hs-identifier hs-var">perspective</span></a></span></span><span> </span><span id="local-6989586621679355708"><span class="annot"><span class="annottext">Maybe DefinitionReference
</span><a href="#local-6989586621679355708"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-294"></span><span>      </span><span class="annot"><span class="annottext">BaseUrl -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">tShow</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679355703"><span class="hs-identifier hs-var">baseUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[URISegment] -&gt; Text
</span><a href="#local-6989586621679355710"><span class="hs-identifier hs-var">toUrlPath</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; URISegment
</span><a href="Unison.Server.CodebaseServer.html#DontEscape"><span class="hs-identifier hs-var">DontEscape</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ui&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; URISegment
</span><a href="Unison.Server.CodebaseServer.html#DontEscape"><span class="hs-identifier hs-var">DontEscape</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;projects&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; URISegment
</span><a href="Unison.Server.CodebaseServer.html#DontEscape"><span class="hs-identifier hs-var">DontEscape</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; URISegment) -&gt; Text -&gt; URISegment
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall target source. From source target =&gt; source -&gt; target
</span><span class="hs-identifier hs-var">into</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679355705"><span class="hs-identifier hs-var">projectName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; URISegment
</span><a href="Unison.Server.CodebaseServer.html#DontEscape"><span class="hs-identifier hs-var">DontEscape</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; URISegment) -&gt; Text -&gt; URISegment
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall target source. From source target =&gt; source -&gt; target
</span><span class="hs-identifier hs-var">into</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621679355706"><span class="hs-identifier hs-var">branchName</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[URISegment] -&gt; [URISegment] -&gt; [URISegment]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Maybe DefinitionReference -&gt; [URISegment]
</span><a href="#local-6989586621679355712"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679355707"><span class="hs-identifier hs-var">perspective</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DefinitionReference
</span><a href="#local-6989586621679355708"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>    </span><span class="annot"><span class="annottext">Service
</span><a href="Unison.Server.CodebaseServer.html#Api"><span class="hs-identifier hs-var">Api</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">tShow</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679355703"><span class="hs-identifier hs-var">baseUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[URISegment] -&gt; Text
</span><a href="#local-6989586621679355710"><span class="hs-identifier hs-var">toUrlPath</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; URISegment
</span><a href="Unison.Server.CodebaseServer.html#DontEscape"><span class="hs-identifier hs-var">DontEscape</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;api&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-297"></span><span>    </span><span class="annot"><a href="#local-6989586621679355712"><span class="hs-identifier hs-type">path</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#DefinitionReference"><span class="hs-identifier hs-type">DefinitionReference</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#URISegment"><span class="hs-identifier hs-type">URISegment</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-298"></span><span>    </span><span id="local-6989586621679355712"><span class="annot"><span class="annottext">path :: Absolute -&gt; Maybe DefinitionReference -&gt; [URISegment]
</span><a href="#local-6989586621679355712"><span class="hs-identifier hs-var hs-var">path</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span id="local-6989586621679355714"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679355714"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679355715"><span class="annot"><span class="annottext">Maybe DefinitionReference
</span><a href="#local-6989586621679355715"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-299"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679355716"><span class="annot"><span class="annottext">nsPath :: [URISegment]
</span><a href="#local-6989586621679355716"><span class="hs-identifier hs-var hs-var">nsPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path -&gt; [URISegment]
</span><a href="#local-6989586621679355717"><span class="hs-identifier hs-var">namespacePath</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679355714"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-300"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe DefinitionReference -&gt; Maybe [URISegment]
</span><a href="#local-6989586621679355718"><span class="hs-identifier hs-var">definitionPath</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DefinitionReference
</span><a href="#local-6989586621679355715"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-301"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679355719"><span class="annot"><span class="annottext">[URISegment]
</span><a href="#local-6989586621679355719"><span class="hs-identifier hs-var">defPath</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[URISegment]
</span><a href="#local-6989586621679355716"><span class="hs-identifier hs-var">nsPath</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-302"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; URISegment
</span><a href="Unison.Server.CodebaseServer.html#DontEscape"><span class="hs-identifier hs-var">DontEscape</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;latest&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[URISegment] -&gt; [URISegment] -&gt; [URISegment]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[URISegment]
</span><a href="#local-6989586621679355719"><span class="hs-identifier hs-var">defPath</span></a></span><span>
</span><span id="line-303"></span><span>              </span><span class="annot"><span class="annottext">[URISegment]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; URISegment
</span><a href="Unison.Server.CodebaseServer.html#DontEscape"><span class="hs-identifier hs-var">DontEscape</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;latest&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[URISegment] -&gt; [URISegment] -&gt; [URISegment]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[URISegment]
</span><a href="#local-6989586621679355716"><span class="hs-identifier hs-var">nsPath</span></a></span><span> </span><span class="annot"><span class="annottext">[URISegment] -&gt; [URISegment] -&gt; [URISegment]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; URISegment
</span><a href="Unison.Server.CodebaseServer.html#DontEscape"><span class="hs-identifier hs-var">DontEscape</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;;&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[URISegment] -&gt; [URISegment] -&gt; [URISegment]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[URISegment]
</span><a href="#local-6989586621679355719"><span class="hs-identifier hs-var">defPath</span></a></span><span>
</span><span id="line-304"></span><span>            </span><span class="annot"><span class="annottext">Maybe [URISegment]
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; URISegment
</span><a href="Unison.Server.CodebaseServer.html#DontEscape"><span class="hs-identifier hs-var">DontEscape</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;latest&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[URISegment] -&gt; [URISegment] -&gt; [URISegment]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[URISegment]
</span><a href="#local-6989586621679355716"><span class="hs-identifier hs-var">nsPath</span></a></span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span>    </span><span class="annot"><a href="#local-6989586621679355717"><span class="hs-identifier hs-type">namespacePath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Path</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#URISegment"><span class="hs-identifier hs-type">URISegment</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-307"></span><span>    </span><span id="local-6989586621679355717"><span class="annot"><span class="annottext">namespacePath :: Path -&gt; [URISegment]
</span><a href="#local-6989586621679355717"><span class="hs-identifier hs-var hs-var">namespacePath</span></a></span></span><span> </span><span id="local-6989586621679355720"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679355720"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-308"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679355720"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Path -&gt; Path -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><span class="hs-identifier hs-var">Path.empty</span></span><span>
</span><span id="line-309"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-310"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; URISegment
</span><a href="Unison.Server.CodebaseServer.html#DontEscape"><span class="hs-identifier hs-var">DontEscape</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;namespaces&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[URISegment] -&gt; [URISegment] -&gt; [URISegment]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; URISegment
</span><a href="Unison.Server.CodebaseServer.html#EscapeMe"><span class="hs-identifier hs-var">EscapeMe</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; URISegment)
-&gt; (NameSegment -&gt; Text) -&gt; NameSegment -&gt; URISegment
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Text
</span><span class="hs-identifier hs-var">NameSegment.toEscapedText</span></span><span> </span><span class="annot"><span class="annottext">(NameSegment -&gt; URISegment) -&gt; [NameSegment] -&gt; [URISegment]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Path -&gt; [NameSegment]
</span><span class="hs-identifier hs-var">Path.toList</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679355720"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>    </span><span class="annot"><a href="#local-6989586621679355718"><span class="hs-identifier hs-type">definitionPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#DefinitionReference"><span class="hs-identifier hs-type">DefinitionReference</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#URISegment"><span class="hs-identifier hs-type">URISegment</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-313"></span><span>    </span><span id="local-6989586621679355718"><span class="annot"><span class="annottext">definitionPath :: Maybe DefinitionReference -&gt; Maybe [URISegment]
</span><a href="#local-6989586621679355718"><span class="hs-identifier hs-var hs-var">definitionPath</span></a></span></span><span> </span><span id="local-6989586621679355725"><span class="annot"><span class="annottext">Maybe DefinitionReference
</span><a href="#local-6989586621679355725"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-314"></span><span>      </span><span class="annot"><span class="annottext">DefinitionReference -&gt; [URISegment]
</span><a href="#local-6989586621679355726"><span class="hs-identifier hs-var">toDefinitionPath</span></a></span><span> </span><span class="annot"><span class="annottext">(DefinitionReference -&gt; [URISegment])
-&gt; Maybe DefinitionReference -&gt; Maybe [URISegment]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe DefinitionReference
</span><a href="#local-6989586621679355725"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span>    </span><span class="annot"><a href="#local-6989586621679355710"><span class="hs-identifier hs-type">toUrlPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#URISegment"><span class="hs-identifier hs-type">URISegment</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-317"></span><span>    </span><span id="local-6989586621679355710"><span class="annot"><span class="annottext">toUrlPath :: [URISegment] -&gt; Text
</span><a href="#local-6989586621679355710"><span class="hs-identifier hs-var hs-var">toUrlPath</span></a></span></span><span> </span><span id="local-6989586621679355727"><span class="annot"><span class="annottext">[URISegment]
</span><a href="#local-6989586621679355727"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-318"></span><span>      </span><span class="annot"><span class="annottext">[URISegment]
</span><a href="#local-6989586621679355727"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-319"></span><span>        </span><span class="annot"><span class="annottext">[URISegment] -&gt; ([URISegment] -&gt; [Text]) -&gt; [Text]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(URISegment -&gt; Text) -&gt; [URISegment] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-320"></span><span>          </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#EscapeMe"><span class="hs-identifier hs-type">EscapeMe</span></a></span><span> </span><span id="local-6989586621679355729"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679355729"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">UriEncode.encodeText</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679355729"><span class="hs-identifier hs-var">txt</span></a></span><span>
</span><span id="line-321"></span><span>          </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#DontEscape"><span class="hs-identifier hs-type">DontEscape</span></a></span><span> </span><span id="local-6989586621679355731"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679355731"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679355731"><span class="hs-identifier hs-var">txt</span></a></span><span>
</span><span id="line-322"></span><span>        </span><span class="annot"><span class="annottext">[Text] -&gt; ([Text] -&gt; Text) -&gt; Text
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">Text.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/&quot;</span></span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span>    </span><span class="annot"><a href="#local-6989586621679355733"><span class="hs-identifier hs-type">refToUrlText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#URISegment"><span class="hs-identifier hs-type">URISegment</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-325"></span><span>    </span><span id="local-6989586621679355733"><span class="annot"><span class="annottext">refToUrlText :: HashQualified Name -&gt; [URISegment]
</span><a href="#local-6989586621679355733"><span class="hs-identifier hs-var hs-var">refToUrlText</span></a></span></span><span> </span><span id="local-6989586621679355734"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679355734"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-326"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679355734"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-327"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">NameOnly</span></span><span> </span><span id="local-6989586621679355736"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679355736"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-328"></span><span>          </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679355736"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; (Name -&gt; NonEmpty NameSegment) -&gt; NonEmpty NameSegment
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NonEmpty NameSegment
</span><span class="hs-identifier hs-var">Name.segments</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty NameSegment
-&gt; (NonEmpty NameSegment -&gt; NonEmpty URISegment)
-&gt; NonEmpty URISegment
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(NameSegment -&gt; URISegment)
-&gt; NonEmpty NameSegment -&gt; NonEmpty URISegment
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; URISegment
</span><a href="Unison.Server.CodebaseServer.html#EscapeMe"><span class="hs-identifier hs-var">EscapeMe</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; URISegment)
-&gt; (NameSegment -&gt; Text) -&gt; NameSegment -&gt; URISegment
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Text
</span><span class="hs-identifier hs-var">NameSegment.toEscapedText</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty URISegment
-&gt; (NonEmpty URISegment -&gt; [URISegment]) -&gt; [URISegment]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty URISegment -&gt; [URISegment]
forall a. NonEmpty a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span>
</span><span id="line-329"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">HashOnly</span></span><span> </span><span id="local-6989586621679355739"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679355739"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-330"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; URISegment
</span><a href="Unison.Server.CodebaseServer.html#EscapeMe"><span class="hs-identifier hs-var">EscapeMe</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; URISegment) -&gt; Text -&gt; URISegment
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; Text
</span><span class="hs-identifier hs-var">ShortHash.toText</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679355739"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-331"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">HashQualified</span></span><span> </span><span id="local-6989586621679355742"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679355742"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-332"></span><span>          </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679355742"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; (Name -&gt; NonEmpty NameSegment) -&gt; NonEmpty NameSegment
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NonEmpty NameSegment
</span><span class="hs-identifier hs-var">Name.segments</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty NameSegment
-&gt; (NonEmpty NameSegment -&gt; NonEmpty URISegment)
-&gt; NonEmpty URISegment
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(NameSegment -&gt; URISegment)
-&gt; NonEmpty NameSegment -&gt; NonEmpty URISegment
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; URISegment
</span><a href="Unison.Server.CodebaseServer.html#EscapeMe"><span class="hs-identifier hs-var">EscapeMe</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; URISegment)
-&gt; (NameSegment -&gt; Text) -&gt; NameSegment -&gt; URISegment
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Text
</span><span class="hs-identifier hs-var">NameSegment.toEscapedText</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty URISegment
-&gt; (NonEmpty URISegment -&gt; [URISegment]) -&gt; [URISegment]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty URISegment -&gt; [URISegment]
forall a. NonEmpty a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span>    </span><span class="annot"><a href="#local-6989586621679355726"><span class="hs-identifier hs-type">toDefinitionPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#DefinitionReference"><span class="hs-identifier hs-type">DefinitionReference</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#URISegment"><span class="hs-identifier hs-type">URISegment</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-335"></span><span>    </span><span id="local-6989586621679355726"><span class="annot"><span class="annottext">toDefinitionPath :: DefinitionReference -&gt; [URISegment]
</span><a href="#local-6989586621679355726"><span class="hs-identifier hs-var hs-var">toDefinitionPath</span></a></span></span><span> </span><span id="local-6989586621679355743"><span class="annot"><span class="annottext">DefinitionReference
</span><a href="#local-6989586621679355743"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-336"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DefinitionReference
</span><a href="#local-6989586621679355743"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-337"></span><span>        </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#TermReference"><span class="hs-identifier hs-type">TermReference</span></a></span><span> </span><span id="local-6989586621679355744"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679355744"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-338"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; URISegment
</span><a href="Unison.Server.CodebaseServer.html#DontEscape"><span class="hs-identifier hs-var">DontEscape</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;terms&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[URISegment] -&gt; [URISegment] -&gt; [URISegment]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; [URISegment]
</span><a href="#local-6989586621679355733"><span class="hs-identifier hs-var">refToUrlText</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679355744"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-339"></span><span>        </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#TypeReference"><span class="hs-identifier hs-type">TypeReference</span></a></span><span> </span><span id="local-6989586621679355745"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679355745"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-340"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; URISegment
</span><a href="Unison.Server.CodebaseServer.html#DontEscape"><span class="hs-identifier hs-var">DontEscape</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;types&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[URISegment] -&gt; [URISegment] -&gt; [URISegment]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; [URISegment]
</span><a href="#local-6989586621679355733"><span class="hs-identifier hs-var">refToUrlText</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679355745"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-341"></span><span>        </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#AbilityConstructorReference"><span class="hs-identifier hs-type">AbilityConstructorReference</span></a></span><span> </span><span id="local-6989586621679355746"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679355746"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-342"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; URISegment
</span><a href="Unison.Server.CodebaseServer.html#DontEscape"><span class="hs-identifier hs-var">DontEscape</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ability-constructors&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[URISegment] -&gt; [URISegment] -&gt; [URISegment]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; [URISegment]
</span><a href="#local-6989586621679355733"><span class="hs-identifier hs-var">refToUrlText</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679355746"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-343"></span><span>        </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#DataConstructorReference"><span class="hs-identifier hs-type">DataConstructorReference</span></a></span><span> </span><span id="local-6989586621679355747"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679355747"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-344"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; URISegment
</span><a href="Unison.Server.CodebaseServer.html#DontEscape"><span class="hs-identifier hs-var">DontEscape</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;data-constructors&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[URISegment] -&gt; [URISegment] -&gt; [URISegment]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; [URISegment]
</span><a href="#local-6989586621679355733"><span class="hs-identifier hs-var">refToUrlText</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679355747"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#handleAuth"><span class="hs-identifier hs-type">handleAuth</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Strict.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span id="handleAuth"><span class="annot"><span class="annottext">handleAuth :: Method -&gt; Text -&gt; Handler ()
</span><a href="Unison.Server.CodebaseServer.html#handleAuth"><span class="hs-identifier hs-var hs-var">handleAuth</span></a></span></span><span> </span><span id="local-6989586621679355749"><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679355749"><span class="hs-identifier hs-var">expectedToken</span></a></span></span><span> </span><span id="local-6989586621679355750"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679355750"><span class="hs-identifier hs-var">gotToken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Method -&gt; Text
</span><span class="hs-identifier hs-var">Text.decodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679355749"><span class="hs-identifier hs-var">expectedToken</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679355750"><span class="hs-identifier hs-var">gotToken</span></a></span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; Handler ()
forall a. a -&gt; Handler a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Handler ()
forall {m :: * -&gt; *} {a}.
MonadError ServerError m =&gt;
ByteString -&gt; m a
</span><a href="#local-6989586621679355752"><span class="hs-identifier hs-var">throw401</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;Authentication token missing or incorrect.&quot;</span></span><span>
</span><span id="line-351"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-352"></span><span>    </span><span id="local-6989586621679355752"><span class="annot"><span class="annottext">throw401 :: ByteString -&gt; m a
</span><a href="#local-6989586621679355752"><span class="hs-identifier hs-var hs-var">throw401</span></a></span></span><span> </span><span id="local-6989586621679355764"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679355764"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; m a
forall a. ServerError -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(ServerError -&gt; m a) -&gt; ServerError -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><span class="hs-identifier hs-var">err401</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="hs-identifier hs-var">errBody</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679355764"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#openAPI"><span class="hs-identifier hs-type">openAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OpenApi</span></span><span>
</span><span id="line-355"></span><span id="openAPI"><span class="annot"><span class="annottext">openAPI :: OpenApi
</span><a href="Unison.Server.CodebaseServer.html#openAPI"><span class="hs-identifier hs-var hs-var">openAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy UnisonLocalAPI -&gt; OpenApi
forall {k} (api :: k). HasOpenApi api =&gt; Proxy api -&gt; OpenApi
</span><span class="hs-identifier hs-var">toOpenApi</span></span><span> </span><span class="annot"><span class="annottext">Proxy UnisonLocalAPI
</span><a href="Unison.Server.CodebaseServer.html#api"><span class="hs-identifier hs-var">api</span></a></span><span> </span><span class="annot"><span class="annottext">OpenApi -&gt; (OpenApi -&gt; OpenApi) -&gt; OpenApi
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Info -&gt; Identity Info) -&gt; OpenApi -&gt; Identity OpenApi
forall s a. HasInfo s a =&gt; Lens' s a
Lens' OpenApi Info
</span><span class="hs-identifier hs-var">OpenApi.info</span></span><span> </span><span class="annot"><span class="annottext">((Info -&gt; Identity Info) -&gt; OpenApi -&gt; Identity OpenApi)
-&gt; Info -&gt; OpenApi -&gt; OpenApi
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="Unison.Server.CodebaseServer.html#infoObject"><span class="hs-identifier hs-var">infoObject</span></a></span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#infoObject"><span class="hs-identifier hs-type">infoObject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Info</span></span><span>
</span><span id="line-358"></span><span id="infoObject"><span class="annot"><span class="annottext">infoObject :: Info
</span><a href="Unison.Server.CodebaseServer.html#infoObject"><span class="hs-identifier hs-var hs-var">infoObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-359"></span><span>  </span><span class="annot"><span class="annottext">Info
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">_infoTitle</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;Unison Codebase Manager API&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-361"></span><span>      </span><span class="annot"><span class="hs-identifier hs-var">_infoDescription</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-362"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Provides operations for querying and manipulating a Unison codebase.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-363"></span><span>      </span><span class="annot"><span class="hs-identifier hs-var">_infoLicense</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-364"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">License</span></span><span> </span><span class="annot"><span class="hs-string">&quot;MIT&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-365"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">URL</span></span><span>
</span><span id="line-366"></span><span>            </span><span class="annot"><span class="hs-string">&quot;https://github.com/unisonweb/unison/blob/trunk/LICENSE&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-367"></span><span>      </span><span class="annot"><span class="hs-identifier hs-var">_infoVersion</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;1.0&quot;</span></span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#docsBS"><span class="hs-identifier hs-type">docsBS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lazy.ByteString</span></span><span>
</span><span id="line-371"></span><span id="docsBS"><span class="annot"><span class="annottext">docsBS :: ByteString
</span><a href="Unison.Server.CodebaseServer.html#docsBS"><span class="hs-identifier hs-var hs-var">docsBS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><a href="Unison.Server.Types.html#mungeString"><span class="hs-identifier hs-var">mungeString</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ByteString) -&gt; (API -&gt; String) -&gt; API -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">API -&gt; String
</span><span class="hs-identifier hs-var">markdown</span></span><span> </span><span class="annot"><span class="annottext">(API -&gt; ByteString) -&gt; API -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[DocIntro] -&gt; Proxy UnisonLocalAPI -&gt; API
forall {k} (api :: k).
HasDocs api =&gt;
[DocIntro] -&gt; Proxy api -&gt; API
</span><span class="hs-identifier hs-var">docsWithIntros</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DocIntro
</span><a href="#local-6989586621679355778"><span class="hs-identifier hs-var">intro</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Proxy UnisonLocalAPI
</span><a href="Unison.Server.CodebaseServer.html#api"><span class="hs-identifier hs-var">api</span></a></span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-373"></span><span>    </span><span id="local-6989586621679355778"><span class="annot"><span class="annottext">intro :: DocIntro
</span><a href="#local-6989586621679355778"><span class="hs-identifier hs-var hs-var">intro</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-374"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; DocIntro
</span><span class="hs-identifier hs-var">DocIntro</span></span><span>
</span><span id="line-375"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; Text -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Info -&gt; Text
</span><span class="hs-identifier hs-var">_infoTitle</span></span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="Unison.Server.CodebaseServer.html#infoObject"><span class="hs-identifier hs-var">infoObject</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe String -&gt; [String]
forall a. Maybe a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; [String]) -&gt; Maybe String -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; Maybe Text -&gt; Maybe String
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Info -&gt; Maybe Text
</span><span class="hs-identifier hs-var">_infoDescription</span></span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="Unison.Server.CodebaseServer.html#infoObject"><span class="hs-identifier hs-var">infoObject</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#unisonAndDocsAPI"><span class="hs-identifier hs-type">unisonAndDocsAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAndDocsAPI"><span class="hs-identifier hs-type">UnisonAndDocsAPI</span></a></span><span>
</span><span id="line-379"></span><span id="unisonAndDocsAPI"><span class="annot"><span class="annottext">unisonAndDocsAPI :: Proxy UnisonAndDocsAPI
</span><a href="Unison.Server.CodebaseServer.html#unisonAndDocsAPI"><span class="hs-identifier hs-var hs-var">unisonAndDocsAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy UnisonAndDocsAPI
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#api"><span class="hs-identifier hs-type">api</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonLocalAPI"><span class="hs-identifier hs-type">UnisonLocalAPI</span></a></span><span>
</span><span id="line-382"></span><span id="api"><span class="annot"><span class="annottext">api :: Proxy UnisonLocalAPI
</span><a href="Unison.Server.CodebaseServer.html#api"><span class="hs-identifier hs-var hs-var">api</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy UnisonLocalAPI
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serverAPI"><span class="hs-identifier hs-type">serverAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ServerAPI"><span class="hs-identifier hs-type">ServerAPI</span></a></span><span>
</span><span id="line-385"></span><span id="serverAPI"><span class="annot"><span class="annottext">serverAPI :: Proxy ServerAPI
</span><a href="Unison.Server.CodebaseServer.html#serverAPI"><span class="hs-identifier hs-var hs-var">serverAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy ServerAPI
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#appAPI"><span class="hs-identifier hs-type">appAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#AppAPI"><span class="hs-identifier hs-type">AppAPI</span></a></span><span>
</span><span id="line-388"></span><span id="appAPI"><span class="annot"><span class="annottext">appAPI :: Proxy AppAPI
</span><a href="Unison.Server.CodebaseServer.html#appAPI"><span class="hs-identifier hs-var hs-var">appAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy AppAPI
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#app"><span class="hs-identifier hs-type">app</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-391"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-392"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-393"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-394"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-395"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Strict.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-396"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-397"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Application</span></span><span>
</span><span id="line-398"></span><span id="app"><span class="annot"><span class="annottext">app :: BackendEnv
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; String
-&gt; Method
-&gt; Maybe String
-&gt; Application
</span><a href="Unison.Server.CodebaseServer.html#app"><span class="hs-identifier hs-var hs-var">app</span></a></span></span><span> </span><span id="local-6989586621679355789"><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679355789"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679355790"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679355790"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679355791"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355791"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679355792"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679355792"><span class="hs-identifier hs-var">uiPath</span></a></span></span><span> </span><span id="local-6989586621679355793"><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679355793"><span class="hs-identifier hs-var">expectedToken</span></a></span></span><span> </span><span id="local-6989586621679355794"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679355794"><span class="hs-identifier hs-var">allowCorsHost</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-399"></span><span>  </span><span class="annot"><span class="annottext">Maybe String -&gt; Middleware
</span><a href="Unison.Server.CodebaseServer.html#corsPolicy"><span class="hs-identifier hs-var">corsPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679355794"><span class="hs-identifier hs-var">allowCorsHost</span></a></span><span> </span><span class="annot"><span class="annottext">Middleware -&gt; Middleware
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Proxy AppAPI -&gt; Server AppAPI -&gt; Application
forall api.
HasServer api '[] =&gt;
Proxy api -&gt; Server api -&gt; Application
</span><span class="hs-identifier hs-var">serve</span></span><span> </span><span class="annot"><span class="annottext">Proxy AppAPI
</span><a href="Unison.Server.CodebaseServer.html#appAPI"><span class="hs-identifier hs-var">appAPI</span></a></span><span> </span><span class="annot"><span class="annottext">(Server AppAPI -&gt; Application) -&gt; Server AppAPI -&gt; Application
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BackendEnv
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; String
-&gt; Method
-&gt; Server AppAPI
</span><a href="Unison.Server.CodebaseServer.html#server"><span class="hs-identifier hs-var">server</span></a></span><span> </span><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679355789"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679355790"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355791"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679355792"><span class="hs-identifier hs-var">uiPath</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679355793"><span class="hs-identifier hs-var">expectedToken</span></a></span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span class="hs-comment">-- | The Token is used to help prevent multiple users on a machine gain access to</span><span>
</span><span id="line-402"></span><span class="hs-comment">-- each others codebases.</span><span>
</span><span id="line-403"></span><span class="hs-comment">--</span><span>
</span><span id="line-404"></span><span class="hs-comment">-- Generate a cryptographically secure random token.</span><span>
</span><span id="line-405"></span><span class="hs-comment">-- https://neilmadden.blog/2018/08/30/moving-away-from-uuids/</span><span>
</span><span id="line-406"></span><span class="hs-comment">--</span><span>
</span><span id="line-407"></span><span class="hs-comment">--  E.g.</span><span>
</span><span id="line-408"></span><span class="hs-comment">-- &gt;&gt;&gt; genToken</span><span>
</span><span id="line-409"></span><span class="hs-comment">-- &quot;uxf85C7Y0B6om47&quot;</span><span>
</span><span id="line-410"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#genToken"><span class="hs-identifier hs-type">genToken</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Strict.ByteString</span></span><span>
</span><span id="line-411"></span><span id="genToken"><span class="annot"><span class="annottext">genToken :: IO Method
</span><a href="Unison.Server.CodebaseServer.html#genToken"><span class="hs-identifier hs-var hs-var">genToken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-412"></span><span>  </span><span class="annot"><span class="annottext">forall bin bout.
(ByteArrayAccess bin, ByteArray bout) =&gt;
Base -&gt; bin -&gt; bout
</span><span class="hs-identifier hs-var">BE.convertToBase</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><span class="annottext">Base
</span><span class="hs-identifier hs-var">BE.Base64URLUnpadded</span></span><span> </span><span class="annot"><span class="annottext">(Method -&gt; Method) -&gt; IO Method -&gt; IO Method
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO Method
forall byteArray. ByteArray byteArray =&gt; Int -&gt; IO byteArray
forall (m :: * -&gt; *) byteArray.
(MonadRandom m, ByteArray byteArray) =&gt;
Int -&gt; m byteArray
</span><span class="hs-identifier hs-var">Crypto.getRandomBytes</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679355801"><span class="hs-identifier hs-var">numRandomBytes</span></a></span><span>
</span><span id="line-413"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-414"></span><span>    </span><span id="local-6989586621679355801"><span class="annot"><span class="annottext">numRandomBytes :: Int
</span><a href="#local-6989586621679355801"><span class="hs-identifier hs-var hs-var">numRandomBytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span class="hs-keyword">data</span><span> </span><span id="Waiter"><span class="annot"><a href="Unison.Server.CodebaseServer.html#Waiter"><span class="hs-identifier hs-var">Waiter</span></a></span></span><span> </span><span id="local-6989586621679354507"><span class="annot"><a href="#local-6989586621679354507"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Waiter"><span class="annot"><a href="Unison.Server.CodebaseServer.html#Waiter"><span class="hs-identifier hs-var">Waiter</span></a></span></span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Anotify%3AWaiter"><span class="annot"><span class="annottext">forall a. Waiter a -&gt; a -&gt; IO ()
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Anotify%3AWaiter"><span class="hs-identifier hs-var hs-var">notify</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679354507"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-418"></span><span>    </span><span id="%24sel%3AwaitFor%3AWaiter"><span class="annot"><span class="annottext">forall a. Waiter a -&gt; IO a
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AwaitFor%3AWaiter"><span class="hs-identifier hs-var hs-var">waitFor</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679354507"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-419"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span id="local-6989586621679354511"><span class="annot"><a href="Unison.Server.CodebaseServer.html#mkWaiter"><span class="hs-identifier hs-type">mkWaiter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#Waiter"><span class="hs-identifier hs-type">Waiter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679354511"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-422"></span><span id="mkWaiter"><span class="annot"><span class="annottext">mkWaiter :: forall a. IO (Waiter a)
</span><a href="Unison.Server.CodebaseServer.html#mkWaiter"><span class="hs-identifier hs-var hs-var">mkWaiter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-423"></span><span>  </span><span id="local-6989586621679355810"><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621679355810"><span class="hs-identifier hs-var">mvar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar a)
forall a. IO (MVar a)
</span><span class="hs-identifier hs-var">newEmptyMVar</span></span><span>
</span><span id="line-424"></span><span>  </span><span class="annot"><span class="annottext">Waiter a -&gt; IO (Waiter a)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-425"></span><span>    </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#Waiter"><span class="hs-identifier hs-type">Waiter</span></a></span><span>
</span><span id="line-426"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:notify:Waiter :: a -&gt; IO ()
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Anotify%3AWaiter"><span class="hs-identifier hs-var">notify</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar a -&gt; a -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621679355810"><span class="hs-identifier hs-var">mvar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-427"></span><span>        </span><span class="annot"><span class="annottext">$sel:waitFor:Waiter :: IO a
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AwaitFor%3AWaiter"><span class="hs-identifier hs-var">waitFor</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar a -&gt; IO a
forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621679355810"><span class="hs-identifier hs-var">mvar</span></a></span><span>
</span><span id="line-428"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ucmUIVar"><span class="hs-identifier hs-type">ucmUIVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-431"></span><span id="ucmUIVar"><span class="annot"><span class="annottext">ucmUIVar :: String
</span><a href="Unison.Server.CodebaseServer.html#ucmUIVar"><span class="hs-identifier hs-var hs-var">ucmUIVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UCM_WEB_UI&quot;</span></span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ucmPortVar"><span class="hs-identifier hs-type">ucmPortVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-434"></span><span id="ucmPortVar"><span class="annot"><span class="annottext">ucmPortVar :: String
</span><a href="Unison.Server.CodebaseServer.html#ucmPortVar"><span class="hs-identifier hs-var hs-var">ucmPortVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UCM_PORT&quot;</span></span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ucmHostVar"><span class="hs-identifier hs-type">ucmHostVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-437"></span><span id="ucmHostVar"><span class="annot"><span class="annottext">ucmHostVar :: String
</span><a href="Unison.Server.CodebaseServer.html#ucmHostVar"><span class="hs-identifier hs-var hs-var">ucmHostVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UCM_HOST&quot;</span></span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ucmAllowCorsHost"><span class="hs-identifier hs-type">ucmAllowCorsHost</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-440"></span><span id="ucmAllowCorsHost"><span class="annot"><span class="annottext">ucmAllowCorsHost :: String
</span><a href="Unison.Server.CodebaseServer.html#ucmAllowCorsHost"><span class="hs-identifier hs-var hs-var">ucmAllowCorsHost</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UCM_ALLOW_CORS_HOST&quot;</span></span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ucmTokenVar"><span class="hs-identifier hs-type">ucmTokenVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-443"></span><span id="ucmTokenVar"><span class="annot"><span class="annottext">ucmTokenVar :: String
</span><a href="Unison.Server.CodebaseServer.html#ucmTokenVar"><span class="hs-identifier hs-var hs-var">ucmTokenVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UCM_TOKEN&quot;</span></span><span>
</span><span id="line-444"></span><span>
</span><span id="line-445"></span><span class="hs-keyword">data</span><span> </span><span id="CodebaseServerOpts"><span class="annot"><a href="Unison.Server.CodebaseServer.html#CodebaseServerOpts"><span class="hs-identifier hs-var">CodebaseServerOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CodebaseServerOpts"><span class="annot"><a href="Unison.Server.CodebaseServer.html#CodebaseServerOpts"><span class="hs-identifier hs-var">CodebaseServerOpts</span></a></span></span><span>
</span><span id="line-446"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Atoken%3ACodebaseServerOpts"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Atoken%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">token</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span>
</span><span id="line-447"></span><span>    </span><span id="%24sel%3Ahost%3ACodebaseServerOpts"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Ahost%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">host</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span>
</span><span id="line-448"></span><span>    </span><span id="%24sel%3Aport%3ACodebaseServerOpts"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe Int
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Aport%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">port</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-449"></span><span>    </span><span id="%24sel%3AallowCorsHost%3ACodebaseServerOpts"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AallowCorsHost%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">allowCorsHost</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span>
</span><span id="line-450"></span><span>    </span><span id="%24sel%3AcodebaseUIPath%3ACodebaseServerOpts"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AcodebaseUIPath%3ACodebaseServerOpts"><span class="hs-identifier hs-var hs-var">codebaseUIPath</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-451"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-452"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679355823"><span id="local-6989586621679355833"><span id="local-6989586621679355837"><span class="annot"><span class="annottext">Int -&gt; CodebaseServerOpts -&gt; ShowS
[CodebaseServerOpts] -&gt; ShowS
CodebaseServerOpts -&gt; String
(Int -&gt; CodebaseServerOpts -&gt; ShowS)
-&gt; (CodebaseServerOpts -&gt; String)
-&gt; ([CodebaseServerOpts] -&gt; ShowS)
-&gt; Show CodebaseServerOpts
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; CodebaseServerOpts -&gt; ShowS
showsPrec :: Int -&gt; CodebaseServerOpts -&gt; ShowS
$cshow :: CodebaseServerOpts -&gt; String
show :: CodebaseServerOpts -&gt; String
$cshowList :: [CodebaseServerOpts] -&gt; ShowS
showList :: [CodebaseServerOpts] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679355843"><span id="local-6989586621679355853"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool
(CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool)
-&gt; (CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool)
-&gt; Eq CodebaseServerOpts
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool
== :: CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool
$c/= :: CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool
/= :: CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#defaultCodebaseServerOpts"><span class="hs-identifier hs-type">defaultCodebaseServerOpts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#CodebaseServerOpts"><span class="hs-identifier hs-type">CodebaseServerOpts</span></a></span><span>
</span><span id="line-455"></span><span id="defaultCodebaseServerOpts"><span class="annot"><span class="annottext">defaultCodebaseServerOpts :: CodebaseServerOpts
</span><a href="Unison.Server.CodebaseServer.html#defaultCodebaseServerOpts"><span class="hs-identifier hs-var hs-var">defaultCodebaseServerOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-456"></span><span>  </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#CodebaseServerOpts"><span class="hs-identifier hs-type">CodebaseServerOpts</span></a></span><span>
</span><span id="line-457"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:token:CodebaseServerOpts :: Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Atoken%3ACodebaseServerOpts"><span class="hs-identifier hs-var">token</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-458"></span><span>      </span><span class="annot"><span class="annottext">$sel:host:CodebaseServerOpts :: Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Ahost%3ACodebaseServerOpts"><span class="hs-identifier hs-var">host</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-459"></span><span>      </span><span class="annot"><span class="annottext">$sel:port:CodebaseServerOpts :: Maybe Int
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Aport%3ACodebaseServerOpts"><span class="hs-identifier hs-var">port</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-460"></span><span>      </span><span class="annot"><span class="annottext">$sel:allowCorsHost:CodebaseServerOpts :: Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AallowCorsHost%3ACodebaseServerOpts"><span class="hs-identifier hs-var">allowCorsHost</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-461"></span><span>      </span><span class="annot"><span class="annottext">$sel:codebaseUIPath:CodebaseServerOpts :: Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AcodebaseUIPath%3ACodebaseServerOpts"><span class="hs-identifier hs-var">codebaseUIPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-462"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span class="hs-comment">-- The auth token required for accessing the server is passed to the function k</span><span>
</span><span id="line-465"></span><span id="local-6989586621679354522"><span class="annot"><a href="Unison.Server.CodebaseServer.html#startServer"><span class="hs-identifier hs-type">startServer</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-466"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-467"></span><span>  </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#CodebaseServerOpts"><span class="hs-identifier hs-type">CodebaseServerOpts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-468"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-469"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-470"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-type">BaseUrl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679354522"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-471"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679354522"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-472"></span><span id="startServer"><span class="annot"><span class="annottext">startServer :: forall a.
BackendEnv
-&gt; CodebaseServerOpts
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; (BaseUrl -&gt; IO a)
-&gt; IO a
</span><a href="Unison.Server.CodebaseServer.html#startServer"><span class="hs-identifier hs-var hs-var">startServer</span></a></span></span><span> </span><span id="local-6989586621679355880"><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679355880"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679355881"><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679355881"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621679355882"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679355882"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679355883"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355883"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679355884"><span class="annot"><span class="annottext">BaseUrl -&gt; IO a
</span><a href="#local-6989586621679355884"><span class="hs-identifier hs-var">onStart</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-473"></span><span>  </span><span class="hs-comment">-- the `canonicalizePath` resolves symlinks</span><span>
</span><span id="line-474"></span><span>  </span><span id="local-6989586621679355885"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679355885"><span class="hs-identifier hs-var">exePath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><span class="hs-identifier hs-var">canonicalizePath</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO String) -&gt; IO String -&gt; IO String
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">getExecutablePath</span></span><span>
</span><span id="line-475"></span><span>  </span><span id="local-6989586621679355887"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679355887"><span class="hs-identifier hs-var">envUI</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><span class="hs-identifier hs-var">canonicalizePath</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO String) -&gt; String -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; String
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">FilePath.takeDirectory</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679355885"><span class="hs-identifier hs-var">exePath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ui&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AcodebaseUIPath%3ACodebaseServerOpts"><span class="hs-identifier hs-var">codebaseUIPath</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679355881"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>  </span><span id="local-6989586621679355890"><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679355890"><span class="hs-identifier hs-var">token</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Atoken%3ACodebaseServerOpts"><span class="hs-identifier hs-var">token</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679355881"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-477"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679355891"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679355891"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Method -&gt; IO Method
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Method -&gt; IO Method) -&gt; Method -&gt; IO Method
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Method
</span><span class="hs-identifier hs-var">C8.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679355891"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-478"></span><span>    </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO Method
</span><a href="Unison.Server.CodebaseServer.html#genToken"><span class="hs-identifier hs-var">genToken</span></a></span><span>
</span><span id="line-479"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679355893"><span class="annot"><span class="annottext">baseUrl :: Int -&gt; BaseUrl
</span><a href="#local-6989586621679355893"><span class="hs-identifier hs-var hs-var">baseUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Method -&gt; Int -&gt; BaseUrl
</span><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-var">BaseUrl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; String
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;http://127.0.0.1&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Ahost%3ACodebaseServerOpts"><span class="hs-identifier hs-var">host</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679355881"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679355890"><span class="hs-identifier hs-var">token</span></a></span><span>
</span><span id="line-480"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679355894"><span class="annot"><span class="annottext">settings :: Settings
</span><a href="#local-6989586621679355894"><span class="hs-identifier hs-var hs-var">settings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-481"></span><span>        </span><span class="annot"><span class="annottext">Settings
</span><span class="hs-identifier hs-var">defaultSettings</span></span><span>
</span><span id="line-482"></span><span>          </span><span class="annot"><span class="annottext">Settings -&gt; (Settings -&gt; Settings) -&gt; Settings
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Settings -&gt; Settings)
-&gt; (Int -&gt; Settings -&gt; Settings)
-&gt; Maybe Int
-&gt; Settings
-&gt; Settings
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Settings -&gt; Settings
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">setPort</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe Int
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Aport%3ACodebaseServerOpts"><span class="hs-identifier hs-var">port</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679355881"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span>          </span><span class="annot"><span class="annottext">Settings -&gt; (Settings -&gt; Settings) -&gt; Settings
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Settings -&gt; Settings)
-&gt; (String -&gt; Settings -&gt; Settings)
-&gt; Maybe String
-&gt; Settings
-&gt; Settings
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Settings -&gt; Settings
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HostPreference -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">setHost</span></span><span> </span><span class="annot"><span class="annottext">(HostPreference -&gt; Settings -&gt; Settings)
-&gt; (String -&gt; HostPreference) -&gt; String -&gt; Settings -&gt; Settings
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; HostPreference
forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Ahost%3ACodebaseServerOpts"><span class="hs-identifier hs-var">host</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679355881"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679355897"><span class="annot"><span class="annottext">a :: Application
</span><a href="#local-6989586621679355897"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BackendEnv
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; String
-&gt; Method
-&gt; Maybe String
-&gt; Application
</span><a href="Unison.Server.CodebaseServer.html#app"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679355880"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679355882"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355883"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679355887"><span class="hs-identifier hs-var">envUI</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679355890"><span class="hs-identifier hs-var">token</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AallowCorsHost%3ACodebaseServerOpts"><span class="hs-identifier hs-var">allowCorsHost</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679355881"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe Int
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Aport%3ACodebaseServerOpts"><span class="hs-identifier hs-var">port</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621679355881"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-486"></span><span>    </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Settings -&gt; IO Application -&gt; (Int -&gt; IO a) -&gt; IO a
forall a. Settings -&gt; IO Application -&gt; (Int -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">withApplicationSettings</span></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679355894"><span class="hs-identifier hs-var">settings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Application -&gt; IO Application
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679355897"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BaseUrl -&gt; IO a
</span><a href="#local-6989586621679355884"><span class="hs-identifier hs-var">onStart</span></a></span><span> </span><span class="annot"><span class="annottext">(BaseUrl -&gt; IO a) -&gt; (Int -&gt; BaseUrl) -&gt; Int -&gt; IO a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; BaseUrl
</span><a href="#local-6989586621679355893"><span class="hs-identifier hs-var">baseUrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679355898"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679355898"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-488"></span><span>      </span><span id="local-6989586621679355899"><span class="annot"><span class="annottext">Waiter ()
</span><a href="#local-6989586621679355899"><span class="hs-identifier hs-var">started</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Waiter ())
forall a. IO (Waiter a)
</span><a href="Unison.Server.CodebaseServer.html#mkWaiter"><span class="hs-identifier hs-var">mkWaiter</span></a></span><span>
</span><span id="line-489"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679355900"><span class="annot"><span class="annottext">settings' :: Settings
</span><a href="#local-6989586621679355900"><span class="hs-identifier hs-var hs-var">settings'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">setBeforeMainLoop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Waiter () -&gt; () -&gt; IO ()
forall a. Waiter a -&gt; a -&gt; IO ()
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3Anotify%3AWaiter"><span class="hs-identifier hs-var">notify</span></a></span><span> </span><span class="annot"><span class="annottext">Waiter ()
</span><a href="#local-6989586621679355899"><span class="hs-identifier hs-var">started</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679355894"><span class="hs-identifier hs-var">settings</span></a></span><span>
</span><span id="line-490"></span><span>      </span><span id="local-6989586621679355901"><span class="annot"><span class="annottext">Either () a
</span><a href="#local-6989586621679355901"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-491"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; IO a -&gt; IO (Either () a)
forall a b. IO a -&gt; IO b -&gt; IO (Either a b)
</span><span class="hs-identifier hs-var">race</span></span><span>
</span><span id="line-492"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Settings -&gt; Application -&gt; IO ()
</span><span class="hs-identifier hs-var">runSettings</span></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679355900"><span class="hs-identifier hs-var">settings'</span></a></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679355897"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Waiter () -&gt; IO ()
forall a. Waiter a -&gt; IO a
</span><a href="Unison.Server.CodebaseServer.html#%24sel%3AwaitFor%3AWaiter"><span class="hs-identifier hs-var">waitFor</span></a></span><span> </span><span class="annot"><span class="annottext">Waiter ()
</span><a href="#local-6989586621679355899"><span class="hs-identifier hs-var">started</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO a -&gt; IO a
forall a b. IO a -&gt; IO b -&gt; IO b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; IO a
</span><a href="#local-6989586621679355884"><span class="hs-identifier hs-var">onStart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; BaseUrl
</span><a href="#local-6989586621679355893"><span class="hs-identifier hs-var">baseUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679355898"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either () a
</span><a href="#local-6989586621679355901"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-495"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrorCall -&gt; IO a
forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(ErrorCall -&gt; IO a) -&gt; ErrorCall -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ErrorCall
</span><span class="hs-identifier hs-var">ErrorCall</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Server exited unexpectedly!&quot;</span></span><span>
</span><span id="line-496"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679355903"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679355903"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; IO a
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679355903"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveIndex"><span class="hs-identifier hs-type">serveIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-type">RawHtml</span></a></span><span>
</span><span id="line-499"></span><span id="serveIndex"><span class="annot"><span class="annottext">serveIndex :: String -&gt; Handler RawHtml
</span><a href="Unison.Server.CodebaseServer.html#serveIndex"><span class="hs-identifier hs-var hs-var">serveIndex</span></a></span></span><span> </span><span id="local-6989586621679355905"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679355905"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-500"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679355906"><span class="annot"><span class="annottext">index :: String
</span><a href="#local-6989586621679355906"><span class="hs-identifier hs-var hs-var">index</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679355905"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;index.html&quot;</span></span><span>
</span><span id="line-501"></span><span>  </span><span id="local-6989586621679355907"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679355907"><span class="hs-identifier hs-var">exists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; Handler Bool
forall a. IO a -&gt; Handler a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; Handler Bool) -&gt; IO Bool -&gt; Handler Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesFileExist</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679355906"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-502"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679355907"><span class="hs-identifier hs-var">exists</span></a></span><span>
</span><span id="line-503"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; RawHtml) -&gt; Handler ByteString -&gt; Handler RawHtml
forall a b. (a -&gt; b) -&gt; Handler a -&gt; Handler b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; RawHtml
</span><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-var">RawHtml</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler ByteString -&gt; Handler RawHtml)
-&gt; (String -&gt; Handler ByteString) -&gt; String -&gt; Handler RawHtml
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO ByteString -&gt; Handler ByteString
forall a. IO a -&gt; Handler a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; Handler ByteString)
-&gt; (String -&gt; IO ByteString) -&gt; String -&gt; Handler ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ByteString
</span><span class="hs-identifier hs-var">Lazy.readFile</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Handler RawHtml) -&gt; String -&gt; Handler RawHtml
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679355905"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;index.html&quot;</span></span><span>
</span><span id="line-504"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Handler RawHtml
forall {a}. Handler a
</span><a href="#local-6989586621679355910"><span class="hs-identifier hs-var">fail</span></a></span><span>
</span><span id="line-505"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-506"></span><span>    </span><span id="local-6989586621679355910"><span class="annot"><span class="annottext">fail :: Handler a
</span><a href="#local-6989586621679355910"><span class="hs-identifier hs-var hs-var">fail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-507"></span><span>      </span><span class="annot"><span class="annottext">ServerError -&gt; Handler a
forall a. ServerError -&gt; Handler a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(ServerError -&gt; Handler a) -&gt; ServerError -&gt; Handler a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-508"></span><span>        </span><span class="annot"><span class="annottext">ServerError
</span><span class="hs-identifier hs-var">err404</span></span><span>
</span><span id="line-509"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">errBody</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-510"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">BLU.fromString</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-511"></span><span>                </span><span class="annot"><span class="hs-string">&quot;No codebase UI configured.&quot;</span></span><span>
</span><span id="line-512"></span><span>                  </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; Set the &quot;</span></span><span>
</span><span id="line-513"></span><span>                  </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ucmUIVar"><span class="hs-identifier hs-type">ucmUIVar</span></a></span><span>
</span><span id="line-514"></span><span>                  </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; environment variable to the directory where the UI is installed.&quot;</span></span><span>
</span><span id="line-515"></span><span>                  </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; If you're running a dev build of ucm, run `./dev-ui-install.sh`.&quot;</span></span><span>
</span><span id="line-516"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveUI"><span class="hs-identifier hs-type">serveUI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#WebUI"><span class="hs-identifier hs-type">WebUI</span></a></span><span>
</span><span id="line-519"></span><span id="serveUI"><span class="annot"><span class="annottext">serveUI :: String -&gt; Server WebUI
</span><a href="Unison.Server.CodebaseServer.html#serveUI"><span class="hs-identifier hs-var hs-var">serveUI</span></a></span></span><span> </span><span id="local-6989586621679355926"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679355926"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Handler RawHtml
</span><a href="Unison.Server.CodebaseServer.html#serveIndex"><span class="hs-identifier hs-var">serveIndex</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679355926"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span class="hs-comment">-- Apply cors if there is allow-cors-host defined</span><span>
</span><span id="line-522"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#corsPolicy"><span class="hs-identifier hs-type">corsPolicy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Middleware</span></span><span>
</span><span id="line-523"></span><span id="corsPolicy"><span class="annot"><span class="annottext">corsPolicy :: Maybe String -&gt; Middleware
</span><a href="Unison.Server.CodebaseServer.html#corsPolicy"><span class="hs-identifier hs-var hs-var">corsPolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Middleware -&gt; (String -&gt; Middleware) -&gt; Maybe String -&gt; Middleware
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Middleware
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679355927"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679355927"><span class="hs-identifier hs-var">allowCorsHost</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-524"></span><span>  </span><span class="annot"><span class="annottext">(Request -&gt; Maybe CorsResourcePolicy) -&gt; Middleware
</span><span class="hs-identifier hs-var">cors</span></span><span> </span><span class="annot"><span class="annottext">((Request -&gt; Maybe CorsResourcePolicy) -&gt; Middleware)
-&gt; (Request -&gt; Maybe CorsResourcePolicy) -&gt; Middleware
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-525"></span><span>    </span><span class="annot"><span class="annottext">Maybe CorsResourcePolicy -&gt; Request -&gt; Maybe CorsResourcePolicy
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Maybe CorsResourcePolicy -&gt; Request -&gt; Maybe CorsResourcePolicy)
-&gt; Maybe CorsResourcePolicy -&gt; Request -&gt; Maybe CorsResourcePolicy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-526"></span><span>      </span><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; Maybe CorsResourcePolicy
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-527"></span><span>        </span><span class="annot"><span class="annottext">CorsResourcePolicy
</span><span class="hs-identifier hs-var">simpleCorsResourcePolicy</span></span><span>
</span><span id="line-528"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">corsMethods</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;GET&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;OPTIONS&quot;</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-529"></span><span>            </span><span class="annot"><span class="hs-identifier hs-var">corsOrigins</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">C8.pack</span></span><span> </span><span class="annot"><a href="#local-6989586621679355927"><span class="hs-identifier hs-type">allowCorsHost</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#server"><span class="hs-identifier hs-type">server</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-533"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-534"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-535"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-536"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-537"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Strict.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-538"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#AppAPI"><span class="hs-identifier hs-type">AppAPI</span></a></span><span>
</span><span id="line-539"></span><span id="server"><span class="annot"><span class="annottext">server :: BackendEnv
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; String
-&gt; Method
-&gt; Server AppAPI
</span><a href="Unison.Server.CodebaseServer.html#server"><span class="hs-identifier hs-var hs-var">server</span></a></span></span><span> </span><span id="local-6989586621679355929"><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679355929"><span class="hs-identifier hs-var">backendEnv</span></a></span></span><span> </span><span id="local-6989586621679355930"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679355930"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679355931"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355931"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679355932"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679355932"><span class="hs-identifier hs-var">uiPath</span></a></span></span><span> </span><span id="local-6989586621679355933"><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679355933"><span class="hs-identifier hs-var">expectedToken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-540"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; ServerT Raw Handler
forall (m :: * -&gt; *). String -&gt; ServerT Raw m
</span><span class="hs-identifier hs-var">serveDirectoryWebApp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679355932"><span class="hs-identifier hs-var">uiPath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;static&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span>    </span><span class="annot"><span class="annottext">Tagged Handler Application
-&gt; (Text
    -&gt; ([Text] -&gt; Handler RawHtml)
       :&lt;|&gt; ((((Maybe PrefixFilter -&gt; Handler [ProjectListing])
               :&lt;|&gt; (ProjectName
                     -&gt; ((Maybe PrefixFilter -&gt; Handler [ProjectBranchListing])
                         :&lt;|&gt; (ProjectBranchName
                               -&gt; (Maybe Path
                                   -&gt; Maybe Path
                                   -&gt; Handler
                                        (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
                                  :&lt;|&gt; ((Path
                                         -&gt; Maybe Width
                                         -&gt; Handler
                                              (Headers
                                                 '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
                                        :&lt;|&gt; ((Maybe Path
                                               -&gt; [HashQualified Name]
                                               -&gt; Maybe Width
                                               -&gt; Maybe Suffixify
                                               -&gt; Handler
                                                    (Headers
                                                       '[Header &quot;Cache-Control&quot; String]
                                                       DefinitionDisplayResults))
                                              :&lt;|&gt; ((Maybe Path
                                                     -&gt; Maybe Int
                                                     -&gt; Maybe Width
                                                     -&gt; Maybe String
                                                     -&gt; Handler
                                                          (Headers
                                                             '[Header &quot;Cache-Control&quot; String]
                                                             [(Alignment, FoundResult)]))
                                                    :&lt;|&gt; ((Referent
                                                           -&gt; Maybe Name
                                                           -&gt; Maybe Path
                                                           -&gt; Maybe Width
                                                           -&gt; Handler
                                                                (Headers
                                                                   '[Header &quot;Cache-Control&quot; String]
                                                                   TermSummary))
                                                          :&lt;|&gt; (Reference
                                                                -&gt; Maybe Name
                                                                -&gt; Maybe Path
                                                                -&gt; Maybe Width
                                                                -&gt; Handler
                                                                     (Headers
                                                                        '[Header
                                                                            &quot;Cache-Control&quot; String]
                                                                        TypeSummary))))))))
                        :&lt;|&gt; ((ProjectBranchName
                               -&gt; ProjectBranchName -&gt; Name -&gt; Name -&gt; Handler TermDiffResponse)
                              :&lt;|&gt; (ProjectBranchName
                                    -&gt; ProjectBranchName
                                    -&gt; Name
                                    -&gt; Name
                                    -&gt; Handler TypeDiffResponse))))
              :&lt;|&gt; Handler (APIHeaders Current))
             :&lt;|&gt; (Handler OpenApi :&lt;|&gt; Tagged Handler Application)))
-&gt; Tagged Handler Application
   :&lt;|&gt; (Text
         -&gt; ([Text] -&gt; Handler RawHtml)
            :&lt;|&gt; ((((Maybe PrefixFilter -&gt; Handler [ProjectListing])
                    :&lt;|&gt; (ProjectName
                          -&gt; ((Maybe PrefixFilter -&gt; Handler [ProjectBranchListing])
                              :&lt;|&gt; (ProjectBranchName
                                    -&gt; (Maybe Path
                                        -&gt; Maybe Path
                                        -&gt; Handler
                                             (Headers
                                                '[Header &quot;Cache-Control&quot; String] NamespaceListing))
                                       :&lt;|&gt; ((Path
                                              -&gt; Maybe Width
                                              -&gt; Handler
                                                   (Headers
                                                      '[Header &quot;Cache-Control&quot; String]
                                                      NamespaceDetails))
                                             :&lt;|&gt; ((Maybe Path
                                                    -&gt; [HashQualified Name]
                                                    -&gt; Maybe Width
                                                    -&gt; Maybe Suffixify
                                                    -&gt; Handler
                                                         (Headers
                                                            '[Header &quot;Cache-Control&quot; String]
                                                            DefinitionDisplayResults))
                                                   :&lt;|&gt; ((Maybe Path
                                                          -&gt; Maybe Int
                                                          -&gt; Maybe Width
                                                          -&gt; Maybe String
                                                          -&gt; Handler
                                                               (Headers
                                                                  '[Header &quot;Cache-Control&quot; String]
                                                                  [(Alignment, FoundResult)]))
                                                         :&lt;|&gt; ((Referent
                                                                -&gt; Maybe Name
                                                                -&gt; Maybe Path
                                                                -&gt; Maybe Width
                                                                -&gt; Handler
                                                                     (Headers
                                                                        '[Header
                                                                            &quot;Cache-Control&quot; String]
                                                                        TermSummary))
                                                               :&lt;|&gt; (Reference
                                                                     -&gt; Maybe Name
                                                                     -&gt; Maybe Path
                                                                     -&gt; Maybe Width
                                                                     -&gt; Handler
                                                                          (Headers
                                                                             '[Header
                                                                                 &quot;Cache-Control&quot;
                                                                                 String]
                                                                             TypeSummary))))))))
                             :&lt;|&gt; ((ProjectBranchName
                                    -&gt; ProjectBranchName
                                    -&gt; Name
                                    -&gt; Name
                                    -&gt; Handler TermDiffResponse)
                                   :&lt;|&gt; (ProjectBranchName
                                         -&gt; ProjectBranchName
                                         -&gt; Name
                                         -&gt; Name
                                         -&gt; Handler TypeDiffResponse))))
                   :&lt;|&gt; Handler (APIHeaders Current))
                  :&lt;|&gt; (Handler OpenApi :&lt;|&gt; Tagged Handler Application)))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Proxy ServerAPI
-&gt; Method
-&gt; ServerT ServerAPI Handler
-&gt; ServerT (Capture &quot;token&quot; Text :&gt; ServerAPI) Handler
forall api.
HasServer api '[] =&gt;
Proxy api
-&gt; Method -&gt; ServerT api Handler -&gt; ServerT (Authed api) Handler
</span><a href="Unison.Server.CodebaseServer.html#hoistWithAuth"><span class="hs-identifier hs-var">hoistWithAuth</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy ServerAPI
</span><a href="Unison.Server.CodebaseServer.html#serverAPI"><span class="hs-identifier hs-var">serverAPI</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679355933"><span class="hs-identifier hs-var">expectedToken</span></a></span><span> </span><span class="annot"><span class="annottext">ServerT ServerAPI Handler
</span><a href="#local-6989586621679355936"><span class="hs-identifier hs-var">serveServer</span></a></span><span>
</span><span id="line-542"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-543"></span><span>    </span><span class="annot"><a href="#local-6989586621679355936"><span class="hs-identifier hs-type">serveServer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ServerAPI"><span class="hs-identifier hs-type">ServerAPI</span></a></span><span>
</span><span id="line-544"></span><span>    </span><span id="local-6989586621679355936"><span class="annot"><span class="annottext">serveServer :: ServerT ServerAPI Handler
</span><a href="#local-6989586621679355936"><span class="hs-identifier hs-var hs-var">serveServer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-545"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Server WebUI
</span><a href="Unison.Server.CodebaseServer.html#serveUI"><span class="hs-identifier hs-var">serveUI</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679355932"><span class="hs-identifier hs-var">uiPath</span></a></span><span>
</span><span id="line-546"></span><span>        </span><span class="annot"><span class="annottext">([Text] -&gt; Handler RawHtml)
-&gt; ((((Maybe PrefixFilter -&gt; Handler [ProjectListing])
      :&lt;|&gt; (ProjectName
            -&gt; ((Maybe PrefixFilter -&gt; Handler [ProjectBranchListing])
                :&lt;|&gt; (ProjectBranchName
                      -&gt; (Maybe Path
                          -&gt; Maybe Path
                          -&gt; Handler
                               (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
                         :&lt;|&gt; ((Path
                                -&gt; Maybe Width
                                -&gt; Handler
                                     (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
                               :&lt;|&gt; ((Maybe Path
                                      -&gt; [HashQualified Name]
                                      -&gt; Maybe Width
                                      -&gt; Maybe Suffixify
                                      -&gt; Handler
                                           (Headers
                                              '[Header &quot;Cache-Control&quot; String]
                                              DefinitionDisplayResults))
                                     :&lt;|&gt; ((Maybe Path
                                            -&gt; Maybe Int
                                            -&gt; Maybe Width
                                            -&gt; Maybe String
                                            -&gt; Handler
                                                 (Headers
                                                    '[Header &quot;Cache-Control&quot; String]
                                                    [(Alignment, FoundResult)]))
                                           :&lt;|&gt; ((Referent
                                                  -&gt; Maybe Name
                                                  -&gt; Maybe Path
                                                  -&gt; Maybe Width
                                                  -&gt; Handler
                                                       (Headers
                                                          '[Header &quot;Cache-Control&quot; String]
                                                          TermSummary))
                                                 :&lt;|&gt; (Reference
                                                       -&gt; Maybe Name
                                                       -&gt; Maybe Path
                                                       -&gt; Maybe Width
                                                       -&gt; Handler
                                                            (Headers
                                                               '[Header &quot;Cache-Control&quot; String]
                                                               TypeSummary))))))))
               :&lt;|&gt; ((ProjectBranchName
                      -&gt; ProjectBranchName -&gt; Name -&gt; Name -&gt; Handler TermDiffResponse)
                     :&lt;|&gt; (ProjectBranchName
                           -&gt; ProjectBranchName
                           -&gt; Name
                           -&gt; Name
                           -&gt; Handler TypeDiffResponse))))
     :&lt;|&gt; Handler (APIHeaders Current))
    :&lt;|&gt; (Handler OpenApi :&lt;|&gt; Tagged Handler Application))
-&gt; ([Text] -&gt; Handler RawHtml)
   :&lt;|&gt; ((((Maybe PrefixFilter -&gt; Handler [ProjectListing])
           :&lt;|&gt; (ProjectName
                 -&gt; ((Maybe PrefixFilter -&gt; Handler [ProjectBranchListing])
                     :&lt;|&gt; (ProjectBranchName
                           -&gt; (Maybe Path
                               -&gt; Maybe Path
                               -&gt; Handler
                                    (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
                              :&lt;|&gt; ((Path
                                     -&gt; Maybe Width
                                     -&gt; Handler
                                          (Headers
                                             '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
                                    :&lt;|&gt; ((Maybe Path
                                           -&gt; [HashQualified Name]
                                           -&gt; Maybe Width
                                           -&gt; Maybe Suffixify
                                           -&gt; Handler
                                                (Headers
                                                   '[Header &quot;Cache-Control&quot; String]
                                                   DefinitionDisplayResults))
                                          :&lt;|&gt; ((Maybe Path
                                                 -&gt; Maybe Int
                                                 -&gt; Maybe Width
                                                 -&gt; Maybe String
                                                 -&gt; Handler
                                                      (Headers
                                                         '[Header &quot;Cache-Control&quot; String]
                                                         [(Alignment, FoundResult)]))
                                                :&lt;|&gt; ((Referent
                                                       -&gt; Maybe Name
                                                       -&gt; Maybe Path
                                                       -&gt; Maybe Width
                                                       -&gt; Handler
                                                            (Headers
                                                               '[Header &quot;Cache-Control&quot; String]
                                                               TermSummary))
                                                      :&lt;|&gt; (Reference
                                                            -&gt; Maybe Name
                                                            -&gt; Maybe Path
                                                            -&gt; Maybe Width
                                                            -&gt; Handler
                                                                 (Headers
                                                                    '[Header &quot;Cache-Control&quot; String]
                                                                    TypeSummary))))))))
                    :&lt;|&gt; ((ProjectBranchName
                           -&gt; ProjectBranchName -&gt; Name -&gt; Name -&gt; Handler TermDiffResponse)
                          :&lt;|&gt; (ProjectBranchName
                                -&gt; ProjectBranchName
                                -&gt; Name
                                -&gt; Name
                                -&gt; Handler TypeDiffResponse))))
          :&lt;|&gt; Handler (APIHeaders Current))
         :&lt;|&gt; (Handler OpenApi :&lt;|&gt; Tagged Handler Application))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">BackendEnv
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; Server UnisonAndDocsAPI
</span><a href="Unison.Server.CodebaseServer.html#serveUnisonAndDocs"><span class="hs-identifier hs-var">serveUnisonAndDocs</span></a></span><span> </span><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679355929"><span class="hs-identifier hs-var">backendEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679355930"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355931"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveUnisonAndDocs"><span class="hs-identifier hs-type">serveUnisonAndDocs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAndDocsAPI"><span class="hs-identifier hs-type">UnisonAndDocsAPI</span></a></span><span>
</span><span id="line-549"></span><span id="serveUnisonAndDocs"><span class="annot"><span class="annottext">serveUnisonAndDocs :: BackendEnv
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; Server UnisonAndDocsAPI
</span><a href="Unison.Server.CodebaseServer.html#serveUnisonAndDocs"><span class="hs-identifier hs-var hs-var">serveUnisonAndDocs</span></a></span></span><span> </span><span id="local-6989586621679355938"><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679355938"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679355939"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679355939"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679355940"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355940"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BackendEnv
-&gt; Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; Server UnisonLocalAPI
</span><a href="Unison.Server.CodebaseServer.html#serveUnisonLocal"><span class="hs-identifier hs-var">serveUnisonLocal</span></a></span><span> </span><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679355938"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355940"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679355939"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">(((Maybe PrefixFilter -&gt; Handler [ProjectListing])
  :&lt;|&gt; (ProjectName
        -&gt; ((Maybe PrefixFilter -&gt; Handler [ProjectBranchListing])
            :&lt;|&gt; (ProjectBranchName
                  -&gt; (Maybe Path
                      -&gt; Maybe Path
                      -&gt; Handler
                           (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
                     :&lt;|&gt; ((Path
                            -&gt; Maybe Width
                            -&gt; Handler
                                 (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
                           :&lt;|&gt; ((Maybe Path
                                  -&gt; [HashQualified Name]
                                  -&gt; Maybe Width
                                  -&gt; Maybe Suffixify
                                  -&gt; Handler
                                       (Headers
                                          '[Header &quot;Cache-Control&quot; String]
                                          DefinitionDisplayResults))
                                 :&lt;|&gt; ((Maybe Path
                                        -&gt; Maybe Int
                                        -&gt; Maybe Width
                                        -&gt; Maybe String
                                        -&gt; Handler
                                             (Headers
                                                '[Header &quot;Cache-Control&quot; String]
                                                [(Alignment, FoundResult)]))
                                       :&lt;|&gt; ((Referent
                                              -&gt; Maybe Name
                                              -&gt; Maybe Path
                                              -&gt; Maybe Width
                                              -&gt; Handler
                                                   (Headers
                                                      '[Header &quot;Cache-Control&quot; String] TermSummary))
                                             :&lt;|&gt; (Reference
                                                   -&gt; Maybe Name
                                                   -&gt; Maybe Path
                                                   -&gt; Maybe Width
                                                   -&gt; Handler
                                                        (Headers
                                                           '[Header &quot;Cache-Control&quot; String]
                                                           TypeSummary))))))))
           :&lt;|&gt; ((ProjectBranchName
                  -&gt; ProjectBranchName -&gt; Name -&gt; Name -&gt; Handler TermDiffResponse)
                 :&lt;|&gt; (ProjectBranchName
                       -&gt; ProjectBranchName
                       -&gt; Name
                       -&gt; Name
                       -&gt; Handler TypeDiffResponse))))
 :&lt;|&gt; Handler (APIHeaders Current))
-&gt; (Handler OpenApi :&lt;|&gt; Tagged Handler Application)
-&gt; (((Maybe PrefixFilter -&gt; Handler [ProjectListing])
     :&lt;|&gt; (ProjectName
           -&gt; ((Maybe PrefixFilter -&gt; Handler [ProjectBranchListing])
               :&lt;|&gt; (ProjectBranchName
                     -&gt; (Maybe Path
                         -&gt; Maybe Path
                         -&gt; Handler
                              (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
                        :&lt;|&gt; ((Path
                               -&gt; Maybe Width
                               -&gt; Handler
                                    (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
                              :&lt;|&gt; ((Maybe Path
                                     -&gt; [HashQualified Name]
                                     -&gt; Maybe Width
                                     -&gt; Maybe Suffixify
                                     -&gt; Handler
                                          (Headers
                                             '[Header &quot;Cache-Control&quot; String]
                                             DefinitionDisplayResults))
                                    :&lt;|&gt; ((Maybe Path
                                           -&gt; Maybe Int
                                           -&gt; Maybe Width
                                           -&gt; Maybe String
                                           -&gt; Handler
                                                (Headers
                                                   '[Header &quot;Cache-Control&quot; String]
                                                   [(Alignment, FoundResult)]))
                                          :&lt;|&gt; ((Referent
                                                 -&gt; Maybe Name
                                                 -&gt; Maybe Path
                                                 -&gt; Maybe Width
                                                 -&gt; Handler
                                                      (Headers
                                                         '[Header &quot;Cache-Control&quot; String]
                                                         TermSummary))
                                                :&lt;|&gt; (Reference
                                                      -&gt; Maybe Name
                                                      -&gt; Maybe Path
                                                      -&gt; Maybe Width
                                                      -&gt; Handler
                                                           (Headers
                                                              '[Header &quot;Cache-Control&quot; String]
                                                              TypeSummary))))))))
              :&lt;|&gt; ((ProjectBranchName
                     -&gt; ProjectBranchName -&gt; Name -&gt; Name -&gt; Handler TermDiffResponse)
                    :&lt;|&gt; (ProjectBranchName
                          -&gt; ProjectBranchName
                          -&gt; Name
                          -&gt; Name
                          -&gt; Handler TypeDiffResponse))))
    :&lt;|&gt; Handler (APIHeaders Current))
   :&lt;|&gt; (Handler OpenApi :&lt;|&gt; Tagged Handler Application)
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Handler OpenApi
</span><a href="Unison.Server.CodebaseServer.html#serveOpenAPI"><span class="hs-identifier hs-var">serveOpenAPI</span></a></span><span> </span><span class="annot"><span class="annottext">Handler OpenApi
-&gt; Tagged Handler Application
-&gt; Handler OpenApi :&lt;|&gt; Tagged Handler Application
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Application -&gt; Tagged Handler Application
forall {k} (s :: k) b. b -&gt; Tagged s b
</span><span class="hs-identifier hs-var">Tagged</span></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="Unison.Server.CodebaseServer.html#serveDocs"><span class="hs-identifier hs-var">serveDocs</span></a></span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveDocs"><span class="hs-identifier hs-type">serveDocs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Application</span></span><span>
</span><span id="line-552"></span><span id="serveDocs"><span class="annot"><span class="annottext">serveDocs :: Application
</span><a href="Unison.Server.CodebaseServer.html#serveDocs"><span class="hs-identifier hs-var hs-var">serveDocs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Request
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679355944"><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679355944"><span class="hs-identifier hs-var">respond</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679355944"><span class="hs-identifier hs-var">respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Response -&gt; IO ResponseReceived)
-&gt; Response -&gt; IO ResponseReceived
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Status -&gt; ResponseHeaders -&gt; ByteString -&gt; Response
</span><span class="hs-identifier hs-var">responseLBS</span></span><span> </span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier hs-var">ok200</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(HeaderName, Method)
</span><a href="#local-6989586621679355945"><span class="hs-identifier hs-var">plain</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="Unison.Server.CodebaseServer.html#docsBS"><span class="hs-identifier hs-var">docsBS</span></a></span><span>
</span><span id="line-553"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-554"></span><span>    </span><span class="annot"><a href="#local-6989586621679355945"><span class="hs-identifier hs-type">plain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HeaderName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>    </span><span id="local-6989586621679355945"><span class="annot"><span class="annottext">plain :: (HeaderName, Method)
</span><a href="#local-6989586621679355945"><span class="hs-identifier hs-var hs-var">plain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Content-Type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;text/plain&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveOpenAPI"><span class="hs-identifier hs-type">serveOpenAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">OpenApi</span></span><span>
</span><span id="line-558"></span><span id="serveOpenAPI"><span class="annot"><span class="annottext">serveOpenAPI :: Handler OpenApi
</span><a href="Unison.Server.CodebaseServer.html#serveOpenAPI"><span class="hs-identifier hs-var hs-var">serveOpenAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpenApi -&gt; Handler OpenApi
forall a. a -&gt; Handler a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">OpenApi
</span><a href="Unison.Server.CodebaseServer.html#openAPI"><span class="hs-identifier hs-var">openAPI</span></a></span><span>
</span><span id="line-559"></span><span>
</span><span id="line-560"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#hoistWithAuth"><span class="hs-identifier hs-type">hoistWithAuth</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679354555"><span class="annot"><a href="#local-6989586621679354555"><span class="hs-identifier hs-type">api</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasServer</span></span><span> </span><span class="annot"><a href="#local-6989586621679354555"><span class="hs-identifier hs-type">api</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679354555"><span class="hs-identifier hs-type">api</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerT</span></span><span> </span><span class="annot"><a href="#local-6989586621679354555"><span class="hs-identifier hs-type">api</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#Authed"><span class="hs-identifier hs-type">Authed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679354555"><span class="hs-identifier hs-type">api</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span>
</span><span id="line-561"></span><span id="hoistWithAuth"><span class="annot"><span class="annottext">hoistWithAuth :: forall api.
HasServer api '[] =&gt;
Proxy api
-&gt; Method -&gt; ServerT api Handler -&gt; ServerT (Authed api) Handler
</span><a href="Unison.Server.CodebaseServer.html#hoistWithAuth"><span class="hs-identifier hs-var hs-var">hoistWithAuth</span></a></span></span><span> </span><span id="local-6989586621679355948"><span class="annot"><span class="annottext">Proxy api
</span><a href="#local-6989586621679355948"><span class="hs-identifier hs-var">api</span></a></span></span><span> </span><span id="local-6989586621679355949"><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679355949"><span class="hs-identifier hs-var">expectedToken</span></a></span></span><span> </span><span id="local-6989586621679355950"><span class="annot"><span class="annottext">ServerT api Handler
</span><a href="#local-6989586621679355950"><span class="hs-identifier hs-var">server</span></a></span></span><span> </span><span id="local-6989586621679355951"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679355951"><span class="hs-identifier hs-var">token</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall api (m :: * -&gt; *) (n :: * -&gt; *).
HasServer api '[] =&gt;
Proxy api
-&gt; (forall x. m x -&gt; n x) -&gt; ServerT api m -&gt; ServerT api n
</span><span class="hs-identifier hs-var">hoistServer</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679354555"><span class="hs-identifier hs-type">api</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><span class="annottext">Proxy api
</span><a href="#local-6989586621679355948"><span class="hs-identifier hs-var">api</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679355953"><span class="annot"><span class="annottext">Handler x
</span><a href="#local-6989586621679355953"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Method -&gt; Text -&gt; Handler ()
</span><a href="Unison.Server.CodebaseServer.html#handleAuth"><span class="hs-identifier hs-var">handleAuth</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679355949"><span class="hs-identifier hs-var">expectedToken</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679355951"><span class="hs-identifier hs-var">token</span></a></span><span> </span><span class="annot"><span class="annottext">Handler () -&gt; Handler x -&gt; Handler x
forall a b. Handler a -&gt; Handler b -&gt; Handler b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Handler x
</span><a href="#local-6989586621679355953"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ServerT api Handler
</span><a href="#local-6989586621679355950"><span class="hs-identifier hs-var">server</span></a></span><span>
</span><span id="line-562"></span><span>
</span><span id="line-563"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveProjectsCodebaseServerAPI"><span class="hs-identifier hs-type">serveProjectsCodebaseServerAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-564"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-565"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-566"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ProjectName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-567"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-568"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ServerT</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#CodebaseServerAPI"><span class="hs-identifier hs-type">CodebaseServerAPI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span id="serveProjectsCodebaseServerAPI"><span class="annot"><span class="annottext">serveProjectsCodebaseServerAPI :: Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; ProjectName
-&gt; ProjectBranchName
-&gt; ServerT CodebaseServerAPI (Backend IO)
</span><a href="Unison.Server.CodebaseServer.html#serveProjectsCodebaseServerAPI"><span class="hs-identifier hs-var hs-var">serveProjectsCodebaseServerAPI</span></a></span></span><span> </span><span id="local-6989586621679355955"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355955"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679355956"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679355956"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679355957"><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679355957"><span class="hs-identifier hs-var">projectName</span></a></span></span><span> </span><span id="local-6989586621679355958"><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621679355958"><span class="hs-identifier hs-var">branchName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-570"></span><span>  </span><span class="annot"><span class="annottext">Maybe Path
-&gt; Maybe Path
-&gt; Backend
     IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing)
</span><a href="#local-6989586621679355959"><span class="hs-identifier hs-var">namespaceListingEndpoint</span></a></span><span>
</span><span id="line-571"></span><span>    </span><span class="annot"><span class="annottext">(Maybe Path
 -&gt; Maybe Path
 -&gt; Backend
      IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
-&gt; ((Path
     -&gt; Maybe Width
     -&gt; Backend
          IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
    :&lt;|&gt; ((Maybe Path
           -&gt; [HashQualified Name]
           -&gt; Maybe Width
           -&gt; Maybe Suffixify
           -&gt; Backend
                IO
                (Headers
                   '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
          :&lt;|&gt; ((Maybe Path
                 -&gt; Maybe Int
                 -&gt; Maybe Width
                 -&gt; Maybe String
                 -&gt; Backend
                      IO
                      (Headers
                         '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
                :&lt;|&gt; ((Referent
                       -&gt; Maybe Name
                       -&gt; Maybe Path
                       -&gt; Maybe Width
                       -&gt; Backend
                            IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
                      :&lt;|&gt; (Reference
                            -&gt; Maybe Name
                            -&gt; Maybe Path
                            -&gt; Maybe Width
                            -&gt; Backend
                                 IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary))))))
-&gt; (Maybe Path
    -&gt; Maybe Path
    -&gt; Backend
         IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
   :&lt;|&gt; ((Path
          -&gt; Maybe Width
          -&gt; Backend
               IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
         :&lt;|&gt; ((Maybe Path
                -&gt; [HashQualified Name]
                -&gt; Maybe Width
                -&gt; Maybe Suffixify
                -&gt; Backend
                     IO
                     (Headers
                        '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
               :&lt;|&gt; ((Maybe Path
                      -&gt; Maybe Int
                      -&gt; Maybe Width
                      -&gt; Maybe String
                      -&gt; Backend
                           IO
                           (Headers
                              '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
                     :&lt;|&gt; ((Referent
                            -&gt; Maybe Name
                            -&gt; Maybe Path
                            -&gt; Maybe Width
                            -&gt; Backend
                                 IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
                           :&lt;|&gt; (Reference
                                 -&gt; Maybe Name
                                 -&gt; Maybe Path
                                 -&gt; Maybe Width
                                 -&gt; Backend
                                      IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary))))))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Path
-&gt; Maybe Width
-&gt; Backend
     IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails)
</span><a href="#local-6989586621679355960"><span class="hs-identifier hs-var">namespaceDetailsEndpoint</span></a></span><span>
</span><span id="line-572"></span><span>    </span><span class="annot"><span class="annottext">(Path
 -&gt; Maybe Width
 -&gt; Backend
      IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
-&gt; ((Maybe Path
     -&gt; [HashQualified Name]
     -&gt; Maybe Width
     -&gt; Maybe Suffixify
     -&gt; Backend
          IO
          (Headers
             '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
    :&lt;|&gt; ((Maybe Path
           -&gt; Maybe Int
           -&gt; Maybe Width
           -&gt; Maybe String
           -&gt; Backend
                IO
                (Headers
                   '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
          :&lt;|&gt; ((Referent
                 -&gt; Maybe Name
                 -&gt; Maybe Path
                 -&gt; Maybe Width
                 -&gt; Backend
                      IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
                :&lt;|&gt; (Reference
                      -&gt; Maybe Name
                      -&gt; Maybe Path
                      -&gt; Maybe Width
                      -&gt; Backend
                           IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary)))))
-&gt; (Path
    -&gt; Maybe Width
    -&gt; Backend
         IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
   :&lt;|&gt; ((Maybe Path
          -&gt; [HashQualified Name]
          -&gt; Maybe Width
          -&gt; Maybe Suffixify
          -&gt; Backend
               IO
               (Headers
                  '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
         :&lt;|&gt; ((Maybe Path
                -&gt; Maybe Int
                -&gt; Maybe Width
                -&gt; Maybe String
                -&gt; Backend
                     IO
                     (Headers
                        '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
               :&lt;|&gt; ((Referent
                      -&gt; Maybe Name
                      -&gt; Maybe Path
                      -&gt; Maybe Width
                      -&gt; Backend
                           IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
                     :&lt;|&gt; (Reference
                           -&gt; Maybe Name
                           -&gt; Maybe Path
                           -&gt; Maybe Width
                           -&gt; Backend
                                IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary)))))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Path
-&gt; [HashQualified Name]
-&gt; Maybe Width
-&gt; Maybe Suffixify
-&gt; Backend
     IO
     (Headers '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults)
</span><a href="#local-6989586621679355961"><span class="hs-identifier hs-var">serveDefinitionsEndpoint</span></a></span><span>
</span><span id="line-573"></span><span>    </span><span class="annot"><span class="annottext">(Maybe Path
 -&gt; [HashQualified Name]
 -&gt; Maybe Width
 -&gt; Maybe Suffixify
 -&gt; Backend
      IO
      (Headers
         '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
-&gt; ((Maybe Path
     -&gt; Maybe Int
     -&gt; Maybe Width
     -&gt; Maybe String
     -&gt; Backend
          IO
          (Headers
             '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
    :&lt;|&gt; ((Referent
           -&gt; Maybe Name
           -&gt; Maybe Path
           -&gt; Maybe Width
           -&gt; Backend
                IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
          :&lt;|&gt; (Reference
                -&gt; Maybe Name
                -&gt; Maybe Path
                -&gt; Maybe Width
                -&gt; Backend
                     IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary))))
-&gt; (Maybe Path
    -&gt; [HashQualified Name]
    -&gt; Maybe Width
    -&gt; Maybe Suffixify
    -&gt; Backend
         IO
         (Headers
            '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
   :&lt;|&gt; ((Maybe Path
          -&gt; Maybe Int
          -&gt; Maybe Width
          -&gt; Maybe String
          -&gt; Backend
               IO
               (Headers
                  '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
         :&lt;|&gt; ((Referent
                -&gt; Maybe Name
                -&gt; Maybe Path
                -&gt; Maybe Width
                -&gt; Backend
                     IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
               :&lt;|&gt; (Reference
                     -&gt; Maybe Name
                     -&gt; Maybe Path
                     -&gt; Maybe Width
                     -&gt; Backend
                          IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary))))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Path
-&gt; Maybe Int
-&gt; Maybe Width
-&gt; Maybe String
-&gt; Backend
     IO
     (Headers
        '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)])
</span><a href="#local-6989586621679355962"><span class="hs-identifier hs-var">serveFuzzyFindEndpoint</span></a></span><span>
</span><span id="line-574"></span><span>    </span><span class="annot"><span class="annottext">(Maybe Path
 -&gt; Maybe Int
 -&gt; Maybe Width
 -&gt; Maybe String
 -&gt; Backend
      IO
      (Headers
         '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
-&gt; ((Referent
     -&gt; Maybe Name
     -&gt; Maybe Path
     -&gt; Maybe Width
     -&gt; Backend
          IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
    :&lt;|&gt; (Reference
          -&gt; Maybe Name
          -&gt; Maybe Path
          -&gt; Maybe Width
          -&gt; Backend
               IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary)))
-&gt; (Maybe Path
    -&gt; Maybe Int
    -&gt; Maybe Width
    -&gt; Maybe String
    -&gt; Backend
         IO
         (Headers
            '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
   :&lt;|&gt; ((Referent
          -&gt; Maybe Name
          -&gt; Maybe Path
          -&gt; Maybe Width
          -&gt; Backend
               IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
         :&lt;|&gt; (Reference
               -&gt; Maybe Name
               -&gt; Maybe Path
               -&gt; Maybe Width
               -&gt; Backend
                    IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary)))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Referent
-&gt; Maybe Name
-&gt; Maybe Path
-&gt; Maybe Width
-&gt; Backend
     IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary)
</span><a href="#local-6989586621679355963"><span class="hs-identifier hs-var">serveTermSummaryEndpoint</span></a></span><span>
</span><span id="line-575"></span><span>    </span><span class="annot"><span class="annottext">(Referent
 -&gt; Maybe Name
 -&gt; Maybe Path
 -&gt; Maybe Width
 -&gt; Backend
      IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
-&gt; (Reference
    -&gt; Maybe Name
    -&gt; Maybe Path
    -&gt; Maybe Width
    -&gt; Backend
         IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary))
-&gt; (Referent
    -&gt; Maybe Name
    -&gt; Maybe Path
    -&gt; Maybe Width
    -&gt; Backend
         IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
   :&lt;|&gt; (Reference
         -&gt; Maybe Name
         -&gt; Maybe Path
         -&gt; Maybe Width
         -&gt; Backend
              IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Reference
-&gt; Maybe Name
-&gt; Maybe Path
-&gt; Maybe Width
-&gt; Backend
     IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary)
</span><a href="#local-6989586621679355964"><span class="hs-identifier hs-var">serveTypeSummaryEndpoint</span></a></span><span>
</span><span id="line-576"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-577"></span><span>    </span><span id="local-6989586621679355965"><span class="annot"><span class="annottext">projectAndBranchName :: ProjectAndBranch ProjectName ProjectBranchName
</span><a href="#local-6989586621679355965"><span class="hs-identifier hs-var hs-var">projectAndBranchName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProjectName
-&gt; ProjectBranchName
-&gt; ProjectAndBranch ProjectName ProjectBranchName
forall a b. a -&gt; b -&gt; ProjectAndBranch a b
</span><span class="hs-identifier hs-var">ProjectAndBranch</span></span><span> </span><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679355957"><span class="hs-identifier hs-var">projectName</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621679355958"><span class="hs-identifier hs-var">branchName</span></a></span><span>
</span><span id="line-578"></span><span>    </span><span id="local-6989586621679355959"><span class="annot"><span class="annottext">namespaceListingEndpoint :: Maybe Path
-&gt; Maybe Path
-&gt; Backend
     IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing)
</span><a href="#local-6989586621679355959"><span class="hs-identifier hs-var hs-var">namespaceListingEndpoint</span></a></span></span><span> </span><span id="local-6989586621679355966"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679355966"><span class="hs-identifier hs-var">rel</span></a></span></span><span> </span><span id="local-6989586621679355967"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679355967"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-579"></span><span>      </span><span id="local-6989586621679355968"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679355968"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; ProjectAndBranch ProjectName ProjectBranchName
-&gt; Backend IO CausalHash
forall v a.
Codebase IO v a
-&gt; ProjectAndBranch ProjectName ProjectBranchName
-&gt; Backend IO CausalHash
</span><a href="Unison.Server.CodebaseServer.html#resolveProjectRootHash"><span class="hs-identifier hs-var">resolveProjectRootHash</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355955"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch ProjectName ProjectBranchName
</span><a href="#local-6989586621679355965"><span class="hs-identifier hs-var">projectAndBranchName</span></a></span><span>
</span><span id="line-580"></span><span>      </span><span class="annot"><span class="annottext">NamespaceListing
-&gt; Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing
forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">(NamespaceListing
 -&gt; Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing)
-&gt; Backend IO NamespaceListing
-&gt; Backend
     IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Either ShortCausalHash CausalHash
-&gt; Maybe Path
-&gt; Maybe Path
-&gt; Backend IO NamespaceListing
</span><a href="Unison.Server.Local.Endpoints.NamespaceListing.html#serve"><span class="hs-identifier hs-var">NamespaceListing.serve</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355955"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalHash -&gt; Either ShortCausalHash CausalHash
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(CausalHash -&gt; Either ShortCausalHash CausalHash)
-&gt; CausalHash -&gt; Either ShortCausalHash CausalHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679355968"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679355966"><span class="hs-identifier hs-var">rel</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679355967"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-581"></span><span>    </span><span id="local-6989586621679355960"><span class="annot"><span class="annottext">namespaceDetailsEndpoint :: Path
-&gt; Maybe Width
-&gt; Backend
     IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails)
</span><a href="#local-6989586621679355960"><span class="hs-identifier hs-var hs-var">namespaceDetailsEndpoint</span></a></span></span><span> </span><span id="local-6989586621679355971"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679355971"><span class="hs-identifier hs-var">namespaceName</span></a></span></span><span> </span><span id="local-6989586621679355972"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679355972"><span class="hs-identifier hs-var">renderWidth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-582"></span><span>      </span><span id="local-6989586621679355973"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679355973"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; ProjectAndBranch ProjectName ProjectBranchName
-&gt; Backend IO CausalHash
forall v a.
Codebase IO v a
-&gt; ProjectAndBranch ProjectName ProjectBranchName
-&gt; Backend IO CausalHash
</span><a href="Unison.Server.CodebaseServer.html#resolveProjectRootHash"><span class="hs-identifier hs-var">resolveProjectRootHash</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355955"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch ProjectName ProjectBranchName
</span><a href="#local-6989586621679355965"><span class="hs-identifier hs-var">projectAndBranchName</span></a></span><span>
</span><span id="line-583"></span><span>      </span><span class="annot"><span class="annottext">NamespaceDetails
-&gt; Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails
forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">(NamespaceDetails
 -&gt; Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails)
-&gt; Backend IO NamespaceDetails
-&gt; Backend
     IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; Path
-&gt; Either ShortCausalHash CausalHash
-&gt; Maybe Width
-&gt; Backend IO NamespaceDetails
</span><a href="Unison.Server.Local.Endpoints.NamespaceDetails.html#namespaceDetails"><span class="hs-identifier hs-var">NamespaceDetails.namespaceDetails</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679355956"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355955"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679355971"><span class="hs-identifier hs-var">namespaceName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalHash -&gt; Either ShortCausalHash CausalHash
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(CausalHash -&gt; Either ShortCausalHash CausalHash)
-&gt; CausalHash -&gt; Either ShortCausalHash CausalHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679355973"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679355972"><span class="hs-identifier hs-var">renderWidth</span></a></span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span>    </span><span id="local-6989586621679355961"><span class="annot"><span class="annottext">serveDefinitionsEndpoint :: Maybe Path
-&gt; [HashQualified Name]
-&gt; Maybe Width
-&gt; Maybe Suffixify
-&gt; Backend
     IO
     (Headers '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults)
</span><a href="#local-6989586621679355961"><span class="hs-identifier hs-var hs-var">serveDefinitionsEndpoint</span></a></span></span><span> </span><span id="local-6989586621679355975"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679355975"><span class="hs-identifier hs-var">relativePath</span></a></span></span><span> </span><span id="local-6989586621679355976"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679355976"><span class="hs-identifier hs-var">rawHqns</span></a></span></span><span> </span><span id="local-6989586621679355977"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679355977"><span class="hs-identifier hs-var">renderWidth</span></a></span></span><span> </span><span id="local-6989586621679355978"><span class="annot"><span class="annottext">Maybe Suffixify
</span><a href="#local-6989586621679355978"><span class="hs-identifier hs-var">suff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-586"></span><span>      </span><span id="local-6989586621679355979"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679355979"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; ProjectAndBranch ProjectName ProjectBranchName
-&gt; Backend IO CausalHash
forall v a.
Codebase IO v a
-&gt; ProjectAndBranch ProjectName ProjectBranchName
-&gt; Backend IO CausalHash
</span><a href="Unison.Server.CodebaseServer.html#resolveProjectRootHash"><span class="hs-identifier hs-var">resolveProjectRootHash</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355955"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch ProjectName ProjectBranchName
</span><a href="#local-6989586621679355965"><span class="hs-identifier hs-var">projectAndBranchName</span></a></span><span>
</span><span id="line-587"></span><span>      </span><span class="annot"><span class="annottext">DefinitionDisplayResults
-&gt; Headers
     '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults
forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">(DefinitionDisplayResults
 -&gt; Headers
      '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults)
-&gt; Backend IO DefinitionDisplayResults
-&gt; Backend
     IO
     (Headers '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; Either ShortCausalHash CausalHash
-&gt; Maybe Path
-&gt; [HashQualified Name]
-&gt; Maybe Width
-&gt; Maybe Suffixify
-&gt; Backend IO DefinitionDisplayResults
</span><a href="Unison.Server.Local.Endpoints.GetDefinitions.html#serveDefinitions"><span class="hs-identifier hs-var">serveDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679355956"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355955"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalHash -&gt; Either ShortCausalHash CausalHash
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(CausalHash -&gt; Either ShortCausalHash CausalHash)
-&gt; CausalHash -&gt; Either ShortCausalHash CausalHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679355979"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679355975"><span class="hs-identifier hs-var">relativePath</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679355976"><span class="hs-identifier hs-var">rawHqns</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679355977"><span class="hs-identifier hs-var">renderWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Suffixify
</span><a href="#local-6989586621679355978"><span class="hs-identifier hs-var">suff</span></a></span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span>    </span><span id="local-6989586621679355962"><span class="annot"><span class="annottext">serveFuzzyFindEndpoint :: Maybe Path
-&gt; Maybe Int
-&gt; Maybe Width
-&gt; Maybe String
-&gt; Backend
     IO
     (Headers
        '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)])
</span><a href="#local-6989586621679355962"><span class="hs-identifier hs-var hs-var">serveFuzzyFindEndpoint</span></a></span></span><span> </span><span id="local-6989586621679355980"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679355980"><span class="hs-identifier hs-var">relativePath</span></a></span></span><span> </span><span id="local-6989586621679355981"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679355981"><span class="hs-identifier hs-var">limit</span></a></span></span><span> </span><span id="local-6989586621679355982"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679355982"><span class="hs-identifier hs-var">renderWidth</span></a></span></span><span> </span><span id="local-6989586621679355983"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679355983"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-590"></span><span>      </span><span id="local-6989586621679355984"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679355984"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; ProjectAndBranch ProjectName ProjectBranchName
-&gt; Backend IO CausalHash
forall v a.
Codebase IO v a
-&gt; ProjectAndBranch ProjectName ProjectBranchName
-&gt; Backend IO CausalHash
</span><a href="Unison.Server.CodebaseServer.html#resolveProjectRootHash"><span class="hs-identifier hs-var">resolveProjectRootHash</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355955"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch ProjectName ProjectBranchName
</span><a href="#local-6989586621679355965"><span class="hs-identifier hs-var">projectAndBranchName</span></a></span><span>
</span><span id="line-591"></span><span>      </span><span class="annot"><span class="annottext">[(Alignment, FoundResult)]
-&gt; Headers
     '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]
forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">([(Alignment, FoundResult)]
 -&gt; Headers
      '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)])
-&gt; Backend IO [(Alignment, FoundResult)]
-&gt; Backend
     IO
     (Headers
        '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Either ShortCausalHash CausalHash
-&gt; Maybe Path
-&gt; Maybe Int
-&gt; Maybe Width
-&gt; Maybe String
-&gt; Backend IO [(Alignment, FoundResult)]
forall (m :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann
-&gt; Either ShortCausalHash CausalHash
-&gt; Maybe Path
-&gt; Maybe Int
-&gt; Maybe Width
-&gt; Maybe String
-&gt; Backend m [(Alignment, FoundResult)]
</span><a href="Unison.Server.Local.Endpoints.FuzzyFind.html#serveFuzzyFind"><span class="hs-identifier hs-var">serveFuzzyFind</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355955"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalHash -&gt; Either ShortCausalHash CausalHash
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(CausalHash -&gt; Either ShortCausalHash CausalHash)
-&gt; CausalHash -&gt; Either ShortCausalHash CausalHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679355984"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679355980"><span class="hs-identifier hs-var">relativePath</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679355981"><span class="hs-identifier hs-var">limit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679355982"><span class="hs-identifier hs-var">renderWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679355983"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-592"></span><span>
</span><span id="line-593"></span><span>    </span><span id="local-6989586621679355963"><span class="annot"><span class="annottext">serveTermSummaryEndpoint :: Referent
-&gt; Maybe Name
-&gt; Maybe Path
-&gt; Maybe Width
-&gt; Backend
     IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary)
</span><a href="#local-6989586621679355963"><span class="hs-identifier hs-var hs-var">serveTermSummaryEndpoint</span></a></span></span><span> </span><span id="local-6989586621679355985"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679355985"><span class="hs-identifier hs-var">shortHash</span></a></span></span><span> </span><span id="local-6989586621679355986"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679355986"><span class="hs-identifier hs-var">mayName</span></a></span></span><span> </span><span id="local-6989586621679355987"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679355987"><span class="hs-identifier hs-var">relativeTo</span></a></span></span><span> </span><span id="local-6989586621679355988"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679355988"><span class="hs-identifier hs-var">renderWidth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-594"></span><span>      </span><span id="local-6989586621679355989"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679355989"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; ProjectAndBranch ProjectName ProjectBranchName
-&gt; Backend IO CausalHash
forall v a.
Codebase IO v a
-&gt; ProjectAndBranch ProjectName ProjectBranchName
-&gt; Backend IO CausalHash
</span><a href="Unison.Server.CodebaseServer.html#resolveProjectRootHash"><span class="hs-identifier hs-var">resolveProjectRootHash</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355955"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch ProjectName ProjectBranchName
</span><a href="#local-6989586621679355965"><span class="hs-identifier hs-var">projectAndBranchName</span></a></span><span>
</span><span id="line-595"></span><span>      </span><span class="annot"><span class="annottext">TermSummary -&gt; Headers '[Header &quot;Cache-Control&quot; String] TermSummary
forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">(TermSummary
 -&gt; Headers '[Header &quot;Cache-Control&quot; String] TermSummary)
-&gt; Backend IO TermSummary
-&gt; Backend
     IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Referent
-&gt; Maybe Name
-&gt; Either ShortCausalHash CausalHash
-&gt; Maybe Path
-&gt; Maybe Width
-&gt; Backend IO TermSummary
</span><a href="Unison.Server.Local.Endpoints.DefinitionSummary.html#serveTermSummary"><span class="hs-identifier hs-var">serveTermSummary</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355955"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679355985"><span class="hs-identifier hs-var">shortHash</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679355986"><span class="hs-identifier hs-var">mayName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalHash -&gt; Either ShortCausalHash CausalHash
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(CausalHash -&gt; Either ShortCausalHash CausalHash)
-&gt; CausalHash -&gt; Either ShortCausalHash CausalHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679355989"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679355987"><span class="hs-identifier hs-var">relativeTo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679355988"><span class="hs-identifier hs-var">renderWidth</span></a></span><span>
</span><span id="line-596"></span><span>
</span><span id="line-597"></span><span>    </span><span id="local-6989586621679355964"><span class="annot"><span class="annottext">serveTypeSummaryEndpoint :: Reference
-&gt; Maybe Name
-&gt; Maybe Path
-&gt; Maybe Width
-&gt; Backend
     IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary)
</span><a href="#local-6989586621679355964"><span class="hs-identifier hs-var hs-var">serveTypeSummaryEndpoint</span></a></span></span><span> </span><span id="local-6989586621679355990"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679355990"><span class="hs-identifier hs-var">shortHash</span></a></span></span><span> </span><span id="local-6989586621679355991"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679355991"><span class="hs-identifier hs-var">mayName</span></a></span></span><span> </span><span id="local-6989586621679355992"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679355992"><span class="hs-identifier hs-var">relativeTo</span></a></span></span><span> </span><span id="local-6989586621679355993"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679355993"><span class="hs-identifier hs-var">renderWidth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-598"></span><span>      </span><span id="local-6989586621679355994"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679355994"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; ProjectAndBranch ProjectName ProjectBranchName
-&gt; Backend IO CausalHash
forall v a.
Codebase IO v a
-&gt; ProjectAndBranch ProjectName ProjectBranchName
-&gt; Backend IO CausalHash
</span><a href="Unison.Server.CodebaseServer.html#resolveProjectRootHash"><span class="hs-identifier hs-var">resolveProjectRootHash</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355955"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch ProjectName ProjectBranchName
</span><a href="#local-6989586621679355965"><span class="hs-identifier hs-var">projectAndBranchName</span></a></span><span>
</span><span id="line-599"></span><span>      </span><span class="annot"><span class="annottext">TypeSummary -&gt; Headers '[Header &quot;Cache-Control&quot; String] TypeSummary
forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeSummary
 -&gt; Headers '[Header &quot;Cache-Control&quot; String] TypeSummary)
-&gt; Backend IO TypeSummary
-&gt; Backend
     IO (Headers '[Header &quot;Cache-Control&quot; String] TypeSummary)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Reference
-&gt; Maybe Name
-&gt; Either ShortCausalHash CausalHash
-&gt; Maybe Path
-&gt; Maybe Width
-&gt; Backend IO TypeSummary
</span><a href="Unison.Server.Local.Endpoints.DefinitionSummary.html#serveTypeSummary"><span class="hs-identifier hs-var">serveTypeSummary</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679355955"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679355990"><span class="hs-identifier hs-var">shortHash</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679355991"><span class="hs-identifier hs-var">mayName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalHash -&gt; Either ShortCausalHash CausalHash
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(CausalHash -&gt; Either ShortCausalHash CausalHash)
-&gt; CausalHash -&gt; Either ShortCausalHash CausalHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679355994"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679355992"><span class="hs-identifier hs-var">relativeTo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679355993"><span class="hs-identifier hs-var">renderWidth</span></a></span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span id="local-6989586621679354580"><span id="local-6989586621679354581"><span class="annot"><a href="Unison.Server.CodebaseServer.html#resolveProjectRoot"><span class="hs-identifier hs-type">resolveProjectRoot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679354580"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679354581"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ProjectAndBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectName</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchName</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2.CausalBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-602"></span><span id="resolveProjectRoot"><span class="annot"><span class="annottext">resolveProjectRoot :: forall v a.
Codebase IO v a
-&gt; ProjectAndBranch ProjectName ProjectBranchName
-&gt; Backend IO (CausalBranch Transaction)
</span><a href="Unison.Server.CodebaseServer.html#resolveProjectRoot"><span class="hs-identifier hs-var hs-var">resolveProjectRoot</span></a></span></span><span> </span><span id="local-6989586621679356002"><span class="annot"><span class="annottext">Codebase IO v a
</span><a href="#local-6989586621679356002"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679356003"><span class="annot"><span class="annottext">projectAndBranchName :: ProjectAndBranch ProjectName ProjectBranchName
</span><a href="#local-6989586621679356003"><span class="hs-identifier hs-var">projectAndBranchName</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ProjectAndBranch</span></span><span> </span><span id="local-6989586621679356004"><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679356004"><span class="hs-identifier hs-var">projectName</span></a></span></span><span> </span><span id="local-6989586621679356005"><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621679356005"><span class="hs-identifier hs-var">branchName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-603"></span><span>  </span><span id="local-6989586621679356006"><span class="annot"><span class="annottext">Maybe (CausalBranch Transaction)
</span><a href="#local-6989586621679356006"><span class="hs-identifier hs-var">mayCB</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe (CausalBranch Transaction))
-&gt; Backend IO (Maybe (CausalBranch Transaction))
forall a. IO a -&gt; Backend IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe (CausalBranch Transaction))
 -&gt; Backend IO (Maybe (CausalBranch Transaction)))
-&gt; (Transaction (Maybe (CausalBranch Transaction))
    -&gt; IO (Maybe (CausalBranch Transaction)))
-&gt; Transaction (Maybe (CausalBranch Transaction))
-&gt; Backend IO (Maybe (CausalBranch Transaction))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v a
-&gt; Transaction (Maybe (CausalBranch Transaction))
-&gt; IO (Maybe (CausalBranch Transaction))
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v a
</span><a href="#local-6989586621679356002"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">(Transaction (Maybe (CausalBranch Transaction))
 -&gt; Backend IO (Maybe (CausalBranch Transaction)))
-&gt; Transaction (Maybe (CausalBranch Transaction))
-&gt; Backend IO (Maybe (CausalBranch Transaction))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch ProjectName ProjectBranchName
-&gt; Transaction (Maybe (CausalBranch Transaction))
</span><span class="hs-identifier hs-var">Codebase.getShallowProjectRootByNames</span></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch ProjectName ProjectBranchName
</span><a href="#local-6989586621679356003"><span class="hs-identifier hs-var">projectAndBranchName</span></a></span><span>
</span><span id="line-604"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (CausalBranch Transaction)
</span><a href="#local-6989586621679356006"><span class="hs-identifier hs-var">mayCB</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-605"></span><span>    </span><span class="annot"><span class="annottext">Maybe (CausalBranch Transaction)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BackendError -&gt; Backend IO (CausalBranch Transaction)
forall a. BackendError -&gt; Backend IO a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjectName -&gt; ProjectBranchName -&gt; BackendError
</span><a href="Unison.Server.Backend.html#ProjectBranchNameNotFound"><span class="hs-identifier hs-var">Backend.ProjectBranchNameNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679356004"><span class="hs-identifier hs-var">projectName</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621679356005"><span class="hs-identifier hs-var">branchName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679356010"><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679356010"><span class="hs-identifier hs-var">cb</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction -&gt; Backend IO (CausalBranch Transaction)
forall a. a -&gt; Backend IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679356010"><span class="hs-identifier hs-var">cb</span></a></span><span>
</span><span id="line-607"></span><span>
</span><span id="line-608"></span><span id="local-6989586621679354573"><span id="local-6989586621679354574"><span class="annot"><a href="Unison.Server.CodebaseServer.html#resolveProjectRootHash"><span class="hs-identifier hs-type">resolveProjectRootHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679354573"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679354574"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ProjectAndBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectName</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchName</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span></span></span><span>
</span><span id="line-609"></span><span id="resolveProjectRootHash"><span class="annot"><span class="annottext">resolveProjectRootHash :: forall v a.
Codebase IO v a
-&gt; ProjectAndBranch ProjectName ProjectBranchName
-&gt; Backend IO CausalHash
</span><a href="Unison.Server.CodebaseServer.html#resolveProjectRootHash"><span class="hs-identifier hs-var hs-var">resolveProjectRootHash</span></a></span></span><span> </span><span id="local-6989586621679356012"><span class="annot"><span class="annottext">Codebase IO v a
</span><a href="#local-6989586621679356012"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679356013"><span class="annot"><span class="annottext">ProjectAndBranch ProjectName ProjectBranchName
</span><a href="#local-6989586621679356013"><span class="hs-identifier hs-var">projectAndBranchName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-610"></span><span>  </span><span class="annot"><span class="annottext">Codebase IO v a
-&gt; ProjectAndBranch ProjectName ProjectBranchName
-&gt; Backend IO (CausalBranch Transaction)
forall v a.
Codebase IO v a
-&gt; ProjectAndBranch ProjectName ProjectBranchName
-&gt; Backend IO (CausalBranch Transaction)
</span><a href="Unison.Server.CodebaseServer.html#resolveProjectRoot"><span class="hs-identifier hs-var">resolveProjectRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v a
</span><a href="#local-6989586621679356012"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch ProjectName ProjectBranchName
</span><a href="#local-6989586621679356013"><span class="hs-identifier hs-var">projectAndBranchName</span></a></span><span> </span><span class="annot"><span class="annottext">Backend IO (CausalBranch Transaction)
-&gt; (CausalBranch Transaction -&gt; CausalHash)
-&gt; Backend IO CausalHash
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction -&gt; CausalHash
forall (m :: * -&gt; *) hc he pe e. Causal m hc he pe e -&gt; hc
</span><span class="hs-identifier hs-var">Causal.causalHash</span></span><span>
</span><span id="line-611"></span><span>
</span><span id="line-612"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveProjectDiffTermsEndpoint"><span class="hs-identifier hs-type">serveProjectDiffTermsEndpoint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TermDiffResponse"><span class="hs-identifier hs-type">TermDiffResponse</span></a></span><span>
</span><span id="line-613"></span><span id="serveProjectDiffTermsEndpoint"><span class="annot"><span class="annottext">serveProjectDiffTermsEndpoint :: Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; ProjectName
-&gt; ProjectBranchName
-&gt; ProjectBranchName
-&gt; Name
-&gt; Name
-&gt; Backend IO TermDiffResponse
</span><a href="Unison.Server.CodebaseServer.html#serveProjectDiffTermsEndpoint"><span class="hs-identifier hs-var hs-var">serveProjectDiffTermsEndpoint</span></a></span></span><span> </span><span id="local-6989586621679356017"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679356017"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679356018"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679356018"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679356019"><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679356019"><span class="hs-identifier hs-var">projectName</span></a></span></span><span> </span><span id="local-6989586621679356020"><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621679356020"><span class="hs-identifier hs-var">oldBranchRef</span></a></span></span><span> </span><span id="local-6989586621679356021"><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621679356021"><span class="hs-identifier hs-var">newBranchRef</span></a></span></span><span> </span><span id="local-6989586621679356022"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679356022"><span class="hs-identifier hs-var">oldTerm</span></a></span></span><span> </span><span id="local-6989586621679356023"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679356023"><span class="hs-identifier hs-var">newTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-614"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679356024"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679356024"><span class="hs-identifier hs-var">oldPPED</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679356025"><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679356025"><span class="hs-identifier hs-var">oldNameSearch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; ProjectName
-&gt; ProjectBranchName
-&gt; Backend IO (PrettyPrintEnvDecl, NameSearch Transaction)
forall v a.
Codebase IO v a
-&gt; ProjectName
-&gt; ProjectBranchName
-&gt; Backend IO (PrettyPrintEnvDecl, NameSearch Transaction)
</span><a href="Unison.Server.CodebaseServer.html#contextForProjectBranch"><span class="hs-identifier hs-var">contextForProjectBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679356017"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679356019"><span class="hs-identifier hs-var">projectName</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621679356020"><span class="hs-identifier hs-var">oldBranchRef</span></a></span><span>
</span><span id="line-615"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679356027"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679356027"><span class="hs-identifier hs-var">newPPED</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679356028"><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679356028"><span class="hs-identifier hs-var">newNameSearch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; ProjectName
-&gt; ProjectBranchName
-&gt; Backend IO (PrettyPrintEnvDecl, NameSearch Transaction)
forall v a.
Codebase IO v a
-&gt; ProjectName
-&gt; ProjectBranchName
-&gt; Backend IO (PrettyPrintEnvDecl, NameSearch Transaction)
</span><a href="Unison.Server.CodebaseServer.html#contextForProjectBranch"><span class="hs-identifier hs-var">contextForProjectBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679356017"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679356019"><span class="hs-identifier hs-var">projectName</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621679356021"><span class="hs-identifier hs-var">newBranchRef</span></a></span><span>
</span><span id="line-616"></span><span>  </span><span id="local-6989586621679356029"><span class="annot"><span class="annottext">oldTerm :: TermDefinition
</span><a href="#local-6989586621679356029"><span class="hs-identifier hs-var">oldTerm</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Unison.Server.Types.html#TermDefinition"><span class="hs-identifier hs-type">TermDefinition</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:termDefinition:TermDefinition :: TermDefinition -&gt; DisplayObject SyntaxText SyntaxText
</span><a href="Unison.Server.Types.html#%24sel%3AtermDefinition%3ATermDefinition"><span class="hs-identifier hs-var">termDefinition</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679356032"><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
</span><a href="#local-6989586621679356032"><span class="hs-identifier hs-var">oldTermDispObject</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; PrettyPrintEnvDecl
-&gt; NameSearch Transaction
-&gt; Width
-&gt; Runtime Symbol
-&gt; Name
-&gt; Backend IO (Maybe TermDefinition)
</span><a href="Unison.Server.Local.Definitions.html#termDefinitionByName"><span class="hs-identifier hs-var">Defn.termDefinitionByName</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679356017"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679356024"><span class="hs-identifier hs-var">oldPPED</span></a></span><span> </span><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679356025"><span class="hs-identifier hs-var">oldNameSearch</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679356034"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679356018"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679356022"><span class="hs-identifier hs-var">oldTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Backend IO (Maybe TermDefinition)
-&gt; Backend IO TermDefinition -&gt; Backend IO TermDefinition
forall (m :: * -&gt; *) a. Monad m =&gt; m (Maybe a) -&gt; m a -&gt; m a
</span><span class="hs-operator hs-var">`whenNothingM`</span></span><span> </span><span class="annot"><span class="annottext">BackendError -&gt; Backend IO TermDefinition
forall a. BackendError -&gt; Backend IO a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; BackendError
</span><a href="Unison.Server.Backend.html#NoSuchDefinition"><span class="hs-identifier hs-var">Backend.NoSuchDefinition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; HashQualified Name
forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.NameOnly</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679356022"><span class="hs-identifier hs-var">oldTerm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span>  </span><span id="local-6989586621679356037"><span class="annot"><span class="annottext">newTerm :: TermDefinition
</span><a href="#local-6989586621679356037"><span class="hs-identifier hs-var">newTerm</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Unison.Server.Types.html#TermDefinition"><span class="hs-identifier hs-type">TermDefinition</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:termDefinition:TermDefinition :: TermDefinition -&gt; DisplayObject SyntaxText SyntaxText
</span><a href="Unison.Server.Types.html#%24sel%3AtermDefinition%3ATermDefinition"><span class="hs-identifier hs-var">termDefinition</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679356038"><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
</span><a href="#local-6989586621679356038"><span class="hs-identifier hs-var">newTermDisplayObj</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; PrettyPrintEnvDecl
-&gt; NameSearch Transaction
-&gt; Width
-&gt; Runtime Symbol
-&gt; Name
-&gt; Backend IO (Maybe TermDefinition)
</span><a href="Unison.Server.Local.Definitions.html#termDefinitionByName"><span class="hs-identifier hs-var">Defn.termDefinitionByName</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679356017"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679356027"><span class="hs-identifier hs-var">newPPED</span></a></span><span> </span><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679356028"><span class="hs-identifier hs-var">newNameSearch</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679356034"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679356018"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679356023"><span class="hs-identifier hs-var">newTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Backend IO (Maybe TermDefinition)
-&gt; Backend IO TermDefinition -&gt; Backend IO TermDefinition
forall (m :: * -&gt; *) a. Monad m =&gt; m (Maybe a) -&gt; m a -&gt; m a
</span><span class="hs-operator hs-var">`whenNothingM`</span></span><span> </span><span class="annot"><span class="annottext">BackendError -&gt; Backend IO TermDefinition
forall a. BackendError -&gt; Backend IO a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; BackendError
</span><a href="Unison.Server.Backend.html#NoSuchDefinition"><span class="hs-identifier hs-var">Backend.NoSuchDefinition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; HashQualified Name
forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.NameOnly</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679356023"><span class="hs-identifier hs-var">newTerm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679356039"><span class="annot"><span class="annottext">termDiffDisplayObject :: DisplayObjectDiff
</span><a href="#local-6989586621679356039"><span class="hs-identifier hs-var hs-var">termDiffDisplayObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt;
DisplayObject SyntaxText SyntaxText
-&gt; DisplayObject SyntaxText SyntaxText -&gt; DisplayObjectDiff
DisplayObject SyntaxText SyntaxText
-&gt; DisplayObject SyntaxText SyntaxText -&gt; DisplayObjectDiff
</span><a href="Unison.Server.Backend.DefinitionDiff.html#diffDisplayObjects"><span class="hs-identifier hs-var">DefinitionDiff.diffDisplayObjects</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
</span><a href="#local-6989586621679356032"><span class="hs-identifier hs-var">oldTermDispObject</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
</span><a href="#local-6989586621679356038"><span class="hs-identifier hs-var">newTermDisplayObj</span></a></span><span>
</span><span id="line-619"></span><span>  </span><span class="annot"><span class="annottext">TermDiffResponse -&gt; Backend IO TermDiffResponse
forall a. a -&gt; Backend IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-620"></span><span>    </span><span class="annot"><a href="Unison.Server.Types.html#TermDiffResponse"><span class="hs-identifier hs-type">TermDiffResponse</span></a></span><span>
</span><span id="line-621"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:project:TermDiffResponse :: ProjectName
</span><a href="Unison.Server.Types.html#%24sel%3Aproject%3ATermDiffResponse"><span class="hs-identifier hs-var">project</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679356019"><span class="hs-identifier hs-var">projectName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-622"></span><span>        </span><span class="annot"><span class="annottext">$sel:oldBranch:TermDiffResponse :: ProjectBranchName
</span><a href="Unison.Server.Types.html#%24sel%3AoldBranch%3ATermDiffResponse"><span class="hs-identifier hs-var">oldBranch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621679356020"><span class="hs-identifier hs-var">oldBranchRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-623"></span><span>        </span><span class="annot"><span class="annottext">$sel:newBranch:TermDiffResponse :: ProjectBranchName
</span><a href="Unison.Server.Types.html#%24sel%3AnewBranch%3ATermDiffResponse"><span class="hs-identifier hs-var">newBranch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621679356021"><span class="hs-identifier hs-var">newBranchRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-624"></span><span>        </span><span class="annot"><span class="annottext">$sel:oldTerm:TermDiffResponse :: TermDefinition
</span><a href="Unison.Server.Types.html#%24sel%3AoldTerm%3ATermDiffResponse"><span class="hs-identifier hs-var">oldTerm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermDefinition
</span><a href="#local-6989586621679356029"><span class="hs-identifier hs-var">oldTerm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-625"></span><span>        </span><span class="annot"><span class="annottext">$sel:newTerm:TermDiffResponse :: TermDefinition
</span><a href="Unison.Server.Types.html#%24sel%3AnewTerm%3ATermDiffResponse"><span class="hs-identifier hs-var">newTerm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermDefinition
</span><a href="#local-6989586621679356037"><span class="hs-identifier hs-var">newTerm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-626"></span><span>        </span><span class="annot"><span class="annottext">$sel:diff:TermDiffResponse :: DisplayObjectDiff
</span><a href="Unison.Server.Types.html#%24sel%3Adiff%3ATermDiffResponse"><span class="hs-identifier hs-var">diff</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DisplayObjectDiff
</span><a href="#local-6989586621679356039"><span class="hs-identifier hs-var">termDiffDisplayObject</span></a></span><span>
</span><span id="line-627"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-628"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-629"></span><span>    </span><span id="local-6989586621679356034"><span class="annot"><span class="annottext">width :: Width
</span><a href="#local-6989586621679356034"><span class="hs-identifier hs-var hs-var">width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Width
</span><span class="hs-identifier hs-var">Pretty.Width</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">80</span></span><span>
</span><span id="line-630"></span><span>
</span><span id="line-631"></span><span id="local-6989586621679354604"><span id="local-6989586621679354605"><span class="annot"><a href="Unison.Server.CodebaseServer.html#contextForProjectBranch"><span class="hs-identifier hs-type">contextForProjectBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679354604"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679354605"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PrettyPrintEnvDecl</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.html#NameSearch"><span class="hs-identifier hs-type">NameSearch</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-632"></span><span id="contextForProjectBranch"><span class="annot"><span class="annottext">contextForProjectBranch :: forall v a.
Codebase IO v a
-&gt; ProjectName
-&gt; ProjectBranchName
-&gt; Backend IO (PrettyPrintEnvDecl, NameSearch Transaction)
</span><a href="Unison.Server.CodebaseServer.html#contextForProjectBranch"><span class="hs-identifier hs-var hs-var">contextForProjectBranch</span></a></span></span><span> </span><span id="local-6989586621679356059"><span class="annot"><span class="annottext">Codebase IO v a
</span><a href="#local-6989586621679356059"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679356060"><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679356060"><span class="hs-identifier hs-var">projectName</span></a></span></span><span> </span><span id="local-6989586621679356061"><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621679356061"><span class="hs-identifier hs-var">branchName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-633"></span><span>  </span><span id="local-6989586621679356062"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679356062"><span class="hs-identifier hs-var">projectRootHash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO v a
-&gt; ProjectAndBranch ProjectName ProjectBranchName
-&gt; Backend IO CausalHash
forall v a.
Codebase IO v a
-&gt; ProjectAndBranch ProjectName ProjectBranchName
-&gt; Backend IO CausalHash
</span><a href="Unison.Server.CodebaseServer.html#resolveProjectRootHash"><span class="hs-identifier hs-var">resolveProjectRootHash</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v a
</span><a href="#local-6989586621679356059"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjectName
-&gt; ProjectBranchName
-&gt; ProjectAndBranch ProjectName ProjectBranchName
forall a b. a -&gt; b -&gt; ProjectAndBranch a b
</span><span class="hs-identifier hs-var">ProjectAndBranch</span></span><span> </span><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679356060"><span class="hs-identifier hs-var">projectName</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621679356061"><span class="hs-identifier hs-var">branchName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-634"></span><span>  </span><span id="local-6989586621679356063"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679356063"><span class="hs-identifier hs-var">projectRootBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Branch IO) -&gt; Backend IO (Branch IO)
forall a. IO a -&gt; Backend IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Branch IO) -&gt; Backend IO (Branch IO))
-&gt; IO (Branch IO) -&gt; Backend IO (Branch IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v a -&gt; CausalHash -&gt; IO (Branch IO)
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; CausalHash -&gt; m (Branch m)
</span><span class="hs-identifier hs-var">Codebase.expectBranchForHash</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v a
</span><a href="#local-6989586621679356059"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679356062"><span class="hs-identifier hs-var">projectRootHash</span></a></span><span>
</span><span id="line-635"></span><span>  </span><span id="local-6989586621679356065"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679356065"><span class="hs-identifier hs-var">hashLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Backend IO Int
forall a. IO a -&gt; Backend IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Int -&gt; Backend IO Int) -&gt; IO Int -&gt; Backend IO Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v a -&gt; Transaction Int -&gt; IO Int
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v a
</span><a href="#local-6989586621679356059"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">(Transaction Int -&gt; IO Int) -&gt; Transaction Int -&gt; IO Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Transaction Int
</span><span class="hs-identifier hs-var">Codebase.hashLength</span></span><span>
</span><span id="line-636"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679356067"><span class="annot"><span class="annottext">names :: Names
</span><a href="#local-6989586621679356067"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679356063"><span class="hs-identifier hs-var">projectRootBranch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-637"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679356070"><span class="annot"><span class="annottext">pped :: PrettyPrintEnvDecl
</span><a href="#local-6989586621679356070"><span class="hs-identifier hs-var hs-var">pped</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Namer -&gt; Suffixifier -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.makePPED</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Names -&gt; Namer
</span><span class="hs-identifier hs-var">PPE.hqNamer</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679356065"><span class="hs-identifier hs-var">hashLength</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679356067"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Suffixifier
</span><span class="hs-identifier hs-var">PPE.suffixifyByHash</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679356067"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-638"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679356074"><span class="annot"><span class="annottext">nameSearch :: NameSearch Transaction
</span><a href="#local-6989586621679356074"><span class="hs-identifier hs-var hs-var">nameSearch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Names -&gt; NameSearch Transaction
forall (m :: * -&gt; *). Applicative m =&gt; Int -&gt; Names -&gt; NameSearch m
</span><a href="Unison.Server.NameSearch.FromNames.html#makeNameSearch"><span class="hs-identifier hs-var">Names.makeNameSearch</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679356065"><span class="hs-identifier hs-var">hashLength</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679356067"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-639"></span><span>  </span><span class="annot"><span class="annottext">(PrettyPrintEnvDecl, NameSearch Transaction)
-&gt; Backend IO (PrettyPrintEnvDecl, NameSearch Transaction)
forall a. a -&gt; Backend IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679356070"><span class="hs-identifier hs-var">pped</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679356074"><span class="hs-identifier hs-var">nameSearch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-640"></span><span>
</span><span id="line-641"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveProjectDiffTypesEndpoint"><span class="hs-identifier hs-type">serveProjectDiffTypesEndpoint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TypeDiffResponse"><span class="hs-identifier hs-type">TypeDiffResponse</span></a></span><span>
</span><span id="line-642"></span><span id="serveProjectDiffTypesEndpoint"><span class="annot"><span class="annottext">serveProjectDiffTypesEndpoint :: Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; ProjectName
-&gt; ProjectBranchName
-&gt; ProjectBranchName
-&gt; Name
-&gt; Name
-&gt; Backend IO TypeDiffResponse
</span><a href="Unison.Server.CodebaseServer.html#serveProjectDiffTypesEndpoint"><span class="hs-identifier hs-var hs-var">serveProjectDiffTypesEndpoint</span></a></span></span><span> </span><span id="local-6989586621679356077"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679356077"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679356078"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679356078"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679356079"><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679356079"><span class="hs-identifier hs-var">projectName</span></a></span></span><span> </span><span id="local-6989586621679356080"><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621679356080"><span class="hs-identifier hs-var">oldBranchRef</span></a></span></span><span> </span><span id="local-6989586621679356081"><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621679356081"><span class="hs-identifier hs-var">newBranchRef</span></a></span></span><span> </span><span id="local-6989586621679356082"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679356082"><span class="hs-identifier hs-var">oldType</span></a></span></span><span> </span><span id="local-6989586621679356083"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679356083"><span class="hs-identifier hs-var">newType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-643"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679356084"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679356084"><span class="hs-identifier hs-var">oldPPED</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679356085"><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679356085"><span class="hs-identifier hs-var">oldNameSearch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; ProjectName
-&gt; ProjectBranchName
-&gt; Backend IO (PrettyPrintEnvDecl, NameSearch Transaction)
forall v a.
Codebase IO v a
-&gt; ProjectName
-&gt; ProjectBranchName
-&gt; Backend IO (PrettyPrintEnvDecl, NameSearch Transaction)
</span><a href="Unison.Server.CodebaseServer.html#contextForProjectBranch"><span class="hs-identifier hs-var">contextForProjectBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679356077"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679356079"><span class="hs-identifier hs-var">projectName</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621679356080"><span class="hs-identifier hs-var">oldBranchRef</span></a></span><span>
</span><span id="line-644"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679356086"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679356086"><span class="hs-identifier hs-var">newPPED</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679356087"><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679356087"><span class="hs-identifier hs-var">newNameSearch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; ProjectName
-&gt; ProjectBranchName
-&gt; Backend IO (PrettyPrintEnvDecl, NameSearch Transaction)
forall v a.
Codebase IO v a
-&gt; ProjectName
-&gt; ProjectBranchName
-&gt; Backend IO (PrettyPrintEnvDecl, NameSearch Transaction)
</span><a href="Unison.Server.CodebaseServer.html#contextForProjectBranch"><span class="hs-identifier hs-var">contextForProjectBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679356077"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679356079"><span class="hs-identifier hs-var">projectName</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621679356081"><span class="hs-identifier hs-var">newBranchRef</span></a></span><span>
</span><span id="line-645"></span><span>  </span><span id="local-6989586621679356088"><span class="annot"><span class="annottext">oldType :: TypeDefinition
</span><a href="#local-6989586621679356088"><span class="hs-identifier hs-var">oldType</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Unison.Server.Types.html#TypeDefinition"><span class="hs-identifier hs-type">TypeDefinition</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:typeDefinition:TypeDefinition :: TypeDefinition -&gt; DisplayObject SyntaxText SyntaxText
</span><a href="Unison.Server.Types.html#%24sel%3AtypeDefinition%3ATypeDefinition"><span class="hs-identifier hs-var">typeDefinition</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679356091"><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
</span><a href="#local-6989586621679356091"><span class="hs-identifier hs-var">oldTypeDispObj</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; PrettyPrintEnvDecl
-&gt; NameSearch Transaction
-&gt; Width
-&gt; Runtime Symbol
-&gt; Name
-&gt; Backend IO (Maybe TypeDefinition)
</span><a href="Unison.Server.Local.Definitions.html#typeDefinitionByName"><span class="hs-identifier hs-var">Defn.typeDefinitionByName</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679356077"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679356084"><span class="hs-identifier hs-var">oldPPED</span></a></span><span> </span><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679356085"><span class="hs-identifier hs-var">oldNameSearch</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679356093"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679356078"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679356082"><span class="hs-identifier hs-var">oldType</span></a></span><span> </span><span class="annot"><span class="annottext">Backend IO (Maybe TypeDefinition)
-&gt; Backend IO TypeDefinition -&gt; Backend IO TypeDefinition
forall (m :: * -&gt; *) a. Monad m =&gt; m (Maybe a) -&gt; m a -&gt; m a
</span><span class="hs-operator hs-var">`whenNothingM`</span></span><span> </span><span class="annot"><span class="annottext">BackendError -&gt; Backend IO TypeDefinition
forall a. BackendError -&gt; Backend IO a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; BackendError
</span><a href="Unison.Server.Backend.html#NoSuchDefinition"><span class="hs-identifier hs-var">Backend.NoSuchDefinition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; HashQualified Name
forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.NameOnly</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679356082"><span class="hs-identifier hs-var">oldType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>  </span><span id="local-6989586621679356094"><span class="annot"><span class="annottext">newType :: TypeDefinition
</span><a href="#local-6989586621679356094"><span class="hs-identifier hs-var">newType</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Unison.Server.Types.html#TypeDefinition"><span class="hs-identifier hs-type">TypeDefinition</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:typeDefinition:TypeDefinition :: TypeDefinition -&gt; DisplayObject SyntaxText SyntaxText
</span><a href="Unison.Server.Types.html#%24sel%3AtypeDefinition%3ATypeDefinition"><span class="hs-identifier hs-var">typeDefinition</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679356095"><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
</span><a href="#local-6989586621679356095"><span class="hs-identifier hs-var">newTypeDisplayObj</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; PrettyPrintEnvDecl
-&gt; NameSearch Transaction
-&gt; Width
-&gt; Runtime Symbol
-&gt; Name
-&gt; Backend IO (Maybe TypeDefinition)
</span><a href="Unison.Server.Local.Definitions.html#typeDefinitionByName"><span class="hs-identifier hs-var">Defn.typeDefinitionByName</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679356077"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679356086"><span class="hs-identifier hs-var">newPPED</span></a></span><span> </span><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679356087"><span class="hs-identifier hs-var">newNameSearch</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679356093"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679356078"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679356083"><span class="hs-identifier hs-var">newType</span></a></span><span> </span><span class="annot"><span class="annottext">Backend IO (Maybe TypeDefinition)
-&gt; Backend IO TypeDefinition -&gt; Backend IO TypeDefinition
forall (m :: * -&gt; *) a. Monad m =&gt; m (Maybe a) -&gt; m a -&gt; m a
</span><span class="hs-operator hs-var">`whenNothingM`</span></span><span> </span><span class="annot"><span class="annottext">BackendError -&gt; Backend IO TypeDefinition
forall a. BackendError -&gt; Backend IO a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; BackendError
</span><a href="Unison.Server.Backend.html#NoSuchDefinition"><span class="hs-identifier hs-var">Backend.NoSuchDefinition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; HashQualified Name
forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.NameOnly</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679356083"><span class="hs-identifier hs-var">newType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-647"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679356096"><span class="annot"><span class="annottext">typeDiffDisplayObject :: DisplayObjectDiff
</span><a href="#local-6989586621679356096"><span class="hs-identifier hs-var hs-var">typeDiffDisplayObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt;
DisplayObject SyntaxText SyntaxText
-&gt; DisplayObject SyntaxText SyntaxText -&gt; DisplayObjectDiff
DisplayObject SyntaxText SyntaxText
-&gt; DisplayObject SyntaxText SyntaxText -&gt; DisplayObjectDiff
</span><a href="Unison.Server.Backend.DefinitionDiff.html#diffDisplayObjects"><span class="hs-identifier hs-var">DefinitionDiff.diffDisplayObjects</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
</span><a href="#local-6989586621679356091"><span class="hs-identifier hs-var">oldTypeDispObj</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
</span><a href="#local-6989586621679356095"><span class="hs-identifier hs-var">newTypeDisplayObj</span></a></span><span>
</span><span id="line-648"></span><span>  </span><span class="annot"><span class="annottext">TypeDiffResponse -&gt; Backend IO TypeDiffResponse
forall a. a -&gt; Backend IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-649"></span><span>    </span><span class="annot"><a href="Unison.Server.Types.html#TypeDiffResponse"><span class="hs-identifier hs-type">TypeDiffResponse</span></a></span><span>
</span><span id="line-650"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:project:TypeDiffResponse :: ProjectName
</span><a href="Unison.Server.Types.html#%24sel%3Aproject%3ATypeDiffResponse"><span class="hs-identifier hs-var">project</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679356079"><span class="hs-identifier hs-var">projectName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-651"></span><span>        </span><span class="annot"><span class="annottext">$sel:oldBranch:TypeDiffResponse :: ProjectBranchName
</span><a href="Unison.Server.Types.html#%24sel%3AoldBranch%3ATypeDiffResponse"><span class="hs-identifier hs-var">oldBranch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621679356080"><span class="hs-identifier hs-var">oldBranchRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-652"></span><span>        </span><span class="annot"><span class="annottext">$sel:newBranch:TypeDiffResponse :: ProjectBranchName
</span><a href="Unison.Server.Types.html#%24sel%3AnewBranch%3ATypeDiffResponse"><span class="hs-identifier hs-var">newBranch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621679356081"><span class="hs-identifier hs-var">newBranchRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-653"></span><span>        </span><span class="annot"><span class="annottext">$sel:oldType:TypeDiffResponse :: TypeDefinition
</span><a href="Unison.Server.Types.html#%24sel%3AoldType%3ATypeDiffResponse"><span class="hs-identifier hs-var">oldType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeDefinition
</span><a href="#local-6989586621679356088"><span class="hs-identifier hs-var">oldType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-654"></span><span>        </span><span class="annot"><span class="annottext">$sel:newType:TypeDiffResponse :: TypeDefinition
</span><a href="Unison.Server.Types.html#%24sel%3AnewType%3ATypeDiffResponse"><span class="hs-identifier hs-var">newType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeDefinition
</span><a href="#local-6989586621679356094"><span class="hs-identifier hs-var">newType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-655"></span><span>        </span><span class="annot"><span class="annottext">$sel:diff:TypeDiffResponse :: DisplayObjectDiff
</span><a href="Unison.Server.Types.html#%24sel%3Adiff%3ATypeDiffResponse"><span class="hs-identifier hs-var">diff</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DisplayObjectDiff
</span><a href="#local-6989586621679356096"><span class="hs-identifier hs-var">typeDiffDisplayObject</span></a></span><span>
</span><span id="line-656"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-657"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-658"></span><span>    </span><span id="local-6989586621679356093"><span class="annot"><span class="annottext">width :: Width
</span><a href="#local-6989586621679356093"><span class="hs-identifier hs-var hs-var">width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Width
</span><span class="hs-identifier hs-var">Pretty.Width</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">80</span></span><span>
</span><span id="line-659"></span><span>
</span><span id="line-660"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveProjectsAPI"><span class="hs-identifier hs-type">serveProjectsAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerT</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ProjectsAPI"><span class="hs-identifier hs-type">ProjectsAPI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span>
</span><span id="line-661"></span><span id="serveProjectsAPI"><span class="annot"><span class="annottext">serveProjectsAPI :: Codebase IO Symbol Ann
-&gt; Runtime Symbol -&gt; ServerT ProjectsAPI (Backend IO)
</span><a href="Unison.Server.CodebaseServer.html#serveProjectsAPI"><span class="hs-identifier hs-var hs-var">serveProjectsAPI</span></a></span></span><span> </span><span id="local-6989586621679356105"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679356105"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679356106"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679356106"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-662"></span><span>  </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Maybe PrefixFilter -&gt; Backend IO [ProjectListing]
</span><a href="Unison.Server.Local.Endpoints.Projects.html#projectListingEndpoint"><span class="hs-identifier hs-var">projectListingEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679356105"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-663"></span><span>    </span><span class="annot"><span class="annottext">(Maybe PrefixFilter -&gt; Backend IO [ProjectListing])
-&gt; (ProjectName
    -&gt; ((Maybe PrefixFilter -&gt; Backend IO [ProjectBranchListing])
        :&lt;|&gt; (ProjectBranchName
              -&gt; (Maybe Path
                  -&gt; Maybe Path
                  -&gt; Backend
                       IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
                 :&lt;|&gt; ((Path
                        -&gt; Maybe Width
                        -&gt; Backend
                             IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
                       :&lt;|&gt; ((Maybe Path
                              -&gt; [HashQualified Name]
                              -&gt; Maybe Width
                              -&gt; Maybe Suffixify
                              -&gt; Backend
                                   IO
                                   (Headers
                                      '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
                             :&lt;|&gt; ((Maybe Path
                                    -&gt; Maybe Int
                                    -&gt; Maybe Width
                                    -&gt; Maybe String
                                    -&gt; Backend
                                         IO
                                         (Headers
                                            '[Header &quot;Cache-Control&quot; String]
                                            [(Alignment, FoundResult)]))
                                   :&lt;|&gt; ((Referent
                                          -&gt; Maybe Name
                                          -&gt; Maybe Path
                                          -&gt; Maybe Width
                                          -&gt; Backend
                                               IO
                                               (Headers
                                                  '[Header &quot;Cache-Control&quot; String] TermSummary))
                                         :&lt;|&gt; (Reference
                                               -&gt; Maybe Name
                                               -&gt; Maybe Path
                                               -&gt; Maybe Width
                                               -&gt; Backend
                                                    IO
                                                    (Headers
                                                       '[Header &quot;Cache-Control&quot; String]
                                                       TypeSummary))))))))
       :&lt;|&gt; ((ProjectBranchName
              -&gt; ProjectBranchName
              -&gt; Name
              -&gt; Name
              -&gt; Backend IO TermDiffResponse)
             :&lt;|&gt; (ProjectBranchName
                   -&gt; ProjectBranchName
                   -&gt; Name
                   -&gt; Name
                   -&gt; Backend IO TypeDiffResponse)))
-&gt; (Maybe PrefixFilter -&gt; Backend IO [ProjectListing])
   :&lt;|&gt; (ProjectName
         -&gt; ((Maybe PrefixFilter -&gt; Backend IO [ProjectBranchListing])
             :&lt;|&gt; (ProjectBranchName
                   -&gt; (Maybe Path
                       -&gt; Maybe Path
                       -&gt; Backend
                            IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
                      :&lt;|&gt; ((Path
                             -&gt; Maybe Width
                             -&gt; Backend
                                  IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
                            :&lt;|&gt; ((Maybe Path
                                   -&gt; [HashQualified Name]
                                   -&gt; Maybe Width
                                   -&gt; Maybe Suffixify
                                   -&gt; Backend
                                        IO
                                        (Headers
                                           '[Header &quot;Cache-Control&quot; String]
                                           DefinitionDisplayResults))
                                  :&lt;|&gt; ((Maybe Path
                                         -&gt; Maybe Int
                                         -&gt; Maybe Width
                                         -&gt; Maybe String
                                         -&gt; Backend
                                              IO
                                              (Headers
                                                 '[Header &quot;Cache-Control&quot; String]
                                                 [(Alignment, FoundResult)]))
                                        :&lt;|&gt; ((Referent
                                               -&gt; Maybe Name
                                               -&gt; Maybe Path
                                               -&gt; Maybe Width
                                               -&gt; Backend
                                                    IO
                                                    (Headers
                                                       '[Header &quot;Cache-Control&quot; String]
                                                       TermSummary))
                                              :&lt;|&gt; (Reference
                                                    -&gt; Maybe Name
                                                    -&gt; Maybe Path
                                                    -&gt; Maybe Width
                                                    -&gt; Backend
                                                         IO
                                                         (Headers
                                                            '[Header &quot;Cache-Control&quot; String]
                                                            TypeSummary))))))))
            :&lt;|&gt; ((ProjectBranchName
                   -&gt; ProjectBranchName
                   -&gt; Name
                   -&gt; Name
                   -&gt; Backend IO TermDiffResponse)
                  :&lt;|&gt; (ProjectBranchName
                        -&gt; ProjectBranchName
                        -&gt; Name
                        -&gt; Name
                        -&gt; Backend IO TypeDiffResponse)))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679356107"><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679356107"><span class="hs-identifier hs-var">projectName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-664"></span><span>             </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; ProjectName
-&gt; Maybe PrefixFilter
-&gt; Backend IO [ProjectBranchListing]
</span><a href="Unison.Server.Local.Endpoints.Projects.html#projectBranchListingEndpoint"><span class="hs-identifier hs-var">projectBranchListingEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679356105"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679356107"><span class="hs-identifier hs-var">projectName</span></a></span><span>
</span><span id="line-665"></span><span>                 </span><span class="annot"><span class="annottext">(Maybe PrefixFilter -&gt; Backend IO [ProjectBranchListing])
-&gt; (ProjectBranchName
    -&gt; (Maybe Path
        -&gt; Maybe Path
        -&gt; Backend
             IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
       :&lt;|&gt; ((Path
              -&gt; Maybe Width
              -&gt; Backend
                   IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
             :&lt;|&gt; ((Maybe Path
                    -&gt; [HashQualified Name]
                    -&gt; Maybe Width
                    -&gt; Maybe Suffixify
                    -&gt; Backend
                         IO
                         (Headers
                            '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
                   :&lt;|&gt; ((Maybe Path
                          -&gt; Maybe Int
                          -&gt; Maybe Width
                          -&gt; Maybe String
                          -&gt; Backend
                               IO
                               (Headers
                                  '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
                         :&lt;|&gt; ((Referent
                                -&gt; Maybe Name
                                -&gt; Maybe Path
                                -&gt; Maybe Width
                                -&gt; Backend
                                     IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
                               :&lt;|&gt; (Reference
                                     -&gt; Maybe Name
                                     -&gt; Maybe Path
                                     -&gt; Maybe Width
                                     -&gt; Backend
                                          IO
                                          (Headers
                                             '[Header &quot;Cache-Control&quot; String] TypeSummary)))))))
-&gt; (Maybe PrefixFilter -&gt; Backend IO [ProjectBranchListing])
   :&lt;|&gt; (ProjectBranchName
         -&gt; (Maybe Path
             -&gt; Maybe Path
             -&gt; Backend
                  IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
            :&lt;|&gt; ((Path
                   -&gt; Maybe Width
                   -&gt; Backend
                        IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
                  :&lt;|&gt; ((Maybe Path
                         -&gt; [HashQualified Name]
                         -&gt; Maybe Width
                         -&gt; Maybe Suffixify
                         -&gt; Backend
                              IO
                              (Headers
                                 '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
                        :&lt;|&gt; ((Maybe Path
                               -&gt; Maybe Int
                               -&gt; Maybe Width
                               -&gt; Maybe String
                               -&gt; Backend
                                    IO
                                    (Headers
                                       '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
                              :&lt;|&gt; ((Referent
                                     -&gt; Maybe Name
                                     -&gt; Maybe Path
                                     -&gt; Maybe Width
                                     -&gt; Backend
                                          IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
                                    :&lt;|&gt; (Reference
                                          -&gt; Maybe Name
                                          -&gt; Maybe Path
                                          -&gt; Maybe Width
                                          -&gt; Backend
                                               IO
                                               (Headers
                                                  '[Header &quot;Cache-Control&quot; String]
                                                  TypeSummary)))))))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; ProjectName
-&gt; ProjectBranchName
-&gt; ServerT CodebaseServerAPI (Backend IO)
</span><a href="Unison.Server.CodebaseServer.html#serveProjectsCodebaseServerAPI"><span class="hs-identifier hs-var">serveProjectsCodebaseServerAPI</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679356105"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679356106"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679356107"><span class="hs-identifier hs-var">projectName</span></a></span><span>
</span><span id="line-666"></span><span>             </span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>               </span><span class="annot"><span class="annottext">((Maybe PrefixFilter -&gt; Backend IO [ProjectBranchListing])
 :&lt;|&gt; (ProjectBranchName
       -&gt; (Maybe Path
           -&gt; Maybe Path
           -&gt; Backend
                IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
          :&lt;|&gt; ((Path
                 -&gt; Maybe Width
                 -&gt; Backend
                      IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
                :&lt;|&gt; ((Maybe Path
                       -&gt; [HashQualified Name]
                       -&gt; Maybe Width
                       -&gt; Maybe Suffixify
                       -&gt; Backend
                            IO
                            (Headers
                               '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
                      :&lt;|&gt; ((Maybe Path
                             -&gt; Maybe Int
                             -&gt; Maybe Width
                             -&gt; Maybe String
                             -&gt; Backend
                                  IO
                                  (Headers
                                     '[Header &quot;Cache-Control&quot; String] [(Alignment, FoundResult)]))
                            :&lt;|&gt; ((Referent
                                   -&gt; Maybe Name
                                   -&gt; Maybe Path
                                   -&gt; Maybe Width
                                   -&gt; Backend
                                        IO (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
                                  :&lt;|&gt; (Reference
                                        -&gt; Maybe Name
                                        -&gt; Maybe Path
                                        -&gt; Maybe Width
                                        -&gt; Backend
                                             IO
                                             (Headers
                                                '[Header &quot;Cache-Control&quot; String] TypeSummary))))))))
-&gt; ((ProjectBranchName
     -&gt; ProjectBranchName
     -&gt; Name
     -&gt; Name
     -&gt; Backend IO TermDiffResponse)
    :&lt;|&gt; (ProjectBranchName
          -&gt; ProjectBranchName
          -&gt; Name
          -&gt; Name
          -&gt; Backend IO TypeDiffResponse))
-&gt; ((Maybe PrefixFilter -&gt; Backend IO [ProjectBranchListing])
    :&lt;|&gt; (ProjectBranchName
          -&gt; (Maybe Path
              -&gt; Maybe Path
              -&gt; Backend
                   IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
             :&lt;|&gt; ((Path
                    -&gt; Maybe Width
                    -&gt; Backend
                         IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
                   :&lt;|&gt; ((Maybe Path
                          -&gt; [HashQualified Name]
                          -&gt; Maybe Width
                          -&gt; Maybe Suffixify
                          -&gt; Backend
                               IO
                               (Headers
                                  '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
                         :&lt;|&gt; ((Maybe Path
                                -&gt; Maybe Int
                                -&gt; Maybe Width
                                -&gt; Maybe String
                                -&gt; Backend
                                     IO
                                     (Headers
                                        '[Header &quot;Cache-Control&quot; String]
                                        [(Alignment, FoundResult)]))
                               :&lt;|&gt; ((Referent
                                      -&gt; Maybe Name
                                      -&gt; Maybe Path
                                      -&gt; Maybe Width
                                      -&gt; Backend
                                           IO
                                           (Headers '[Header &quot;Cache-Control&quot; String] TermSummary))
                                     :&lt;|&gt; (Reference
                                           -&gt; Maybe Name
                                           -&gt; Maybe Path
                                           -&gt; Maybe Width
                                           -&gt; Backend
                                                IO
                                                (Headers
                                                   '[Header &quot;Cache-Control&quot; String]
                                                   TypeSummary))))))))
   :&lt;|&gt; ((ProjectBranchName
          -&gt; ProjectBranchName
          -&gt; Name
          -&gt; Name
          -&gt; Backend IO TermDiffResponse)
         :&lt;|&gt; (ProjectBranchName
               -&gt; ProjectBranchName
               -&gt; Name
               -&gt; Name
               -&gt; Backend IO TypeDiffResponse))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; ProjectName
-&gt; ProjectBranchName
-&gt; ProjectBranchName
-&gt; Name
-&gt; Name
-&gt; Backend IO TermDiffResponse
</span><a href="Unison.Server.CodebaseServer.html#serveProjectDiffTermsEndpoint"><span class="hs-identifier hs-var">serveProjectDiffTermsEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679356105"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679356106"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679356107"><span class="hs-identifier hs-var">projectName</span></a></span><span>
</span><span id="line-668"></span><span>                        </span><span class="annot"><span class="annottext">(ProjectBranchName
 -&gt; ProjectBranchName
 -&gt; Name
 -&gt; Name
 -&gt; Backend IO TermDiffResponse)
-&gt; (ProjectBranchName
    -&gt; ProjectBranchName
    -&gt; Name
    -&gt; Name
    -&gt; Backend IO TypeDiffResponse)
-&gt; (ProjectBranchName
    -&gt; ProjectBranchName
    -&gt; Name
    -&gt; Name
    -&gt; Backend IO TermDiffResponse)
   :&lt;|&gt; (ProjectBranchName
         -&gt; ProjectBranchName
         -&gt; Name
         -&gt; Name
         -&gt; Backend IO TypeDiffResponse)
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; ProjectName
-&gt; ProjectBranchName
-&gt; ProjectBranchName
-&gt; Name
-&gt; Name
-&gt; Backend IO TypeDiffResponse
</span><a href="Unison.Server.CodebaseServer.html#serveProjectDiffTypesEndpoint"><span class="hs-identifier hs-var">serveProjectDiffTypesEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679356105"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679356106"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621679356107"><span class="hs-identifier hs-var">projectName</span></a></span><span>
</span><span id="line-669"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span>         </span><span class="hs-special">)</span><span>
</span><span id="line-671"></span><span>
</span><span id="line-672"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveUnisonLocal"><span class="hs-identifier hs-type">serveUnisonLocal</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-673"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-674"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-675"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-676"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonLocalAPI"><span class="hs-identifier hs-type">UnisonLocalAPI</span></a></span><span>
</span><span id="line-677"></span><span id="serveUnisonLocal"><span class="annot"><span class="annottext">serveUnisonLocal :: BackendEnv
-&gt; Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; Server UnisonLocalAPI
</span><a href="Unison.Server.CodebaseServer.html#serveUnisonLocal"><span class="hs-identifier hs-var hs-var">serveUnisonLocal</span></a></span></span><span> </span><span id="local-6989586621679356108"><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679356108"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679356109"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679356109"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679356110"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679356110"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-678"></span><span>  </span><span class="annot"><span class="annottext">Proxy UnisonLocalAPI
-&gt; (forall x. Backend IO x -&gt; Handler x)
-&gt; ServerT UnisonLocalAPI (Backend IO)
-&gt; Server UnisonLocalAPI
forall api (m :: * -&gt; *) (n :: * -&gt; *).
HasServer api '[] =&gt;
Proxy api
-&gt; (forall x. m x -&gt; n x) -&gt; ServerT api m -&gt; ServerT api n
</span><span class="hs-identifier hs-var">hoistServer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall t. Proxy t
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonLocalAPI"><span class="hs-identifier hs-type">UnisonLocalAPI</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackendEnv -&gt; Backend IO x -&gt; Handler x
forall a. BackendEnv -&gt; Backend IO a -&gt; Handler a
</span><a href="Unison.Server.CodebaseServer.html#backendHandler"><span class="hs-identifier hs-var">backendHandler</span></a></span><span> </span><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679356108"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ServerT UnisonLocalAPI (Backend IO) -&gt; Server UnisonLocalAPI)
-&gt; ServerT UnisonLocalAPI (Backend IO) -&gt; Server UnisonLocalAPI
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-679"></span><span>    </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Runtime Symbol -&gt; ServerT ProjectsAPI (Backend IO)
</span><a href="Unison.Server.CodebaseServer.html#serveProjectsAPI"><span class="hs-identifier hs-var">serveProjectsAPI</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679356109"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679356110"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe PrefixFilter -&gt; Backend IO [ProjectListing])
 :&lt;|&gt; (ProjectName
       -&gt; ((Maybe PrefixFilter -&gt; Backend IO [ProjectBranchListing])
           :&lt;|&gt; (ProjectBranchName
                 -&gt; (Maybe Path
                     -&gt; Maybe Path
                     -&gt; Backend
                          IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
                    :&lt;|&gt; ((Path
                           -&gt; Maybe Width
                           -&gt; Backend
                                IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
                          :&lt;|&gt; ((Maybe Path
                                 -&gt; [HashQualified Name]
                                 -&gt; Maybe Width
                                 -&gt; Maybe Suffixify
                                 -&gt; Backend
                                      IO
                                      (Headers
                                         '[Header &quot;Cache-Control&quot; String] DefinitionDisplayResults))
                                :&lt;|&gt; ((Maybe Path
                                       -&gt; Maybe Int
                                       -&gt; Maybe Width
                                       -&gt; Maybe String
                                       -&gt; Backend
                                            IO
                                            (Headers
                                               '[Header &quot;Cache-Control&quot; String]
                                               [(Alignment, FoundResult)]))
                                      :&lt;|&gt; ((Referent
                                             -&gt; Maybe Name
                                             -&gt; Maybe Path
                                             -&gt; Maybe Width
                                             -&gt; Backend
                                                  IO
                                                  (Headers
                                                     '[Header &quot;Cache-Control&quot; String] TermSummary))
                                            :&lt;|&gt; (Reference
                                                  -&gt; Maybe Name
                                                  -&gt; Maybe Path
                                                  -&gt; Maybe Width
                                                  -&gt; Backend
                                                       IO
                                                       (Headers
                                                          '[Header &quot;Cache-Control&quot; String]
                                                          TypeSummary))))))))
          :&lt;|&gt; ((ProjectBranchName
                 -&gt; ProjectBranchName
                 -&gt; Name
                 -&gt; Name
                 -&gt; Backend IO TermDiffResponse)
                :&lt;|&gt; (ProjectBranchName
                      -&gt; ProjectBranchName
                      -&gt; Name
                      -&gt; Name
                      -&gt; Backend IO TypeDiffResponse))))
-&gt; Backend IO (APIHeaders Current)
-&gt; ((Maybe PrefixFilter -&gt; Backend IO [ProjectListing])
    :&lt;|&gt; (ProjectName
          -&gt; ((Maybe PrefixFilter -&gt; Backend IO [ProjectBranchListing])
              :&lt;|&gt; (ProjectBranchName
                    -&gt; (Maybe Path
                        -&gt; Maybe Path
                        -&gt; Backend
                             IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceListing))
                       :&lt;|&gt; ((Path
                              -&gt; Maybe Width
                              -&gt; Backend
                                   IO (Headers '[Header &quot;Cache-Control&quot; String] NamespaceDetails))
                             :&lt;|&gt; ((Maybe Path
                                    -&gt; [HashQualified Name]
                                    -&gt; Maybe Width
                                    -&gt; Maybe Suffixify
                                    -&gt; Backend
                                         IO
                                         (Headers
                                            '[Header &quot;Cache-Control&quot; String]
                                            DefinitionDisplayResults))
                                   :&lt;|&gt; ((Maybe Path
                                          -&gt; Maybe Int
                                          -&gt; Maybe Width
                                          -&gt; Maybe String
                                          -&gt; Backend
                                               IO
                                               (Headers
                                                  '[Header &quot;Cache-Control&quot; String]
                                                  [(Alignment, FoundResult)]))
                                         :&lt;|&gt; ((Referent
                                                -&gt; Maybe Name
                                                -&gt; Maybe Path
                                                -&gt; Maybe Width
                                                -&gt; Backend
                                                     IO
                                                     (Headers
                                                        '[Header &quot;Cache-Control&quot; String]
                                                        TermSummary))
                                               :&lt;|&gt; (Reference
                                                     -&gt; Maybe Name
                                                     -&gt; Maybe Path
                                                     -&gt; Maybe Width
                                                     -&gt; Backend
                                                          IO
                                                          (Headers
                                                             '[Header &quot;Cache-Control&quot; String]
                                                             TypeSummary))))))))
             :&lt;|&gt; ((ProjectBranchName
                    -&gt; ProjectBranchName
                    -&gt; Name
                    -&gt; Name
                    -&gt; Backend IO TermDiffResponse)
                   :&lt;|&gt; (ProjectBranchName
                         -&gt; ProjectBranchName
                         -&gt; Name
                         -&gt; Name
                         -&gt; Backend IO TypeDiffResponse))))
   :&lt;|&gt; Backend IO (APIHeaders Current)
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Current -&gt; APIHeaders Current
forall v. v -&gt; APIHeaders v
</span><a href="Unison.Server.Types.html#setCacheControl"><span class="hs-identifier hs-var">setCacheControl</span></a></span><span> </span><span class="annot"><span class="annottext">(Current -&gt; APIHeaders Current)
-&gt; Backend IO Current -&gt; Backend IO (APIHeaders Current)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Backend IO Current
forall (m :: * -&gt; *) v a.
MonadIO m =&gt;
Codebase m v a -&gt; Backend m Current
</span><a href="Unison.Server.Local.Endpoints.UCM.html#ucmServer"><span class="hs-identifier hs-var">ucmServer</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679356109"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span id="local-6989586621679354628"><span class="annot"><a href="Unison.Server.CodebaseServer.html#backendHandler"><span class="hs-identifier hs-type">backendHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679354628"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><a href="#local-6989586621679354628"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-682"></span><span id="backendHandler"><span class="annot"><span class="annottext">backendHandler :: forall a. BackendEnv -&gt; Backend IO a -&gt; Handler a
</span><a href="Unison.Server.CodebaseServer.html#backendHandler"><span class="hs-identifier hs-var hs-var">backendHandler</span></a></span></span><span> </span><span id="local-6989586621679356113"><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679356113"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679356114"><span class="annot"><span class="annottext">Backend IO a
</span><a href="#local-6989586621679356114"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-683"></span><span>  </span><span class="annot"><span class="annottext">ExceptT ServerError IO a -&gt; Handler a
forall a. ExceptT ServerError IO a -&gt; Handler a
</span><span class="hs-identifier hs-var">Handler</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT ServerError IO a -&gt; Handler a)
-&gt; ExceptT ServerError IO a -&gt; Handler a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(BackendError -&gt; ServerError)
-&gt; ExceptT BackendError IO a -&gt; ExceptT ServerError IO a
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><span class="hs-identifier hs-var">withExceptT</span></span><span> </span><span class="annot"><span class="annottext">BackendError -&gt; ServerError
</span><a href="Unison.Server.Errors.html#backendError"><span class="hs-identifier hs-var">backendError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReaderT BackendEnv (ExceptT BackendError IO) a
-&gt; BackendEnv -&gt; ExceptT BackendError IO a
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Backend IO a -&gt; ReaderT BackendEnv (ExceptT BackendError IO) a
forall (m :: * -&gt; *) a.
Backend m a -&gt; ReaderT BackendEnv (ExceptT BackendError m) a
</span><a href="Unison.Server.Backend.html#%24sel%3ArunBackend%3ABackend"><span class="hs-identifier hs-var">runBackend</span></a></span><span> </span><span class="annot"><span class="annottext">Backend IO a
</span><a href="#local-6989586621679356114"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BackendEnv
</span><a href="#local-6989586621679356113"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-684"></span></pre></body></html>