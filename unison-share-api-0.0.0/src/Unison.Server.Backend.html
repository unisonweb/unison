<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ApplicativeDo #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Server.Backend</span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Types</span></span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#BackendError"><span class="hs-identifier">BackendError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#ShallowListEntry"><span class="hs-identifier">ShallowListEntry</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#listEntryName"><span class="hs-identifier">listEntryName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier">BackendEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier">TermEntry</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier">TypeEntry</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#FoundRef"><span class="hs-identifier">FoundRef</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#IncludeCycles"><span class="hs-identifier">IncludeCycles</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier">DefinitionResults</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier">SyntaxText</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Endpoints</span></span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#fuzzyFind"><span class="hs-identifier">fuzzyFind</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Utilities</span></span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#bestNameForTerm"><span class="hs-identifier">bestNameForTerm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#bestNameForType"><span class="hs-identifier">bestNameForType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#definitionsByName"><span class="hs-identifier">definitionsByName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#displayType"><span class="hs-identifier">displayType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#docsInBranchToHtmlFiles"><span class="hs-identifier">docsInBranchToHtmlFiles</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#expandShortCausalHash"><span class="hs-identifier">expandShortCausalHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#findDocInBranch"><span class="hs-identifier">findDocInBranch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#formatSuffixedType"><span class="hs-identifier">formatSuffixedType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#getShallowCausalAtPathFromRootHash"><span class="hs-identifier">getShallowCausalAtPathFromRootHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#getTermTag"><span class="hs-identifier">getTermTag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#getTypeTag"><span class="hs-identifier">getTypeTag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#hoistBackend"><span class="hs-identifier">hoistBackend</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#hqNameQuery"><span class="hs-identifier">hqNameQuery</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#loadReferentType"><span class="hs-identifier">loadReferentType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#loadSearchResults"><span class="hs-identifier">loadSearchResults</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#lsAtPath"><span class="hs-identifier">lsAtPath</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#lsBranch"><span class="hs-identifier">lsBranch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier">mungeSyntaxText</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><span class="hs-identifier">Codebase.expectCausalBranchByCausalHash</span></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#resolveRootBranchHashV2"><span class="hs-identifier">resolveRootBranchHashV2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#namesAtPathFromRootBranchHash"><span class="hs-identifier">namesAtPathFromRootBranchHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#termEntryDisplayName"><span class="hs-identifier">termEntryDisplayName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#termEntryHQName"><span class="hs-identifier">termEntryHQName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#termEntryToNamedTerm"><span class="hs-identifier">termEntryToNamedTerm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#termEntryLabeledDependencies"><span class="hs-identifier">termEntryLabeledDependencies</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#termListEntry"><span class="hs-identifier">termListEntry</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><a href="Unison.Server.NameSearch.Sqlite.html#termReferentsByShortHash"><span class="hs-identifier">termReferentsByShortHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#typeDeclHeader"><span class="hs-identifier">typeDeclHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#typeEntryDisplayName"><span class="hs-identifier">typeEntryDisplayName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#typeEntryHQName"><span class="hs-identifier">typeEntryHQName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#typeEntryToNamedType"><span class="hs-identifier">typeEntryToNamedType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#typeEntryLabeledDependencies"><span class="hs-identifier">typeEntryLabeledDependencies</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#typeListEntry"><span class="hs-identifier">typeListEntry</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><a href="Unison.Server.NameSearch.Sqlite.html#typeReferencesByShortHash"><span class="hs-identifier">typeReferencesByShortHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#typeToSyntaxHeader"><span class="hs-identifier">typeToSyntaxHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#renderDocRefs"><span class="hs-identifier">renderDocRefs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#docsForDefinitionName"><span class="hs-identifier">docsForDefinitionName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#normaliseRootCausalHash"><span class="hs-identifier">normaliseRootCausalHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Unused, could remove?</span></span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#resolveRootBranchHash"><span class="hs-identifier">resolveRootBranchHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#isTestResultList"><span class="hs-identifier">isTestResultList</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#fixupNamesRelative"><span class="hs-identifier">fixupNamesRelative</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Re-exported for Share Server</span></span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#termsToSyntax"><span class="hs-identifier">termsToSyntax</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#termsToSyntaxOf"><span class="hs-identifier">termsToSyntaxOf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#typesToSyntax"><span class="hs-identifier">typesToSyntax</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#typesToSyntaxOf"><span class="hs-identifier">typesToSyntaxOf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#definitionResultsDependencies"><span class="hs-identifier">definitionResultsDependencies</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#evalDocRef"><span class="hs-identifier">evalDocRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#mkTermDefinition"><span class="hs-identifier">mkTermDefinition</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#mkTypeDefinition"><span class="hs-identifier">mkTypeDefinition</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#displayTerm"><span class="hs-identifier">displayTerm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#formatTypeName"><span class="hs-identifier">formatTypeName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">where</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Error.Util</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hush</span></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(??)</span></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens.Cons</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cons</span></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Containers.ListUtils</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">nubOrdOn</span></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TextE</span></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Lazy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toStrict</span></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Yaml</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Yaml</span></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Lucid</span></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.FuzzyFind</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FZF</span></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Branch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NamespaceStats</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Branch</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2Branch</span></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Causal</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2Causal</span></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.HashTags</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">BranchHash</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">CausalHash</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Referent</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2Referent</span></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.Operations</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ops</span></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ABT</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ABT</span></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Builtin</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Builtin.Decls</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Decls</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Codebase</span></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Codebase</span></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Branch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Branch</span></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Branch</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Branch</span></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Branch.Names</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Branch</span></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Editor.DisplayObject</span></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Editor.DisplayObject</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DisplayObject</span></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Execute</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Codebase</span></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Path</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Path</span></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Path</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Path</span></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Runtime</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Rt</span></span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.ShortCausalHash</span></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">ShortCausalHash</span></span><span class="hs-special">,</span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.ShortCausalHash</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SCH</span></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.SqliteCodebase.Conversions</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cv</span></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ConstructorReference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">GConstructorReference</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ConstructorReference</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ConstructorReference</span></span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ConstructorType</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CT</span></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DataDeclaration</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DD</span></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DataDeclaration.Dependencies</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DD</span></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.HashQualified</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HQ</span></span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.HashQualifiedPrime</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HQ'</span></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Hashing.V2.Convert</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Hashing</span></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.LabeledDependency</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LD</span></span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Name</span></span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NameSegment</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">docSegment</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">libSegment</span></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NameSegment.Internal</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Names</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Names</span></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Names</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Names</span></span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NamesWithHistory</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Names</span></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnv</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPE</span></span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnv.Names</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPE</span></span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnv.Util</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPE</span></span><span>
</span><span id="line-145"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPED</span></span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnvDecl.Names</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPED</span></span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Project</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ProjectBranchName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ProjectName</span></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Reference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TermReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TypeReference</span></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Reference</span></span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Referent</span></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Referent</span></span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Runtime.IOSource</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DD</span></span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Doc.html"><span class="hs-identifier">Unison.Server.Doc</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Doc</span></span><span>
</span><span id="line-154"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Doc.AsHtml.html"><span class="hs-identifier">Unison.Server.Doc.AsHtml</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DocHtml</span></span><span>
</span><span id="line-155"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.html"><span class="hs-identifier">Unison.Server.NameSearch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.NameSearch.html#NameSearch"><span class="hs-identifier">NameSearch</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.html#Search"><span class="hs-identifier">Search</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.html#applySearch"><span class="hs-identifier">applySearch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.Sqlite.html"><span class="hs-identifier">Unison.Server.NameSearch.Sqlite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.NameSearch.Sqlite.html#termReferentsByShortHash"><span class="hs-identifier">termReferentsByShortHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.Sqlite.html#typeReferencesByShortHash"><span class="hs-identifier">typeReferencesByShortHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.QueryResult.html"><span class="hs-identifier">Unison.Server.QueryResult</span></a></span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.SearchResult.html"><span class="hs-identifier">Unison.Server.SearchResult</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SR</span></span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.SearchResultPrime.html"><span class="hs-identifier">Unison.Server.SearchResultPrime</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SR'</span></span><span>
</span><span id="line-160"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Syntax.html"><span class="hs-identifier">Unison.Server.Syntax</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Syntax</span></span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Types.html"><span class="hs-identifier">Unison.Server.Types</span></a></span><span>
</span><span id="line-162"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Types.html"><span class="hs-identifier">Unison.Server.Types</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ServerTypes</span></span><span>
</span><span id="line-163"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ShortHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ShortHash</span></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ShortHash</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SH</span></span><span>
</span><span id="line-165"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Sqlite</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Sqlite</span></span><span>
</span><span id="line-166"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.DeclPrinter</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DeclPrinter</span></span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.HashQualifiedPrime</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HQ'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toText</span></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.Name</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toText</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unsafeParseText</span></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.NamePrinter</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NP</span></span><span>
</span><span id="line-171"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.NameSegment</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toEscapedText</span></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.TermPrinter</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TermPrinter</span></span><span>
</span><span id="line-173"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.TypePrinter</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TypePrinter</span></span><span>
</span><span id="line-174"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Term</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Term</span></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Term</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Term</span></span><span>
</span><span id="line-176"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Type</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Type</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Type</span></span><span>
</span><span id="line-178"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Typechecker</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Typechecker</span></span><span>
</span><span id="line-179"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.AnnotatedText</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">AnnotatedText</span></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">uniqueBy</span></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-182"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldMapM</span></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Monoid</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Monoid</span></span><span>
</span><span id="line-184"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Width</span></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Pretty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pretty</span></span><span>
</span><span id="line-186"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Relation</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">R</span></span><span>
</span><span id="line-187"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.SyntaxText</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UST</span></span><span>
</span><span id="line-188"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Var</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Var</span></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.WatchKind</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WK</span></span><span>
</span><span id="line-190"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UnliftIO</span></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-191"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UnliftIO.Environment</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Env</span></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="hs-keyword">type</span><span> </span><span id="SyntaxText"><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-var">SyntaxText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UST.SyntaxText'</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="hs-keyword">data</span><span> </span><span id="ShallowListEntry"><span class="annot"><a href="Unison.Server.Backend.html#ShallowListEntry"><span class="hs-identifier hs-var">ShallowListEntry</span></a></span></span><span> </span><span id="local-6989586621679347555"><span class="annot"><a href="#local-6989586621679347555"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621679347556"><span class="annot"><a href="#local-6989586621679347556"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ShallowTermEntry"><span class="annot"><a href="Unison.Server.Backend.html#ShallowTermEntry"><span class="hs-identifier hs-var">ShallowTermEntry</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347555"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347556"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ShallowTypeEntry"><span class="annot"><a href="Unison.Server.Backend.html#ShallowTypeEntry"><span class="hs-identifier hs-var">ShallowTypeEntry</span></a></span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ShallowBranchEntry"><span class="annot"><a href="Unison.Server.Backend.html#ShallowBranchEntry"><span class="hs-identifier hs-var">ShallowBranchEntry</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamespaceStats</span></span><span>
</span><span id="line-199"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ShallowPatchEntry"><span class="annot"><a href="Unison.Server.Backend.html#ShallowPatchEntry"><span class="hs-identifier hs-var">ShallowPatchEntry</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span>
</span><span id="line-200"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679348272"><span id="local-6989586621679348285"><span class="annot"><span class="annottext">ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
(ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool)
-&gt; (ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool)
-&gt; Eq (ShallowListEntry v a)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
$c== :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
== :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
$c/= :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
/= :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348293"><span id="local-6989586621679348306"><span id="local-6989586621679348310"><span id="local-6989586621679348313"><span id="local-6989586621679348316"><span id="local-6989586621679348319"><span id="local-6989586621679348322"><span class="annot"><span class="annottext">Eq (ShallowListEntry v a)
Eq (ShallowListEntry v a) =&gt;
(ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Ordering)
-&gt; (ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool)
-&gt; (ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool)
-&gt; (ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool)
-&gt; (ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool)
-&gt; (ShallowListEntry v a
    -&gt; ShallowListEntry v a -&gt; ShallowListEntry v a)
-&gt; (ShallowListEntry v a
    -&gt; ShallowListEntry v a -&gt; ShallowListEntry v a)
-&gt; Ord (ShallowListEntry v a)
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Ordering
ShallowListEntry v a
-&gt; ShallowListEntry v a -&gt; ShallowListEntry v a
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall v a. Var v =&gt; Eq (ShallowListEntry v a)
forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Ordering
forall v a.
Var v =&gt;
ShallowListEntry v a
-&gt; ShallowListEntry v a -&gt; ShallowListEntry v a
$ccompare :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Ordering
compare :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Ordering
$c&lt; :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
&lt; :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
$c&lt;= :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
&lt;= :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
$c&gt; :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
&gt; :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
$c&gt;= :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
&gt;= :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
$cmax :: forall v a.
Var v =&gt;
ShallowListEntry v a
-&gt; ShallowListEntry v a -&gt; ShallowListEntry v a
max :: ShallowListEntry v a
-&gt; ShallowListEntry v a -&gt; ShallowListEntry v a
$cmin :: forall v a.
Var v =&gt;
ShallowListEntry v a
-&gt; ShallowListEntry v a -&gt; ShallowListEntry v a
min :: ShallowListEntry v a
-&gt; ShallowListEntry v a -&gt; ShallowListEntry v a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348327"><span id="local-6989586621679348344"><span id="local-6989586621679348348"><span class="annot"><span class="annottext">Int -&gt; ShallowListEntry v a -&gt; ShowS
[ShallowListEntry v a] -&gt; ShowS
ShallowListEntry v a -&gt; WatchKind
(Int -&gt; ShallowListEntry v a -&gt; ShowS)
-&gt; (ShallowListEntry v a -&gt; WatchKind)
-&gt; ([ShallowListEntry v a] -&gt; ShowS)
-&gt; Show (ShallowListEntry v a)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; WatchKind) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall v a. Show v =&gt; Int -&gt; ShallowListEntry v a -&gt; ShowS
forall v a. Show v =&gt; [ShallowListEntry v a] -&gt; ShowS
forall v a. Show v =&gt; ShallowListEntry v a -&gt; WatchKind
$cshowsPrec :: forall v a. Show v =&gt; Int -&gt; ShallowListEntry v a -&gt; ShowS
showsPrec :: Int -&gt; ShallowListEntry v a -&gt; ShowS
$cshow :: forall v a. Show v =&gt; ShallowListEntry v a -&gt; WatchKind
show :: ShallowListEntry v a -&gt; WatchKind
$cshowList :: forall v a. Show v =&gt; [ShallowListEntry v a] -&gt; ShowS
showList :: [ShallowListEntry v a] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348352"><span id="local-6989586621679348354"><span class="annot"><span class="annottext">(forall x. ShallowListEntry v a -&gt; Rep (ShallowListEntry v a) x)
-&gt; (forall x. Rep (ShallowListEntry v a) x -&gt; ShallowListEntry v a)
-&gt; Generic (ShallowListEntry v a)
forall x. Rep (ShallowListEntry v a) x -&gt; ShallowListEntry v a
forall x. ShallowListEntry v a -&gt; Rep (ShallowListEntry v a) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall v a x. Rep (ShallowListEntry v a) x -&gt; ShallowListEntry v a
forall v a x. ShallowListEntry v a -&gt; Rep (ShallowListEntry v a) x
$cfrom :: forall v a x. ShallowListEntry v a -&gt; Rep (ShallowListEntry v a) x
from :: forall x. ShallowListEntry v a -&gt; Rep (ShallowListEntry v a) x
$cto :: forall v a x. Rep (ShallowListEntry v a) x -&gt; ShallowListEntry v a
to :: forall x. Rep (ShallowListEntry v a) x -&gt; ShallowListEntry v a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="hs-comment">-- __TODO__: This is only used for sorting, and it seems like it might be better</span><span>
</span><span id="line-203"></span><span class="hs-comment">--           to avoid `Text` and instead</span><span>
</span><span id="line-204"></span><span class="hs-comment">--        1. compare as `Name` (using `Name.fromSegment`) and</span><span>
</span><span id="line-205"></span><span class="hs-comment">--        2. make that the `Ord` instance.</span><span>
</span><span id="line-206"></span><span id="local-6989586621679347173"><span id="local-6989586621679347174"><span class="annot"><a href="Unison.Server.Backend.html#listEntryName"><span class="hs-identifier hs-type">listEntryName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#ShallowListEntry"><span class="hs-identifier hs-type">ShallowListEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347173"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347174"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span></span></span><span>
</span><span id="line-207"></span><span id="listEntryName"><span class="annot"><span class="annottext">listEntryName :: forall v a. ShallowListEntry v a -&gt; Text
</span><a href="Unison.Server.Backend.html#listEntryName"><span class="hs-identifier hs-var hs-var">listEntryName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-208"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#ShallowTermEntry"><span class="hs-identifier hs-type">ShallowTermEntry</span></a></span><span> </span><span id="local-6989586621679348357"><span class="annot"><span class="annottext">TermEntry v a
</span><a href="#local-6989586621679348357"><span class="hs-identifier hs-var">te</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermEntry v a -&gt; Text
forall v a. TermEntry v a -&gt; Text
</span><a href="Unison.Server.Backend.html#termEntryDisplayName"><span class="hs-identifier hs-var">termEntryDisplayName</span></a></span><span> </span><span class="annot"><span class="annottext">TermEntry v a
</span><a href="#local-6989586621679348357"><span class="hs-identifier hs-var">te</span></a></span><span>
</span><span id="line-209"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#ShallowTypeEntry"><span class="hs-identifier hs-type">ShallowTypeEntry</span></a></span><span> </span><span id="local-6989586621679348358"><span class="annot"><span class="annottext">TypeEntry
</span><a href="#local-6989586621679348358"><span class="hs-identifier hs-var">te</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeEntry -&gt; Text
</span><a href="Unison.Server.Backend.html#typeEntryDisplayName"><span class="hs-identifier hs-var">typeEntryDisplayName</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEntry
</span><a href="#local-6989586621679348358"><span class="hs-identifier hs-var">te</span></a></span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#ShallowBranchEntry"><span class="hs-identifier hs-type">ShallowBranchEntry</span></a></span><span> </span><span id="local-6989586621679348359"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679348359"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NamespaceStats
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Text
</span><span class="hs-identifier hs-var">NameSegment.toEscapedText</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679348359"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-211"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#ShallowPatchEntry"><span class="hs-identifier hs-type">ShallowPatchEntry</span></a></span><span> </span><span id="local-6989586621679348360"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679348360"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Text
</span><span class="hs-identifier hs-var">NameSegment.toEscapedText</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679348360"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="hs-keyword">data</span><span> </span><span id="BackendError"><span class="annot"><a href="Unison.Server.Backend.html#BackendError"><span class="hs-identifier hs-var">BackendError</span></a></span></span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NoSuchNamespace"><span class="annot"><a href="Unison.Server.Backend.html#NoSuchNamespace"><span class="hs-identifier hs-var">NoSuchNamespace</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- Failed to parse path</span><span>
</span><span id="line-216"></span><span>    </span><span id="BadNamespace"><span class="annot"><a href="Unison.Server.Backend.html#BadNamespace"><span class="hs-identifier hs-var">BadNamespace</span></a></span></span><span>
</span><span id="line-217"></span><span>      </span><span class="annot"><span class="hs-comment">-- | error message</span></span><span>
</span><span id="line-218"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-219"></span><span>      </span><span class="annot"><span class="hs-comment">-- | namespace</span></span><span>
</span><span id="line-220"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CouldntExpandBranchHash"><span class="annot"><a href="Unison.Server.Backend.html#CouldntExpandBranchHash"><span class="hs-identifier hs-var">CouldntExpandBranchHash</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortCausalHash</span></span><span>
</span><span id="line-222"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="AmbiguousBranchHash"><span class="annot"><a href="Unison.Server.Backend.html#AmbiguousBranchHash"><span class="hs-identifier hs-var">AmbiguousBranchHash</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortCausalHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortCausalHash</span></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="AmbiguousHashForDefinition"><span class="annot"><a href="Unison.Server.Backend.html#AmbiguousHashForDefinition"><span class="hs-identifier hs-var">AmbiguousHashForDefinition</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortHash</span></span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NoBranchForHash"><span class="annot"><a href="Unison.Server.Backend.html#NoBranchForHash"><span class="hs-identifier hs-var">NoBranchForHash</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CouldntLoadBranch"><span class="annot"><a href="Unison.Server.Backend.html#CouldntLoadBranch"><span class="hs-identifier hs-var">CouldntLoadBranch</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MissingSignatureForTerm"><span class="annot"><a href="Unison.Server.Backend.html#MissingSignatureForTerm"><span class="hs-identifier hs-var">MissingSignatureForTerm</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NoSuchDefinition"><span class="annot"><a href="Unison.Server.Backend.html#NoSuchDefinition"><span class="hs-identifier hs-var">NoSuchDefinition</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- We needed a name lookup index we didn't have.</span><span>
</span><span id="line-229"></span><span>    </span><span id="ExpectedNameLookup"><span class="annot"><a href="Unison.Server.Backend.html#ExpectedNameLookup"><span class="hs-identifier hs-var">ExpectedNameLookup</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BranchHash</span></span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- The inferred project root for a given perspective is neither a parent nor child</span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-comment">-- of the perspective. This shouldn't happen and indicates a bug.</span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-comment">-- (perspective, project root)</span><span>
</span><span id="line-233"></span><span>    </span><span id="DisjointProjectAndPerspective"><span class="annot"><a href="Unison.Server.Backend.html#DisjointProjectAndPerspective"><span class="hs-identifier hs-var">DisjointProjectAndPerspective</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ProjectBranchNameNotFound"><span class="annot"><a href="Unison.Server.Backend.html#ProjectBranchNameNotFound"><span class="hs-identifier hs-var">ProjectBranchNameNotFound</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectName</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchName</span></span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679348374"><span id="local-6989586621679348419"><span id="local-6989586621679348423"><span class="annot"><span class="annottext">Int -&gt; BackendError -&gt; ShowS
[BackendError] -&gt; ShowS
BackendError -&gt; WatchKind
(Int -&gt; BackendError -&gt; ShowS)
-&gt; (BackendError -&gt; WatchKind)
-&gt; ([BackendError] -&gt; ShowS)
-&gt; Show BackendError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; WatchKind) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; BackendError -&gt; ShowS
showsPrec :: Int -&gt; BackendError -&gt; ShowS
$cshow :: BackendError -&gt; WatchKind
show :: BackendError -&gt; WatchKind
$cshowList :: [BackendError] -&gt; ShowS
showList :: [BackendError] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="hs-keyword">newtype</span><span> </span><span id="BackendEnv"><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-var">BackendEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BackendEnv"><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-var">BackendEnv</span></a></span></span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-comment">-- | Whether to use the sqlite name-lookup table to generate Names objects rather than building Names from the root branch.</span></span><span>
</span><span id="line-239"></span><span>    </span><span id="%24sel%3AuseNamesIndex%3ABackendEnv"><span class="annot"><span class="annottext">BackendEnv -&gt; Bool
</span><a href="Unison.Server.Backend.html#%24sel%3AuseNamesIndex%3ABackendEnv"><span class="hs-identifier hs-var hs-var">useNamesIndex</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-240"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="hs-keyword">newtype</span><span> </span><span id="Backend"><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-var">Backend</span></a></span></span><span> </span><span id="local-6989586621679347191"><span class="annot"><a href="#local-6989586621679347191"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679347192"><span class="annot"><a href="#local-6989586621679347192"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Backend"><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-var">Backend</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3ArunBackend%3ABackend"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Backend m a -&gt; ReaderT BackendEnv (ExceptT BackendError m) a
</span><a href="Unison.Server.Backend.html#%24sel%3ArunBackend%3ABackend"><span class="hs-identifier hs-var hs-var">runBackend</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#BackendError"><span class="hs-identifier hs-type">BackendError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347191"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679347192"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679348435"><span id="local-6989586621679348441"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; Backend m a -&gt; Backend m b)
-&gt; (forall a b. a -&gt; Backend m b -&gt; Backend m a)
-&gt; Functor (Backend m)
forall a b. a -&gt; Backend m b -&gt; Backend m a
forall a b. (a -&gt; b) -&gt; Backend m a -&gt; Backend m b
forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; Backend m b -&gt; Backend m a
forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; Backend m a -&gt; Backend m b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; Backend m a -&gt; Backend m b
fmap :: forall a b. (a -&gt; b) -&gt; Backend m a -&gt; Backend m b
$c&lt;$ :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; Backend m b -&gt; Backend m a
&lt;$ :: forall a b. a -&gt; Backend m b -&gt; Backend m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348452"><span id="local-6989586621679348458"><span id="local-6989586621679348463"><span id="local-6989586621679348468"><span id="local-6989586621679348473"><span class="annot"><span class="annottext">Functor (Backend m)
Functor (Backend m) =&gt;
(forall a. a -&gt; Backend m a)
-&gt; (forall a b. Backend m (a -&gt; b) -&gt; Backend m a -&gt; Backend m b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c) -&gt; Backend m a -&gt; Backend m b -&gt; Backend m c)
-&gt; (forall a b. Backend m a -&gt; Backend m b -&gt; Backend m b)
-&gt; (forall a b. Backend m a -&gt; Backend m b -&gt; Backend m a)
-&gt; Applicative (Backend m)
forall a. a -&gt; Backend m a
forall a b. Backend m a -&gt; Backend m b -&gt; Backend m a
forall a b. Backend m a -&gt; Backend m b -&gt; Backend m b
forall a b. Backend m (a -&gt; b) -&gt; Backend m a -&gt; Backend m b
forall a b c.
(a -&gt; b -&gt; c) -&gt; Backend m a -&gt; Backend m b -&gt; Backend m c
forall (m :: * -&gt; *). Monad m =&gt; Functor (Backend m)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; Backend m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
Backend m a -&gt; Backend m b -&gt; Backend m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
Backend m a -&gt; Backend m b -&gt; Backend m b
forall (m :: * -&gt; *) a b.
Monad m =&gt;
Backend m (a -&gt; b) -&gt; Backend m a -&gt; Backend m b
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; b -&gt; c) -&gt; Backend m a -&gt; Backend m b -&gt; Backend m c
forall (f :: * -&gt; *).
Functor f =&gt;
(forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
$cpure :: forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; Backend m a
pure :: forall a. a -&gt; Backend m a
$c&lt;*&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
Backend m (a -&gt; b) -&gt; Backend m a -&gt; Backend m b
&lt;*&gt; :: forall a b. Backend m (a -&gt; b) -&gt; Backend m a -&gt; Backend m b
$cliftA2 :: forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; b -&gt; c) -&gt; Backend m a -&gt; Backend m b -&gt; Backend m c
liftA2 :: forall a b c.
(a -&gt; b -&gt; c) -&gt; Backend m a -&gt; Backend m b -&gt; Backend m c
$c*&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
Backend m a -&gt; Backend m b -&gt; Backend m b
*&gt; :: forall a b. Backend m a -&gt; Backend m b -&gt; Backend m b
$c&lt;* :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
Backend m a -&gt; Backend m b -&gt; Backend m a
&lt;* :: forall a b. Backend m a -&gt; Backend m b -&gt; Backend m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348486"><span id="local-6989586621679348492"><span id="local-6989586621679348497"><span class="annot"><span class="annottext">Applicative (Backend m)
Applicative (Backend m) =&gt;
(forall a b. Backend m a -&gt; (a -&gt; Backend m b) -&gt; Backend m b)
-&gt; (forall a b. Backend m a -&gt; Backend m b -&gt; Backend m b)
-&gt; (forall a. a -&gt; Backend m a)
-&gt; Monad (Backend m)
forall a. a -&gt; Backend m a
forall a b. Backend m a -&gt; Backend m b -&gt; Backend m b
forall a b. Backend m a -&gt; (a -&gt; Backend m b) -&gt; Backend m b
forall (m :: * -&gt; *). Monad m =&gt; Applicative (Backend m)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; Backend m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
Backend m a -&gt; Backend m b -&gt; Backend m b
forall (m :: * -&gt; *) a b.
Monad m =&gt;
Backend m a -&gt; (a -&gt; Backend m b) -&gt; Backend m b
forall (m :: * -&gt; *).
Applicative m =&gt;
(forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
$c&gt;&gt;= :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
Backend m a -&gt; (a -&gt; Backend m b) -&gt; Backend m b
&gt;&gt;= :: forall a b. Backend m a -&gt; (a -&gt; Backend m b) -&gt; Backend m b
$c&gt;&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
Backend m a -&gt; Backend m b -&gt; Backend m b
&gt;&gt; :: forall a b. Backend m a -&gt; Backend m b -&gt; Backend m b
$creturn :: forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; Backend m a
return :: forall a. a -&gt; Backend m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348508"><span class="annot"><span class="annottext">Monad (Backend m)
Monad (Backend m) =&gt;
(forall a. IO a -&gt; Backend m a) -&gt; MonadIO (Backend m)
forall a. IO a -&gt; Backend m a
forall (m :: * -&gt; *).
Monad m =&gt;
(forall a. IO a -&gt; m a) -&gt; MonadIO m
forall (m :: * -&gt; *). MonadIO m =&gt; Monad (Backend m)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; Backend m a
$cliftIO :: forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; Backend m a
liftIO :: forall a. IO a -&gt; Backend m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348520"><span id="local-6989586621679348526"><span id="local-6989586621679348531"><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#BackendEnv"><span class="hs-identifier hs-type">BackendEnv</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348541"><span id="local-6989586621679348547"><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#BackendError"><span class="hs-identifier hs-type">BackendError</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTrans</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-246"></span><span>  </span><span id="local-6989586621679348564"><span class="annot"><span class="annottext">lift :: forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; Backend m a
</span><a href="#local-6989586621679348564"><span class="hs-identifier hs-var hs-var hs-var hs-var">lift</span></a></span></span><span> </span><span id="local-6989586621679348566"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679348566"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT BackendEnv (ExceptT BackendError m) a -&gt; Backend m a
forall (m :: * -&gt; *) a.
ReaderT BackendEnv (ExceptT BackendError m) a -&gt; Backend m a
</span><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-var">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExceptT BackendError m a
-&gt; ReaderT BackendEnv (ExceptT BackendError m) a
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT BackendEnv m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT BackendError m a
 -&gt; ReaderT BackendEnv (ExceptT BackendError m) a)
-&gt; (m a -&gt; ExceptT BackendError m a)
-&gt; m a
-&gt; ReaderT BackendEnv (ExceptT BackendError m) a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">m a -&gt; ExceptT BackendError m a
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT BackendError m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; ReaderT BackendEnv (ExceptT BackendError m) a)
-&gt; m a -&gt; ReaderT BackendEnv (ExceptT BackendError m) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679348566"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span id="local-6989586621679347298"><span id="local-6989586621679347300"><span id="local-6989586621679347301"><span class="annot"><a href="Unison.Server.Backend.html#hoistBackend"><span class="hs-identifier hs-type">hoistBackend</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679347299"><span class="annot"><a href="#local-6989586621679347299"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679347298"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347299"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679347300"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347299"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347298"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347301"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347300"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347301"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-249"></span><span id="hoistBackend"><span class="annot"><span class="annottext">hoistBackend :: forall (m :: * -&gt; *) (n :: * -&gt; *) a.
(forall x. m x -&gt; n x) -&gt; Backend m a -&gt; Backend n a
</span><a href="Unison.Server.Backend.html#hoistBackend"><span class="hs-identifier hs-var hs-var">hoistBackend</span></a></span></span><span> </span><span id="local-6989586621679348568"><span class="annot"><span class="annottext">forall x. m x -&gt; n x
</span><a href="#local-6989586621679348568"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span id="local-6989586621679348569"><span class="annot"><span class="annottext">ReaderT BackendEnv (ExceptT BackendError m) a
</span><a href="#local-6989586621679348569"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-250"></span><span>  </span><span class="annot"><span class="annottext">ReaderT BackendEnv (ExceptT BackendError n) a -&gt; Backend n a
forall (m :: * -&gt; *) a.
ReaderT BackendEnv (ExceptT BackendError m) a -&gt; Backend m a
</span><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-var">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ExceptT BackendError m a -&gt; ExceptT BackendError n a)
-&gt; ReaderT BackendEnv (ExceptT BackendError m) a
-&gt; ReaderT BackendEnv (ExceptT BackendError n) a
forall (m :: * -&gt; *) a (n :: * -&gt; *) b r.
(m a -&gt; n b) -&gt; ReaderT r m a -&gt; ReaderT r n b
</span><span class="hs-identifier hs-var">mapReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(m (Either BackendError a) -&gt; n (Either BackendError a))
-&gt; ExceptT BackendError m a -&gt; ExceptT BackendError n a
forall (m :: * -&gt; *) e a (n :: * -&gt; *) e' b.
(m (Either e a) -&gt; n (Either e' b))
-&gt; ExceptT e m a -&gt; ExceptT e' n b
</span><span class="hs-identifier hs-var">mapExceptT</span></span><span> </span><span class="annot"><span class="annottext">m (Either BackendError a) -&gt; n (Either BackendError a)
forall x. m x -&gt; n x
</span><a href="#local-6989586621679348568"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReaderT BackendEnv (ExceptT BackendError m) a
</span><a href="#local-6989586621679348569"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span id="local-6989586621679347316"><span class="annot"><a href="Unison.Server.Backend.html#loadReferentType"><span class="hs-identifier hs-type">loadReferentType</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-253"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679347316"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-254"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-255"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-256"></span><span id="loadReferentType"><span class="annot"><span class="annottext">loadReferentType :: forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; Referent -&gt; Transaction (Maybe (Type Symbol Ann))
</span><a href="Unison.Server.Backend.html#loadReferentType"><span class="hs-identifier hs-var hs-var">loadReferentType</span></a></span></span><span> </span><span id="local-6989586621679348582"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679348582"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-257"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span id="local-6989586621679348584"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679348584"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; TypeReference -&gt; Transaction (Maybe (Type Symbol Ann))
forall a (m :: * -&gt; *).
BuiltinAnnotation a =&gt;
Codebase m Symbol a
-&gt; TypeReference -&gt; Transaction (Maybe (Type Symbol a))
</span><span class="hs-identifier hs-var">Codebase.getTypeOfTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679348582"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679348584"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-258"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Referent.Con</span></span><span> </span><span id="local-6989586621679348587"><span class="annot"><span class="annottext">GConstructorReference TypeReference
</span><a href="#local-6989586621679348587"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConstructorType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GConstructorReference TypeReference
-&gt; Transaction (Maybe (Type Symbol Ann))
</span><a href="#local-6989586621679348588"><span class="hs-identifier hs-var">getTypeOfConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">GConstructorReference TypeReference
</span><a href="#local-6989586621679348587"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-comment">-- Mitchell wonders: why was this definition copied from Unison.Codebase?</span><span>
</span><span id="line-261"></span><span>    </span><span id="local-6989586621679348588"><span class="annot"><span class="annottext">getTypeOfConstructor :: GConstructorReference TypeReference
-&gt; Transaction (Maybe (Type Symbol Ann))
</span><a href="#local-6989586621679348588"><span class="hs-identifier hs-var hs-var">getTypeOfConstructor</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConstructorReference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679348591"><span class="annot"><span class="annottext">Id' Hash
</span><a href="#local-6989586621679348591"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679348592"><span class="annot"><span class="annottext">ConstructorId
</span><a href="#local-6989586621679348592"><span class="hs-identifier hs-var">cid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-262"></span><span>      </span><span id="local-6989586621679348593"><span class="annot"><span class="annottext">Maybe (Decl Symbol Ann)
</span><a href="#local-6989586621679348593"><span class="hs-identifier hs-var">maybeDecl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; Id' Hash -&gt; Transaction (Maybe (Decl Symbol Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id' Hash -&gt; Transaction (Maybe (Decl v a))
</span><span class="hs-identifier hs-var">Codebase.getTypeDeclaration</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679348582"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id' Hash
</span><a href="#local-6989586621679348591"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-263"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Decl Symbol Ann)
</span><a href="#local-6989586621679348593"><span class="hs-identifier hs-var">maybeDecl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-264"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Decl Symbol Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-265"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679348595"><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679348595"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DataDeclaration Symbol Ann
-&gt; ConstructorId -&gt; Maybe (Type Symbol Ann)
forall v a.
DataDeclaration v a -&gt; ConstructorId -&gt; Maybe (Type v a)
</span><span class="hs-identifier hs-var">DD.typeOfConstructor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EffectDeclaration Symbol Ann -&gt; DataDeclaration Symbol Ann)
-&gt; (DataDeclaration Symbol Ann -&gt; DataDeclaration Symbol Ann)
-&gt; Decl Symbol Ann
-&gt; DataDeclaration Symbol Ann
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">EffectDeclaration Symbol Ann -&gt; DataDeclaration Symbol Ann
forall v a. EffectDeclaration v a -&gt; DataDeclaration v a
</span><span class="hs-identifier hs-var">DD.toDataDecl</span></span><span> </span><span class="annot"><span class="annottext">DataDeclaration Symbol Ann -&gt; DataDeclaration Symbol Ann
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679348595"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConstructorId
</span><a href="#local-6989586621679348592"><span class="hs-identifier hs-var">cid</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><a href="#local-6989586621679348588"><span class="hs-identifier hs-var">getTypeOfConstructor</span></a></span><span> </span><span id="local-6989586621679348600"><span class="annot"><span class="annottext">GConstructorReference TypeReference
</span><a href="#local-6989586621679348600"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-267"></span><span>      </span><span class="annot"><span class="annottext">WatchKind -&gt; Transaction (Maybe (Type Symbol Ann))
forall a. HasCallStack =&gt; WatchKind -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(WatchKind -&gt; Transaction (Maybe (Type Symbol Ann)))
-&gt; WatchKind -&gt; Transaction (Maybe (Type Symbol Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-268"></span><span>        </span><span class="annot"><span class="annottext">WatchKind
</span><span class="hs-string">&quot;Don't know how to getTypeOfConstructor &quot;</span></span><span>
</span><span id="line-269"></span><span>          </span><span class="annot"><span class="annottext">WatchKind -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">GConstructorReference TypeReference -&gt; WatchKind
forall a. Show a =&gt; a -&gt; WatchKind
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">GConstructorReference TypeReference
</span><a href="#local-6989586621679348600"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="hs-keyword">data</span><span> </span><span id="TermEntry"><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-var">TermEntry</span></a></span></span><span> </span><span id="local-6989586621679347344"><span class="annot"><a href="#local-6989586621679347344"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621679347345"><span class="annot"><a href="#local-6989586621679347345"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TermEntry"><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-var">TermEntry</span></a></span></span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AtermEntryReferent%3ATermEntry"><span class="annot"><span class="annottext">forall v a. TermEntry v a -&gt; Referent
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryReferent%3ATermEntry"><span class="hs-identifier hs-var hs-var">termEntryReferent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2Referent.Referent</span></span><span class="hs-special">,</span><span>
</span><span id="line-273"></span><span>    </span><span id="%24sel%3AtermEntryHash%3ATermEntry"><span class="annot"><span class="annottext">forall v a. TermEntry v a -&gt; ShortHash
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryHash%3ATermEntry"><span class="hs-identifier hs-var hs-var">termEntryHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortHash</span></span><span class="hs-special">,</span><span>
</span><span id="line-274"></span><span>    </span><span id="%24sel%3AtermEntryName%3ATermEntry"><span class="annot"><span class="annottext">forall v a. TermEntry v a -&gt; Name
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryName%3ATermEntry"><span class="hs-identifier hs-var hs-var">termEntryName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span>
</span><span id="line-275"></span><span>    </span><span id="%24sel%3AtermEntryConflicted%3ATermEntry"><span class="annot"><span class="annottext">forall v a. TermEntry v a -&gt; Bool
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryConflicted%3ATermEntry"><span class="hs-identifier hs-var hs-var">termEntryConflicted</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span>
</span><span id="line-276"></span><span>    </span><span id="%24sel%3AtermEntryType%3ATermEntry"><span class="annot"><span class="annottext">forall v a. TermEntry v a -&gt; Maybe (Type v a)
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryType%3ATermEntry"><span class="hs-identifier hs-var hs-var">termEntryType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679347344"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347345"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-277"></span><span>    </span><span id="%24sel%3AtermEntryTag%3ATermEntry"><span class="annot"><span class="annottext">forall v a. TermEntry v a -&gt; TermTag
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryTag%3ATermEntry"><span class="hs-identifier hs-var hs-var">termEntryTag</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TermTag"><span class="hs-identifier hs-type">TermTag</span></a></span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679348612"><span id="local-6989586621679348629"><span class="annot"><span class="annottext">TermEntry v a -&gt; TermEntry v a -&gt; Bool
(TermEntry v a -&gt; TermEntry v a -&gt; Bool)
-&gt; (TermEntry v a -&gt; TermEntry v a -&gt; Bool) -&gt; Eq (TermEntry v a)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
$c== :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
== :: TermEntry v a -&gt; TermEntry v a -&gt; Bool
$c/= :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
/= :: TermEntry v a -&gt; TermEntry v a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348644"><span id="local-6989586621679348659"><span id="local-6989586621679348668"><span id="local-6989586621679348671"><span id="local-6989586621679348674"><span id="local-6989586621679348677"><span id="local-6989586621679348680"><span class="annot"><span class="annottext">Eq (TermEntry v a)
Eq (TermEntry v a) =&gt;
(TermEntry v a -&gt; TermEntry v a -&gt; Ordering)
-&gt; (TermEntry v a -&gt; TermEntry v a -&gt; Bool)
-&gt; (TermEntry v a -&gt; TermEntry v a -&gt; Bool)
-&gt; (TermEntry v a -&gt; TermEntry v a -&gt; Bool)
-&gt; (TermEntry v a -&gt; TermEntry v a -&gt; Bool)
-&gt; (TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a)
-&gt; (TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a)
-&gt; Ord (TermEntry v a)
TermEntry v a -&gt; TermEntry v a -&gt; Bool
TermEntry v a -&gt; TermEntry v a -&gt; Ordering
TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall v a. Var v =&gt; Eq (TermEntry v a)
forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Ordering
forall v a.
Var v =&gt;
TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a
$ccompare :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Ordering
compare :: TermEntry v a -&gt; TermEntry v a -&gt; Ordering
$c&lt; :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
&lt; :: TermEntry v a -&gt; TermEntry v a -&gt; Bool
$c&lt;= :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
&lt;= :: TermEntry v a -&gt; TermEntry v a -&gt; Bool
$c&gt; :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
&gt; :: TermEntry v a -&gt; TermEntry v a -&gt; Bool
$c&gt;= :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
&gt;= :: TermEntry v a -&gt; TermEntry v a -&gt; Bool
$cmax :: forall v a.
Var v =&gt;
TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a
max :: TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a
$cmin :: forall v a.
Var v =&gt;
TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a
min :: TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348691"><span id="local-6989586621679348707"><span id="local-6989586621679348710"><span class="annot"><span class="annottext">Int -&gt; TermEntry v a -&gt; ShowS
[TermEntry v a] -&gt; ShowS
TermEntry v a -&gt; WatchKind
(Int -&gt; TermEntry v a -&gt; ShowS)
-&gt; (TermEntry v a -&gt; WatchKind)
-&gt; ([TermEntry v a] -&gt; ShowS)
-&gt; Show (TermEntry v a)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; WatchKind) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall v a. Show v =&gt; Int -&gt; TermEntry v a -&gt; ShowS
forall v a. Show v =&gt; [TermEntry v a] -&gt; ShowS
forall v a. Show v =&gt; TermEntry v a -&gt; WatchKind
$cshowsPrec :: forall v a. Show v =&gt; Int -&gt; TermEntry v a -&gt; ShowS
showsPrec :: Int -&gt; TermEntry v a -&gt; ShowS
$cshow :: forall v a. Show v =&gt; TermEntry v a -&gt; WatchKind
show :: TermEntry v a -&gt; WatchKind
$cshowList :: forall v a. Show v =&gt; [TermEntry v a] -&gt; ShowS
showList :: [TermEntry v a] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348717"><span id="local-6989586621679348719"><span class="annot"><span class="annottext">(forall x. TermEntry v a -&gt; Rep (TermEntry v a) x)
-&gt; (forall x. Rep (TermEntry v a) x -&gt; TermEntry v a)
-&gt; Generic (TermEntry v a)
forall x. Rep (TermEntry v a) x -&gt; TermEntry v a
forall x. TermEntry v a -&gt; Rep (TermEntry v a) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall v a x. Rep (TermEntry v a) x -&gt; TermEntry v a
forall v a x. TermEntry v a -&gt; Rep (TermEntry v a) x
$cfrom :: forall v a x. TermEntry v a -&gt; Rep (TermEntry v a) x
from :: forall x. TermEntry v a -&gt; Rep (TermEntry v a) x
$cto :: forall v a x. Rep (TermEntry v a) x -&gt; TermEntry v a
to :: forall x. Rep (TermEntry v a) x -&gt; TermEntry v a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span id="local-6989586621679347395"><span id="local-6989586621679347396"><span class="annot"><a href="Unison.Server.Backend.html#termEntryLabeledDependencies"><span class="hs-identifier hs-type">termEntryLabeledDependencies</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679347395"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347395"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347396"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LD.LabeledDependency</span></span></span></span><span>
</span><span id="line-282"></span><span id="termEntryLabeledDependencies"><span class="annot"><span class="annottext">termEntryLabeledDependencies :: forall v a. Ord v =&gt; TermEntry v a -&gt; Set LabeledDependency
</span><a href="Unison.Server.Backend.html#termEntryLabeledDependencies"><span class="hs-identifier hs-var hs-var">termEntryLabeledDependencies</span></a></span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679348745"><span class="annot"><span class="annottext">Maybe (Type v a)
$sel:termEntryType:TermEntry :: forall v a. TermEntry v a -&gt; Maybe (Type v a)
termEntryType :: Maybe (Type v a)
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryType%3ATermEntry"><span class="hs-identifier hs-var hs-var">termEntryType</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348746"><span class="annot"><span class="annottext">Referent
$sel:termEntryReferent:TermEntry :: forall v a. TermEntry v a -&gt; Referent
termEntryReferent :: Referent
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryReferent%3ATermEntry"><span class="hs-identifier hs-var hs-var">termEntryReferent</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348747"><span class="annot"><span class="annottext">TermTag
$sel:termEntryTag:TermEntry :: forall v a. TermEntry v a -&gt; TermTag
termEntryTag :: TermTag
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryTag%3ATermEntry"><span class="hs-identifier hs-var hs-var">termEntryTag</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348748"><span class="annot"><span class="annottext">Name
$sel:termEntryName:TermEntry :: forall v a. TermEntry v a -&gt; Name
termEntryName :: Name
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryName%3ATermEntry"><span class="hs-identifier hs-var hs-var">termEntryName</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-283"></span><span>  </span><span class="annot"><span class="annottext">(Type v a -&gt; Set LabeledDependency)
-&gt; Maybe (Type v a) -&gt; Set LabeledDependency
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Maybe a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">Type v a -&gt; Set LabeledDependency
forall v a. Ord v =&gt; Type v a -&gt; Set LabeledDependency
</span><span class="hs-identifier hs-var">Type.labeledDependencies</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Type v a)
</span><a href="#local-6989586621679348745"><span class="hs-identifier hs-var">termEntryType</span></a></span><span>
</span><span id="line-284"></span><span>    </span><span class="annot"><span class="annottext">Set LabeledDependency
-&gt; Set LabeledDependency -&gt; Set LabeledDependency
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">LabeledDependency -&gt; Set LabeledDependency
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Referent -&gt; LabeledDependency
</span><span class="hs-identifier hs-var">LD.TermReferent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConstructorType -&gt; Referent -&gt; Referent
</span><span class="hs-identifier hs-var">Cv.referent2to1UsingCT</span></span><span> </span><span class="annot"><span class="annottext">ConstructorType
</span><a href="#local-6989586621679348754"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679348746"><span class="hs-identifier hs-var">termEntryReferent</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-286"></span><span>    </span><span class="annot"><a href="#local-6989586621679348754"><span class="hs-identifier hs-type">ct</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2Referent.ConstructorType</span></span><span>
</span><span id="line-287"></span><span>    </span><span id="local-6989586621679348754"><span class="annot"><span class="annottext">ct :: ConstructorType
</span><a href="#local-6989586621679348754"><span class="hs-identifier hs-var hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TermTag
</span><a href="#local-6989586621679348747"><span class="hs-identifier hs-var">termEntryTag</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-288"></span><span>      </span><span class="annot"><a href="Unison.Server.Types.html#Constructor"><span class="hs-identifier hs-type">ServerTypes.Constructor</span></a></span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="Unison.Server.Types.html#Ability"><span class="hs-identifier hs-var">ServerTypes.Ability</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConstructorType
</span><span class="hs-identifier hs-var">V2Referent.EffectConstructor</span></span><span>
</span><span id="line-289"></span><span>      </span><span class="annot"><a href="Unison.Server.Types.html#Constructor"><span class="hs-identifier hs-type">ServerTypes.Constructor</span></a></span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="Unison.Server.Types.html#Data"><span class="hs-identifier hs-var">ServerTypes.Data</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConstructorType
</span><span class="hs-identifier hs-var">V2Referent.DataConstructor</span></span><span>
</span><span id="line-290"></span><span>      </span><span class="annot"><span class="annottext">TermTag
</span><a href="Unison.Server.Types.html#Doc"><span class="hs-identifier hs-var">ServerTypes.Doc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConstructorType
</span><span class="hs-identifier hs-var">V2Referent.DataConstructor</span></span><span>
</span><span id="line-291"></span><span>      </span><span class="annot"><span class="annottext">TermTag
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WatchKind -&gt; ConstructorType
forall a. HasCallStack =&gt; WatchKind -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(WatchKind -&gt; ConstructorType) -&gt; WatchKind -&gt; ConstructorType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><span class="hs-string">&quot;termEntryLabeledDependencies: Term is not a constructor, but the referent was a constructor. Tag: &quot;</span></span><span> </span><span class="annot"><span class="annottext">WatchKind -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TermTag -&gt; WatchKind
forall a. Show a =&gt; a -&gt; WatchKind
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TermTag
</span><a href="#local-6989586621679348747"><span class="hs-identifier hs-var">termEntryTag</span></a></span><span> </span><span class="annot"><span class="annottext">WatchKind -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><span class="hs-string">&quot; Name: &quot;</span></span><span> </span><span class="annot"><span class="annottext">WatchKind -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; WatchKind
forall a. Show a =&gt; a -&gt; WatchKind
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679348748"><span class="hs-identifier hs-var">termEntryName</span></a></span><span> </span><span class="annot"><span class="annottext">WatchKind -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><span class="hs-string">&quot; Referent: &quot;</span></span><span> </span><span class="annot"><span class="annottext">WatchKind -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; WatchKind
forall a. Show a =&gt; a -&gt; WatchKind
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679348746"><span class="hs-identifier hs-var">termEntryReferent</span></a></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span id="local-6989586621679347177"><span id="local-6989586621679347178"><span class="annot"><a href="Unison.Server.Backend.html#termEntryDisplayName"><span class="hs-identifier hs-type">termEntryDisplayName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347177"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347178"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span></span></span><span>
</span><span id="line-294"></span><span id="termEntryDisplayName"><span class="annot"><span class="annottext">termEntryDisplayName :: forall v a. TermEntry v a -&gt; Text
</span><a href="Unison.Server.Backend.html#termEntryDisplayName"><span class="hs-identifier hs-var hs-var">termEntryDisplayName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Text) -&gt; HashQualified Name -&gt; Text
forall n. (n -&gt; Text) -&gt; HashQualified n -&gt; Text
</span><span class="hs-identifier hs-var">HQ'.toTextWith</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; Text)
-&gt; (TermEntry v a -&gt; HashQualified Name) -&gt; TermEntry v a -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TermEntry v a -&gt; HashQualified Name
forall v a. TermEntry v a -&gt; HashQualified Name
</span><a href="Unison.Server.Backend.html#termEntryHQName"><span class="hs-identifier hs-var">termEntryHQName</span></a></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span id="local-6989586621679347413"><span id="local-6989586621679347414"><span class="annot"><a href="Unison.Server.Backend.html#termEntryHQName"><span class="hs-identifier hs-type">termEntryHQName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347413"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347414"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span></span></span><span>
</span><span id="line-297"></span><span id="termEntryHQName"><span class="annot"><span class="annottext">termEntryHQName :: forall v a. TermEntry v a -&gt; HashQualified Name
</span><a href="Unison.Server.Backend.html#termEntryHQName"><span class="hs-identifier hs-var hs-var">termEntryHQName</span></a></span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679348762"><span class="annot"><span class="annottext">Name
$sel:termEntryName:TermEntry :: forall v a. TermEntry v a -&gt; Name
termEntryName :: Name
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryName%3ATermEntry"><span class="hs-identifier hs-var hs-var">termEntryName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348763"><span class="annot"><span class="annottext">Bool
$sel:termEntryConflicted:TermEntry :: forall v a. TermEntry v a -&gt; Bool
termEntryConflicted :: Bool
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryConflicted%3ATermEntry"><span class="hs-identifier hs-var hs-var">termEntryConflicted</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348764"><span class="annot"><span class="annottext">ShortHash
$sel:termEntryHash:TermEntry :: forall v a. TermEntry v a -&gt; ShortHash
termEntryHash :: ShortHash
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryHash%3ATermEntry"><span class="hs-identifier hs-var hs-var">termEntryHash</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679348763"><span class="hs-identifier hs-var">termEntryConflicted</span></a></span><span>
</span><span id="line-299"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Name -&gt; ShortHash -&gt; HashQualified Name
forall n. n -&gt; ShortHash -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679348762"><span class="hs-identifier hs-var">termEntryName</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679348764"><span class="hs-identifier hs-var">termEntryHash</span></a></span><span>
</span><span id="line-300"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Name -&gt; HashQualified Name
forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.NameOnly</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679348762"><span class="hs-identifier hs-var">termEntryName</span></a></span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="hs-keyword">data</span><span> </span><span id="TypeEntry"><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-var">TypeEntry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TypeEntry"><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-var">TypeEntry</span></a></span></span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AtypeEntryReference%3ATypeEntry"><span class="annot"><span class="annottext">TypeEntry -&gt; TypeReference
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryReference%3ATypeEntry"><span class="hs-identifier hs-var hs-var">typeEntryReference</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">,</span><span>
</span><span id="line-304"></span><span>    </span><span id="%24sel%3AtypeEntryHash%3ATypeEntry"><span class="annot"><span class="annottext">TypeEntry -&gt; ShortHash
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryHash%3ATypeEntry"><span class="hs-identifier hs-var hs-var">typeEntryHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortHash</span></span><span class="hs-special">,</span><span>
</span><span id="line-305"></span><span>    </span><span id="%24sel%3AtypeEntryName%3ATypeEntry"><span class="annot"><span class="annottext">TypeEntry -&gt; Name
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryName%3ATypeEntry"><span class="hs-identifier hs-var hs-var">typeEntryName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span>
</span><span id="line-306"></span><span>    </span><span id="%24sel%3AtypeEntryConflicted%3ATypeEntry"><span class="annot"><span class="annottext">TypeEntry -&gt; Bool
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryConflicted%3ATypeEntry"><span class="hs-identifier hs-var hs-var">typeEntryConflicted</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span>
</span><span id="line-307"></span><span>    </span><span id="%24sel%3AtypeEntryTag%3ATypeEntry"><span class="annot"><span class="annottext">TypeEntry -&gt; TypeTag
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryTag%3ATypeEntry"><span class="hs-identifier hs-var hs-var">typeEntryTag</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TypeTag"><span class="hs-identifier hs-type">TypeTag</span></a></span><span>
</span><span id="line-308"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-309"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679348774"><span id="local-6989586621679348784"><span class="annot"><span class="annottext">TypeEntry -&gt; TypeEntry -&gt; Bool
(TypeEntry -&gt; TypeEntry -&gt; Bool)
-&gt; (TypeEntry -&gt; TypeEntry -&gt; Bool) -&gt; Eq TypeEntry
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: TypeEntry -&gt; TypeEntry -&gt; Bool
== :: TypeEntry -&gt; TypeEntry -&gt; Bool
$c/= :: TypeEntry -&gt; TypeEntry -&gt; Bool
/= :: TypeEntry -&gt; TypeEntry -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348789"><span id="local-6989586621679348797"><span id="local-6989586621679348804"><span id="local-6989586621679348807"><span id="local-6989586621679348810"><span id="local-6989586621679348813"><span id="local-6989586621679348816"><span class="annot"><span class="annottext">Eq TypeEntry
Eq TypeEntry =&gt;
(TypeEntry -&gt; TypeEntry -&gt; Ordering)
-&gt; (TypeEntry -&gt; TypeEntry -&gt; Bool)
-&gt; (TypeEntry -&gt; TypeEntry -&gt; Bool)
-&gt; (TypeEntry -&gt; TypeEntry -&gt; Bool)
-&gt; (TypeEntry -&gt; TypeEntry -&gt; Bool)
-&gt; (TypeEntry -&gt; TypeEntry -&gt; TypeEntry)
-&gt; (TypeEntry -&gt; TypeEntry -&gt; TypeEntry)
-&gt; Ord TypeEntry
TypeEntry -&gt; TypeEntry -&gt; Bool
TypeEntry -&gt; TypeEntry -&gt; Ordering
TypeEntry -&gt; TypeEntry -&gt; TypeEntry
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: TypeEntry -&gt; TypeEntry -&gt; Ordering
compare :: TypeEntry -&gt; TypeEntry -&gt; Ordering
$c&lt; :: TypeEntry -&gt; TypeEntry -&gt; Bool
&lt; :: TypeEntry -&gt; TypeEntry -&gt; Bool
$c&lt;= :: TypeEntry -&gt; TypeEntry -&gt; Bool
&lt;= :: TypeEntry -&gt; TypeEntry -&gt; Bool
$c&gt; :: TypeEntry -&gt; TypeEntry -&gt; Bool
&gt; :: TypeEntry -&gt; TypeEntry -&gt; Bool
$c&gt;= :: TypeEntry -&gt; TypeEntry -&gt; Bool
&gt;= :: TypeEntry -&gt; TypeEntry -&gt; Bool
$cmax :: TypeEntry -&gt; TypeEntry -&gt; TypeEntry
max :: TypeEntry -&gt; TypeEntry -&gt; TypeEntry
$cmin :: TypeEntry -&gt; TypeEntry -&gt; TypeEntry
min :: TypeEntry -&gt; TypeEntry -&gt; TypeEntry
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348819"><span id="local-6989586621679348830"><span id="local-6989586621679348833"><span class="annot"><span class="annottext">Int -&gt; TypeEntry -&gt; ShowS
[TypeEntry] -&gt; ShowS
TypeEntry -&gt; WatchKind
(Int -&gt; TypeEntry -&gt; ShowS)
-&gt; (TypeEntry -&gt; WatchKind)
-&gt; ([TypeEntry] -&gt; ShowS)
-&gt; Show TypeEntry
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; WatchKind) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; TypeEntry -&gt; ShowS
showsPrec :: Int -&gt; TypeEntry -&gt; ShowS
$cshow :: TypeEntry -&gt; WatchKind
show :: TypeEntry -&gt; WatchKind
$cshowList :: [TypeEntry] -&gt; ShowS
showList :: [TypeEntry] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348836"><span id="local-6989586621679348838"><span class="annot"><span class="annottext">(forall x. TypeEntry -&gt; Rep TypeEntry x)
-&gt; (forall x. Rep TypeEntry x -&gt; TypeEntry) -&gt; Generic TypeEntry
forall x. Rep TypeEntry x -&gt; TypeEntry
forall x. TypeEntry -&gt; Rep TypeEntry x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. TypeEntry -&gt; Rep TypeEntry x
from :: forall x. TypeEntry -&gt; Rep TypeEntry x
$cto :: forall x. Rep TypeEntry x -&gt; TypeEntry
to :: forall x. Rep TypeEntry x -&gt; TypeEntry
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="annot"><a href="Unison.Server.Backend.html#typeEntryLabeledDependencies"><span class="hs-identifier hs-type">typeEntryLabeledDependencies</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LD.LabeledDependency</span></span><span>
</span><span id="line-312"></span><span id="typeEntryLabeledDependencies"><span class="annot"><span class="annottext">typeEntryLabeledDependencies :: TypeEntry -&gt; Set LabeledDependency
</span><a href="Unison.Server.Backend.html#typeEntryLabeledDependencies"><span class="hs-identifier hs-var hs-var">typeEntryLabeledDependencies</span></a></span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679348840"><span class="annot"><span class="annottext">TypeReference
$sel:typeEntryReference:TypeEntry :: TypeEntry -&gt; TypeReference
typeEntryReference :: TypeReference
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryReference%3ATypeEntry"><span class="hs-identifier hs-var hs-var">typeEntryReference</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-313"></span><span>  </span><span class="annot"><span class="annottext">LabeledDependency -&gt; Set LabeledDependency
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference -&gt; LabeledDependency
</span><span class="hs-identifier hs-var">LD.TypeReference</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679348840"><span class="hs-identifier hs-var">typeEntryReference</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span class="annot"><a href="Unison.Server.Backend.html#typeEntryDisplayName"><span class="hs-identifier hs-type">typeEntryDisplayName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-316"></span><span id="typeEntryDisplayName"><span class="annot"><span class="annottext">typeEntryDisplayName :: TypeEntry -&gt; Text
</span><a href="Unison.Server.Backend.html#typeEntryDisplayName"><span class="hs-identifier hs-var hs-var">typeEntryDisplayName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Text) -&gt; HashQualified Name -&gt; Text
forall n. (n -&gt; Text) -&gt; HashQualified n -&gt; Text
</span><span class="hs-identifier hs-var">HQ'.toTextWith</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; Text)
-&gt; (TypeEntry -&gt; HashQualified Name) -&gt; TypeEntry -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TypeEntry -&gt; HashQualified Name
</span><a href="Unison.Server.Backend.html#typeEntryHQName"><span class="hs-identifier hs-var">typeEntryHQName</span></a></span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span class="annot"><a href="Unison.Server.Backend.html#typeEntryHQName"><span class="hs-identifier hs-type">typeEntryHQName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-319"></span><span id="typeEntryHQName"><span class="annot"><span class="annottext">typeEntryHQName :: TypeEntry -&gt; HashQualified Name
</span><a href="Unison.Server.Backend.html#typeEntryHQName"><span class="hs-identifier hs-var hs-var">typeEntryHQName</span></a></span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679348842"><span class="annot"><span class="annottext">Name
$sel:typeEntryName:TypeEntry :: TypeEntry -&gt; Name
typeEntryName :: Name
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryName%3ATypeEntry"><span class="hs-identifier hs-var hs-var">typeEntryName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348843"><span class="annot"><span class="annottext">Bool
$sel:typeEntryConflicted:TypeEntry :: TypeEntry -&gt; Bool
typeEntryConflicted :: Bool
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryConflicted%3ATypeEntry"><span class="hs-identifier hs-var hs-var">typeEntryConflicted</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348844"><span class="annot"><span class="annottext">TypeReference
$sel:typeEntryReference:TypeEntry :: TypeEntry -&gt; TypeReference
typeEntryReference :: TypeReference
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryReference%3ATypeEntry"><span class="hs-identifier hs-var hs-var">typeEntryReference</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679348843"><span class="hs-identifier hs-var">typeEntryConflicted</span></a></span><span>
</span><span id="line-321"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Name -&gt; ShortHash -&gt; HashQualified Name
forall n. n -&gt; ShortHash -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679348842"><span class="hs-identifier hs-var">typeEntryName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.toShortHash</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679348844"><span class="hs-identifier hs-var">typeEntryReference</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Name -&gt; HashQualified Name
forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.NameOnly</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679348842"><span class="hs-identifier hs-var">typeEntryName</span></a></span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span class="hs-keyword">data</span><span> </span><span id="FoundRef"><span class="annot"><a href="Unison.Server.Backend.html#FoundRef"><span class="hs-identifier hs-var">FoundRef</span></a></span></span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="FoundTermRef"><span class="annot"><a href="Unison.Server.Backend.html#FoundTermRef"><span class="hs-identifier hs-var">FoundTermRef</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="FoundTypeRef"><span class="annot"><a href="Unison.Server.Backend.html#FoundTypeRef"><span class="hs-identifier hs-var">FoundTypeRef</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-327"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679348849"><span id="local-6989586621679348855"><span class="annot"><span class="annottext">FoundRef -&gt; FoundRef -&gt; Bool
(FoundRef -&gt; FoundRef -&gt; Bool)
-&gt; (FoundRef -&gt; FoundRef -&gt; Bool) -&gt; Eq FoundRef
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: FoundRef -&gt; FoundRef -&gt; Bool
== :: FoundRef -&gt; FoundRef -&gt; Bool
$c/= :: FoundRef -&gt; FoundRef -&gt; Bool
/= :: FoundRef -&gt; FoundRef -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348863"><span id="local-6989586621679348867"><span id="local-6989586621679348871"><span id="local-6989586621679348875"><span id="local-6989586621679348878"><span id="local-6989586621679348881"><span id="local-6989586621679348884"><span class="annot"><span class="annottext">Eq FoundRef
Eq FoundRef =&gt;
(FoundRef -&gt; FoundRef -&gt; Ordering)
-&gt; (FoundRef -&gt; FoundRef -&gt; Bool)
-&gt; (FoundRef -&gt; FoundRef -&gt; Bool)
-&gt; (FoundRef -&gt; FoundRef -&gt; Bool)
-&gt; (FoundRef -&gt; FoundRef -&gt; Bool)
-&gt; (FoundRef -&gt; FoundRef -&gt; FoundRef)
-&gt; (FoundRef -&gt; FoundRef -&gt; FoundRef)
-&gt; Ord FoundRef
FoundRef -&gt; FoundRef -&gt; Bool
FoundRef -&gt; FoundRef -&gt; Ordering
FoundRef -&gt; FoundRef -&gt; FoundRef
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: FoundRef -&gt; FoundRef -&gt; Ordering
compare :: FoundRef -&gt; FoundRef -&gt; Ordering
$c&lt; :: FoundRef -&gt; FoundRef -&gt; Bool
&lt; :: FoundRef -&gt; FoundRef -&gt; Bool
$c&lt;= :: FoundRef -&gt; FoundRef -&gt; Bool
&lt;= :: FoundRef -&gt; FoundRef -&gt; Bool
$c&gt; :: FoundRef -&gt; FoundRef -&gt; Bool
&gt; :: FoundRef -&gt; FoundRef -&gt; Bool
$c&gt;= :: FoundRef -&gt; FoundRef -&gt; Bool
&gt;= :: FoundRef -&gt; FoundRef -&gt; Bool
$cmax :: FoundRef -&gt; FoundRef -&gt; FoundRef
max :: FoundRef -&gt; FoundRef -&gt; FoundRef
$cmin :: FoundRef -&gt; FoundRef -&gt; FoundRef
min :: FoundRef -&gt; FoundRef -&gt; FoundRef
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348887"><span id="local-6989586621679348895"><span id="local-6989586621679348899"><span class="annot"><span class="annottext">Int -&gt; FoundRef -&gt; ShowS
[FoundRef] -&gt; ShowS
FoundRef -&gt; WatchKind
(Int -&gt; FoundRef -&gt; ShowS)
-&gt; (FoundRef -&gt; WatchKind)
-&gt; ([FoundRef] -&gt; ShowS)
-&gt; Show FoundRef
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; WatchKind) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; FoundRef -&gt; ShowS
showsPrec :: Int -&gt; FoundRef -&gt; ShowS
$cshow :: FoundRef -&gt; WatchKind
show :: FoundRef -&gt; WatchKind
$cshowList :: [FoundRef] -&gt; ShowS
showList :: [FoundRef] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348904"><span id="local-6989586621679348906"><span class="annot"><span class="annottext">(forall x. FoundRef -&gt; Rep FoundRef x)
-&gt; (forall x. Rep FoundRef x -&gt; FoundRef) -&gt; Generic FoundRef
forall x. Rep FoundRef x -&gt; FoundRef
forall x. FoundRef -&gt; Rep FoundRef x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. FoundRef -&gt; Rep FoundRef x
from :: forall x. FoundRef -&gt; Rep FoundRef x
$cto :: forall x. Rep FoundRef x -&gt; FoundRef
to :: forall x. Rep FoundRef x -&gt; FoundRef
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span class="hs-comment">-- After finding a search results with fuzzy find we do some post processing to</span><span>
</span><span id="line-330"></span><span class="hs-comment">-- refine the result:</span><span>
</span><span id="line-331"></span><span class="hs-comment">--  * Sort:</span><span>
</span><span id="line-332"></span><span class="hs-comment">--      we sort both on the FZF score and the number of segments in the FQN</span><span>
</span><span id="line-333"></span><span class="hs-comment">--      preferring shorter FQNs over longer. This helps with things like forks</span><span>
</span><span id="line-334"></span><span class="hs-comment">--      of base.</span><span>
</span><span id="line-335"></span><span class="hs-comment">--  * Dedupe:</span><span>
</span><span id="line-336"></span><span class="hs-comment">--      we dedupe on the found refs to avoid having several rows of a</span><span>
</span><span id="line-337"></span><span class="hs-comment">--      definition with different names in the result set.</span><span>
</span><span id="line-338"></span><span class="annot"><a href="Unison.Server.Backend.html#fuzzyFind"><span class="hs-identifier hs-type">fuzzyFind</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-339"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-340"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-341"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FZF.Alignment</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#UnisonName"><span class="hs-identifier hs-type">UnisonName</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.Backend.html#FoundRef"><span class="hs-identifier hs-type">FoundRef</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-342"></span><span id="fuzzyFind"><span class="annot"><span class="annottext">fuzzyFind :: Names -&gt; WatchKind -&gt; [(Alignment, Text, [FoundRef])]
</span><a href="Unison.Server.Backend.html#fuzzyFind"><span class="hs-identifier hs-var hs-var">fuzzyFind</span></a></span></span><span> </span><span id="local-6989586621679348909"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679348909"><span class="hs-identifier hs-var">printNames</span></a></span></span><span> </span><span id="local-6989586621679348910"><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679348910"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679348911"><span class="annot"><span class="annottext">fzfNames :: [(Alignment, Name, Set (Either Referent TypeReference))]
</span><a href="#local-6989586621679348911"><span class="hs-identifier hs-var hs-var">fzfNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-344"></span><span>        </span><span class="annot"><span class="annottext">(Name -&gt; Text)
-&gt; [WatchKind]
-&gt; Names
-&gt; [(Alignment, Name, Set (Either Referent TypeReference))]
</span><span class="hs-identifier hs-var">Names.fuzzyFind</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WatchKind -&gt; [WatchKind]
</span><span class="hs-identifier hs-var">words</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679348910"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679348909"><span class="hs-identifier hs-var">printNames</span></a></span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span>      </span><span id="local-6989586621679348918"><span class="annot"><span class="annottext">toFoundRef :: (Alignment, Text, Set (Either Referent TypeReference))
-&gt; (Alignment, Text, [FoundRef])
</span><a href="#local-6989586621679348918"><span class="hs-identifier hs-var hs-var">toFoundRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-347"></span><span>        </span><span class="annot"><span class="annottext">(Set (Either Referent TypeReference) -&gt; [FoundRef])
-&gt; (Alignment, Text, Set (Either Referent TypeReference))
-&gt; (Alignment, Text, [FoundRef])
forall a b.
(a -&gt; b) -&gt; (Alignment, Text, a) -&gt; (Alignment, Text, b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either Referent TypeReference -&gt; FoundRef)
-&gt; [Either Referent TypeReference] -&gt; [FoundRef]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Referent -&gt; FoundRef)
-&gt; (TypeReference -&gt; FoundRef)
-&gt; Either Referent TypeReference
-&gt; FoundRef
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; FoundRef
</span><a href="Unison.Server.Backend.html#FoundTermRef"><span class="hs-identifier hs-var">FoundTermRef</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; FoundRef
</span><a href="Unison.Server.Backend.html#FoundTypeRef"><span class="hs-identifier hs-var">FoundTypeRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Either Referent TypeReference] -&gt; [FoundRef])
-&gt; (Set (Either Referent TypeReference)
    -&gt; [Either Referent TypeReference])
-&gt; Set (Either Referent TypeReference)
-&gt; [FoundRef]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set (Either Referent TypeReference)
-&gt; [Either Referent TypeReference]
forall a. Set a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span>      </span><span class="hs-comment">-- Remove dupes based on refs</span><span>
</span><span id="line-350"></span><span>      </span><span id="local-6989586621679348925"><span class="annot"><span class="annottext">dedupe :: [(a, b, [FoundRef])] -&gt; [(a, b, [FoundRef])]
</span><a href="#local-6989586621679348925"><span class="hs-identifier hs-var hs-var">dedupe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-351"></span><span>        </span><span class="annot"><span class="annottext">((a, b, [FoundRef]) -&gt; [FoundRef])
-&gt; [(a, b, [FoundRef])] -&gt; [(a, b, [FoundRef])]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">nubOrdOn</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348926"><span class="annot"><span class="annottext">[FoundRef]
</span><a href="#local-6989586621679348926"><span class="hs-identifier hs-var">refs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[FoundRef]
</span><a href="#local-6989586621679348926"><span class="hs-identifier hs-var">refs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span>      </span><span class="hs-comment">-- Prefer shorter FQNs</span><span>
</span><span id="line-354"></span><span>      </span><span id="local-6989586621679348931"><span class="annot"><span class="annottext">rank :: (Alignment, Text, c) -&gt; (Int, Int)
</span><a href="#local-6989586621679348931"><span class="hs-identifier hs-var hs-var">rank</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679348932"><span class="annot"><span class="annottext">Alignment
</span><a href="#local-6989586621679348932"><span class="hs-identifier hs-var">alignment</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348933"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348933"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-355"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Int
</span><span class="hs-identifier hs-var">Name.countSegments</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Name
Text -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeParseText</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348933"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-356"></span><span>          </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">negate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Alignment -&gt; Int
</span><span class="hs-identifier hs-var">FZF.score</span></span><span> </span><span class="annot"><span class="annottext">Alignment
</span><a href="#local-6989586621679348932"><span class="hs-identifier hs-var">alignment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span>      </span><span id="local-6989586621679348936"><span class="annot"><span class="annottext">refine :: [(Alignment, Text, [FoundRef])] -&gt; [(Alignment, Text, [FoundRef])]
</span><a href="#local-6989586621679348936"><span class="hs-identifier hs-var hs-var">refine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-360"></span><span>        </span><span class="annot"><span class="annottext">[(Alignment, Text, [FoundRef])] -&gt; [(Alignment, Text, [FoundRef])]
forall {a} {b}. [(a, b, [FoundRef])] -&gt; [(a, b, [FoundRef])]
</span><a href="#local-6989586621679348925"><span class="hs-identifier hs-var">dedupe</span></a></span><span> </span><span class="annot"><span class="annottext">([(Alignment, Text, [FoundRef])]
 -&gt; [(Alignment, Text, [FoundRef])])
-&gt; ([(Alignment, Text, [FoundRef])]
    -&gt; [(Alignment, Text, [FoundRef])])
-&gt; [(Alignment, Text, [FoundRef])]
-&gt; [(Alignment, Text, [FoundRef])]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Alignment, Text, [FoundRef]) -&gt; (Int, Int))
-&gt; [(Alignment, Text, [FoundRef])]
-&gt; [(Alignment, Text, [FoundRef])]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortOn</span></span><span> </span><span class="annot"><span class="annottext">(Alignment, Text, [FoundRef]) -&gt; (Int, Int)
forall {c}. (Alignment, Text, c) -&gt; (Int, Int)
</span><a href="#local-6989586621679348931"><span class="hs-identifier hs-var">rank</span></a></span><span>
</span><span id="line-361"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(Alignment, Text, [FoundRef])] -&gt; [(Alignment, Text, [FoundRef])]
</span><a href="#local-6989586621679348936"><span class="hs-identifier hs-var">refine</span></a></span><span> </span><span class="annot"><span class="annottext">([(Alignment, Text, [FoundRef])]
 -&gt; [(Alignment, Text, [FoundRef])])
-&gt; [(Alignment, Text, [FoundRef])]
-&gt; [(Alignment, Text, [FoundRef])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Alignment, Text, Set (Either Referent TypeReference))
-&gt; (Alignment, Text, [FoundRef])
</span><a href="#local-6989586621679348918"><span class="hs-identifier hs-var">toFoundRef</span></a></span><span> </span><span class="annot"><span class="annottext">((Alignment, Text, Set (Either Referent TypeReference))
 -&gt; (Alignment, Text, [FoundRef]))
-&gt; ((Alignment, Name, Set (Either Referent TypeReference))
    -&gt; (Alignment, Text, Set (Either Referent TypeReference)))
-&gt; (Alignment, Name, Set (Either Referent TypeReference))
-&gt; (Alignment, Text, [FoundRef])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (Alignment, Name, Set (Either Referent TypeReference))
  (Alignment, Text, Set (Either Referent TypeReference))
  Name
  Text
-&gt; (Name -&gt; Text)
-&gt; (Alignment, Name, Set (Either Referent TypeReference))
-&gt; (Alignment, Text, Set (Either Referent TypeReference))
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (Alignment, Name, Set (Either Referent TypeReference))
  (Alignment, Text, Set (Either Referent TypeReference))
  Name
  Text
forall s t a b. Field2 s t a b =&gt; Lens s t a b
Lens
  (Alignment, Name, Set (Either Referent TypeReference))
  (Alignment, Text, Set (Either Referent TypeReference))
  Name
  Text
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">((Alignment, Name, Set (Either Referent TypeReference))
 -&gt; (Alignment, Text, [FoundRef]))
-&gt; [(Alignment, Name, Set (Either Referent TypeReference))]
-&gt; [(Alignment, Text, [FoundRef])]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Alignment, Name, Set (Either Referent TypeReference))]
</span><a href="#local-6989586621679348911"><span class="hs-identifier hs-var">fzfNames</span></a></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span class="hs-comment">-- List the immediate children of a namespace</span><span>
</span><span id="line-364"></span><span id="local-6989586621679347445"><span class="annot"><a href="Unison.Server.Backend.html#lsAtPath"><span class="hs-identifier hs-type">lsAtPath</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-365"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679347445"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-366"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679347445"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-367"></span><span>  </span><span class="hs-comment">-- The root to follow the path from.</span><span>
</span><span id="line-368"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">V2Branch.Branch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-comment">-- Path from the root to the branch to 'ls'</span><span>
</span><span id="line-370"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-371"></span><span>  </span><span class="annot"><a href="#local-6989586621679347445"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.Backend.html#ShallowListEntry"><span class="hs-identifier hs-type">ShallowListEntry</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-372"></span><span id="lsAtPath"><span class="annot"><span class="annottext">lsAtPath :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann
-&gt; Branch Transaction
-&gt; Absolute
-&gt; m [ShallowListEntry Symbol Ann]
</span><a href="Unison.Server.Backend.html#lsAtPath"><span class="hs-identifier hs-var hs-var">lsAtPath</span></a></span></span><span> </span><span id="local-6989586621679348946"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679348946"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679348947"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621679348947"><span class="hs-identifier hs-var">rootBranch</span></a></span></span><span> </span><span id="local-6989586621679348948"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679348948"><span class="hs-identifier hs-var">absPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-373"></span><span>  </span><span id="local-6989586621679348949"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621679348949"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; Transaction (Branch Transaction) -&gt; m (Branch Transaction)
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679348946"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; Branch Transaction -&gt; Transaction (Branch Transaction)
</span><span class="hs-identifier hs-var">Codebase.getShallowBranchAtPath</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679348948"><span class="hs-identifier hs-var">absPath</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621679348947"><span class="hs-identifier hs-var">rootBranch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>  </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; Branch Transaction -&gt; m [ShallowListEntry Symbol Ann]
forall (m :: * -&gt; *) (n :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann
-&gt; Branch n -&gt; m [ShallowListEntry Symbol Ann]
</span><a href="Unison.Server.Backend.html#lsBranch"><span class="hs-identifier hs-var">lsBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679348946"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621679348949"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span id="local-6989586621679347454"><span class="annot"><a href="Unison.Server.Backend.html#findDocInBranch"><span class="hs-identifier hs-type">findDocInBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-377"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-378"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">V2Branch.Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621679347454"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-379"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span></span><span>
</span><span id="line-380"></span><span id="findDocInBranch"><span class="annot"><span class="annottext">findDocInBranch :: forall (m :: * -&gt; *).
Set NameSegment -&gt; Branch m -&gt; Maybe TypeReference
</span><a href="Unison.Server.Backend.html#findDocInBranch"><span class="hs-identifier hs-var hs-var">findDocInBranch</span></a></span></span><span> </span><span id="local-6989586621679348961"><span class="annot"><span class="annottext">Set NameSegment
</span><a href="#local-6989586621679348961"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span id="local-6989586621679348962"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679348962"><span class="hs-identifier hs-var">namespaceBranch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- choose the first term (among conflicted terms) matching any of these names, in this order.</span><span>
</span><span id="line-382"></span><span>      </span><span class="hs-comment">-- we might later want to return all of them to let the front end decide</span><span>
</span><span id="line-383"></span><span>      </span><span id="local-6989586621679348963"><span class="annot"><span class="annottext">toCheck :: [NameSegment]
</span><a href="#local-6989586621679348963"><span class="hs-identifier hs-var hs-var">toCheck</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set NameSegment -&gt; [NameSegment]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set NameSegment
</span><a href="#local-6989586621679348961"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-384"></span><span>      </span><span class="annot"><a href="#local-6989586621679348965"><span class="hs-identifier hs-type">readmeRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-385"></span><span>      </span><span id="local-6989586621679348965"><span class="annot"><span class="annottext">readmeRef :: Maybe TypeReference
</span><a href="#local-6989586621679348965"><span class="hs-identifier hs-var hs-var">readmeRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TypeReference] -&gt; Maybe TypeReference
forall a. [a] -&gt; Maybe a
</span><span class="hs-identifier hs-var">listToMaybe</span></span><span> </span><span class="annot"><span class="annottext">([TypeReference] -&gt; Maybe TypeReference)
-&gt; [TypeReference] -&gt; Maybe TypeReference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-386"></span><span>        </span><span id="local-6989586621679348967"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679348967"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[NameSegment]
</span><a href="#local-6989586621679348963"><span class="hs-identifier hs-var">toCheck</span></a></span><span>
</span><span id="line-387"></span><span>        </span><span id="local-6989586621679348968"><span class="annot"><span class="annottext">Map Referent (m MdValues)
</span><a href="#local-6989586621679348968"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (Map Referent (m MdValues)) -&gt; [Map Referent (m MdValues)]
forall a. Maybe a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Map Referent (m MdValues)) -&gt; [Map Referent (m MdValues)])
-&gt; Maybe (Map Referent (m MdValues)) -&gt; [Map Referent (m MdValues)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
-&gt; Map NameSegment (Map Referent (m MdValues))
-&gt; Maybe (Map Referent (m MdValues))
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679348967"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Map NameSegment (Map Referent (m MdValues))
</span><a href="#local-6989586621679348970"><span class="hs-identifier hs-var">termsMap</span></a></span><span>
</span><span id="line-388"></span><span>        </span><span id="local-6989586621679348971"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679348971"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map Referent (m MdValues) -&gt; [Referent]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">Map Referent (m MdValues)
</span><a href="#local-6989586621679348968"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-389"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679348971"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-390"></span><span>          </span><span class="hs-comment">-- This shouldn't ever happen unless someone puts a non-doc as their readme.</span><span>
</span><span id="line-391"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">V2Referent.Con</span></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TypeReference]
forall a. [a]
forall (f :: * -&gt; *) a. Alternative f =&gt; f a
</span><span class="hs-identifier hs-var">empty</span></span><span>
</span><span id="line-392"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">V2Referent.Ref</span></span><span> </span><span id="local-6989586621679348976"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679348976"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; [TypeReference]
forall a. a -&gt; [a]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TypeReference -&gt; [TypeReference])
-&gt; TypeReference -&gt; [TypeReference]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; TypeReference
</span><span class="hs-identifier hs-var">Cv.reference2to1</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679348976"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-393"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-394"></span><span>          </span><span id="local-6989586621679348970"><span class="annot"><span class="annottext">termsMap :: Map NameSegment (Map Referent (m MdValues))
</span><a href="#local-6989586621679348970"><span class="hs-identifier hs-var hs-var">termsMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Branch m -&gt; Map NameSegment (Map Referent (m MdValues))
forall (m :: * -&gt; *).
Branch m -&gt; Map NameSegment (Map Referent (m MdValues))
</span><span class="hs-identifier hs-var">V2Branch.terms</span></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679348962"><span class="hs-identifier hs-var">namespaceBranch</span></a></span><span>
</span><span id="line-395"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Maybe TypeReference
</span><a href="#local-6989586621679348965"><span class="hs-identifier hs-var">readmeRef</span></a></span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span id="local-6989586621679347466"><span class="annot"><a href="Unison.Server.Backend.html#isDoc"><span class="hs-identifier hs-type">isDoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679347466"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent.Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-398"></span><span id="isDoc"><span class="annot"><span class="annottext">isDoc :: forall (m :: * -&gt; *).
Codebase m Symbol Ann -&gt; Referent -&gt; Transaction Bool
</span><a href="Unison.Server.Backend.html#isDoc"><span class="hs-identifier hs-var hs-var">isDoc</span></a></span></span><span> </span><span id="local-6989586621679348983"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679348983"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679348984"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679348984"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-399"></span><span>  </span><span id="local-6989586621679348985"><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679348985"><span class="hs-identifier hs-var">ot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; Referent -&gt; Transaction (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; Referent -&gt; Transaction (Maybe (Type Symbol Ann))
</span><a href="Unison.Server.Backend.html#loadReferentType"><span class="hs-identifier hs-var">loadReferentType</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679348983"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679348984"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-400"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann) -&gt; Bool
forall v loc. (Var v, Monoid loc) =&gt; Maybe (Type v loc) -&gt; Bool
</span><a href="Unison.Server.Backend.html#isDoc%27"><span class="hs-identifier hs-var">isDoc'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679348985"><span class="hs-identifier hs-var">ot</span></a></span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span id="local-6989586621679347468"><span id="local-6989586621679347469"><span class="annot"><a href="Unison.Server.Backend.html#isDoc%27"><span class="hs-identifier hs-type">isDoc'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679347468"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679347469"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679347468"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347469"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-403"></span><span id="isDoc%27"><span class="annot"><span class="annottext">isDoc' :: forall v loc. (Var v, Monoid loc) =&gt; Maybe (Type v loc) -&gt; Bool
</span><a href="Unison.Server.Backend.html#isDoc%27"><span class="hs-identifier hs-var hs-var">isDoc'</span></a></span></span><span> </span><span id="local-6989586621679348999"><span class="annot"><span class="annottext">Maybe (Type v loc)
</span><a href="#local-6989586621679348999"><span class="hs-identifier hs-var">typeOfTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-404"></span><span>  </span><span class="hs-comment">-- A term is a doc if its type conforms to the `Doc` type.</span><span>
</span><span id="line-405"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Type v loc)
</span><a href="#local-6989586621679348999"><span class="hs-identifier hs-var">typeOfTerm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-406"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679349000"><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621679349000"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-407"></span><span>      </span><span class="annot"><span class="annottext">Type v loc -&gt; Type v loc -&gt; Bool
forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><span class="hs-identifier hs-var">Typechecker.isEqual</span></span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621679349000"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Type v loc
forall v a. (Ord v, Monoid a) =&gt; Type v a
</span><a href="Unison.Server.Backend.html#doc1Type"><span class="hs-identifier hs-var">doc1Type</span></a></span><span>
</span><span id="line-408"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Type v loc -&gt; Type v loc -&gt; Bool
forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><span class="hs-identifier hs-var">Typechecker.isEqual</span></span><span> </span><span class="annot"><span class="annottext">Type v loc
</span><a href="#local-6989586621679349000"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Type v loc
forall v a. (Ord v, Monoid a) =&gt; Type v a
</span><a href="Unison.Server.Backend.html#doc2Type"><span class="hs-identifier hs-var">doc2Type</span></a></span><span>
</span><span id="line-409"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Type v loc)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span id="local-6989586621679347476"><span id="local-6989586621679347477"><span class="annot"><a href="Unison.Server.Backend.html#doc1Type"><span class="hs-identifier hs-type">doc1Type</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679347476"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679347477"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679347476"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347477"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-412"></span><span id="doc1Type"><span class="annot"><span class="annottext">doc1Type :: forall v a. (Ord v, Monoid a) =&gt; Type v a
</span><a href="Unison.Server.Backend.html#doc1Type"><span class="hs-identifier hs-var hs-var">doc1Type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; TypeReference -&gt; Type v a
forall v a. Ord v =&gt; a -&gt; TypeReference -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.ref</span></span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><span class="hs-identifier hs-var">Decls.docRef</span></span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span id="local-6989586621679349011"><span id="local-6989586621679349012"><span class="annot"><a href="Unison.Server.Backend.html#doc2Type"><span class="hs-identifier hs-type">doc2Type</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679349011"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679349012"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679349011"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349012"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-415"></span><span id="doc2Type"><span class="annot"><span class="annottext">doc2Type :: forall v a. (Ord v, Monoid a) =&gt; Type v a
</span><a href="Unison.Server.Backend.html#doc2Type"><span class="hs-identifier hs-var hs-var">doc2Type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; TypeReference -&gt; Type v a
forall v a. Ord v =&gt; a -&gt; TypeReference -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.ref</span></span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><span class="hs-identifier hs-var">DD.doc2Ref</span></span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span class="annot"><a href="Unison.Server.Backend.html#isTestResultList"><span class="hs-identifier hs-type">isTestResultList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679349018"><span class="annot"><a href="#local-6989586621679349018"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621679349019"><span class="annot"><a href="#local-6989586621679349019"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679349018"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679349019"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679349018"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349019"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-418"></span><span id="isTestResultList"><span class="annot"><span class="annottext">isTestResultList :: forall v loc. (Var v, Monoid loc) =&gt; Maybe (Type v loc) -&gt; Bool
</span><a href="Unison.Server.Backend.html#isTestResultList"><span class="hs-identifier hs-var hs-var">isTestResultList</span></a></span></span><span> </span><span id="local-6989586621679349027"><span class="annot"><span class="annottext">Maybe (Type v a)
</span><a href="#local-6989586621679349027"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Type v a)
</span><a href="#local-6989586621679349027"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-419"></span><span>  </span><span class="annot"><span class="annottext">Maybe (Type v a)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-420"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679349028"><span class="annot"><span class="annottext">Type v a
</span><a href="#local-6989586621679349028"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type v a -&gt; Type v a -&gt; Bool
forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><span class="hs-identifier hs-var">Typechecker.isEqual</span></span><span> </span><span class="annot"><span class="annottext">Type v a
</span><a href="#local-6989586621679349028"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Type v a
forall v a. (Ord v, Monoid a) =&gt; Type v a
</span><a href="Unison.Server.Backend.html#resultListType"><span class="hs-identifier hs-var">resultListType</span></a></span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span id="local-6989586621679349030"><span id="local-6989586621679349031"><span class="annot"><a href="Unison.Server.Backend.html#resultListType"><span class="hs-identifier hs-type">resultListType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679349030"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679349031"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679349030"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349031"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-423"></span><span id="resultListType"><span class="annot"><span class="annottext">resultListType :: forall v a. (Ord v, Monoid a) =&gt; Type v a
</span><a href="Unison.Server.Backend.html#resultListType"><span class="hs-identifier hs-var hs-var">resultListType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Type v a -&gt; Type v a -&gt; Type v a
forall v a. Ord v =&gt; a -&gt; Type v a -&gt; Type v a -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.app</span></span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Type v a
forall v a. Ord v =&gt; a -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.list</span></span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; TypeReference -&gt; Type v a
forall v a. Ord v =&gt; a -&gt; TypeReference -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.ref</span></span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><span class="hs-identifier hs-var">Decls.testResultRef</span></span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span id="local-6989586621679347493"><span class="annot"><a href="Unison.Server.Backend.html#termListEntry"><span class="hs-identifier hs-type">termListEntry</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679347493"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-427"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679347493"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-428"></span><span>  </span><span class="annot"><a href="Unison.Server.Types.html#ExactName"><span class="hs-identifier hs-type">ExactName</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2Referent.Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-429"></span><span>  </span><span class="annot"><a href="#local-6989586621679347493"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-430"></span><span id="termListEntry"><span class="annot"><span class="annottext">termListEntry :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann
-&gt; ExactName Name Referent -&gt; m (TermEntry Symbol Ann)
</span><a href="Unison.Server.Backend.html#termListEntry"><span class="hs-identifier hs-var hs-var">termListEntry</span></a></span></span><span> </span><span id="local-6989586621679349055"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349055"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Types.html#ExactName"><span class="hs-identifier hs-type">ExactName</span></a></span><span> </span><span id="local-6989586621679349057"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349057"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679349058"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349058"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-431"></span><span>  </span><span id="local-6989586621679349059"><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679349059"><span class="hs-identifier hs-var">ot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; Transaction (Maybe (Type Symbol Ann))
-&gt; m (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349055"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">(Transaction (Maybe (Type Symbol Ann))
 -&gt; m (Maybe (Type Symbol Ann)))
-&gt; Transaction (Maybe (Type Symbol Ann))
-&gt; m (Maybe (Type Symbol Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-432"></span><span>    </span><span id="local-6989586621679349060"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349060"><span class="hs-identifier hs-var">v1Referent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TypeReference -&gt; Transaction ConstructorType)
-&gt; Referent -&gt; Transaction Referent
forall (m :: * -&gt; *).
Applicative m =&gt;
(TypeReference -&gt; m ConstructorType) -&gt; Referent -&gt; m Referent
</span><span class="hs-identifier hs-var">Cv.referent2to1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; TypeReference -&gt; Transaction ConstructorType
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; TypeReference -&gt; Transaction ConstructorType
</span><span class="hs-identifier hs-var">Codebase.getDeclType</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349055"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349058"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-433"></span><span>    </span><span id="local-6989586621679349063"><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679349063"><span class="hs-identifier hs-var">ot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; Referent -&gt; Transaction (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; Referent -&gt; Transaction (Maybe (Type Symbol Ann))
</span><a href="Unison.Server.Backend.html#loadReferentType"><span class="hs-identifier hs-var">loadReferentType</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349055"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349060"><span class="hs-identifier hs-var">v1Referent</span></a></span><span>
</span><span id="line-434"></span><span>    </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679349063"><span class="hs-identifier hs-var">ot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>  </span><span id="local-6989586621679349064"><span class="annot"><span class="annottext">TermTag
</span><a href="#local-6989586621679349064"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; Referent -&gt; Maybe (Type Symbol Ann) -&gt; m TermTag
forall v (m :: * -&gt; *) a.
(Var v, MonadIO m) =&gt;
Codebase m v a -&gt; Referent -&gt; Maybe (Type v Ann) -&gt; m TermTag
</span><a href="Unison.Server.Backend.html#getTermTag"><span class="hs-identifier hs-var">getTermTag</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349055"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349058"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679349059"><span class="hs-identifier hs-var">ot</span></a></span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-437"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span>
</span><span id="line-438"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:termEntryReferent:TermEntry :: Referent
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryReferent%3ATermEntry"><span class="hs-identifier hs-var">termEntryReferent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349058"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-439"></span><span>        </span><span class="annot"><span class="annottext">$sel:termEntryName:TermEntry :: Name
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryName%3ATermEntry"><span class="hs-identifier hs-var">termEntryName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349057"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-440"></span><span>        </span><span class="annot"><span class="annottext">$sel:termEntryType:TermEntry :: Maybe (Type Symbol Ann)
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryType%3ATermEntry"><span class="hs-identifier hs-var">termEntryType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679349059"><span class="hs-identifier hs-var">ot</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-441"></span><span>        </span><span class="annot"><span class="annottext">$sel:termEntryTag:TermEntry :: TermTag
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryTag%3ATermEntry"><span class="hs-identifier hs-var">termEntryTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermTag
</span><a href="#local-6989586621679349064"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-442"></span><span>        </span><span class="hs-comment">-- See typeEntryConflicted</span><span>
</span><span id="line-443"></span><span>        </span><span class="annot"><span class="annottext">$sel:termEntryConflicted:TermEntry :: Bool
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryConflicted%3ATermEntry"><span class="hs-identifier hs-var">termEntryConflicted</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-444"></span><span>        </span><span class="annot"><span class="annottext">$sel:termEntryHash:TermEntry :: ShortHash
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryHash%3ATermEntry"><span class="hs-identifier hs-var">termEntryHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Referent -&gt; ShortHash
</span><span class="hs-identifier hs-var">Cv.referent2toshorthash1</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349058"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-445"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span id="local-6989586621679347500"><span id="local-6989586621679347501"><span id="local-6989586621679347502"><span class="annot"><a href="Unison.Server.Backend.html#getTermTag"><span class="hs-identifier hs-type">getTermTag</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-448"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679347500"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679347501"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-449"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679347501"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347500"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347502"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-450"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">V2Referent.Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-451"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679347500"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-452"></span><span>  </span><span class="annot"><a href="#local-6989586621679347501"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TermTag"><span class="hs-identifier hs-type">TermTag</span></a></span></span></span></span><span>
</span><span id="line-453"></span><span id="getTermTag"><span class="annot"><span class="annottext">getTermTag :: forall v (m :: * -&gt; *) a.
(Var v, MonadIO m) =&gt;
Codebase m v a -&gt; Referent -&gt; Maybe (Type v Ann) -&gt; m TermTag
</span><a href="Unison.Server.Backend.html#getTermTag"><span class="hs-identifier hs-var hs-var">getTermTag</span></a></span></span><span> </span><span id="local-6989586621679349082"><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679349082"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679349083"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349083"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679349084"><span class="annot"><span class="annottext">Maybe (Type v Ann)
</span><a href="#local-6989586621679349084"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-454"></span><span>  </span><span class="hs-comment">-- A term is a doc if its type conforms to the `Doc` type.</span><span>
</span><span id="line-455"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349085"><span class="annot"><span class="annottext">isDoc :: Bool
</span><a href="#local-6989586621679349085"><span class="hs-identifier hs-var hs-var">isDoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Type v Ann) -&gt; Bool
forall v loc. (Var v, Monoid loc) =&gt; Maybe (Type v loc) -&gt; Bool
</span><a href="Unison.Server.Backend.html#isDoc%27"><span class="hs-identifier hs-var">isDoc'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type v Ann)
</span><a href="#local-6989586621679349084"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-456"></span><span>  </span><span class="hs-comment">-- A term is a test if it has the type [test.Result]</span><span>
</span><span id="line-457"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349086"><span class="annot"><span class="annottext">isTest :: Bool
</span><a href="#local-6989586621679349086"><span class="hs-identifier hs-var hs-var">isTest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Type v Ann)
</span><a href="#local-6989586621679349084"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-458"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679349087"><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621679349087"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-459"></span><span>          </span><span class="annot"><span class="annottext">Type v Ann -&gt; Type v Ann -&gt; Bool
forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><span class="hs-identifier hs-var">Typechecker.isEqual</span></span><span> </span><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621679349087"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann -&gt; Type v Ann
forall v a. Ord v =&gt; a -&gt; Type v a
</span><span class="hs-identifier hs-var">Decls.testResultListType</span></span><span> </span><span class="annot"><span class="annottext">Ann
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Type v Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-461"></span><span>  </span><span id="local-6989586621679349089"><span class="annot"><span class="annottext">Maybe ConstructorType
</span><a href="#local-6989586621679349089"><span class="hs-identifier hs-var">constructorType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349083"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-462"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">V2Referent.Ref</span></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ConstructorType -&gt; m (Maybe ConstructorType)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe ConstructorType
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-463"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">V2Referent.Con</span></span><span> </span><span id="local-6989586621679349090"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349090"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConstructorId
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConstructorType -&gt; Maybe ConstructorType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(ConstructorType -&gt; Maybe ConstructorType)
-&gt; m ConstructorType -&gt; m (Maybe ConstructorType)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a -&gt; Transaction ConstructorType -&gt; m ConstructorType
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679349082"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase m v a -&gt; TypeReference -&gt; Transaction ConstructorType
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; TypeReference -&gt; Transaction ConstructorType
</span><span class="hs-identifier hs-var">Codebase.getDeclType</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679349082"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349090"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-465"></span><span>    </span><span class="hs-keyword">if</span><span>
</span><span id="line-466"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679349085"><span class="hs-identifier hs-var">isDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermTag
</span><a href="Unison.Server.Types.html#Doc"><span class="hs-identifier hs-var">Doc</span></a></span><span>
</span><span id="line-467"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679349086"><span class="hs-identifier hs-var">isTest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermTag
</span><a href="Unison.Server.Types.html#Test"><span class="hs-identifier hs-var">Test</span></a></span><span>
</span><span id="line-468"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">ConstructorType
</span><span class="hs-identifier hs-var">CT.Effect</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ConstructorType
</span><a href="#local-6989586621679349089"><span class="hs-identifier hs-var">constructorType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeTag -&gt; TermTag
</span><a href="Unison.Server.Types.html#Constructor"><span class="hs-identifier hs-var">Constructor</span></a></span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="Unison.Server.Types.html#Ability"><span class="hs-identifier hs-var">Ability</span></a></span><span>
</span><span id="line-469"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">ConstructorType
</span><span class="hs-identifier hs-var">CT.Data</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ConstructorType
</span><a href="#local-6989586621679349089"><span class="hs-identifier hs-var">constructorType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeTag -&gt; TermTag
</span><a href="Unison.Server.Types.html#Constructor"><span class="hs-identifier hs-var">Constructor</span></a></span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="Unison.Server.Types.html#Data"><span class="hs-identifier hs-var">Data</span></a></span><span>
</span><span id="line-470"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermTag
</span><a href="Unison.Server.Types.html#Plain"><span class="hs-identifier hs-var">Plain</span></a></span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span id="local-6989586621679347506"><span id="local-6989586621679347507"><span class="annot"><a href="Unison.Server.Backend.html#getTypeTag"><span class="hs-identifier hs-type">getTypeTag</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-473"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679347506"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-474"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679347507"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347506"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-475"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-476"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TypeTag"><span class="hs-identifier hs-type">TypeTag</span></a></span></span></span><span>
</span><span id="line-477"></span><span id="getTypeTag"><span class="annot"><span class="annottext">getTypeTag :: forall v (m :: * -&gt; *).
Var v =&gt;
Codebase m v Ann -&gt; TypeReference -&gt; Transaction TypeTag
</span><a href="Unison.Server.Backend.html#getTypeTag"><span class="hs-identifier hs-var hs-var">getTypeTag</span></a></span></span><span> </span><span id="local-6989586621679349099"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679349099"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679349100"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349100"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-478"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Maybe (Id' Hash)
</span><span class="hs-identifier hs-var">Reference.toId</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349100"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-479"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679349102"><span class="annot"><span class="annottext">Id' Hash
</span><a href="#local-6989586621679349102"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-480"></span><span>      </span><span id="local-6989586621679349103"><span class="annot"><span class="annottext">Maybe (Decl v Ann)
</span><a href="#local-6989586621679349103"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; Id' Hash -&gt; Transaction (Maybe (Decl v Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id' Hash -&gt; Transaction (Maybe (Decl v a))
</span><span class="hs-identifier hs-var">Codebase.getTypeDeclaration</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679349099"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id' Hash
</span><a href="#local-6989586621679349102"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-481"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Decl v Ann)
</span><a href="#local-6989586621679349103"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-482"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">EffectDeclaration v Ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="Unison.Server.Types.html#Ability"><span class="hs-identifier hs-var">Ability</span></a></span><span>
</span><span id="line-483"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Decl v Ann)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="Unison.Server.Types.html#Data"><span class="hs-identifier hs-var">Data</span></a></span><span>
</span><span id="line-484"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Id' Hash)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeTag -&gt; Transaction TypeTag
forall a. a -&gt; Transaction a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Set TypeReference -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349100"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Set TypeReference
</span><span class="hs-identifier hs-var">Type.builtinAbilities</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="Unison.Server.Types.html#Ability"><span class="hs-identifier hs-var">Ability</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="Unison.Server.Types.html#Data"><span class="hs-identifier hs-var">Data</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span id="local-6989586621679347511"><span id="local-6989586621679347512"><span class="annot"><a href="Unison.Server.Backend.html#typeListEntry"><span class="hs-identifier hs-type">typeListEntry</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-487"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679347511"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-488"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679347512"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347511"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-489"></span><span>  </span><span class="annot"><a href="Unison.Server.Types.html#ExactName"><span class="hs-identifier hs-type">ExactName</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-490"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span></span></span><span>
</span><span id="line-491"></span><span id="typeListEntry"><span class="annot"><span class="annottext">typeListEntry :: forall v (m :: * -&gt; *).
Var v =&gt;
Codebase m v Ann
-&gt; ExactName Name TypeReference -&gt; Transaction TypeEntry
</span><a href="Unison.Server.Backend.html#typeListEntry"><span class="hs-identifier hs-var hs-var">typeListEntry</span></a></span></span><span> </span><span id="local-6989586621679349110"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679349110"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Types.html#ExactName"><span class="hs-identifier hs-type">ExactName</span></a></span><span> </span><span id="local-6989586621679349111"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349111"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679349112"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349112"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-492"></span><span>  </span><span id="local-6989586621679349113"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679349113"><span class="hs-identifier hs-var">hashLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Transaction Int
</span><span class="hs-identifier hs-var">Codebase.hashLength</span></span><span>
</span><span id="line-493"></span><span>  </span><span id="local-6989586621679349115"><span class="annot"><span class="annottext">TypeTag
</span><a href="#local-6989586621679349115"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; TypeReference -&gt; Transaction TypeTag
forall v (m :: * -&gt; *).
Var v =&gt;
Codebase m v Ann -&gt; TypeReference -&gt; Transaction TypeTag
</span><a href="Unison.Server.Backend.html#getTypeTag"><span class="hs-identifier hs-var">getTypeTag</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679349110"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349112"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-494"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-495"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span><span>
</span><span id="line-496"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:typeEntryReference:TypeEntry :: TypeReference
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryReference%3ATypeEntry"><span class="hs-identifier hs-var">typeEntryReference</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349112"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-497"></span><span>        </span><span class="annot"><span class="annottext">$sel:typeEntryName:TypeEntry :: Name
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryName%3ATypeEntry"><span class="hs-identifier hs-var">typeEntryName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349111"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-498"></span><span>        </span><span class="hs-comment">-- Mitchell says: at one point this was implemented incorrectly, but fixing it seemed like more trouble than it</span><span>
</span><span id="line-499"></span><span>        </span><span class="hs-comment">-- was worth, because we don't really care about conflicted things anymore. Ditto for termEntryConflicted.</span><span>
</span><span id="line-500"></span><span>        </span><span class="annot"><span class="annottext">$sel:typeEntryConflicted:TypeEntry :: Bool
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryConflicted%3ATypeEntry"><span class="hs-identifier hs-var">typeEntryConflicted</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-501"></span><span>        </span><span class="annot"><span class="annottext">$sel:typeEntryTag:TypeEntry :: TypeTag
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryTag%3ATypeEntry"><span class="hs-identifier hs-var">typeEntryTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="#local-6989586621679349115"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-502"></span><span>        </span><span class="annot"><span class="annottext">$sel:typeEntryHash:TypeEntry :: ShortHash
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryHash%3ATypeEntry"><span class="hs-identifier hs-var">typeEntryHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ShortHash -&gt; ShortHash
</span><span class="hs-identifier hs-var">SH.shortenTo</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679349113"><span class="hs-identifier hs-var">hashLength</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortHash -&gt; ShortHash) -&gt; ShortHash -&gt; ShortHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.toShortHash</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349112"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-503"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span class="annot"><a href="Unison.Server.Backend.html#typeDeclHeader"><span class="hs-identifier hs-type">typeDeclHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-506"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679347515"><span class="annot"><a href="#local-6989586621679347515"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621679347516"><span class="annot"><a href="#local-6989586621679347516"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-507"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679347515"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-508"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679347516"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347515"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-509"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-510"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-511"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="annot"><a href="Unison.Server.Syntax.html#SyntaxText"><span class="hs-identifier hs-type">Syntax.SyntaxText</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Syntax.html#SyntaxText"><span class="hs-identifier hs-type">Syntax.SyntaxText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-512"></span><span id="typeDeclHeader"><span class="annot"><span class="annottext">typeDeclHeader :: forall v (m :: * -&gt; *).
Var v =&gt;
Codebase m v Ann
-&gt; PrettyPrintEnv
-&gt; TypeReference
-&gt; Transaction (DisplayObject SyntaxText SyntaxText)
</span><a href="Unison.Server.Backend.html#typeDeclHeader"><span class="hs-identifier hs-var hs-var">typeDeclHeader</span></a></span></span><span> </span><span id="local-6989586621679349124"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679349124"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span id="local-6989586621679349125"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349125"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679349126"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349126"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Maybe (Id' Hash)
</span><span class="hs-identifier hs-var">Reference.toId</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349126"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-513"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679349127"><span class="annot"><span class="annottext">Id' Hash
</span><a href="#local-6989586621679349127"><span class="hs-identifier hs-var">rid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-514"></span><span>    </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; Id' Hash -&gt; Transaction (Maybe (Decl v Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id' Hash -&gt; Transaction (Maybe (Decl v a))
</span><span class="hs-identifier hs-var">Codebase.getTypeDeclaration</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679349124"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">Id' Hash
</span><a href="#local-6989586621679349127"><span class="hs-identifier hs-var">rid</span></a></span><span> </span><span class="annot"><span class="annottext">Transaction (Maybe (Decl v Ann))
-&gt; (Maybe (Decl v Ann) -&gt; DisplayObject SyntaxText SyntaxText)
-&gt; Transaction (DisplayObject SyntaxText SyntaxText)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-515"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Decl v Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; DisplayObject SyntaxText SyntaxText
forall b a. ShortHash -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">DisplayObject.MissingObject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.toShortHash</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349126"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679349130"><span class="annot"><span class="annottext">Decl v Ann
</span><a href="#local-6989586621679349130"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-517"></span><span>        </span><span class="annot"><span class="annottext">SyntaxText -&gt; DisplayObject SyntaxText SyntaxText
forall b a. a -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">DisplayObject.UserObject</span></span><span> </span><span class="annot"><span class="annottext">(SyntaxText -&gt; DisplayObject SyntaxText SyntaxText)
-&gt; SyntaxText -&gt; DisplayObject SyntaxText SyntaxText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-518"></span><span>          </span><span class="annot"><span class="annottext">Element TypeReference -&gt; Element
</span><a href="Unison.Server.Syntax.html#convertElement"><span class="hs-identifier hs-var">Syntax.convertElement</span></a></span><span>
</span><span id="line-519"></span><span>            </span><span class="annot"><span class="annottext">(Element TypeReference -&gt; Element) -&gt; SyntaxText -&gt; SyntaxText
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty SyntaxText -&gt; SyntaxText
forall s. (Monoid s, IsString s) =&gt; Width -&gt; Pretty s -&gt; s
</span><span class="hs-identifier hs-var">Pretty.render</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="Unison.Server.Types.html#defaultWidth"><span class="hs-identifier hs-var">defaultWidth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; Decl v Ann -&gt; Pretty SyntaxText
forall v a.
Var v =&gt;
HashQualified Name
-&gt; Either (EffectDeclaration v a) (DataDeclaration v a)
-&gt; Pretty SyntaxText
</span><span class="hs-identifier hs-var">DeclPrinter.prettyDeclHeader</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679349136"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Decl v Ann
</span><a href="#local-6989586621679349130"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>  </span><span class="annot"><span class="annottext">Maybe (Id' Hash)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-521"></span><span>    </span><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
-&gt; Transaction (DisplayObject SyntaxText SyntaxText)
forall a. a -&gt; Transaction a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SyntaxText -&gt; DisplayObject SyntaxText SyntaxText
forall b a. b -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">DisplayObject.BuiltinObject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; TypeReference -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatTypeName"><span class="hs-identifier hs-var">formatTypeName</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349125"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349126"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-522"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-523"></span><span>    </span><span id="local-6989586621679349136"><span class="annot"><span class="annottext">name :: HashQualified Name
</span><a href="#local-6989586621679349136"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; TypeReference -&gt; HashQualified Name
</span><span class="hs-identifier hs-var">PPE.typeName</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349125"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349126"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span class="annot"><a href="Unison.Server.Backend.html#formatTypeName"><span class="hs-identifier hs-type">formatTypeName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Syntax.html#SyntaxText"><span class="hs-identifier hs-type">Syntax.SyntaxText</span></a></span><span>
</span><span id="line-526"></span><span id="formatTypeName"><span class="annot"><span class="annottext">formatTypeName :: PrettyPrintEnv -&gt; TypeReference -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatTypeName"><span class="hs-identifier hs-var hs-var">formatTypeName</span></a></span></span><span> </span><span id="local-6989586621679349139"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349139"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-527"></span><span>  </span><span class="annot"><span class="annottext">(Element TypeReference -&gt; Element) -&gt; SyntaxText -&gt; SyntaxText
forall a b. (a -&gt; b) -&gt; AnnotatedText a -&gt; AnnotatedText b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Element TypeReference -&gt; Element
</span><a href="Unison.Server.Syntax.html#convertElement"><span class="hs-identifier hs-var">Syntax.convertElement</span></a></span><span> </span><span class="annot"><span class="annottext">(SyntaxText -&gt; SyntaxText)
-&gt; (TypeReference -&gt; SyntaxText) -&gt; TypeReference -&gt; SyntaxText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; TypeReference -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatTypeName%27"><span class="hs-identifier hs-var">formatTypeName'</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349139"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span class="annot"><a href="Unison.Server.Backend.html#formatTypeName%27"><span class="hs-identifier hs-type">formatTypeName'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span>
</span><span id="line-530"></span><span id="formatTypeName%27"><span class="annot"><span class="annottext">formatTypeName' :: PrettyPrintEnv -&gt; TypeReference -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatTypeName%27"><span class="hs-identifier hs-var hs-var">formatTypeName'</span></a></span></span><span> </span><span id="local-6989586621679349141"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349141"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679349142"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349142"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-531"></span><span>  </span><span class="annot"><span class="annottext">Pretty SyntaxText -&gt; SyntaxText
forall s. (Monoid s, IsString s) =&gt; Pretty s -&gt; s
</span><span class="hs-identifier hs-var">Pretty.renderUnbroken</span></span><span>
</span><span id="line-532"></span><span>    </span><span class="annot"><span class="annottext">(Pretty SyntaxText -&gt; SyntaxText)
-&gt; (HashQualified Name -&gt; Pretty SyntaxText)
-&gt; HashQualified Name
-&gt; SyntaxText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Pretty SyntaxText -&gt; Pretty SyntaxText)
-&gt; HashQualified Name -&gt; Pretty SyntaxText
forall s.
IsString s =&gt;
(Pretty s -&gt; Pretty s) -&gt; HashQualified Name -&gt; Pretty s
</span><span class="hs-identifier hs-var">NP.styleHashQualified</span></span><span> </span><span class="annot"><span class="annottext">Pretty SyntaxText -&gt; Pretty SyntaxText
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-533"></span><span>    </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; SyntaxText)
-&gt; HashQualified Name -&gt; SyntaxText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; TypeReference -&gt; HashQualified Name
</span><span class="hs-identifier hs-var">PPE.typeName</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349141"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349142"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span id="local-6989586621679347535"><span id="local-6989586621679347536"><span class="annot"><a href="Unison.Server.Backend.html#termEntryToNamedTerm"><span class="hs-identifier hs-type">termEntryToNamedTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-536"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679347535"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347535"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347536"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#NamedTerm"><span class="hs-identifier hs-type">NamedTerm</span></a></span></span></span><span>
</span><span id="line-537"></span><span id="termEntryToNamedTerm"><span class="annot"><span class="annottext">termEntryToNamedTerm :: forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Maybe Width -&gt; TermEntry v a -&gt; NamedTerm
</span><a href="Unison.Server.Backend.html#termEntryToNamedTerm"><span class="hs-identifier hs-var hs-var">termEntryToNamedTerm</span></a></span></span><span> </span><span id="local-6989586621679349148"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349148"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679349149"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679349149"><span class="hs-identifier hs-var">typeWidth</span></a></span></span><span> </span><span id="local-6989586621679349150"><span class="annot"><span class="annottext">te :: TermEntry v a
</span><a href="#local-6989586621679349150"><span class="hs-identifier hs-var">te</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:termEntryType:TermEntry :: forall v a. TermEntry v a -&gt; Maybe (Type v a)
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryType%3ATermEntry"><span class="hs-identifier hs-var">termEntryType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679349151"><span class="annot"><span class="annottext">Maybe (Type v a)
</span><a href="#local-6989586621679349151"><span class="hs-identifier hs-var">mayType</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:termEntryTag:TermEntry :: forall v a. TermEntry v a -&gt; TermTag
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryTag%3ATermEntry"><span class="hs-identifier hs-var">termEntryTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679349152"><span class="annot"><span class="annottext">TermTag
</span><a href="#local-6989586621679349152"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349153"><span class="annot"><span class="annottext">ShortHash
$sel:termEntryHash:TermEntry :: forall v a. TermEntry v a -&gt; ShortHash
termEntryHash :: ShortHash
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryHash%3ATermEntry"><span class="hs-identifier hs-var hs-var">termEntryHash</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-538"></span><span>  </span><span class="annot"><a href="Unison.Server.Types.html#NamedTerm"><span class="hs-identifier hs-type">NamedTerm</span></a></span><span>
</span><span id="line-539"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:termName:NamedTerm :: HashQualified Name
</span><a href="Unison.Server.Types.html#%24sel%3AtermName%3ANamedTerm"><span class="hs-identifier hs-var">termName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermEntry v a -&gt; HashQualified Name
forall v a. TermEntry v a -&gt; HashQualified Name
</span><a href="Unison.Server.Backend.html#termEntryHQName"><span class="hs-identifier hs-var">termEntryHQName</span></a></span><span> </span><span class="annot"><span class="annottext">TermEntry v a
</span><a href="#local-6989586621679349150"><span class="hs-identifier hs-var">te</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-540"></span><span>      </span><span class="annot"><span class="annottext">$sel:termHash:NamedTerm :: ShortHash
</span><a href="Unison.Server.Types.html#%24sel%3AtermHash%3ANamedTerm"><span class="hs-identifier hs-var">termHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679349153"><span class="hs-identifier hs-var">termEntryHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-541"></span><span>      </span><span class="annot"><span class="annottext">$sel:termType:NamedTerm :: Maybe SyntaxText
</span><a href="Unison.Server.Types.html#%24sel%3AtermType%3ANamedTerm"><span class="hs-identifier hs-var">termType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Width -&gt; Type v a -&gt; SyntaxText
forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Width -&gt; Type v a -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatType"><span class="hs-identifier hs-var">formatType</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349148"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Width -&gt; Width
</span><a href="Unison.Server.Types.html#mayDefaultWidth"><span class="hs-identifier hs-var">mayDefaultWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621679349149"><span class="hs-identifier hs-var">typeWidth</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Type v a -&gt; SyntaxText) -&gt; Maybe (Type v a) -&gt; Maybe SyntaxText
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Type v a)
</span><a href="#local-6989586621679349151"><span class="hs-identifier hs-var">mayType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-542"></span><span>      </span><span class="annot"><span class="annottext">$sel:termTag:NamedTerm :: TermTag
</span><a href="Unison.Server.Types.html#%24sel%3AtermTag%3ANamedTerm"><span class="hs-identifier hs-var">termTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermTag
</span><a href="#local-6989586621679349152"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-543"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span class="annot"><a href="Unison.Server.Backend.html#typeEntryToNamedType"><span class="hs-identifier hs-type">typeEntryToNamedType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#NamedType"><span class="hs-identifier hs-type">NamedType</span></a></span><span>
</span><span id="line-546"></span><span id="typeEntryToNamedType"><span class="annot"><span class="annottext">typeEntryToNamedType :: TypeEntry -&gt; NamedType
</span><a href="Unison.Server.Backend.html#typeEntryToNamedType"><span class="hs-identifier hs-var hs-var">typeEntryToNamedType</span></a></span></span><span> </span><span id="local-6989586621679349161"><span class="annot"><span class="annottext">te :: TypeEntry
</span><a href="#local-6989586621679349161"><span class="hs-identifier hs-var">te</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679349162"><span class="annot"><span class="annottext">TypeTag
$sel:typeEntryTag:TypeEntry :: TypeEntry -&gt; TypeTag
typeEntryTag :: TypeTag
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryTag%3ATypeEntry"><span class="hs-identifier hs-var hs-var">typeEntryTag</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349163"><span class="annot"><span class="annottext">ShortHash
$sel:typeEntryHash:TypeEntry :: TypeEntry -&gt; ShortHash
typeEntryHash :: ShortHash
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryHash%3ATypeEntry"><span class="hs-identifier hs-var hs-var">typeEntryHash</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-547"></span><span>  </span><span class="annot"><a href="Unison.Server.Types.html#NamedType"><span class="hs-identifier hs-type">NamedType</span></a></span><span>
</span><span id="line-548"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:typeName:NamedType :: HashQualified Name
</span><a href="Unison.Server.Types.html#%24sel%3AtypeName%3ANamedType"><span class="hs-identifier hs-var">typeName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeEntry -&gt; HashQualified Name
</span><a href="Unison.Server.Backend.html#typeEntryHQName"><span class="hs-identifier hs-var">typeEntryHQName</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeEntry -&gt; HashQualified Name)
-&gt; TypeEntry -&gt; HashQualified Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeEntry
</span><a href="#local-6989586621679349161"><span class="hs-identifier hs-var">te</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-549"></span><span>      </span><span class="annot"><span class="annottext">$sel:typeHash:NamedType :: ShortHash
</span><a href="Unison.Server.Types.html#%24sel%3AtypeHash%3ANamedType"><span class="hs-identifier hs-var">typeHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679349163"><span class="hs-identifier hs-var">typeEntryHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-550"></span><span>      </span><span class="annot"><span class="annottext">$sel:typeTag:NamedType :: TypeTag
</span><a href="Unison.Server.Types.html#%24sel%3AtypeTag%3ANamedType"><span class="hs-identifier hs-var">typeTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="#local-6989586621679349162"><span class="hs-identifier hs-var">typeEntryTag</span></a></span><span>
</span><span id="line-551"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span class="annot"><span class="hs-comment">-- | Find all definitions and children reachable from the given 'V2Branch.Branch',</span></span><span>
</span><span id="line-554"></span><span id="local-6989586621679347452"><span id="local-6989586621679347453"><span class="annot"><a href="Unison.Server.Backend.html#lsBranch"><span class="hs-identifier hs-type">lsBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-555"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679347452"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-556"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679347452"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-557"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">V2Branch.Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621679347453"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-558"></span><span>  </span><span class="annot"><a href="#local-6989586621679347452"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.Backend.html#ShallowListEntry"><span class="hs-identifier hs-type">ShallowListEntry</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-559"></span><span id="lsBranch"><span class="annot"><span class="annottext">lsBranch :: forall (m :: * -&gt; *) (n :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann
-&gt; Branch n -&gt; m [ShallowListEntry Symbol Ann]
</span><a href="Unison.Server.Backend.html#lsBranch"><span class="hs-identifier hs-var hs-var">lsBranch</span></a></span></span><span> </span><span id="local-6989586621679349195"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349195"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679349196"><span class="annot"><span class="annottext">Branch n
</span><a href="#local-6989586621679349196"><span class="hs-identifier hs-var">b0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-560"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679347545"><span id="local-6989586621679347546"><span class="annot"><a href="#local-6989586621679349197"><span class="hs-identifier hs-type">flattenRefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679347545"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347546"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679347545"><span class="hs-identifier hs-type">ref</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span><span>
</span><span id="line-561"></span><span>      </span><span id="local-6989586621679349197"><span class="annot"><span class="annottext">flattenRefs :: forall ref v. Map NameSegment (Map ref v) -&gt; [(ref, NameSegment)]
</span><a href="#local-6989586621679349197"><span class="hs-identifier hs-var hs-var">flattenRefs</span></a></span></span><span> </span><span id="local-6989586621679349200"><span class="annot"><span class="annottext">Map NameSegment (Map ref v)
</span><a href="#local-6989586621679349200"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-562"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679349201"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679349201"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349202"><span class="annot"><span class="annottext">Map ref v
</span><a href="#local-6989586621679349202"><span class="hs-identifier hs-var">refs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map NameSegment (Map ref v) -&gt; [(NameSegment, Map ref v)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map NameSegment (Map ref v)
</span><a href="#local-6989586621679349200"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-563"></span><span>        </span><span id="local-6989586621679349204"><span class="annot"><span class="annottext">ref
</span><a href="#local-6989586621679349204"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map ref v -&gt; [ref]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">Map ref v
</span><a href="#local-6989586621679349202"><span class="hs-identifier hs-var">refs</span></a></span><span>
</span><span id="line-564"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ref
</span><a href="#local-6989586621679349204"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679349201"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span>  </span><span id="local-6989586621679349205"><span class="annot"><span class="annottext">[ShallowListEntry Symbol Ann]
</span><a href="#local-6989586621679349205"><span class="hs-identifier hs-var">termEntries</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Referent, NameSegment)]
-&gt; ((Referent, NameSegment) -&gt; m (ShallowListEntry Symbol Ann))
-&gt; m [ShallowListEntry Symbol Ann]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map NameSegment (Map Referent (n MdValues))
-&gt; [(Referent, NameSegment)]
forall ref v. Map NameSegment (Map ref v) -&gt; [(ref, NameSegment)]
</span><a href="#local-6989586621679349197"><span class="hs-identifier hs-var">flattenRefs</span></a></span><span> </span><span class="annot"><span class="annottext">(Map NameSegment (Map Referent (n MdValues))
 -&gt; [(Referent, NameSegment)])
-&gt; Map NameSegment (Map Referent (n MdValues))
-&gt; [(Referent, NameSegment)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch n -&gt; Map NameSegment (Map Referent (n MdValues))
forall (m :: * -&gt; *).
Branch m -&gt; Map NameSegment (Map Referent (m MdValues))
</span><span class="hs-identifier hs-var">V2Branch.terms</span></span><span> </span><span class="annot"><span class="annottext">Branch n
</span><a href="#local-6989586621679349196"><span class="hs-identifier hs-var">b0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679349207"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349207"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349208"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679349208"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-566"></span><span>    </span><span class="annot"><span class="annottext">TermEntry Symbol Ann -&gt; ShallowListEntry Symbol Ann
forall v a. TermEntry v a -&gt; ShallowListEntry v a
</span><a href="Unison.Server.Backend.html#ShallowTermEntry"><span class="hs-identifier hs-var">ShallowTermEntry</span></a></span><span> </span><span class="annot"><span class="annottext">(TermEntry Symbol Ann -&gt; ShallowListEntry Symbol Ann)
-&gt; m (TermEntry Symbol Ann) -&gt; m (ShallowListEntry Symbol Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; ExactName Name Referent -&gt; m (TermEntry Symbol Ann)
forall (m :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann
-&gt; ExactName Name Referent -&gt; m (TermEntry Symbol Ann)
</span><a href="Unison.Server.Backend.html#termListEntry"><span class="hs-identifier hs-var">termListEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349195"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Referent -&gt; ExactName Name Referent
forall name ref. name -&gt; ref -&gt; ExactName name ref
</span><a href="Unison.Server.Types.html#ExactName"><span class="hs-identifier hs-var">ExactName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSegment -&gt; Name
</span><span class="hs-identifier hs-var">Name.fromSegment</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679349208"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349207"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-567"></span><span>  </span><span id="local-6989586621679349210"><span class="annot"><span class="annottext">[ShallowListEntry Symbol Ann]
</span><a href="#local-6989586621679349210"><span class="hs-identifier hs-var">typeEntries</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-568"></span><span>    </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; Transaction [ShallowListEntry Symbol Ann]
-&gt; m [ShallowListEntry Symbol Ann]
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349195"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-569"></span><span>      </span><span class="annot"><span class="annottext">[(TypeReference, NameSegment)]
-&gt; ((TypeReference, NameSegment)
    -&gt; Transaction (ShallowListEntry Symbol Ann))
-&gt; Transaction [ShallowListEntry Symbol Ann]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map NameSegment (Map TypeReference (n MdValues))
-&gt; [(TypeReference, NameSegment)]
forall ref v. Map NameSegment (Map ref v) -&gt; [(ref, NameSegment)]
</span><a href="#local-6989586621679349197"><span class="hs-identifier hs-var">flattenRefs</span></a></span><span> </span><span class="annot"><span class="annottext">(Map NameSegment (Map TypeReference (n MdValues))
 -&gt; [(TypeReference, NameSegment)])
-&gt; Map NameSegment (Map TypeReference (n MdValues))
-&gt; [(TypeReference, NameSegment)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch n -&gt; Map NameSegment (Map TypeReference (n MdValues))
forall (m :: * -&gt; *).
Branch m -&gt; Map NameSegment (Map TypeReference (m MdValues))
</span><span class="hs-identifier hs-var">V2Branch.types</span></span><span> </span><span class="annot"><span class="annottext">Branch n
</span><a href="#local-6989586621679349196"><span class="hs-identifier hs-var">b0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679349212"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349212"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349213"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679349213"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-570"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349214"><span class="annot"><span class="annottext">v1Ref :: TypeReference
</span><a href="#local-6989586621679349214"><span class="hs-identifier hs-var hs-var">v1Ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; TypeReference
</span><span class="hs-identifier hs-var">Cv.reference2to1</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349212"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-571"></span><span>        </span><span class="annot"><span class="annottext">TypeEntry -&gt; ShallowListEntry Symbol Ann
forall v a. TypeEntry -&gt; ShallowListEntry v a
</span><a href="Unison.Server.Backend.html#ShallowTypeEntry"><span class="hs-identifier hs-var">ShallowTypeEntry</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeEntry -&gt; ShallowListEntry Symbol Ann)
-&gt; Transaction TypeEntry
-&gt; Transaction (ShallowListEntry Symbol Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; ExactName Name TypeReference -&gt; Transaction TypeEntry
forall v (m :: * -&gt; *).
Var v =&gt;
Codebase m v Ann
-&gt; ExactName Name TypeReference -&gt; Transaction TypeEntry
</span><a href="Unison.Server.Backend.html#typeListEntry"><span class="hs-identifier hs-var">typeListEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349195"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; TypeReference -&gt; ExactName Name TypeReference
forall name ref. name -&gt; ref -&gt; ExactName name ref
</span><a href="Unison.Server.Types.html#ExactName"><span class="hs-identifier hs-var">ExactName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSegment -&gt; Name
</span><span class="hs-identifier hs-var">Name.fromSegment</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679349213"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349214"><span class="hs-identifier hs-var">v1Ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span>  </span><span id="local-6989586621679349215"><span class="annot"><span class="annottext">Map NameSegment (CausalBranch n, NamespaceStats)
</span><a href="#local-6989586621679349215"><span class="hs-identifier hs-var">childrenWithStats</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; Transaction (Map NameSegment (CausalBranch n, NamespaceStats))
-&gt; m (Map NameSegment (CausalBranch n, NamespaceStats))
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349195"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch n
-&gt; Transaction (Map NameSegment (CausalBranch n, NamespaceStats))
forall (m :: * -&gt; *).
Branch m
-&gt; Transaction (Map NameSegment (CausalBranch m, NamespaceStats))
</span><span class="hs-identifier hs-var">V2Branch.childStats</span></span><span> </span><span class="annot"><span class="annottext">Branch n
</span><a href="#local-6989586621679349196"><span class="hs-identifier hs-var">b0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-573"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349217"><span class="annot"><span class="annottext">[ShallowListEntry Symbol Ann]
</span><a href="#local-6989586621679349217"><span class="hs-identifier hs-var">branchEntries</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.Backend.html#ShallowListEntry"><span class="hs-identifier hs-type">ShallowListEntry</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-574"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679349218"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679349218"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679349219"><span class="annot"><span class="annottext">CausalBranch n
</span><a href="#local-6989586621679349219"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349220"><span class="annot"><span class="annottext">NamespaceStats
</span><a href="#local-6989586621679349220"><span class="hs-identifier hs-var">stats</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map NameSegment (CausalBranch n, NamespaceStats)
-&gt; [(NameSegment, (CausalBranch n, NamespaceStats))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map NameSegment (CausalBranch n, NamespaceStats)
 -&gt; [(NameSegment, (CausalBranch n, NamespaceStats))])
-&gt; Map NameSegment (CausalBranch n, NamespaceStats)
-&gt; [(NameSegment, (CausalBranch n, NamespaceStats))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map NameSegment (CausalBranch n, NamespaceStats)
</span><a href="#local-6989586621679349215"><span class="hs-identifier hs-var">childrenWithStats</span></a></span><span>
</span><span id="line-575"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; [()]
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; [()]) -&gt; Bool -&gt; [()]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NamespaceStats -&gt; Bool
</span><span class="hs-identifier hs-var">V2Branch.hasDefinitions</span></span><span> </span><span class="annot"><span class="annottext">NamespaceStats
</span><a href="#local-6989586621679349220"><span class="hs-identifier hs-var">stats</span></a></span><span>
</span><span id="line-576"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">NameSegment
-&gt; CausalHash -&gt; NamespaceStats -&gt; ShallowListEntry Symbol Ann
forall v a.
NameSegment -&gt; CausalHash -&gt; NamespaceStats -&gt; ShallowListEntry v a
</span><a href="Unison.Server.Backend.html#ShallowBranchEntry"><span class="hs-identifier hs-var">ShallowBranchEntry</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679349218"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalBranch n -&gt; CausalHash
forall (m :: * -&gt; *) hc he pe e. Causal m hc he pe e -&gt; hc
</span><span class="hs-identifier hs-var">V2Causal.causalHash</span></span><span> </span><span class="annot"><span class="annottext">CausalBranch n
</span><a href="#local-6989586621679349219"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NamespaceStats
</span><a href="#local-6989586621679349220"><span class="hs-identifier hs-var">stats</span></a></span><span>
</span><span id="line-577"></span><span>  </span><span class="annot"><span class="annottext">[ShallowListEntry Symbol Ann] -&gt; m [ShallowListEntry Symbol Ann]
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">([ShallowListEntry Symbol Ann] -&gt; m [ShallowListEntry Symbol Ann])
-&gt; ([ShallowListEntry Symbol Ann] -&gt; [ShallowListEntry Symbol Ann])
-&gt; [ShallowListEntry Symbol Ann]
-&gt; m [ShallowListEntry Symbol Ann]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ShallowListEntry Symbol Ann -&gt; Text)
-&gt; [ShallowListEntry Symbol Ann] -&gt; [ShallowListEntry Symbol Ann]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.sortOn</span></span><span> </span><span class="annot"><span class="annottext">ShallowListEntry Symbol Ann -&gt; Text
forall v a. ShallowListEntry v a -&gt; Text
</span><a href="Unison.Server.Backend.html#listEntryName"><span class="hs-identifier hs-var">listEntryName</span></a></span><span> </span><span class="annot"><span class="annottext">([ShallowListEntry Symbol Ann] -&gt; m [ShallowListEntry Symbol Ann])
-&gt; [ShallowListEntry Symbol Ann] -&gt; m [ShallowListEntry Symbol Ann]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-578"></span><span>    </span><span class="annot"><span class="annottext">[ShallowListEntry Symbol Ann]
</span><a href="#local-6989586621679349205"><span class="hs-identifier hs-var">termEntries</span></a></span><span>
</span><span id="line-579"></span><span>      </span><span class="annot"><span class="annottext">[ShallowListEntry Symbol Ann]
-&gt; [ShallowListEntry Symbol Ann] -&gt; [ShallowListEntry Symbol Ann]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ShallowListEntry Symbol Ann]
</span><a href="#local-6989586621679349210"><span class="hs-identifier hs-var">typeEntries</span></a></span><span>
</span><span id="line-580"></span><span>      </span><span class="annot"><span class="annottext">[ShallowListEntry Symbol Ann]
-&gt; [ShallowListEntry Symbol Ann] -&gt; [ShallowListEntry Symbol Ann]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ShallowListEntry Symbol Ann]
</span><a href="#local-6989586621679349217"><span class="hs-identifier hs-var">branchEntries</span></a></span><span>
</span><span id="line-581"></span><span>
</span><span id="line-582"></span><span class="hs-comment">-- Any absolute names in the input which have `root` as a prefix</span><span>
</span><span id="line-583"></span><span class="hs-comment">-- are converted to names relative to current path. All other names are</span><span>
</span><span id="line-584"></span><span class="hs-comment">-- converted to absolute names. For example:</span><span>
</span><span id="line-585"></span><span class="hs-comment">--</span><span>
</span><span id="line-586"></span><span class="hs-comment">-- e.g. if currentPath = .foo.bar</span><span>
</span><span id="line-587"></span><span class="hs-comment">--      then name foo.bar.baz becomes baz</span><span>
</span><span id="line-588"></span><span class="hs-comment">--           name cat.dog     becomes .cat.dog</span><span>
</span><span id="line-589"></span><span class="annot"><a href="Unison.Server.Backend.html#fixupNamesRelative"><span class="hs-identifier hs-type">fixupNamesRelative</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span>
</span><span id="line-590"></span><span id="fixupNamesRelative"><span class="annot"><span class="annottext">fixupNamesRelative :: Absolute -&gt; Names -&gt; Names
</span><a href="Unison.Server.Backend.html#fixupNamesRelative"><span class="hs-identifier hs-var hs-var">fixupNamesRelative</span></a></span></span><span> </span><span id="local-6989586621679349223"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679349223"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span id="local-6989586621679349224"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679349224"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-591"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Path -&gt; Maybe Name
</span><span class="hs-identifier hs-var">Path.toName</span></span><span> </span><span class="annot"><span class="annottext">(Path -&gt; Maybe Name) -&gt; Path -&gt; Maybe Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679349223"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-592"></span><span>    </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679349224"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-593"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679349226"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349226"><span class="hs-identifier hs-var">prefix</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Name
</span><a href="#local-6989586621679349228"><span class="hs-identifier hs-var">fixName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349226"><span class="hs-identifier hs-var">prefix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679349224"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-594"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-595"></span><span>    </span><span id="local-6989586621679349228"><span class="annot"><span class="annottext">fixName :: Name -&gt; Name -&gt; Name
</span><a href="#local-6989586621679349228"><span class="hs-identifier hs-var hs-var">fixName</span></a></span></span><span> </span><span id="local-6989586621679349229"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349229"><span class="hs-identifier hs-var">prefix</span></a></span></span><span> </span><span id="local-6989586621679349230"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349230"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-596"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679349223"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Absolute -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><span class="hs-identifier hs-var">Path.absoluteEmpty</span></span><span>
</span><span id="line-597"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349230"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-598"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Name -&gt; Name
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
</span><span class="hs-identifier hs-var">Name.makeAbsolute</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349230"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Maybe Name
</span><span class="hs-identifier hs-var">Name.stripNamePrefix</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349229"><span class="hs-identifier hs-var">prefix</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349230"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>
</span><span id="line-600"></span><span id="local-6989586621679347570"><span id="local-6989586621679347571"><span class="annot"><a href="Unison.Server.Backend.html#hqNameQuery"><span class="hs-identifier hs-type">hqNameQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-601"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679347570"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347571"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-602"></span><span>  </span><span class="annot"><a href="Unison.Server.NameSearch.html#NameSearch"><span class="hs-identifier hs-type">NameSearch</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-603"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Names.SearchType</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-604"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-605"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="annot"><a href="Unison.Server.QueryResult.html#QueryResult"><span class="hs-identifier hs-type">QueryResult</span></a></span></span></span><span>
</span><span id="line-606"></span><span id="hqNameQuery"><span class="annot"><span class="annottext">hqNameQuery :: forall (m :: * -&gt; *) v.
Codebase m v Ann
-&gt; NameSearch Transaction
-&gt; SearchType
-&gt; [HashQualified Name]
-&gt; Transaction QueryResult
</span><a href="Unison.Server.Backend.html#hqNameQuery"><span class="hs-identifier hs-var hs-var">hqNameQuery</span></a></span></span><span> </span><span id="local-6989586621679349270"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679349270"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="annot"><a href="Unison.Server.NameSearch.html#NameSearch"><span class="hs-identifier hs-type">NameSearch</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679349272"><span class="annot"><span class="annottext">Search Transaction TypeReference
typeSearch :: Search Transaction TypeReference
$sel:typeSearch:NameSearch :: forall (m :: * -&gt; *). NameSearch m -&gt; Search m TypeReference
</span><a href="#local-6989586621679349272"><span class="hs-identifier hs-var hs-var">typeSearch</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349274"><span class="annot"><span class="annottext">Search Transaction Referent
termSearch :: Search Transaction Referent
$sel:termSearch:NameSearch :: forall (m :: * -&gt; *). NameSearch m -&gt; Search m Referent
</span><a href="#local-6989586621679349274"><span class="hs-identifier hs-var hs-var">termSearch</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679349276"><span class="annot"><span class="annottext">SearchType
</span><a href="#local-6989586621679349276"><span class="hs-identifier hs-var">searchType</span></a></span></span><span> </span><span id="local-6989586621679349277"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679349277"><span class="hs-identifier hs-var">hqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-607"></span><span>  </span><span class="hs-comment">-- Split the query into hash-only and hash-qualified-name queries.</span><span>
</span><span id="line-608"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679349278"><span class="annot"><span class="annottext">[ShortHash]
</span><a href="#local-6989586621679349278"><span class="hs-identifier hs-var">hashes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349279"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679349279"><span class="hs-identifier hs-var">hqnames</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either ShortHash (HashQualified Name)]
-&gt; ([ShortHash], [HashQualified Name])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HashQualified Name -&gt; Either ShortHash (HashQualified Name))
-&gt; [HashQualified Name] -&gt; [Either ShortHash (HashQualified Name)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Either ShortHash (HashQualified Name)
forall n. HashQualified n -&gt; Either ShortHash (HashQualified n)
</span><span class="hs-identifier hs-var">HQ'.fromHQ2</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679349277"><span class="hs-identifier hs-var">hqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-609"></span><span>  </span><span class="hs-comment">-- Find the terms with those hashes.</span><span>
</span><span id="line-610"></span><span>  </span><span id="local-6989586621679349282"><span class="annot"><span class="annottext">[(ShortHash, Set Referent)]
</span><a href="#local-6989586621679349282"><span class="hs-identifier hs-var">termRefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-611"></span><span>    </span><span class="annot"><span class="annottext">((ShortHash, Set Referent) -&gt; Bool)
-&gt; [(ShortHash, Set Referent)] -&gt; [(ShortHash, Set Referent)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ((ShortHash, Set Referent) -&gt; Bool)
-&gt; (ShortHash, Set Referent)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">(Set Referent -&gt; Bool)
-&gt; ((ShortHash, Set Referent) -&gt; Set Referent)
-&gt; (ShortHash, Set Referent)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ShortHash, Set Referent) -&gt; Set Referent
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(ShortHash, Set Referent)] -&gt; [(ShortHash, Set Referent)])
-&gt; ([Set Referent] -&gt; [(ShortHash, Set Referent)])
-&gt; [Set Referent]
-&gt; [(ShortHash, Set Referent)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[ShortHash] -&gt; [Set Referent] -&gt; [(ShortHash, Set Referent)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[ShortHash]
</span><a href="#local-6989586621679349278"><span class="hs-identifier hs-var">hashes</span></a></span><span>
</span><span id="line-612"></span><span>      </span><span class="annot"><span class="annottext">([Set Referent] -&gt; [(ShortHash, Set Referent)])
-&gt; Transaction [Set Referent]
-&gt; Transaction [(ShortHash, Set Referent)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(ShortHash -&gt; Transaction (Set Referent))
-&gt; [ShortHash] -&gt; Transaction [Set Referent]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span>
</span><span id="line-613"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; ShortHash -&gt; Transaction (Set Referent)
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; ShortHash -&gt; Transaction (Set Referent)
</span><a href="Unison.Server.NameSearch.Sqlite.html#termReferentsByShortHash"><span class="hs-identifier hs-var">termReferentsByShortHash</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679349270"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>        </span><span class="annot"><span class="annottext">[ShortHash]
</span><a href="#local-6989586621679349278"><span class="hs-identifier hs-var">hashes</span></a></span><span>
</span><span id="line-615"></span><span>  </span><span class="hs-comment">-- Find types with those hashes.</span><span>
</span><span id="line-616"></span><span>  </span><span id="local-6989586621679349287"><span class="annot"><span class="annottext">[(ShortHash, Set TypeReference)]
</span><a href="#local-6989586621679349287"><span class="hs-identifier hs-var">typeRefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-617"></span><span>    </span><span class="annot"><span class="annottext">((ShortHash, Set TypeReference) -&gt; Bool)
-&gt; [(ShortHash, Set TypeReference)]
-&gt; [(ShortHash, Set TypeReference)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ((ShortHash, Set TypeReference) -&gt; Bool)
-&gt; (ShortHash, Set TypeReference)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set TypeReference -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">(Set TypeReference -&gt; Bool)
-&gt; ((ShortHash, Set TypeReference) -&gt; Set TypeReference)
-&gt; (ShortHash, Set TypeReference)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ShortHash, Set TypeReference) -&gt; Set TypeReference
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(ShortHash, Set TypeReference)]
 -&gt; [(ShortHash, Set TypeReference)])
-&gt; ([Set TypeReference] -&gt; [(ShortHash, Set TypeReference)])
-&gt; [Set TypeReference]
-&gt; [(ShortHash, Set TypeReference)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[ShortHash]
-&gt; [Set TypeReference] -&gt; [(ShortHash, Set TypeReference)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[ShortHash]
</span><a href="#local-6989586621679349278"><span class="hs-identifier hs-var">hashes</span></a></span><span>
</span><span id="line-618"></span><span>      </span><span class="annot"><span class="annottext">([Set TypeReference] -&gt; [(ShortHash, Set TypeReference)])
-&gt; Transaction [Set TypeReference]
-&gt; Transaction [(ShortHash, Set TypeReference)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(ShortHash -&gt; Transaction (Set TypeReference))
-&gt; [ShortHash] -&gt; Transaction [Set TypeReference]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span>
</span><span id="line-619"></span><span>        </span><span class="annot"><span class="annottext">ShortHash -&gt; Transaction (Set TypeReference)
</span><a href="Unison.Server.NameSearch.Sqlite.html#typeReferencesByShortHash"><span class="hs-identifier hs-var">typeReferencesByShortHash</span></a></span><span>
</span><span id="line-620"></span><span>        </span><span class="annot"><span class="annottext">[ShortHash]
</span><a href="#local-6989586621679349278"><span class="hs-identifier hs-var">hashes</span></a></span><span>
</span><span id="line-621"></span><span>  </span><span class="hs-comment">-- Now do the name queries.</span><span>
</span><span id="line-622"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349288"><span class="annot"><span class="annottext">mkTermResult :: ShortHash -&gt; Referent -&gt; SearchResult
</span><a href="#local-6989586621679349288"><span class="hs-identifier hs-var hs-var">mkTermResult</span></a></span></span><span> </span><span id="local-6989586621679349289"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679349289"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span id="local-6989586621679349290"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349290"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
-&gt; Referent -&gt; Set (HashQualified Name) -&gt; SearchResult
</span><a href="Unison.Server.SearchResult.html#termResult"><span class="hs-identifier hs-var">SR.termResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortHash -&gt; HashQualified Name
forall n. ShortHash -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.HashOnly</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679349289"><span class="hs-identifier hs-var">sh</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349290"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-623"></span><span>      </span><span id="local-6989586621679349294"><span class="annot"><span class="annottext">mkTypeResult :: ShortHash -&gt; TypeReference -&gt; SearchResult
</span><a href="#local-6989586621679349294"><span class="hs-identifier hs-var hs-var">mkTypeResult</span></a></span></span><span> </span><span id="local-6989586621679349295"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679349295"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span id="local-6989586621679349296"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349296"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
-&gt; TypeReference -&gt; Set (HashQualified Name) -&gt; SearchResult
</span><a href="Unison.Server.SearchResult.html#typeResult"><span class="hs-identifier hs-var">SR.typeResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortHash -&gt; HashQualified Name
forall n. ShortHash -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.HashOnly</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679349295"><span class="hs-identifier hs-var">sh</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349296"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-624"></span><span>      </span><span class="hs-comment">-- Transform the hash results a bit</span><span>
</span><span id="line-625"></span><span>      </span><span id="local-6989586621679349298"><span class="annot"><span class="annottext">termResults :: [[SearchResult]]
</span><a href="#local-6989586621679349298"><span class="hs-identifier hs-var hs-var">termResults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-626"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679349299"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679349299"><span class="hs-identifier hs-var">sh</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349300"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679349300"><span class="hs-identifier hs-var">tms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; Referent -&gt; SearchResult
</span><a href="#local-6989586621679349288"><span class="hs-identifier hs-var">mkTermResult</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679349299"><span class="hs-identifier hs-var">sh</span></a></span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; SearchResult) -&gt; [Referent] -&gt; [SearchResult]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; [Referent]
forall a. Set a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679349300"><span class="hs-identifier hs-var">tms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ShortHash, Set Referent) -&gt; [SearchResult])
-&gt; [(ShortHash, Set Referent)] -&gt; [[SearchResult]]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(ShortHash, Set Referent)]
</span><a href="#local-6989586621679349282"><span class="hs-identifier hs-var">termRefs</span></a></span><span>
</span><span id="line-627"></span><span>      </span><span id="local-6989586621679349301"><span class="annot"><span class="annottext">typeResults :: [[SearchResult]]
</span><a href="#local-6989586621679349301"><span class="hs-identifier hs-var hs-var">typeResults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-628"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679349302"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679349302"><span class="hs-identifier hs-var">sh</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349303"><span class="annot"><span class="annottext">Set TypeReference
</span><a href="#local-6989586621679349303"><span class="hs-identifier hs-var">tps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; TypeReference -&gt; SearchResult
</span><a href="#local-6989586621679349294"><span class="hs-identifier hs-var">mkTypeResult</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679349302"><span class="hs-identifier hs-var">sh</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeReference -&gt; SearchResult)
-&gt; [TypeReference] -&gt; [SearchResult]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set TypeReference -&gt; [TypeReference]
forall a. Set a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set TypeReference
</span><a href="#local-6989586621679349303"><span class="hs-identifier hs-var">tps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ShortHash, Set TypeReference) -&gt; [SearchResult])
-&gt; [(ShortHash, Set TypeReference)] -&gt; [[SearchResult]]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(ShortHash, Set TypeReference)]
</span><a href="#local-6989586621679349287"><span class="hs-identifier hs-var">typeRefs</span></a></span><span>
</span><span id="line-629"></span><span>
</span><span id="line-630"></span><span>  </span><span class="hs-comment">-- Now do the actual name query</span><span>
</span><span id="line-631"></span><span>  </span><span id="local-6989586621679349304"><span class="annot"><span class="annottext">[[SearchResult]]
</span><a href="#local-6989586621679349304"><span class="hs-identifier hs-var">resultss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
-&gt; (HashQualified Name -&gt; Transaction [SearchResult])
-&gt; Transaction [[SearchResult]]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679349279"><span class="hs-identifier hs-var">hqnames</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679349305"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679349305"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([SearchResult] -&gt; [SearchResult] -&gt; [SearchResult])
-&gt; Transaction [SearchResult]
-&gt; Transaction [SearchResult]
-&gt; Transaction [SearchResult]
forall a b c.
(a -&gt; b -&gt; c) -&gt; Transaction a -&gt; Transaction b -&gt; Transaction c
forall (f :: * -&gt; *) a b c.
Applicative f =&gt;
(a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><span class="hs-identifier hs-var">liftA2</span></span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; [SearchResult] -&gt; [SearchResult]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Search Transaction TypeReference
-&gt; SearchType -&gt; HashQualified Name -&gt; Transaction [SearchResult]
forall r (m :: * -&gt; *).
(Show r, Monad m) =&gt;
Search m r -&gt; SearchType -&gt; HashQualified Name -&gt; m [SearchResult]
</span><a href="Unison.Server.NameSearch.html#applySearch"><span class="hs-identifier hs-var">applySearch</span></a></span><span> </span><span class="annot"><span class="annottext">Search Transaction TypeReference
</span><a href="#local-6989586621679349272"><span class="hs-identifier hs-var">typeSearch</span></a></span><span> </span><span class="annot"><span class="annottext">SearchType
</span><a href="#local-6989586621679349276"><span class="hs-identifier hs-var">searchType</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679349305"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Search Transaction Referent
-&gt; SearchType -&gt; HashQualified Name -&gt; Transaction [SearchResult]
forall r (m :: * -&gt; *).
(Show r, Monad m) =&gt;
Search m r -&gt; SearchType -&gt; HashQualified Name -&gt; m [SearchResult]
</span><a href="Unison.Server.NameSearch.html#applySearch"><span class="hs-identifier hs-var">applySearch</span></a></span><span> </span><span class="annot"><span class="annottext">Search Transaction Referent
</span><a href="#local-6989586621679349274"><span class="hs-identifier hs-var">termSearch</span></a></span><span> </span><span class="annot"><span class="annottext">SearchType
</span><a href="#local-6989586621679349276"><span class="hs-identifier hs-var">searchType</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679349305"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-632"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679349307"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679349307"><span class="hs-identifier hs-var">misses</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349308"><span class="annot"><span class="annottext">[[SearchResult]]
</span><a href="#local-6989586621679349308"><span class="hs-identifier hs-var">hits</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-633"></span><span>        </span><span class="annot"><span class="annottext">(HashQualified Name
 -&gt; [SearchResult] -&gt; Either (HashQualified Name) [SearchResult])
-&gt; [HashQualified Name]
-&gt; [[SearchResult]]
-&gt; [Either (HashQualified Name) [SearchResult]]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span>
</span><span id="line-634"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679349310"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679349310"><span class="hs-identifier hs-var">hqname</span></a></span></span><span> </span><span id="local-6989586621679349311"><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679349311"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-635"></span><span>              </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679349311"><span class="hs-identifier hs-var">results</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Either (HashQualified Name) [SearchResult]
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679349310"><span class="hs-identifier hs-var">hqname</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; Either (HashQualified Name) [SearchResult]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679349311"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-636"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-637"></span><span>          </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679349279"><span class="hs-identifier hs-var">hqnames</span></a></span><span>
</span><span id="line-638"></span><span>          </span><span class="annot"><span class="annottext">[[SearchResult]]
</span><a href="#local-6989586621679349304"><span class="hs-identifier hs-var">resultss</span></a></span><span>
</span><span id="line-639"></span><span>          </span><span class="annot"><span class="annottext">[Either (HashQualified Name) [SearchResult]]
-&gt; ([Either (HashQualified Name) [SearchResult]]
    -&gt; ([HashQualified Name], [[SearchResult]]))
-&gt; ([HashQualified Name], [[SearchResult]])
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Either (HashQualified Name) [SearchResult]]
-&gt; ([HashQualified Name], [[SearchResult]])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span>
</span><span id="line-640"></span><span>      </span><span class="hs-comment">-- Handle query misses correctly</span><span>
</span><span id="line-641"></span><span>      </span><span id="local-6989586621679349314"><span class="annot"><span class="annottext">missingRefs :: [HashQualified Name]
</span><a href="#local-6989586621679349314"><span class="hs-identifier hs-var hs-var">missingRefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-642"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; HashQualified Name
forall n. ShortHash -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.HashOnly</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679349315"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-643"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679349315"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679349315"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ShortHash]
</span><a href="#local-6989586621679349278"><span class="hs-identifier hs-var">hashes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-644"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Set Referent) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortHash -&gt; [(ShortHash, Set Referent)] -&gt; Maybe (Set Referent)
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679349315"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[(ShortHash, Set Referent)]
</span><a href="#local-6989586621679349282"><span class="hs-identifier hs-var">termRefs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Set TypeReference) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortHash
-&gt; [(ShortHash, Set TypeReference)] -&gt; Maybe (Set TypeReference)
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679349315"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[(ShortHash, Set TypeReference)]
</span><a href="#local-6989586621679349287"><span class="hs-identifier hs-var">typeRefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-645"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-646"></span><span>      </span><span class="hs-comment">-- Gather the results</span><span>
</span><span id="line-647"></span><span>      </span><span id="local-6989586621679349319"><span class="annot"><span class="annottext">results :: [SearchResult]
</span><a href="#local-6989586621679349319"><span class="hs-identifier hs-var hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-648"></span><span>        </span><span class="annot"><span class="annottext">[SearchResult] -&gt; [SearchResult]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.sort</span></span><span>
</span><span id="line-649"></span><span>          </span><span class="annot"><span class="annottext">([SearchResult] -&gt; [SearchResult])
-&gt; ([[SearchResult]] -&gt; [SearchResult])
-&gt; [[SearchResult]]
-&gt; [SearchResult]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(SearchResult -&gt; Referent) -&gt; [SearchResult] -&gt; [SearchResult]
forall (f :: * -&gt; *) b a.
(Foldable f, Ord b) =&gt;
(a -&gt; b) -&gt; f a -&gt; [a]
</span><span class="hs-identifier hs-var">uniqueBy</span></span><span> </span><span class="annot"><span class="annottext">SearchResult -&gt; Referent
</span><a href="Unison.Server.SearchResult.html#toReferent"><span class="hs-identifier hs-var">SR.toReferent</span></a></span><span>
</span><span id="line-650"></span><span>          </span><span class="annot"><span class="annottext">([SearchResult] -&gt; [SearchResult])
-&gt; ([[SearchResult]] -&gt; [SearchResult])
-&gt; [[SearchResult]]
-&gt; [SearchResult]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[SearchResult]] -&gt; [SearchResult]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-651"></span><span>          </span><span class="annot"><span class="annottext">([[SearchResult]] -&gt; [SearchResult])
-&gt; [[SearchResult]] -&gt; [SearchResult]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[SearchResult]]
</span><a href="#local-6989586621679349308"><span class="hs-identifier hs-var">hits</span></a></span><span> </span><span class="annot"><span class="annottext">[[SearchResult]] -&gt; [[SearchResult]] -&gt; [[SearchResult]]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[[SearchResult]]
</span><a href="#local-6989586621679349298"><span class="hs-identifier hs-var">termResults</span></a></span><span> </span><span class="annot"><span class="annottext">[[SearchResult]] -&gt; [[SearchResult]] -&gt; [[SearchResult]]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[[SearchResult]]
</span><a href="#local-6989586621679349301"><span class="hs-identifier hs-var">typeResults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-652"></span><span>  </span><span class="annot"><span class="annottext">QueryResult -&gt; Transaction QueryResult
forall a. a -&gt; Transaction a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-653"></span><span>    </span><span class="annot"><a href="Unison.Server.QueryResult.html#QueryResult"><span class="hs-identifier hs-type">QueryResult</span></a></span><span>
</span><span id="line-654"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:misses:QueryResult :: [HashQualified Name]
</span><a href="#local-6989586621679349324"><span class="hs-identifier hs-var">misses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679349314"><span class="hs-identifier hs-var">missingRefs</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
-&gt; [HashQualified Name] -&gt; [HashQualified Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; HashQualified Name)
-&gt; [HashQualified Name] -&gt; [HashQualified Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; HashQualified Name
forall n. HashQualified n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.toHQ</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679349307"><span class="hs-identifier hs-var">misses</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-655"></span><span>        </span><span class="annot"><span class="annottext">$sel:hits:QueryResult :: [SearchResult]
</span><a href="#local-6989586621679349326"><span class="hs-identifier hs-var">hits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679349319"><span class="hs-identifier hs-var">results</span></a></span><span>
</span><span id="line-656"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span class="hs-comment">-- TODO: Move this to its own module</span><span>
</span><span id="line-659"></span><span class="hs-keyword">data</span><span> </span><span id="DefinitionResults"><span class="annot"><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier hs-var">DefinitionResults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DefinitionResults"><span class="annot"><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier hs-var">DefinitionResults</span></a></span></span><span>
</span><span id="line-660"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AtermResults%3ADefinitionResults"><span class="annot"><span class="annottext">DefinitionResults
-&gt; Map
     TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="Unison.Server.Backend.html#%24sel%3AtermResults%3ADefinitionResults"><span class="hs-identifier hs-var hs-var">termResults</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-661"></span><span>    </span><span id="%24sel%3AtypeResults%3ADefinitionResults"><span class="annot"><span class="annottext">DefinitionResults
-&gt; Map TypeReference (DisplayObject () (Decl Symbol Ann))
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeResults%3ADefinitionResults"><span class="hs-identifier hs-var hs-var">typeResults</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DD.Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-662"></span><span>    </span><span id="%24sel%3AnoResults%3ADefinitionResults"><span class="annot"><span class="annottext">DefinitionResults -&gt; [HashQualified Name]
</span><a href="Unison.Server.Backend.html#%24sel%3AnoResults%3ADefinitionResults"><span class="hs-identifier hs-var hs-var">noResults</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span>
</span><span id="line-663"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-664"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679349332"><span id="local-6989586621679349343"><span id="local-6989586621679349347"><span class="annot"><span class="annottext">Int -&gt; DefinitionResults -&gt; ShowS
[DefinitionResults] -&gt; ShowS
DefinitionResults -&gt; WatchKind
(Int -&gt; DefinitionResults -&gt; ShowS)
-&gt; (DefinitionResults -&gt; WatchKind)
-&gt; ([DefinitionResults] -&gt; ShowS)
-&gt; Show DefinitionResults
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; WatchKind) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; DefinitionResults -&gt; ShowS
showsPrec :: Int -&gt; DefinitionResults -&gt; ShowS
$cshow :: DefinitionResults -&gt; WatchKind
show :: DefinitionResults -&gt; WatchKind
$cshowList :: [DefinitionResults] -&gt; ShowS
showList :: [DefinitionResults] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-665"></span><span>
</span><span id="line-666"></span><span class="hs-comment">-- | Finds ALL direct references contained within a 'DefinitionResults' so we can</span><span>
</span><span id="line-667"></span><span class="hs-comment">-- build a pretty printer for them.</span><span>
</span><span id="line-668"></span><span class="annot"><a href="Unison.Server.Backend.html#definitionResultsDependencies"><span class="hs-identifier hs-type">definitionResultsDependencies</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier hs-type">DefinitionResults</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LD.LabeledDependency</span></span><span>
</span><span id="line-669"></span><span id="definitionResultsDependencies"><span class="annot"><span class="annottext">definitionResultsDependencies :: DefinitionResults -&gt; Set LabeledDependency
</span><a href="Unison.Server.Backend.html#definitionResultsDependencies"><span class="hs-identifier hs-var hs-var">definitionResultsDependencies</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier hs-type">DefinitionResults</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679349369"><span class="annot"><span class="annottext">Map
  TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
$sel:termResults:DefinitionResults :: DefinitionResults
-&gt; Map
     TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
termResults :: Map
  TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="Unison.Server.Backend.html#%24sel%3AtermResults%3ADefinitionResults"><span class="hs-identifier hs-var hs-var">termResults</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349370"><span class="annot"><span class="annottext">Map TypeReference (DisplayObject () (Decl Symbol Ann))
$sel:typeResults:DefinitionResults :: DefinitionResults
-&gt; Map TypeReference (DisplayObject () (Decl Symbol Ann))
typeResults :: Map TypeReference (DisplayObject () (Decl Symbol Ann))
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeResults%3ADefinitionResults"><span class="hs-identifier hs-var hs-var">typeResults</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-670"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349371"><span class="annot"><span class="annottext">topLevelTerms :: Set LabeledDependency
</span><a href="#local-6989586621679349371"><span class="hs-identifier hs-var hs-var">topLevelTerms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LabeledDependency] -&gt; Set LabeledDependency
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([LabeledDependency] -&gt; Set LabeledDependency)
-&gt; ([TypeReference] -&gt; [LabeledDependency])
-&gt; [TypeReference]
-&gt; Set LabeledDependency
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TypeReference -&gt; LabeledDependency)
-&gt; [TypeReference] -&gt; [LabeledDependency]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; LabeledDependency
</span><span class="hs-identifier hs-var">LD.TermReference</span></span><span> </span><span class="annot"><span class="annottext">([TypeReference] -&gt; Set LabeledDependency)
-&gt; [TypeReference] -&gt; Set LabeledDependency
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map
  TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
-&gt; [TypeReference]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">Map
  TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="#local-6989586621679349369"><span class="hs-identifier hs-var">termResults</span></a></span><span>
</span><span id="line-671"></span><span>      </span><span id="local-6989586621679349374"><span class="annot"><span class="annottext">topLevelTypes :: Set LabeledDependency
</span><a href="#local-6989586621679349374"><span class="hs-identifier hs-var hs-var">topLevelTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LabeledDependency] -&gt; Set LabeledDependency
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([LabeledDependency] -&gt; Set LabeledDependency)
-&gt; ([TypeReference] -&gt; [LabeledDependency])
-&gt; [TypeReference]
-&gt; Set LabeledDependency
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TypeReference -&gt; LabeledDependency)
-&gt; [TypeReference] -&gt; [LabeledDependency]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; LabeledDependency
</span><span class="hs-identifier hs-var">LD.TypeReference</span></span><span> </span><span class="annot"><span class="annottext">([TypeReference] -&gt; Set LabeledDependency)
-&gt; [TypeReference] -&gt; Set LabeledDependency
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map TypeReference (DisplayObject () (Decl Symbol Ann))
-&gt; [TypeReference]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">Map TypeReference (DisplayObject () (Decl Symbol Ann))
</span><a href="#local-6989586621679349370"><span class="hs-identifier hs-var">typeResults</span></a></span><span>
</span><span id="line-672"></span><span>      </span><span id="local-6989586621679349375"><span class="annot"><span class="annottext">termDeps :: Set LabeledDependency
</span><a href="#local-6989586621679349375"><span class="hs-identifier hs-var hs-var">termDeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-673"></span><span>        </span><span class="annot"><span class="annottext">Map
  TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="#local-6989586621679349369"><span class="hs-identifier hs-var">termResults</span></a></span><span>
</span><span id="line-674"></span><span>          </span><span class="annot"><span class="annottext">Map
  TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
-&gt; (Map
      TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
    -&gt; Set LabeledDependency)
-&gt; Set LabeledDependency
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (Set LabeledDependency)
  (Map
     TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
  (Set LabeledDependency)
-&gt; Map
     TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
-&gt; Set LabeledDependency
forall a s. Getting a s a -&gt; s -&gt; a
</span><span class="hs-identifier hs-var">foldOf</span></span><span>
</span><span id="line-675"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(DisplayObject (Type Symbol Ann) (Term Symbol Ann)
 -&gt; Const
      (Set LabeledDependency)
      (DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
-&gt; Map
     TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
-&gt; Const
     (Set LabeledDependency)
     (Map
        TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
forall (f :: * -&gt; *) a. Foldable f =&gt; IndexedFold Int (f a) a
IndexedFold
  Int
  (Map
     TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
  (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><span class="hs-identifier hs-var">folded</span></span><span>
</span><span id="line-676"></span><span>                </span><span class="annot"><span class="annottext">((DisplayObject (Type Symbol Ann) (Term Symbol Ann)
  -&gt; Const
       (Set LabeledDependency)
       (DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
 -&gt; Map
      TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
 -&gt; Const
      (Set LabeledDependency)
      (Map
         TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))))
-&gt; ((Set LabeledDependency
     -&gt; Const (Set LabeledDependency) (Set LabeledDependency))
    -&gt; DisplayObject (Type Symbol Ann) (Term Symbol Ann)
    -&gt; Const
         (Set LabeledDependency)
         (DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
-&gt; Getting
     (Set LabeledDependency)
     (Map
        TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
     (Set LabeledDependency)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Optical
  (-&gt;)
  (-&gt;)
  (Const (Set LabeledDependency))
  (Type Symbol Ann)
  (Type Symbol Ann)
  (Set LabeledDependency)
  (Set LabeledDependency)
-&gt; Optical
     (-&gt;)
     (-&gt;)
     (Const (Set LabeledDependency))
     (Term Symbol Ann)
     (Term Symbol Ann)
     (Set LabeledDependency)
     (Set LabeledDependency)
-&gt; (Set LabeledDependency
    -&gt; Const (Set LabeledDependency) (Set LabeledDependency))
-&gt; DisplayObject (Type Symbol Ann) (Term Symbol Ann)
-&gt; Const
     (Set LabeledDependency)
     (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
forall (q :: * -&gt; * -&gt; *) (f :: * -&gt; *) (r :: * -&gt; * -&gt; *)
       (p :: * -&gt; * -&gt; *) s t a b s' t'.
(Representable q, Applicative (Rep q), Applicative f,
 Bitraversable r) =&gt;
Optical p q f s t a b
-&gt; Optical p q f s' t' a b -&gt; Optical p q f (r s s') (r t t') a b
</span><span class="hs-identifier hs-var">beside</span></span><span>
</span><span id="line-677"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type Symbol Ann -&gt; Set LabeledDependency)
-&gt; Optical
     (-&gt;)
     (-&gt;)
     (Const (Set LabeledDependency))
     (Type Symbol Ann)
     (Type Symbol Ann)
     (Set LabeledDependency)
     (Set LabeledDependency)
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s a.
(Profunctor p, Contravariant f) =&gt;
(s -&gt; a) -&gt; Optic' p f s a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Set LabeledDependency
forall v a. Ord v =&gt; Type v a -&gt; Set LabeledDependency
</span><span class="hs-identifier hs-var">Type.labeledDependencies</span></span><span class="hs-special">)</span><span>
</span><span id="line-678"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Term Symbol Ann -&gt; Set LabeledDependency)
-&gt; Optical
     (-&gt;)
     (-&gt;)
     (Const (Set LabeledDependency))
     (Term Symbol Ann)
     (Term Symbol Ann)
     (Set LabeledDependency)
     (Set LabeledDependency)
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s a.
(Profunctor p, Contravariant f) =&gt;
(s -&gt; a) -&gt; Optic' p f s a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann -&gt; Set LabeledDependency
forall v vt at ap a.
(Ord v, Ord vt) =&gt;
Term2 vt at ap v a -&gt; Set LabeledDependency
</span><span class="hs-identifier hs-var">Term.labeledDependencies</span></span><span class="hs-special">)</span><span>
</span><span id="line-679"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-680"></span><span>      </span><span id="local-6989586621679349381"><span class="annot"><span class="annottext">typeDeps :: Set LabeledDependency
</span><a href="#local-6989586621679349381"><span class="hs-identifier hs-var hs-var">typeDeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-681"></span><span>        </span><span class="annot"><span class="annottext">Map TypeReference (DisplayObject () (Decl Symbol Ann))
</span><a href="#local-6989586621679349370"><span class="hs-identifier hs-var">typeResults</span></a></span><span>
</span><span id="line-682"></span><span>          </span><span class="annot"><span class="annottext">Map TypeReference (DisplayObject () (Decl Symbol Ann))
-&gt; (Map TypeReference (DisplayObject () (Decl Symbol Ann))
    -&gt; Set LabeledDependency)
-&gt; Set LabeledDependency
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TypeReference
 -&gt; DisplayObject () (Decl Symbol Ann) -&gt; Set LabeledDependency)
-&gt; Map TypeReference (DisplayObject () (Decl Symbol Ann))
-&gt; Set LabeledDependency
forall m a.
Monoid m =&gt;
(TypeReference -&gt; a -&gt; m) -&gt; Map TypeReference a -&gt; m
forall i (f :: * -&gt; *) m a.
(FoldableWithIndex i f, Monoid m) =&gt;
(i -&gt; a -&gt; m) -&gt; f a -&gt; m
</span><span class="hs-identifier hs-var">ifoldMap</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679349383"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349383"><span class="hs-identifier hs-var">typeRef</span></a></span></span><span> </span><span id="local-6989586621679349384"><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
</span><a href="#local-6989586621679349384"><span class="hs-identifier hs-var">ddObj</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-683"></span><span>            </span><span class="annot"><span class="annottext">(Decl Symbol Ann -&gt; Set LabeledDependency)
-&gt; DisplayObject () (Decl Symbol Ann) -&gt; Set LabeledDependency
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; DisplayObject () a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference -&gt; Decl Symbol Ann -&gt; Set LabeledDependency
forall v a.
Var v =&gt;
TypeReference -&gt; Decl v a -&gt; Set LabeledDependency
</span><span class="hs-identifier hs-var">DD.labeledDeclDependenciesIncludingSelfAndFieldAccessors</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349383"><span class="hs-identifier hs-var">typeRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
</span><a href="#local-6989586621679349384"><span class="hs-identifier hs-var">ddObj</span></a></span><span>
</span><span id="line-684"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679349375"><span class="hs-identifier hs-var">termDeps</span></a></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
-&gt; Set LabeledDependency -&gt; Set LabeledDependency
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679349381"><span class="hs-identifier hs-var">typeDeps</span></a></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
-&gt; Set LabeledDependency -&gt; Set LabeledDependency
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679349371"><span class="hs-identifier hs-var">topLevelTerms</span></a></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
-&gt; Set LabeledDependency -&gt; Set LabeledDependency
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679349374"><span class="hs-identifier hs-var">topLevelTypes</span></a></span><span>
</span><span id="line-685"></span><span>
</span><span id="line-686"></span><span class="annot"><a href="Unison.Server.Backend.html#expandShortCausalHash"><span class="hs-identifier hs-type">expandShortCausalHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortCausalHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span>
</span><span id="line-687"></span><span id="expandShortCausalHash"><span class="annot"><span class="annottext">expandShortCausalHash :: ShortCausalHash -&gt; Backend Transaction CausalHash
</span><a href="Unison.Server.Backend.html#expandShortCausalHash"><span class="hs-identifier hs-var hs-var">expandShortCausalHash</span></a></span></span><span> </span><span id="local-6989586621679349386"><span class="annot"><span class="annottext">ShortCausalHash
</span><a href="#local-6989586621679349386"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-688"></span><span>  </span><span id="local-6989586621679349387"><span class="annot"><span class="annottext">Set CausalHash
</span><a href="#local-6989586621679349387"><span class="hs-identifier hs-var">hashSet</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Transaction (Set CausalHash)
-&gt; Backend Transaction (Set CausalHash)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; Backend m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Transaction (Set CausalHash)
 -&gt; Backend Transaction (Set CausalHash))
-&gt; Transaction (Set CausalHash)
-&gt; Backend Transaction (Set CausalHash)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShortCausalHash -&gt; Transaction (Set CausalHash)
</span><span class="hs-identifier hs-var">Codebase.causalHashesByPrefix</span></span><span> </span><span class="annot"><span class="annottext">ShortCausalHash
</span><a href="#local-6989586621679349386"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-689"></span><span>  </span><span id="local-6989586621679349389"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679349389"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Transaction Int -&gt; Backend Transaction Int
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; Backend m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Transaction Int -&gt; Backend Transaction Int)
-&gt; Transaction Int -&gt; Backend Transaction Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Transaction Int
</span><span class="hs-identifier hs-var">Codebase.branchHashLength</span></span><span>
</span><span id="line-690"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Set CausalHash -&gt; [CausalHash]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set CausalHash
</span><a href="#local-6989586621679349387"><span class="hs-identifier hs-var">hashSet</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-691"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BackendError -&gt; Backend Transaction CausalHash
forall a. BackendError -&gt; Backend Transaction a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(BackendError -&gt; Backend Transaction CausalHash)
-&gt; BackendError -&gt; Backend Transaction CausalHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShortCausalHash -&gt; BackendError
</span><a href="Unison.Server.Backend.html#CouldntExpandBranchHash"><span class="hs-identifier hs-var">CouldntExpandBranchHash</span></a></span><span> </span><span class="annot"><span class="annottext">ShortCausalHash
</span><a href="#local-6989586621679349386"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-692"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621679349392"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679349392"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CausalHash -&gt; Backend Transaction CausalHash
forall a. a -&gt; Backend Transaction a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679349392"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-693"></span><span>    </span><span class="annot"><span class="annottext">[CausalHash]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-694"></span><span>      </span><span class="annot"><span class="annottext">BackendError -&gt; Backend Transaction CausalHash
forall a. BackendError -&gt; Backend Transaction a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(BackendError -&gt; Backend Transaction CausalHash)
-&gt; (Set ShortCausalHash -&gt; BackendError)
-&gt; Set ShortCausalHash
-&gt; Backend Transaction CausalHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShortCausalHash -&gt; Set ShortCausalHash -&gt; BackendError
</span><a href="Unison.Server.Backend.html#AmbiguousBranchHash"><span class="hs-identifier hs-var">AmbiguousBranchHash</span></a></span><span> </span><span class="annot"><span class="annottext">ShortCausalHash
</span><a href="#local-6989586621679349386"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">(Set ShortCausalHash -&gt; Backend Transaction CausalHash)
-&gt; Set ShortCausalHash -&gt; Backend Transaction CausalHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(CausalHash -&gt; ShortCausalHash)
-&gt; Set CausalHash -&gt; Set ShortCausalHash
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; CausalHash -&gt; ShortCausalHash
</span><span class="hs-identifier hs-var">SCH.fromHash</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679349389"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set CausalHash
</span><a href="#local-6989586621679349387"><span class="hs-identifier hs-var">hashSet</span></a></span><span>
</span><span id="line-695"></span><span>
</span><span id="line-696"></span><span class="annot"><span class="hs-comment">-- | Efficiently resolve a root hash and path to a shallow branch's causal.</span></span><span>
</span><span id="line-697"></span><span class="annot"><a href="Unison.Server.Backend.html#getShallowCausalAtPathFromRootHash"><span class="hs-identifier hs-type">getShallowCausalAtPathFromRootHash</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-698"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-699"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-700"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2Branch.CausalBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span id="getShallowCausalAtPathFromRootHash"><span class="annot"><span class="annottext">getShallowCausalAtPathFromRootHash :: CausalHash -&gt; Path -&gt; Transaction (CausalBranch Transaction)
</span><a href="Unison.Server.Backend.html#getShallowCausalAtPathFromRootHash"><span class="hs-identifier hs-var hs-var">getShallowCausalAtPathFromRootHash</span></a></span></span><span> </span><span id="local-6989586621679349395"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679349395"><span class="hs-identifier hs-var">rootHash</span></a></span></span><span> </span><span id="local-6989586621679349396"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679349396"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-702"></span><span>  </span><span id="local-6989586621679349397"><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679349397"><span class="hs-identifier hs-var">shallowRoot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CausalHash -&gt; Transaction (CausalBranch Transaction)
</span><span class="hs-identifier hs-var">Codebase.expectCausalBranchByCausalHash</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679349395"><span class="hs-identifier hs-var">rootHash</span></a></span><span>
</span><span id="line-703"></span><span>  </span><span class="annot"><span class="annottext">Path
-&gt; CausalBranch Transaction
-&gt; Transaction (CausalBranch Transaction)
</span><span class="hs-identifier hs-var">Codebase.getShallowCausalAtPath</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679349396"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621679349397"><span class="hs-identifier hs-var">shallowRoot</span></a></span><span>
</span><span id="line-704"></span><span>
</span><span id="line-705"></span><span id="local-6989586621679347669"><span id="local-6989586621679347670"><span class="annot"><a href="Unison.Server.Backend.html#formatType%27"><span class="hs-identifier hs-type">formatType'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679347669"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679347669"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347670"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span></span></span><span>
</span><span id="line-706"></span><span id="formatType%27"><span class="annot"><span class="annottext">formatType' :: forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Width -&gt; Type v a -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatType%27"><span class="hs-identifier hs-var hs-var">formatType'</span></a></span></span><span> </span><span id="local-6989586621679349404"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349404"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679349405"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349405"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-707"></span><span>  </span><span class="annot"><span class="annottext">Width -&gt; Pretty SyntaxText -&gt; SyntaxText
forall s. (Monoid s, IsString s) =&gt; Width -&gt; Pretty s -&gt; s
</span><span class="hs-identifier hs-var">Pretty.render</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349405"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">(Pretty SyntaxText -&gt; SyntaxText)
-&gt; (Type v a -&gt; Pretty SyntaxText) -&gt; Type v a -&gt; SyntaxText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Type v a -&gt; Pretty SyntaxText
forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Type v a -&gt; Pretty SyntaxText
</span><span class="hs-identifier hs-var">TypePrinter.prettySyntax</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349404"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-708"></span><span>
</span><span id="line-709"></span><span id="local-6989586621679347540"><span id="local-6989586621679347541"><span class="annot"><a href="Unison.Server.Backend.html#formatType"><span class="hs-identifier hs-type">formatType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679347540"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679347540"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347541"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Syntax.html#SyntaxText"><span class="hs-identifier hs-type">Syntax.SyntaxText</span></a></span></span></span><span>
</span><span id="line-710"></span><span id="formatType"><span class="annot"><span class="annottext">formatType :: forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Width -&gt; Type v a -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatType"><span class="hs-identifier hs-var hs-var">formatType</span></a></span></span><span> </span><span id="local-6989586621679349410"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349410"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679349411"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349411"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SyntaxText -&gt; SyntaxText
forall (g :: * -&gt; *).
Functor g =&gt;
g (Element TypeReference) -&gt; g Element
</span><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-var">mungeSyntaxText</span></a></span><span> </span><span class="annot"><span class="annottext">(SyntaxText -&gt; SyntaxText)
-&gt; (Type v a -&gt; SyntaxText) -&gt; Type v a -&gt; SyntaxText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Width -&gt; Type v a -&gt; SyntaxText
forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Width -&gt; Type v a -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatType%27"><span class="hs-identifier hs-var">formatType'</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349410"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349411"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-711"></span><span>
</span><span id="line-712"></span><span id="local-6989586621679347678"><span class="annot"><a href="Unison.Server.Backend.html#formatSuffixedType"><span class="hs-identifier hs-type">formatSuffixedType</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-713"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679347678"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-714"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-715"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-716"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679347678"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-717"></span><span>  </span><span class="annot"><a href="Unison.Server.Syntax.html#SyntaxText"><span class="hs-identifier hs-type">Syntax.SyntaxText</span></a></span></span><span>
</span><span id="line-718"></span><span id="formatSuffixedType"><span class="annot"><span class="annottext">formatSuffixedType :: forall v.
Var v =&gt;
PrettyPrintEnvDecl -&gt; Width -&gt; Type v Ann -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatSuffixedType"><span class="hs-identifier hs-var hs-var">formatSuffixedType</span></a></span></span><span> </span><span id="local-6989586621679349414"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349414"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Width -&gt; Type v Ann -&gt; SyntaxText
forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Width -&gt; Type v a -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatType"><span class="hs-identifier hs-var">formatType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349414"><span class="hs-identifier hs-var">ppe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span id="local-6989586621679347676"><span class="annot"><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-type">mungeSyntaxText</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-721"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621679347676"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679347676"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UST.Element</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679347676"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Syntax.html#Element"><span class="hs-identifier hs-type">Syntax.Element</span></a></span></span><span>
</span><span id="line-722"></span><span id="mungeSyntaxText"><span class="annot"><span class="annottext">mungeSyntaxText :: forall (g :: * -&gt; *).
Functor g =&gt;
g (Element TypeReference) -&gt; g Element
</span><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-var hs-var">mungeSyntaxText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Element TypeReference -&gt; Element)
-&gt; g (Element TypeReference) -&gt; g Element
forall a b. (a -&gt; b) -&gt; g a -&gt; g b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Element TypeReference -&gt; Element
</span><a href="Unison.Server.Syntax.html#convertElement"><span class="hs-identifier hs-var">Syntax.convertElement</span></a></span><span>
</span><span id="line-723"></span><span>
</span><span id="line-724"></span><span id="local-6989586621679347682"><span class="annot"><a href="Unison.Server.Backend.html#mkTypeDefinition"><span class="hs-identifier hs-type">mkTypeDefinition</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-725"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679347682"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-726"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-727"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-728"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-729"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-730"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Types.html#HashQualifiedName"><span class="hs-identifier hs-type">HashQualifiedName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#UnisonHash"><span class="hs-identifier hs-type">UnisonHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Doc.html#Doc"><span class="hs-identifier hs-type">Doc.Doc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-731"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span>
</span><span id="line-732"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnnotatedText</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UST.Element</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-733"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnnotatedText</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UST.Element</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-734"></span><span>  </span><span class="annot"><a href="#local-6989586621679347682"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TypeDefinition"><span class="hs-identifier hs-type">TypeDefinition</span></a></span></span><span>
</span><span id="line-735"></span><span id="mkTypeDefinition"><span class="annot"><span class="annottext">mkTypeDefinition :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Codebase IO Symbol Ann
-&gt; PrettyPrintEnvDecl
-&gt; Width
-&gt; TypeReference
-&gt; [(Text, Text, Doc)]
-&gt; DisplayObject SyntaxText SyntaxText
-&gt; m TypeDefinition
</span><a href="Unison.Server.Backend.html#mkTypeDefinition"><span class="hs-identifier hs-var hs-var">mkTypeDefinition</span></a></span></span><span> </span><span id="local-6989586621679349436"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349436"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679349437"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349437"><span class="hs-identifier hs-var">pped</span></a></span></span><span> </span><span id="local-6989586621679349438"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349438"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621679349439"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349439"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679349440"><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621679349440"><span class="hs-identifier hs-var">docs</span></a></span></span><span> </span><span id="local-6989586621679349441"><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
</span><a href="#local-6989586621679349441"><span class="hs-identifier hs-var">tp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-736"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349442"><span class="annot"><span class="annottext">bn :: Text
</span><a href="#local-6989586621679349442"><span class="hs-identifier hs-var hs-var">bn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v. Var v =&gt; PrettyPrintEnv -&gt; Width -&gt; TypeReference -&gt; Text
</span><a href="Unison.Server.Backend.html#bestNameForType"><span class="hs-identifier hs-var">bestNameForType</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349437"><span class="hs-identifier hs-var">pped</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349438"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349439"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-737"></span><span>  </span><span id="local-6989586621679349443"><span class="annot"><span class="annottext">TypeTag
</span><a href="#local-6989586621679349443"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-738"></span><span>    </span><span class="annot"><span class="annottext">IO TypeTag -&gt; m TypeTag
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO TypeTag -&gt; m TypeTag) -&gt; IO TypeTag -&gt; m TypeTag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Transaction TypeTag -&gt; IO TypeTag
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349436"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-739"></span><span>      </span><span class="annot"><span class="annottext">TypeEntry -&gt; TypeTag
</span><a href="Unison.Server.Backend.html#%24sel%3AtypeEntryTag%3ATypeEntry"><span class="hs-identifier hs-var">typeEntryTag</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeEntry -&gt; TypeTag)
-&gt; Transaction TypeEntry -&gt; Transaction TypeTag
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; ExactName Name TypeReference -&gt; Transaction TypeEntry
forall v (m :: * -&gt; *).
Var v =&gt;
Codebase m v Ann
-&gt; ExactName Name TypeReference -&gt; Transaction TypeEntry
</span><a href="Unison.Server.Backend.html#typeListEntry"><span class="hs-identifier hs-var">typeListEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349436"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; TypeReference -&gt; ExactName Name TypeReference
forall name ref. name -&gt; ref -&gt; ExactName name ref
</span><a href="Unison.Server.Types.html#ExactName"><span class="hs-identifier hs-var">ExactName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Name
Text -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeParseText</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679349442"><span class="hs-identifier hs-var">bn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349439"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-740"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-741"></span><span>    </span><span class="annot"><span class="annottext">[Text]
-&gt; Text
-&gt; TypeTag
-&gt; DisplayObject SyntaxText SyntaxText
-&gt; [(Text, Text, Doc)]
-&gt; TypeDefinition
</span><a href="Unison.Server.Types.html#TypeDefinition"><span class="hs-identifier hs-var">TypeDefinition</span></a></span><span>
</span><span id="line-742"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
</span><span class="hs-identifier hs-var">HQ'.toText</span></span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; Text) -&gt; [HashQualified Name] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; TypeReference -&gt; [HashQualified Name]
</span><span class="hs-identifier hs-var">PPE.allTypeNames</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349447"><span class="hs-identifier hs-var">fqnPPE</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349439"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>      </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679349442"><span class="hs-identifier hs-var">bn</span></a></span><span>
</span><span id="line-744"></span><span>      </span><span class="annot"><span class="annottext">TypeTag
</span><a href="#local-6989586621679349443"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-745"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SyntaxText -&gt; SyntaxText)
-&gt; (SyntaxText -&gt; SyntaxText)
-&gt; DisplayObject SyntaxText SyntaxText
-&gt; DisplayObject SyntaxText SyntaxText
forall a b c d.
(a -&gt; b) -&gt; (c -&gt; d) -&gt; DisplayObject a c -&gt; DisplayObject b d
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">SyntaxText -&gt; SyntaxText
forall (g :: * -&gt; *).
Functor g =&gt;
g (Element TypeReference) -&gt; g Element
</span><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-var">mungeSyntaxText</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxText -&gt; SyntaxText
forall (g :: * -&gt; *).
Functor g =&gt;
g (Element TypeReference) -&gt; g Element
</span><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-var">mungeSyntaxText</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
</span><a href="#local-6989586621679349441"><span class="hs-identifier hs-var">tp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-746"></span><span>      </span><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621679349440"><span class="hs-identifier hs-var">docs</span></a></span><span>
</span><span id="line-747"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-748"></span><span>    </span><span id="local-6989586621679349447"><span class="annot"><span class="annottext">fqnPPE :: PrettyPrintEnv
</span><a href="#local-6989586621679349447"><span class="hs-identifier hs-var hs-var">fqnPPE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.unsuffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349437"><span class="hs-identifier hs-var">pped</span></a></span><span>
</span><span id="line-749"></span><span>
</span><span id="line-750"></span><span class="annot"><a href="Unison.Server.Backend.html#mkTermDefinition"><span class="hs-identifier hs-type">mkTermDefinition</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-751"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-752"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-753"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-754"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-755"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Types.html#HashQualifiedName"><span class="hs-identifier hs-type">HashQualifiedName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#UnisonHash"><span class="hs-identifier hs-type">UnisonHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Doc.html#Doc"><span class="hs-identifier hs-type">Doc.Doc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-756"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span>
</span><span id="line-757"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnnotatedText</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UST.Element</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-758"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnnotatedText</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UST.Element</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-759"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TermDefinition"><span class="hs-identifier hs-type">TermDefinition</span></a></span><span>
</span><span id="line-760"></span><span id="mkTermDefinition"><span class="annot"><span class="annottext">mkTermDefinition :: Codebase IO Symbol Ann
-&gt; PrettyPrintEnvDecl
-&gt; Width
-&gt; TypeReference
-&gt; [(Text, Text, Doc)]
-&gt; DisplayObject SyntaxText SyntaxText
-&gt; Backend IO TermDefinition
</span><a href="Unison.Server.Backend.html#mkTermDefinition"><span class="hs-identifier hs-var hs-var">mkTermDefinition</span></a></span></span><span> </span><span id="local-6989586621679349450"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349450"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679349451"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349451"><span class="hs-identifier hs-var">termPPED</span></a></span></span><span> </span><span id="local-6989586621679349452"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349452"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621679349453"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349453"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679349454"><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621679349454"><span class="hs-identifier hs-var">docs</span></a></span></span><span> </span><span id="local-6989586621679349455"><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
</span><a href="#local-6989586621679349455"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-761"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349456"><span class="annot"><span class="annottext">referent :: Referent
</span><a href="#local-6989586621679349456"><span class="hs-identifier hs-var hs-var">referent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349453"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-762"></span><span>  </span><span id="local-6989586621679349457"><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679349457"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Type Symbol Ann))
-&gt; Backend IO (Maybe (Type Symbol Ann))
forall a. IO a -&gt; Backend IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Transaction (Maybe (Type Symbol Ann))
-&gt; IO (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349450"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; TypeReference -&gt; Transaction (Maybe (Type Symbol Ann))
forall a (m :: * -&gt; *).
BuiltinAnnotation a =&gt;
Codebase m Symbol a
-&gt; TypeReference -&gt; Transaction (Maybe (Type Symbol a))
</span><span class="hs-identifier hs-var">Codebase.getTypeOfTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349450"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349453"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-763"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349458"><span class="annot"><span class="annottext">bn :: Text
</span><a href="#local-6989586621679349458"><span class="hs-identifier hs-var hs-var">bn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v. Var v =&gt; PrettyPrintEnv -&gt; Width -&gt; Referent -&gt; Text
</span><a href="Unison.Server.Backend.html#bestNameForTerm"><span class="hs-identifier hs-var">bestNameForTerm</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349451"><span class="hs-identifier hs-var">termPPED</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349452"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349453"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-764"></span><span>  </span><span id="local-6989586621679349459"><span class="annot"><span class="annottext">TermTag
</span><a href="#local-6989586621679349459"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO TermTag -&gt; Backend IO TermTag
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; Backend m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermEntry Symbol Ann -&gt; TermTag
forall v a. TermEntry v a -&gt; TermTag
</span><a href="Unison.Server.Backend.html#%24sel%3AtermEntryTag%3ATermEntry"><span class="hs-identifier hs-var">termEntryTag</span></a></span><span> </span><span class="annot"><span class="annottext">(TermEntry Symbol Ann -&gt; TermTag)
-&gt; IO (TermEntry Symbol Ann) -&gt; IO TermTag
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; ExactName Name Referent -&gt; IO (TermEntry Symbol Ann)
forall (m :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann
-&gt; ExactName Name Referent -&gt; m (TermEntry Symbol Ann)
</span><a href="Unison.Server.Backend.html#termListEntry"><span class="hs-identifier hs-var">termListEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349450"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Referent -&gt; ExactName Name Referent
forall name ref. name -&gt; ref -&gt; ExactName name ref
</span><a href="Unison.Server.Types.html#ExactName"><span class="hs-identifier hs-var">ExactName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Name
Text -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeParseText</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679349458"><span class="hs-identifier hs-var">bn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Referent -&gt; Referent
</span><span class="hs-identifier hs-var">Cv.referent1to2</span></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349456"><span class="hs-identifier hs-var">referent</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-765"></span><span>  </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
-&gt; Text -&gt; TermTag -&gt; Backend IO TermDefinition
</span><a href="#local-6989586621679349461"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679349457"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679349458"><span class="hs-identifier hs-var">bn</span></a></span><span> </span><span class="annot"><span class="annottext">TermTag
</span><a href="#local-6989586621679349459"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-766"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-767"></span><span>    </span><span id="local-6989586621679349462"><span class="annot"><span class="annottext">fqnTermPPE :: PrettyPrintEnv
</span><a href="#local-6989586621679349462"><span class="hs-identifier hs-var hs-var">fqnTermPPE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.unsuffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349451"><span class="hs-identifier hs-var">termPPED</span></a></span><span>
</span><span id="line-768"></span><span>    </span><span id="local-6989586621679349461"><span class="annot"><span class="annottext">mk :: Maybe (Type Symbol Ann)
-&gt; Text -&gt; TermTag -&gt; Backend IO TermDefinition
</span><a href="#local-6989586621679349461"><span class="hs-identifier hs-var hs-var">mk</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TermTag
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BackendError -&gt; Backend IO TermDefinition
forall a. BackendError -&gt; Backend IO a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(BackendError -&gt; Backend IO TermDefinition)
-&gt; BackendError -&gt; Backend IO TermDefinition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; BackendError
</span><a href="Unison.Server.Backend.html#MissingSignatureForTerm"><span class="hs-identifier hs-var">MissingSignatureForTerm</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349453"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-769"></span><span>    </span><span class="annot"><a href="#local-6989586621679349461"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679349463"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679349463"><span class="hs-identifier hs-var">typeSig</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679349464"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679349464"><span class="hs-identifier hs-var">bn</span></a></span></span><span> </span><span id="local-6989586621679349465"><span class="annot"><span class="annottext">TermTag
</span><a href="#local-6989586621679349465"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-770"></span><span>      </span><span class="hs-comment">-- We don't ever display individual constructors (they're shown as part of their</span><span>
</span><span id="line-771"></span><span>      </span><span class="hs-comment">-- type), so term references are never constructors.</span><span>
</span><span id="line-772"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349466"><span class="annot"><span class="annottext">referent :: Referent
</span><a href="#local-6989586621679349466"><span class="hs-identifier hs-var hs-var">referent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349453"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-773"></span><span>      </span><span class="annot"><span class="annottext">TermDefinition -&gt; Backend IO TermDefinition
forall a. a -&gt; Backend IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TermDefinition -&gt; Backend IO TermDefinition)
-&gt; TermDefinition -&gt; Backend IO TermDefinition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-774"></span><span>        </span><span class="annot"><span class="annottext">[Text]
-&gt; Text
-&gt; TermTag
-&gt; DisplayObject SyntaxText SyntaxText
-&gt; SyntaxText
-&gt; [(Text, Text, Doc)]
-&gt; TermDefinition
</span><a href="Unison.Server.Types.html#TermDefinition"><span class="hs-identifier hs-var">TermDefinition</span></a></span><span>
</span><span id="line-775"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
</span><span class="hs-identifier hs-var">HQ'.toText</span></span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; Text) -&gt; [HashQualified Name] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Referent -&gt; [HashQualified Name]
</span><span class="hs-identifier hs-var">PPE.allTermNames</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349462"><span class="hs-identifier hs-var">fqnTermPPE</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349466"><span class="hs-identifier hs-var">referent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-776"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679349464"><span class="hs-identifier hs-var">bn</span></a></span><span>
</span><span id="line-777"></span><span>          </span><span class="annot"><span class="annottext">TermTag
</span><a href="#local-6989586621679349465"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-778"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SyntaxText -&gt; SyntaxText)
-&gt; (SyntaxText -&gt; SyntaxText)
-&gt; DisplayObject SyntaxText SyntaxText
-&gt; DisplayObject SyntaxText SyntaxText
forall a b c d.
(a -&gt; b) -&gt; (c -&gt; d) -&gt; DisplayObject a c -&gt; DisplayObject b d
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">SyntaxText -&gt; SyntaxText
forall (g :: * -&gt; *).
Functor g =&gt;
g (Element TypeReference) -&gt; g Element
</span><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-var">mungeSyntaxText</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxText -&gt; SyntaxText
forall (g :: * -&gt; *).
Functor g =&gt;
g (Element TypeReference) -&gt; g Element
</span><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-var">mungeSyntaxText</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
</span><a href="#local-6989586621679349455"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-779"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; Width -&gt; Type Symbol Ann -&gt; SyntaxText
forall v.
Var v =&gt;
PrettyPrintEnvDecl -&gt; Width -&gt; Type v Ann -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatSuffixedType"><span class="hs-identifier hs-var">formatSuffixedType</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349451"><span class="hs-identifier hs-var">termPPED</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349452"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679349463"><span class="hs-identifier hs-var">typeSig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-780"></span><span>          </span><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621679349454"><span class="hs-identifier hs-var">docs</span></a></span><span>
</span><span id="line-781"></span><span>
</span><span id="line-782"></span><span class="annot"><span class="hs-comment">-- | Evaluate the doc at the given reference and return its evaluated-but-not-rendered form.</span></span><span>
</span><span id="line-783"></span><span class="annot"><a href="Unison.Server.Backend.html#evalDocRef"><span class="hs-identifier hs-type">evalDocRef</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-784"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-785"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-786"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-787"></span><span>  </span><span class="hs-comment">-- Evaluation always produces a doc, (it just might have error messages in it).</span><span>
</span><span id="line-788"></span><span>  </span><span class="hs-comment">-- We still return the errors for logging and debugging.</span><span>
</span><span id="line-789"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Doc.html#EvaluatedDoc"><span class="hs-identifier hs-type">Doc.EvaluatedDoc</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Rt.Error</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-790"></span><span id="evalDocRef"><span class="annot"><span class="annottext">evalDocRef :: Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; TypeReference
-&gt; IO (EvaluatedDoc Symbol, [Error])
</span><a href="Unison.Server.Backend.html#evalDocRef"><span class="hs-identifier hs-var hs-var">evalDocRef</span></a></span></span><span> </span><span id="local-6989586621679349469"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679349469"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679349470"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349470"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679349471"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349471"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-791"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349472"><span class="annot"><span class="annottext">tm :: Term2 Symbol () () Symbol ()
</span><a href="#local-6989586621679349472"><span class="hs-identifier hs-var hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TypeReference -&gt; Term2 Symbol () () Symbol ()
forall v a vt at ap.
Ord v =&gt;
a -&gt; TypeReference -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.ref</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349471"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-792"></span><span>  </span><span id="local-6989586621679349474"><span class="annot"><span class="annottext">TVar [Error]
</span><a href="#local-6989586621679349474"><span class="hs-identifier hs-var">errsVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Error] -&gt; IO (TVar [Error])
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (TVar a)
</span><span class="hs-identifier hs-var">UnliftIO.newTVarIO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-793"></span><span>  </span><span id="local-6989586621679349476"><span class="annot"><span class="annottext">EvaluatedDoc Symbol
</span><a href="#local-6989586621679349476"><span class="hs-identifier hs-var">evalResult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TypeReference -&gt; IO (Maybe (Term2 Symbol () () Symbol ())))
-&gt; (Referent -&gt; IO (Maybe (Type Symbol ())))
-&gt; (Term2 Symbol () () Symbol ()
    -&gt; IO (Maybe (Term2 Symbol () () Symbol ())))
-&gt; (TypeReference -&gt; IO (Maybe (Decl Symbol ())))
-&gt; Term2 Symbol () () Symbol ()
-&gt; IO (EvaluatedDoc Symbol)
forall v (m :: * -&gt; *).
(Var v, Monad m) =&gt;
(TypeReference -&gt; m (Maybe (Term v ())))
-&gt; (Referent -&gt; m (Maybe (Type v ())))
-&gt; (Term v () -&gt; m (Maybe (Term v ())))
-&gt; (TypeReference -&gt; m (Maybe (Decl v ())))
-&gt; Term v ()
-&gt; m (EvaluatedDoc v)
</span><a href="Unison.Server.Doc.html#evalDoc"><span class="hs-identifier hs-var">Doc.evalDoc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; IO (Maybe (Term2 Symbol () () Symbol ()))
</span><a href="#local-6989586621679349478"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; IO (Maybe (Type Symbol ()))
</span><a href="#local-6989586621679349479"><span class="hs-identifier hs-var">typeOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TVar [Error]
-&gt; Term2 Symbol () () Symbol ()
-&gt; IO (Maybe (Term2 Symbol () () Symbol ()))
</span><a href="#local-6989586621679349480"><span class="hs-identifier hs-var">eval</span></a></span><span> </span><span class="annot"><span class="annottext">TVar [Error]
</span><a href="#local-6989586621679349474"><span class="hs-identifier hs-var">errsVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; IO (Maybe (Decl Symbol ()))
</span><a href="#local-6989586621679349481"><span class="hs-identifier hs-var">decls</span></a></span><span> </span><span class="annot"><span class="annottext">Term2 Symbol () () Symbol ()
</span><a href="#local-6989586621679349472"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-794"></span><span>  </span><span id="local-6989586621679349482"><span class="annot"><span class="annottext">[Error]
</span><a href="#local-6989586621679349482"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TVar [Error] -&gt; IO [Error]
forall (m :: * -&gt; *) a. MonadIO m =&gt; TVar a -&gt; m a
</span><span class="hs-identifier hs-var">UnliftIO.readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar [Error]
</span><a href="#local-6989586621679349474"><span class="hs-identifier hs-var">errsVar</span></a></span><span>
</span><span id="line-795"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluatedDoc Symbol
</span><a href="#local-6989586621679349476"><span class="hs-identifier hs-var">evalResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Error]
</span><a href="#local-6989586621679349482"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-796"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-797"></span><span>    </span><span id="local-6989586621679349478"><span class="annot"><span class="annottext">terms :: TypeReference -&gt; IO (Maybe (Term2 Symbol () () Symbol ()))
</span><a href="#local-6989586621679349478"><span class="hs-identifier hs-var hs-var">terms</span></a></span></span><span> </span><span id="local-6989586621679349484"><span class="annot"><span class="annottext">r :: TypeReference
</span><a href="#local-6989586621679349484"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.Builtin</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Term2 Symbol () () Symbol ())
-&gt; IO (Maybe (Term2 Symbol () () Symbol ()))
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term2 Symbol () () Symbol ()
-&gt; Maybe (Term2 Symbol () () Symbol ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; TypeReference -&gt; Term2 Symbol () () Symbol ()
forall v a vt at ap.
Ord v =&gt;
a -&gt; TypeReference -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.ref</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349484"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-798"></span><span>    </span><span class="annot"><a href="#local-6989586621679349478"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679349486"><span class="annot"><span class="annottext">Id' Hash
</span><a href="#local-6989586621679349486"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-799"></span><span>      </span><span class="annot"><span class="annottext">(Term Symbol Ann -&gt; Term2 Symbol () () Symbol ())
-&gt; Maybe (Term Symbol Ann) -&gt; Maybe (Term2 Symbol () () Symbol ())
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann -&gt; Term2 Symbol () () Symbol ()
forall vt at ap v a. Ord v =&gt; Term2 vt at ap v a -&gt; Term0' vt v
</span><span class="hs-identifier hs-var">Term.unannotate</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Term Symbol Ann) -&gt; Maybe (Term2 Symbol () () Symbol ()))
-&gt; IO (Maybe (Term Symbol Ann))
-&gt; IO (Maybe (Term2 Symbol () () Symbol ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Transaction (Maybe (Term Symbol Ann))
-&gt; IO (Maybe (Term Symbol Ann))
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349470"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Id' Hash -&gt; Transaction (Maybe (Term Symbol Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id' Hash -&gt; Transaction (Maybe (Term v a))
</span><span class="hs-identifier hs-var">Codebase.getTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349470"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id' Hash
</span><a href="#local-6989586621679349486"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-800"></span><span>
</span><span id="line-801"></span><span>    </span><span id="local-6989586621679349479"><span class="annot"><span class="annottext">typeOf :: Referent -&gt; IO (Maybe (Type Symbol ()))
</span><a href="#local-6989586621679349479"><span class="hs-identifier hs-var hs-var">typeOf</span></a></span></span><span> </span><span id="local-6989586621679349489"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349489"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type Symbol Ann -&gt; Type Symbol ())
-&gt; Maybe (Type Symbol Ann) -&gt; Maybe (Type Symbol ())
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Type Symbol ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Type Symbol Ann) -&gt; Maybe (Type Symbol ()))
-&gt; IO (Maybe (Type Symbol Ann)) -&gt; IO (Maybe (Type Symbol ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Transaction (Maybe (Type Symbol Ann))
-&gt; IO (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349470"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Referent -&gt; Transaction (Maybe (Type Symbol Ann))
forall a (m :: * -&gt; *).
BuiltinAnnotation a =&gt;
Codebase m Symbol a
-&gt; Referent -&gt; Transaction (Maybe (Type Symbol a))
</span><span class="hs-identifier hs-var">Codebase.getTypeOfReferent</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349470"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349489"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-802"></span><span>    </span><span id="local-6989586621679349480"><span class="annot"><span class="annottext">eval :: TVar [Error]
-&gt; Term2 Symbol () () Symbol ()
-&gt; IO (Maybe (Term2 Symbol () () Symbol ()))
</span><a href="#local-6989586621679349480"><span class="hs-identifier hs-var hs-var">eval</span></a></span></span><span> </span><span id="local-6989586621679349492"><span class="annot"><span class="annottext">TVar [Error]
</span><a href="#local-6989586621679349492"><span class="hs-identifier hs-var">errsVar</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() -&gt; Ann) -&gt; Term2 Symbol () () Symbol () -&gt; Term Symbol Ann
forall v a a2. Ord v =&gt; (a -&gt; a2) -&gt; Term v a -&gt; Term v a2
</span><span class="hs-identifier hs-var">Term.amap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann -&gt; () -&gt; Ann
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Ann
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679349495"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679349495"><span class="hs-identifier hs-var">tm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-803"></span><span>      </span><span class="hs-comment">-- We use an empty ppe for evalutation, it's only used for adding additional context to errors.</span><span>
</span><span id="line-804"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349496"><span class="annot"><span class="annottext">evalPPE :: PrettyPrintEnv
</span><a href="#local-6989586621679349496"><span class="hs-identifier hs-var hs-var">evalPPE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPE.empty</span></span><span>
</span><span id="line-805"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349498"><span class="annot"><span class="annottext">codeLookup :: CodeLookup Symbol IO Ann
</span><a href="#local-6989586621679349498"><span class="hs-identifier hs-var hs-var">codeLookup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; CodeLookup Symbol IO Ann
forall (m :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann -&gt; CodeLookup Symbol m Ann
</span><span class="hs-identifier hs-var">Codebase.codebaseToCodeLookup</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349470"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-806"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349500"><span class="annot"><span class="annottext">cache :: Id' Hash -&gt; IO (Maybe (Term2 Symbol () () Symbol ()))
</span><a href="#local-6989586621679349500"><span class="hs-identifier hs-var hs-var">cache</span></a></span></span><span> </span><span id="local-6989586621679349501"><span class="annot"><span class="annottext">Id' Hash
</span><a href="#local-6989586621679349501"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Term Symbol Ann -&gt; Term2 Symbol () () Symbol ())
-&gt; Maybe (Term Symbol Ann) -&gt; Maybe (Term2 Symbol () () Symbol ())
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann -&gt; Term2 Symbol () () Symbol ()
forall vt at ap v a. Ord v =&gt; Term2 vt at ap v a -&gt; Term0' vt v
</span><span class="hs-identifier hs-var">Term.unannotate</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Term Symbol Ann) -&gt; Maybe (Term2 Symbol () () Symbol ()))
-&gt; IO (Maybe (Term Symbol Ann))
-&gt; IO (Maybe (Term2 Symbol () () Symbol ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Transaction (Maybe (Term Symbol Ann))
-&gt; IO (Maybe (Term Symbol Ann))
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349470"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Id' Hash -&gt; Transaction (Maybe (Term Symbol Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id' Hash -&gt; Transaction (Maybe (Term v a))
</span><span class="hs-identifier hs-var">Codebase.lookupWatchCache</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349470"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id' Hash
</span><a href="#local-6989586621679349501"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-807"></span><span>      </span><span id="local-6989586621679349503"><span class="annot"><span class="annottext">Maybe ([Error], Term2 Symbol () () Symbol ())
</span><a href="#local-6989586621679349503"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Either Error ([Error], Term2 Symbol () () Symbol ())
 -&gt; Maybe ([Error], Term2 Symbol () () Symbol ()))
-&gt; IO (Either Error ([Error], Term2 Symbol () () Symbol ()))
-&gt; IO (Maybe ([Error], Term2 Symbol () () Symbol ()))
forall a b. (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Either Error ([Error], Term2 Symbol () () Symbol ())
-&gt; Maybe ([Error], Term2 Symbol () () Symbol ())
forall a b. Either a b -&gt; Maybe b
</span><span class="hs-identifier hs-var">hush</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either Error ([Error], Term2 Symbol () () Symbol ()))
 -&gt; IO (Maybe ([Error], Term2 Symbol () () Symbol ())))
-&gt; (IO (Either Error ([Error], Term2 Symbol () () Symbol ()))
    -&gt; IO (Either Error ([Error], Term2 Symbol () () Symbol ())))
-&gt; IO (Either Error ([Error], Term2 Symbol () () Symbol ()))
-&gt; IO (Maybe ([Error], Term2 Symbol () () Symbol ()))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO (Either Error ([Error], Term2 Symbol () () Symbol ()))
-&gt; IO (Either Error ([Error], Term2 Symbol () () Symbol ()))
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either Error ([Error], Term2 Symbol () () Symbol ()))
 -&gt; IO (Maybe ([Error], Term2 Symbol () () Symbol ())))
-&gt; IO (Either Error ([Error], Term2 Symbol () () Symbol ()))
-&gt; IO (Maybe ([Error], Term2 Symbol () () Symbol ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CodeLookup Symbol IO Ann
-&gt; (Id' Hash -&gt; IO (Maybe (Term2 Symbol () () Symbol ())))
-&gt; PrettyPrintEnv
-&gt; Runtime Symbol
-&gt; Term Symbol Ann
-&gt; IO (Either Error ([Error], Term2 Symbol () () Symbol ()))
forall v a.
(Var v, Monoid a) =&gt;
CodeLookup v IO a
-&gt; (Id' Hash -&gt; IO (Maybe (Term v)))
-&gt; PrettyPrintEnv
-&gt; Runtime v
-&gt; Term v a
-&gt; IO (Either Error ([Error], Term v))
</span><span class="hs-identifier hs-var">Rt.evaluateTerm'</span></span><span> </span><span class="annot"><span class="annottext">CodeLookup Symbol IO Ann
</span><a href="#local-6989586621679349498"><span class="hs-identifier hs-var">codeLookup</span></a></span><span> </span><span class="annot"><span class="annottext">Id' Hash -&gt; IO (Maybe (Term2 Symbol () () Symbol ()))
</span><a href="#local-6989586621679349500"><span class="hs-identifier hs-var">cache</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349496"><span class="hs-identifier hs-var">evalPPE</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679349469"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679349495"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-808"></span><span>      </span><span class="hs-comment">-- Only cache watches when we're not in readonly mode</span><span>
</span><span id="line-809"></span><span>      </span><span class="annot"><span class="annottext">WatchKind -&gt; IO (Maybe WatchKind)
forall (m :: * -&gt; *). MonadIO m =&gt; WatchKind -&gt; m (Maybe WatchKind)
</span><span class="hs-identifier hs-var">Env.lookupEnv</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><span class="hs-string">&quot;UNISON_READONLY&quot;</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe WatchKind) -&gt; (Maybe WatchKind -&gt; IO ()) -&gt; IO ()
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-810"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-811"></span><span>        </span><span class="annot"><span class="annottext">Maybe WatchKind
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-812"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ([Error], Term2 Symbol () () Symbol ())
</span><a href="#local-6989586621679349503"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-813"></span><span>            </span><span class="hs-comment">-- don't cache when there were decompile errors</span><span>
</span><span id="line-814"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679349506"><span class="annot"><span class="annottext">[Error]
</span><a href="#local-6989586621679349506"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349507"><span class="annot"><span class="annottext">Term2 Symbol () () Symbol ()
</span><a href="#local-6989586621679349507"><span class="hs-identifier hs-var">tmr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-815"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Error] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Error]
</span><a href="#local-6989586621679349506"><span class="hs-identifier hs-var">errs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-816"></span><span>                  </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Transaction () -&gt; IO ()
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349470"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-817"></span><span>                    </span><span class="annot"><span class="annottext">WatchKind -&gt; Id' Hash -&gt; Term Symbol Ann -&gt; Transaction ()
</span><span class="hs-identifier hs-var">Codebase.putWatch</span></span><span>
</span><span id="line-818"></span><span>                      </span><span class="annot"><span class="annottext">WatchKind
forall a. (Eq a, IsString a) =&gt; a
</span><span class="hs-identifier hs-var">WK.RegularWatch</span></span><span>
</span><span id="line-819"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term Symbol Ann -&gt; Id' Hash
forall v a. Var v =&gt; Term v a -&gt; Id' Hash
</span><span class="hs-identifier hs-var">Hashing.hashClosedTerm</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679349495"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-820"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() -&gt; Ann) -&gt; Term2 Symbol () () Symbol () -&gt; Term Symbol Ann
forall v a a2. Ord v =&gt; (a -&gt; a2) -&gt; Term v a -&gt; Term v a2
</span><span class="hs-identifier hs-var">Term.amap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann -&gt; () -&gt; Ann
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Ann
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term2 Symbol () () Symbol ()
</span><a href="#local-6989586621679349507"><span class="hs-identifier hs-var">tmr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-821"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-822"></span><span>                  </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; STM a -&gt; m a
</span><span class="hs-identifier hs-var">UnliftIO.atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-823"></span><span>                    </span><span class="annot"><span class="annottext">TVar [Error] -&gt; ([Error] -&gt; [Error]) -&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><span class="hs-identifier hs-var">UnliftIO.modifyTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar [Error]
</span><a href="#local-6989586621679349492"><span class="hs-identifier hs-var">errsVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Error]
</span><a href="#local-6989586621679349506"><span class="hs-identifier hs-var">errs</span></a></span><span> </span><span class="annot"><span class="annottext">[Error] -&gt; [Error] -&gt; [Error]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span>
</span><span id="line-824"></span><span>                    </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-825"></span><span>            </span><span class="annot"><span class="annottext">Maybe ([Error], Term2 Symbol () () Symbol ())
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-826"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Maybe ([Error], Term2 Symbol () () Symbol ())
</span><a href="#local-6989586621679349503"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ([Error], Term2 Symbol () () Symbol ())
-&gt; (([Error], Term2 Symbol () () Symbol ())
    -&gt; Term2 Symbol () () Symbol ())
-&gt; Maybe (Term2 Symbol () () Symbol ())
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(() -&gt; ())
-&gt; Term2 Symbol () () Symbol () -&gt; Term2 Symbol () () Symbol ()
forall v a a2. Ord v =&gt; (a -&gt; a2) -&gt; Term v a -&gt; Term v a2
</span><span class="hs-identifier hs-var">Term.amap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">()
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Term2 Symbol () () Symbol () -&gt; Term2 Symbol () () Symbol ())
-&gt; (([Error], Term2 Symbol () () Symbol ())
    -&gt; Term2 Symbol () () Symbol ())
-&gt; ([Error], Term2 Symbol () () Symbol ())
-&gt; Term2 Symbol () () Symbol ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([Error], Term2 Symbol () () Symbol ())
-&gt; Term2 Symbol () () Symbol ()
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span>
</span><span id="line-827"></span><span>
</span><span id="line-828"></span><span>    </span><span id="local-6989586621679349481"><span class="annot"><span class="annottext">decls :: TypeReference -&gt; IO (Maybe (Decl Symbol ()))
</span><a href="#local-6989586621679349481"><span class="hs-identifier hs-var hs-var">decls</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679349513"><span class="annot"><span class="annottext">Id' Hash
</span><a href="#local-6989586621679349513"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-829"></span><span>      </span><span class="annot"><span class="annottext">(Decl Symbol Ann -&gt; Decl Symbol ())
-&gt; Maybe (Decl Symbol Ann) -&gt; Maybe (Decl Symbol ())
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ann -&gt; ()) -&gt; Decl Symbol Ann -&gt; Decl Symbol ()
forall a a2 v. (a -&gt; a2) -&gt; Decl v a -&gt; Decl v a2
</span><span class="hs-identifier hs-var">DD.amap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; Ann -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Decl Symbol Ann) -&gt; Maybe (Decl Symbol ()))
-&gt; IO (Maybe (Decl Symbol Ann)) -&gt; IO (Maybe (Decl Symbol ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Transaction (Maybe (Decl Symbol Ann))
-&gt; IO (Maybe (Decl Symbol Ann))
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349470"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Id' Hash -&gt; Transaction (Maybe (Decl Symbol Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id' Hash -&gt; Transaction (Maybe (Decl v a))
</span><span class="hs-identifier hs-var">Codebase.getTypeDeclaration</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349470"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id' Hash
</span><a href="#local-6989586621679349513"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-830"></span><span>    </span><span class="annot"><a href="#local-6989586621679349481"><span class="hs-identifier hs-var">decls</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Decl Symbol ()) -&gt; IO (Maybe (Decl Symbol ()))
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Decl Symbol ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-831"></span><span>
</span><span id="line-832"></span><span class="hs-comment">-- | Fetch the docs associated with the given name.</span><span>
</span><span id="line-833"></span><span class="hs-comment">-- Returns all references with a Doc type which are at the name provided, or at '&lt;name&gt;.doc'.</span><span>
</span><span id="line-834"></span><span class="annot"><a href="Unison.Server.Backend.html#docsForDefinitionName"><span class="hs-identifier hs-type">docsForDefinitionName</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-835"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-836"></span><span>  </span><span class="annot"><a href="Unison.Server.NameSearch.html#NameSearch"><span class="hs-identifier hs-type">NameSearch</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-837"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Names.SearchType</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-838"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-839"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span class="hs-special">]</span><span>
</span><span id="line-840"></span><span id="docsForDefinitionName"><span class="annot"><span class="annottext">docsForDefinitionName :: Codebase IO Symbol Ann
-&gt; NameSearch Transaction
-&gt; SearchType
-&gt; Name
-&gt; Transaction [TypeReference]
</span><a href="Unison.Server.Backend.html#docsForDefinitionName"><span class="hs-identifier hs-var hs-var">docsForDefinitionName</span></a></span></span><span> </span><span id="local-6989586621679349515"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349515"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.NameSearch.html#NameSearch"><span class="hs-identifier hs-type">NameSearch</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679349516"><span class="annot"><span class="annottext">Search Transaction Referent
$sel:termSearch:NameSearch :: forall (m :: * -&gt; *). NameSearch m -&gt; Search m Referent
termSearch :: Search Transaction Referent
</span><a href="Unison.Server.NameSearch.html#%24sel%3AtermSearch%3ANameSearch"><span class="hs-identifier hs-var hs-var">termSearch</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679349517"><span class="annot"><span class="annottext">SearchType
</span><a href="#local-6989586621679349517"><span class="hs-identifier hs-var">searchType</span></a></span></span><span> </span><span id="local-6989586621679349518"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349518"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-841"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349519"><span class="annot"><span class="annottext">potentialDocNames :: [Name]
</span><a href="#local-6989586621679349519"><span class="hs-identifier hs-var hs-var">potentialDocNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349518"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349518"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NameSegment -&gt; Name
forall a b. Snoc a a b b =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">Cons.:&gt;</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-identifier hs-var">NameSegment.docSegment</span></span><span class="hs-special">]</span><span>
</span><span id="line-842"></span><span>  </span><span id="local-6989586621679349521"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679349521"><span class="hs-identifier hs-var">refs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-843"></span><span>    </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679349519"><span class="hs-identifier hs-var">potentialDocNames</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
-&gt; ([Name] -&gt; Transaction (Set Referent))
-&gt; Transaction (Set Referent)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Transaction (Set Referent))
-&gt; [Name] -&gt; Transaction (Set Referent)
forall (m :: * -&gt; *) (f :: * -&gt; *) b a.
(Monad m, Foldable f, Monoid b) =&gt;
(a -&gt; m b) -&gt; f a -&gt; m b
</span><span class="hs-identifier hs-var">foldMapM</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679349522"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349522"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-844"></span><span>      </span><span class="annot"><span class="annottext">Search Transaction Referent
-&gt; SearchType -&gt; HashQualified Name -&gt; Transaction (Set Referent)
forall (m :: * -&gt; *) r.
Search m r -&gt; SearchType -&gt; HashQualified Name -&gt; m (Set r)
</span><a href="Unison.Server.NameSearch.html#%24sel%3AlookupRelativeHQRefs%27%3ASearch"><span class="hs-identifier hs-var">lookupRelativeHQRefs'</span></a></span><span> </span><span class="annot"><span class="annottext">Search Transaction Referent
</span><a href="#local-6989586621679349516"><span class="hs-identifier hs-var">termSearch</span></a></span><span> </span><span class="annot"><span class="annottext">SearchType
</span><a href="#local-6989586621679349517"><span class="hs-identifier hs-var">searchType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; HashQualified Name
forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.NameOnly</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349522"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-845"></span><span>  </span><span class="annot"><span class="annottext">[Referent] -&gt; Transaction [TypeReference]
</span><a href="#local-6989586621679349524"><span class="hs-identifier hs-var">filterForDocs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Referent -&gt; [Referent]
forall a. Set a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679349521"><span class="hs-identifier hs-var">refs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-846"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-847"></span><span>    </span><span class="annot"><a href="#local-6989586621679349524"><span class="hs-identifier hs-type">filterForDocs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span class="hs-special">]</span><span>
</span><span id="line-848"></span><span>    </span><span id="local-6989586621679349524"><span class="annot"><span class="annottext">filterForDocs :: [Referent] -&gt; Transaction [TypeReference]
</span><a href="#local-6989586621679349524"><span class="hs-identifier hs-var hs-var">filterForDocs</span></a></span></span><span> </span><span id="local-6989586621679349525"><span class="annot"><span class="annottext">[Referent]
</span><a href="#local-6989586621679349525"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-849"></span><span>      </span><span id="local-6989586621679349526"><span class="annot"><span class="annottext">[(TypeReference, Type Symbol Ann)]
</span><a href="#local-6989586621679349526"><span class="hs-identifier hs-var">rts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([[(TypeReference, Type Symbol Ann)]]
 -&gt; [(TypeReference, Type Symbol Ann)])
-&gt; Transaction [[(TypeReference, Type Symbol Ann)]]
-&gt; Transaction [(TypeReference, Type Symbol Ann)]
forall a b. (a -&gt; b) -&gt; Transaction a -&gt; Transaction b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[[(TypeReference, Type Symbol Ann)]]
-&gt; [(TypeReference, Type Symbol Ann)]
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">(Transaction [[(TypeReference, Type Symbol Ann)]]
 -&gt; Transaction [(TypeReference, Type Symbol Ann)])
-&gt; ((Referent -&gt; Transaction [(TypeReference, Type Symbol Ann)])
    -&gt; Transaction [[(TypeReference, Type Symbol Ann)]])
-&gt; (Referent -&gt; Transaction [(TypeReference, Type Symbol Ann)])
-&gt; Transaction [(TypeReference, Type Symbol Ann)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Referent]
-&gt; (Referent -&gt; Transaction [(TypeReference, Type Symbol Ann)])
-&gt; Transaction [[(TypeReference, Type Symbol Ann)]]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">[Referent]
</span><a href="#local-6989586621679349525"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">((Referent -&gt; Transaction [(TypeReference, Type Symbol Ann)])
 -&gt; Transaction [(TypeReference, Type Symbol Ann)])
-&gt; (Referent -&gt; Transaction [(TypeReference, Type Symbol Ann)])
-&gt; Transaction [(TypeReference, Type Symbol Ann)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-850"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span id="local-6989586621679349527"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349527"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-851"></span><span>          </span><span class="annot"><span class="annottext">[(TypeReference, Type Symbol Ann)]
-&gt; (Type Symbol Ann -&gt; [(TypeReference, Type Symbol Ann)])
-&gt; Maybe (Type Symbol Ann)
-&gt; [(TypeReference, Type Symbol Ann)]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeReference, Type Symbol Ann)
-&gt; [(TypeReference, Type Symbol Ann)]
forall a. a -&gt; [a]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((TypeReference, Type Symbol Ann)
 -&gt; [(TypeReference, Type Symbol Ann)])
-&gt; (Type Symbol Ann -&gt; (TypeReference, Type Symbol Ann))
-&gt; Type Symbol Ann
-&gt; [(TypeReference, Type Symbol Ann)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349527"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Type Symbol Ann) -&gt; [(TypeReference, Type Symbol Ann)])
-&gt; Transaction (Maybe (Type Symbol Ann))
-&gt; Transaction [(TypeReference, Type Symbol Ann)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; TypeReference -&gt; Transaction (Maybe (Type Symbol Ann))
forall a (m :: * -&gt; *).
BuiltinAnnotation a =&gt;
Codebase m Symbol a
-&gt; TypeReference -&gt; Transaction (Maybe (Type Symbol a))
</span><span class="hs-identifier hs-var">Codebase.getTypeOfTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349515"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349527"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-852"></span><span>        </span><span class="annot"><span class="annottext">Referent
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(TypeReference, Type Symbol Ann)]
-&gt; Transaction [(TypeReference, Type Symbol Ann)]
forall a. a -&gt; Transaction a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-853"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349529"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679349529"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349529"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349530"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679349530"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(TypeReference, Type Symbol Ann)]
</span><a href="#local-6989586621679349526"><span class="hs-identifier hs-var">rts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann) -&gt; Bool
forall v loc. (Var v, Monoid loc) =&gt; Maybe (Type v loc) -&gt; Bool
</span><a href="Unison.Server.Backend.html#isDoc%27"><span class="hs-identifier hs-var">isDoc'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Maybe (Type Symbol Ann)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679349530"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-854"></span><span>
</span><span id="line-855"></span><span class="annot"><span class="hs-comment">-- | Evaluate and render the given docs</span></span><span>
</span><span id="line-856"></span><span id="local-6989586621679347755"><span class="annot"><a href="Unison.Server.Backend.html#renderDocRefs"><span class="hs-identifier hs-type">renderDocRefs</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-857"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Traversable</span></span><span> </span><span class="annot"><a href="#local-6989586621679347755"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-858"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-859"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-860"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-861"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-862"></span><span>  </span><span class="annot"><a href="#local-6989586621679347755"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-863"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679347755"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Types.html#HashQualifiedName"><span class="hs-identifier hs-type">HashQualifiedName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#UnisonHash"><span class="hs-identifier hs-type">UnisonHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Doc.html#Doc"><span class="hs-identifier hs-type">Doc.Doc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Rt.Error</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-864"></span><span id="renderDocRefs"><span class="annot"><span class="annottext">renderDocRefs :: forall (t :: * -&gt; *).
Traversable t =&gt;
PrettyPrintEnvDecl
-&gt; Width
-&gt; Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; t TypeReference
-&gt; IO (t (Text, Text, Doc, [Error]))
</span><a href="Unison.Server.Backend.html#renderDocRefs"><span class="hs-identifier hs-var hs-var">renderDocRefs</span></a></span></span><span> </span><span id="local-6989586621679349541"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349541"><span class="hs-identifier hs-var">pped</span></a></span></span><span> </span><span id="local-6989586621679349542"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349542"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621679349543"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349543"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679349544"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679349544"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679349545"><span class="annot"><span class="annottext">t TypeReference
</span><a href="#local-6989586621679349545"><span class="hs-identifier hs-var">docRefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-865"></span><span>  </span><span id="local-6989586621679349546"><span class="annot"><span class="annottext">t (TypeReference, (EvaluatedDoc Symbol, [Error]))
</span><a href="#local-6989586621679349546"><span class="hs-identifier hs-var">eDocs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">t TypeReference
-&gt; (TypeReference
    -&gt; IO (TypeReference, (EvaluatedDoc Symbol, [Error])))
-&gt; IO (t (TypeReference, (EvaluatedDoc Symbol, [Error])))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">t TypeReference
</span><a href="#local-6989586621679349545"><span class="hs-identifier hs-var">docRefs</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679349547"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349547"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349547"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((EvaluatedDoc Symbol, [Error])
 -&gt; (TypeReference, (EvaluatedDoc Symbol, [Error])))
-&gt; IO (EvaluatedDoc Symbol, [Error])
-&gt; IO (TypeReference, (EvaluatedDoc Symbol, [Error]))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; TypeReference
-&gt; IO (EvaluatedDoc Symbol, [Error])
</span><a href="Unison.Server.Backend.html#evalDocRef"><span class="hs-identifier hs-var">evalDocRef</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679349544"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349543"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349547"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-866"></span><span>  </span><span class="annot"><span class="annottext">t (TypeReference, (EvaluatedDoc Symbol, [Error]))
-&gt; ((TypeReference, (EvaluatedDoc Symbol, [Error]))
    -&gt; IO (Text, Text, Doc, [Error]))
-&gt; IO (t (Text, Text, Doc, [Error]))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">t (TypeReference, (EvaluatedDoc Symbol, [Error]))
</span><a href="#local-6989586621679349546"><span class="hs-identifier hs-var">eDocs</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679349548"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349548"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679349549"><span class="annot"><span class="annottext">EvaluatedDoc Symbol
</span><a href="#local-6989586621679349549"><span class="hs-identifier hs-var">eDoc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349550"><span class="annot"><span class="annottext">[Error]
</span><a href="#local-6989586621679349550"><span class="hs-identifier hs-var">docEvalErrs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-867"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349551"><span class="annot"><span class="annottext">name :: Text
</span><a href="#local-6989586621679349551"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v. Var v =&gt; PrettyPrintEnv -&gt; Width -&gt; Referent -&gt; Text
</span><a href="Unison.Server.Backend.html#bestNameForTerm"><span class="hs-identifier hs-var">bestNameForTerm</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349541"><span class="hs-identifier hs-var">pped</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349542"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349548"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-868"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349552"><span class="annot"><span class="annottext">hash :: Text
</span><a href="#local-6989586621679349552"><span class="hs-identifier hs-var hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349548"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-869"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349554"><span class="annot"><span class="annottext">renderedDoc :: Doc
</span><a href="#local-6989586621679349554"><span class="hs-identifier hs-var hs-var">renderedDoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; EvaluatedDoc Symbol -&gt; Doc
forall v. Var v =&gt; PrettyPrintEnvDecl -&gt; EvaluatedDoc v -&gt; Doc
</span><a href="Unison.Server.Doc.html#renderDoc"><span class="hs-identifier hs-var">Doc.renderDoc</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349541"><span class="hs-identifier hs-var">pped</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluatedDoc Symbol
</span><a href="#local-6989586621679349549"><span class="hs-identifier hs-var">eDoc</span></a></span><span>
</span><span id="line-870"></span><span>    </span><span class="annot"><span class="annottext">(Text, Text, Doc, [Error]) -&gt; IO (Text, Text, Doc, [Error])
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679349551"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679349552"><span class="hs-identifier hs-var">hash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621679349554"><span class="hs-identifier hs-var">renderedDoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Error]
</span><a href="#local-6989586621679349550"><span class="hs-identifier hs-var">docEvalErrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-871"></span><span>
</span><span id="line-872"></span><span class="annot"><a href="Unison.Server.Backend.html#docsInBranchToHtmlFiles"><span class="hs-identifier hs-type">docsInBranchToHtmlFiles</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-873"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-874"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-875"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-876"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-877"></span><span>  </span><span class="hs-comment">-- Returns any doc evaluation errors which may have occurred.</span><span>
</span><span id="line-878"></span><span>  </span><span class="hs-comment">-- Note that all docs will still be rendered even if there are errors.</span><span>
</span><span id="line-879"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Rt.Error</span></span><span class="hs-special">]</span><span>
</span><span id="line-880"></span><span id="docsInBranchToHtmlFiles"><span class="annot"><span class="annottext">docsInBranchToHtmlFiles :: Runtime Symbol
-&gt; Codebase IO Symbol Ann -&gt; Branch IO -&gt; WatchKind -&gt; IO [Error]
</span><a href="Unison.Server.Backend.html#docsInBranchToHtmlFiles"><span class="hs-identifier hs-var hs-var">docsInBranchToHtmlFiles</span></a></span></span><span> </span><span id="local-6989586621679349557"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679349557"><span class="hs-identifier hs-var">runtime</span></a></span></span><span> </span><span id="local-6989586621679349558"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349558"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679349559"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679349559"><span class="hs-identifier hs-var">currentBranch</span></a></span></span><span> </span><span id="local-6989586621679349560"><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679349560"><span class="hs-identifier hs-var">directory</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-881"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349561"><span class="annot"><span class="annottext">allTerms :: [(Referent, Name)]
</span><a href="#local-6989586621679349561"><span class="hs-identifier hs-var hs-var">allTerms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Relation Referent Name -&gt; [(Referent, Name)]
forall a b. Relation a b -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">R.toList</span></span><span> </span><span class="annot"><span class="annottext">(Relation Referent Name -&gt; [(Referent, Name)])
-&gt; (Branch IO -&gt; Relation Referent Name)
-&gt; Branch IO
-&gt; [(Referent, Name)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Relation Referent Name
forall (m :: * -&gt; *). Branch0 m -&gt; Relation Referent Name
</span><span class="hs-identifier hs-var">Branch.deepTerms</span></span><span> </span><span class="annot"><span class="annottext">(Branch0 IO -&gt; Relation Referent Name)
-&gt; (Branch IO -&gt; Branch0 IO) -&gt; Branch IO -&gt; Relation Referent Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679349559"><span class="hs-identifier hs-var">currentBranch</span></a></span><span>
</span><span id="line-882"></span><span>  </span><span class="hs-comment">-- ignores docs inside lib namespace, recursively</span><span>
</span><span id="line-883"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349567"><span class="annot"><span class="annottext">notLib :: (a, Name) -&gt; Bool
</span><a href="#local-6989586621679349567"><span class="hs-identifier hs-var hs-var">notLib</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349568"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349568"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-identifier hs-var">NameSegment.libSegment</span></span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; NonEmpty NameSegment -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`notElem`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NonEmpty NameSegment
</span><span class="hs-identifier hs-var">Name.segments</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349568"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-884"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679349571"><span class="annot"><span class="annottext">[(Referent, Name)]
</span><a href="#local-6989586621679349571"><span class="hs-identifier hs-var">docTermsWithNames</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349572"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679349572"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-885"></span><span>    </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Transaction ([(Referent, Name)], Int)
-&gt; IO ([(Referent, Name)], Int)
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349558"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-886"></span><span>      </span><span id="local-6989586621679349573"><span class="annot"><span class="annottext">[(Referent, Name)]
</span><a href="#local-6989586621679349573"><span class="hs-identifier hs-var">docTermsWithNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Referent, Name) -&gt; Transaction Bool)
-&gt; [(Referent, Name)] -&gt; Transaction [(Referent, Name)]
forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m Bool) -&gt; [a] -&gt; m [a]
</span><span class="hs-identifier hs-var">filterM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Referent -&gt; Transaction Bool
forall (m :: * -&gt; *).
Codebase m Symbol Ann -&gt; Referent -&gt; Transaction Bool
</span><a href="Unison.Server.Backend.html#isDoc"><span class="hs-identifier hs-var">isDoc</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349558"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; Transaction Bool)
-&gt; ((Referent, Name) -&gt; Referent)
-&gt; (Referent, Name)
-&gt; Transaction Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Referent, Name) -&gt; Referent
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Referent, Name) -&gt; Bool)
-&gt; [(Referent, Name)] -&gt; [(Referent, Name)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">(Referent, Name) -&gt; Bool
forall {a}. (a, Name) -&gt; Bool
</span><a href="#local-6989586621679349567"><span class="hs-identifier hs-var">notLib</span></a></span><span> </span><span class="annot"><span class="annottext">[(Referent, Name)]
</span><a href="#local-6989586621679349561"><span class="hs-identifier hs-var">allTerms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-887"></span><span>      </span><span id="local-6989586621679349576"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679349576"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Transaction Int
</span><span class="hs-identifier hs-var">Codebase.hashLength</span></span><span>
</span><span id="line-888"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Referent, Name)]
</span><a href="#local-6989586621679349573"><span class="hs-identifier hs-var">docTermsWithNames</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679349576"><span class="hs-identifier hs-var">hqLength</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-889"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349577"><span class="annot"><span class="annottext">docNamesByRef :: Map Referent Name
</span><a href="#local-6989586621679349577"><span class="hs-identifier hs-var hs-var">docNamesByRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Referent, Name)] -&gt; Map Referent Name
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(Referent, Name)]
</span><a href="#local-6989586621679349571"><span class="hs-identifier hs-var">docTermsWithNames</span></a></span><span>
</span><span id="line-890"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349579"><span class="annot"><span class="annottext">pped :: PrettyPrintEnvDecl
</span><a href="#local-6989586621679349579"><span class="hs-identifier hs-var hs-var">pped</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Branch0 IO -&gt; PrettyPrintEnvDecl
forall (m :: * -&gt; *). Int -&gt; Branch0 m -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">Branch.toPrettyPrintEnvDecl</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679349572"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679349559"><span class="hs-identifier hs-var">currentBranch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-891"></span><span>  </span><span id="local-6989586621679349581"><span class="annot"><span class="annottext">[(Name, Text, Doc, [Error])]
</span><a href="#local-6989586621679349581"><span class="hs-identifier hs-var">docs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Referent, Name)]
-&gt; ((Referent, Name) -&gt; IO (Name, Text, Doc, [Error]))
-&gt; IO [(Name, Text, Doc, [Error])]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">[(Referent, Name)]
</span><a href="#local-6989586621679349571"><span class="hs-identifier hs-var">docTermsWithNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; (Referent, Name)
-&gt; IO (Name, Text, Doc, [Error])
forall {a}.
PrettyPrintEnvDecl
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; (Referent, a)
-&gt; IO (a, Text, Doc, [Error])
</span><a href="#local-6989586621679349582"><span class="hs-identifier hs-var">renderDoc'</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349579"><span class="hs-identifier hs-var">pped</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679349557"><span class="hs-identifier hs-var">runtime</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349558"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-892"></span><span>  </span><span class="annot"><span class="annottext">IO [Error] -&gt; IO [Error]
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [Error] -&gt; IO [Error]) -&gt; IO [Error] -&gt; IO [Error]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-893"></span><span>    </span><span class="annot"><span class="annottext">[(Name, Text, Doc, [Error])]
</span><a href="#local-6989586621679349581"><span class="hs-identifier hs-var">docs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Text, Doc, [Error])]
-&gt; ([(Name, Text, Doc, [Error])] -&gt; IO [Error]) -&gt; IO [Error]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">((Name, Text, Doc, [Error]) -&gt; IO [Error])
-&gt; [(Name, Text, Doc, [Error])] -&gt; IO [Error]
forall (m :: * -&gt; *) (f :: * -&gt; *) b a.
(Monad m, Foldable f, Monoid b) =&gt;
(a -&gt; m b) -&gt; f a -&gt; m b
</span><span class="hs-identifier hs-var">foldMapM</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679349583"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349583"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349584"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679349584"><span class="hs-identifier hs-var">text</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349585"><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621679349585"><span class="hs-identifier hs-var">doc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349586"><span class="annot"><span class="annottext">[Error]
</span><a href="#local-6989586621679349586"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-894"></span><span>      </span><span class="annot"><span class="annottext">Map Referent Name -&gt; WatchKind -&gt; (Name, Text, Doc) -&gt; IO ()
</span><a href="#local-6989586621679349587"><span class="hs-identifier hs-var">renderDocToHtmlFile</span></a></span><span> </span><span class="annot"><span class="annottext">Map Referent Name
</span><a href="#local-6989586621679349577"><span class="hs-identifier hs-var">docNamesByRef</span></a></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679349560"><span class="hs-identifier hs-var">directory</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349583"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679349584"><span class="hs-identifier hs-var">text</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621679349585"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-895"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">[Error]
</span><a href="#local-6989586621679349586"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-896"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-897"></span><span>    </span><span id="local-6989586621679349582"><span class="annot"><span class="annottext">renderDoc' :: PrettyPrintEnvDecl
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; (Referent, a)
-&gt; IO (a, Text, Doc, [Error])
</span><a href="#local-6989586621679349582"><span class="hs-identifier hs-var hs-var">renderDoc'</span></a></span></span><span> </span><span id="local-6989586621679349594"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349594"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679349595"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679349595"><span class="hs-identifier hs-var">runtime</span></a></span></span><span> </span><span id="local-6989586621679349596"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349596"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679349597"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349597"><span class="hs-identifier hs-var">docReferent</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349598"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679349598"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-898"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349599"><span class="annot"><span class="annottext">docReference :: TypeReference
</span><a href="#local-6989586621679349599"><span class="hs-identifier hs-var hs-var">docReference</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Referent -&gt; TypeReference
</span><span class="hs-identifier hs-var">Referent.toReference</span></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349597"><span class="hs-identifier hs-var">docReferent</span></a></span><span>
</span><span id="line-899"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679349601"><span class="annot"><span class="annottext">EvaluatedDoc Symbol
</span><a href="#local-6989586621679349601"><span class="hs-identifier hs-var">eDoc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349602"><span class="annot"><span class="annottext">[Error]
</span><a href="#local-6989586621679349602"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; TypeReference
-&gt; IO (EvaluatedDoc Symbol, [Error])
</span><a href="Unison.Server.Backend.html#evalDocRef"><span class="hs-identifier hs-var">evalDocRef</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679349595"><span class="hs-identifier hs-var">runtime</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679349596"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349599"><span class="hs-identifier hs-var">docReference</span></a></span><span>
</span><span id="line-900"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349603"><span class="annot"><span class="annottext">renderedDoc :: Doc
</span><a href="#local-6989586621679349603"><span class="hs-identifier hs-var hs-var">renderedDoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; EvaluatedDoc Symbol -&gt; Doc
forall v. Var v =&gt; PrettyPrintEnvDecl -&gt; EvaluatedDoc v -&gt; Doc
</span><a href="Unison.Server.Doc.html#renderDoc"><span class="hs-identifier hs-var">Doc.renderDoc</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349594"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluatedDoc Symbol
</span><a href="#local-6989586621679349601"><span class="hs-identifier hs-var">eDoc</span></a></span><span>
</span><span id="line-901"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349604"><span class="annot"><span class="annottext">hash :: Text
</span><a href="#local-6989586621679349604"><span class="hs-identifier hs-var hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349599"><span class="hs-identifier hs-var">docReference</span></a></span><span>
</span><span id="line-902"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679349598"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679349604"><span class="hs-identifier hs-var">hash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621679349603"><span class="hs-identifier hs-var">renderedDoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Error]
</span><a href="#local-6989586621679349602"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-903"></span><span>
</span><span id="line-904"></span><span>    </span><span class="annot"><a href="#local-6989586621679349605"><span class="hs-identifier hs-type">cleanPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-905"></span><span>    </span><span id="local-6989586621679349605"><span class="annot"><span class="annottext">cleanPath :: ShowS
</span><a href="#local-6989586621679349605"><span class="hs-identifier hs-var hs-var">cleanPath</span></a></span></span><span> </span><span id="local-6989586621679349606"><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679349606"><span class="hs-identifier hs-var">filePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-906"></span><span>      </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679349606"><span class="hs-identifier hs-var">filePath</span></a></span><span> </span><span class="annot"><span class="annottext">WatchKind -&gt; (Char -&gt; Char) -&gt; WatchKind
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-907"></span><span>        </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'#'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'@'</span></span><span>
</span><span id="line-908"></span><span>        </span><span id="local-6989586621679349607"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679349607"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679349607"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-909"></span><span>
</span><span id="line-910"></span><span>    </span><span class="annot"><a href="#local-6989586621679349608"><span class="hs-identifier hs-type">docFilePath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-911"></span><span>    </span><span id="local-6989586621679349608"><span class="annot"><span class="annottext">docFilePath :: WatchKind -&gt; Name -&gt; WatchKind
</span><a href="#local-6989586621679349608"><span class="hs-identifier hs-var hs-var">docFilePath</span></a></span></span><span> </span><span id="local-6989586621679349609"><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679349609"><span class="hs-identifier hs-var">destination</span></a></span></span><span> </span><span id="local-6989586621679349610"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349610"><span class="hs-identifier hs-var">docFQN</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-912"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679349611"><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679349611"><span class="hs-identifier hs-var">dir</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349612"><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679349612"><span class="hs-identifier hs-var">fileName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-913"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[WatchKind] -&gt; Maybe ([WatchKind], WatchKind)
forall s a. Snoc s s a a =&gt; s -&gt; Maybe (s, a)
</span><span class="hs-identifier hs-var">unsnoc</span></span><span> </span><span class="annot"><span class="annottext">([WatchKind] -&gt; Maybe ([WatchKind], WatchKind))
-&gt; (Name -&gt; [WatchKind]) -&gt; Name -&gt; Maybe ([WatchKind], WatchKind)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(NameSegment -&gt; WatchKind) -&gt; [NameSegment] -&gt; [WatchKind]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; WatchKind
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; WatchKind)
-&gt; (NameSegment -&gt; Text) -&gt; NameSegment -&gt; WatchKind
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Text
</span><span class="hs-identifier hs-var">NameSegment.toUnescapedText</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([NameSegment] -&gt; [WatchKind])
-&gt; (Name -&gt; [NameSegment]) -&gt; Name -&gt; [WatchKind]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty NameSegment -&gt; [NameSegment]
forall a. NonEmpty a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty NameSegment -&gt; [NameSegment])
-&gt; (Name -&gt; NonEmpty NameSegment) -&gt; Name -&gt; [NameSegment]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NonEmpty NameSegment
</span><span class="hs-identifier hs-var">Name.segments</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Maybe ([WatchKind], WatchKind))
-&gt; Name -&gt; Maybe ([WatchKind], WatchKind)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349610"><span class="hs-identifier hs-var">docFQN</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-914"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679349616"><span class="annot"><span class="annottext">[WatchKind]
</span><a href="#local-6989586621679349616"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349617"><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679349617"><span class="hs-identifier hs-var">leafName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-915"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[WatchKind] -&gt; WatchKind
</span><a href="#local-6989586621679349618"><span class="hs-identifier hs-var">directoryPath</span></a></span><span> </span><span class="annot"><span class="annottext">[WatchKind]
</span><a href="#local-6989586621679349616"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShowS
</span><a href="#local-6989586621679349619"><span class="hs-identifier hs-var">docFileName</span></a></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679349617"><span class="hs-identifier hs-var">leafName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-916"></span><span>              </span><span class="annot"><span class="annottext">Maybe ([WatchKind], WatchKind)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-917"></span><span>                </span><span class="annot"><span class="annottext">WatchKind -&gt; (WatchKind, WatchKind)
forall a. HasCallStack =&gt; WatchKind -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><span class="hs-string">&quot;Could not parse doc name&quot;</span></span><span>
</span><span id="line-918"></span><span>
</span><span id="line-919"></span><span>          </span><span id="local-6989586621679349618"><span class="annot"><span class="annottext">directoryPath :: [WatchKind] -&gt; WatchKind
</span><a href="#local-6989586621679349618"><span class="hs-identifier hs-var hs-var">directoryPath</span></a></span></span><span> </span><span id="local-6989586621679349620"><span class="annot"><span class="annottext">[WatchKind]
</span><a href="#local-6989586621679349620"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-920"></span><span>            </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679349609"><span class="hs-identifier hs-var">destination</span></a></span><span> </span><span class="annot"><span class="annottext">WatchKind -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">[WatchKind] -&gt; WatchKind
</span><span class="hs-identifier hs-var">joinPath</span></span><span> </span><span class="annot"><span class="annottext">[WatchKind]
</span><a href="#local-6989586621679349620"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-921"></span><span>
</span><span id="line-922"></span><span>          </span><span id="local-6989586621679349619"><span class="annot"><span class="annottext">docFileName :: ShowS
</span><a href="#local-6989586621679349619"><span class="hs-identifier hs-var hs-var">docFileName</span></a></span></span><span> </span><span id="local-6989586621679349626"><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679349626"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-923"></span><span>            </span><span class="annot"><span class="annottext">ShowS
</span><a href="#local-6989586621679349605"><span class="hs-identifier hs-var">cleanPath</span></a></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679349626"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">WatchKind -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><span class="hs-string">&quot;.html&quot;</span></span><span>
</span><span id="line-924"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679349611"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">WatchKind -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679349612"><span class="hs-identifier hs-var">fileName</span></a></span><span>
</span><span id="line-925"></span><span>
</span><span id="line-926"></span><span>    </span><span class="annot"><a href="#local-6989586621679349587"><span class="hs-identifier hs-type">renderDocToHtmlFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#UnisonHash"><span class="hs-identifier hs-type">UnisonHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Doc.html#Doc"><span class="hs-identifier hs-type">Doc.Doc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-927"></span><span>    </span><span id="local-6989586621679349587"><span class="annot"><span class="annottext">renderDocToHtmlFile :: Map Referent Name -&gt; WatchKind -&gt; (Name, Text, Doc) -&gt; IO ()
</span><a href="#local-6989586621679349587"><span class="hs-identifier hs-var hs-var">renderDocToHtmlFile</span></a></span></span><span> </span><span id="local-6989586621679349627"><span class="annot"><span class="annottext">Map Referent Name
</span><a href="#local-6989586621679349627"><span class="hs-identifier hs-var">docNamesByRef</span></a></span></span><span> </span><span id="local-6989586621679349628"><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679349628"><span class="hs-identifier hs-var">destination</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679349629"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349629"><span class="hs-identifier hs-var">docName</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349630"><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621679349630"><span class="hs-identifier hs-var">doc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-928"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349631"><span class="annot"><span class="annottext">fullPath :: WatchKind
</span><a href="#local-6989586621679349631"><span class="hs-identifier hs-var hs-var">fullPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-929"></span><span>            </span><span class="annot"><span class="annottext">WatchKind -&gt; Name -&gt; WatchKind
</span><a href="#local-6989586621679349608"><span class="hs-identifier hs-var">docFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679349628"><span class="hs-identifier hs-var">destination</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679349629"><span class="hs-identifier hs-var">docName</span></a></span><span>
</span><span id="line-930"></span><span>
</span><span id="line-931"></span><span>          </span><span id="local-6989586621679349632"><span class="annot"><span class="annottext">directoryPath :: WatchKind
</span><a href="#local-6989586621679349632"><span class="hs-identifier hs-var hs-var">directoryPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-932"></span><span>            </span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">takeDirectory</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679349631"><span class="hs-identifier hs-var">fullPath</span></a></span><span>
</span><span id="line-933"></span><span>
</span><span id="line-934"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Doc.AsHtml.html#FrontMatterData"><span class="hs-identifier hs-type">DocHtml.FrontMatterData</span></a></span><span> </span><span id="local-6989586621679349635"><span class="annot"><span class="annottext">Map Text [Text]
</span><a href="#local-6989586621679349635"><span class="hs-identifier hs-var">frontmatter</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349636"><span class="annot"><span class="annottext">Html ()
</span><a href="#local-6989586621679349636"><span class="hs-identifier hs-var">html</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-935"></span><span>            </span><span class="annot"><span class="annottext">Map Referent Name -&gt; Doc -&gt; (FrontMatterData, Html ())
</span><a href="Unison.Server.Doc.AsHtml.html#toHtml"><span class="hs-identifier hs-var">DocHtml.toHtml</span></a></span><span> </span><span class="annot"><span class="annottext">Map Referent Name
</span><a href="#local-6989586621679349627"><span class="hs-identifier hs-var">docNamesByRef</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621679349630"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-936"></span><span>
</span><span id="line-937"></span><span>          </span><span id="local-6989586621679349638"><span class="annot"><span class="annottext">go :: [Text] -&gt; Value
</span><a href="#local-6989586621679349638"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679349639"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679349639"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">Yaml.String</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679349639"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-938"></span><span>          </span><span class="annot"><a href="#local-6989586621679349638"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679349641"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679349641"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Value] -&gt; Value
</span><span class="hs-identifier hs-var">Yaml.array</span></span><span> </span><span class="annot"><span class="annottext">([Value] -&gt; Value) -&gt; [Value] -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Value) -&gt; [Text] -&gt; [Value]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">Yaml.String</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679349641"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-939"></span><span>
</span><span id="line-940"></span><span>          </span><span id="local-6989586621679349645"><span class="annot"><span class="annottext">frontMatterToYaml :: f [Text] -&gt; f Value
</span><a href="#local-6989586621679349645"><span class="hs-identifier hs-var hs-var">frontMatterToYaml</span></a></span></span><span> </span><span id="local-6989586621679349646"><span class="annot"><span class="annottext">f [Text]
</span><a href="#local-6989586621679349646"><span class="hs-identifier hs-var">fm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-941"></span><span>            </span><span class="annot"><span class="annottext">([Text] -&gt; Value) -&gt; f [Text] -&gt; f Value
forall a b. (a -&gt; b) -&gt; f a -&gt; f b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Value
</span><a href="#local-6989586621679349638"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">f [Text]
</span><a href="#local-6989586621679349646"><span class="hs-identifier hs-var">fm</span></a></span><span>
</span><span id="line-942"></span><span>
</span><span id="line-943"></span><span>          </span><span id="local-6989586621679349647"><span class="annot"><span class="annottext">frontmatterTxt :: Text
</span><a href="#local-6989586621679349647"><span class="hs-identifier hs-var hs-var">frontmatterTxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-944"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Map Text [Text] -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.null</span></span><span> </span><span class="annot"><span class="annottext">Map Text [Text]
</span><a href="#local-6989586621679349635"><span class="hs-identifier hs-var">frontmatter</span></a></span><span>
</span><span id="line-945"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-946"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;---\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><span class="hs-identifier hs-var">TextE.decodeUtf8</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Text Value -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">Yaml.encode</span></span><span> </span><span class="annot"><span class="annottext">(Map Text Value -&gt; ByteString) -&gt; Map Text Value -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Text [Text] -&gt; Map Text Value
forall {f :: * -&gt; *}. Functor f =&gt; f [Text] -&gt; f Value
</span><a href="#local-6989586621679349645"><span class="hs-identifier hs-var">frontMatterToYaml</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text [Text]
</span><a href="#local-6989586621679349635"><span class="hs-identifier hs-var">frontmatter</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;---\n&quot;</span></span><span>
</span><span id="line-947"></span><span>
</span><span id="line-948"></span><span>          </span><span id="local-6989586621679349651"><span class="annot"><span class="annottext">htmlAsText :: Text
</span><a href="#local-6989586621679349651"><span class="hs-identifier hs-var hs-var">htmlAsText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-949"></span><span>            </span><span class="annot"><span class="annottext">Html () -&gt; Text
forall a. Html a -&gt; Text
</span><span class="hs-identifier hs-var">Lucid.renderText</span></span><span> </span><span class="annot"><span class="annottext">Html ()
</span><a href="#local-6989586621679349636"><span class="hs-identifier hs-var">html</span></a></span><span>
</span><span id="line-950"></span><span>
</span><span id="line-951"></span><span>          </span><span id="local-6989586621679349653"><span class="annot"><span class="annottext">fileContents :: Text
</span><a href="#local-6989586621679349653"><span class="hs-identifier hs-var hs-var">fileContents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-952"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679349647"><span class="hs-identifier hs-var">frontmatterTxt</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">toStrict</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679349651"><span class="hs-identifier hs-var">htmlAsText</span></a></span><span>
</span><span id="line-953"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-954"></span><span>            </span><span class="hs-comment">-- Ensure all directories exists</span><span>
</span><span id="line-955"></span><span>            </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; WatchKind -&gt; IO ()
</span><span class="hs-identifier hs-var">createDirectoryIfMissing</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679349632"><span class="hs-identifier hs-var">directoryPath</span></a></span><span>
</span><span id="line-956"></span><span>            </span><span class="annot"><span class="annottext">WatchKind -&gt; WatchKind -&gt; IO ()
</span><span class="hs-identifier hs-var">writeFile</span></span><span> </span><span class="annot"><span class="annottext">WatchKind
</span><a href="#local-6989586621679349631"><span class="hs-identifier hs-var">fullPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; WatchKind
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679349653"><span class="hs-identifier hs-var">fileContents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-957"></span><span>
</span><span id="line-958"></span><span class="annot"><a href="Unison.Server.Backend.html#bestNameForTerm"><span class="hs-identifier hs-type">bestNameForTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-959"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679347693"><span class="annot"><a href="#local-6989586621679347693"><span class="hs-identifier hs-type">v</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679347693"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-960"></span><span id="bestNameForTerm"><span class="annot"><span class="annottext">bestNameForTerm :: forall v. Var v =&gt; PrettyPrintEnv -&gt; Width -&gt; Referent -&gt; Text
</span><a href="Unison.Server.Backend.html#bestNameForTerm"><span class="hs-identifier hs-var hs-var">bestNameForTerm</span></a></span></span><span> </span><span id="local-6989586621679349671"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349671"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679349672"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349672"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-961"></span><span>  </span><span class="annot"><span class="annottext">WatchKind -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span>
</span><span id="line-962"></span><span>    </span><span class="annot"><span class="annottext">(WatchKind -&gt; Text) -&gt; (Referent -&gt; WatchKind) -&gt; Referent -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty WatchKind -&gt; WatchKind
forall s. (Monoid s, IsString s) =&gt; Width -&gt; Pretty s -&gt; s
</span><span class="hs-identifier hs-var">Pretty.render</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349672"><span class="hs-identifier hs-var">width</span></a></span><span>
</span><span id="line-963"></span><span>    </span><span class="annot"><span class="annottext">(Pretty WatchKind -&gt; WatchKind)
-&gt; (Referent -&gt; Pretty WatchKind) -&gt; Referent -&gt; WatchKind
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(SyntaxText -&gt; WatchKind) -&gt; Pretty SyntaxText -&gt; Pretty WatchKind
forall a b. (a -&gt; b) -&gt; Pretty a -&gt; Pretty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">SyntaxText -&gt; WatchKind
forall r. SyntaxText' r -&gt; WatchKind
</span><span class="hs-identifier hs-var">UST.toPlain</span></span><span>
</span><span id="line-964"></span><span>    </span><span class="annot"><span class="annottext">(Pretty SyntaxText -&gt; Pretty WatchKind)
-&gt; (Referent -&gt; Pretty SyntaxText) -&gt; Referent -&gt; Pretty WatchKind
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
-&gt; Reader (PrettyPrintEnv, Set v) (Pretty SyntaxText)
-&gt; Pretty SyntaxText
forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Reader (PrettyPrintEnv, Set v) a -&gt; a
</span><span class="hs-identifier hs-var">TermPrinter.runPretty</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349671"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-965"></span><span>    </span><span class="annot"><span class="annottext">(Reader (PrettyPrintEnv, Set v) (Pretty SyntaxText)
 -&gt; Pretty SyntaxText)
-&gt; (Referent -&gt; Reader (PrettyPrintEnv, Set v) (Pretty SyntaxText))
-&gt; Referent
-&gt; Pretty SyntaxText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall v (m :: * -&gt; *).
MonadPretty v m =&gt;
AmbientContext -&gt; Term3 v PrintAnnotation -&gt; m (Pretty SyntaxText)
</span><span class="hs-identifier hs-var">TermPrinter.pretty0</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679347693"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="annottext">AmbientContext
</span><span class="hs-identifier hs-var">TermPrinter.emptyAc</span></span><span>
</span><span id="line-966"></span><span>    </span><span class="annot"><span class="annottext">(Term3 v PrintAnnotation
 -&gt; Reader (PrettyPrintEnv, Set v) (Pretty SyntaxText))
-&gt; (Referent -&gt; Term3 v PrintAnnotation)
-&gt; Referent
-&gt; Reader (PrettyPrintEnv, Set v) (Pretty SyntaxText)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PrintAnnotation -&gt; Referent -&gt; Term3 v PrintAnnotation
forall v a vt at ap. Ord v =&gt; a -&gt; Referent -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.fromReferent</span></span><span> </span><span class="annot"><span class="annottext">PrintAnnotation
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-967"></span><span>
</span><span id="line-968"></span><span class="annot"><a href="Unison.Server.Backend.html#bestNameForType"><span class="hs-identifier hs-type">bestNameForType</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-969"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679347686"><span class="annot"><a href="#local-6989586621679347686"><span class="hs-identifier hs-type">v</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679347686"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-970"></span><span id="bestNameForType"><span class="annot"><span class="annottext">bestNameForType :: forall v. Var v =&gt; PrettyPrintEnv -&gt; Width -&gt; TypeReference -&gt; Text
</span><a href="Unison.Server.Backend.html#bestNameForType"><span class="hs-identifier hs-var hs-var">bestNameForType</span></a></span></span><span> </span><span id="local-6989586621679349687"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349687"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679349688"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349688"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-971"></span><span>  </span><span class="annot"><span class="annottext">WatchKind -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span>
</span><span id="line-972"></span><span>    </span><span class="annot"><span class="annottext">(WatchKind -&gt; Text)
-&gt; (TypeReference -&gt; WatchKind) -&gt; TypeReference -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty WatchKind -&gt; WatchKind
forall s. (Monoid s, IsString s) =&gt; Width -&gt; Pretty s -&gt; s
</span><span class="hs-identifier hs-var">Pretty.render</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349688"><span class="hs-identifier hs-var">width</span></a></span><span>
</span><span id="line-973"></span><span>    </span><span class="annot"><span class="annottext">(Pretty WatchKind -&gt; WatchKind)
-&gt; (TypeReference -&gt; Pretty WatchKind)
-&gt; TypeReference
-&gt; WatchKind
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(SyntaxText -&gt; WatchKind) -&gt; Pretty SyntaxText -&gt; Pretty WatchKind
forall a b. (a -&gt; b) -&gt; Pretty a -&gt; Pretty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">SyntaxText -&gt; WatchKind
forall r. SyntaxText' r -&gt; WatchKind
</span><span class="hs-identifier hs-var">UST.toPlain</span></span><span>
</span><span id="line-974"></span><span>    </span><span class="annot"><span class="annottext">(Pretty SyntaxText -&gt; Pretty WatchKind)
-&gt; (TypeReference -&gt; Pretty SyntaxText)
-&gt; TypeReference
-&gt; Pretty WatchKind
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Type v a -&gt; Pretty SyntaxText
</span><span class="hs-identifier hs-var">TypePrinter.prettySyntax</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679347686"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349687"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-975"></span><span>    </span><span class="annot"><span class="annottext">(Type v () -&gt; Pretty SyntaxText)
-&gt; (TypeReference -&gt; Type v ())
-&gt; TypeReference
-&gt; Pretty SyntaxText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; TypeReference -&gt; Type v ()
forall v a. Ord v =&gt; a -&gt; TypeReference -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.ref</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-976"></span><span>
</span><span id="line-977"></span><span class="hs-comment">-- | Gets the names and PPED for the branch at the provided path from the root branch for the</span><span>
</span><span id="line-978"></span><span class="hs-comment">-- provided branch hash.</span><span>
</span><span id="line-979"></span><span class="annot"><a href="Unison.Server.Backend.html#namesAtPathFromRootBranchHash"><span class="hs-identifier hs-type">namesAtPathFromRootBranchHash</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-980"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679347805"><span class="annot"><a href="#local-6989586621679347805"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679347808"><span class="annot"><a href="#local-6989586621679347808"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span id="local-6989586621679347806"><span class="annot"><a href="#local-6989586621679347806"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621679347807"><span class="annot"><a href="#local-6989586621679347807"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-981"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679347805"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-982"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679347805"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347806"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347807"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-983"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">V2Branch.CausalBranch</span></span><span> </span><span class="annot"><a href="#local-6989586621679347808"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-984"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-985"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347805"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span class="hs-special">)</span><span>
</span><span id="line-986"></span><span id="namesAtPathFromRootBranchHash"><span class="annot"><span class="annottext">namesAtPathFromRootBranchHash :: forall (m :: * -&gt; *) (n :: * -&gt; *) v a.
MonadIO m =&gt;
Codebase m v a
-&gt; CausalBranch n -&gt; Path -&gt; Backend m (Names, PrettyPrintEnvDecl)
</span><a href="Unison.Server.Backend.html#namesAtPathFromRootBranchHash"><span class="hs-identifier hs-var hs-var">namesAtPathFromRootBranchHash</span></a></span></span><span> </span><span id="local-6989586621679349714"><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679349714"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679349715"><span class="annot"><span class="annottext">CausalBranch n
</span><a href="#local-6989586621679349715"><span class="hs-identifier hs-var">cb</span></a></span></span><span> </span><span id="local-6989586621679349716"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679349716"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-987"></span><span>  </span><span id="local-6989586621679349717"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679349717"><span class="hs-identifier hs-var">shouldUseNamesIndex</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(BackendEnv -&gt; Bool) -&gt; Backend m Bool
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">BackendEnv -&gt; Bool
</span><a href="Unison.Server.Backend.html#%24sel%3AuseNamesIndex%3ABackendEnv"><span class="hs-identifier hs-var">useNamesIndex</span></a></span><span>
</span><span id="line-988"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679349719"><span class="annot"><span class="annottext">BranchHash
</span><a href="#local-6989586621679349719"><span class="hs-identifier hs-var">rootBranchHash</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349720"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679349720"><span class="hs-identifier hs-var">rootCausalHash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalBranch n -&gt; BranchHash
forall (m :: * -&gt; *) hc he pe e. Causal m hc he pe e -&gt; he
</span><span class="hs-identifier hs-var">V2Causal.valueHash</span></span><span> </span><span class="annot"><span class="annottext">CausalBranch n
</span><a href="#local-6989586621679349715"><span class="hs-identifier hs-var">cb</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CausalBranch n -&gt; CausalHash
forall (m :: * -&gt; *) hc he pe e. Causal m hc he pe e -&gt; hc
</span><span class="hs-identifier hs-var">V2Causal.causalHash</span></span><span> </span><span class="annot"><span class="annottext">CausalBranch n
</span><a href="#local-6989586621679349715"><span class="hs-identifier hs-var">cb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-989"></span><span>  </span><span id="local-6989586621679349722"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679349722"><span class="hs-identifier hs-var">haveNameLookupForRoot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Bool -&gt; Backend m Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; Backend m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m Bool -&gt; Backend m Bool) -&gt; m Bool -&gt; Backend m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a -&gt; Transaction Bool -&gt; m Bool
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679349714"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BranchHash -&gt; Transaction Bool
</span><span class="hs-identifier hs-var">Ops.checkBranchHashNameLookupExists</span></span><span> </span><span class="annot"><span class="annottext">BranchHash
</span><a href="#local-6989586621679349719"><span class="hs-identifier hs-var">rootBranchHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-990"></span><span>  </span><span id="local-6989586621679349724"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679349724"><span class="hs-identifier hs-var">hashLen</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Int -&gt; Backend m Int
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; Backend m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m Int -&gt; Backend m Int) -&gt; m Int -&gt; Backend m Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a -&gt; Transaction Int -&gt; m Int
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679349714"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Transaction Int
</span><span class="hs-identifier hs-var">Codebase.hashLength</span></span><span>
</span><span id="line-991"></span><span>  </span><span id="local-6989586621679349725"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679349725"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-992"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679349717"><span class="hs-identifier hs-var">shouldUseNamesIndex</span></a></span><span>
</span><span id="line-993"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-994"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Backend m () -&gt; Backend m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679349722"><span class="hs-identifier hs-var">haveNameLookupForRoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Backend m () -&gt; Backend m ())
-&gt; (BackendError -&gt; Backend m ()) -&gt; BackendError -&gt; Backend m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BackendError -&gt; Backend m ()
forall a. BackendError -&gt; Backend m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(BackendError -&gt; Backend m ()) -&gt; BackendError -&gt; Backend m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BranchHash -&gt; BackendError
</span><a href="Unison.Server.Backend.html#ExpectedNameLookup"><span class="hs-identifier hs-var">ExpectedNameLookup</span></a></span><span> </span><span class="annot"><span class="annottext">BranchHash
</span><a href="#local-6989586621679349719"><span class="hs-identifier hs-var">rootBranchHash</span></a></span><span>
</span><span id="line-995"></span><span>        </span><span class="annot"><span class="annottext">m Names -&gt; Backend m Names
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; Backend m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m Names -&gt; Backend m Names)
-&gt; (Transaction Names -&gt; m Names)
-&gt; Transaction Names
-&gt; Backend m Names
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a -&gt; Transaction Names -&gt; m Names
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679349714"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">(Transaction Names -&gt; Backend m Names)
-&gt; Transaction Names -&gt; Backend m Names
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BranchHash -&gt; Path -&gt; Transaction Names
</span><span class="hs-identifier hs-var">Codebase.namesAtPath</span></span><span> </span><span class="annot"><span class="annottext">BranchHash
</span><a href="#local-6989586621679349719"><span class="hs-identifier hs-var">rootBranchHash</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679349716"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-996"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-997"></span><span>        </span><span class="annot"><span class="annottext">Branch0 m -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">(Branch0 m -&gt; Names)
-&gt; (Branch m -&gt; Branch0 m) -&gt; Branch m -&gt; Names
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Path -&gt; Branch0 m -&gt; Branch0 m
forall (m :: * -&gt; *). Path -&gt; Branch0 m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.getAt0</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679349716"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">(Branch0 m -&gt; Branch0 m)
-&gt; (Branch m -&gt; Branch0 m) -&gt; Branch m -&gt; Branch0 m
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Branch m -&gt; Branch0 m
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">(Branch m -&gt; Names) -&gt; Backend m (Branch m) -&gt; Backend m Names
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">CausalHash -&gt; Codebase m v a -&gt; Backend m (Branch m)
forall (m :: * -&gt; *) v a.
Monad m =&gt;
CausalHash -&gt; Codebase m v a -&gt; Backend m (Branch m)
</span><a href="Unison.Server.Backend.html#resolveCausalHash"><span class="hs-identifier hs-var">resolveCausalHash</span></a></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679349720"><span class="hs-identifier hs-var">rootCausalHash</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679349714"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-998"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349731"><span class="annot"><span class="annottext">pped :: PrettyPrintEnvDecl
</span><a href="#local-6989586621679349731"><span class="hs-identifier hs-var hs-var">pped</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Namer -&gt; Suffixifier -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.makePPED</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Names -&gt; Namer
</span><span class="hs-identifier hs-var">PPE.hqNamer</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679349724"><span class="hs-identifier hs-var">hashLen</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679349725"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Suffixifier
</span><span class="hs-identifier hs-var">PPE.suffixifyByHash</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679349725"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-999"></span><span>  </span><span class="annot"><span class="annottext">(Names, PrettyPrintEnvDecl)
-&gt; Backend m (Names, PrettyPrintEnvDecl)
forall a. a -&gt; Backend m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679349725"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349731"><span class="hs-identifier hs-var">pped</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1000"></span><span>
</span><span id="line-1001"></span><span id="local-6989586621679347824"><span id="local-6989586621679347825"><span id="local-6989586621679347826"><span class="annot"><a href="Unison.Server.Backend.html#resolveCausalHash"><span class="hs-identifier hs-type">resolveCausalHash</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1002"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679347824"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679347824"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347825"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347826"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347824"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621679347824"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1003"></span><span id="resolveCausalHash"><span class="annot"><span class="annottext">resolveCausalHash :: forall (m :: * -&gt; *) v a.
Monad m =&gt;
CausalHash -&gt; Codebase m v a -&gt; Backend m (Branch m)
</span><a href="Unison.Server.Backend.html#resolveCausalHash"><span class="hs-identifier hs-var hs-var">resolveCausalHash</span></a></span></span><span> </span><span id="local-6989586621679349741"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679349741"><span class="hs-identifier hs-var">bhash</span></a></span></span><span> </span><span id="local-6989586621679349742"><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679349742"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1004"></span><span>  </span><span id="local-6989586621679349743"><span class="annot"><span class="annottext">Maybe (Branch m)
</span><a href="#local-6989586621679349743"><span class="hs-identifier hs-var">mayBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Maybe (Branch m)) -&gt; Backend m (Maybe (Branch m))
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; Backend m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe (Branch m)) -&gt; Backend m (Maybe (Branch m)))
-&gt; m (Maybe (Branch m)) -&gt; Backend m (Maybe (Branch m))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a -&gt; CausalHash -&gt; m (Maybe (Branch m))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; CausalHash -&gt; m (Maybe (Branch m))
</span><span class="hs-identifier hs-var">Codebase.getBranchForHash</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679349742"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679349741"><span class="hs-identifier hs-var">bhash</span></a></span><span>
</span><span id="line-1005"></span><span>  </span><span class="annot"><span class="annottext">Maybe (Branch m) -&gt; Backend m (Branch m) -&gt; Backend m (Branch m)
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">whenNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Branch m)
</span><a href="#local-6989586621679349743"><span class="hs-identifier hs-var">mayBranch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackendError -&gt; Backend m (Branch m)
forall a. BackendError -&gt; Backend m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(BackendError -&gt; Backend m (Branch m))
-&gt; BackendError -&gt; Backend m (Branch m)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CausalHash -&gt; BackendError
</span><a href="Unison.Server.Backend.html#NoBranchForHash"><span class="hs-identifier hs-var">NoBranchForHash</span></a></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679349741"><span class="hs-identifier hs-var">bhash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1006"></span><span>
</span><span id="line-1007"></span><span id="local-6989586621679347837"><span id="local-6989586621679347838"><span id="local-6989586621679347839"><span class="annot"><a href="Unison.Server.Backend.html#resolveRootBranchHash"><span class="hs-identifier hs-type">resolveRootBranchHash</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1008"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679347837"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortCausalHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679347837"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347838"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347839"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347837"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621679347837"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1009"></span><span id="resolveRootBranchHash"><span class="annot"><span class="annottext">resolveRootBranchHash :: forall (m :: * -&gt; *) v a.
MonadIO m =&gt;
ShortCausalHash -&gt; Codebase m v a -&gt; Backend m (Branch m)
</span><a href="Unison.Server.Backend.html#resolveRootBranchHash"><span class="hs-identifier hs-var hs-var">resolveRootBranchHash</span></a></span></span><span> </span><span id="local-6989586621679349750"><span class="annot"><span class="annottext">ShortCausalHash
</span><a href="#local-6989586621679349750"><span class="hs-identifier hs-var">sch</span></a></span></span><span> </span><span id="local-6989586621679349751"><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679349751"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1010"></span><span>  </span><span id="local-6989586621679349752"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679349752"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(forall x. Transaction x -&gt; m x)
-&gt; Backend Transaction CausalHash -&gt; Backend m CausalHash
forall (m :: * -&gt; *) (n :: * -&gt; *) a.
(forall x. m x -&gt; n x) -&gt; Backend m a -&gt; Backend n a
</span><a href="Unison.Server.Backend.html#hoistBackend"><span class="hs-identifier hs-var">hoistBackend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase m v a -&gt; Transaction x -&gt; m x
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679349751"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortCausalHash -&gt; Backend Transaction CausalHash
</span><a href="Unison.Server.Backend.html#expandShortCausalHash"><span class="hs-identifier hs-var">expandShortCausalHash</span></a></span><span> </span><span class="annot"><span class="annottext">ShortCausalHash
</span><a href="#local-6989586621679349750"><span class="hs-identifier hs-var">sch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1011"></span><span>  </span><span class="annot"><span class="annottext">CausalHash -&gt; Codebase m v a -&gt; Backend m (Branch m)
forall (m :: * -&gt; *) v a.
Monad m =&gt;
CausalHash -&gt; Codebase m v a -&gt; Backend m (Branch m)
</span><a href="Unison.Server.Backend.html#resolveCausalHash"><span class="hs-identifier hs-var">resolveCausalHash</span></a></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679349752"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621679349751"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-1012"></span><span>
</span><span id="line-1013"></span><span class="annot"><a href="Unison.Server.Backend.html#resolveRootBranchHashV2"><span class="hs-identifier hs-type">resolveRootBranchHashV2</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1014"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ShortCausalHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2Branch.CausalBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span class="hs-special">)</span><span>
</span><span id="line-1015"></span><span id="resolveRootBranchHashV2"><span class="annot"><span class="annottext">resolveRootBranchHashV2 :: ShortCausalHash -&gt; Backend Transaction (CausalBranch Transaction)
</span><a href="Unison.Server.Backend.html#resolveRootBranchHashV2"><span class="hs-identifier hs-var hs-var">resolveRootBranchHashV2</span></a></span></span><span> </span><span id="local-6989586621679349754"><span class="annot"><span class="annottext">ShortCausalHash
</span><a href="#local-6989586621679349754"><span class="hs-identifier hs-var">sch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1016"></span><span>  </span><span id="local-6989586621679349755"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679349755"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShortCausalHash -&gt; Backend Transaction CausalHash
</span><a href="Unison.Server.Backend.html#expandShortCausalHash"><span class="hs-identifier hs-var">expandShortCausalHash</span></a></span><span> </span><span class="annot"><span class="annottext">ShortCausalHash
</span><a href="#local-6989586621679349754"><span class="hs-identifier hs-var">sch</span></a></span><span>
</span><span id="line-1017"></span><span>  </span><span class="annot"><span class="annottext">Transaction (CausalBranch Transaction)
-&gt; Backend Transaction (CausalBranch Transaction)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; Backend m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalHash -&gt; Transaction (CausalBranch Transaction)
</span><span class="hs-identifier hs-var">Codebase.expectCausalBranchByCausalHash</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679349755"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1018"></span><span>
</span><span id="line-1019"></span><span class="annot"><a href="Unison.Server.Backend.html#normaliseRootCausalHash"><span class="hs-identifier hs-type">normaliseRootCausalHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortCausalHash</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2Branch.CausalBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span class="hs-special">)</span><span>
</span><span id="line-1020"></span><span id="normaliseRootCausalHash"><span class="annot"><span class="annottext">normaliseRootCausalHash :: Either ShortCausalHash CausalHash
-&gt; Backend Transaction (CausalBranch Transaction)
</span><a href="Unison.Server.Backend.html#normaliseRootCausalHash"><span class="hs-identifier hs-var hs-var">normaliseRootCausalHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1021"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679349756"><span class="annot"><span class="annottext">ShortCausalHash
</span><a href="#local-6989586621679349756"><span class="hs-identifier hs-var">sch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1022"></span><span>    </span><span id="local-6989586621679349757"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679349757"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShortCausalHash -&gt; Backend Transaction CausalHash
</span><a href="Unison.Server.Backend.html#expandShortCausalHash"><span class="hs-identifier hs-var">expandShortCausalHash</span></a></span><span> </span><span class="annot"><span class="annottext">ShortCausalHash
</span><a href="#local-6989586621679349756"><span class="hs-identifier hs-var">sch</span></a></span><span>
</span><span id="line-1023"></span><span>    </span><span class="annot"><span class="annottext">Transaction (CausalBranch Transaction)
-&gt; Backend Transaction (CausalBranch Transaction)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; Backend m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Transaction (CausalBranch Transaction)
 -&gt; Backend Transaction (CausalBranch Transaction))
-&gt; Transaction (CausalBranch Transaction)
-&gt; Backend Transaction (CausalBranch Transaction)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CausalHash -&gt; Transaction (CausalBranch Transaction)
</span><span class="hs-identifier hs-var">Codebase.expectCausalBranchByCausalHash</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679349757"><span class="hs-identifier hs-var">ch</span></a></span><span>
</span><span id="line-1024"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679349758"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679349758"><span class="hs-identifier hs-var">ch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Transaction (CausalBranch Transaction)
-&gt; Backend Transaction (CausalBranch Transaction)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; Backend m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Transaction (CausalBranch Transaction)
 -&gt; Backend Transaction (CausalBranch Transaction))
-&gt; Transaction (CausalBranch Transaction)
-&gt; Backend Transaction (CausalBranch Transaction)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CausalHash -&gt; Transaction (CausalBranch Transaction)
</span><span class="hs-identifier hs-var">Codebase.expectCausalBranchByCausalHash</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679349758"><span class="hs-identifier hs-var">ch</span></a></span><span>
</span><span id="line-1025"></span><span>
</span><span id="line-1026"></span><span class="hs-comment">-- | Determines whether we include full cycles in the results, (e.g. if I search for `isEven`, will I find `isOdd` too?)</span><span>
</span><span id="line-1027"></span><span class="hs-comment">--</span><span>
</span><span id="line-1028"></span><span class="hs-comment">-- This was once used for both term and decl components, but now is only used for decl components, because 'update' does</span><span>
</span><span id="line-1029"></span><span class="hs-comment">-- The Right Thing for terms (i.e. propagates changes to all dependents, including component-mates, which are de facto</span><span>
</span><span id="line-1030"></span><span class="hs-comment">-- dependents).</span><span>
</span><span id="line-1031"></span><span class="hs-comment">--</span><span>
</span><span id="line-1032"></span><span class="hs-comment">-- Ticket of interest: https://github.com/unisonweb/unison/issues/3445</span><span>
</span><span id="line-1033"></span><span class="hs-keyword">data</span><span> </span><span id="IncludeCycles"><span class="annot"><a href="Unison.Server.Backend.html#IncludeCycles"><span class="hs-identifier hs-var">IncludeCycles</span></a></span></span><span>
</span><span id="line-1034"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="IncludeCycles"><span class="annot"><a href="Unison.Server.Backend.html#IncludeCycles"><span class="hs-identifier hs-var">IncludeCycles</span></a></span></span><span>
</span><span id="line-1035"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="DontIncludeCycles"><span class="annot"><a href="Unison.Server.Backend.html#DontIncludeCycles"><span class="hs-identifier hs-var">DontIncludeCycles</span></a></span></span><span>
</span><span id="line-1036"></span><span>
</span><span id="line-1037"></span><span id="local-6989586621679347844"><span class="annot"><a href="Unison.Server.Backend.html#definitionsByName"><span class="hs-identifier hs-type">definitionsByName</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1038"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679347844"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1039"></span><span>  </span><span class="annot"><a href="Unison.Server.NameSearch.html#NameSearch"><span class="hs-identifier hs-type">NameSearch</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1040"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#IncludeCycles"><span class="hs-identifier hs-type">IncludeCycles</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1041"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Names.SearchType</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1042"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1043"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier hs-type">DefinitionResults</span></a></span></span><span>
</span><span id="line-1044"></span><span id="definitionsByName"><span class="annot"><span class="annottext">definitionsByName :: forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; NameSearch Transaction
-&gt; IncludeCycles
-&gt; SearchType
-&gt; [HashQualified Name]
-&gt; Transaction DefinitionResults
</span><a href="Unison.Server.Backend.html#definitionsByName"><span class="hs-identifier hs-var hs-var">definitionsByName</span></a></span></span><span> </span><span id="local-6989586621679349783"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349783"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679349784"><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679349784"><span class="hs-identifier hs-var">nameSearch</span></a></span></span><span> </span><span id="local-6989586621679349785"><span class="annot"><span class="annottext">IncludeCycles
</span><a href="#local-6989586621679349785"><span class="hs-identifier hs-var">includeCycles</span></a></span></span><span> </span><span id="local-6989586621679349786"><span class="annot"><span class="annottext">SearchType
</span><a href="#local-6989586621679349786"><span class="hs-identifier hs-var">searchType</span></a></span></span><span> </span><span id="local-6989586621679349787"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679349787"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1045"></span><span>  </span><span class="annot"><a href="Unison.Server.QueryResult.html#QueryResult"><span class="hs-identifier hs-type">QueryResult</span></a></span><span> </span><span id="local-6989586621679349788"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679349788"><span class="hs-identifier hs-var">misses</span></a></span></span><span> </span><span id="local-6989586621679349789"><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679349789"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; NameSearch Transaction
-&gt; SearchType
-&gt; [HashQualified Name]
-&gt; Transaction QueryResult
forall (m :: * -&gt; *) v.
Codebase m v Ann
-&gt; NameSearch Transaction
-&gt; SearchType
-&gt; [HashQualified Name]
-&gt; Transaction QueryResult
</span><a href="Unison.Server.Backend.html#hqNameQuery"><span class="hs-identifier hs-var">hqNameQuery</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349783"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">NameSearch Transaction
</span><a href="#local-6989586621679349784"><span class="hs-identifier hs-var">nameSearch</span></a></span><span> </span><span class="annot"><span class="annottext">SearchType
</span><a href="#local-6989586621679349786"><span class="hs-identifier hs-var">searchType</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679349787"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-1046"></span><span>  </span><span class="hs-comment">-- todo: remember to replace this with getting components directly,</span><span>
</span><span id="line-1047"></span><span>  </span><span class="hs-comment">-- and maybe even remove getComponentLength from Codebase interface altogether</span><span>
</span><span id="line-1048"></span><span>  </span><span id="local-6989586621679349790"><span class="annot"><span class="annottext">Map
  TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="#local-6989586621679349790"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TypeReference
 -&gt; Transaction
      (TypeReference, DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
-&gt; Set TypeReference
-&gt; Transaction
     (Map
        TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
forall k (m :: * -&gt; *) (t :: * -&gt; *) a v.
(Ord k, Monad m, Foldable t) =&gt;
(a -&gt; m (k, v)) -&gt; t a -&gt; m (Map k v)
</span><span class="hs-identifier hs-var">Map.foldMapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679349792"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349792"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349792"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DisplayObject (Type Symbol Ann) (Term Symbol Ann)
 -&gt; (TypeReference,
     DisplayObject (Type Symbol Ann) (Term Symbol Ann)))
-&gt; Transaction (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
-&gt; Transaction
     (TypeReference, DisplayObject (Type Symbol Ann) (Term Symbol Ann))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; TypeReference
-&gt; Transaction (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; TypeReference
-&gt; Transaction (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="Unison.Server.Backend.html#displayTerm"><span class="hs-identifier hs-var">displayTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349783"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349792"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SearchResult] -&gt; Set TypeReference
</span><a href="#local-6989586621679349793"><span class="hs-identifier hs-var">searchResultsToTermRefs</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679349789"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1049"></span><span>  </span><span id="local-6989586621679349794"><span class="annot"><span class="annottext">Map TypeReference (DisplayObject () (Decl Symbol Ann))
</span><a href="#local-6989586621679349794"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1050"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349795"><span class="annot"><span class="annottext">typeRefsWithoutCycles :: Set TypeReference
</span><a href="#local-6989586621679349795"><span class="hs-identifier hs-var hs-var">typeRefsWithoutCycles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; Set TypeReference
</span><a href="#local-6989586621679349796"><span class="hs-identifier hs-var">searchResultsToTypeRefs</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679349789"><span class="hs-identifier hs-var">results</span></a></span><span>
</span><span id="line-1051"></span><span>    </span><span id="local-6989586621679349797"><span class="annot"><span class="annottext">Set TypeReference
</span><a href="#local-6989586621679349797"><span class="hs-identifier hs-var">typeRefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IncludeCycles
</span><a href="#local-6989586621679349785"><span class="hs-identifier hs-var">includeCycles</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1052"></span><span>      </span><span class="annot"><span class="annottext">IncludeCycles
</span><a href="Unison.Server.Backend.html#IncludeCycles"><span class="hs-identifier hs-var">IncludeCycles</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1053"></span><span>        </span><span class="annot"><span class="annottext">(TypeReference -&gt; Transaction (Set TypeReference))
-&gt; Set TypeReference -&gt; Transaction (Set TypeReference)
forall (m :: * -&gt; *) (f :: * -&gt; *) b a.
(Monad m, Foldable f, Monoid b) =&gt;
(a -&gt; m b) -&gt; f a -&gt; m b
</span><span class="hs-identifier hs-var">Monoid.foldMapM</span></span><span>
</span><span id="line-1054"></span><span>          </span><span class="annot"><span class="annottext">TypeReference -&gt; Transaction (Set TypeReference)
</span><span class="hs-identifier hs-var">Codebase.componentReferencesForReference</span></span><span>
</span><span id="line-1055"></span><span>          </span><span class="annot"><span class="annottext">Set TypeReference
</span><a href="#local-6989586621679349795"><span class="hs-identifier hs-var">typeRefsWithoutCycles</span></a></span><span>
</span><span id="line-1056"></span><span>      </span><span class="annot"><span class="annottext">IncludeCycles
</span><a href="Unison.Server.Backend.html#DontIncludeCycles"><span class="hs-identifier hs-var">DontIncludeCycles</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TypeReference -&gt; Transaction (Set TypeReference)
forall a. a -&gt; Transaction a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Set TypeReference
</span><a href="#local-6989586621679349795"><span class="hs-identifier hs-var">typeRefsWithoutCycles</span></a></span><span>
</span><span id="line-1057"></span><span>    </span><span class="annot"><span class="annottext">(TypeReference
 -&gt; Transaction (TypeReference, DisplayObject () (Decl Symbol Ann)))
-&gt; Set TypeReference
-&gt; Transaction
     (Map TypeReference (DisplayObject () (Decl Symbol Ann)))
forall k (m :: * -&gt; *) (t :: * -&gt; *) a v.
(Ord k, Monad m, Foldable t) =&gt;
(a -&gt; m (k, v)) -&gt; t a -&gt; m (Map k v)
</span><span class="hs-identifier hs-var">Map.foldMapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679349799"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349799"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349799"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DisplayObject () (Decl Symbol Ann)
 -&gt; (TypeReference, DisplayObject () (Decl Symbol Ann)))
-&gt; Transaction (DisplayObject () (Decl Symbol Ann))
-&gt; Transaction (TypeReference, DisplayObject () (Decl Symbol Ann))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; TypeReference
-&gt; Transaction (DisplayObject () (Decl Symbol Ann))
forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; TypeReference
-&gt; Transaction (DisplayObject () (Decl Symbol Ann))
</span><a href="Unison.Server.Backend.html#displayType"><span class="hs-identifier hs-var">displayType</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349783"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349799"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set TypeReference
</span><a href="#local-6989586621679349797"><span class="hs-identifier hs-var">typeRefs</span></a></span><span>
</span><span id="line-1058"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map
  TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
-&gt; Map TypeReference (DisplayObject () (Decl Symbol Ann))
-&gt; [HashQualified Name]
-&gt; DefinitionResults
</span><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier hs-var">DefinitionResults</span></a></span><span> </span><span class="annot"><span class="annottext">Map
  TypeReference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="#local-6989586621679349790"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="annot"><span class="annottext">Map TypeReference (DisplayObject () (Decl Symbol Ann))
</span><a href="#local-6989586621679349794"><span class="hs-identifier hs-var">types</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679349788"><span class="hs-identifier hs-var">misses</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1059"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1060"></span><span>    </span><span class="annot"><a href="#local-6989586621679349793"><span class="hs-identifier hs-type">searchResultsToTermRefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.SearchResult.html#SearchResult"><span class="hs-identifier hs-type">SR.SearchResult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-1061"></span><span>    </span><span id="local-6989586621679349793"><span class="annot"><span class="annottext">searchResultsToTermRefs :: [SearchResult] -&gt; Set TypeReference
</span><a href="#local-6989586621679349793"><span class="hs-identifier hs-var hs-var">searchResultsToTermRefs</span></a></span></span><span> </span><span id="local-6989586621679349800"><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679349800"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1062"></span><span>      </span><span class="annot"><span class="annottext">[TypeReference] -&gt; Set TypeReference
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349801"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Unison.Server.SearchResult.html#Tm%27"><span class="hs-identifier hs-type">SR.Tm'</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span id="local-6989586621679349801"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349801"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679349800"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1063"></span><span>    </span><span class="annot"><a href="#local-6989586621679349796"><span class="hs-identifier hs-type">searchResultsToTypeRefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.SearchResult.html#SearchResult"><span class="hs-identifier hs-type">SR.SearchResult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-1064"></span><span>    </span><span id="local-6989586621679349796"><span class="annot"><span class="annottext">searchResultsToTypeRefs :: [SearchResult] -&gt; Set TypeReference
</span><a href="#local-6989586621679349796"><span class="hs-identifier hs-var hs-var">searchResultsToTypeRefs</span></a></span></span><span> </span><span id="local-6989586621679349803"><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679349803"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1065"></span><span>      </span><span class="annot"><span class="annottext">[TypeReference] -&gt; Set TypeReference
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SearchResult -&gt; Maybe TypeReference)
-&gt; [SearchResult] -&gt; [TypeReference]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b.
Filterable f =&gt;
(a -&gt; Maybe b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">SearchResult -&gt; Maybe TypeReference
</span><a href="#local-6989586621679349805"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679349803"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1066"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1067"></span><span>        </span><span class="annot"><a href="#local-6989586621679349805"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.SearchResult.html#SearchResult"><span class="hs-identifier hs-type">SR.SearchResult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-1068"></span><span>        </span><span id="local-6989586621679349805"><span class="annot"><span class="annottext">f :: SearchResult -&gt; Maybe TypeReference
</span><a href="#local-6989586621679349805"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1069"></span><span>          </span><span class="annot"><a href="Unison.Server.SearchResult.html#Tm%27"><span class="hs-identifier hs-type">SR.Tm'</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Referent.Con</span></span><span> </span><span id="local-6989586621679349806"><span class="annot"><span class="annottext">GConstructorReference TypeReference
</span><a href="#local-6989586621679349806"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConstructorType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Maybe TypeReference
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GConstructorReference TypeReference
</span><a href="#local-6989586621679349806"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">GConstructorReference TypeReference
-&gt; Getting
     TypeReference (GConstructorReference TypeReference) TypeReference
-&gt; TypeReference
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  TypeReference (GConstructorReference TypeReference) TypeReference
forall r s (f :: * -&gt; *).
Functor f =&gt;
(r -&gt; f s)
-&gt; GConstructorReference r -&gt; f (GConstructorReference s)
</span><span class="hs-identifier hs-var">ConstructorReference.reference_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1070"></span><span>          </span><span class="annot"><a href="Unison.Server.SearchResult.html#Tp%27"><span class="hs-identifier hs-type">SR.Tp'</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679349810"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349810"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Maybe TypeReference
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349810"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1071"></span><span>          </span><span class="annot"><span class="annottext">SearchResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe TypeReference
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1072"></span><span>
</span><span id="line-1073"></span><span id="local-6989586621679347854"><span class="annot"><a href="Unison.Server.Backend.html#displayTerm"><span class="hs-identifier hs-type">displayTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679347854"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-1074"></span><span id="displayTerm"><span class="annot"><span class="annottext">displayTerm :: forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; TypeReference
-&gt; Transaction (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="Unison.Server.Backend.html#displayTerm"><span class="hs-identifier hs-var hs-var">displayTerm</span></a></span></span><span> </span><span id="local-6989586621679349820"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349820"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1075"></span><span>  </span><span id="local-6989586621679349821"><span class="annot"><span class="annottext">ref :: TypeReference
</span><a href="#local-6989586621679349821"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.Builtin</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1076"></span><span>    </span><span class="annot"><span class="annottext">DisplayObject (Type Symbol Ann) (Term Symbol Ann)
-&gt; Transaction (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
forall a. a -&gt; Transaction a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TypeReference
-&gt; Map TypeReference (Type Symbol ()) -&gt; Maybe (Type Symbol ())
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349821"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">Map TypeReference (Type Symbol ())
</span><span class="hs-identifier hs-var">B.termRefTypes</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1077"></span><span>      </span><span class="hs-comment">-- This would be better as a `MissingBuiltin` constructor; `MissingObject` is kind of being</span><span>
</span><span id="line-1078"></span><span>      </span><span class="hs-comment">-- misused here. Is `MissingObject` even possible anymore?</span><span>
</span><span id="line-1079"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Type Symbol ())
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; DisplayObject (Type Symbol Ann) (Term Symbol Ann)
forall b a. ShortHash -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">MissingObject</span></span><span> </span><span class="annot"><span class="annottext">(ShortHash -&gt; DisplayObject (Type Symbol Ann) (Term Symbol Ann))
-&gt; ShortHash -&gt; DisplayObject (Type Symbol Ann) (Term Symbol Ann)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.toShortHash</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349821"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-1080"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679349823"><span class="annot"><span class="annottext">Type Symbol ()
</span><a href="#local-6989586621679349823"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
-&gt; DisplayObject (Type Symbol Ann) (Term Symbol Ann)
forall b a. b -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">BuiltinObject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Ann -&gt; Type Symbol () -&gt; Type Symbol Ann
forall a b. a -&gt; Term F Symbol b -&gt; Term F Symbol a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol ()
</span><a href="#local-6989586621679349823"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1081"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679349825"><span class="annot"><span class="annottext">Id' Hash
</span><a href="#local-6989586621679349825"><span class="hs-identifier hs-var">rid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1082"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679349826"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679349826"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349827"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679349827"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; Id' Hash -&gt; Transaction (Term Symbol Ann, Type Symbol Ann)
forall (m :: * -&gt; *) v a.
HasCallStack =&gt;
Codebase m v a -&gt; Id' Hash -&gt; Transaction (Term v a, Type v a)
</span><span class="hs-identifier hs-var">Codebase.unsafeGetTermWithType</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349820"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id' Hash
</span><a href="#local-6989586621679349825"><span class="hs-identifier hs-var">rid</span></a></span><span>
</span><span id="line-1083"></span><span>    </span><span class="annot"><span class="annottext">DisplayObject (Type Symbol Ann) (Term Symbol Ann)
-&gt; Transaction (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
forall a. a -&gt; Transaction a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679349826"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1084"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Term.Ann'</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
-&gt; DisplayObject (Type Symbol Ann) (Term Symbol Ann)
forall b a. a -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">UserObject</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679349826"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-1085"></span><span>      </span><span class="hs-comment">-- manually annotate if necessary</span><span>
</span><span id="line-1086"></span><span>      </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
-&gt; DisplayObject (Type Symbol Ann) (Term Symbol Ann)
forall b a. a -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">UserObject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann -&gt; Term Symbol Ann -&gt; Type Symbol Ann -&gt; Term Symbol Ann
forall v a vt at ap.
Ord v =&gt;
a -&gt; Term2 vt at ap v a -&gt; Type vt at -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term Symbol Ann -&gt; Ann
forall (f :: * -&gt; *) v a. Term f v a -&gt; a
</span><span class="hs-identifier hs-var">ABT.annotation</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679349826"><span class="hs-identifier hs-var">term</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679349826"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679349827"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1087"></span><span>
</span><span id="line-1088"></span><span id="local-6989586621679347855"><span class="annot"><a href="Unison.Server.Backend.html#displayType"><span class="hs-identifier hs-type">displayType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679347855"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DD.Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-1089"></span><span id="displayType"><span class="annot"><span class="annottext">displayType :: forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; TypeReference
-&gt; Transaction (DisplayObject () (Decl Symbol Ann))
</span><a href="Unison.Server.Backend.html#displayType"><span class="hs-identifier hs-var hs-var">displayType</span></a></span></span><span> </span><span id="local-6989586621679349836"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349836"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1090"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference.Builtin</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
-&gt; Transaction (DisplayObject () (Decl Symbol Ann))
forall a. a -&gt; Transaction a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; DisplayObject () (Decl Symbol Ann)
forall b a. b -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">BuiltinObject</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1091"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679349837"><span class="annot"><span class="annottext">Id' Hash
</span><a href="#local-6989586621679349837"><span class="hs-identifier hs-var">rid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1092"></span><span>    </span><span id="local-6989586621679349838"><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679349838"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann -&gt; Id' Hash -&gt; Transaction (Decl Symbol Ann)
forall (m :: * -&gt; *) v a.
HasCallStack =&gt;
Codebase m v a -&gt; Id' Hash -&gt; Transaction (Decl v a)
</span><span class="hs-identifier hs-var">Codebase.unsafeGetTypeDeclaration</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349836"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id' Hash
</span><a href="#local-6989586621679349837"><span class="hs-identifier hs-var">rid</span></a></span><span>
</span><span id="line-1093"></span><span>    </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Decl Symbol Ann -&gt; DisplayObject () (Decl Symbol Ann)
forall b a. a -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">UserObject</span></span><span> </span><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679349838"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1094"></span><span>
</span><span id="line-1095"></span><span class="hs-comment">-- | Version of 'termsToSyntax' which works over arbitrary traversals.</span><span>
</span><span id="line-1096"></span><span class="hs-comment">--</span><span>
</span><span id="line-1097"></span><span class="hs-comment">-- E.g.</span><span>
</span><span id="line-1098"></span><span class="hs-comment">-- @@</span><span>
</span><span id="line-1099"></span><span class="hs-comment">-- termsToSyntaxOf suff width pped traversed [(ref, dispObj)]</span><span>
</span><span id="line-1100"></span><span class="hs-comment">--</span><span>
</span><span id="line-1101"></span><span class="hs-comment">-- or</span><span>
</span><span id="line-1102"></span><span class="hs-comment">--</span><span>
</span><span id="line-1103"></span><span class="hs-comment">-- termsToSyntaxOf suff width pped id (ref, dispObj)</span><span>
</span><span id="line-1104"></span><span class="hs-comment">--</span><span>
</span><span id="line-1105"></span><span class="hs-comment">-- or</span><span>
</span><span id="line-1106"></span><span class="hs-comment">--</span><span>
</span><span id="line-1107"></span><span class="hs-comment">-- termsToSyntaxOf suff width pped Map.asList_ (Map.singleton ref dispObj)</span><span>
</span><span id="line-1108"></span><span class="hs-comment">-- @@</span><span>
</span><span id="line-1109"></span><span class="hs-comment">-- e.g. 'traversed'</span><span>
</span><span id="line-1110"></span><span id="local-6989586621679347880"><span id="local-6989586621679347881"><span id="local-6989586621679347883"><span id="local-6989586621679347884"><span class="annot"><a href="Unison.Server.Backend.html#termsToSyntaxOf"><span class="hs-identifier hs-type">termsToSyntaxOf</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1111"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679347880"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1112"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679347881"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1113"></span><span>  </span><span class="annot"><a href="Unison.Server.Types.html#Suffixify"><span class="hs-identifier hs-type">Suffixify</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1114"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1115"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1116"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Traversal</span></span><span> </span><span class="annot"><a href="#local-6989586621679347883"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347884"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679347880"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347881"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><a href="#local-6989586621679347880"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347881"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1117"></span><span>  </span><span class="annot"><a href="#local-6989586621679347883"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1118"></span><span>  </span><span class="annot"><a href="#local-6989586621679347884"><span class="hs-identifier hs-type">t</span></a></span></span></span></span></span><span>
</span><span id="line-1119"></span><span id="termsToSyntaxOf"><span class="annot"><span class="annottext">termsToSyntaxOf :: forall v a s t.
(Var v, Ord a) =&gt;
Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; Traversal
     s
     t
     (TypeReference, DisplayObject (Type v a) (Term v a))
     (TypeReference, DisplayObject SyntaxText SyntaxText)
-&gt; s
-&gt; t
</span><a href="Unison.Server.Backend.html#termsToSyntaxOf"><span class="hs-identifier hs-var hs-var">termsToSyntaxOf</span></a></span></span><span> </span><span id="local-6989586621679349848"><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621679349848"><span class="hs-identifier hs-var">suff</span></a></span></span><span> </span><span id="local-6989586621679349849"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349849"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621679349850"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349850"><span class="hs-identifier hs-var">ppe0</span></a></span></span><span> </span><span id="local-6989586621679349851"><span class="annot"><span class="annottext">Traversal
  s
  t
  (TypeReference, DisplayObject (Type v a) (Term v a))
  (TypeReference, DisplayObject SyntaxText SyntaxText)
</span><a href="#local-6989586621679349851"><span class="hs-identifier hs-var">trav</span></a></span></span><span> </span><span id="local-6989586621679349852"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679349852"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1120"></span><span>  </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679349852"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; (s -&gt; t) -&gt; t
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  s
  t
  [(TypeReference, DisplayObject (Type v a) (Term v a))]
  [(TypeReference, DisplayObject SyntaxText SyntaxText)]
-&gt; ([(TypeReference, DisplayObject (Type v a) (Term v a))]
    -&gt; [(TypeReference, DisplayObject SyntaxText SyntaxText)])
-&gt; s
-&gt; t
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Traversing
  (-&gt;)
  Identity
  s
  t
  (TypeReference, DisplayObject (Type v a) (Term v a))
  (TypeReference, DisplayObject SyntaxText SyntaxText)
-&gt; ASetter
     s
     t
     [(TypeReference, DisplayObject (Type v a) (Term v a))]
     [(TypeReference, DisplayObject SyntaxText SyntaxText)]
forall (f :: * -&gt; *) s t a b.
Functor f =&gt;
Traversing (-&gt;) f s t a b -&gt; LensLike f s t [a] [b]
</span><span class="hs-identifier hs-var">unsafePartsOf</span></span><span> </span><span class="annot"><span class="annottext">Traversing
  (-&gt;)
  Identity
  s
  t
  (TypeReference, DisplayObject (Type v a) (Term v a))
  (TypeReference, DisplayObject SyntaxText SyntaxText)
Traversal
  s
  t
  (TypeReference, DisplayObject (Type v a) (Term v a))
  (TypeReference, DisplayObject SyntaxText SyntaxText)
</span><a href="#local-6989586621679349851"><span class="hs-identifier hs-var">trav</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679349854"><span class="annot"><span class="annottext">[(TypeReference, DisplayObject (Type v a) (Term v a))]
</span><a href="#local-6989586621679349854"><span class="hs-identifier hs-var">displayObjs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; [(TypeReference, DisplayObject (Type v a) (Term v a))]
-&gt; [(TypeReference, DisplayObject SyntaxText SyntaxText)]
forall v a.
(Var v, Ord a) =&gt;
Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; [(TypeReference, DisplayObject (Type v a) (Term v a))]
-&gt; [(TypeReference, DisplayObject SyntaxText SyntaxText)]
</span><a href="Unison.Server.Backend.html#termsToSyntax"><span class="hs-identifier hs-var">termsToSyntax</span></a></span><span> </span><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621679349848"><span class="hs-identifier hs-var">suff</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349849"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349850"><span class="hs-identifier hs-var">ppe0</span></a></span><span> </span><span class="annot"><span class="annottext">[(TypeReference, DisplayObject (Type v a) (Term v a))]
</span><a href="#local-6989586621679349854"><span class="hs-identifier hs-var">displayObjs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1121"></span><span>
</span><span id="line-1122"></span><span class="annot"><span class="hs-comment">-- | Converts Type Display Objects into Syntax Text.</span></span><span>
</span><span id="line-1123"></span><span id="local-6989586621679347902"><span id="local-6989586621679347903"><span class="annot"><a href="Unison.Server.Backend.html#termsToSyntax"><span class="hs-identifier hs-type">termsToSyntax</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1124"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679347902"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1125"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679347903"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1126"></span><span>  </span><span class="annot"><a href="Unison.Server.Types.html#Suffixify"><span class="hs-identifier hs-type">Suffixify</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1127"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1128"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1129"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679347902"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347903"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><a href="#local-6989586621679347902"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347903"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1130"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span><span>
</span><span id="line-1131"></span><span id="termsToSyntax"><span class="annot"><span class="annottext">termsToSyntax :: forall v a.
(Var v, Ord a) =&gt;
Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; [(TypeReference, DisplayObject (Type v a) (Term v a))]
-&gt; [(TypeReference, DisplayObject SyntaxText SyntaxText)]
</span><a href="Unison.Server.Backend.html#termsToSyntax"><span class="hs-identifier hs-var hs-var">termsToSyntax</span></a></span></span><span> </span><span id="local-6989586621679349862"><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621679349862"><span class="hs-identifier hs-var">suff</span></a></span></span><span> </span><span id="local-6989586621679349863"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349863"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621679349864"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349864"><span class="hs-identifier hs-var">ppe0</span></a></span></span><span> </span><span id="local-6989586621679349865"><span class="annot"><span class="annottext">[(TypeReference, DisplayObject (Type v a) (Term v a))]
</span><a href="#local-6989586621679349865"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1132"></span><span>  </span><span class="annot"><span class="annottext">[(TypeReference, DisplayObject (Type v a) (Term v a))]
</span><a href="#local-6989586621679349865"><span class="hs-identifier hs-var">terms</span></a></span><span>
</span><span id="line-1133"></span><span>    </span><span class="annot"><span class="annottext">[(TypeReference, DisplayObject (Type v a) (Term v a))]
-&gt; ((TypeReference, DisplayObject (Type v a) (Term v a))
    -&gt; (TypeReference, DisplayObject SyntaxText SyntaxText))
-&gt; [(TypeReference, DisplayObject SyntaxText SyntaxText)]
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679349866"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349866"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349867"><span class="annot"><span class="annottext">DisplayObject (Type v a) (Term v a)
</span><a href="#local-6989586621679349867"><span class="hs-identifier hs-var">dispObj</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1134"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349868"><span class="annot"><span class="annottext">n :: HashQualified Name
</span><a href="#local-6989586621679349868"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Referent -&gt; HashQualified Name
</span><span class="hs-identifier hs-var">PPE.termName</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349870"><span class="hs-identifier hs-var">ppeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; HashQualified Name)
-&gt; (TypeReference -&gt; Referent)
-&gt; TypeReference
-&gt; HashQualified Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">(TypeReference -&gt; HashQualified Name)
-&gt; TypeReference -&gt; HashQualified Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349866"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1135"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349866"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DisplayObject (Type v a) (Term v a)
</span><a href="#local-6989586621679349867"><span class="hs-identifier hs-var">dispObj</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1136"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject.BuiltinObject</span></span><span> </span><span id="local-6989586621679349871"><span class="annot"><span class="annottext">Type v a
</span><a href="#local-6989586621679349871"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1137"></span><span>              </span><span class="annot"><span class="annottext">SyntaxText -&gt; DisplayObject SyntaxText SyntaxText
forall b a. b -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">DisplayObject.BuiltinObject</span></span><span> </span><span class="annot"><span class="annottext">(SyntaxText -&gt; DisplayObject SyntaxText SyntaxText)
-&gt; SyntaxText -&gt; DisplayObject SyntaxText SyntaxText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1138"></span><span>                </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Width -&gt; Type v a -&gt; SyntaxText
forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Width -&gt; Type v a -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatType%27"><span class="hs-identifier hs-var">formatType'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference -&gt; PrettyPrintEnv
</span><a href="#local-6989586621679349872"><span class="hs-identifier hs-var">ppeBody</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349866"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349863"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Type v a
</span><a href="#local-6989586621679349871"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-1139"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject.MissingObject</span></span><span> </span><span id="local-6989586621679349873"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679349873"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; DisplayObject SyntaxText SyntaxText
forall b a. ShortHash -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">DisplayObject.MissingObject</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679349873"><span class="hs-identifier hs-var">sh</span></a></span><span>
</span><span id="line-1140"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject.UserObject</span></span><span> </span><span id="local-6989586621679349874"><span class="annot"><span class="annottext">Term v a
</span><a href="#local-6989586621679349874"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1141"></span><span>              </span><span class="annot"><span class="annottext">SyntaxText -&gt; DisplayObject SyntaxText SyntaxText
forall b a. a -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">DisplayObject.UserObject</span></span><span>
</span><span id="line-1142"></span><span>                </span><span class="annot"><span class="annottext">(SyntaxText -&gt; DisplayObject SyntaxText SyntaxText)
-&gt; (Pretty SyntaxText -&gt; SyntaxText)
-&gt; Pretty SyntaxText
-&gt; DisplayObject SyntaxText SyntaxText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty SyntaxText -&gt; SyntaxText
forall s. (Monoid s, IsString s) =&gt; Width -&gt; Pretty s -&gt; s
</span><span class="hs-identifier hs-var">Pretty.render</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349863"><span class="hs-identifier hs-var">width</span></a></span><span>
</span><span id="line-1143"></span><span>                </span><span class="annot"><span class="annottext">(Pretty SyntaxText -&gt; DisplayObject SyntaxText SyntaxText)
-&gt; Pretty SyntaxText -&gt; DisplayObject SyntaxText SyntaxText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
-&gt; HashQualified Name -&gt; Term v a -&gt; Pretty SyntaxText
forall v at ap a.
Var v =&gt;
PrettyPrintEnv
-&gt; HashQualified Name -&gt; Term2 v at ap v a -&gt; Pretty SyntaxText
</span><span class="hs-identifier hs-var">TermPrinter.prettyBinding</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference -&gt; PrettyPrintEnv
</span><a href="#local-6989586621679349872"><span class="hs-identifier hs-var">ppeBody</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349866"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679349868"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Term v a
</span><a href="#local-6989586621679349874"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-1144"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1145"></span><span>    </span><span id="local-6989586621679349872"><span class="annot"><span class="annottext">ppeBody :: TypeReference -&gt; PrettyPrintEnv
</span><a href="#local-6989586621679349872"><span class="hs-identifier hs-var hs-var">ppeBody</span></a></span></span><span> </span><span id="local-6989586621679349876"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349876"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1146"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Suffixify -&gt; Bool
</span><a href="Unison.Server.Types.html#%24sel%3Asuffixified%3ASuffixify"><span class="hs-identifier hs-var">suffixified</span></a></span><span> </span><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621679349862"><span class="hs-identifier hs-var">suff</span></a></span><span>
</span><span id="line-1147"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349864"><span class="hs-identifier hs-var">ppe0</span></a></span><span>
</span><span id="line-1148"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; TypeReference -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPE.declarationPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349864"><span class="hs-identifier hs-var">ppe0</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349876"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1149"></span><span>    </span><span id="local-6989586621679349870"><span class="annot"><span class="annottext">ppeDecl :: PrettyPrintEnv
</span><a href="#local-6989586621679349870"><span class="hs-identifier hs-var hs-var">ppeDecl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1150"></span><span>      </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Suffixify -&gt; Bool
</span><a href="Unison.Server.Types.html#%24sel%3Asuffixified%3ASuffixify"><span class="hs-identifier hs-var">suffixified</span></a></span><span> </span><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621679349862"><span class="hs-identifier hs-var">suff</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.unsuffixifiedPPE</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349864"><span class="hs-identifier hs-var">ppe0</span></a></span><span>
</span><span id="line-1151"></span><span>
</span><span id="line-1152"></span><span class="hs-comment">-- | Version of 'typesToSyntax' which works over arbitrary traversals.</span><span>
</span><span id="line-1153"></span><span class="hs-comment">--</span><span>
</span><span id="line-1154"></span><span class="hs-comment">-- E.g.</span><span>
</span><span id="line-1155"></span><span class="hs-comment">-- @@</span><span>
</span><span id="line-1156"></span><span class="hs-comment">-- typesToSyntaxOf suff width pped traversed [(ref, dispObj)]</span><span>
</span><span id="line-1157"></span><span class="hs-comment">--</span><span>
</span><span id="line-1158"></span><span class="hs-comment">-- or</span><span>
</span><span id="line-1159"></span><span class="hs-comment">--</span><span>
</span><span id="line-1160"></span><span class="hs-comment">-- typesToSyntaxOf suff width pped id (ref, dispObj)</span><span>
</span><span id="line-1161"></span><span class="hs-comment">--</span><span>
</span><span id="line-1162"></span><span class="hs-comment">-- or</span><span>
</span><span id="line-1163"></span><span class="hs-comment">--</span><span>
</span><span id="line-1164"></span><span class="hs-comment">-- typesToSyntaxOf suff width pped Map.asList_ (Map.singleton ref dispObj)</span><span>
</span><span id="line-1165"></span><span class="hs-comment">-- @@</span><span>
</span><span id="line-1166"></span><span id="local-6989586621679347910"><span id="local-6989586621679347911"><span id="local-6989586621679347912"><span id="local-6989586621679347913"><span class="annot"><a href="Unison.Server.Backend.html#typesToSyntaxOf"><span class="hs-identifier hs-type">typesToSyntaxOf</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1167"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679347910"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1168"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679347911"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1169"></span><span>  </span><span class="annot"><a href="Unison.Server.Types.html#Suffixify"><span class="hs-identifier hs-type">Suffixify</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1170"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1171"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1172"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Traversal</span></span><span> </span><span class="annot"><a href="#local-6989586621679347912"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347913"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DD.Decl</span></span><span> </span><span class="annot"><a href="#local-6989586621679347910"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347911"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1173"></span><span>  </span><span class="annot"><a href="#local-6989586621679347912"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1174"></span><span>  </span><span class="annot"><a href="#local-6989586621679347913"><span class="hs-identifier hs-type">t</span></a></span></span></span></span></span><span>
</span><span id="line-1175"></span><span id="typesToSyntaxOf"><span class="annot"><span class="annottext">typesToSyntaxOf :: forall v a s t.
(Var v, Ord a) =&gt;
Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; Traversal
     s
     t
     (TypeReference, DisplayObject () (Decl v a))
     (TypeReference, DisplayObject SyntaxText SyntaxText)
-&gt; s
-&gt; t
</span><a href="Unison.Server.Backend.html#typesToSyntaxOf"><span class="hs-identifier hs-var hs-var">typesToSyntaxOf</span></a></span></span><span> </span><span id="local-6989586621679349885"><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621679349885"><span class="hs-identifier hs-var">suff</span></a></span></span><span> </span><span id="local-6989586621679349886"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349886"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621679349887"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349887"><span class="hs-identifier hs-var">ppe0</span></a></span></span><span> </span><span id="local-6989586621679349888"><span class="annot"><span class="annottext">Traversal
  s
  t
  (TypeReference, DisplayObject () (Decl v a))
  (TypeReference, DisplayObject SyntaxText SyntaxText)
</span><a href="#local-6989586621679349888"><span class="hs-identifier hs-var">trav</span></a></span></span><span> </span><span id="local-6989586621679349889"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679349889"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1176"></span><span>  </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679349889"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; (s -&gt; t) -&gt; t
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  s
  t
  [(TypeReference, DisplayObject () (Decl v a))]
  [(TypeReference, DisplayObject SyntaxText SyntaxText)]
-&gt; ([(TypeReference, DisplayObject () (Decl v a))]
    -&gt; [(TypeReference, DisplayObject SyntaxText SyntaxText)])
-&gt; s
-&gt; t
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Traversing
  (-&gt;)
  Identity
  s
  t
  (TypeReference, DisplayObject () (Decl v a))
  (TypeReference, DisplayObject SyntaxText SyntaxText)
-&gt; ASetter
     s
     t
     [(TypeReference, DisplayObject () (Decl v a))]
     [(TypeReference, DisplayObject SyntaxText SyntaxText)]
forall (f :: * -&gt; *) s t a b.
Functor f =&gt;
Traversing (-&gt;) f s t a b -&gt; LensLike f s t [a] [b]
</span><span class="hs-identifier hs-var">unsafePartsOf</span></span><span> </span><span class="annot"><span class="annottext">Traversing
  (-&gt;)
  Identity
  s
  t
  (TypeReference, DisplayObject () (Decl v a))
  (TypeReference, DisplayObject SyntaxText SyntaxText)
Traversal
  s
  t
  (TypeReference, DisplayObject () (Decl v a))
  (TypeReference, DisplayObject SyntaxText SyntaxText)
</span><a href="#local-6989586621679349888"><span class="hs-identifier hs-var">trav</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; [(TypeReference, DisplayObject () (Decl v a))]
-&gt; [(TypeReference, DisplayObject SyntaxText SyntaxText)]
forall v a.
(Var v, Ord a) =&gt;
Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; [(TypeReference, DisplayObject () (Decl v a))]
-&gt; [(TypeReference, DisplayObject SyntaxText SyntaxText)]
</span><a href="Unison.Server.Backend.html#typesToSyntax"><span class="hs-identifier hs-var">typesToSyntax</span></a></span><span> </span><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621679349885"><span class="hs-identifier hs-var">suff</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349886"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349887"><span class="hs-identifier hs-var">ppe0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1177"></span><span>
</span><span id="line-1178"></span><span class="annot"><span class="hs-comment">-- | Converts Type Display Objects into Syntax Text.</span></span><span>
</span><span id="line-1179"></span><span id="local-6989586621679347918"><span id="local-6989586621679347919"><span class="annot"><a href="Unison.Server.Backend.html#typesToSyntax"><span class="hs-identifier hs-type">typesToSyntax</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1180"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679347918"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1181"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679347919"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1182"></span><span>  </span><span class="annot"><a href="Unison.Server.Types.html#Suffixify"><span class="hs-identifier hs-type">Suffixify</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1183"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1184"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1185"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DD.Decl</span></span><span> </span><span class="annot"><a href="#local-6989586621679347918"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347919"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1186"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span></span></span><span>
</span><span id="line-1187"></span><span id="typesToSyntax"><span class="annot"><span class="annottext">typesToSyntax :: forall v a.
(Var v, Ord a) =&gt;
Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; [(TypeReference, DisplayObject () (Decl v a))]
-&gt; [(TypeReference, DisplayObject SyntaxText SyntaxText)]
</span><a href="Unison.Server.Backend.html#typesToSyntax"><span class="hs-identifier hs-var hs-var">typesToSyntax</span></a></span></span><span> </span><span id="local-6989586621679349896"><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621679349896"><span class="hs-identifier hs-var">suff</span></a></span></span><span> </span><span id="local-6989586621679349897"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349897"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621679349898"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349898"><span class="hs-identifier hs-var">ppe0</span></a></span></span><span> </span><span id="local-6989586621679349899"><span class="annot"><span class="annottext">[(TypeReference, DisplayObject () (Decl v a))]
</span><a href="#local-6989586621679349899"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1188"></span><span>  </span><span class="annot"><span class="annottext">[(TypeReference, DisplayObject () (Decl v a))]
</span><a href="#local-6989586621679349899"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-1189"></span><span>    </span><span class="annot"><span class="annottext">[(TypeReference, DisplayObject () (Decl v a))]
-&gt; ((TypeReference, DisplayObject () (Decl v a))
    -&gt; (TypeReference, DisplayObject SyntaxText SyntaxText))
-&gt; [(TypeReference, DisplayObject SyntaxText SyntaxText)]
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679349900"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349900"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679349901"><span class="annot"><span class="annottext">DisplayObject () (Decl v a)
</span><a href="#local-6989586621679349901"><span class="hs-identifier hs-var">dispObj</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1190"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349902"><span class="annot"><span class="annottext">n :: HashQualified Name
</span><a href="#local-6989586621679349902"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; TypeReference -&gt; HashQualified Name
</span><span class="hs-identifier hs-var">PPE.typeName</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349903"><span class="hs-identifier hs-var">ppeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349900"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1191"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349900"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DisplayObject SyntaxText SyntaxText
 -&gt; (TypeReference, DisplayObject SyntaxText SyntaxText))
-&gt; DisplayObject SyntaxText SyntaxText
-&gt; (TypeReference, DisplayObject SyntaxText SyntaxText)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DisplayObject () (Decl v a)
</span><a href="#local-6989586621679349901"><span class="hs-identifier hs-var">dispObj</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1192"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">BuiltinObject</span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SyntaxText -&gt; DisplayObject SyntaxText SyntaxText
forall b a. b -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">BuiltinObject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; TypeReference -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatTypeName%27"><span class="hs-identifier hs-var">formatTypeName'</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679349903"><span class="hs-identifier hs-var">ppeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349900"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1193"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">MissingObject</span></span><span> </span><span id="local-6989586621679349904"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679349904"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; DisplayObject SyntaxText SyntaxText
forall b a. ShortHash -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">MissingObject</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679349904"><span class="hs-identifier hs-var">sh</span></a></span><span>
</span><span id="line-1194"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">UserObject</span></span><span> </span><span id="local-6989586621679349905"><span class="annot"><span class="annottext">Decl v a
</span><a href="#local-6989586621679349905"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1195"></span><span>              </span><span class="annot"><span class="annottext">SyntaxText -&gt; DisplayObject SyntaxText SyntaxText
forall b a. a -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">UserObject</span></span><span> </span><span class="annot"><span class="annottext">(SyntaxText -&gt; DisplayObject SyntaxText SyntaxText)
-&gt; (Pretty SyntaxText -&gt; SyntaxText)
-&gt; Pretty SyntaxText
-&gt; DisplayObject SyntaxText SyntaxText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty SyntaxText -&gt; SyntaxText
forall s. (Monoid s, IsString s) =&gt; Width -&gt; Pretty s -&gt; s
</span><span class="hs-identifier hs-var">Pretty.render</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349897"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">(Pretty SyntaxText -&gt; DisplayObject SyntaxText SyntaxText)
-&gt; Pretty SyntaxText -&gt; DisplayObject SyntaxText SyntaxText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1196"></span><span>                </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
-&gt; TypeReference
-&gt; HashQualified Name
-&gt; Decl v a
-&gt; Pretty SyntaxText
forall v a.
Var v =&gt;
PrettyPrintEnvDecl
-&gt; TypeReference
-&gt; HashQualified Name
-&gt; Decl v a
-&gt; Pretty SyntaxText
</span><span class="hs-identifier hs-var">DeclPrinter.prettyDecl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; TypeReference -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPE.declarationPPEDecl</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349898"><span class="hs-identifier hs-var">ppe0</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349900"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349900"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679349902"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Decl v a
</span><a href="#local-6989586621679349905"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1197"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1198"></span><span>    </span><span id="local-6989586621679349903"><span class="annot"><span class="annottext">ppeDecl :: PrettyPrintEnv
</span><a href="#local-6989586621679349903"><span class="hs-identifier hs-var hs-var">ppeDecl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1199"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Suffixify -&gt; Bool
</span><a href="Unison.Server.Types.html#%24sel%3Asuffixified%3ASuffixify"><span class="hs-identifier hs-var">suffixified</span></a></span><span> </span><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621679349896"><span class="hs-identifier hs-var">suff</span></a></span><span>
</span><span id="line-1200"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349898"><span class="hs-identifier hs-var">ppe0</span></a></span><span>
</span><span id="line-1201"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPED.unsuffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679349898"><span class="hs-identifier hs-var">ppe0</span></a></span><span>
</span><span id="line-1202"></span><span>
</span><span id="line-1203"></span><span class="hs-comment">-- | Renders a type to its decl header, e.g.</span><span>
</span><span id="line-1204"></span><span class="hs-comment">--</span><span>
</span><span id="line-1205"></span><span class="hs-comment">-- Effect:</span><span>
</span><span id="line-1206"></span><span class="hs-comment">--</span><span>
</span><span id="line-1207"></span><span class="hs-comment">-- unique ability Stream s</span><span>
</span><span id="line-1208"></span><span class="hs-comment">--</span><span>
</span><span id="line-1209"></span><span class="hs-comment">-- Data:</span><span>
</span><span id="line-1210"></span><span class="hs-comment">--</span><span>
</span><span id="line-1211"></span><span class="hs-comment">-- structural type Maybe a</span><span>
</span><span id="line-1212"></span><span class="annot"><a href="Unison.Server.Backend.html#typeToSyntaxHeader"><span class="hs-identifier hs-type">typeToSyntaxHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1213"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Width</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1214"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1215"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DD.Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1216"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span>
</span><span id="line-1217"></span><span id="typeToSyntaxHeader"><span class="annot"><span class="annottext">typeToSyntaxHeader :: Width
-&gt; HashQualified Name
-&gt; DisplayObject () (Decl Symbol Ann)
-&gt; DisplayObject SyntaxText SyntaxText
</span><a href="Unison.Server.Backend.html#typeToSyntaxHeader"><span class="hs-identifier hs-var hs-var">typeToSyntaxHeader</span></a></span></span><span> </span><span id="local-6989586621679349908"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349908"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621679349909"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679349909"><span class="hs-identifier hs-var">hqName</span></a></span></span><span> </span><span id="local-6989586621679349910"><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
</span><a href="#local-6989586621679349910"><span class="hs-identifier hs-var">obj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1218"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
</span><a href="#local-6989586621679349910"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1219"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">BuiltinObject</span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1220"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679349911"><span class="annot"><span class="annottext">syntaxName :: SyntaxText
</span><a href="#local-6989586621679349911"><span class="hs-identifier hs-var hs-var">syntaxName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pretty SyntaxText -&gt; SyntaxText
forall s. (Monoid s, IsString s) =&gt; Pretty s -&gt; s
</span><span class="hs-identifier hs-var">Pretty.renderUnbroken</span></span><span> </span><span class="annot"><span class="annottext">(Pretty SyntaxText -&gt; SyntaxText)
-&gt; (HashQualified Name -&gt; Pretty SyntaxText)
-&gt; HashQualified Name
-&gt; SyntaxText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Pretty SyntaxText -&gt; Pretty SyntaxText)
-&gt; HashQualified Name -&gt; Pretty SyntaxText
forall s.
IsString s =&gt;
(Pretty s -&gt; Pretty s) -&gt; HashQualified Name -&gt; Pretty s
</span><span class="hs-identifier hs-var">NP.styleHashQualified</span></span><span> </span><span class="annot"><span class="annottext">Pretty SyntaxText -&gt; Pretty SyntaxText
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; SyntaxText)
-&gt; HashQualified Name -&gt; SyntaxText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679349909"><span class="hs-identifier hs-var">hqName</span></a></span><span>
</span><span id="line-1221"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SyntaxText -&gt; DisplayObject SyntaxText SyntaxText
forall b a. b -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">BuiltinObject</span></span><span> </span><span class="annot"><span class="annottext">SyntaxText
</span><a href="#local-6989586621679349911"><span class="hs-identifier hs-var">syntaxName</span></a></span><span>
</span><span id="line-1222"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MissingObject</span></span><span> </span><span id="local-6989586621679349912"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679349912"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; DisplayObject SyntaxText SyntaxText
forall b a. ShortHash -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">MissingObject</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679349912"><span class="hs-identifier hs-var">sh</span></a></span><span>
</span><span id="line-1223"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">UserObject</span></span><span> </span><span id="local-6989586621679349913"><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679349913"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1224"></span><span>      </span><span class="annot"><span class="annottext">SyntaxText -&gt; DisplayObject SyntaxText SyntaxText
forall b a. a -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">UserObject</span></span><span> </span><span class="annot"><span class="annottext">(SyntaxText -&gt; DisplayObject SyntaxText SyntaxText)
-&gt; (Pretty SyntaxText -&gt; SyntaxText)
-&gt; Pretty SyntaxText
-&gt; DisplayObject SyntaxText SyntaxText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty SyntaxText -&gt; SyntaxText
forall s. (Monoid s, IsString s) =&gt; Width -&gt; Pretty s -&gt; s
</span><span class="hs-identifier hs-var">Pretty.render</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621679349908"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">(Pretty SyntaxText -&gt; DisplayObject SyntaxText SyntaxText)
-&gt; Pretty SyntaxText -&gt; DisplayObject SyntaxText SyntaxText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1225"></span><span>        </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Decl Symbol Ann -&gt; Pretty SyntaxText
forall v a.
Var v =&gt;
HashQualified Name
-&gt; Either (EffectDeclaration v a) (DataDeclaration v a)
-&gt; Pretty SyntaxText
</span><span class="hs-identifier hs-var">DeclPrinter.prettyDeclHeader</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679349909"><span class="hs-identifier hs-var">hqName</span></a></span><span> </span><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679349913"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1226"></span><span>
</span><span id="line-1227"></span><span id="local-6989586621679347924"><span class="annot"><a href="Unison.Server.Backend.html#loadSearchResults"><span class="hs-identifier hs-type">loadSearchResults</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1228"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679347924"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1229"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.SearchResult.html#SearchResult"><span class="hs-identifier hs-type">SR.SearchResult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1230"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.SearchResultPrime.html#SearchResult%27"><span class="hs-identifier hs-type">SR'.SearchResult'</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-1231"></span><span id="loadSearchResults"><span class="annot"><span class="annottext">loadSearchResults :: forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; [SearchResult] -&gt; Transaction [SearchResult' Symbol Ann]
</span><a href="Unison.Server.Backend.html#loadSearchResults"><span class="hs-identifier hs-var hs-var">loadSearchResults</span></a></span></span><span> </span><span id="local-6989586621679349918"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349918"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SearchResult -&gt; Transaction (SearchResult' Symbol Ann))
-&gt; [SearchResult] -&gt; Transaction [SearchResult' Symbol Ann]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">SearchResult -&gt; Transaction (SearchResult' Symbol Ann)
</span><a href="#local-6989586621679349919"><span class="hs-identifier hs-var">loadSearchResult</span></a></span><span>
</span><span id="line-1232"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1233"></span><span>    </span><span id="local-6989586621679349919"><span class="annot"><span class="annottext">loadSearchResult :: SearchResult -&gt; Transaction (SearchResult' Symbol Ann)
</span><a href="#local-6989586621679349919"><span class="hs-identifier hs-var hs-var">loadSearchResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1234"></span><span>      </span><span class="annot"><a href="Unison.Server.SearchResult.html#Tm"><span class="hs-identifier hs-type">SR.Tm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.SearchResult.html#TermResult"><span class="hs-identifier hs-type">SR.TermResult</span></a></span><span> </span><span id="local-6989586621679349922"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679349922"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679349923"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349923"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679349924"><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679349924"><span class="hs-identifier hs-var">aliases</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1235"></span><span>        </span><span id="local-6989586621679349925"><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679349925"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; Referent -&gt; Transaction (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; Referent -&gt; Transaction (Maybe (Type Symbol Ann))
</span><a href="Unison.Server.Backend.html#loadReferentType"><span class="hs-identifier hs-var">loadReferentType</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349918"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349923"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1236"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
-&gt; Maybe (Type Symbol Ann)
-&gt; Referent
-&gt; Set (HashQualified Name)
-&gt; SearchResult' Symbol Ann
forall v a.
HashQualified Name
-&gt; Maybe (Type v a)
-&gt; Referent
-&gt; Set (HashQualified Name)
-&gt; SearchResult' v a
</span><a href="Unison.Server.SearchResultPrime.html#Tm"><span class="hs-identifier hs-var">SR'.Tm</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679349922"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679349925"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679349923"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679349924"><span class="hs-identifier hs-var">aliases</span></a></span><span>
</span><span id="line-1237"></span><span>      </span><span class="annot"><a href="Unison.Server.SearchResult.html#Tp"><span class="hs-identifier hs-type">SR.Tp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.SearchResult.html#TypeResult"><span class="hs-identifier hs-type">SR.TypeResult</span></a></span><span> </span><span id="local-6989586621679349929"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679349929"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679349930"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349930"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679349931"><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679349931"><span class="hs-identifier hs-var">aliases</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1238"></span><span>        </span><span id="local-6989586621679349932"><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
</span><a href="#local-6989586621679349932"><span class="hs-identifier hs-var">dt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
-&gt; TypeReference
-&gt; Transaction (DisplayObject () (Decl Symbol Ann))
forall (m :: * -&gt; *) v.
Codebase m v Ann
-&gt; TypeReference -&gt; Transaction (DisplayObject () (Decl v Ann))
</span><a href="Unison.Server.Backend.html#loadTypeDisplayObject"><span class="hs-identifier hs-var">loadTypeDisplayObject</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679349918"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349930"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1239"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
-&gt; DisplayObject () (Decl Symbol Ann)
-&gt; TypeReference
-&gt; Set (HashQualified Name)
-&gt; SearchResult' Symbol Ann
forall v a.
HashQualified Name
-&gt; DisplayObject () (Decl v a)
-&gt; TypeReference
-&gt; Set (HashQualified Name)
-&gt; SearchResult' v a
</span><a href="Unison.Server.SearchResultPrime.html#Tp"><span class="hs-identifier hs-var">SR'.Tp</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679349929"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
</span><a href="#local-6989586621679349932"><span class="hs-identifier hs-var">dt</span></a></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679349930"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679349931"><span class="hs-identifier hs-var">aliases</span></a></span><span>
</span><span id="line-1240"></span><span>
</span><span id="line-1241"></span><span id="local-6989586621679347931"><span id="local-6989586621679347932"><span class="annot"><a href="Unison.Server.Backend.html#loadTypeDisplayObject"><span class="hs-identifier hs-type">loadTypeDisplayObject</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1242"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679347931"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679347932"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1243"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1244"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DD.Decl</span></span><span> </span><span class="annot"><a href="#local-6989586621679347932"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1245"></span><span id="loadTypeDisplayObject"><span class="annot"><span class="annottext">loadTypeDisplayObject :: forall (m :: * -&gt; *) v.
Codebase m v Ann
-&gt; TypeReference -&gt; Transaction (DisplayObject () (Decl v Ann))
</span><a href="Unison.Server.Backend.html#loadTypeDisplayObject"><span class="hs-identifier hs-var hs-var">loadTypeDisplayObject</span></a></span></span><span> </span><span id="local-6989586621679349937"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679349937"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1246"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference.Builtin</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DisplayObject () (Decl v Ann)
-&gt; Transaction (DisplayObject () (Decl v Ann))
forall a. a -&gt; Transaction a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; DisplayObject () (Decl v Ann)
forall b a. b -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">BuiltinObject</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1247"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679349938"><span class="annot"><span class="annottext">Id' Hash
</span><a href="#local-6989586621679349938"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1248"></span><span>    </span><span class="annot"><span class="annottext">DisplayObject () (Decl v Ann)
-&gt; (Decl v Ann -&gt; DisplayObject () (Decl v Ann))
-&gt; Maybe (Decl v Ann)
-&gt; DisplayObject () (Decl v Ann)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortHash -&gt; DisplayObject () (Decl v Ann)
forall b a. ShortHash -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">MissingObject</span></span><span> </span><span class="annot"><span class="annottext">(ShortHash -&gt; DisplayObject () (Decl v Ann))
-&gt; ShortHash -&gt; DisplayObject () (Decl v Ann)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Id' Hash -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.idToShortHash</span></span><span> </span><span class="annot"><span class="annottext">Id' Hash
</span><a href="#local-6989586621679349938"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Decl v Ann -&gt; DisplayObject () (Decl v Ann)
forall b a. a -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">UserObject</span></span><span>
</span><span id="line-1249"></span><span>      </span><span class="annot"><span class="annottext">(Maybe (Decl v Ann) -&gt; DisplayObject () (Decl v Ann))
-&gt; Transaction (Maybe (Decl v Ann))
-&gt; Transaction (DisplayObject () (Decl v Ann))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; Id' Hash -&gt; Transaction (Maybe (Decl v Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id' Hash -&gt; Transaction (Maybe (Decl v a))
</span><span class="hs-identifier hs-var">Codebase.getTypeDeclaration</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679349937"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Id' Hash
</span><a href="#local-6989586621679349938"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1250"></span></pre></body></html>