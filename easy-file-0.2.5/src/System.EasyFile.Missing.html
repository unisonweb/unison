<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System.EasyFile.Missing</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">----------------------------------------------------------------</span><span class="hs-cpp">

#if !MIN_VERSION_base(4,8,0)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Applicative</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Time</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Time.Clock.POSIX</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Word64</span></span><span class="hs-special">)</span><span class="hs-cpp">
#if defined(mingw32_HOST_OS) || defined(__MINGW32__)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Exception</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.Win32.File</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.Win32.Time</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.Win32.Types</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HANDLE</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Posix.Files</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Posix.Types</span></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-23"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="annot"><span class="hs-comment">{-|
  This function tells whether or not a file\/directory is symbolic
  link.
-}</span></span><span>
</span><span id="line-29"></span><span class="annot"><a href="System.EasyFile.Missing.html#isSymlink"><span class="hs-identifier hs-type">isSymlink</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-cpp">
#if defined(mingw32_HOST_OS) || defined(__MINGW32__)
</span><span class="hs-identifier">isSymlink</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">False</span><span class="hs-cpp">
#else
</span><span id="isSymlink"><span class="annot"><span class="annottext">isSymlink :: FilePath -&gt; IO Bool
</span><a href="System.EasyFile.Missing.html#isSymlink"><span class="hs-identifier hs-var hs-var">isSymlink</span></a></span></span><span> </span><span id="local-6989586621679041764"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679041764"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FileStatus -&gt; Bool
</span><span class="hs-identifier hs-var">isSymbolicLink</span></span><span> </span><span class="annot"><span class="annottext">(FileStatus -&gt; Bool) -&gt; IO FileStatus -&gt; IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO FileStatus
</span><span class="hs-identifier hs-var">getSymbolicLinkStatus</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679041764"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-36"></span><span class="annot"><span class="hs-comment">{-|
  This function returns the link counter of a file\/directory.
-}</span></span><span>
</span><span id="line-39"></span><span class="annot"><a href="System.EasyFile.Missing.html#getLinkCount"><span class="hs-identifier hs-type">getLinkCount</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-cpp">
#if defined(mingw32_HOST_OS) || defined(__MINGW32__)
</span><span class="hs-identifier">getLinkCount</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span class="hs-cpp">
#else
</span><span id="getLinkCount"><span class="annot"><span class="annottext">getLinkCount :: FilePath -&gt; IO (Maybe Int)
</span><a href="System.EasyFile.Missing.html#getLinkCount"><span class="hs-identifier hs-var hs-var">getLinkCount</span></a></span></span><span> </span><span id="local-6989586621679041769"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679041769"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Maybe Int)
-&gt; (FileStatus -&gt; Int) -&gt; FileStatus -&gt; Maybe Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LinkCount -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(LinkCount -&gt; Int)
-&gt; (FileStatus -&gt; LinkCount) -&gt; FileStatus -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FileStatus -&gt; LinkCount
</span><span class="hs-identifier hs-var">linkCount</span></span><span> </span><span class="annot"><span class="annottext">(FileStatus -&gt; Maybe Int) -&gt; IO FileStatus -&gt; IO (Maybe Int)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO FileStatus
</span><span class="hs-identifier hs-var">getFileStatus</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679041769"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-46"></span><span class="annot"><span class="hs-comment">{-|
  This function returns whether or not a directory has sub-directories.
-}</span></span><span>
</span><span id="line-49"></span><span class="annot"><a href="System.EasyFile.Missing.html#hasSubDirectories"><span class="hs-identifier hs-type">hasSubDirectories</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-cpp">
#ifdef darwin_HOST_OS
</span><span class="hs-identifier">hasSubDirectories</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span class="hs-cpp">
#else
</span><span id="hasSubDirectories"><span class="annot"><span class="annottext">hasSubDirectories :: FilePath -&gt; IO (Maybe Bool)
</span><a href="System.EasyFile.Missing.html#hasSubDirectories"><span class="hs-identifier hs-var hs-var">hasSubDirectories</span></a></span></span><span> </span><span id="local-6989586621679041774"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679041774"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679041775"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679041775"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe Int)
</span><a href="System.EasyFile.Missing.html#getLinkCount"><span class="hs-identifier hs-var">getLinkCount</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679041774"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><span class="annottext">Maybe Bool -&gt; IO (Maybe Bool)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Bool -&gt; IO (Maybe Bool)) -&gt; Maybe Bool -&gt; IO (Maybe Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679041775"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-58"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="annot"><span class="hs-comment">{-|
The 'getCreationTime' operation returns the
UTC time at which the file or directory was created.
The time is only available on Windows.
-}</span></span><span>
</span><span id="line-65"></span><span class="annot"><a href="System.EasyFile.Missing.html#getCreationTime"><span class="hs-identifier hs-type">getCreationTime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span class="hs-special">)</span><span class="hs-cpp">
#if defined(mingw32_HOST_OS) || defined(__MINGW32__)
</span><span class="hs-identifier">getCreationTime</span><span> </span><span class="hs-identifier">file</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">creationTime</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">fileTime</span><span> </span><span class="hs-identifier">file</span><span class="hs-cpp">
#else
</span><span id="getCreationTime"><span class="annot"><span class="annottext">getCreationTime :: FilePath -&gt; IO (Maybe UTCTime)
</span><a href="System.EasyFile.Missing.html#getCreationTime"><span class="hs-identifier hs-var hs-var">getCreationTime</span></a></span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime -&gt; IO (Maybe UTCTime)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-72"></span><span class="annot"><span class="hs-comment">{-|
The 'getChangeTime' operation returns the
UTC time at which the file or directory was changed.
The time is only available on Unix and Mac.
Note that Unix's rename() does not change ctime but
MacOS's rename() does.
-}</span></span><span>
</span><span id="line-79"></span><span class="annot"><a href="System.EasyFile.Missing.html#getChangeTime"><span class="hs-identifier hs-type">getChangeTime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span class="hs-special">)</span><span class="hs-cpp">
#if defined(mingw32_HOST_OS) || defined(__MINGW32__)
</span><span class="hs-identifier">getChangeTime</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span class="hs-cpp">
#else
</span><span id="getChangeTime"><span class="annot"><span class="annottext">getChangeTime :: FilePath -&gt; IO (Maybe UTCTime)
</span><a href="System.EasyFile.Missing.html#getChangeTime"><span class="hs-identifier hs-var hs-var">getChangeTime</span></a></span></span><span> </span><span id="local-6989586621679041779"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679041779"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; Maybe UTCTime
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(UTCTime -&gt; Maybe UTCTime)
-&gt; (FileStatus -&gt; UTCTime) -&gt; FileStatus -&gt; Maybe UTCTime
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EpochTime -&gt; UTCTime
</span><a href="System.EasyFile.Missing.html#epochTimeToUTCTime"><span class="hs-identifier hs-var">epochTimeToUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">(EpochTime -&gt; UTCTime)
-&gt; (FileStatus -&gt; EpochTime) -&gt; FileStatus -&gt; UTCTime
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FileStatus -&gt; EpochTime
</span><span class="hs-identifier hs-var">statusChangeTime</span></span><span> </span><span class="annot"><span class="annottext">(FileStatus -&gt; Maybe UTCTime)
-&gt; IO FileStatus -&gt; IO (Maybe UTCTime)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO FileStatus
</span><span class="hs-identifier hs-var">getFileStatus</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679041779"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-86"></span><span class="annot"><span class="hs-comment">{-|
The 'getModificationTime' operation returns the
UTC time at which the file or directory was last modified.

The operation may fail with:

* 'isPermissionError' if the user is not permitted to access
  the modification time; or

* 'isDoesNotExistError' if the file or directory does not exist.

-}</span></span><span>
</span><span id="line-98"></span><span class="annot"><a href="System.EasyFile.Missing.html#getModificationTime"><span class="hs-identifier hs-type">getModificationTime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span class="hs-cpp">
#if defined(mingw32_HOST_OS) || defined(__MINGW32__)
</span><span class="hs-identifier">getModificationTime</span><span> </span><span class="hs-identifier">file</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">writeTime</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">fileTime</span><span> </span><span class="hs-identifier">file</span><span class="hs-cpp">
#else
</span><span id="getModificationTime"><span class="annot"><span class="annottext">getModificationTime :: FilePath -&gt; IO UTCTime
</span><a href="System.EasyFile.Missing.html#getModificationTime"><span class="hs-identifier hs-var hs-var">getModificationTime</span></a></span></span><span> </span><span id="local-6989586621679041783"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679041783"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochTime -&gt; UTCTime
</span><a href="System.EasyFile.Missing.html#epochTimeToUTCTime"><span class="hs-identifier hs-var">epochTimeToUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">(EpochTime -&gt; UTCTime)
-&gt; (FileStatus -&gt; EpochTime) -&gt; FileStatus -&gt; UTCTime
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FileStatus -&gt; EpochTime
</span><span class="hs-identifier hs-var">modificationTime</span></span><span> </span><span class="annot"><span class="annottext">(FileStatus -&gt; UTCTime) -&gt; IO FileStatus -&gt; IO UTCTime
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO FileStatus
</span><span class="hs-identifier hs-var">getFileStatus</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679041783"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-105"></span><span class="hs-comment">{-
  http://msdn.microsoft.com/en-us/library/ms724290%28VS.85%29.aspx
  The NTFS file system delays updates to the last access time for
  a file by up to 1 hour after the last access.
-}</span><span>
</span><span id="line-110"></span><span class="annot"><span class="hs-comment">{-|
The 'getModificationTime' operation returns the
UTC time at which the file or directory was last accessed.
-}</span></span><span>
</span><span id="line-114"></span><span class="annot"><a href="System.EasyFile.Missing.html#getAccessTime"><span class="hs-identifier hs-type">getAccessTime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span class="hs-cpp">
#if defined(mingw32_HOST_OS) || defined(__MINGW32__)
</span><span class="hs-identifier">getAccessTime</span><span> </span><span class="hs-identifier">file</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">accessTime</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">fileTime</span><span> </span><span class="hs-identifier">file</span><span class="hs-cpp">
#else
</span><span id="getAccessTime"><span class="annot"><span class="annottext">getAccessTime :: FilePath -&gt; IO UTCTime
</span><a href="System.EasyFile.Missing.html#getAccessTime"><span class="hs-identifier hs-var hs-var">getAccessTime</span></a></span></span><span> </span><span id="local-6989586621679041786"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679041786"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochTime -&gt; UTCTime
</span><a href="System.EasyFile.Missing.html#epochTimeToUTCTime"><span class="hs-identifier hs-var">epochTimeToUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">(EpochTime -&gt; UTCTime)
-&gt; (FileStatus -&gt; EpochTime) -&gt; FileStatus -&gt; UTCTime
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FileStatus -&gt; EpochTime
</span><span class="hs-identifier hs-var">accessTime</span></span><span> </span><span class="annot"><span class="annottext">(FileStatus -&gt; UTCTime) -&gt; IO FileStatus -&gt; IO UTCTime
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO FileStatus
</span><span class="hs-identifier hs-var">getFileStatus</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679041786"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-121"></span><span class="hs-comment">----------------------------------------------------------------</span><span class="hs-cpp">

#if defined(mingw32_HOST_OS) || defined(__MINGW32__)
</span><span class="hs-comment">-- Open a file or directory for getting the file metadata.</span><span>
</span><span id="line-125"></span><span class="hs-identifier">withFileForInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HANDLE</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">a</span><span>
</span><span id="line-126"></span><span class="hs-identifier">withFileForInfo</span><span> </span><span class="hs-identifier">file</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">bracket</span><span> </span><span class="hs-identifier">setup</span><span> </span><span class="hs-identifier">teardown</span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-identifier">setup</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">createFile</span><span> </span><span class="hs-identifier">file</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier">fILE_SHARE_READ</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><span id="line-129"></span><span>                       </span><span class="hs-identifier">oPEN_EXISTING</span><span> </span><span class="hs-identifier">fILE_FLAG_BACKUP_SEMANTICS</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-identifier">teardown</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">closeHandle</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">
#if defined(mingw32_HOST_OS) || defined(__MINGW32__)
</span><span class="hs-identifier">creationTime</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UTCTime</span><span class="hs-special">,</span><span class="hs-identifier">UTCTime</span><span class="hs-special">,</span><span class="hs-identifier">UTCTime</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">UTCTime</span><span>
</span><span id="line-135"></span><span class="hs-identifier">creationTime</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ctime</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ctime</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-identifier">accessTime</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UTCTime</span><span class="hs-special">,</span><span class="hs-identifier">UTCTime</span><span class="hs-special">,</span><span class="hs-identifier">UTCTime</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">UTCTime</span><span>
</span><span id="line-138"></span><span class="hs-identifier">accessTime</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">atime</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">atime</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-identifier">writeTime</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UTCTime</span><span class="hs-special">,</span><span class="hs-identifier">UTCTime</span><span class="hs-special">,</span><span class="hs-identifier">UTCTime</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">UTCTime</span><span>
</span><span id="line-141"></span><span class="hs-identifier">writeTime</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">wtime</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">wtime</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-identifier">fileTime</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UTCTime</span><span class="hs-special">,</span><span class="hs-identifier">UTCTime</span><span class="hs-special">,</span><span class="hs-identifier">UTCTime</span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span class="hs-identifier">fileTime</span><span> </span><span class="hs-identifier">file</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withFileForInfo</span><span> </span><span class="hs-identifier">file</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">fh</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-special">(</span><span class="hs-identifier">ctime</span><span class="hs-special">,</span><span class="hs-identifier">atime</span><span class="hs-special">,</span><span class="hs-identifier">mtime</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getFileTime</span><span> </span><span class="hs-identifier">fh</span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">filetimeToUTCTime</span><span> </span><span class="hs-identifier">ctime</span><span>
</span><span id="line-147"></span><span>         </span><span class="hs-special">,</span><span class="hs-identifier">filetimeToUTCTime</span><span> </span><span class="hs-identifier">atime</span><span>
</span><span id="line-148"></span><span>         </span><span class="hs-special">,</span><span class="hs-identifier">filetimeToUTCTime</span><span> </span><span class="hs-identifier">mtime</span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-comment">{-
  http://support.microsoft.com/kb/167296/en-us
  100 nano seconds since 1 Jan 1601
  MS: _FILETIME = {DWORD,DWORD} = {Word32,Word32}
  Haskell: FILETIME == DDWORD == Word64
-}</span><span>
</span><span id="line-156"></span><span class="hs-identifier">filetimeToUTCTime</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">FILETIME</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">UTCTime</span><span>
</span><span id="line-157"></span><span class="hs-identifier">filetimeToUTCTime</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">FILETIME</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">posixSecondsToUTCTime</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">realToFrac</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">tm</span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-identifier">tm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Integer</span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-identifier">tm</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">116444736000000000</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">10000000</span><span class="hs-cpp">
#else
</span><span class="annot"><a href="System.EasyFile.Missing.html#epochTimeToUTCTime"><span class="hs-identifier hs-type">epochTimeToUTCTime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochTime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span>
</span><span id="line-163"></span><span id="epochTimeToUTCTime"><span class="annot"><span class="annottext">epochTimeToUTCTime :: EpochTime -&gt; UTCTime
</span><a href="System.EasyFile.Missing.html#epochTimeToUTCTime"><span class="hs-identifier hs-var hs-var">epochTimeToUTCTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; UTCTime
</span><span class="hs-identifier hs-var">posixSecondsToUTCTime</span></span><span> </span><span class="annot"><span class="annottext">(POSIXTime -&gt; UTCTime)
-&gt; (EpochTime -&gt; POSIXTime) -&gt; EpochTime -&gt; UTCTime
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EpochTime -&gt; POSIXTime
forall a b. (Real a, Fractional b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">realToFrac</span></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-166"></span><span class="hs-comment">-- | Getting the size of the file.</span><span>
</span><span id="line-167"></span><span class="hs-comment">--</span><span>
</span><span id="line-168"></span><span class="hs-comment">--   Since: 0.2.0.</span><span>
</span><span id="line-169"></span><span class="annot"><a href="System.EasyFile.Missing.html#getFileSize"><span class="hs-identifier hs-type">getFileSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span class="hs-cpp">
#if defined(mingw32_HOST_OS) || defined(__MINGW32__)
</span><span class="hs-identifier">getFileSize</span><span> </span><span class="hs-identifier">file</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withFileForInfo</span><span> </span><span class="hs-identifier">file</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">fh</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">bhfiSize</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">getFileInformationByHandle</span><span> </span><span class="hs-identifier">fh</span><span class="hs-cpp">
#else
</span><span id="getFileSize"><span class="annot"><span class="annottext">getFileSize :: FilePath -&gt; IO Word64
</span><a href="System.EasyFile.Missing.html#getFileSize"><span class="hs-identifier hs-var hs-var">getFileSize</span></a></span></span><span> </span><span id="local-6989586621679041790"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679041790"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FileOffset -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(FileOffset -&gt; Word64)
-&gt; (FileStatus -&gt; FileOffset) -&gt; FileStatus -&gt; Word64
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FileStatus -&gt; FileOffset
</span><span class="hs-identifier hs-var">fileSize</span></span><span> </span><span class="annot"><span class="annottext">(FileStatus -&gt; Word64) -&gt; IO FileStatus -&gt; IO Word64
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO FileStatus
</span><span class="hs-identifier hs-var">getFileStatus</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679041790"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- | Setting the size of the file.</span><span>
</span><span id="line-178"></span><span class="hs-comment">--</span><span>
</span><span id="line-179"></span><span class="hs-comment">--   Since: 0.2.4.</span><span>
</span><span id="line-180"></span><span class="annot"><a href="System.EasyFile.Missing.html#setFileSize"><span class="hs-identifier hs-type">setFileSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">
#if (defined(mingw32_HOST_OS) || defined(__MINGW32__))
</span><span class="hs-cpp"># if MIN_VERSION_Win32(2, 6, 2)
</span><span class="hs-identifier">setFileSize</span><span> </span><span class="hs-identifier">file</span><span> </span><span class="hs-identifier">siz</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-identifier">hdl</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">createFile</span><span> </span><span class="hs-identifier">file</span><span> </span><span class="hs-identifier">gENERIC_WRITE</span><span> </span><span class="hs-identifier">fILE_SHARE_NONE</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-identifier">oPEN_EXISTING</span><span> </span><span class="hs-identifier">fILE_ATTRIBUTE_NORMAL</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">setFilePointerEx</span><span> </span><span class="hs-identifier">hdl</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">siz</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">fILE_CURRENT</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-identifier">setEndOfFile</span><span> </span><span class="hs-identifier">hdl</span><span class="hs-cpp">
# else
</span><span class="hs-identifier">setFileSize</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-string">&quot;GHC 8.10.5 or earlier does not provide setFilePointerEx&quot;</span><span class="hs-cpp">
# endif
</span><span class="hs-cpp">#else
</span><span id="setFileSize"><span class="annot"><span class="annottext">setFileSize :: FilePath -&gt; Word64 -&gt; IO ()
</span><a href="System.EasyFile.Missing.html#setFileSize"><span class="hs-identifier hs-var hs-var">setFileSize</span></a></span></span><span> </span><span id="local-6989586621679041793"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679041793"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621679041794"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679041794"><span class="hs-identifier hs-var">siz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FileOffset -&gt; IO ()
</span><span class="hs-identifier hs-var">P.setFileSize</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679041793"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">(FileOffset -&gt; IO ()) -&gt; FileOffset -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; FileOffset
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679041794"><span class="hs-identifier hs-var">siz</span></a></span><span class="hs-cpp">
#endif
</span></pre></body></html>