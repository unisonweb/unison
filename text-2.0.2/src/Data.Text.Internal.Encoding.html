<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns, CPP, GeneralizedNewtypeDeriving, MagicHash,
    UnliftedFFITypes #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE Trustworthy #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Module      : Data.Text.Internal.Builder</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- License     : BSD-style (see LICENSE)</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- Stability   : experimental</span><span>
</span><span id="line-12"></span><span class="hs-comment">--</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- /Warning/: this is an internal module, and does not have a stable</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- API or name. Functions in this module may not check or enforce</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- preconditions expected by public modules. Use at your own risk!</span><span>
</span><span id="line-16"></span><span class="hs-comment">--</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- Internals of &quot;Data.Text.Encoding&quot;.</span><span>
</span><span id="line-18"></span><span class="hs-comment">--</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- @since 2.0.2</span><span>
</span><span id="line-20"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.Text.Internal.Encoding</span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#validateUtf8Chunk"><span class="hs-identifier">validateUtf8Chunk</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#validateUtf8More"><span class="hs-identifier">validateUtf8More</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#decodeUtf8Chunk"><span class="hs-identifier">decodeUtf8Chunk</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#decodeUtf8More"><span class="hs-identifier">decodeUtf8More</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#decodeUtf8With1"><span class="hs-identifier">decodeUtf8With1</span></a></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#decodeUtf8With2"><span class="hs-identifier">decodeUtf8With2</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier">Utf8State</span></a></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#startUtf8State"><span class="hs-identifier">startUtf8State</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Text.Internal.StrictBuilder.html#StrictBuilder"><span class="hs-identifier">StrictBuilder</span></a></span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#strictBuilderToText"><span class="hs-identifier">strictBuilderToText</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#textToStrictBuilder"><span class="hs-identifier">textToStrictBuilder</span></a></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Internal</span></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#skipIncomplete"><span class="hs-identifier">skipIncomplete</span></a></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#getCompleteLen"><span class="hs-identifier">getCompleteLen</span></a></span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#getPartialUtf8"><span class="hs-identifier">getPartialUtf8</span></a></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">

#if defined(ASSERTS)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Exception</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">assert</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Bits.html#/Data.Bits.html"><span class="hs-identifier">Data.Bits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator">(.&amp;.)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Bits.html#shiftL/GHC.Bits.html#shiftL"><span class="hs-identifier">shiftL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Bits.html#shiftR/GHC.Bits.html#shiftR"><span class="hs-identifier">shiftR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#/Data.ByteString.html"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../bytestring-0.11.5.3/src/Data.ByteString.Internal.Type.html#ByteString/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier">ByteString</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#if !MIN_VERSION_base(4,11,0)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Semigroup</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Semigroup</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Word.html#/Data.Word.html"><span class="hs-identifier">Data.Word</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word32/GHC.Word.html#Word32"><span class="hs-identifier">Word32</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word8/GHC.Word.html#Word8"><span class="hs-identifier">Word8</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Foreign.Storable.html#/Foreign.Storable.html"><span class="hs-identifier">Foreign.Storable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/Foreign.Storable.html#pokeElemOff/Foreign.Storable.html#pokeElemOff"><span class="hs-identifier">pokeElemOff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Text.Encoding.Error.html"><span class="hs-identifier">Data.Text.Encoding.Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Text.Encoding.Error.html#OnDecodeError"><span class="hs-identifier">OnDecodeError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Text.Internal.html"><span class="hs-identifier">Data.Text.Internal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Text.Internal.html#Text"><span class="hs-identifier">Text</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.Utf8.html"><span class="hs-identifier">Data.Text.Internal.Encoding.Utf8</span></a></span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Data.Text.Internal.Encoding.Utf8.html#DecoderState"><span class="hs-identifier">DecoderState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.Utf8.html#utf8AcceptState"><span class="hs-identifier">utf8AcceptState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.Utf8.html#utf8RejectState"><span class="hs-identifier">utf8RejectState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.Utf8.html#updateDecoderState"><span class="hs-identifier">updateDecoderState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Text.Internal.StrictBuilder.html"><span class="hs-identifier">Data.Text.Internal.StrictBuilder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Text.Internal.StrictBuilder.html#StrictBuilder"><span class="hs-identifier">StrictBuilder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#/Data.ByteString.html"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.3/src/Data.ByteString.Internal.html#/Data.ByteString.Internal.html"><span class="hs-identifier">Data.ByteString.Internal</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BI</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.3/src/Data.ByteString.Short.Internal.html#/Data.ByteString.Short.Internal.html"><span class="hs-identifier">Data.ByteString.Short.Internal</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SBS</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.Text.Array.html"><span class="hs-identifier">Data.Text.Array</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.Text.Internal.StrictBuilder.html"><span class="hs-identifier">Data.Text.Internal.StrictBuilder</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SB</span></span><span class="hs-cpp">
#if defined(ASSERTS)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Stack</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HasCallStack</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">
#ifdef SIMDUTF
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Text.Internal.ByteStringCompat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">withBS</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Text.Internal.Unsafe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeWithForeignPtr</span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Text.Unsafe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeDupablePerformIO</span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign.C.Types</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">CSize</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign.C.Types</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">CInt</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign.Ptr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- | Use 'StrictBuilder' to build 'Text'.</span><span>
</span><span id="line-73"></span><span class="hs-comment">--</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- @since 2.0.2</span><span>
</span><span id="line-75"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#strictBuilderToText"><span class="hs-identifier hs-type">strictBuilderToText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Text.Internal.StrictBuilder.html#StrictBuilder"><span class="hs-identifier hs-type">StrictBuilder</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-76"></span><span id="strictBuilderToText"><span class="annot"><span class="annottext">strictBuilderToText :: StrictBuilder -&gt; Text
</span><a href="Data.Text.Internal.Encoding.html#strictBuilderToText"><span class="hs-identifier hs-var hs-var">strictBuilderToText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StrictBuilder -&gt; Text
</span><a href="Data.Text.Internal.StrictBuilder.html#toText"><span class="hs-identifier hs-var">SB.toText</span></a></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-comment">-- | Copy 'Text' in a 'StrictBuilder'</span><span>
</span><span id="line-79"></span><span class="hs-comment">--</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- @since 2.0.2</span><span>
</span><span id="line-81"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#textToStrictBuilder"><span class="hs-identifier hs-type">textToStrictBuilder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Text.Internal.StrictBuilder.html#StrictBuilder"><span class="hs-identifier hs-type">StrictBuilder</span></a></span><span>
</span><span id="line-82"></span><span id="textToStrictBuilder"><span class="annot"><span class="annottext">textToStrictBuilder :: Text -&gt; StrictBuilder
</span><a href="Data.Text.Internal.Encoding.html#textToStrictBuilder"><span class="hs-identifier hs-var hs-var">textToStrictBuilder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; StrictBuilder
</span><a href="Data.Text.Internal.StrictBuilder.html#fromText"><span class="hs-identifier hs-var">SB.fromText</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-comment">-- | State of decoding a 'ByteString' in UTF-8.</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- Enables incremental decoding ('validateUtf8Chunk', 'validateUtf8More',</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- 'decodeUtf8Chunk', 'decodeUtf8More').</span><span>
</span><span id="line-87"></span><span class="hs-comment">--</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- @since 2.0.2</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">-- Internal invariant:</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- the first component is the initial state if and only if</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- the second component is empty.</span><span>
</span><span id="line-93"></span><span class="hs-comment">--</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- 'utf9CodePointState' s = 'utf8StartState'</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- &lt;=&gt;</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- 'partialUtf8CodePoint' s = 'PartialUtf8CodePoint' 0</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-99"></span><span class="hs-keyword">data</span><span> </span><span id="Utf8State"><span class="annot"><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-var">Utf8State</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Utf8State"><span class="annot"><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-var">Utf8State</span></a></span></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-comment">-- | State of the UTF-8 state machine.</span></span><span>
</span><span id="line-101"></span><span>    </span><span id="utf8CodePointState"><span class="annot"><span class="annottext">Utf8State -&gt; DecoderState
</span><a href="Data.Text.Internal.Encoding.html#utf8CodePointState"><span class="hs-identifier hs-var hs-var">utf8CodePointState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Data.Text.Internal.Encoding.Utf8.html#DecoderState"><span class="hs-identifier hs-type">DecoderState</span></a></span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Bytes of the currently incomplete code point (if any).</span></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="partialUtf8CodePoint"><span class="annot"><span class="annottext">Utf8State -&gt; PartialUtf8CodePoint
</span><a href="Data.Text.Internal.Encoding.html#partialUtf8CodePoint"><span class="hs-identifier hs-var hs-var">partialUtf8CodePoint</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Data.Text.Internal.Encoding.html#PartialUtf8CodePoint"><span class="hs-identifier hs-type">PartialUtf8CodePoint</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679126509"><span id="local-6989586621679126515"><span class="annot"><span class="annottext">Utf8State -&gt; Utf8State -&gt; Bool
(Utf8State -&gt; Utf8State -&gt; Bool)
-&gt; (Utf8State -&gt; Utf8State -&gt; Bool) -&gt; Eq Utf8State
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Utf8State -&gt; Utf8State -&gt; Bool
== :: Utf8State -&gt; Utf8State -&gt; Bool
$c/= :: Utf8State -&gt; Utf8State -&gt; Bool
/= :: Utf8State -&gt; Utf8State -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#Eq/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679126520"><span id="local-6989586621679126528"><span id="local-6989586621679126532"><span class="annot"><span class="annottext">Int -&gt; Utf8State -&gt; ShowS
[Utf8State] -&gt; ShowS
Utf8State -&gt; String
(Int -&gt; Utf8State -&gt; ShowS)
-&gt; (Utf8State -&gt; String)
-&gt; ([Utf8State] -&gt; ShowS)
-&gt; Show Utf8State
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Utf8State -&gt; ShowS
showsPrec :: Int -&gt; Utf8State -&gt; ShowS
$cshow :: Utf8State -&gt; String
show :: Utf8State -&gt; String
$cshowList :: [Utf8State] -&gt; ShowS
showList :: [Utf8State] -&gt; ShowS
</span><a href="../../base-4.18.2.1/src/GHC.Show.html#Show/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-comment">-- | Initial 'Utf8State'.</span><span>
</span><span id="line-108"></span><span class="hs-comment">--</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- @since 2.0.2</span><span>
</span><span id="line-110"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#startUtf8State"><span class="hs-identifier hs-type">startUtf8State</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-type">Utf8State</span></a></span><span>
</span><span id="line-111"></span><span id="startUtf8State"><span class="annot"><span class="annottext">startUtf8State :: Utf8State
</span><a href="Data.Text.Internal.Encoding.html#startUtf8State"><span class="hs-identifier hs-var hs-var">startUtf8State</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DecoderState -&gt; PartialUtf8CodePoint -&gt; Utf8State
</span><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-var">Utf8State</span></a></span><span> </span><span class="annot"><span class="annottext">DecoderState
</span><a href="Data.Text.Internal.Encoding.Utf8.html#utf8AcceptState"><span class="hs-identifier hs-var">utf8AcceptState</span></a></span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint
</span><a href="Data.Text.Internal.Encoding.html#partUtf8Empty"><span class="hs-identifier hs-var">partUtf8Empty</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-comment">-- | Prefix of a UTF-8 code point encoded in 4 bytes,</span><span>
</span><span id="line-114"></span><span class="hs-comment">-- possibly empty.</span><span>
</span><span id="line-115"></span><span class="hs-comment">--</span><span>
</span><span id="line-116"></span><span class="hs-comment">-- - The most significant byte contains the number of bytes,</span><span>
</span><span id="line-117"></span><span class="hs-comment">--   between 0 and 3.</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- - The remaining bytes hold the incomplete code point.</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- - Unused bytes must be 0.</span><span>
</span><span id="line-120"></span><span class="hs-comment">--</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- All of operations available on it are the functions below.</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- The constructor should never be used outside of those.</span><span>
</span><span id="line-123"></span><span class="hs-comment">--</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- @since 2.0.2</span><span>
</span><span id="line-125"></span><span class="hs-keyword">newtype</span><span> </span><span id="PartialUtf8CodePoint"><span class="annot"><a href="Data.Text.Internal.Encoding.html#PartialUtf8CodePoint"><span class="hs-identifier hs-var">PartialUtf8CodePoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PartialUtf8CodePoint"><span class="annot"><a href="Data.Text.Internal.Encoding.html#PartialUtf8CodePoint"><span class="hs-identifier hs-var">PartialUtf8CodePoint</span></a></span></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word32/GHC.Word.html#Word32"><span class="hs-identifier hs-type">Word32</span></a></span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679126538"><span id="local-6989586621679126543"><span class="annot"><span class="annottext">PartialUtf8CodePoint -&gt; PartialUtf8CodePoint -&gt; Bool
(PartialUtf8CodePoint -&gt; PartialUtf8CodePoint -&gt; Bool)
-&gt; (PartialUtf8CodePoint -&gt; PartialUtf8CodePoint -&gt; Bool)
-&gt; Eq PartialUtf8CodePoint
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: PartialUtf8CodePoint -&gt; PartialUtf8CodePoint -&gt; Bool
== :: PartialUtf8CodePoint -&gt; PartialUtf8CodePoint -&gt; Bool
$c/= :: PartialUtf8CodePoint -&gt; PartialUtf8CodePoint -&gt; Bool
/= :: PartialUtf8CodePoint -&gt; PartialUtf8CodePoint -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#Eq/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679126547"><span id="local-6989586621679126552"><span id="local-6989586621679126555"><span class="annot"><span class="annottext">Int -&gt; PartialUtf8CodePoint -&gt; ShowS
[PartialUtf8CodePoint] -&gt; ShowS
PartialUtf8CodePoint -&gt; String
(Int -&gt; PartialUtf8CodePoint -&gt; ShowS)
-&gt; (PartialUtf8CodePoint -&gt; String)
-&gt; ([PartialUtf8CodePoint] -&gt; ShowS)
-&gt; Show PartialUtf8CodePoint
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; PartialUtf8CodePoint -&gt; ShowS
showsPrec :: Int -&gt; PartialUtf8CodePoint -&gt; ShowS
$cshow :: PartialUtf8CodePoint -&gt; String
show :: PartialUtf8CodePoint -&gt; String
$cshowList :: [PartialUtf8CodePoint] -&gt; ShowS
showList :: [PartialUtf8CodePoint] -&gt; ShowS
</span><a href="../../base-4.18.2.1/src/GHC.Show.html#Show/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="annot"><span class="hs-comment">-- | Empty prefix.</span></span><span>
</span><span id="line-129"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#partUtf8Empty"><span class="hs-identifier hs-type">partUtf8Empty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#PartialUtf8CodePoint"><span class="hs-identifier hs-type">PartialUtf8CodePoint</span></a></span><span>
</span><span id="line-130"></span><span id="partUtf8Empty"><span class="annot"><span class="annottext">partUtf8Empty :: PartialUtf8CodePoint
</span><a href="Data.Text.Internal.Encoding.html#partUtf8Empty"><span class="hs-identifier hs-var hs-var">partUtf8Empty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; PartialUtf8CodePoint
</span><a href="Data.Text.Internal.Encoding.html#PartialUtf8CodePoint"><span class="hs-identifier hs-var">PartialUtf8CodePoint</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="annot"><span class="hs-comment">-- | Length of the partial code point, stored in the most significant byte.</span></span><span>
</span><span id="line-133"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#partUtf8Len"><span class="hs-identifier hs-type">partUtf8Len</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#PartialUtf8CodePoint"><span class="hs-identifier hs-type">PartialUtf8CodePoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#Int/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-134"></span><span id="partUtf8Len"><span class="annot"><span class="annottext">partUtf8Len :: PartialUtf8CodePoint -&gt; Int
</span><a href="Data.Text.Internal.Encoding.html#partUtf8Len"><span class="hs-identifier hs-var hs-var">partUtf8Len</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Text.Internal.Encoding.html#PartialUtf8CodePoint"><span class="hs-identifier hs-type">PartialUtf8CodePoint</span></a></span><span> </span><span id="local-6989586621679126558"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679126558"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Int) -&gt; Word32 -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679126558"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Int -&gt; Word32
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#shiftR/GHC.Bits.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">24</span></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-comment">-- | Length of the code point once completed (it is known in the first byte).</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- 0 if empty.</span><span>
</span><span id="line-138"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#partUtf8CompleteLen"><span class="hs-identifier hs-type">partUtf8CompleteLen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#PartialUtf8CodePoint"><span class="hs-identifier hs-type">PartialUtf8CodePoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#Int/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-139"></span><span id="partUtf8CompleteLen"><span class="annot"><span class="annottext">partUtf8CompleteLen :: PartialUtf8CodePoint -&gt; Int
</span><a href="Data.Text.Internal.Encoding.html#partUtf8CompleteLen"><span class="hs-identifier hs-var hs-var">partUtf8CompleteLen</span></a></span></span><span> </span><span id="local-6989586621679126560"><span class="annot"><span class="annottext">c :: PartialUtf8CodePoint
</span><a href="#local-6989586621679126560"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Data.Text.Internal.Encoding.html#PartialUtf8CodePoint"><span class="hs-identifier hs-type">PartialUtf8CodePoint</span></a></span><span> </span><span id="local-6989586621679126561"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679126561"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint -&gt; Int
</span><a href="Data.Text.Internal.Encoding.html#partUtf8Len"><span class="hs-identifier hs-var">partUtf8Len</span></a></span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint
</span><a href="#local-6989586621679126560"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0xf0</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679126563"><span class="hs-identifier hs-var">firstByte</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0xe0</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679126563"><span class="hs-identifier hs-var">firstByte</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0xc2</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679126563"><span class="hs-identifier hs-var">firstByte</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-146"></span><span>    </span><span id="local-6989586621679126563"><span class="annot"><span class="annottext">firstByte :: Word32
</span><a href="#local-6989586621679126563"><span class="hs-identifier hs-var hs-var">firstByte</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679126561"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Int -&gt; Word32
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#shiftR/GHC.Bits.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">255</span></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-comment">-- | Get the @n@-th byte, assuming it is within bounds: @0 &lt;= n &lt; partUtf8Len c@.</span><span>
</span><span id="line-149"></span><span class="hs-comment">--</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- Unsafe: no bounds checking.</span><span>
</span><span id="line-151"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#partUtf8UnsafeIndex"><span class="hs-identifier hs-type">partUtf8UnsafeIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span class="hs-cpp">
#if defined(ASSERTS)
</span><span>  </span><span class="hs-identifier">HasCallStack</span><span> </span><span class="hs-glyph">=&gt;</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#PartialUtf8CodePoint"><span class="hs-identifier hs-type">PartialUtf8CodePoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#Int/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word8/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span>
</span><span id="line-156"></span><span id="partUtf8UnsafeIndex"><span class="annot"><span class="annottext">partUtf8UnsafeIndex :: PartialUtf8CodePoint -&gt; Int -&gt; Word8
</span><a href="Data.Text.Internal.Encoding.html#partUtf8UnsafeIndex"><span class="hs-identifier hs-var hs-var">partUtf8UnsafeIndex</span></a></span></span><span> </span><span id="local-6989586621679126568"><span class="annot"><span class="annottext">_c :: PartialUtf8CodePoint
</span><a href="#local-6989586621679126568"><span class="hs-identifier hs-var">_c</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Data.Text.Internal.Encoding.html#PartialUtf8CodePoint"><span class="hs-identifier hs-type">PartialUtf8CodePoint</span></a></span><span> </span><span id="local-6989586621679126569"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679126569"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679126570"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126570"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span class="hs-cpp">
#if defined(ASSERTS)
</span><span>  </span><span class="hs-identifier">assert</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span> </span><span class="hs-operator">&lt;=</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-operator">&amp;&amp;</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-operator">&lt;</span><span> </span><span class="hs-identifier">partUtf8Len</span><span> </span><span class="hs-identifier">_c</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><span class="annottext">Word32 -&gt; Word8
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Word8) -&gt; Word32 -&gt; Word8
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679126569"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Int -&gt; Word32
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#shiftR/GHC.Bits.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#-/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2A/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126570"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="hs-comment">-- | Append some bytes.</span><span>
</span><span id="line-163"></span><span class="hs-comment">--</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- Unsafe: no bounds checking.</span><span>
</span><span id="line-165"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#partUtf8UnsafeAppend"><span class="hs-identifier hs-type">partUtf8UnsafeAppend</span></a></span><span> </span><span class="hs-glyph">::</span><span class="hs-cpp">
#if defined(ASSERTS)
</span><span>  </span><span class="hs-identifier">HasCallStack</span><span> </span><span class="hs-glyph">=&gt;</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#PartialUtf8CodePoint"><span class="hs-identifier hs-type">PartialUtf8CodePoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.3/src/Data.ByteString.Internal.Type.html#ByteString/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#PartialUtf8CodePoint"><span class="hs-identifier hs-type">PartialUtf8CodePoint</span></a></span><span>
</span><span id="line-170"></span><span id="partUtf8UnsafeAppend"><span class="annot"><span class="annottext">partUtf8UnsafeAppend :: PartialUtf8CodePoint -&gt; ByteString -&gt; PartialUtf8CodePoint
</span><a href="Data.Text.Internal.Encoding.html#partUtf8UnsafeAppend"><span class="hs-identifier hs-var hs-var">partUtf8UnsafeAppend</span></a></span></span><span> </span><span id="local-6989586621679126573"><span class="annot"><span class="annottext">c :: PartialUtf8CodePoint
</span><a href="#local-6989586621679126573"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Data.Text.Internal.Encoding.html#PartialUtf8CodePoint"><span class="hs-identifier hs-type">PartialUtf8CodePoint</span></a></span><span> </span><span id="local-6989586621679126574"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679126574"><span class="hs-identifier hs-var">word</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679126575"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126575"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span class="hs-cpp">
#if defined(ASSERTS)
</span><span>  </span><span class="hs-identifier">assert</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">lenc</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-identifier">lenbs</span><span> </span><span class="hs-operator">&lt;=</span><span> </span><span class="hs-number">3</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><span class="annottext">Word32 -&gt; PartialUtf8CodePoint
</span><a href="Data.Text.Internal.Encoding.html#PartialUtf8CodePoint"><span class="hs-identifier hs-var">PartialUtf8CodePoint</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; PartialUtf8CodePoint) -&gt; Word32 -&gt; PartialUtf8CodePoint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><span class="annottext">Int -&gt; Word32 -&gt; Word32
forall {a}. (Num a, Bits a) =&gt; Int -&gt; a -&gt; a
</span><a href="#local-6989586621679126576"><span class="hs-identifier hs-var">tryPush</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Word32) -&gt; Word32 -&gt; Word32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word32 -&gt; Word32
forall {a}. (Num a, Bits a) =&gt; Int -&gt; a -&gt; a
</span><a href="#local-6989586621679126576"><span class="hs-identifier hs-var">tryPush</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Word32) -&gt; Word32 -&gt; Word32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word32 -&gt; Word32
forall {a}. (Num a, Bits a) =&gt; Int -&gt; a -&gt; a
</span><a href="#local-6989586621679126576"><span class="hs-identifier hs-var">tryPush</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Word32) -&gt; Word32 -&gt; Word32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679126574"><span class="hs-identifier hs-var">word</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126578"><span class="hs-identifier hs-var">lenbs</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Int -&gt; Word32
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#shiftL/GHC.Bits.html#shiftL"><span class="hs-operator hs-var">`shiftL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">24</span></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-177"></span><span>    </span><span id="local-6989586621679126579"><span class="annot"><span class="annottext">lenc :: Int
</span><a href="#local-6989586621679126579"><span class="hs-identifier hs-var hs-var">lenc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint -&gt; Int
</span><a href="Data.Text.Internal.Encoding.html#partUtf8Len"><span class="hs-identifier hs-var">partUtf8Len</span></a></span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint
</span><a href="#local-6989586621679126573"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span id="local-6989586621679126578"><span class="annot"><span class="annottext">lenbs :: Int
</span><a href="#local-6989586621679126578"><span class="hs-identifier hs-var hs-var">lenbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#length/Data.ByteString.html#length"><span class="hs-identifier hs-var">B.length</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126575"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span id="local-6989586621679126576"><span class="annot"><span class="annottext">tryPush :: Int -&gt; a -&gt; a
</span><a href="#local-6989586621679126576"><span class="hs-identifier hs-var hs-var">tryPush</span></a></span></span><span> </span><span id="local-6989586621679126601"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126601"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679126602"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679126602"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-180"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126601"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3C/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126578"><span class="hs-identifier hs-var">lenbs</span></a></span><span>
</span><span id="line-181"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679126602"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; a
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; ByteString -&gt; Int -&gt; Word8
ByteString -&gt; Int -&gt; Word8
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#index/Data.ByteString.html#index"><span class="hs-identifier hs-var">B.index</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126575"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126601"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; Int -&gt; a
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#shiftL/GHC.Bits.html#shiftL"><span class="hs-operator hs-var">`shiftL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#-/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2A/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126579"><span class="hs-identifier hs-var">lenc</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126601"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679126602"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="annot"><span class="hs-comment">-- | Fold a 'PartialUtf8CodePoint'. This avoids recursion so it can unfold to straightline code.</span></span><span>
</span><span id="line-185"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#partUtf8Foldr"><span class="hs-pragma hs-type">partUtf8Foldr</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-186"></span><span id="local-6989586621679126402"><span class="annot"><a href="Data.Text.Internal.Encoding.html#partUtf8Foldr"><span class="hs-identifier hs-type">partUtf8Foldr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word8/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679126402"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679126402"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679126402"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#PartialUtf8CodePoint"><span class="hs-identifier hs-type">PartialUtf8CodePoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679126402"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-187"></span><span id="partUtf8Foldr"><span class="annot"><span class="annottext">partUtf8Foldr :: forall a. (Word8 -&gt; a -&gt; a) -&gt; a -&gt; PartialUtf8CodePoint -&gt; a
</span><a href="Data.Text.Internal.Encoding.html#partUtf8Foldr"><span class="hs-identifier hs-var hs-var">partUtf8Foldr</span></a></span></span><span> </span><span id="local-6989586621679126612"><span class="annot"><span class="annottext">Word8 -&gt; a -&gt; a
</span><a href="#local-6989586621679126612"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679126613"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679126613"><span class="hs-identifier hs-var">x0</span></a></span></span><span> </span><span id="local-6989586621679126614"><span class="annot"><span class="annottext">PartialUtf8CodePoint
</span><a href="#local-6989586621679126614"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint -&gt; Int
</span><a href="Data.Text.Internal.Encoding.html#partUtf8Len"><span class="hs-identifier hs-var">partUtf8Len</span></a></span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint
</span><a href="#local-6989586621679126614"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679126613"><span class="hs-identifier hs-var">x0</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; a -&gt; a
</span><a href="#local-6989586621679126615"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679126613"><span class="hs-identifier hs-var">x0</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; a -&gt; a
</span><a href="#local-6989586621679126615"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; a -&gt; a
</span><a href="#local-6989586621679126615"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679126613"><span class="hs-identifier hs-var">x0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; a -&gt; a
</span><a href="#local-6989586621679126615"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; a -&gt; a
</span><a href="#local-6989586621679126615"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; a -&gt; a
</span><a href="#local-6989586621679126615"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679126613"><span class="hs-identifier hs-var">x0</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621679126615"><span class="annot"><span class="annottext">build :: Int -&gt; a -&gt; a
</span><a href="#local-6989586621679126615"><span class="hs-identifier hs-var hs-var">build</span></a></span></span><span> </span><span id="local-6989586621679126616"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126616"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679126617"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679126617"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; a -&gt; a
</span><a href="#local-6989586621679126612"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PartialUtf8CodePoint -&gt; Int -&gt; Word8
</span><a href="Data.Text.Internal.Encoding.html#partUtf8UnsafeIndex"><span class="hs-identifier hs-var">partUtf8UnsafeIndex</span></a></span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint
</span><a href="#local-6989586621679126614"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126616"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679126617"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="annot"><span class="hs-comment">-- | Convert 'PartialUtf8CodePoint' to 'ByteString'.</span></span><span>
</span><span id="line-196"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#partUtf8ToByteString"><span class="hs-identifier hs-type">partUtf8ToByteString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#PartialUtf8CodePoint"><span class="hs-identifier hs-type">PartialUtf8CodePoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.3/src/Data.ByteString.Internal.Type.html#ByteString/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">B.ByteString</span></a></span><span>
</span><span id="line-197"></span><span id="partUtf8ToByteString"><span class="annot"><span class="annottext">partUtf8ToByteString :: PartialUtf8CodePoint -&gt; ByteString
</span><a href="Data.Text.Internal.Encoding.html#partUtf8ToByteString"><span class="hs-identifier hs-var hs-var">partUtf8ToByteString</span></a></span></span><span> </span><span id="local-6989586621679126619"><span class="annot"><span class="annottext">PartialUtf8CodePoint
</span><a href="#local-6989586621679126619"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Ptr Word8 -&gt; IO ()) -&gt; ByteString
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.Internal.Type.html#unsafeCreate/Data.ByteString.Internal.Type.html#unsafeCreate"><span class="hs-identifier hs-var">BI.unsafeCreate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PartialUtf8CodePoint -&gt; Int
</span><a href="Data.Text.Internal.Encoding.html#partUtf8Len"><span class="hs-identifier hs-var">partUtf8Len</span></a></span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint
</span><a href="#local-6989586621679126619"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Ptr Word8 -&gt; IO ()) -&gt; ByteString)
-&gt; (Ptr Word8 -&gt; IO ()) -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679126621"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679126621"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-198"></span><span>  </span><span class="annot"><span class="annottext">(Word8 -&gt; (Int -&gt; IO ()) -&gt; Int -&gt; IO ())
-&gt; (Int -&gt; IO ()) -&gt; PartialUtf8CodePoint -&gt; Int -&gt; IO ()
forall a. (Word8 -&gt; a -&gt; a) -&gt; a -&gt; PartialUtf8CodePoint -&gt; a
</span><a href="Data.Text.Internal.Encoding.html#partUtf8Foldr"><span class="hs-identifier hs-var">partUtf8Foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679126622"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679126622"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621679126623"><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="#local-6989586621679126623"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679126624"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126624"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Word8 -&gt; IO ()
forall a. Storable a =&gt; Ptr a -&gt; Int -&gt; a -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/Foreign.Storable.html#pokeElemOff/Foreign.Storable.html#pokeElemOff"><span class="hs-identifier hs-var">pokeElemOff</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679126621"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126624"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679126622"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3E%3E/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="#local-6989586621679126623"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126624"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint
</span><a href="#local-6989586621679126619"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="annot"><span class="hs-comment">-- | Exported for testing.</span></span><span>
</span><span id="line-201"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#getCompleteLen"><span class="hs-identifier hs-type">getCompleteLen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-type">Utf8State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#Int/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-202"></span><span id="getCompleteLen"><span class="annot"><span class="annottext">getCompleteLen :: Utf8State -&gt; Int
</span><a href="Data.Text.Internal.Encoding.html#getCompleteLen"><span class="hs-identifier hs-var hs-var">getCompleteLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint -&gt; Int
</span><a href="Data.Text.Internal.Encoding.html#partUtf8CompleteLen"><span class="hs-identifier hs-var">partUtf8CompleteLen</span></a></span><span> </span><span class="annot"><span class="annottext">(PartialUtf8CodePoint -&gt; Int)
-&gt; (Utf8State -&gt; PartialUtf8CodePoint) -&gt; Utf8State -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State -&gt; PartialUtf8CodePoint
</span><a href="Data.Text.Internal.Encoding.html#partialUtf8CodePoint"><span class="hs-identifier hs-var">partialUtf8CodePoint</span></a></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="annot"><span class="hs-comment">-- | Exported for testing.</span></span><span>
</span><span id="line-205"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#getPartialUtf8"><span class="hs-identifier hs-type">getPartialUtf8</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-type">Utf8State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.3/src/Data.ByteString.Internal.Type.html#ByteString/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">B.ByteString</span></a></span><span>
</span><span id="line-206"></span><span id="getPartialUtf8"><span class="annot"><span class="annottext">getPartialUtf8 :: Utf8State -&gt; ByteString
</span><a href="Data.Text.Internal.Encoding.html#getPartialUtf8"><span class="hs-identifier hs-var hs-var">getPartialUtf8</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint -&gt; ByteString
</span><a href="Data.Text.Internal.Encoding.html#partUtf8ToByteString"><span class="hs-identifier hs-var">partUtf8ToByteString</span></a></span><span> </span><span class="annot"><span class="annottext">(PartialUtf8CodePoint -&gt; ByteString)
-&gt; (Utf8State -&gt; PartialUtf8CodePoint) -&gt; Utf8State -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State -&gt; PartialUtf8CodePoint
</span><a href="Data.Text.Internal.Encoding.html#partialUtf8CodePoint"><span class="hs-identifier hs-var">partialUtf8CodePoint</span></a></span><span class="hs-cpp">

#ifdef SIMDUTF
</span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;_hs_text_is_valid_utf8&quot;</span><span> </span><span class="hs-identifier">c_is_valid_utf8</span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CSize</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- | Validate a 'ByteString' as UTF-8-encoded text. To be continued using 'validateUtf8More'.</span><span>
</span><span id="line-214"></span><span class="hs-comment">--</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- See also 'validateUtf8More' for details on the result of this function.</span><span>
</span><span id="line-216"></span><span class="hs-comment">--</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-218"></span><span class="hs-comment">-- 'validateUtf8Chunk' = 'validateUtf8More' 'startUtf8State'</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-220"></span><span class="hs-comment">--</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- @since 2.0.2</span><span>
</span><span id="line-222"></span><span class="hs-comment">--</span><span>
</span><span id="line-223"></span><span class="hs-comment">-- === Properties</span><span>
</span><span id="line-224"></span><span class="hs-comment">--</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- Given:</span><span>
</span><span id="line-226"></span><span class="hs-comment">--</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- 'validateUtf8Chunk' chunk = (n, ms)</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-230"></span><span class="hs-comment">--</span><span>
</span><span id="line-231"></span><span class="hs-comment">-- - The prefix is valid UTF-8. In particular, it should be accepted</span><span>
</span><span id="line-232"></span><span class="hs-comment">--   by this validation:</span><span>
</span><span id="line-233"></span><span class="hs-comment">--</span><span>
</span><span id="line-234"></span><span class="hs-comment">--     @</span><span>
</span><span id="line-235"></span><span class="hs-comment">--     'validateUtf8Chunk' ('Data.ByteString.take' n chunk) = (n, Just 'startUtf8State')</span><span>
</span><span id="line-236"></span><span class="hs-comment">--     @</span><span>
</span><span id="line-237"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#validateUtf8Chunk"><span class="hs-identifier hs-type">validateUtf8Chunk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.3/src/Data.ByteString.Internal.Type.html#ByteString/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#Int/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-type">Utf8State</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span id="validateUtf8Chunk"><span class="annot"><span class="annottext">validateUtf8Chunk :: ByteString -&gt; (Int, Maybe Utf8State)
</span><a href="Data.Text.Internal.Encoding.html#validateUtf8Chunk"><span class="hs-identifier hs-var hs-var">validateUtf8Chunk</span></a></span></span><span> </span><span id="local-6989586621679126626"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126626"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; ByteString
-&gt; (Int -&gt; Maybe Utf8State -&gt; (Int, Maybe Utf8State))
-&gt; (Int, Maybe Utf8State)
forall r. Int -&gt; ByteString -&gt; (Int -&gt; Maybe Utf8State -&gt; r) -&gt; r
</span><a href="Data.Text.Internal.Encoding.html#validateUtf8ChunkFrom"><span class="hs-identifier hs-var">validateUtf8ChunkFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126626"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span class="hs-comment">-- Assume bytes up to offset @ofs@ have been validated already.</span><span>
</span><span id="line-241"></span><span class="hs-comment">--</span><span>
</span><span id="line-242"></span><span class="hs-comment">-- Using CPS lets us inline the continuation and avoid allocating a @Maybe@</span><span>
</span><span id="line-243"></span><span class="hs-comment">-- in the @decode...@ functions.</span><span>
</span><span id="line-244"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#validateUtf8ChunkFrom"><span class="hs-pragma hs-type">validateUtf8ChunkFrom</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-245"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#validateUtf8ChunkFrom"><span class="hs-identifier hs-type">validateUtf8ChunkFrom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679126413"><span class="annot"><a href="#local-6989586621679126413"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#Int/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.3/src/Data.ByteString.Internal.Type.html#ByteString/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#Int/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-type">Utf8State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679126413"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679126413"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-246"></span><span id="validateUtf8ChunkFrom"><span class="annot"><span class="annottext">validateUtf8ChunkFrom :: forall r. Int -&gt; ByteString -&gt; (Int -&gt; Maybe Utf8State -&gt; r) -&gt; r
</span><a href="Data.Text.Internal.Encoding.html#validateUtf8ChunkFrom"><span class="hs-identifier hs-var hs-var">validateUtf8ChunkFrom</span></a></span></span><span> </span><span id="local-6989586621679126631"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126631"><span class="hs-identifier hs-var">ofs</span></a></span></span><span> </span><span id="local-6989586621679126632"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126632"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621679126633"><span class="annot"><span class="annottext">Int -&gt; Maybe Utf8State -&gt; r
</span><a href="#local-6989586621679126633"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-cpp">
#if defined(SIMDUTF) || MIN_VERSION_bytestring(0,11,2)
</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126634"><span class="hs-identifier hs-var">guessUtf8Boundary</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3E/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%26%26/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-comment">-- the rest of the bytestring is valid utf-8 up to the boundary</span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-special">(</span><span class="hs-cpp">
#ifdef SIMDUTF
</span><span>      </span><span class="hs-identifier">withBS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">B.drop</span><span> </span><span class="hs-identifier">ofs</span><span> </span><span class="hs-identifier">bs</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-identifier">fp</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unsafeDupablePerformIO</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-253"></span><span>        </span><span class="hs-identifier">unsafeWithForeignPtr</span><span> </span><span class="hs-identifier">fp</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-operator">/=</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span>
</span><span id="line-254"></span><span>          </span><span class="hs-identifier">c_is_valid_utf8</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">guessUtf8Boundary</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>      </span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#isValidUtf8/Data.ByteString.html#isValidUtf8"><span class="hs-identifier hs-var">B.isValidUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Bool) -&gt; ByteString -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#take/Data.ByteString.html#take"><span class="hs-identifier hs-var">B.take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126634"><span class="hs-identifier hs-var">guessUtf8Boundary</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#drop/Data.ByteString.html#drop"><span class="hs-identifier hs-var">B.drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126631"><span class="hs-identifier hs-var">ofs</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126632"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; r
</span><a href="#local-6989586621679126640"><span class="hs-identifier hs-var">slowValidateUtf8ChunkFrom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126631"><span class="hs-identifier hs-var">ofs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126634"><span class="hs-identifier hs-var">guessUtf8Boundary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-comment">-- No</span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; r
</span><a href="#local-6989586621679126640"><span class="hs-identifier hs-var">slowValidateUtf8ChunkFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126631"><span class="hs-identifier hs-var">ofs</span></a></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-262"></span><span>    </span><span id="local-6989586621679126642"><span class="annot"><span class="annottext">len :: Int
</span><a href="#local-6989586621679126642"><span class="hs-identifier hs-var hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#length/Data.ByteString.html#length"><span class="hs-identifier hs-var">B.length</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126632"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#-/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126631"><span class="hs-identifier hs-var">ofs</span></a></span><span>
</span><span id="line-263"></span><span>    </span><span id="local-6989586621679126648"><span class="annot"><span class="annottext">isBoundary :: Int -&gt; (Word8 -&gt; Bool) -&gt; Bool
</span><a href="#local-6989586621679126648"><span class="hs-identifier hs-var hs-var">isBoundary</span></a></span></span><span> </span><span id="local-6989586621679126649"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126649"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679126650"><span class="annot"><span class="annottext">Word8 -&gt; Bool
</span><a href="#local-6989586621679126650"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126642"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3E%3D/GHC.Classes.html#%3E%3D"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126649"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%26%26/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Bool
</span><a href="#local-6989586621679126650"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; ByteString -&gt; Int -&gt; Word8
ByteString -&gt; Int -&gt; Word8
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#index/Data.ByteString.html#index"><span class="hs-identifier hs-var">B.index</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126632"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126631"><span class="hs-identifier hs-var">ofs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126642"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#-/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126649"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>    </span><span id="local-6989586621679126634"><span class="annot"><span class="annottext">guessUtf8Boundary :: Int
</span><a href="#local-6989586621679126634"><span class="hs-identifier hs-var hs-var">guessUtf8Boundary</span></a></span></span><span>
</span><span id="line-265"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Word8 -&gt; Bool) -&gt; Bool
</span><a href="#local-6989586621679126648"><span class="hs-identifier hs-var">isBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x80</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126642"><span class="hs-identifier hs-var">len</span></a></span><span>      </span><span class="hs-comment">-- last char is ASCII (common short-circuit)</span><span>
</span><span id="line-266"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Word8 -&gt; Bool) -&gt; Bool
</span><a href="#local-6989586621679126648"><span class="hs-identifier hs-var">isBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0xc2</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126642"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#-/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>  </span><span class="hs-comment">-- last char starts a two-(or more-)byte code point</span><span>
</span><span id="line-267"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Word8 -&gt; Bool) -&gt; Bool
</span><a href="#local-6989586621679126648"><span class="hs-identifier hs-var">isBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0xe0</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126642"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#-/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>  </span><span class="hs-comment">-- pre-last char starts a three-or-four-byte code point</span><span>
</span><span id="line-268"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Word8 -&gt; Bool) -&gt; Bool
</span><a href="#local-6989586621679126648"><span class="hs-identifier hs-var">isBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0xf0</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126642"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#-/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span>  </span><span class="hs-comment">-- third to last char starts a four-byte code point</span><span>
</span><span id="line-269"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126642"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-cpp">
#else
</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">slowValidateUtf8ChunkFrom</span><span> </span><span class="hs-identifier">ofs</span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-keyword">where</span><span class="hs-cpp">
#endif
</span><span>    </span><span class="hs-comment">-- A pure Haskell implementation of validateUtf8More.</span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-comment">-- Ideally the primitives 'B.isValidUtf8' or 'c_is_valid_utf8' should give us</span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-comment">-- indices to let us avoid this function.</span><span>
</span><span id="line-277"></span><span>    </span><span class="annot"><a href="#local-6989586621679126640"><span class="hs-identifier hs-type">slowValidateUtf8ChunkFrom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#Int/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679126413"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-278"></span><span>    </span><span id="local-6989586621679126640"><span class="annot"><span class="annottext">slowValidateUtf8ChunkFrom :: Int -&gt; r
</span><a href="#local-6989586621679126640"><span class="hs-identifier hs-var hs-var">slowValidateUtf8ChunkFrom</span></a></span></span><span> </span><span id="local-6989586621679126666"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126666"><span class="hs-identifier hs-var">ofs1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; DecoderState -&gt; r
</span><a href="#local-6989586621679126667"><span class="hs-identifier hs-var">slowLoop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126666"><span class="hs-identifier hs-var">ofs1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126666"><span class="hs-identifier hs-var">ofs1</span></a></span><span> </span><span class="annot"><span class="annottext">DecoderState
</span><a href="Data.Text.Internal.Encoding.Utf8.html#utf8AcceptState"><span class="hs-identifier hs-var">utf8AcceptState</span></a></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span>    </span><span id="local-6989586621679126667"><span class="annot"><span class="annottext">slowLoop :: Int -&gt; Int -&gt; DecoderState -&gt; r
</span><a href="#local-6989586621679126667"><span class="hs-identifier hs-var hs-var">slowLoop</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679126679"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126679"><span class="hs-identifier hs-var">utf8End</span></a></span></span><span> </span><span id="local-6989586621679126680"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126680"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679126681"><span class="annot"><span class="annottext">DecoderState
</span><a href="#local-6989586621679126681"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-281"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126680"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3C/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#length/Data.ByteString.html#length"><span class="hs-identifier hs-var">B.length</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126632"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-282"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; DecoderState -&gt; DecoderState
</span><a href="Data.Text.Internal.Encoding.Utf8.html#updateDecoderState"><span class="hs-identifier hs-var">updateDecoderState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; ByteString -&gt; Int -&gt; Word8
ByteString -&gt; Int -&gt; Word8
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#index/Data.ByteString.html#index"><span class="hs-identifier hs-var">B.index</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126632"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126680"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DecoderState
</span><a href="#local-6989586621679126681"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-283"></span><span>            </span><span id="local-6989586621679126682"><span class="annot"><span class="annottext">DecoderState
</span><a href="#local-6989586621679126682"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DecoderState
</span><a href="#local-6989586621679126682"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">DecoderState -&gt; DecoderState -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">DecoderState
</span><a href="Data.Text.Internal.Encoding.Utf8.html#utf8RejectState"><span class="hs-identifier hs-var">utf8RejectState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Utf8State -&gt; r
</span><a href="#local-6989586621679126633"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126679"><span class="hs-identifier hs-var">utf8End</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Utf8State
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-284"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DecoderState
</span><a href="#local-6989586621679126682"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">DecoderState -&gt; DecoderState -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">DecoderState
</span><a href="Data.Text.Internal.Encoding.Utf8.html#utf8AcceptState"><span class="hs-identifier hs-var">utf8AcceptState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; DecoderState -&gt; r
</span><a href="#local-6989586621679126667"><span class="hs-identifier hs-var">slowLoop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126680"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126680"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DecoderState
</span><a href="#local-6989586621679126682"><span class="hs-identifier hs-var">s'</span></a></span><span>
</span><span id="line-285"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; DecoderState -&gt; r
</span><a href="#local-6989586621679126667"><span class="hs-identifier hs-var">slowLoop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126679"><span class="hs-identifier hs-var">utf8End</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126680"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DecoderState
</span><a href="#local-6989586621679126682"><span class="hs-identifier hs-var">s'</span></a></span><span>
</span><span id="line-286"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Utf8State -&gt; r
</span><a href="#local-6989586621679126633"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126679"><span class="hs-identifier hs-var">utf8End</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Utf8State -&gt; Maybe Utf8State
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DecoderState -&gt; PartialUtf8CodePoint -&gt; Utf8State
</span><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-var">Utf8State</span></a></span><span> </span><span class="annot"><span class="annottext">DecoderState
</span><a href="#local-6989586621679126681"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PartialUtf8CodePoint -&gt; ByteString -&gt; PartialUtf8CodePoint
</span><a href="Data.Text.Internal.Encoding.html#partUtf8UnsafeAppend"><span class="hs-identifier hs-var">partUtf8UnsafeAppend</span></a></span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint
</span><a href="Data.Text.Internal.Encoding.html#partUtf8Empty"><span class="hs-identifier hs-var">partUtf8Empty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#drop/Data.ByteString.html#drop"><span class="hs-identifier hs-var">B.drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126679"><span class="hs-identifier hs-var">utf8End</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126632"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="hs-comment">-- | Validate another 'ByteString' chunk in an ongoing stream of UTF-8-encoded text.</span><span>
</span><span id="line-289"></span><span class="hs-comment">--</span><span>
</span><span id="line-290"></span><span class="hs-comment">-- Returns a pair:</span><span>
</span><span id="line-291"></span><span class="hs-comment">--</span><span>
</span><span id="line-292"></span><span class="hs-comment">-- 1. The first component @n@ is the end position, relative to the current</span><span>
</span><span id="line-293"></span><span class="hs-comment">--    chunk, of the longest prefix of the accumulated bytestring which is valid UTF-8.</span><span>
</span><span id="line-294"></span><span class="hs-comment">--    @n@ may be negative: that happens when an incomplete code point started in</span><span>
</span><span id="line-295"></span><span class="hs-comment">--    a previous chunk and is not completed by the current chunk (either</span><span>
</span><span id="line-296"></span><span class="hs-comment">--    that code point is still incomplete, or it is broken by an invalid byte).</span><span>
</span><span id="line-297"></span><span class="hs-comment">--</span><span>
</span><span id="line-298"></span><span class="hs-comment">-- 2. The second component @ms@ indicates the following:</span><span>
</span><span id="line-299"></span><span class="hs-comment">--</span><span>
</span><span id="line-300"></span><span class="hs-comment">--     - if @ms = Nothing@, the remainder of the chunk contains an invalid byte,</span><span>
</span><span id="line-301"></span><span class="hs-comment">--       within four bytes from position @n@;</span><span>
</span><span id="line-302"></span><span class="hs-comment">--     - if @ms = Just s'@, you can carry on validating another chunk</span><span>
</span><span id="line-303"></span><span class="hs-comment">--       by calling 'validateUtf8More' with the new state @s'@.</span><span>
</span><span id="line-304"></span><span class="hs-comment">--</span><span>
</span><span id="line-305"></span><span class="hs-comment">-- @since 2.0.2</span><span>
</span><span id="line-306"></span><span class="hs-comment">--</span><span>
</span><span id="line-307"></span><span class="hs-comment">-- === Properties</span><span>
</span><span id="line-308"></span><span class="hs-comment">--</span><span>
</span><span id="line-309"></span><span class="hs-comment">-- Given:</span><span>
</span><span id="line-310"></span><span class="hs-comment">--</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-312"></span><span class="hs-comment">-- 'validateUtf8More' s chunk = (n, ms)</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-314"></span><span class="hs-comment">--</span><span>
</span><span id="line-315"></span><span class="hs-comment">-- - If the chunk is invalid, it cannot be extended to be valid.</span><span>
</span><span id="line-316"></span><span class="hs-comment">--</span><span>
</span><span id="line-317"></span><span class="hs-comment">--     @</span><span>
</span><span id="line-318"></span><span class="hs-comment">--     ms = Nothing</span><span>
</span><span id="line-319"></span><span class="hs-comment">--     ==&gt; 'validateUtf8More' s (chunk '&lt;&gt;' more) = (n, Nothing)</span><span>
</span><span id="line-320"></span><span class="hs-comment">--     @</span><span>
</span><span id="line-321"></span><span class="hs-comment">--</span><span>
</span><span id="line-322"></span><span class="hs-comment">-- - Validating two chunks sequentially is the same as validating them</span><span>
</span><span id="line-323"></span><span class="hs-comment">--   together at once:</span><span>
</span><span id="line-324"></span><span class="hs-comment">--</span><span>
</span><span id="line-325"></span><span class="hs-comment">--     @</span><span>
</span><span id="line-326"></span><span class="hs-comment">--     ms = Just s'</span><span>
</span><span id="line-327"></span><span class="hs-comment">--     ==&gt; 'validateUtf8More' s (chunk '&lt;&gt;' more) = 'Data.Bifunctor.first' ('Data.ByteString.length' chunk '+') ('validateUtf8More' s' more)</span><span>
</span><span id="line-328"></span><span class="hs-comment">--     @</span><span>
</span><span id="line-329"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#validateUtf8More"><span class="hs-identifier hs-type">validateUtf8More</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-type">Utf8State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.3/src/Data.ByteString.Internal.Type.html#ByteString/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#Int/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-type">Utf8State</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span id="validateUtf8More"><span class="annot"><span class="annottext">validateUtf8More :: Utf8State -&gt; ByteString -&gt; (Int, Maybe Utf8State)
</span><a href="Data.Text.Internal.Encoding.html#validateUtf8More"><span class="hs-identifier hs-var hs-var">validateUtf8More</span></a></span></span><span> </span><span id="local-6989586621679126683"><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126683"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679126684"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126684"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Utf8State
-&gt; ByteString
-&gt; (Int -&gt; Maybe Utf8State -&gt; (Int, Maybe Utf8State))
-&gt; (Int, Maybe Utf8State)
forall r.
Utf8State -&gt; ByteString -&gt; (Int -&gt; Maybe Utf8State -&gt; r) -&gt; r
</span><a href="Data.Text.Internal.Encoding.html#validateUtf8MoreCont"><span class="hs-identifier hs-var">validateUtf8MoreCont</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126683"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126684"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span class="hs-comment">-- CPS: inlining the continuation lets us make more tail calls and avoid</span><span>
</span><span id="line-333"></span><span class="hs-comment">-- allocating a @Maybe@ in @decodeWith1/2@.</span><span>
</span><span id="line-334"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#validateUtf8MoreCont"><span class="hs-pragma hs-type">validateUtf8MoreCont</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-335"></span><span id="local-6989586621679126415"><span class="annot"><a href="Data.Text.Internal.Encoding.html#validateUtf8MoreCont"><span class="hs-identifier hs-type">validateUtf8MoreCont</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-type">Utf8State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.3/src/Data.ByteString.Internal.Type.html#ByteString/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#Int/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-type">Utf8State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679126415"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679126415"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-336"></span><span id="validateUtf8MoreCont"><span class="annot"><span class="annottext">validateUtf8MoreCont :: forall r.
Utf8State -&gt; ByteString -&gt; (Int -&gt; Maybe Utf8State -&gt; r) -&gt; r
</span><a href="Data.Text.Internal.Encoding.html#validateUtf8MoreCont"><span class="hs-identifier hs-var hs-var">validateUtf8MoreCont</span></a></span></span><span> </span><span id="local-6989586621679126689"><span class="annot"><span class="annottext">st :: Utf8State
</span><a href="#local-6989586621679126689"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-type">Utf8State</span></a></span><span> </span><span id="local-6989586621679126690"><span class="annot"><span class="annottext">DecoderState
</span><a href="#local-6989586621679126690"><span class="hs-identifier hs-var">s0</span></a></span></span><span> </span><span id="local-6989586621679126691"><span class="annot"><span class="annottext">PartialUtf8CodePoint
</span><a href="#local-6989586621679126691"><span class="hs-identifier hs-var">part</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679126692"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126692"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621679126693"><span class="annot"><span class="annottext">Int -&gt; Maybe Utf8State -&gt; r
</span><a href="#local-6989586621679126693"><span class="hs-identifier hs-var">k</span></a></span></span><span>
</span><span id="line-337"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126694"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3E/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; DecoderState -&gt; r
</span><a href="#local-6989586621679126695"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">DecoderState
</span><a href="#local-6989586621679126690"><span class="hs-identifier hs-var">s0</span></a></span><span>
</span><span id="line-338"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Utf8State -&gt; r
</span><a href="#local-6989586621679126693"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint -&gt; Int
</span><a href="Data.Text.Internal.Encoding.html#partUtf8Len"><span class="hs-identifier hs-var">partUtf8Len</span></a></span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint
</span><a href="#local-6989586621679126691"><span class="hs-identifier hs-var">part</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Utf8State -&gt; Maybe Utf8State
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126689"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-340"></span><span>    </span><span id="local-6989586621679126694"><span class="annot"><span class="annottext">len :: Int
</span><a href="#local-6989586621679126694"><span class="hs-identifier hs-var hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#length/Data.ByteString.html#length"><span class="hs-identifier hs-var">B.length</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126692"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-comment">-- Complete an incomplete code point (if there is one)</span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-comment">-- and then jump to validateUtf8ChunkFrom</span><span>
</span><span id="line-343"></span><span>    </span><span id="local-6989586621679126695"><span class="annot"><span class="annottext">loop :: Int -&gt; DecoderState -&gt; r
</span><a href="#local-6989586621679126695"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679126705"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126705"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679126706"><span class="annot"><span class="annottext">DecoderState
</span><a href="#local-6989586621679126706"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-344"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DecoderState
</span><a href="#local-6989586621679126706"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">DecoderState -&gt; DecoderState -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">DecoderState
</span><a href="Data.Text.Internal.Encoding.Utf8.html#utf8AcceptState"><span class="hs-identifier hs-var">utf8AcceptState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; (Int -&gt; Maybe Utf8State -&gt; r) -&gt; r
forall r. Int -&gt; ByteString -&gt; (Int -&gt; Maybe Utf8State -&gt; r) -&gt; r
</span><a href="Data.Text.Internal.Encoding.html#validateUtf8ChunkFrom"><span class="hs-identifier hs-var">validateUtf8ChunkFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126705"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126692"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Utf8State -&gt; r
</span><a href="#local-6989586621679126693"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-345"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126705"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3C/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126694"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-346"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; DecoderState -&gt; DecoderState
</span><a href="Data.Text.Internal.Encoding.Utf8.html#updateDecoderState"><span class="hs-identifier hs-var">updateDecoderState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; ByteString -&gt; Int -&gt; Word8
ByteString -&gt; Int -&gt; Word8
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#index/Data.ByteString.html#index"><span class="hs-identifier hs-var">B.index</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126692"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126705"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DecoderState
</span><a href="#local-6989586621679126706"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-347"></span><span>          </span><span id="local-6989586621679126707"><span class="annot"><span class="annottext">DecoderState
</span><a href="#local-6989586621679126707"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DecoderState
</span><a href="#local-6989586621679126707"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">DecoderState -&gt; DecoderState -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">DecoderState
</span><a href="Data.Text.Internal.Encoding.Utf8.html#utf8RejectState"><span class="hs-identifier hs-var">utf8RejectState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Utf8State -&gt; r
</span><a href="#local-6989586621679126693"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint -&gt; Int
</span><a href="Data.Text.Internal.Encoding.html#partUtf8Len"><span class="hs-identifier hs-var">partUtf8Len</span></a></span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint
</span><a href="#local-6989586621679126691"><span class="hs-identifier hs-var">part</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Utf8State
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-348"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; DecoderState -&gt; r
</span><a href="#local-6989586621679126695"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126705"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DecoderState
</span><a href="#local-6989586621679126707"><span class="hs-identifier hs-var">s'</span></a></span><span>
</span><span id="line-349"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Utf8State -&gt; r
</span><a href="#local-6989586621679126693"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint -&gt; Int
</span><a href="Data.Text.Internal.Encoding.html#partUtf8Len"><span class="hs-identifier hs-var">partUtf8Len</span></a></span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint
</span><a href="#local-6989586621679126691"><span class="hs-identifier hs-var">part</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Utf8State -&gt; Maybe Utf8State
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DecoderState -&gt; PartialUtf8CodePoint -&gt; Utf8State
</span><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-var">Utf8State</span></a></span><span> </span><span class="annot"><span class="annottext">DecoderState
</span><a href="#local-6989586621679126706"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PartialUtf8CodePoint -&gt; ByteString -&gt; PartialUtf8CodePoint
</span><a href="Data.Text.Internal.Encoding.html#partUtf8UnsafeAppend"><span class="hs-identifier hs-var">partUtf8UnsafeAppend</span></a></span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint
</span><a href="#local-6989586621679126691"><span class="hs-identifier hs-var">part</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126692"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="hs-comment">-- Eta-expanded to inline partUtf8Foldr</span><span>
</span><span id="line-352"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#partUtf8ToStrictBuilder"><span class="hs-identifier hs-type">partUtf8ToStrictBuilder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#PartialUtf8CodePoint"><span class="hs-identifier hs-type">PartialUtf8CodePoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Text.Internal.StrictBuilder.html#StrictBuilder"><span class="hs-identifier hs-type">StrictBuilder</span></a></span><span>
</span><span id="line-353"></span><span id="partUtf8ToStrictBuilder"><span class="annot"><span class="annottext">partUtf8ToStrictBuilder :: PartialUtf8CodePoint -&gt; StrictBuilder
</span><a href="Data.Text.Internal.Encoding.html#partUtf8ToStrictBuilder"><span class="hs-identifier hs-var hs-var">partUtf8ToStrictBuilder</span></a></span></span><span> </span><span id="local-6989586621679126709"><span class="annot"><span class="annottext">PartialUtf8CodePoint
</span><a href="#local-6989586621679126709"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-354"></span><span>  </span><span class="annot"><span class="annottext">(Word8 -&gt; StrictBuilder -&gt; StrictBuilder)
-&gt; StrictBuilder -&gt; PartialUtf8CodePoint -&gt; StrictBuilder
forall a. (Word8 -&gt; a -&gt; a) -&gt; a -&gt; PartialUtf8CodePoint -&gt; a
</span><a href="Data.Text.Internal.Encoding.html#partUtf8Foldr"><span class="hs-identifier hs-var">partUtf8Foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StrictBuilder -&gt; StrictBuilder -&gt; StrictBuilder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">(&lt;&gt;)</span></a></span><span> </span><span class="annot"><span class="annottext">(StrictBuilder -&gt; StrictBuilder -&gt; StrictBuilder)
-&gt; (Word8 -&gt; StrictBuilder)
-&gt; Word8
-&gt; StrictBuilder
-&gt; StrictBuilder
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; StrictBuilder
</span><a href="Data.Text.Internal.StrictBuilder.html#unsafeFromWord8"><span class="hs-identifier hs-var">SB.unsafeFromWord8</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StrictBuilder
forall a. Monoid a =&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#mempty/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint
</span><a href="#local-6989586621679126709"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#utf8StateToStrictBuilder"><span class="hs-identifier hs-type">utf8StateToStrictBuilder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-type">Utf8State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Text.Internal.StrictBuilder.html#StrictBuilder"><span class="hs-identifier hs-type">StrictBuilder</span></a></span><span>
</span><span id="line-357"></span><span id="utf8StateToStrictBuilder"><span class="annot"><span class="annottext">utf8StateToStrictBuilder :: Utf8State -&gt; StrictBuilder
</span><a href="Data.Text.Internal.Encoding.html#utf8StateToStrictBuilder"><span class="hs-identifier hs-var hs-var">utf8StateToStrictBuilder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint -&gt; StrictBuilder
</span><a href="Data.Text.Internal.Encoding.html#partUtf8ToStrictBuilder"><span class="hs-identifier hs-var">partUtf8ToStrictBuilder</span></a></span><span> </span><span class="annot"><span class="annottext">(PartialUtf8CodePoint -&gt; StrictBuilder)
-&gt; (Utf8State -&gt; PartialUtf8CodePoint)
-&gt; Utf8State
-&gt; StrictBuilder
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State -&gt; PartialUtf8CodePoint
</span><a href="Data.Text.Internal.Encoding.html#partialUtf8CodePoint"><span class="hs-identifier hs-var">partialUtf8CodePoint</span></a></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span class="hs-comment">-- | Decode another chunk in an ongoing UTF-8 stream.</span><span>
</span><span id="line-360"></span><span class="hs-comment">--</span><span>
</span><span id="line-361"></span><span class="hs-comment">-- Returns a triple:</span><span>
</span><span id="line-362"></span><span class="hs-comment">--</span><span>
</span><span id="line-363"></span><span class="hs-comment">-- 1. A 'StrictBuilder' for the decoded chunk of text. You can accumulate</span><span>
</span><span id="line-364"></span><span class="hs-comment">--    chunks with @('&lt;&gt;')@ or output them with 'SB.toText'.</span><span>
</span><span id="line-365"></span><span class="hs-comment">-- 2. The undecoded remainder of the given chunk, for diagnosing errors</span><span>
</span><span id="line-366"></span><span class="hs-comment">--    and resuming (presumably after skipping some bytes).</span><span>
</span><span id="line-367"></span><span class="hs-comment">-- 3. 'Just' the new state, or 'Nothing' if an invalid byte was encountered</span><span>
</span><span id="line-368"></span><span class="hs-comment">--    (it will be within the first 4 bytes of the undecoded remainder).</span><span>
</span><span id="line-369"></span><span class="hs-comment">--</span><span>
</span><span id="line-370"></span><span class="hs-comment">-- @since 2.0.2</span><span>
</span><span id="line-371"></span><span class="hs-comment">--</span><span>
</span><span id="line-372"></span><span class="hs-comment">-- === Properties</span><span>
</span><span id="line-373"></span><span class="hs-comment">--</span><span>
</span><span id="line-374"></span><span class="hs-comment">-- Given:</span><span>
</span><span id="line-375"></span><span class="hs-comment">--</span><span>
</span><span id="line-376"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-377"></span><span class="hs-comment">-- (pre, suf, ms) = 'decodeUtf8More' s chunk</span><span>
</span><span id="line-378"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-379"></span><span class="hs-comment">--</span><span>
</span><span id="line-380"></span><span class="hs-comment">-- 1. If the output @pre@ is nonempty (alternatively, if @length chunk &gt; length suf@)</span><span>
</span><span id="line-381"></span><span class="hs-comment">--</span><span>
</span><span id="line-382"></span><span class="hs-comment">--     @</span><span>
</span><span id="line-383"></span><span class="hs-comment">--     s2b pre \`'Data.ByteString.append'\` suf = p2b s \`'Data.ByteString.append'\` chunk</span><span>
</span><span id="line-384"></span><span class="hs-comment">--     @</span><span>
</span><span id="line-385"></span><span class="hs-comment">--</span><span>
</span><span id="line-386"></span><span class="hs-comment">--     where</span><span>
</span><span id="line-387"></span><span class="hs-comment">--</span><span>
</span><span id="line-388"></span><span class="hs-comment">--     @</span><span>
</span><span id="line-389"></span><span class="hs-comment">--     s2b = 'Data.Text.Encoding.encodeUtf8' . 'Data.Text.Encoding.toText'</span><span>
</span><span id="line-390"></span><span class="hs-comment">--     p2b = 'Data.Text.Internal.Encoding.partUtf8ToByteString'</span><span>
</span><span id="line-391"></span><span class="hs-comment">--     @</span><span>
</span><span id="line-392"></span><span class="hs-comment">--</span><span>
</span><span id="line-393"></span><span class="hs-comment">-- 2. If the output @pre@ is empty (alternatively, if @length chunk = length suf@)</span><span>
</span><span id="line-394"></span><span class="hs-comment">--</span><span>
</span><span id="line-395"></span><span class="hs-comment">--     @suf = chunk@</span><span>
</span><span id="line-396"></span><span class="hs-comment">--</span><span>
</span><span id="line-397"></span><span class="hs-comment">-- 3. Decoding chunks separately is equivalent to decoding their concatenation.</span><span>
</span><span id="line-398"></span><span class="hs-comment">--</span><span>
</span><span id="line-399"></span><span class="hs-comment">--     Given:</span><span>
</span><span id="line-400"></span><span class="hs-comment">--</span><span>
</span><span id="line-401"></span><span class="hs-comment">--     @</span><span>
</span><span id="line-402"></span><span class="hs-comment">--     (pre1, suf1, Just s1) = 'decodeUtf8More' s chunk1</span><span>
</span><span id="line-403"></span><span class="hs-comment">--     (pre2, suf2,     ms2) = 'decodeUtf8More' s1 chunk2</span><span>
</span><span id="line-404"></span><span class="hs-comment">--     (pre3, suf3,     ms3) = 'decodeUtf8More' s (chunk1 \`B.append\` chunk2)</span><span>
</span><span id="line-405"></span><span class="hs-comment">--     @</span><span>
</span><span id="line-406"></span><span class="hs-comment">--</span><span>
</span><span id="line-407"></span><span class="hs-comment">--     we have:</span><span>
</span><span id="line-408"></span><span class="hs-comment">--</span><span>
</span><span id="line-409"></span><span class="hs-comment">--     @</span><span>
</span><span id="line-410"></span><span class="hs-comment">--     s2b (pre1 '&lt;&gt;' pre2) = s2b pre3</span><span>
</span><span id="line-411"></span><span class="hs-comment">--     ms2 = ms3</span><span>
</span><span id="line-412"></span><span class="hs-comment">--     @</span><span>
</span><span id="line-413"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#decodeUtf8More"><span class="hs-identifier hs-type">decodeUtf8More</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-type">Utf8State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.3/src/Data.ByteString.Internal.Type.html#ByteString/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Text.Internal.StrictBuilder.html#StrictBuilder"><span class="hs-identifier hs-type">StrictBuilder</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.3/src/Data.ByteString.Internal.Type.html#ByteString/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-type">Utf8State</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span id="decodeUtf8More"><span class="annot"><span class="annottext">decodeUtf8More :: Utf8State
-&gt; ByteString -&gt; (StrictBuilder, ByteString, Maybe Utf8State)
</span><a href="Data.Text.Internal.Encoding.html#decodeUtf8More"><span class="hs-identifier hs-var hs-var">decodeUtf8More</span></a></span></span><span> </span><span id="local-6989586621679126712"><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126712"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679126713"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126713"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-415"></span><span>  </span><span class="annot"><span class="annottext">Utf8State
-&gt; ByteString
-&gt; (Int
    -&gt; Maybe Utf8State -&gt; (StrictBuilder, ByteString, Maybe Utf8State))
-&gt; (StrictBuilder, ByteString, Maybe Utf8State)
forall r.
Utf8State -&gt; ByteString -&gt; (Int -&gt; Maybe Utf8State -&gt; r) -&gt; r
</span><a href="Data.Text.Internal.Encoding.html#validateUtf8MoreCont"><span class="hs-identifier hs-var">validateUtf8MoreCont</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126712"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126713"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">((Int
  -&gt; Maybe Utf8State -&gt; (StrictBuilder, ByteString, Maybe Utf8State))
 -&gt; (StrictBuilder, ByteString, Maybe Utf8State))
-&gt; (Int
    -&gt; Maybe Utf8State -&gt; (StrictBuilder, ByteString, Maybe Utf8State))
-&gt; (StrictBuilder, ByteString, Maybe Utf8State)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679126714"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126714"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span id="local-6989586621679126715"><span class="annot"><span class="annottext">Maybe Utf8State
</span><a href="#local-6989586621679126715"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-416"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679126720"><span class="annot"><span class="annottext">builder :: StrictBuilder
</span><a href="#local-6989586621679126720"><span class="hs-identifier hs-var hs-var">builder</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126714"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StrictBuilder
forall a. Monoid a =&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#mempty/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-417"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Utf8State -&gt; StrictBuilder
</span><a href="Data.Text.Internal.Encoding.html#utf8StateToStrictBuilder"><span class="hs-identifier hs-var">utf8StateToStrictBuilder</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126712"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-418"></span><span>                  </span><span class="annot"><span class="annottext">StrictBuilder -&gt; StrictBuilder -&gt; StrictBuilder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; StrictBuilder
</span><a href="Data.Text.Internal.StrictBuilder.html#unsafeFromByteString"><span class="hs-identifier hs-var">SB.unsafeFromByteString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#take/Data.ByteString.html#take"><span class="hs-identifier hs-var">B.take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126714"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126713"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StrictBuilder
</span><a href="#local-6989586621679126720"><span class="hs-identifier hs-var">builder</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#drop/Data.ByteString.html#drop"><span class="hs-identifier hs-var">B.drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126714"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126713"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Utf8State
</span><a href="#local-6989586621679126715"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span class="hs-comment">-- | Decode a chunk of UTF-8 text. To be continued with 'decodeUtf8More'.</span><span>
</span><span id="line-422"></span><span class="hs-comment">--</span><span>
</span><span id="line-423"></span><span class="hs-comment">-- See 'decodeUtf8More' for details on the result.</span><span>
</span><span id="line-424"></span><span class="hs-comment">--</span><span>
</span><span id="line-425"></span><span class="hs-comment">-- @since 2.0.2</span><span>
</span><span id="line-426"></span><span class="hs-comment">--</span><span>
</span><span id="line-427"></span><span class="hs-comment">-- === Properties</span><span>
</span><span id="line-428"></span><span class="hs-comment">--</span><span>
</span><span id="line-429"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-430"></span><span class="hs-comment">-- 'decodeUtf8Chunk' = 'decodeUtf8More' 'startUtf8State'</span><span>
</span><span id="line-431"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-432"></span><span class="hs-comment">--</span><span>
</span><span id="line-433"></span><span class="hs-comment">-- Given:</span><span>
</span><span id="line-434"></span><span class="hs-comment">--</span><span>
</span><span id="line-435"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-436"></span><span class="hs-comment">-- 'decodeUtf8Chunk' chunk = (builder, rest, ms)</span><span>
</span><span id="line-437"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-438"></span><span class="hs-comment">--</span><span>
</span><span id="line-439"></span><span class="hs-comment">-- @builder@ is a prefix and @rest@ is a suffix of @chunk@.</span><span>
</span><span id="line-440"></span><span class="hs-comment">--</span><span>
</span><span id="line-441"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-442"></span><span class="hs-comment">-- 'Data.Text.Encoding.encodeUtf8' ('Data.Text.Encoding.strictBuilderToText' builder) '&lt;&gt;' rest = chunk</span><span>
</span><span id="line-443"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-444"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#decodeUtf8Chunk"><span class="hs-identifier hs-type">decodeUtf8Chunk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.3/src/Data.ByteString.Internal.Type.html#ByteString/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Text.Internal.StrictBuilder.html#StrictBuilder"><span class="hs-identifier hs-type">StrictBuilder</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.3/src/Data.ByteString.Internal.Type.html#ByteString/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-type">Utf8State</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span id="decodeUtf8Chunk"><span class="annot"><span class="annottext">decodeUtf8Chunk :: ByteString -&gt; (StrictBuilder, ByteString, Maybe Utf8State)
</span><a href="Data.Text.Internal.Encoding.html#decodeUtf8Chunk"><span class="hs-identifier hs-var hs-var">decodeUtf8Chunk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Utf8State
-&gt; ByteString -&gt; (StrictBuilder, ByteString, Maybe Utf8State)
</span><a href="Data.Text.Internal.Encoding.html#decodeUtf8More"><span class="hs-identifier hs-var">decodeUtf8More</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State
</span><a href="Data.Text.Internal.Encoding.html#startUtf8State"><span class="hs-identifier hs-var">startUtf8State</span></a></span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span class="hs-comment">-- | Call the error handler on each byte of the partial code point stored in</span><span>
</span><span id="line-448"></span><span class="hs-comment">-- 'Utf8State' and append the results.</span><span>
</span><span id="line-449"></span><span class="hs-comment">--</span><span>
</span><span id="line-450"></span><span class="hs-comment">-- Exported for use in lazy 'Data.Text.Lazy.Encoding.decodeUtf8With'.</span><span>
</span><span id="line-451"></span><span class="hs-comment">--</span><span>
</span><span id="line-452"></span><span class="hs-comment">-- @since 2.0.2</span><span>
</span><span id="line-453"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#skipIncomplete"><span class="hs-pragma hs-type">skipIncomplete</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-454"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#skipIncomplete"><span class="hs-identifier hs-type">skipIncomplete</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Text.Encoding.Error.html#OnDecodeError"><span class="hs-identifier hs-type">OnDecodeError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-type">Utf8State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Text.Internal.StrictBuilder.html#StrictBuilder"><span class="hs-identifier hs-type">StrictBuilder</span></a></span><span>
</span><span id="line-455"></span><span id="skipIncomplete"><span class="annot"><span class="annottext">skipIncomplete :: OnDecodeError -&gt; String -&gt; Utf8State -&gt; StrictBuilder
</span><a href="Data.Text.Internal.Encoding.html#skipIncomplete"><span class="hs-identifier hs-var hs-var">skipIncomplete</span></a></span></span><span> </span><span id="local-6989586621679126722"><span class="annot"><span class="annottext">OnDecodeError
</span><a href="#local-6989586621679126722"><span class="hs-identifier hs-var">onErr</span></a></span></span><span> </span><span id="local-6989586621679126723"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679126723"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679126724"><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126724"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-456"></span><span>  </span><span class="annot"><span class="annottext">(Word8 -&gt; StrictBuilder -&gt; StrictBuilder)
-&gt; StrictBuilder -&gt; PartialUtf8CodePoint -&gt; StrictBuilder
forall a. (Word8 -&gt; a -&gt; a) -&gt; a -&gt; PartialUtf8CodePoint -&gt; a
</span><a href="Data.Text.Internal.Encoding.html#partUtf8Foldr"><span class="hs-identifier hs-var">partUtf8Foldr</span></a></span><span>
</span><span id="line-457"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StrictBuilder -&gt; StrictBuilder -&gt; StrictBuilder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">(&lt;&gt;)</span></a></span><span> </span><span class="annot"><span class="annottext">(StrictBuilder -&gt; StrictBuilder -&gt; StrictBuilder)
-&gt; (Word8 -&gt; StrictBuilder)
-&gt; Word8
-&gt; StrictBuilder
-&gt; StrictBuilder
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">OnDecodeError -&gt; String -&gt; Word8 -&gt; StrictBuilder
</span><a href="Data.Text.Internal.Encoding.html#handleUtf8Error"><span class="hs-identifier hs-var">handleUtf8Error</span></a></span><span> </span><span class="annot"><span class="annottext">OnDecodeError
</span><a href="#local-6989586621679126722"><span class="hs-identifier hs-var">onErr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679126723"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-458"></span><span>    </span><span class="annot"><span class="annottext">StrictBuilder
forall a. Monoid a =&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#mempty/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Utf8State -&gt; PartialUtf8CodePoint
</span><a href="Data.Text.Internal.Encoding.html#partialUtf8CodePoint"><span class="hs-identifier hs-var">partialUtf8CodePoint</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126724"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#handleUtf8Error"><span class="hs-pragma hs-type">handleUtf8Error</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-461"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#handleUtf8Error"><span class="hs-identifier hs-type">handleUtf8Error</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Text.Encoding.Error.html#OnDecodeError"><span class="hs-identifier hs-type">OnDecodeError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Word.html#Word8/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Text.Internal.StrictBuilder.html#StrictBuilder"><span class="hs-identifier hs-type">StrictBuilder</span></a></span><span>
</span><span id="line-462"></span><span id="handleUtf8Error"><span class="annot"><span class="annottext">handleUtf8Error :: OnDecodeError -&gt; String -&gt; Word8 -&gt; StrictBuilder
</span><a href="Data.Text.Internal.Encoding.html#handleUtf8Error"><span class="hs-identifier hs-var hs-var">handleUtf8Error</span></a></span></span><span> </span><span id="local-6989586621679126726"><span class="annot"><span class="annottext">OnDecodeError
</span><a href="#local-6989586621679126726"><span class="hs-identifier hs-var">onErr</span></a></span></span><span> </span><span id="local-6989586621679126727"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679126727"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679126728"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679126728"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OnDecodeError
</span><a href="#local-6989586621679126726"><span class="hs-identifier hs-var">onErr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679126727"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Maybe Word8
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679126728"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-463"></span><span>  </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679126729"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679126729"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char -&gt; StrictBuilder
</span><a href="Data.Text.Internal.StrictBuilder.html#fromChar"><span class="hs-identifier hs-var">SB.fromChar</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679126729"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-464"></span><span>  </span><span class="annot"><span class="annottext">Maybe Char
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StrictBuilder
forall a. Monoid a =&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#mempty/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span class="hs-comment">-- | Helper for 'Data.Text.Encoding.decodeUtf8With'.</span><span>
</span><span id="line-467"></span><span class="hs-comment">--</span><span>
</span><span id="line-468"></span><span class="hs-comment">-- @since 2.0.2</span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span class="hs-comment">-- This could be shorter by calling 'decodeUtf8With2' directly, but we make the</span><span>
</span><span id="line-471"></span><span class="hs-comment">-- first call validateUtf8Chunk directly to return even faster in successful</span><span>
</span><span id="line-472"></span><span class="hs-comment">-- cases.</span><span>
</span><span id="line-473"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#decodeUtf8With1"><span class="hs-identifier hs-type">decodeUtf8With1</span></a></span><span> </span><span class="hs-glyph">::</span><span class="hs-cpp">
#if defined(ASSERTS)
</span><span>  </span><span class="hs-identifier">HasCallStack</span><span> </span><span class="hs-glyph">=&gt;</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><a href="Data.Text.Encoding.Error.html#OnDecodeError"><span class="hs-identifier hs-type">OnDecodeError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.3/src/Data.ByteString.Internal.Type.html#ByteString/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-478"></span><span id="decodeUtf8With1"><span class="annot"><span class="annottext">decodeUtf8With1 :: OnDecodeError -&gt; String -&gt; ByteString -&gt; Text
</span><a href="Data.Text.Internal.Encoding.html#decodeUtf8With1"><span class="hs-identifier hs-var hs-var">decodeUtf8With1</span></a></span></span><span> </span><span id="local-6989586621679126731"><span class="annot"><span class="annottext">OnDecodeError
</span><a href="#local-6989586621679126731"><span class="hs-identifier hs-var">onErr</span></a></span></span><span> </span><span id="local-6989586621679126732"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679126732"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679126733"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126733"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; (Int -&gt; Maybe Utf8State -&gt; Text) -&gt; Text
forall r. Int -&gt; ByteString -&gt; (Int -&gt; Maybe Utf8State -&gt; r) -&gt; r
</span><a href="Data.Text.Internal.Encoding.html#validateUtf8ChunkFrom"><span class="hs-identifier hs-var">validateUtf8ChunkFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126733"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; Maybe Utf8State -&gt; Text) -&gt; Text)
-&gt; (Int -&gt; Maybe Utf8State -&gt; Text) -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679126734"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126734"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span id="local-6989586621679126735"><span class="annot"><span class="annottext">Maybe Utf8State
</span><a href="#local-6989586621679126735"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Utf8State
</span><a href="#local-6989586621679126735"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-479"></span><span>    </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679126736"><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126736"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-480"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126734"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#length/Data.ByteString.html#length"><span class="hs-identifier hs-var">B.length</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126733"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-481"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../bytestring-0.11.5.3/src/Data.ByteString.Short.Internal.html#SBS/Data.ByteString.Short.Internal.html#SBS"><span class="hs-identifier hs-type">SBS.SBS</span></a></span><span> </span><span id="local-6989586621679126738"><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621679126738"><span class="hs-identifier hs-var">arr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ShortByteString
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.Short.Internal.html#toShort/Data.ByteString.Short.Internal.html#toShort"><span class="hs-identifier hs-var">SBS.toShort</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126733"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-482"></span><span>        </span><span class="annot"><span class="annottext">Array -&gt; Int -&gt; Int -&gt; Text
</span><a href="Data.Text.Internal.html#Text"><span class="hs-identifier hs-var">Text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteArray# -&gt; Array
</span><a href="Data.Text.Array.html#ByteArray"><span class="hs-identifier hs-var">A.ByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621679126738"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126734"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-483"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StrictBuilder -&gt; Text
</span><a href="Data.Text.Internal.StrictBuilder.html#toText"><span class="hs-identifier hs-var">SB.toText</span></a></span><span> </span><span class="annot"><span class="annottext">(StrictBuilder -&gt; Text) -&gt; StrictBuilder -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-484"></span><span>          </span><span class="annot"><span class="annottext">ByteString -&gt; StrictBuilder
</span><a href="Data.Text.Internal.StrictBuilder.html#unsafeFromByteString"><span class="hs-identifier hs-var">SB.unsafeFromByteString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#take/Data.ByteString.html#take"><span class="hs-identifier hs-var">B.take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126734"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126733"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StrictBuilder -&gt; StrictBuilder -&gt; StrictBuilder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">OnDecodeError -&gt; String -&gt; Utf8State -&gt; StrictBuilder
</span><a href="Data.Text.Internal.Encoding.html#skipIncomplete"><span class="hs-identifier hs-var">skipIncomplete</span></a></span><span> </span><span class="annot"><span class="annottext">OnDecodeError
</span><a href="#local-6989586621679126731"><span class="hs-identifier hs-var">onErr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679126732"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126736"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-485"></span><span>    </span><span class="annot"><span class="annottext">Maybe Utf8State
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-486"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679126743"><span class="annot"><span class="annottext">StrictBuilder
</span><a href="#local-6989586621679126743"><span class="hs-identifier hs-var">builder</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679126744"><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126744"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OnDecodeError
-&gt; String
-&gt; Utf8State
-&gt; ByteString
-&gt; (StrictBuilder, ByteString, Utf8State)
</span><a href="Data.Text.Internal.Encoding.html#decodeUtf8With2"><span class="hs-identifier hs-var">decodeUtf8With2</span></a></span><span> </span><span class="annot"><span class="annottext">OnDecodeError
</span><a href="#local-6989586621679126731"><span class="hs-identifier hs-var">onErr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679126732"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State
</span><a href="Data.Text.Internal.Encoding.html#startUtf8State"><span class="hs-identifier hs-var">startUtf8State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#drop/Data.ByteString.html#drop"><span class="hs-identifier hs-var">B.drop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126734"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126733"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-487"></span><span>       </span><span class="annot"><span class="annottext">StrictBuilder -&gt; Text
</span><a href="Data.Text.Internal.StrictBuilder.html#toText"><span class="hs-identifier hs-var">SB.toText</span></a></span><span> </span><span class="annot"><span class="annottext">(StrictBuilder -&gt; Text) -&gt; StrictBuilder -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-488"></span><span>         </span><span class="annot"><span class="annottext">ByteString -&gt; StrictBuilder
</span><a href="Data.Text.Internal.StrictBuilder.html#unsafeFromByteString"><span class="hs-identifier hs-var">SB.unsafeFromByteString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#take/Data.ByteString.html#take"><span class="hs-identifier hs-var">B.take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126734"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126733"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StrictBuilder -&gt; StrictBuilder -&gt; StrictBuilder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-489"></span><span>         </span><span class="annot"><span class="annottext">OnDecodeError -&gt; String -&gt; Word8 -&gt; StrictBuilder
</span><a href="Data.Text.Internal.Encoding.html#handleUtf8Error"><span class="hs-identifier hs-var">handleUtf8Error</span></a></span><span> </span><span class="annot"><span class="annottext">OnDecodeError
</span><a href="#local-6989586621679126731"><span class="hs-identifier hs-var">onErr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679126732"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; ByteString -&gt; Int -&gt; Word8
ByteString -&gt; Int -&gt; Word8
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#index/Data.ByteString.html#index"><span class="hs-identifier hs-var">B.index</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126733"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126734"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StrictBuilder -&gt; StrictBuilder -&gt; StrictBuilder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-490"></span><span>         </span><span class="annot"><span class="annottext">StrictBuilder
</span><a href="#local-6989586621679126743"><span class="hs-identifier hs-var">builder</span></a></span><span> </span><span class="annot"><span class="annottext">StrictBuilder -&gt; StrictBuilder -&gt; StrictBuilder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-491"></span><span>         </span><span class="annot"><span class="annottext">OnDecodeError -&gt; String -&gt; Utf8State -&gt; StrictBuilder
</span><a href="Data.Text.Internal.Encoding.html#skipIncomplete"><span class="hs-identifier hs-var">skipIncomplete</span></a></span><span> </span><span class="annot"><span class="annottext">OnDecodeError
</span><a href="#local-6989586621679126731"><span class="hs-identifier hs-var">onErr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679126732"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126744"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span class="hs-comment">-- | Helper for 'Data.Text.Encoding.decodeUtf8With',</span><span>
</span><span id="line-494"></span><span class="hs-comment">-- 'Data.Text.Encoding.streamDecodeUtf8With', and lazy</span><span>
</span><span id="line-495"></span><span class="hs-comment">-- 'Data.Text.Lazy.Encoding.decodeUtf8With',</span><span>
</span><span id="line-496"></span><span class="hs-comment">-- which use an 'OnDecodeError' to process bad bytes.</span><span>
</span><span id="line-497"></span><span class="hs-comment">--</span><span>
</span><span id="line-498"></span><span class="hs-comment">-- See 'decodeUtf8Chunk' for a more flexible alternative.</span><span>
</span><span id="line-499"></span><span class="hs-comment">--</span><span>
</span><span id="line-500"></span><span class="hs-comment">-- @since 2.0.2</span><span>
</span><span id="line-501"></span><span class="annot"><a href="Data.Text.Internal.Encoding.html#decodeUtf8With2"><span class="hs-identifier hs-type">decodeUtf8With2</span></a></span><span> </span><span class="hs-glyph">::</span><span class="hs-cpp">
#if defined(ASSERTS)
</span><span>  </span><span class="hs-identifier">HasCallStack</span><span> </span><span class="hs-glyph">=&gt;</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><a href="Data.Text.Encoding.Error.html#OnDecodeError"><span class="hs-identifier hs-type">OnDecodeError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-type">Utf8State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.3/src/Data.ByteString.Internal.Type.html#ByteString/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Text.Internal.StrictBuilder.html#StrictBuilder"><span class="hs-identifier hs-type">StrictBuilder</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.3/src/Data.ByteString.Internal.Type.html#ByteString/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Text.Internal.Encoding.html#Utf8State"><span class="hs-identifier hs-type">Utf8State</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-506"></span><span id="decodeUtf8With2"><span class="annot"><span class="annottext">decodeUtf8With2 :: OnDecodeError
-&gt; String
-&gt; Utf8State
-&gt; ByteString
-&gt; (StrictBuilder, ByteString, Utf8State)
</span><a href="Data.Text.Internal.Encoding.html#decodeUtf8With2"><span class="hs-identifier hs-var hs-var">decodeUtf8With2</span></a></span></span><span> </span><span id="local-6989586621679126745"><span class="annot"><span class="annottext">OnDecodeError
</span><a href="#local-6989586621679126745"><span class="hs-identifier hs-var">onErr</span></a></span></span><span> </span><span id="local-6989586621679126746"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679126746"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679126747"><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126747"><span class="hs-identifier hs-var">s0</span></a></span></span><span> </span><span id="local-6989586621679126748"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126748"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Utf8State
-&gt; Int -&gt; StrictBuilder -&gt; (StrictBuilder, ByteString, Utf8State)
</span><a href="#local-6989586621679126749"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126747"><span class="hs-identifier hs-var">s0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">StrictBuilder
forall a. Monoid a =&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#mempty/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-507"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-508"></span><span>    </span><span id="local-6989586621679126749"><span class="annot"><span class="annottext">loop :: Utf8State
-&gt; Int -&gt; StrictBuilder -&gt; (StrictBuilder, ByteString, Utf8State)
</span><a href="#local-6989586621679126749"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679126755"><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126755"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679126756"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126756"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679126757"><span class="annot"><span class="annottext">StrictBuilder
</span><a href="#local-6989586621679126757"><span class="hs-identifier hs-var">builder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-509"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679126760"><span class="annot"><span class="annottext">nonEmptyPrefix :: Int -&gt; StrictBuilder
</span><a href="#local-6989586621679126760"><span class="hs-identifier hs-var hs-var">nonEmptyPrefix</span></a></span></span><span> </span><span id="local-6989586621679126761"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126761"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StrictBuilder
</span><a href="#local-6989586621679126757"><span class="hs-identifier hs-var">builder</span></a></span><span>
</span><span id="line-510"></span><span>            </span><span class="annot"><span class="annottext">StrictBuilder -&gt; StrictBuilder -&gt; StrictBuilder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State -&gt; StrictBuilder
</span><a href="Data.Text.Internal.Encoding.html#utf8StateToStrictBuilder"><span class="hs-identifier hs-var">utf8StateToStrictBuilder</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126755"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-511"></span><span>            </span><span class="annot"><span class="annottext">StrictBuilder -&gt; StrictBuilder -&gt; StrictBuilder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; StrictBuilder
</span><a href="Data.Text.Internal.StrictBuilder.html#unsafeFromByteString"><span class="hs-identifier hs-var">SB.unsafeFromByteString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#take/Data.ByteString.html#take"><span class="hs-identifier hs-var">B.take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126761"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#drop/Data.ByteString.html#drop"><span class="hs-identifier hs-var">B.drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126756"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126748"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-512"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Utf8State
-&gt; ByteString
-&gt; (Int
    -&gt; Maybe Utf8State -&gt; (StrictBuilder, ByteString, Utf8State))
-&gt; (StrictBuilder, ByteString, Utf8State)
forall r.
Utf8State -&gt; ByteString -&gt; (Int -&gt; Maybe Utf8State -&gt; r) -&gt; r
</span><a href="Data.Text.Internal.Encoding.html#validateUtf8MoreCont"><span class="hs-identifier hs-var">validateUtf8MoreCont</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126755"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#drop/Data.ByteString.html#drop"><span class="hs-identifier hs-var">B.drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126756"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126748"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; Maybe Utf8State -&gt; (StrictBuilder, ByteString, Utf8State))
 -&gt; (StrictBuilder, ByteString, Utf8State))
-&gt; (Int
    -&gt; Maybe Utf8State -&gt; (StrictBuilder, ByteString, Utf8State))
-&gt; (StrictBuilder, ByteString, Utf8State)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679126762"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126762"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span id="local-6989586621679126763"><span class="annot"><span class="annottext">Maybe Utf8State
</span><a href="#local-6989586621679126763"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Utf8State
</span><a href="#local-6989586621679126763"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-513"></span><span>        </span><span class="annot"><span class="annottext">Maybe Utf8State
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-514"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126762"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3C/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-515"></span><span>          </span><span class="hs-keyword">then</span><span>
</span><span id="line-516"></span><span>            </span><span class="hs-comment">-- If the first byte cannot complete the partial code point in s,</span><span>
</span><span id="line-517"></span><span>            </span><span class="hs-comment">-- retry from startUtf8State.</span><span>
</span><span id="line-518"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679126765"><span class="annot"><span class="annottext">builder' :: StrictBuilder
</span><a href="#local-6989586621679126765"><span class="hs-identifier hs-var hs-var">builder'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StrictBuilder
</span><a href="#local-6989586621679126757"><span class="hs-identifier hs-var">builder</span></a></span><span> </span><span class="annot"><span class="annottext">StrictBuilder -&gt; StrictBuilder -&gt; StrictBuilder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">OnDecodeError -&gt; String -&gt; Utf8State -&gt; StrictBuilder
</span><a href="Data.Text.Internal.Encoding.html#skipIncomplete"><span class="hs-identifier hs-var">skipIncomplete</span></a></span><span> </span><span class="annot"><span class="annottext">OnDecodeError
</span><a href="#local-6989586621679126745"><span class="hs-identifier hs-var">onErr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679126746"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126755"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-519"></span><span>            </span><span class="hs-comment">-- Note: loop is strict on builder, so if onErr raises an error it will</span><span>
</span><span id="line-520"></span><span>            </span><span class="hs-comment">-- be forced here, short-circuiting the loop as desired.</span><span>
</span><span id="line-521"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Utf8State
-&gt; Int -&gt; StrictBuilder -&gt; (StrictBuilder, ByteString, Utf8State)
</span><a href="#local-6989586621679126749"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State
</span><a href="Data.Text.Internal.Encoding.html#startUtf8State"><span class="hs-identifier hs-var">startUtf8State</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126756"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">StrictBuilder
</span><a href="#local-6989586621679126765"><span class="hs-identifier hs-var">builder'</span></a></span><span>
</span><span id="line-522"></span><span>          </span><span class="hs-keyword">else</span><span>
</span><span id="line-523"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679126770"><span class="annot"><span class="annottext">builder' :: StrictBuilder
</span><a href="#local-6989586621679126770"><span class="hs-identifier hs-var hs-var">builder'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; StrictBuilder
</span><a href="#local-6989586621679126760"><span class="hs-identifier hs-var">nonEmptyPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126762"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-524"></span><span>                  </span><span class="annot"><span class="annottext">StrictBuilder -&gt; StrictBuilder -&gt; StrictBuilder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">OnDecodeError -&gt; String -&gt; Word8 -&gt; StrictBuilder
</span><a href="Data.Text.Internal.Encoding.html#handleUtf8Error"><span class="hs-identifier hs-var">handleUtf8Error</span></a></span><span> </span><span class="annot"><span class="annottext">OnDecodeError
</span><a href="#local-6989586621679126745"><span class="hs-identifier hs-var">onErr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679126746"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; ByteString -&gt; Int -&gt; Word8
ByteString -&gt; Int -&gt; Word8
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#index/Data.ByteString.html#index"><span class="hs-identifier hs-var">B.index</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126748"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126756"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126762"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Utf8State
-&gt; Int -&gt; StrictBuilder -&gt; (StrictBuilder, ByteString, Utf8State)
</span><a href="#local-6989586621679126749"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State
</span><a href="Data.Text.Internal.Encoding.html#startUtf8State"><span class="hs-identifier hs-var">startUtf8State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126756"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126762"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StrictBuilder
</span><a href="#local-6989586621679126770"><span class="hs-identifier hs-var">builder'</span></a></span><span>
</span><span id="line-526"></span><span>        </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679126771"><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126771"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-527"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679126774"><span class="annot"><span class="annottext">builder' :: StrictBuilder
</span><a href="#local-6989586621679126774"><span class="hs-identifier hs-var hs-var">builder'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126762"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">StrictBuilder
</span><a href="#local-6989586621679126757"><span class="hs-identifier hs-var">builder</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int -&gt; StrictBuilder
</span><a href="#local-6989586621679126760"><span class="hs-identifier hs-var">nonEmptyPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126762"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-528"></span><span>              </span><span id="local-6989586621679126777"><span class="annot"><span class="annottext">undecoded :: ByteString
</span><a href="#local-6989586621679126777"><span class="hs-identifier hs-var hs-var">undecoded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#length/Data.ByteString.html#length"><span class="hs-identifier hs-var">B.length</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126748"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3E%3D/GHC.Classes.html#%3E%3D"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint -&gt; Int
</span><a href="Data.Text.Internal.Encoding.html#partUtf8Len"><span class="hs-identifier hs-var">partUtf8Len</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Utf8State -&gt; PartialUtf8CodePoint
</span><a href="Data.Text.Internal.Encoding.html#partialUtf8CodePoint"><span class="hs-identifier hs-var">partialUtf8CodePoint</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126771"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><a href="../../bytestring-0.11.5.3/src/Data.ByteString.html#drop/Data.ByteString.html#drop"><span class="hs-identifier hs-var">B.drop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126756"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126762"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126748"><span class="hs-identifier hs-var">bs</span></a></span><span>  </span><span class="hs-comment">-- Reuse bs if possible</span><span>
</span><span id="line-530"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">PartialUtf8CodePoint -&gt; ByteString
</span><a href="Data.Text.Internal.Encoding.html#partUtf8ToByteString"><span class="hs-identifier hs-var">partUtf8ToByteString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Utf8State -&gt; PartialUtf8CodePoint
</span><a href="Data.Text.Internal.Encoding.html#partialUtf8CodePoint"><span class="hs-identifier hs-var">partialUtf8CodePoint</span></a></span><span> </span><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126771"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StrictBuilder
</span><a href="#local-6989586621679126774"><span class="hs-identifier hs-var">builder'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126777"><span class="hs-identifier hs-var">undecoded</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Utf8State
</span><a href="#local-6989586621679126771"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-532"></span></pre></body></html>