<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP, RankNTypes, DeriveDataTypeable, BangPatterns #-}</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 702
</span><span class="hs-pragma">{-# LANGUAGE Trustworthy #-}</span><span class="hs-cpp">
#endif
</span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Copyright   :  (c) 2006-2015 Duncan Coutts</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- License     :  BSD-style</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Maintainer  :  duncan@community.haskell.org</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- Pure and IO stream based interfaces to lower level zlib wrapper</span><span>
</span><span id="line-13"></span><span class="hs-comment">--</span><span>
</span><span id="line-14"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-15"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Codec.Compression.Zlib.Internal</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Pure interface</span></span><span>
</span><span id="line-18"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#compress"><span class="hs-identifier">compress</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#decompress"><span class="hs-identifier">decompress</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Monadic incremental interface</span></span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><span class="hs-comment">-- $incremental-compression</span></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Using incremental compression</span></span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><span class="hs-comment">-- $using-incremental-compression</span></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressStream"><span class="hs-identifier">CompressStream</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#compressST"><span class="hs-identifier">compressST</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#compressIO"><span class="hs-identifier">compressIO</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#foldCompressStream"><span class="hs-identifier">foldCompressStream</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#foldCompressStreamWithInput"><span class="hs-identifier">foldCompressStreamWithInput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Using incremental decompression</span></span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><span class="hs-comment">-- $using-incremental-decompression</span></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier">DecompressStream</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressError"><span class="hs-identifier">DecompressError</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#decompressST"><span class="hs-identifier">decompressST</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#decompressIO"><span class="hs-identifier">decompressIO</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#foldDecompressStream"><span class="hs-identifier">foldDecompressStream</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#foldDecompressStreamWithInput"><span class="hs-identifier">foldDecompressStreamWithInput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><span class="hs-comment">-- * The compression parameter types</span></span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressParams"><span class="hs-identifier">CompressParams</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#defaultCompressParams"><span class="hs-identifier">defaultCompressParams</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressParams"><span class="hs-identifier">DecompressParams</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#defaultDecompressParams"><span class="hs-identifier">defaultDecompressParams</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Format"><span class="hs-identifier">Stream.Format</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#gzipFormat"><span class="hs-identifier">Stream.gzipFormat</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#zlibFormat"><span class="hs-identifier">Stream.zlibFormat</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#rawFormat"><span class="hs-identifier">Stream.rawFormat</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#gzipOrZlibFormat"><span class="hs-identifier">Stream.gzipOrZlibFormat</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#CompressionLevel"><span class="hs-identifier">Stream.CompressionLevel</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#defaultCompression"><span class="hs-identifier">Stream.defaultCompression</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#noCompression"><span class="hs-identifier">Stream.noCompression</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#bestSpeed"><span class="hs-identifier">Stream.bestSpeed</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#bestCompression"><span class="hs-identifier">Stream.bestCompression</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#compressionLevel"><span class="hs-identifier">Stream.compressionLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Method"><span class="hs-identifier">Stream.Method</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#deflateMethod"><span class="hs-identifier">Stream.deflateMethod</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#WindowBits"><span class="hs-identifier">Stream.WindowBits</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#defaultWindowBits"><span class="hs-identifier">Stream.defaultWindowBits</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#windowBits"><span class="hs-identifier">Stream.windowBits</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#MemoryLevel"><span class="hs-identifier">Stream.MemoryLevel</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#defaultMemoryLevel"><span class="hs-identifier">Stream.defaultMemoryLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#minMemoryLevel"><span class="hs-identifier">Stream.minMemoryLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#maxMemoryLevel"><span class="hs-identifier">Stream.maxMemoryLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#memoryLevel"><span class="hs-identifier">Stream.memoryLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#CompressionStrategy"><span class="hs-identifier">Stream.CompressionStrategy</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#defaultStrategy"><span class="hs-identifier">Stream.defaultStrategy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#filteredStrategy"><span class="hs-identifier">Stream.filteredStrategy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#huffmanOnlyStrategy"><span class="hs-identifier">Stream.huffmanOnlyStrategy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">length</span></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Exception</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throw</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">assert</span></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.ST.Lazy</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">stToIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.ST.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">stToIO</span></span><span class="hs-special">)</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 702
</span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.ST.Unsafe</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Unsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafeIOToST</span></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Monad.ST.Strict</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Unsafe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeIOToST</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Typeable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Typeable</span></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy.Internal</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Internal</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Word8</span></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">noDuplicate</span></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html"><span class="hs-identifier">Codec.Compression.Zlib.Stream</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Stream</span></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.ByteStringCompat.html"><span class="hs-identifier">Codec.Compression.Zlib.ByteStringCompat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.ByteStringCompat.html#mkBS"><span class="hs-identifier">mkBS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.ByteStringCompat.html#withBS"><span class="hs-identifier">withBS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html"><span class="hs-identifier">Codec.Compression.Zlib.Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier">Stream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">-- | The full set of parameters for compression. The defaults are</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- 'defaultCompressParams'.</span><span>
</span><span id="line-100"></span><span class="hs-comment">--</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- The 'compressBufferSize' is the size of the first output buffer containing</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- the compressed data. If you know an approximate upper bound on the size of</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- the compressed data then setting this parameter can save memory. The default</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- compression output buffer size is @16k@. If your estimate is wrong it does</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- not matter too much, the default buffer size will be used for the remaining</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- chunks.</span><span>
</span><span id="line-107"></span><span class="hs-comment">--</span><span>
</span><span id="line-108"></span><span class="hs-keyword">data</span><span> </span><span id="CompressParams"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressParams"><span class="hs-identifier hs-var">CompressParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CompressParams"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressParams"><span class="hs-identifier hs-var">CompressParams</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-109"></span><span>  </span><span id="compressLevel"><span class="annot"><span class="annottext">CompressParams -&gt; CompressionLevel
</span><a href="Codec.Compression.Zlib.Internal.html#compressLevel"><span class="hs-identifier hs-var hs-var">compressLevel</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#CompressionLevel"><span class="hs-identifier hs-type">Stream.CompressionLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>  </span><span id="compressMethod"><span class="annot"><span class="annottext">CompressParams -&gt; Method
</span><a href="Codec.Compression.Zlib.Internal.html#compressMethod"><span class="hs-identifier hs-var hs-var">compressMethod</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Method"><span class="hs-identifier hs-type">Stream.Method</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>  </span><span id="compressWindowBits"><span class="annot"><span class="annottext">CompressParams -&gt; WindowBits
</span><a href="Codec.Compression.Zlib.Internal.html#compressWindowBits"><span class="hs-identifier hs-var hs-var">compressWindowBits</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#WindowBits"><span class="hs-identifier hs-type">Stream.WindowBits</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>  </span><span id="compressMemoryLevel"><span class="annot"><span class="annottext">CompressParams -&gt; MemoryLevel
</span><a href="Codec.Compression.Zlib.Internal.html#compressMemoryLevel"><span class="hs-identifier hs-var hs-var">compressMemoryLevel</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#MemoryLevel"><span class="hs-identifier hs-type">Stream.MemoryLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-113"></span><span>  </span><span id="compressStrategy"><span class="annot"><span class="annottext">CompressParams -&gt; CompressionStrategy
</span><a href="Codec.Compression.Zlib.Internal.html#compressStrategy"><span class="hs-identifier hs-var hs-var">compressStrategy</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#CompressionStrategy"><span class="hs-identifier hs-type">Stream.CompressionStrategy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-114"></span><span>  </span><span id="compressBufferSize"><span class="annot"><span class="annottext">CompressParams -&gt; Int
</span><a href="Codec.Compression.Zlib.Internal.html#compressBufferSize"><span class="hs-identifier hs-var hs-var">compressBufferSize</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-115"></span><span>  </span><span id="compressDictionary"><span class="annot"><span class="annottext">CompressParams -&gt; Maybe ByteString
</span><a href="Codec.Compression.Zlib.Internal.html#compressDictionary"><span class="hs-identifier hs-var hs-var">compressDictionary</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span>
</span><span id="line-116"></span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679057124"><span id="local-6989586621679057142"><span id="local-6989586621679057146"><span class="annot"><span class="annottext">Int -&gt; CompressParams -&gt; ShowS
[CompressParams] -&gt; ShowS
CompressParams -&gt; String
(Int -&gt; CompressParams -&gt; ShowS)
-&gt; (CompressParams -&gt; String)
-&gt; ([CompressParams] -&gt; ShowS)
-&gt; Show CompressParams
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; CompressParams -&gt; ShowS
showsPrec :: Int -&gt; CompressParams -&gt; ShowS
$cshow :: CompressParams -&gt; String
show :: CompressParams -&gt; String
$cshowList :: [CompressParams] -&gt; ShowS
showList :: [CompressParams] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">-- | The full set of parameters for decompression. The defaults are</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- 'defaultDecompressParams'.</span><span>
</span><span id="line-120"></span><span class="hs-comment">--</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- The 'decompressBufferSize' is the size of the first output buffer,</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- containing the uncompressed data. If you know an exact or approximate upper</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- bound on the size of the decompressed data then setting this parameter can</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- save memory. The default decompression output buffer size is @32k@. If your</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- estimate is wrong it does not matter too much, the default buffer size will</span><span>
</span><span id="line-126"></span><span class="hs-comment">-- be used for the remaining chunks.</span><span>
</span><span id="line-127"></span><span class="hs-comment">--</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- One particular use case for setting the 'decompressBufferSize' is if you</span><span>
</span><span id="line-129"></span><span class="hs-comment">-- know the exact size of the decompressed data and want to produce a strict</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- 'Data.ByteString.ByteString'. The compression and decompression functions</span><span>
</span><span id="line-131"></span><span class="hs-comment">-- use lazy 'Data.ByteString.Lazy.ByteString's but if you set the</span><span>
</span><span id="line-132"></span><span class="hs-comment">-- 'decompressBufferSize' correctly then you can generate a lazy</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- 'Data.ByteString.Lazy.ByteString' with exactly one chunk, which can be</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- converted to a strict 'Data.ByteString.ByteString' in @O(1)@ time using</span><span>
</span><span id="line-135"></span><span class="hs-comment">-- @'Data.ByteString.concat' . 'Data.ByteString.Lazy.toChunks'@.</span><span>
</span><span id="line-136"></span><span class="hs-comment">--</span><span>
</span><span id="line-137"></span><span class="hs-keyword">data</span><span> </span><span id="DecompressParams"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressParams"><span class="hs-identifier hs-var">DecompressParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DecompressParams"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressParams"><span class="hs-identifier hs-var">DecompressParams</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-138"></span><span>  </span><span id="decompressWindowBits"><span class="annot"><span class="annottext">DecompressParams -&gt; WindowBits
</span><a href="Codec.Compression.Zlib.Internal.html#decompressWindowBits"><span class="hs-identifier hs-var hs-var">decompressWindowBits</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#WindowBits"><span class="hs-identifier hs-type">Stream.WindowBits</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-139"></span><span>  </span><span id="decompressBufferSize"><span class="annot"><span class="annottext">DecompressParams -&gt; Int
</span><a href="Codec.Compression.Zlib.Internal.html#decompressBufferSize"><span class="hs-identifier hs-var hs-var">decompressBufferSize</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-140"></span><span>  </span><span id="decompressDictionary"><span class="annot"><span class="annottext">DecompressParams -&gt; Maybe ByteString
</span><a href="Codec.Compression.Zlib.Internal.html#decompressDictionary"><span class="hs-identifier hs-var hs-var">decompressDictionary</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span class="hs-special">,</span><span>
</span><span id="line-141"></span><span>  </span><span id="decompressAllMembers"><span class="annot"><span class="annottext">DecompressParams -&gt; Bool
</span><a href="Codec.Compression.Zlib.Internal.html#decompressAllMembers"><span class="hs-identifier hs-var hs-var">decompressAllMembers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-142"></span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679057156"><span id="local-6989586621679057165"><span id="local-6989586621679057169"><span class="annot"><span class="annottext">Int -&gt; DecompressParams -&gt; ShowS
[DecompressParams] -&gt; ShowS
DecompressParams -&gt; String
(Int -&gt; DecompressParams -&gt; ShowS)
-&gt; (DecompressParams -&gt; String)
-&gt; ([DecompressParams] -&gt; ShowS)
-&gt; Show DecompressParams
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; DecompressParams -&gt; ShowS
showsPrec :: Int -&gt; DecompressParams -&gt; ShowS
$cshow :: DecompressParams -&gt; String
show :: DecompressParams -&gt; String
$cshowList :: [DecompressParams] -&gt; ShowS
showList :: [DecompressParams] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="hs-comment">-- | The default set of parameters for compression. This is typically used with</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- the @compressWith@ function with specific parameters overridden.</span><span>
</span><span id="line-146"></span><span class="hs-comment">--</span><span>
</span><span id="line-147"></span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#defaultCompressParams"><span class="hs-identifier hs-type">defaultCompressParams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressParams"><span class="hs-identifier hs-type">CompressParams</span></a></span><span>
</span><span id="line-148"></span><span id="defaultCompressParams"><span class="annot"><span class="annottext">defaultCompressParams :: CompressParams
</span><a href="Codec.Compression.Zlib.Internal.html#defaultCompressParams"><span class="hs-identifier hs-var hs-var">defaultCompressParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressParams"><span class="hs-identifier hs-type">CompressParams</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-149"></span><span>  </span><span class="annot"><span class="annottext">compressLevel :: CompressionLevel
</span><a href="Codec.Compression.Zlib.Internal.html#compressLevel"><span class="hs-identifier hs-var">compressLevel</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompressionLevel
</span><a href="Codec.Compression.Zlib.Stream.html#defaultCompression"><span class="hs-identifier hs-var">Stream.defaultCompression</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><span class="annottext">compressMethod :: Method
</span><a href="Codec.Compression.Zlib.Internal.html#compressMethod"><span class="hs-identifier hs-var">compressMethod</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Method
</span><a href="Codec.Compression.Zlib.Stream.html#deflateMethod"><span class="hs-identifier hs-var">Stream.deflateMethod</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-151"></span><span>  </span><span class="annot"><span class="annottext">compressWindowBits :: WindowBits
</span><a href="Codec.Compression.Zlib.Internal.html#compressWindowBits"><span class="hs-identifier hs-var">compressWindowBits</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WindowBits
</span><a href="Codec.Compression.Zlib.Stream.html#defaultWindowBits"><span class="hs-identifier hs-var">Stream.defaultWindowBits</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-152"></span><span>  </span><span class="annot"><span class="annottext">compressMemoryLevel :: MemoryLevel
</span><a href="Codec.Compression.Zlib.Internal.html#compressMemoryLevel"><span class="hs-identifier hs-var">compressMemoryLevel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MemoryLevel
</span><a href="Codec.Compression.Zlib.Stream.html#defaultMemoryLevel"><span class="hs-identifier hs-var">Stream.defaultMemoryLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-153"></span><span>  </span><span class="annot"><span class="annottext">compressStrategy :: CompressionStrategy
</span><a href="Codec.Compression.Zlib.Internal.html#compressStrategy"><span class="hs-identifier hs-var">compressStrategy</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompressionStrategy
</span><a href="Codec.Compression.Zlib.Stream.html#defaultStrategy"><span class="hs-identifier hs-var">Stream.defaultStrategy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-154"></span><span>  </span><span class="annot"><span class="annottext">compressBufferSize :: Int
</span><a href="Codec.Compression.Zlib.Internal.html#compressBufferSize"><span class="hs-identifier hs-var">compressBufferSize</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Codec.Compression.Zlib.Internal.html#defaultCompressBufferSize"><span class="hs-identifier hs-var">defaultCompressBufferSize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-155"></span><span>  </span><span class="annot"><span class="annottext">compressDictionary :: Maybe ByteString
</span><a href="Codec.Compression.Zlib.Internal.html#compressDictionary"><span class="hs-identifier hs-var">compressDictionary</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-156"></span><span class="hs-special">}</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-comment">-- | The default set of parameters for decompression. This is typically used with</span><span>
</span><span id="line-159"></span><span class="hs-comment">-- the @compressWith@ function with specific parameters overridden.</span><span>
</span><span id="line-160"></span><span class="hs-comment">--</span><span>
</span><span id="line-161"></span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#defaultDecompressParams"><span class="hs-identifier hs-type">defaultDecompressParams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressParams"><span class="hs-identifier hs-type">DecompressParams</span></a></span><span>
</span><span id="line-162"></span><span id="defaultDecompressParams"><span class="annot"><span class="annottext">defaultDecompressParams :: DecompressParams
</span><a href="Codec.Compression.Zlib.Internal.html#defaultDecompressParams"><span class="hs-identifier hs-var hs-var">defaultDecompressParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressParams"><span class="hs-identifier hs-type">DecompressParams</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><span class="annottext">decompressWindowBits :: WindowBits
</span><a href="Codec.Compression.Zlib.Internal.html#decompressWindowBits"><span class="hs-identifier hs-var">decompressWindowBits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WindowBits
</span><a href="Codec.Compression.Zlib.Stream.html#defaultWindowBits"><span class="hs-identifier hs-var">Stream.defaultWindowBits</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><span class="annottext">decompressBufferSize :: Int
</span><a href="Codec.Compression.Zlib.Internal.html#decompressBufferSize"><span class="hs-identifier hs-var">decompressBufferSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Codec.Compression.Zlib.Internal.html#defaultDecompressBufferSize"><span class="hs-identifier hs-var">defaultDecompressBufferSize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><span class="annottext">decompressDictionary :: Maybe ByteString
</span><a href="Codec.Compression.Zlib.Internal.html#decompressDictionary"><span class="hs-identifier hs-var">decompressDictionary</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-166"></span><span>  </span><span class="annot"><span class="annottext">decompressAllMembers :: Bool
</span><a href="Codec.Compression.Zlib.Internal.html#decompressAllMembers"><span class="hs-identifier hs-var">decompressAllMembers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-167"></span><span class="hs-special">}</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-comment">-- | The default chunk sizes for the output of compression and decompression</span><span>
</span><span id="line-170"></span><span class="hs-comment">-- are 16k and 32k respectively (less a small accounting overhead).</span><span>
</span><span id="line-171"></span><span class="hs-comment">--</span><span>
</span><span id="line-172"></span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#defaultCompressBufferSize"><span class="hs-identifier hs-type">defaultCompressBufferSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#defaultDecompressBufferSize"><span class="hs-identifier hs-type">defaultDecompressBufferSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-173"></span><span id="defaultCompressBufferSize"><span class="annot"><span class="annottext">defaultCompressBufferSize :: Int
</span><a href="Codec.Compression.Zlib.Internal.html#defaultCompressBufferSize"><span class="hs-identifier hs-var hs-var">defaultCompressBufferSize</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1024</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier hs-var">L.chunkOverhead</span></span><span>
</span><span id="line-174"></span><span id="defaultDecompressBufferSize"><span class="annot"><span class="annottext">defaultDecompressBufferSize :: Int
</span><a href="Codec.Compression.Zlib.Internal.html#defaultDecompressBufferSize"><span class="hs-identifier hs-var hs-var">defaultDecompressBufferSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1024</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier hs-var">L.chunkOverhead</span></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-comment">-- | The unfolding of the decompression process, where you provide a sequence</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- of compressed data chunks as input and receive a sequence of uncompressed</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- data chunks as output. The process is incremental, in that the demand for</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- input and provision of output are interleaved.</span><span>
</span><span id="line-180"></span><span class="hs-comment">--</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- To indicate the end of the input supply an empty input chunk. Note that</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- for 'gzipFormat' with the default 'decompressAllMembers' @True@ you will</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- have to do this, as the decompressor will look for any following members.</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- With 'decompressAllMembers' @False@ the decompressor knows when the data</span><span>
</span><span id="line-185"></span><span class="hs-comment">-- ends and will produce 'DecompressStreamEnd' without you having to supply an</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- empty chunk to indicate the end of the input.</span><span>
</span><span id="line-187"></span><span class="hs-comment">--</span><span>
</span><span id="line-188"></span><span class="hs-keyword">data</span><span> </span><span id="DecompressStream"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-var">DecompressStream</span></a></span></span><span> </span><span id="local-6989586621679056771"><span class="annot"><a href="#local-6989586621679056771"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span>     </span><span id="DecompressInputRequired"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressInputRequired"><span class="hs-identifier hs-var">DecompressInputRequired</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-191"></span><span>         </span><span id="decompressSupplyInput"><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
DecompressStream m -&gt; ByteString -&gt; m (DecompressStream m)
</span><a href="Codec.Compression.Zlib.Internal.html#decompressSupplyInput"><span class="hs-identifier hs-var hs-var">decompressSupplyInput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056771"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056771"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DecompressOutputAvailable"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressOutputAvailable"><span class="hs-identifier hs-var">DecompressOutputAvailable</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-195"></span><span>         </span><span id="decompressOutput"><span class="annot"><span class="annottext">forall (m :: * -&gt; *). DecompressStream m -&gt; ByteString
</span><a href="Codec.Compression.Zlib.Internal.html#decompressOutput"><span class="hs-identifier hs-var hs-var">decompressOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span class="hs-special">,</span><span>
</span><span id="line-196"></span><span>         </span><span id="decompressNext"><span class="annot"><span class="annottext">forall (m :: * -&gt; *). DecompressStream m -&gt; m (DecompressStream m)
</span><a href="Codec.Compression.Zlib.Internal.html#decompressNext"><span class="hs-identifier hs-var hs-var">decompressNext</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679056771"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056771"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>   </span><span class="annot"><span class="hs-comment">-- | Includes any trailing unconsumed /input/ data.</span></span><span>
</span><span id="line-200"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DecompressStreamEnd"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStreamEnd"><span class="hs-identifier hs-var">DecompressStreamEnd</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-201"></span><span>         </span><span id="decompressUnconsumedInput"><span class="annot"><span class="annottext">forall (m :: * -&gt; *). DecompressStream m -&gt; ByteString
</span><a href="Codec.Compression.Zlib.Internal.html#decompressUnconsumedInput"><span class="hs-identifier hs-var hs-var">decompressUnconsumedInput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span>
</span><span id="line-202"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span>   </span><span class="annot"><span class="hs-comment">-- | An error code</span></span><span>
</span><span id="line-205"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DecompressStreamError"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStreamError"><span class="hs-identifier hs-var">DecompressStreamError</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-206"></span><span>         </span><span id="decompressStreamError"><span class="annot"><span class="annottext">forall (m :: * -&gt; *). DecompressStream m -&gt; DecompressError
</span><a href="Codec.Compression.Zlib.Internal.html#decompressStreamError"><span class="hs-identifier hs-var hs-var">decompressStreamError</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressError"><span class="hs-identifier hs-type">DecompressError</span></a></span><span>
</span><span id="line-207"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="hs-comment">-- | The possible error cases when decompressing a stream.</span><span>
</span><span id="line-210"></span><span class="hs-comment">--</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- This can be 'show'n to give a human readable error message.</span><span>
</span><span id="line-212"></span><span class="hs-comment">--</span><span>
</span><span id="line-213"></span><span class="hs-keyword">data</span><span> </span><span id="DecompressError"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressError"><span class="hs-identifier hs-var">DecompressError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-214"></span><span>     </span><span class="hs-comment">-- | The compressed data stream ended prematurely. This may happen if the</span><span>
</span><span id="line-215"></span><span>     </span><span class="hs-comment">-- input data stream was truncated.</span><span>
</span><span id="line-216"></span><span>     </span><span id="TruncatedInput"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#TruncatedInput"><span class="hs-identifier hs-var">TruncatedInput</span></a></span></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span>     </span><span class="hs-comment">-- | It is possible to do zlib compression with a custom dictionary. This</span><span>
</span><span id="line-219"></span><span>     </span><span class="hs-comment">-- allows slightly higher compression ratios for short files. However such</span><span>
</span><span id="line-220"></span><span>     </span><span class="hs-comment">-- compressed streams require the same dictionary when decompressing. This</span><span>
</span><span id="line-221"></span><span>     </span><span class="hs-comment">-- error is for when we encounter a compressed stream that needs a</span><span>
</span><span id="line-222"></span><span>     </span><span class="hs-comment">-- dictionary, and it's not provided.</span><span>
</span><span id="line-223"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DictionaryRequired"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DictionaryRequired"><span class="hs-identifier hs-var">DictionaryRequired</span></a></span></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span>     </span><span class="hs-comment">-- | If the stream requires a dictionary and you provide one with the</span><span>
</span><span id="line-226"></span><span>     </span><span class="hs-comment">-- wrong 'DictionaryHash' then you will get this error.</span><span>
</span><span id="line-227"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DictionaryMismatch"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DictionaryMismatch"><span class="hs-identifier hs-var">DictionaryMismatch</span></a></span></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span>     </span><span class="hs-comment">-- | If the compressed data stream is corrupted in any way then you will</span><span>
</span><span id="line-230"></span><span>     </span><span class="hs-comment">-- get this error, for example if the input data just isn't a compressed</span><span>
</span><span id="line-231"></span><span>     </span><span class="hs-comment">-- zlib data stream. In particular if the data checksum turns out to be</span><span>
</span><span id="line-232"></span><span>     </span><span class="hs-comment">-- wrong then you will get all the decompressed data but this error at the</span><span>
</span><span id="line-233"></span><span>     </span><span class="hs-comment">-- end, instead of the normal successful 'StreamEnd'.</span><span>
</span><span id="line-234"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DataFormatError"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DataFormatError"><span class="hs-identifier hs-var">DataFormatError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679057190"><span id="local-6989586621679057195"><span class="annot"><span class="annottext">DecompressError -&gt; DecompressError -&gt; Bool
(DecompressError -&gt; DecompressError -&gt; Bool)
-&gt; (DecompressError -&gt; DecompressError -&gt; Bool)
-&gt; Eq DecompressError
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: DecompressError -&gt; DecompressError -&gt; Bool
== :: DecompressError -&gt; DecompressError -&gt; Bool
$c/= :: DecompressError -&gt; DecompressError -&gt; Bool
/= :: DecompressError -&gt; DecompressError -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679057201"><span id="local-6989586621679057206"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressError"><span class="hs-identifier hs-type">DecompressError</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-238"></span><span>  </span><span id="local-6989586621679057208"><span class="annot"><span class="annottext">show :: DecompressError -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span class="annot"><span class="annottext">DecompressError
</span><a href="Codec.Compression.Zlib.Internal.html#TruncatedInput"><span class="hs-identifier hs-var">TruncatedInput</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShowS
</span><a href="Codec.Compression.Zlib.Internal.html#modprefix"><span class="hs-identifier hs-var">modprefix</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;premature end of compressed data stream&quot;</span></span><span>
</span><span id="line-239"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">DecompressError
</span><a href="Codec.Compression.Zlib.Internal.html#DictionaryRequired"><span class="hs-identifier hs-var">DictionaryRequired</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShowS
</span><a href="Codec.Compression.Zlib.Internal.html#modprefix"><span class="hs-identifier hs-var">modprefix</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;compressed data stream requires custom dictionary&quot;</span></span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">DecompressError
</span><a href="Codec.Compression.Zlib.Internal.html#DictionaryMismatch"><span class="hs-identifier hs-var">DictionaryMismatch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShowS
</span><a href="Codec.Compression.Zlib.Internal.html#modprefix"><span class="hs-identifier hs-var">modprefix</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;given dictionary does not match the expected one&quot;</span></span><span>
</span><span id="line-241"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DataFormatError"><span class="hs-identifier hs-type">DataFormatError</span></a></span><span> </span><span id="local-6989586621679057210"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057210"><span class="hs-identifier hs-var">detail</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShowS
</span><a href="Codec.Compression.Zlib.Internal.html#modprefix"><span class="hs-identifier hs-var">modprefix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;compressed data stream format error (&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057210"><span class="hs-identifier hs-var">detail</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#modprefix"><span class="hs-identifier hs-type">modprefix</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShowS</span></span><span>
</span><span id="line-244"></span><span id="modprefix"><span class="annot"><span class="annottext">modprefix :: ShowS
</span><a href="Codec.Compression.Zlib.Internal.html#modprefix"><span class="hs-identifier hs-var hs-var">modprefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Codec.Compression.Zlib: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679057216"><span id="local-6989586621679057219"><span id="local-6989586621679057222"><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressError"><span class="hs-identifier hs-type">DecompressError</span></a></span></span></span></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span class="hs-comment">-- | A fold over the 'DecompressStream' in the given monad.</span><span>
</span><span id="line-249"></span><span class="hs-comment">--</span><span>
</span><span id="line-250"></span><span class="hs-comment">-- One way to look at this is that it runs the stream, using callback functions</span><span>
</span><span id="line-251"></span><span class="hs-comment">-- for the four stream events.</span><span>
</span><span id="line-252"></span><span class="hs-comment">--</span><span>
</span><span id="line-253"></span><span id="local-6989586621679056783"><span id="local-6989586621679056784"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#foldDecompressStream"><span class="hs-identifier hs-type">foldDecompressStream</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679056783"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-254"></span><span>                     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056783"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056784"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056783"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056784"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056783"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056784"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056783"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056784"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056783"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056784"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressError"><span class="hs-identifier hs-type">DecompressError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056783"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056784"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056783"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056783"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056784"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-259"></span><span id="foldDecompressStream"><span class="annot"><span class="annottext">foldDecompressStream :: forall (m :: * -&gt; *) a.
Monad m =&gt;
((ByteString -&gt; m a) -&gt; m a)
-&gt; (ByteString -&gt; m a -&gt; m a)
-&gt; (ByteString -&gt; m a)
-&gt; (DecompressError -&gt; m a)
-&gt; DecompressStream m
-&gt; m a
</span><a href="Codec.Compression.Zlib.Internal.html#foldDecompressStream"><span class="hs-identifier hs-var hs-var">foldDecompressStream</span></a></span></span><span> </span><span id="local-6989586621679057230"><span class="annot"><span class="annottext">(ByteString -&gt; m a) -&gt; m a
</span><a href="#local-6989586621679057230"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621679057231"><span class="annot"><span class="annottext">ByteString -&gt; m a -&gt; m a
</span><a href="#local-6989586621679057231"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span id="local-6989586621679057232"><span class="annot"><span class="annottext">ByteString -&gt; m a
</span><a href="#local-6989586621679057232"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span id="local-6989586621679057233"><span class="annot"><span class="annottext">DecompressError -&gt; m a
</span><a href="#local-6989586621679057233"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DecompressStream m -&gt; m a
</span><a href="#local-6989586621679057234"><span class="hs-identifier hs-var">fold</span></a></span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-261"></span><span>    </span><span id="local-6989586621679057234"><span class="annot"><span class="annottext">fold :: DecompressStream m -&gt; m a
</span><a href="#local-6989586621679057234"><span class="hs-identifier hs-var hs-var">fold</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressInputRequired"><span class="hs-identifier hs-type">DecompressInputRequired</span></a></span><span> </span><span id="local-6989586621679057239"><span class="annot"><span class="annottext">ByteString -&gt; m (DecompressStream m)
</span><a href="#local-6989586621679057239"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-262"></span><span>      </span><span class="annot"><span class="annottext">(ByteString -&gt; m a) -&gt; m a
</span><a href="#local-6989586621679057230"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679057240"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057240"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; m (DecompressStream m)
</span><a href="#local-6989586621679057239"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057240"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">m (DecompressStream m) -&gt; (DecompressStream m -&gt; m a) -&gt; m a
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">DecompressStream m -&gt; m a
</span><a href="#local-6989586621679057234"><span class="hs-identifier hs-var">fold</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><a href="#local-6989586621679057234"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressOutputAvailable"><span class="hs-identifier hs-type">DecompressOutputAvailable</span></a></span><span> </span><span id="local-6989586621679057241"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057241"><span class="hs-identifier hs-var">outchunk</span></a></span></span><span> </span><span id="local-6989586621679057242"><span class="annot"><span class="annottext">m (DecompressStream m)
</span><a href="#local-6989586621679057242"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-265"></span><span>      </span><span class="annot"><span class="annottext">ByteString -&gt; m a -&gt; m a
</span><a href="#local-6989586621679057231"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057241"><span class="hs-identifier hs-var">outchunk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (DecompressStream m)
</span><a href="#local-6989586621679057242"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">m (DecompressStream m) -&gt; (DecompressStream m -&gt; m a) -&gt; m a
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">DecompressStream m -&gt; m a
</span><a href="#local-6989586621679057234"><span class="hs-identifier hs-var">fold</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><a href="#local-6989586621679057234"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStreamEnd"><span class="hs-identifier hs-type">DecompressStreamEnd</span></a></span><span> </span><span id="local-6989586621679057243"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057243"><span class="hs-identifier hs-var">inchunk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; m a
</span><a href="#local-6989586621679057232"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057243"><span class="hs-identifier hs-var">inchunk</span></a></span><span>
</span><span id="line-268"></span><span>    </span><span class="annot"><a href="#local-6989586621679057234"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStreamError"><span class="hs-identifier hs-type">DecompressStreamError</span></a></span><span> </span><span id="local-6989586621679057244"><span class="annot"><span class="annottext">DecompressError
</span><a href="#local-6989586621679057244"><span class="hs-identifier hs-var">derr</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DecompressError -&gt; m a
</span><a href="#local-6989586621679057233"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressError
</span><a href="#local-6989586621679057244"><span class="hs-identifier hs-var">derr</span></a></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="hs-comment">-- | A variant on 'foldCompressStream' that is pure rather than operating in a</span><span>
</span><span id="line-271"></span><span class="hs-comment">-- monad and where the input is provided by a lazy 'L.ByteString'. So we only</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- have to deal with the output, end and error parts, making it like a foldr on</span><span>
</span><span id="line-273"></span><span class="hs-comment">-- a list of output chunks.</span><span>
</span><span id="line-274"></span><span class="hs-comment">--</span><span>
</span><span id="line-275"></span><span class="hs-comment">-- For example:</span><span>
</span><span id="line-276"></span><span class="hs-comment">--</span><span>
</span><span id="line-277"></span><span class="hs-comment">-- &gt; toChunks = foldDecompressStreamWithInput (:) [] throw</span><span>
</span><span id="line-278"></span><span class="hs-comment">--</span><span>
</span><span id="line-279"></span><span id="local-6989586621679056791"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#foldDecompressStreamWithInput"><span class="hs-identifier hs-type">foldDecompressStreamWithInput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056791"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056791"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056791"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressError"><span class="hs-identifier hs-type">DecompressError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056791"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679056793"><span class="annot"><a href="#local-6989586621679056793"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679056793"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span>
</span><span id="line-284"></span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056791"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-285"></span><span id="foldDecompressStreamWithInput"><span class="annot"><span class="annottext">foldDecompressStreamWithInput :: forall a.
(ByteString -&gt; a -&gt; a)
-&gt; (ByteString -&gt; a)
-&gt; (DecompressError -&gt; a)
-&gt; (forall s. DecompressStream (ST s))
-&gt; ByteString
-&gt; a
</span><a href="Codec.Compression.Zlib.Internal.html#foldDecompressStreamWithInput"><span class="hs-identifier hs-var hs-var">foldDecompressStreamWithInput</span></a></span></span><span> </span><span id="local-6989586621679057245"><span class="annot"><span class="annottext">ByteString -&gt; a -&gt; a
</span><a href="#local-6989586621679057245"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span id="local-6989586621679057246"><span class="annot"><span class="annottext">ByteString -&gt; a
</span><a href="#local-6989586621679057246"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span id="local-6989586621679057247"><span class="annot"><span class="annottext">DecompressError -&gt; a
</span><a href="#local-6989586621679057247"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057248"><span class="annot"><span class="annottext">forall s. DecompressStream (ST s)
</span><a href="#local-6989586621679057248"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679057249"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057249"><span class="hs-identifier hs-var">lbs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-286"></span><span>    </span><span class="annot"><span class="annottext">(forall s. ST s a) -&gt; a
forall a. (forall s. ST s a) -&gt; a
</span><span class="hs-identifier hs-var">runST</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DecompressStream (ST s) -&gt; [ByteString] -&gt; ST s a
forall {m :: * -&gt; *}.
Monad m =&gt;
DecompressStream m -&gt; [ByteString] -&gt; m a
</span><a href="#local-6989586621679057253"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressStream (ST s)
forall s. DecompressStream (ST s)
</span><a href="#local-6989586621679057248"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><span class="hs-identifier hs-var">L.toChunks</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057249"><span class="hs-identifier hs-var">lbs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-288"></span><span>    </span><span id="local-6989586621679057253"><span class="annot"><span class="annottext">fold :: DecompressStream m -&gt; [ByteString] -&gt; m a
</span><a href="#local-6989586621679057253"><span class="hs-identifier hs-var hs-var">fold</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressInputRequired"><span class="hs-identifier hs-type">DecompressInputRequired</span></a></span><span> </span><span id="local-6989586621679057267"><span class="annot"><span class="annottext">ByteString -&gt; m (DecompressStream m)
</span><a href="#local-6989586621679057267"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-289"></span><span>      </span><span class="annot"><span class="annottext">ByteString -&gt; m (DecompressStream m)
</span><a href="#local-6989586621679057267"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier hs-var">S.empty</span></span><span> </span><span class="annot"><span class="annottext">m (DecompressStream m) -&gt; (DecompressStream m -&gt; m a) -&gt; m a
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057269"><span class="annot"><span class="annottext">DecompressStream m
</span><a href="#local-6989586621679057269"><span class="hs-identifier hs-var">strm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DecompressStream m -&gt; [ByteString] -&gt; m a
</span><a href="#local-6989586621679057253"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressStream m
</span><a href="#local-6989586621679057269"><span class="hs-identifier hs-var">strm</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span>    </span><span class="annot"><a href="#local-6989586621679057253"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressInputRequired"><span class="hs-identifier hs-type">DecompressInputRequired</span></a></span><span> </span><span id="local-6989586621679057270"><span class="annot"><span class="annottext">ByteString -&gt; m (DecompressStream m)
</span><a href="#local-6989586621679057270"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679057271"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057271"><span class="hs-identifier hs-var">inchunk</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679057272"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679057272"><span class="hs-identifier hs-var">inchunks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-292"></span><span>      </span><span class="annot"><span class="annottext">ByteString -&gt; m (DecompressStream m)
</span><a href="#local-6989586621679057270"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057271"><span class="hs-identifier hs-var">inchunk</span></a></span><span> </span><span class="annot"><span class="annottext">m (DecompressStream m) -&gt; (DecompressStream m -&gt; m a) -&gt; m a
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057273"><span class="annot"><span class="annottext">DecompressStream m
</span><a href="#local-6989586621679057273"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DecompressStream m -&gt; [ByteString] -&gt; m a
</span><a href="#local-6989586621679057253"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressStream m
</span><a href="#local-6989586621679057273"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679057272"><span class="hs-identifier hs-var">inchunks</span></a></span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span>    </span><span class="annot"><a href="#local-6989586621679057253"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressOutputAvailable"><span class="hs-identifier hs-type">DecompressOutputAvailable</span></a></span><span> </span><span id="local-6989586621679057274"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057274"><span class="hs-identifier hs-var">outchunk</span></a></span></span><span> </span><span id="local-6989586621679057275"><span class="annot"><span class="annottext">m (DecompressStream m)
</span><a href="#local-6989586621679057275"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679057276"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679057276"><span class="hs-identifier hs-var">inchunks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-295"></span><span>      </span><span id="local-6989586621679057277"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679057277"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (DecompressStream m)
</span><a href="#local-6989586621679057275"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">m (DecompressStream m) -&gt; (DecompressStream m -&gt; m a) -&gt; m a
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057278"><span class="annot"><span class="annottext">DecompressStream m
</span><a href="#local-6989586621679057278"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DecompressStream m -&gt; [ByteString] -&gt; m a
</span><a href="#local-6989586621679057253"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressStream m
</span><a href="#local-6989586621679057278"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679057276"><span class="hs-identifier hs-var">inchunks</span></a></span><span>
</span><span id="line-296"></span><span>      </span><span class="annot"><span class="annottext">a -&gt; m a
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; m a) -&gt; a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; a -&gt; a
</span><a href="#local-6989586621679057245"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057274"><span class="hs-identifier hs-var">outchunk</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679057277"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span>    </span><span class="annot"><a href="#local-6989586621679057253"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStreamEnd"><span class="hs-identifier hs-type">DecompressStreamEnd</span></a></span><span> </span><span id="local-6989586621679057279"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057279"><span class="hs-identifier hs-var">inchunk</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679057280"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679057280"><span class="hs-identifier hs-var">inchunks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-299"></span><span>      </span><span class="annot"><span class="annottext">a -&gt; m a
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; m a) -&gt; a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; a
</span><a href="#local-6989586621679057246"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">L.fromChunks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057279"><span class="hs-identifier hs-var">inchunk</span></a></span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679057280"><span class="hs-identifier hs-var">inchunks</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span>    </span><span class="annot"><a href="#local-6989586621679057253"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStreamError"><span class="hs-identifier hs-type">DecompressStreamError</span></a></span><span> </span><span id="local-6989586621679057282"><span class="annot"><span class="annottext">DecompressError
</span><a href="#local-6989586621679057282"><span class="hs-identifier hs-var">derr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-302"></span><span>      </span><span class="annot"><span class="annottext">a -&gt; m a
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; m a) -&gt; a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DecompressError -&gt; a
</span><a href="#local-6989586621679057247"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressError
</span><a href="#local-6989586621679057282"><span class="hs-identifier hs-var">derr</span></a></span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="hs-comment">-- $incremental-compression</span><span>
</span><span id="line-306"></span><span class="hs-comment">-- The pure 'compress' and 'decompress' functions are streaming in the sense</span><span>
</span><span id="line-307"></span><span class="hs-comment">-- that they can produce output without demanding all input, however they need</span><span>
</span><span id="line-308"></span><span class="hs-comment">-- the input data stream as a lazy 'L.ByteString'. Having the input data</span><span>
</span><span id="line-309"></span><span class="hs-comment">-- stream as a lazy 'L.ByteString' often requires using lazy I\/O which is not</span><span>
</span><span id="line-310"></span><span class="hs-comment">-- appropriate in all circumstances.</span><span>
</span><span id="line-311"></span><span class="hs-comment">--</span><span>
</span><span id="line-312"></span><span class="hs-comment">-- For these cases an incremental interface is more appropriate. This interface</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- allows both incremental input and output. Chunks of input data are supplied</span><span>
</span><span id="line-314"></span><span class="hs-comment">-- one by one (e.g. as they are obtained from an input source like a file or</span><span>
</span><span id="line-315"></span><span class="hs-comment">-- network source). Output is also produced chunk by chunk.</span><span>
</span><span id="line-316"></span><span class="hs-comment">--</span><span>
</span><span id="line-317"></span><span class="hs-comment">-- The incremental input and output is managed via the 'CompressStream' and</span><span>
</span><span id="line-318"></span><span class="hs-comment">-- 'DecompressStream' types. They represents the unfolding of the process of</span><span>
</span><span id="line-319"></span><span class="hs-comment">-- compressing and decompressing. They operates in either the 'ST' or 'IO'</span><span>
</span><span id="line-320"></span><span class="hs-comment">-- monads. They can be lifted into other incremental abstractions like pipes or</span><span>
</span><span id="line-321"></span><span class="hs-comment">-- conduits, or they can be used directly in the following style.</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="hs-comment">-- $using-incremental-compression</span><span>
</span><span id="line-324"></span><span class="hs-comment">--</span><span>
</span><span id="line-325"></span><span class="hs-comment">-- In a loop:</span><span>
</span><span id="line-326"></span><span class="hs-comment">--</span><span>
</span><span id="line-327"></span><span class="hs-comment">--  * Inspect the status of the stream</span><span>
</span><span id="line-328"></span><span class="hs-comment">--</span><span>
</span><span id="line-329"></span><span class="hs-comment">--  * When it is 'CompressInputRequired' then you should call the action,</span><span>
</span><span id="line-330"></span><span class="hs-comment">--    passing a chunk of input (or 'BS.empty' when no more input is available)</span><span>
</span><span id="line-331"></span><span class="hs-comment">--    to get the next state of the stream and continue the loop.</span><span>
</span><span id="line-332"></span><span class="hs-comment">--</span><span>
</span><span id="line-333"></span><span class="hs-comment">--  * When it is 'CompressOutputAvailable' then do something with the given</span><span>
</span><span id="line-334"></span><span class="hs-comment">--    chunk of output, and call the action to get the next state of the stream</span><span>
</span><span id="line-335"></span><span class="hs-comment">--    and continue the loop.</span><span>
</span><span id="line-336"></span><span class="hs-comment">--</span><span>
</span><span id="line-337"></span><span class="hs-comment">--  * When it is 'CompressStreamEnd' then terminate the loop.</span><span>
</span><span id="line-338"></span><span class="hs-comment">--</span><span>
</span><span id="line-339"></span><span class="hs-comment">-- Note that you cannot stop as soon as you have no more input, you need to</span><span>
</span><span id="line-340"></span><span class="hs-comment">-- carry on until all the output has been collected, i.e. until you get to</span><span>
</span><span id="line-341"></span><span class="hs-comment">-- 'CompressStreamEnd'.</span><span>
</span><span id="line-342"></span><span class="hs-comment">--</span><span>
</span><span id="line-343"></span><span class="hs-comment">-- Here is an example where we get input from one file handle and send the</span><span>
</span><span id="line-344"></span><span class="hs-comment">-- compressed output to another file handle.</span><span>
</span><span id="line-345"></span><span class="hs-comment">--</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- &gt; go :: Handle -&gt; Handle -&gt; CompressStream IO -&gt; IO ()</span><span>
</span><span id="line-347"></span><span class="hs-comment">-- &gt; go inh outh (CompressInputRequired next) = do</span><span>
</span><span id="line-348"></span><span class="hs-comment">-- &gt;    inchunk &lt;- BS.hGet inh 4096</span><span>
</span><span id="line-349"></span><span class="hs-comment">-- &gt;    go inh outh =&lt;&lt; next inchunk</span><span>
</span><span id="line-350"></span><span class="hs-comment">-- &gt; go inh outh (CompressOutputAvailable outchunk next) =</span><span>
</span><span id="line-351"></span><span class="hs-comment">-- &gt;    BS.hPut outh outchunk</span><span>
</span><span id="line-352"></span><span class="hs-comment">-- &gt;    go inh outh =&lt;&lt; next</span><span>
</span><span id="line-353"></span><span class="hs-comment">-- &gt; go _ _ CompressStreamEnd = return ()</span><span>
</span><span id="line-354"></span><span class="hs-comment">--</span><span>
</span><span id="line-355"></span><span class="hs-comment">-- The same can be achieved with 'foldCompressStream':</span><span>
</span><span id="line-356"></span><span class="hs-comment">--</span><span>
</span><span id="line-357"></span><span class="hs-comment">-- &gt; foldCompressStream</span><span>
</span><span id="line-358"></span><span class="hs-comment">-- &gt;   (\next -&gt; do inchunk &lt;- BS.hGet inh 4096; next inchunk)</span><span>
</span><span id="line-359"></span><span class="hs-comment">-- &gt;   (\outchunk next -&gt; do BS.hPut outh outchunk; next)</span><span>
</span><span id="line-360"></span><span class="hs-comment">-- &gt;   (return ())</span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span class="hs-comment">-- $using-incremental-decompression</span><span>
</span><span id="line-363"></span><span class="hs-comment">--</span><span>
</span><span id="line-364"></span><span class="hs-comment">-- The use of 'DecompressStream' is very similar to 'CompressStream' but with</span><span>
</span><span id="line-365"></span><span class="hs-comment">-- a few differences:</span><span>
</span><span id="line-366"></span><span class="hs-comment">--</span><span>
</span><span id="line-367"></span><span class="hs-comment">-- * There is the extra possibility of a 'DecompressStreamError'</span><span>
</span><span id="line-368"></span><span class="hs-comment">--</span><span>
</span><span id="line-369"></span><span class="hs-comment">-- * There can be extra trailing data after a compressed stream, and the</span><span>
</span><span id="line-370"></span><span class="hs-comment">--   'DecompressStreamEnd' includes that.</span><span>
</span><span id="line-371"></span><span class="hs-comment">--</span><span>
</span><span id="line-372"></span><span class="hs-comment">-- Otherwise the same loop style applies, and there are fold functions.</span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span class="hs-comment">-- | The unfolding of the compression process, where you provide a sequence</span><span>
</span><span id="line-375"></span><span class="hs-comment">-- of uncompressed data chunks as input and receive a sequence of compressed</span><span>
</span><span id="line-376"></span><span class="hs-comment">-- data chunks as output. The process is incremental, in that the demand for</span><span>
</span><span id="line-377"></span><span class="hs-comment">-- input and provision of output are interleaved.</span><span>
</span><span id="line-378"></span><span class="hs-comment">--</span><span>
</span><span id="line-379"></span><span class="hs-keyword">data</span><span> </span><span id="CompressStream"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressStream"><span class="hs-identifier hs-var">CompressStream</span></a></span></span><span> </span><span id="local-6989586621679056805"><span class="annot"><a href="#local-6989586621679056805"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-380"></span><span>     </span><span id="CompressInputRequired"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressInputRequired"><span class="hs-identifier hs-var">CompressInputRequired</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-381"></span><span>         </span><span id="compressSupplyInput"><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
CompressStream m -&gt; ByteString -&gt; m (CompressStream m)
</span><a href="Codec.Compression.Zlib.Internal.html#compressSupplyInput"><span class="hs-identifier hs-var hs-var">compressSupplyInput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056805"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressStream"><span class="hs-identifier hs-type">CompressStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056805"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="CompressOutputAvailable"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressOutputAvailable"><span class="hs-identifier hs-var">CompressOutputAvailable</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-385"></span><span>        </span><span id="compressOutput"><span class="annot"><span class="annottext">forall (m :: * -&gt; *). CompressStream m -&gt; ByteString
</span><a href="Codec.Compression.Zlib.Internal.html#compressOutput"><span class="hs-identifier hs-var hs-var">compressOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span class="hs-special">,</span><span>
</span><span id="line-386"></span><span>        </span><span id="compressNext"><span class="annot"><span class="annottext">forall (m :: * -&gt; *). CompressStream m -&gt; m (CompressStream m)
</span><a href="Codec.Compression.Zlib.Internal.html#compressNext"><span class="hs-identifier hs-var hs-var">compressNext</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679056805"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressStream"><span class="hs-identifier hs-type">CompressStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056805"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="CompressStreamEnd"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressStreamEnd"><span class="hs-identifier hs-var">CompressStreamEnd</span></a></span></span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span class="hs-comment">-- | A fold over the 'CompressStream' in the given monad.</span><span>
</span><span id="line-392"></span><span class="hs-comment">--</span><span>
</span><span id="line-393"></span><span class="hs-comment">-- One way to look at this is that it runs the stream, using callback functions</span><span>
</span><span id="line-394"></span><span class="hs-comment">-- for the three stream events.</span><span>
</span><span id="line-395"></span><span class="hs-comment">--</span><span>
</span><span id="line-396"></span><span id="local-6989586621679056810"><span id="local-6989586621679056811"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#foldCompressStream"><span class="hs-identifier hs-type">foldCompressStream</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679056810"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-397"></span><span>                   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056810"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056811"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056810"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056811"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056810"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056811"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056810"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056811"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056810"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056811"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-400"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressStream"><span class="hs-identifier hs-type">CompressStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056810"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056810"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056811"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-401"></span><span id="foldCompressStream"><span class="annot"><span class="annottext">foldCompressStream :: forall (m :: * -&gt; *) a.
Monad m =&gt;
((ByteString -&gt; m a) -&gt; m a)
-&gt; (ByteString -&gt; m a -&gt; m a) -&gt; m a -&gt; CompressStream m -&gt; m a
</span><a href="Codec.Compression.Zlib.Internal.html#foldCompressStream"><span class="hs-identifier hs-var hs-var">foldCompressStream</span></a></span></span><span> </span><span id="local-6989586621679057292"><span class="annot"><span class="annottext">(ByteString -&gt; m a) -&gt; m a
</span><a href="#local-6989586621679057292"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621679057293"><span class="annot"><span class="annottext">ByteString -&gt; m a -&gt; m a
</span><a href="#local-6989586621679057293"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span id="local-6989586621679057294"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679057294"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompressStream m -&gt; m a
</span><a href="#local-6989586621679057295"><span class="hs-identifier hs-var">fold</span></a></span><span>
</span><span id="line-402"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-403"></span><span>    </span><span id="local-6989586621679057295"><span class="annot"><span class="annottext">fold :: CompressStream m -&gt; m a
</span><a href="#local-6989586621679057295"><span class="hs-identifier hs-var hs-var">fold</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressInputRequired"><span class="hs-identifier hs-type">CompressInputRequired</span></a></span><span> </span><span id="local-6989586621679057300"><span class="annot"><span class="annottext">ByteString -&gt; m (CompressStream m)
</span><a href="#local-6989586621679057300"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-404"></span><span>      </span><span class="annot"><span class="annottext">(ByteString -&gt; m a) -&gt; m a
</span><a href="#local-6989586621679057292"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679057301"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057301"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; m (CompressStream m)
</span><a href="#local-6989586621679057300"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057301"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">m (CompressStream m) -&gt; (CompressStream m -&gt; m a) -&gt; m a
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">CompressStream m -&gt; m a
</span><a href="#local-6989586621679057295"><span class="hs-identifier hs-var">fold</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span>    </span><span class="annot"><a href="#local-6989586621679057295"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressOutputAvailable"><span class="hs-identifier hs-type">CompressOutputAvailable</span></a></span><span> </span><span id="local-6989586621679057302"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057302"><span class="hs-identifier hs-var">outchunk</span></a></span></span><span> </span><span id="local-6989586621679057303"><span class="annot"><span class="annottext">m (CompressStream m)
</span><a href="#local-6989586621679057303"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-407"></span><span>      </span><span class="annot"><span class="annottext">ByteString -&gt; m a -&gt; m a
</span><a href="#local-6989586621679057293"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057302"><span class="hs-identifier hs-var">outchunk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (CompressStream m)
</span><a href="#local-6989586621679057303"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">m (CompressStream m) -&gt; (CompressStream m -&gt; m a) -&gt; m a
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">CompressStream m -&gt; m a
</span><a href="#local-6989586621679057295"><span class="hs-identifier hs-var">fold</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>
</span><span id="line-409"></span><span>    </span><span class="annot"><a href="#local-6989586621679057295"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="annot"><span class="annottext">CompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#CompressStreamEnd"><span class="hs-identifier hs-var">CompressStreamEnd</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-410"></span><span>      </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679057294"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span class="hs-comment">-- | A variant on 'foldCompressStream' that is pure rather than operating in a</span><span>
</span><span id="line-413"></span><span class="hs-comment">-- monad and where the input is provided by a lazy 'L.ByteString'. So we only</span><span>
</span><span id="line-414"></span><span class="hs-comment">-- have to deal with the output and end parts, making it just like a foldr on a</span><span>
</span><span id="line-415"></span><span class="hs-comment">-- list of output chunks.</span><span>
</span><span id="line-416"></span><span class="hs-comment">--</span><span>
</span><span id="line-417"></span><span class="hs-comment">-- For example:</span><span>
</span><span id="line-418"></span><span class="hs-comment">--</span><span>
</span><span id="line-419"></span><span class="hs-comment">-- &gt; toChunks = foldCompressStreamWithInput (:) []</span><span>
</span><span id="line-420"></span><span class="hs-comment">--</span><span>
</span><span id="line-421"></span><span id="local-6989586621679056814"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#foldCompressStreamWithInput"><span class="hs-identifier hs-type">foldCompressStreamWithInput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056814"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056814"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056814"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-423"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679056815"><span class="annot"><a href="#local-6989586621679056815"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressStream"><span class="hs-identifier hs-type">CompressStream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679056815"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span>
</span><span id="line-425"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679056814"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-426"></span><span id="foldCompressStreamWithInput"><span class="annot"><span class="annottext">foldCompressStreamWithInput :: forall a.
(ByteString -&gt; a -&gt; a)
-&gt; a -&gt; (forall s. CompressStream (ST s)) -&gt; ByteString -&gt; a
</span><a href="Codec.Compression.Zlib.Internal.html#foldCompressStreamWithInput"><span class="hs-identifier hs-var hs-var">foldCompressStreamWithInput</span></a></span></span><span> </span><span id="local-6989586621679057304"><span class="annot"><span class="annottext">ByteString -&gt; a -&gt; a
</span><a href="#local-6989586621679057304"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span id="local-6989586621679057305"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679057305"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057306"><span class="annot"><span class="annottext">forall s. CompressStream (ST s)
</span><a href="#local-6989586621679057306"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679057307"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057307"><span class="hs-identifier hs-var">lbs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-427"></span><span>    </span><span class="annot"><span class="annottext">(forall s. ST s a) -&gt; a
forall a. (forall s. ST s a) -&gt; a
</span><span class="hs-identifier hs-var">runST</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompressStream (ST s) -&gt; [ByteString] -&gt; ST s a
forall {m :: * -&gt; *}.
Monad m =&gt;
CompressStream m -&gt; [ByteString] -&gt; m a
</span><a href="#local-6989586621679057309"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="annot"><span class="annottext">CompressStream (ST s)
forall s. CompressStream (ST s)
</span><a href="#local-6989586621679057306"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><span class="hs-identifier hs-var">L.toChunks</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057307"><span class="hs-identifier hs-var">lbs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-429"></span><span>    </span><span id="local-6989586621679057309"><span class="annot"><span class="annottext">fold :: CompressStream m -&gt; [ByteString] -&gt; m a
</span><a href="#local-6989586621679057309"><span class="hs-identifier hs-var hs-var">fold</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressInputRequired"><span class="hs-identifier hs-type">CompressInputRequired</span></a></span><span> </span><span id="local-6989586621679057321"><span class="annot"><span class="annottext">ByteString -&gt; m (CompressStream m)
</span><a href="#local-6989586621679057321"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-430"></span><span>      </span><span class="annot"><span class="annottext">ByteString -&gt; m (CompressStream m)
</span><a href="#local-6989586621679057321"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier hs-var">S.empty</span></span><span> </span><span class="annot"><span class="annottext">m (CompressStream m) -&gt; (CompressStream m -&gt; m a) -&gt; m a
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057322"><span class="annot"><span class="annottext">CompressStream m
</span><a href="#local-6989586621679057322"><span class="hs-identifier hs-var">strm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompressStream m -&gt; [ByteString] -&gt; m a
</span><a href="#local-6989586621679057309"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="annot"><span class="annottext">CompressStream m
</span><a href="#local-6989586621679057322"><span class="hs-identifier hs-var">strm</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span>    </span><span class="annot"><a href="#local-6989586621679057309"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressInputRequired"><span class="hs-identifier hs-type">CompressInputRequired</span></a></span><span> </span><span id="local-6989586621679057323"><span class="annot"><span class="annottext">ByteString -&gt; m (CompressStream m)
</span><a href="#local-6989586621679057323"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679057324"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057324"><span class="hs-identifier hs-var">inchunk</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679057325"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679057325"><span class="hs-identifier hs-var">inchunks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-433"></span><span>      </span><span class="annot"><span class="annottext">ByteString -&gt; m (CompressStream m)
</span><a href="#local-6989586621679057323"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057324"><span class="hs-identifier hs-var">inchunk</span></a></span><span> </span><span class="annot"><span class="annottext">m (CompressStream m) -&gt; (CompressStream m -&gt; m a) -&gt; m a
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057326"><span class="annot"><span class="annottext">CompressStream m
</span><a href="#local-6989586621679057326"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompressStream m -&gt; [ByteString] -&gt; m a
</span><a href="#local-6989586621679057309"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="annot"><span class="annottext">CompressStream m
</span><a href="#local-6989586621679057326"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679057325"><span class="hs-identifier hs-var">inchunks</span></a></span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span>    </span><span class="annot"><a href="#local-6989586621679057309"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressOutputAvailable"><span class="hs-identifier hs-type">CompressOutputAvailable</span></a></span><span> </span><span id="local-6989586621679057327"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057327"><span class="hs-identifier hs-var">outchunk</span></a></span></span><span> </span><span id="local-6989586621679057328"><span class="annot"><span class="annottext">m (CompressStream m)
</span><a href="#local-6989586621679057328"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679057329"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679057329"><span class="hs-identifier hs-var">inchunks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-436"></span><span>      </span><span id="local-6989586621679057330"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679057330"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (CompressStream m)
</span><a href="#local-6989586621679057328"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">m (CompressStream m) -&gt; (CompressStream m -&gt; m a) -&gt; m a
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057331"><span class="annot"><span class="annottext">CompressStream m
</span><a href="#local-6989586621679057331"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompressStream m -&gt; [ByteString] -&gt; m a
</span><a href="#local-6989586621679057309"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="annot"><span class="annottext">CompressStream m
</span><a href="#local-6989586621679057331"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679057329"><span class="hs-identifier hs-var">inchunks</span></a></span><span>
</span><span id="line-437"></span><span>      </span><span class="annot"><span class="annottext">a -&gt; m a
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; m a) -&gt; a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; a -&gt; a
</span><a href="#local-6989586621679057304"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057327"><span class="hs-identifier hs-var">outchunk</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679057330"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span>    </span><span class="annot"><a href="#local-6989586621679057309"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="annot"><span class="annottext">CompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#CompressStreamEnd"><span class="hs-identifier hs-var">CompressStreamEnd</span></a></span><span> </span><span id="local-6989586621679057332"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679057332"><span class="hs-identifier hs-var">_inchunks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-440"></span><span>      </span><span class="annot"><span class="annottext">a -&gt; m a
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679057305"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span>
</span><span id="line-443"></span><span class="hs-comment">-- | Compress a data stream provided as a lazy 'L.ByteString'.</span><span>
</span><span id="line-444"></span><span class="hs-comment">--</span><span>
</span><span id="line-445"></span><span class="hs-comment">-- There are no expected error conditions. All input data streams are valid. It</span><span>
</span><span id="line-446"></span><span class="hs-comment">-- is possible for unexpected errors to occur, such as running out of memory,</span><span>
</span><span id="line-447"></span><span class="hs-comment">-- or finding the wrong version of the zlib C library, these are thrown as</span><span>
</span><span id="line-448"></span><span class="hs-comment">-- exceptions.</span><span>
</span><span id="line-449"></span><span class="hs-comment">--</span><span>
</span><span id="line-450"></span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#compress"><span class="hs-identifier hs-type">compress</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Format"><span class="hs-identifier hs-type">Stream.Format</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressParams"><span class="hs-identifier hs-type">CompressParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span class="hs-comment">-- | Incremental compression in the 'ST' monad. Using 'ST' makes it possible</span><span>
</span><span id="line-453"></span><span class="hs-comment">-- to write pure /lazy/ functions while making use of incremental compression.</span><span>
</span><span id="line-454"></span><span class="hs-comment">--</span><span>
</span><span id="line-455"></span><span id="local-6989586621679057333"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#compressST"><span class="hs-identifier hs-type">compressST</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Format"><span class="hs-identifier hs-type">Stream.Format</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressParams"><span class="hs-identifier hs-type">CompressParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressStream"><span class="hs-identifier hs-type">CompressStream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679057333"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span class="hs-comment">-- | Incremental compression in the 'IO' monad.</span><span>
</span><span id="line-458"></span><span class="hs-comment">--</span><span>
</span><span id="line-459"></span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#compressIO"><span class="hs-identifier hs-type">compressIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Format"><span class="hs-identifier hs-type">Stream.Format</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressParams"><span class="hs-identifier hs-type">CompressParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressStream"><span class="hs-identifier hs-type">CompressStream</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span id="compress"><span class="annot"><span class="annottext">compress :: Format -&gt; CompressParams -&gt; ByteString -&gt; ByteString
</span><a href="Codec.Compression.Zlib.Internal.html#compress"><span class="hs-identifier hs-var hs-var">compress</span></a></span></span><span>   </span><span id="local-6989586621679057334"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057334"><span class="hs-identifier hs-var">format</span></a></span></span><span> </span><span id="local-6989586621679057335"><span class="annot"><span class="annottext">CompressParams
</span><a href="#local-6989586621679057335"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString -&gt; ByteString)
-&gt; ByteString
-&gt; (forall s. CompressStream (ST s))
-&gt; ByteString
-&gt; ByteString
forall a.
(ByteString -&gt; a -&gt; a)
-&gt; a -&gt; (forall s. CompressStream (ST s)) -&gt; ByteString -&gt; a
</span><a href="Codec.Compression.Zlib.Internal.html#foldCompressStreamWithInput"><span class="hs-identifier hs-var">foldCompressStreamWithInput</span></a></span><span>
</span><span id="line-462"></span><span>                             </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">L.Chunk</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier hs-var">L.Empty</span></span><span>
</span><span id="line-463"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format -&gt; CompressParams -&gt; CompressStream (ST s)
forall s. Format -&gt; CompressParams -&gt; CompressStream (ST s)
</span><a href="Codec.Compression.Zlib.Internal.html#compressStreamST"><span class="hs-identifier hs-var">compressStreamST</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057334"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">CompressParams
</span><a href="#local-6989586621679057335"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span id="compressST"><span class="annot"><span class="annottext">compressST :: forall s. Format -&gt; CompressParams -&gt; CompressStream (ST s)
</span><a href="Codec.Compression.Zlib.Internal.html#compressST"><span class="hs-identifier hs-var hs-var">compressST</span></a></span></span><span> </span><span id="local-6989586621679057339"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057339"><span class="hs-identifier hs-var">format</span></a></span></span><span> </span><span id="local-6989586621679057340"><span class="annot"><span class="annottext">CompressParams
</span><a href="#local-6989586621679057340"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format -&gt; CompressParams -&gt; CompressStream (ST s)
forall s. Format -&gt; CompressParams -&gt; CompressStream (ST s)
</span><a href="Codec.Compression.Zlib.Internal.html#compressStreamST"><span class="hs-identifier hs-var">compressStreamST</span></a></span><span>  </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057339"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">CompressParams
</span><a href="#local-6989586621679057340"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-465"></span><span id="compressIO"><span class="annot"><span class="annottext">compressIO :: Format -&gt; CompressParams -&gt; CompressStream IO
</span><a href="Codec.Compression.Zlib.Internal.html#compressIO"><span class="hs-identifier hs-var hs-var">compressIO</span></a></span></span><span> </span><span id="local-6989586621679057341"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057341"><span class="hs-identifier hs-var">format</span></a></span></span><span> </span><span id="local-6989586621679057342"><span class="annot"><span class="annottext">CompressParams
</span><a href="#local-6989586621679057342"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format -&gt; CompressParams -&gt; CompressStream IO
</span><a href="Codec.Compression.Zlib.Internal.html#compressStreamIO"><span class="hs-identifier hs-var">compressStreamIO</span></a></span><span>  </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057341"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">CompressParams
</span><a href="#local-6989586621679057342"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#compressStream"><span class="hs-identifier hs-type">compressStream</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Format"><span class="hs-identifier hs-type">Stream.Format</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressParams"><span class="hs-identifier hs-type">CompressParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span>
</span><span id="line-468"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressStream"><span class="hs-identifier hs-type">CompressStream</span></a></span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span id="compressStream"><span class="annot"><span class="annottext">compressStream :: Format
-&gt; CompressParams -&gt; ByteString -&gt; Stream (CompressStream Stream)
</span><a href="Codec.Compression.Zlib.Internal.html#compressStream"><span class="hs-identifier hs-var hs-var">compressStream</span></a></span></span><span> </span><span id="local-6989586621679057345"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057345"><span class="hs-identifier hs-var">format</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressParams"><span class="hs-identifier hs-type">CompressParams</span></a></span><span> </span><span id="local-6989586621679057346"><span class="annot"><span class="annottext">CompressionLevel
</span><a href="#local-6989586621679057346"><span class="hs-identifier hs-var">compLevel</span></a></span></span><span> </span><span id="local-6989586621679057347"><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679057347"><span class="hs-identifier hs-var">method</span></a></span></span><span> </span><span id="local-6989586621679057348"><span class="annot"><span class="annottext">WindowBits
</span><a href="#local-6989586621679057348"><span class="hs-identifier hs-var">bits</span></a></span></span><span> </span><span id="local-6989586621679057349"><span class="annot"><span class="annottext">MemoryLevel
</span><a href="#local-6989586621679057349"><span class="hs-identifier hs-var">memLevel</span></a></span></span><span>
</span><span id="line-470"></span><span>                                </span><span id="local-6989586621679057350"><span class="annot"><span class="annottext">CompressionStrategy
</span><a href="#local-6989586621679057350"><span class="hs-identifier hs-var">strategy</span></a></span></span><span> </span><span id="local-6989586621679057351"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057351"><span class="hs-identifier hs-var">initChunkSize</span></a></span></span><span> </span><span id="local-6989586621679057352"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679057352"><span class="hs-identifier hs-var">mdict</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span>    </span><span class="hs-glyph">\</span><span id="local-6989586621679057353"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057353"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-473"></span><span>      </span><span class="annot"><span class="annottext">Format
-&gt; CompressionLevel
-&gt; Method
-&gt; WindowBits
-&gt; MemoryLevel
-&gt; CompressionStrategy
-&gt; Stream ()
</span><a href="Codec.Compression.Zlib.Stream.html#deflateInit"><span class="hs-identifier hs-var">Stream.deflateInit</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057345"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">CompressionLevel
</span><a href="#local-6989586621679057346"><span class="hs-identifier hs-var">compLevel</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679057347"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">WindowBits
</span><a href="#local-6989586621679057348"><span class="hs-identifier hs-var">bits</span></a></span><span> </span><span class="annot"><span class="annottext">MemoryLevel
</span><a href="#local-6989586621679057349"><span class="hs-identifier hs-var">memLevel</span></a></span><span> </span><span class="annot"><span class="annottext">CompressionStrategy
</span><a href="#local-6989586621679057350"><span class="hs-identifier hs-var">strategy</span></a></span><span>
</span><span id="line-474"></span><span>      </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; Stream ()
</span><a href="#local-6989586621679057355"><span class="hs-identifier hs-var">setDictionary</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679057352"><span class="hs-identifier hs-var">mdict</span></a></span><span>
</span><span id="line-475"></span><span>      </span><span class="annot"><span class="annottext">ByteString
-&gt; (ForeignPtr Word8 -&gt; Int -&gt; Stream (CompressStream Stream))
-&gt; Stream (CompressStream Stream)
forall r. ByteString -&gt; (ForeignPtr Word8 -&gt; Int -&gt; r) -&gt; r
</span><a href="Codec.Compression.Zlib.ByteStringCompat.html#withBS"><span class="hs-identifier hs-var">withBS</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057353"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">((ForeignPtr Word8 -&gt; Int -&gt; Stream (CompressStream Stream))
 -&gt; Stream (CompressStream Stream))
-&gt; (ForeignPtr Word8 -&gt; Int -&gt; Stream (CompressStream Stream))
-&gt; Stream (CompressStream Stream)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057356"><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057356"><span class="hs-identifier hs-var">inFPtr</span></a></span></span><span> </span><span id="local-6989586621679057357"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057357"><span class="hs-identifier hs-var">length</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-476"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057357"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-477"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Stream (CompressStream Stream)
</span><a href="#local-6989586621679057358"><span class="hs-identifier hs-var">fillBuffers</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span>   </span><span class="hs-comment">--gzip header is 20 bytes, others even smaller</span><span>
</span><span id="line-478"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-479"></span><span>            </span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; Int -&gt; Int -&gt; Stream ()
</span><a href="Codec.Compression.Zlib.Stream.html#pushInputBuffer"><span class="hs-identifier hs-var">Stream.pushInputBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057356"><span class="hs-identifier hs-var">inFPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057357"><span class="hs-identifier hs-var">length</span></a></span><span>
</span><span id="line-480"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; Stream (CompressStream Stream)
</span><a href="#local-6989586621679057358"><span class="hs-identifier hs-var">fillBuffers</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057351"><span class="hs-identifier hs-var">initChunkSize</span></a></span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-483"></span><span>    </span><span class="hs-comment">-- we flick between two states:</span><span>
</span><span id="line-484"></span><span>    </span><span class="hs-comment">--   * where one or other buffer is empty</span><span>
</span><span id="line-485"></span><span>    </span><span class="hs-comment">--       - in which case we refill one or both</span><span>
</span><span id="line-486"></span><span>    </span><span class="hs-comment">--   * where both buffers are non-empty</span><span>
</span><span id="line-487"></span><span>    </span><span class="hs-comment">--       - in which case we compress until a buffer is empty</span><span>
</span><span id="line-488"></span><span>
</span><span id="line-489"></span><span>  </span><span class="annot"><a href="#local-6989586621679057358"><span class="hs-identifier hs-type">fillBuffers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressStream"><span class="hs-identifier hs-type">CompressStream</span></a></span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>  </span><span id="local-6989586621679057358"><span class="annot"><span class="annottext">fillBuffers :: Int -&gt; Stream (CompressStream Stream)
</span><a href="#local-6989586621679057358"><span class="hs-identifier hs-var hs-var">fillBuffers</span></a></span></span><span> </span><span id="local-6989586621679057360"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057360"><span class="hs-identifier hs-var">outChunkSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#ifdef DEBUG
</span><span>    </span><span class="hs-identifier">Stream.consistencyCheck</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-495"></span><span>    </span><span class="hs-comment">-- in this state there are two possibilities:</span><span>
</span><span id="line-496"></span><span>    </span><span class="hs-comment">--   * no output buffer space is available</span><span>
</span><span id="line-497"></span><span>    </span><span class="hs-comment">--       - in which case we must make more available</span><span>
</span><span id="line-498"></span><span>    </span><span class="hs-comment">--   * no input buffer is available</span><span>
</span><span id="line-499"></span><span>    </span><span class="hs-comment">--       - in which case we must supply more</span><span>
</span><span id="line-500"></span><span>    </span><span id="local-6989586621679057361"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057361"><span class="hs-identifier hs-var">inputBufferEmpty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream Bool
</span><a href="Codec.Compression.Zlib.Stream.html#inputBufferEmpty"><span class="hs-identifier hs-var">Stream.inputBufferEmpty</span></a></span><span>
</span><span id="line-501"></span><span>    </span><span id="local-6989586621679057363"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057363"><span class="hs-identifier hs-var">outputBufferFull</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream Bool
</span><a href="Codec.Compression.Zlib.Stream.html#outputBufferFull"><span class="hs-identifier hs-var">Stream.outputBufferFull</span></a></span><span>
</span><span id="line-502"></span><span>
</span><span id="line-503"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Stream () -&gt; Stream ()
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057361"><span class="hs-identifier hs-var">inputBufferEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057363"><span class="hs-identifier hs-var">outputBufferFull</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Stream () -&gt; Stream ()) -&gt; Stream () -&gt; Stream ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; Stream ()
forall a. a -&gt; Stream a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Stream () -&gt; Stream ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057363"><span class="hs-identifier hs-var">outputBufferFull</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream () -&gt; Stream ()) -&gt; Stream () -&gt; Stream ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-506"></span><span>      </span><span id="local-6989586621679057366"><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057366"><span class="hs-identifier hs-var">outFPtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (ForeignPtr Word8) -&gt; Stream (ForeignPtr Word8)
forall a. IO a -&gt; Stream a
</span><a href="Codec.Compression.Zlib.Stream.html#unsafeLiftIO"><span class="hs-identifier hs-var">Stream.unsafeLiftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; IO (ForeignPtr Word8)
forall a. Int -&gt; IO (ForeignPtr a)
</span><span class="hs-identifier hs-var">S.mallocByteString</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057360"><span class="hs-identifier hs-var">outChunkSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>      </span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; Int -&gt; Int -&gt; Stream ()
</span><a href="Codec.Compression.Zlib.Stream.html#pushOutputBuffer"><span class="hs-identifier hs-var">Stream.pushOutputBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057366"><span class="hs-identifier hs-var">outFPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057360"><span class="hs-identifier hs-var">outChunkSize</span></a></span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057361"><span class="hs-identifier hs-var">inputBufferEmpty</span></a></span><span>
</span><span id="line-510"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">CompressStream Stream -&gt; Stream (CompressStream Stream)
forall a. a -&gt; Stream a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(CompressStream Stream -&gt; Stream (CompressStream Stream))
-&gt; CompressStream Stream -&gt; Stream (CompressStream Stream)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Stream (CompressStream Stream))
-&gt; CompressStream Stream
forall (m :: * -&gt; *).
(ByteString -&gt; m (CompressStream m)) -&gt; CompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#CompressInputRequired"><span class="hs-identifier hs-var">CompressInputRequired</span></a></span><span> </span><span class="annot"><span class="annottext">((ByteString -&gt; Stream (CompressStream Stream))
 -&gt; CompressStream Stream)
-&gt; (ByteString -&gt; Stream (CompressStream Stream))
-&gt; CompressStream Stream
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteString
 -&gt; (ForeignPtr Word8 -&gt; Int -&gt; Stream (CompressStream Stream))
 -&gt; Stream (CompressStream Stream))
-&gt; (ForeignPtr Word8 -&gt; Int -&gt; Stream (CompressStream Stream))
-&gt; ByteString
-&gt; Stream (CompressStream Stream)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ByteString
-&gt; (ForeignPtr Word8 -&gt; Int -&gt; Stream (CompressStream Stream))
-&gt; Stream (CompressStream Stream)
forall r. ByteString -&gt; (ForeignPtr Word8 -&gt; Int -&gt; r) -&gt; r
</span><a href="Codec.Compression.Zlib.ByteStringCompat.html#withBS"><span class="hs-identifier hs-var">withBS</span></a></span><span> </span><span class="annot"><span class="annottext">((ForeignPtr Word8 -&gt; Int -&gt; Stream (CompressStream Stream))
 -&gt; ByteString -&gt; Stream (CompressStream Stream))
-&gt; (ForeignPtr Word8 -&gt; Int -&gt; Stream (CompressStream Stream))
-&gt; ByteString
-&gt; Stream (CompressStream Stream)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057371"><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057371"><span class="hs-identifier hs-var">inFPtr</span></a></span></span><span> </span><span id="local-6989586621679057372"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057372"><span class="hs-identifier hs-var">length</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-511"></span><span>           </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057372"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-512"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Stream (CompressStream Stream)
</span><a href="#local-6989586621679057373"><span class="hs-identifier hs-var">drainBuffers</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-513"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-514"></span><span>                </span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; Int -&gt; Int -&gt; Stream ()
</span><a href="Codec.Compression.Zlib.Stream.html#pushInputBuffer"><span class="hs-identifier hs-var">Stream.pushInputBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057371"><span class="hs-identifier hs-var">inFPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057372"><span class="hs-identifier hs-var">length</span></a></span><span>
</span><span id="line-515"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; Stream (CompressStream Stream)
</span><a href="#local-6989586621679057373"><span class="hs-identifier hs-var">drainBuffers</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-516"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Stream (CompressStream Stream)
</span><a href="#local-6989586621679057373"><span class="hs-identifier hs-var">drainBuffers</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span>  </span><span class="annot"><a href="#local-6989586621679057373"><span class="hs-identifier hs-type">drainBuffers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressStream"><span class="hs-identifier hs-type">CompressStream</span></a></span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>  </span><span id="local-6989586621679057373"><span class="annot"><span class="annottext">drainBuffers :: Bool -&gt; Stream (CompressStream Stream)
</span><a href="#local-6989586621679057373"><span class="hs-identifier hs-var hs-var">drainBuffers</span></a></span></span><span> </span><span id="local-6989586621679057374"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057374"><span class="hs-identifier hs-var">lastChunk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span>    </span><span id="local-6989586621679057375"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057375"><span class="hs-identifier hs-var">inputBufferEmpty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream Bool
</span><a href="Codec.Compression.Zlib.Stream.html#inputBufferEmpty"><span class="hs-identifier hs-var">Stream.inputBufferEmpty</span></a></span><span>
</span><span id="line-523"></span><span>    </span><span id="local-6989586621679057376"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057376"><span class="hs-identifier hs-var">outputBufferFull'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream Bool
</span><a href="Codec.Compression.Zlib.Stream.html#outputBufferFull"><span class="hs-identifier hs-var">Stream.outputBufferFull</span></a></span><span>
</span><span id="line-524"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Stream () -&gt; Stream ()
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057376"><span class="hs-identifier hs-var">outputBufferFull'</span></a></span><span>
</span><span id="line-525"></span><span>       </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057374"><span class="hs-identifier hs-var">lastChunk</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057375"><span class="hs-identifier hs-var">inputBufferEmpty'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Stream () -&gt; Stream ()) -&gt; Stream () -&gt; Stream ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; Stream ()
forall a. a -&gt; Stream a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>    </span><span class="hs-comment">-- this invariant guarantees we can always make forward progress</span><span>
</span><span id="line-527"></span><span>    </span><span class="hs-comment">-- and that therefore a BufferError is impossible</span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679057379"><span class="annot"><span class="annottext">flush :: Flush
</span><a href="#local-6989586621679057379"><span class="hs-identifier hs-var hs-var">flush</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057374"><span class="hs-identifier hs-var">lastChunk</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Flush
</span><a href="Codec.Compression.Zlib.Stream.html#Finish"><span class="hs-identifier hs-var">Stream.Finish</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Flush
</span><a href="Codec.Compression.Zlib.Stream.html#NoFlush"><span class="hs-identifier hs-var">Stream.NoFlush</span></a></span><span>
</span><span id="line-530"></span><span>    </span><span id="local-6989586621679057382"><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621679057382"><span class="hs-identifier hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Flush -&gt; Stream Status
</span><a href="Codec.Compression.Zlib.Stream.html#deflate"><span class="hs-identifier hs-var">Stream.deflate</span></a></span><span> </span><span class="annot"><span class="annottext">Flush
</span><a href="#local-6989586621679057379"><span class="hs-identifier hs-var">flush</span></a></span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621679057382"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-533"></span><span>      </span><span class="annot"><span class="annottext">Status
</span><a href="Codec.Compression.Zlib.Stream.html#Ok"><span class="hs-identifier hs-var">Stream.Ok</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-534"></span><span>        </span><span id="local-6989586621679057385"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057385"><span class="hs-identifier hs-var">outputBufferFull</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream Bool
</span><a href="Codec.Compression.Zlib.Stream.html#outputBufferFull"><span class="hs-identifier hs-var">Stream.outputBufferFull</span></a></span><span>
</span><span id="line-535"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057385"><span class="hs-identifier hs-var">outputBufferFull</span></a></span><span>
</span><span id="line-536"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679057386"><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057386"><span class="hs-identifier hs-var">outFPtr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057387"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057387"><span class="hs-identifier hs-var">offset</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057388"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057388"><span class="hs-identifier hs-var">length</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (ForeignPtr Word8, Int, Int)
</span><a href="Codec.Compression.Zlib.Stream.html#popOutputBuffer"><span class="hs-identifier hs-var">Stream.popOutputBuffer</span></a></span><span>
</span><span id="line-537"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679057390"><span class="annot"><span class="annottext">chunk :: ByteString
</span><a href="#local-6989586621679057390"><span class="hs-identifier hs-var hs-var">chunk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; Int -&gt; Int -&gt; ByteString
</span><a href="Codec.Compression.Zlib.ByteStringCompat.html#mkBS"><span class="hs-identifier hs-var">mkBS</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057386"><span class="hs-identifier hs-var">outFPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057387"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057388"><span class="hs-identifier hs-var">length</span></a></span><span>
</span><span id="line-538"></span><span>                  </span><span class="annot"><span class="annottext">CompressStream Stream -&gt; Stream (CompressStream Stream)
forall a. a -&gt; Stream a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(CompressStream Stream -&gt; Stream (CompressStream Stream))
-&gt; CompressStream Stream -&gt; Stream (CompressStream Stream)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString
-&gt; Stream (CompressStream Stream) -&gt; CompressStream Stream
forall (m :: * -&gt; *).
ByteString -&gt; m (CompressStream m) -&gt; CompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#CompressOutputAvailable"><span class="hs-identifier hs-var">CompressOutputAvailable</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057390"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream (CompressStream Stream) -&gt; CompressStream Stream)
-&gt; Stream (CompressStream Stream) -&gt; CompressStream Stream
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-539"></span><span>                    </span><span class="annot"><span class="annottext">Int -&gt; Stream (CompressStream Stream)
</span><a href="#local-6989586621679057358"><span class="hs-identifier hs-var">fillBuffers</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Codec.Compression.Zlib.Internal.html#defaultCompressBufferSize"><span class="hs-identifier hs-var">defaultCompressBufferSize</span></a></span><span>
</span><span id="line-540"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Stream (CompressStream Stream)
</span><a href="#local-6989586621679057358"><span class="hs-identifier hs-var">fillBuffers</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Codec.Compression.Zlib.Internal.html#defaultCompressBufferSize"><span class="hs-identifier hs-var">defaultCompressBufferSize</span></a></span><span>
</span><span id="line-541"></span><span>
</span><span id="line-542"></span><span>      </span><span class="annot"><span class="annottext">Status
</span><a href="Codec.Compression.Zlib.Stream.html#StreamEnd"><span class="hs-identifier hs-var">Stream.StreamEnd</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-543"></span><span>        </span><span id="local-6989586621679057392"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057392"><span class="hs-identifier hs-var">inputBufferEmpty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream Bool
</span><a href="Codec.Compression.Zlib.Stream.html#inputBufferEmpty"><span class="hs-identifier hs-var">Stream.inputBufferEmpty</span></a></span><span>
</span><span id="line-544"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Stream () -&gt; Stream ()
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057392"><span class="hs-identifier hs-var">inputBufferEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream () -&gt; Stream ()) -&gt; Stream () -&gt; Stream ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; Stream ()
forall a. a -&gt; Stream a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-545"></span><span>        </span><span id="local-6989586621679057393"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057393"><span class="hs-identifier hs-var">outputBufferBytesAvailable</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream Int
</span><a href="Codec.Compression.Zlib.Stream.html#outputBufferBytesAvailable"><span class="hs-identifier hs-var">Stream.outputBufferBytesAvailable</span></a></span><span>
</span><span id="line-546"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057393"><span class="hs-identifier hs-var">outputBufferBytesAvailable</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-547"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679057396"><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057396"><span class="hs-identifier hs-var">outFPtr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057397"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057397"><span class="hs-identifier hs-var">offset</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057398"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057398"><span class="hs-identifier hs-var">length</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (ForeignPtr Word8, Int, Int)
</span><a href="Codec.Compression.Zlib.Stream.html#popOutputBuffer"><span class="hs-identifier hs-var">Stream.popOutputBuffer</span></a></span><span>
</span><span id="line-548"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679057399"><span class="annot"><span class="annottext">chunk :: ByteString
</span><a href="#local-6989586621679057399"><span class="hs-identifier hs-var hs-var">chunk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; Int -&gt; Int -&gt; ByteString
</span><a href="Codec.Compression.Zlib.ByteStringCompat.html#mkBS"><span class="hs-identifier hs-var">mkBS</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057396"><span class="hs-identifier hs-var">outFPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057397"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057398"><span class="hs-identifier hs-var">length</span></a></span><span>
</span><span id="line-549"></span><span>                  </span><span class="annot"><span class="annottext">Stream ()
</span><a href="Codec.Compression.Zlib.Stream.html#finalise"><span class="hs-identifier hs-var">Stream.finalise</span></a></span><span>
</span><span id="line-550"></span><span>                  </span><span class="annot"><span class="annottext">CompressStream Stream -&gt; Stream (CompressStream Stream)
forall a. a -&gt; Stream a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(CompressStream Stream -&gt; Stream (CompressStream Stream))
-&gt; CompressStream Stream -&gt; Stream (CompressStream Stream)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString
-&gt; Stream (CompressStream Stream) -&gt; CompressStream Stream
forall (m :: * -&gt; *).
ByteString -&gt; m (CompressStream m) -&gt; CompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#CompressOutputAvailable"><span class="hs-identifier hs-var">CompressOutputAvailable</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057399"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompressStream Stream -&gt; Stream (CompressStream Stream)
forall a. a -&gt; Stream a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CompressStream Stream
forall (m :: * -&gt; *). CompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#CompressStreamEnd"><span class="hs-identifier hs-var">CompressStreamEnd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Stream ()
</span><a href="Codec.Compression.Zlib.Stream.html#finalise"><span class="hs-identifier hs-var">Stream.finalise</span></a></span><span>
</span><span id="line-552"></span><span>                  </span><span class="annot"><span class="annottext">CompressStream Stream -&gt; Stream (CompressStream Stream)
forall a. a -&gt; Stream a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CompressStream Stream
forall (m :: * -&gt; *). CompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#CompressStreamEnd"><span class="hs-identifier hs-var">CompressStreamEnd</span></a></span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span>      </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Error"><span class="hs-identifier hs-type">Stream.Error</span></a></span><span> </span><span id="local-6989586621679057402"><span class="annot"><span class="annottext">ErrorCode
</span><a href="#local-6989586621679057402"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span id="local-6989586621679057403"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057403"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="#local-6989586621679057402"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-555"></span><span>        </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="Codec.Compression.Zlib.Stream.html#BufferError"><span class="hs-identifier hs-var">Stream.BufferError</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Stream (CompressStream Stream)
forall a. String -&gt; Stream a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;BufferError should be impossible!&quot;</span></span><span>
</span><span id="line-556"></span><span>        </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#NeedDict"><span class="hs-identifier hs-type">Stream.NeedDict</span></a></span><span> </span><span class="annot"><span class="annottext">DictionaryHash
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Stream (CompressStream Stream)
forall a. String -&gt; Stream a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NeedDict is impossible!&quot;</span></span><span>
</span><span id="line-557"></span><span>        </span><span class="annot"><span class="annottext">ErrorCode
</span><span class="hs-identifier">_</span></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Stream (CompressStream Stream)
forall a. String -&gt; Stream a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057403"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-558"></span><span>
</span><span id="line-559"></span><span>  </span><span class="hs-comment">-- Set the custom dictionary, if we were provided with one</span><span>
</span><span id="line-560"></span><span>  </span><span class="hs-comment">-- and if the format supports it (zlib and raw, not gzip).</span><span>
</span><span id="line-561"></span><span>  </span><span class="annot"><a href="#local-6989586621679057355"><span class="hs-identifier hs-type">setDictionary</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-562"></span><span>  </span><span id="local-6989586621679057355"><span class="annot"><span class="annottext">setDictionary :: Maybe ByteString -&gt; Stream ()
</span><a href="#local-6989586621679057355"><span class="hs-identifier hs-var hs-var">setDictionary</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679057406"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057406"><span class="hs-identifier hs-var">dict</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Bool
</span><a href="Codec.Compression.Zlib.Stream.html#formatSupportsDictionary"><span class="hs-identifier hs-var">Stream.formatSupportsDictionary</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057345"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-564"></span><span>        </span><span id="local-6989586621679057408"><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621679057408"><span class="hs-identifier hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Stream Status
</span><a href="Codec.Compression.Zlib.Stream.html#deflateSetDictionary"><span class="hs-identifier hs-var">Stream.deflateSetDictionary</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057406"><span class="hs-identifier hs-var">dict</span></a></span><span>
</span><span id="line-565"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621679057408"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-566"></span><span>          </span><span class="annot"><span class="annottext">Status
</span><a href="Codec.Compression.Zlib.Stream.html#Ok"><span class="hs-identifier hs-var">Stream.Ok</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Stream ()
forall a. a -&gt; Stream a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-567"></span><span>          </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Error"><span class="hs-identifier hs-type">Stream.Error</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679057410"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057410"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Stream ()
forall a. String -&gt; Stream a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057410"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-568"></span><span>          </span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier">_</span></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Stream ()
forall a. String -&gt; Stream a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;error when setting deflate dictionary&quot;</span></span><span>
</span><span id="line-569"></span><span>  </span><span class="annot"><a href="#local-6989586621679057355"><span class="hs-identifier hs-var">setDictionary</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; Stream ()
forall a. a -&gt; Stream a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span>
</span><span id="line-572"></span><span class="hs-comment">-- | Decompress a data stream provided as a lazy 'L.ByteString'.</span><span>
</span><span id="line-573"></span><span class="hs-comment">--</span><span>
</span><span id="line-574"></span><span class="hs-comment">-- It will throw an exception if any error is encountered in the input data.</span><span>
</span><span id="line-575"></span><span class="hs-comment">-- If you need more control over error handling then use one the incremental</span><span>
</span><span id="line-576"></span><span class="hs-comment">-- versions, 'decompressST' or 'decompressIO'.</span><span>
</span><span id="line-577"></span><span class="hs-comment">--</span><span>
</span><span id="line-578"></span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#decompress"><span class="hs-identifier hs-type">decompress</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Format"><span class="hs-identifier hs-type">Stream.Format</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressParams"><span class="hs-identifier hs-type">DecompressParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span>
</span><span id="line-579"></span><span>
</span><span id="line-580"></span><span class="hs-comment">-- | Incremental decompression in the 'ST' monad. Using 'ST' makes it possible</span><span>
</span><span id="line-581"></span><span class="hs-comment">-- to write pure /lazy/ functions while making use of incremental decompression.</span><span>
</span><span id="line-582"></span><span class="hs-comment">--</span><span>
</span><span id="line-583"></span><span id="local-6989586621679057411"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#decompressST"><span class="hs-identifier hs-type">decompressST</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Format"><span class="hs-identifier hs-type">Stream.Format</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressParams"><span class="hs-identifier hs-type">DecompressParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679057411"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span class="hs-comment">-- | Incremental decompression in the 'IO' monad.</span><span>
</span><span id="line-586"></span><span class="hs-comment">--</span><span>
</span><span id="line-587"></span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#decompressIO"><span class="hs-identifier hs-type">decompressIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Format"><span class="hs-identifier hs-type">Stream.Format</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressParams"><span class="hs-identifier hs-type">DecompressParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span id="decompress"><span class="annot"><span class="annottext">decompress :: Format -&gt; DecompressParams -&gt; ByteString -&gt; ByteString
</span><a href="Codec.Compression.Zlib.Internal.html#decompress"><span class="hs-identifier hs-var hs-var">decompress</span></a></span></span><span>   </span><span id="local-6989586621679057412"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057412"><span class="hs-identifier hs-var">format</span></a></span></span><span> </span><span id="local-6989586621679057413"><span class="annot"><span class="annottext">DecompressParams
</span><a href="#local-6989586621679057413"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString -&gt; ByteString)
-&gt; (ByteString -&gt; ByteString)
-&gt; (DecompressError -&gt; ByteString)
-&gt; (forall s. DecompressStream (ST s))
-&gt; ByteString
-&gt; ByteString
forall a.
(ByteString -&gt; a -&gt; a)
-&gt; (ByteString -&gt; a)
-&gt; (DecompressError -&gt; a)
-&gt; (forall s. DecompressStream (ST s))
-&gt; ByteString
-&gt; a
</span><a href="Codec.Compression.Zlib.Internal.html#foldDecompressStreamWithInput"><span class="hs-identifier hs-var">foldDecompressStreamWithInput</span></a></span><span>
</span><span id="line-590"></span><span>                               </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">L.Chunk</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier hs-var">L.Empty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DecompressError -&gt; ByteString
forall a e. Exception e =&gt; e -&gt; a
</span><span class="hs-identifier hs-var">throw</span></span><span>
</span><span id="line-591"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format -&gt; DecompressParams -&gt; DecompressStream (ST s)
forall s. Format -&gt; DecompressParams -&gt; DecompressStream (ST s)
</span><a href="Codec.Compression.Zlib.Internal.html#decompressStreamST"><span class="hs-identifier hs-var">decompressStreamST</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057412"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressParams
</span><a href="#local-6989586621679057413"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span id="decompressST"><span class="annot"><span class="annottext">decompressST :: forall s. Format -&gt; DecompressParams -&gt; DecompressStream (ST s)
</span><a href="Codec.Compression.Zlib.Internal.html#decompressST"><span class="hs-identifier hs-var hs-var">decompressST</span></a></span></span><span> </span><span id="local-6989586621679057416"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057416"><span class="hs-identifier hs-var">format</span></a></span></span><span> </span><span id="local-6989586621679057417"><span class="annot"><span class="annottext">DecompressParams
</span><a href="#local-6989586621679057417"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format -&gt; DecompressParams -&gt; DecompressStream (ST s)
forall s. Format -&gt; DecompressParams -&gt; DecompressStream (ST s)
</span><a href="Codec.Compression.Zlib.Internal.html#decompressStreamST"><span class="hs-identifier hs-var">decompressStreamST</span></a></span><span>  </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057416"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressParams
</span><a href="#local-6989586621679057417"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-593"></span><span id="decompressIO"><span class="annot"><span class="annottext">decompressIO :: Format -&gt; DecompressParams -&gt; DecompressStream IO
</span><a href="Codec.Compression.Zlib.Internal.html#decompressIO"><span class="hs-identifier hs-var hs-var">decompressIO</span></a></span></span><span> </span><span id="local-6989586621679057418"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057418"><span class="hs-identifier hs-var">format</span></a></span></span><span> </span><span id="local-6989586621679057419"><span class="annot"><span class="annottext">DecompressParams
</span><a href="#local-6989586621679057419"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format -&gt; DecompressParams -&gt; DecompressStream IO
</span><a href="Codec.Compression.Zlib.Internal.html#decompressStreamIO"><span class="hs-identifier hs-var">decompressStreamIO</span></a></span><span>  </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057418"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressParams
</span><a href="#local-6989586621679057419"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-594"></span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#decompressStream"><span class="hs-identifier hs-type">decompressStream</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Format"><span class="hs-identifier hs-type">Stream.Format</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressParams"><span class="hs-identifier hs-type">DecompressParams</span></a></span><span>
</span><span id="line-597"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span>
</span><span id="line-598"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span id="decompressStream"><span class="annot"><span class="annottext">decompressStream :: Format
-&gt; DecompressParams
-&gt; Bool
-&gt; ByteString
-&gt; Stream (DecompressStream Stream)
</span><a href="Codec.Compression.Zlib.Internal.html#decompressStream"><span class="hs-identifier hs-var hs-var">decompressStream</span></a></span></span><span> </span><span id="local-6989586621679057422"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057422"><span class="hs-identifier hs-var">format</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressParams"><span class="hs-identifier hs-type">DecompressParams</span></a></span><span> </span><span id="local-6989586621679057423"><span class="annot"><span class="annottext">WindowBits
</span><a href="#local-6989586621679057423"><span class="hs-identifier hs-var">bits</span></a></span></span><span> </span><span id="local-6989586621679057424"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057424"><span class="hs-identifier hs-var">initChunkSize</span></a></span></span><span> </span><span id="local-6989586621679057425"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679057425"><span class="hs-identifier hs-var">mdict</span></a></span></span><span> </span><span id="local-6989586621679057426"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057426"><span class="hs-identifier hs-var">allMembers</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span>                 </span><span id="local-6989586621679057427"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057427"><span class="hs-identifier hs-var">resume</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span>    </span><span class="hs-glyph">\</span><span id="local-6989586621679057428"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057428"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-603"></span><span>      </span><span id="local-6989586621679057429"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057429"><span class="hs-identifier hs-var">inputBufferEmpty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream Bool
</span><a href="Codec.Compression.Zlib.Stream.html#inputBufferEmpty"><span class="hs-identifier hs-var">Stream.inputBufferEmpty</span></a></span><span>
</span><span id="line-604"></span><span>      </span><span id="local-6989586621679057430"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057430"><span class="hs-identifier hs-var">outputBufferFull</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream Bool
</span><a href="Codec.Compression.Zlib.Stream.html#outputBufferFull"><span class="hs-identifier hs-var">Stream.outputBufferFull</span></a></span><span>
</span><span id="line-605"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Stream () -&gt; Stream ()
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057429"><span class="hs-identifier hs-var">inputBufferEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream () -&gt; Stream ()) -&gt; Stream () -&gt; Stream ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-606"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057427"><span class="hs-identifier hs-var">resume</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Stream () -&gt; Stream ()
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057422"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">Format -&gt; Format -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="Codec.Compression.Zlib.Stream.html#gzipFormat"><span class="hs-identifier hs-var">Stream.gzipFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057426"><span class="hs-identifier hs-var">allMembers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Stream () -&gt; Stream ()) -&gt; Stream () -&gt; Stream ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-607"></span><span>                       </span><span class="annot"><span class="annottext">Stream ()
</span><a href="Codec.Compression.Zlib.Stream.html#inflateReset"><span class="hs-identifier hs-var">Stream.inflateReset</span></a></span><span>
</span><span id="line-608"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Stream () -&gt; Stream ()
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057430"><span class="hs-identifier hs-var">outputBufferFull</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream () -&gt; Stream ()) -&gt; Stream () -&gt; Stream ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-609"></span><span>                       </span><span class="annot"><span class="annottext">Format -&gt; WindowBits -&gt; Stream ()
</span><a href="Codec.Compression.Zlib.Stream.html#inflateInit"><span class="hs-identifier hs-var">Stream.inflateInit</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057422"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">WindowBits
</span><a href="#local-6989586621679057423"><span class="hs-identifier hs-var">bits</span></a></span><span>
</span><span id="line-610"></span><span>      </span><span class="annot"><span class="annottext">ByteString
-&gt; (ForeignPtr Word8 -&gt; Int -&gt; Stream (DecompressStream Stream))
-&gt; Stream (DecompressStream Stream)
forall r. ByteString -&gt; (ForeignPtr Word8 -&gt; Int -&gt; r) -&gt; r
</span><a href="Codec.Compression.Zlib.ByteStringCompat.html#withBS"><span class="hs-identifier hs-var">withBS</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057428"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">((ForeignPtr Word8 -&gt; Int -&gt; Stream (DecompressStream Stream))
 -&gt; Stream (DecompressStream Stream))
-&gt; (ForeignPtr Word8 -&gt; Int -&gt; Stream (DecompressStream Stream))
-&gt; Stream (DecompressStream Stream)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057433"><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057433"><span class="hs-identifier hs-var">inFPtr</span></a></span></span><span> </span><span id="local-6989586621679057434"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057434"><span class="hs-identifier hs-var">length</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-611"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057434"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-612"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-613"></span><span>            </span><span class="hs-comment">-- special case to avoid demanding more input again</span><span>
</span><span id="line-614"></span><span>            </span><span class="hs-comment">-- always an error anyway</span><span>
</span><span id="line-615"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Stream () -&gt; Stream ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057430"><span class="hs-identifier hs-var">outputBufferFull</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream () -&gt; Stream ()) -&gt; Stream () -&gt; Stream ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-616"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679057436"><span class="annot"><span class="annottext">outChunkSize :: Int
</span><a href="#local-6989586621679057436"><span class="hs-identifier hs-var hs-var">outChunkSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-617"></span><span>              </span><span id="local-6989586621679057437"><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057437"><span class="hs-identifier hs-var">outFPtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (ForeignPtr Word8) -&gt; Stream (ForeignPtr Word8)
forall a. IO a -&gt; Stream a
</span><a href="Codec.Compression.Zlib.Stream.html#unsafeLiftIO"><span class="hs-identifier hs-var">Stream.unsafeLiftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; IO (ForeignPtr Word8)
forall a. Int -&gt; IO (ForeignPtr a)
</span><span class="hs-identifier hs-var">S.mallocByteString</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057436"><span class="hs-identifier hs-var">outChunkSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>              </span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; Int -&gt; Int -&gt; Stream ()
</span><a href="Codec.Compression.Zlib.Stream.html#pushOutputBuffer"><span class="hs-identifier hs-var">Stream.pushOutputBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057437"><span class="hs-identifier hs-var">outFPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057436"><span class="hs-identifier hs-var">outChunkSize</span></a></span><span>
</span><span id="line-619"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057438"><span class="hs-identifier hs-var">drainBuffers</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-620"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-621"></span><span>            </span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; Int -&gt; Int -&gt; Stream ()
</span><a href="Codec.Compression.Zlib.Stream.html#pushInputBuffer"><span class="hs-identifier hs-var">Stream.pushInputBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057433"><span class="hs-identifier hs-var">inFPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057434"><span class="hs-identifier hs-var">length</span></a></span><span>
</span><span id="line-622"></span><span>            </span><span class="hs-comment">-- Normally we start with no output buffer (so counts as full) but</span><span>
</span><span id="line-623"></span><span>            </span><span class="hs-comment">-- if we're resuming then we'll usually still have output buffer</span><span>
</span><span id="line-624"></span><span>            </span><span class="hs-comment">-- space available</span><span>
</span><span id="line-625"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Stream () -&gt; Stream ()
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057427"><span class="hs-identifier hs-var">resume</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057430"><span class="hs-identifier hs-var">outputBufferFull</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Stream () -&gt; Stream ()) -&gt; Stream () -&gt; Stream ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; Stream ()
forall a. a -&gt; Stream a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-626"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057430"><span class="hs-identifier hs-var">outputBufferFull</span></a></span><span>
</span><span id="line-627"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057439"><span class="hs-identifier hs-var">fillBuffers</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057424"><span class="hs-identifier hs-var">initChunkSize</span></a></span><span>
</span><span id="line-628"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057438"><span class="hs-identifier hs-var">drainBuffers</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-629"></span><span>
</span><span id="line-630"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-631"></span><span>    </span><span class="hs-comment">-- we flick between two states:</span><span>
</span><span id="line-632"></span><span>    </span><span class="hs-comment">--   * where one or other buffer is empty</span><span>
</span><span id="line-633"></span><span>    </span><span class="hs-comment">--       - in which case we refill one or both</span><span>
</span><span id="line-634"></span><span>    </span><span class="hs-comment">--   * where both buffers are non-empty</span><span>
</span><span id="line-635"></span><span>    </span><span class="hs-comment">--       - in which case we compress until a buffer is empty</span><span>
</span><span id="line-636"></span><span>
</span><span id="line-637"></span><span>  </span><span class="annot"><a href="#local-6989586621679057439"><span class="hs-identifier hs-type">fillBuffers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-638"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-639"></span><span>  </span><span id="local-6989586621679057439"><span class="annot"><span class="annottext">fillBuffers :: Int -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057439"><span class="hs-identifier hs-var hs-var">fillBuffers</span></a></span></span><span> </span><span id="local-6989586621679057440"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057440"><span class="hs-identifier hs-var">outChunkSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#ifdef DEBUG
</span><span>    </span><span class="hs-identifier">Stream.consistencyCheck</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-644"></span><span>    </span><span class="hs-comment">-- in this state there are two possibilities:</span><span>
</span><span id="line-645"></span><span>    </span><span class="hs-comment">--   * no output buffer space is available</span><span>
</span><span id="line-646"></span><span>    </span><span class="hs-comment">--       - in which case we must make more available</span><span>
</span><span id="line-647"></span><span>    </span><span class="hs-comment">--   * no input buffer is available</span><span>
</span><span id="line-648"></span><span>    </span><span class="hs-comment">--       - in which case we must supply more</span><span>
</span><span id="line-649"></span><span>    </span><span id="local-6989586621679057441"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057441"><span class="hs-identifier hs-var">inputBufferEmpty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream Bool
</span><a href="Codec.Compression.Zlib.Stream.html#inputBufferEmpty"><span class="hs-identifier hs-var">Stream.inputBufferEmpty</span></a></span><span>
</span><span id="line-650"></span><span>    </span><span id="local-6989586621679057442"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057442"><span class="hs-identifier hs-var">outputBufferFull</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream Bool
</span><a href="Codec.Compression.Zlib.Stream.html#outputBufferFull"><span class="hs-identifier hs-var">Stream.outputBufferFull</span></a></span><span>
</span><span id="line-651"></span><span>
</span><span id="line-652"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Stream () -&gt; Stream ()
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057441"><span class="hs-identifier hs-var">inputBufferEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057442"><span class="hs-identifier hs-var">outputBufferFull</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Stream () -&gt; Stream ()) -&gt; Stream () -&gt; Stream ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; Stream ()
forall a. a -&gt; Stream a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Stream () -&gt; Stream ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057442"><span class="hs-identifier hs-var">outputBufferFull</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream () -&gt; Stream ()) -&gt; Stream () -&gt; Stream ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-655"></span><span>      </span><span id="local-6989586621679057443"><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057443"><span class="hs-identifier hs-var">outFPtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (ForeignPtr Word8) -&gt; Stream (ForeignPtr Word8)
forall a. IO a -&gt; Stream a
</span><a href="Codec.Compression.Zlib.Stream.html#unsafeLiftIO"><span class="hs-identifier hs-var">Stream.unsafeLiftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; IO (ForeignPtr Word8)
forall a. Int -&gt; IO (ForeignPtr a)
</span><span class="hs-identifier hs-var">S.mallocByteString</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057440"><span class="hs-identifier hs-var">outChunkSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span>      </span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; Int -&gt; Int -&gt; Stream ()
</span><a href="Codec.Compression.Zlib.Stream.html#pushOutputBuffer"><span class="hs-identifier hs-var">Stream.pushOutputBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057443"><span class="hs-identifier hs-var">outFPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057440"><span class="hs-identifier hs-var">outChunkSize</span></a></span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057441"><span class="hs-identifier hs-var">inputBufferEmpty</span></a></span><span>
</span><span id="line-659"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">DecompressStream Stream -&gt; Stream (DecompressStream Stream)
forall a. a -&gt; Stream a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(DecompressStream Stream -&gt; Stream (DecompressStream Stream))
-&gt; DecompressStream Stream -&gt; Stream (DecompressStream Stream)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Stream (DecompressStream Stream))
-&gt; DecompressStream Stream
forall (m :: * -&gt; *).
(ByteString -&gt; m (DecompressStream m)) -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressInputRequired"><span class="hs-identifier hs-var">DecompressInputRequired</span></a></span><span> </span><span class="annot"><span class="annottext">((ByteString -&gt; Stream (DecompressStream Stream))
 -&gt; DecompressStream Stream)
-&gt; (ByteString -&gt; Stream (DecompressStream Stream))
-&gt; DecompressStream Stream
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057444"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057444"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-660"></span><span>           </span><span class="annot"><span class="annottext">ByteString
-&gt; (ForeignPtr Word8 -&gt; Int -&gt; Stream (DecompressStream Stream))
-&gt; Stream (DecompressStream Stream)
forall r. ByteString -&gt; (ForeignPtr Word8 -&gt; Int -&gt; r) -&gt; r
</span><a href="Codec.Compression.Zlib.ByteStringCompat.html#withBS"><span class="hs-identifier hs-var">withBS</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057444"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">((ForeignPtr Word8 -&gt; Int -&gt; Stream (DecompressStream Stream))
 -&gt; Stream (DecompressStream Stream))
-&gt; (ForeignPtr Word8 -&gt; Int -&gt; Stream (DecompressStream Stream))
-&gt; Stream (DecompressStream Stream)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057445"><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057445"><span class="hs-identifier hs-var">inFPtr</span></a></span></span><span> </span><span id="local-6989586621679057446"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057446"><span class="hs-identifier hs-var">length</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-661"></span><span>             </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057446"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-662"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057438"><span class="hs-identifier hs-var">drainBuffers</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-663"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-664"></span><span>                 </span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; Int -&gt; Int -&gt; Stream ()
</span><a href="Codec.Compression.Zlib.Stream.html#pushInputBuffer"><span class="hs-identifier hs-var">Stream.pushInputBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057445"><span class="hs-identifier hs-var">inFPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057446"><span class="hs-identifier hs-var">length</span></a></span><span>
</span><span id="line-665"></span><span>                 </span><span class="annot"><span class="annottext">Bool -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057438"><span class="hs-identifier hs-var">drainBuffers</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-666"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057438"><span class="hs-identifier hs-var">drainBuffers</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-667"></span><span>
</span><span id="line-668"></span><span>
</span><span id="line-669"></span><span>  </span><span class="annot"><a href="#local-6989586621679057438"><span class="hs-identifier hs-type">drainBuffers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span>  </span><span id="local-6989586621679057438"><span class="annot"><span class="annottext">drainBuffers :: Bool -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057438"><span class="hs-identifier hs-var hs-var">drainBuffers</span></a></span></span><span> </span><span id="local-6989586621679057447"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057447"><span class="hs-identifier hs-var">lastChunk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-671"></span><span>
</span><span id="line-672"></span><span>    </span><span id="local-6989586621679057448"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057448"><span class="hs-identifier hs-var">inputBufferEmpty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream Bool
</span><a href="Codec.Compression.Zlib.Stream.html#inputBufferEmpty"><span class="hs-identifier hs-var">Stream.inputBufferEmpty</span></a></span><span>
</span><span id="line-673"></span><span>    </span><span id="local-6989586621679057449"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057449"><span class="hs-identifier hs-var">outputBufferFull'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream Bool
</span><a href="Codec.Compression.Zlib.Stream.html#outputBufferFull"><span class="hs-identifier hs-var">Stream.outputBufferFull</span></a></span><span>
</span><span id="line-674"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Stream () -&gt; Stream ()
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057449"><span class="hs-identifier hs-var">outputBufferFull'</span></a></span><span>
</span><span id="line-675"></span><span>       </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057447"><span class="hs-identifier hs-var">lastChunk</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057448"><span class="hs-identifier hs-var">inputBufferEmpty'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Stream () -&gt; Stream ()) -&gt; Stream () -&gt; Stream ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; Stream ()
forall a. a -&gt; Stream a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span>    </span><span class="hs-comment">-- this invariant guarantees we can always make forward progress or at</span><span>
</span><span id="line-677"></span><span>    </span><span class="hs-comment">-- least if a BufferError does occur that it must be due to a premature EOF</span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span>    </span><span id="local-6989586621679057450"><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621679057450"><span class="hs-identifier hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Flush -&gt; Stream Status
</span><a href="Codec.Compression.Zlib.Stream.html#inflate"><span class="hs-identifier hs-var">Stream.inflate</span></a></span><span> </span><span class="annot"><span class="annottext">Flush
</span><a href="Codec.Compression.Zlib.Stream.html#NoFlush"><span class="hs-identifier hs-var">Stream.NoFlush</span></a></span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621679057450"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-682"></span><span>      </span><span class="annot"><span class="annottext">Status
</span><a href="Codec.Compression.Zlib.Stream.html#Ok"><span class="hs-identifier hs-var">Stream.Ok</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-683"></span><span>        </span><span id="local-6989586621679057452"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057452"><span class="hs-identifier hs-var">outputBufferFull</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream Bool
</span><a href="Codec.Compression.Zlib.Stream.html#outputBufferFull"><span class="hs-identifier hs-var">Stream.outputBufferFull</span></a></span><span>
</span><span id="line-684"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057452"><span class="hs-identifier hs-var">outputBufferFull</span></a></span><span>
</span><span id="line-685"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679057453"><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057453"><span class="hs-identifier hs-var">outFPtr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057454"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057454"><span class="hs-identifier hs-var">offset</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057455"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057455"><span class="hs-identifier hs-var">length</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (ForeignPtr Word8, Int, Int)
</span><a href="Codec.Compression.Zlib.Stream.html#popOutputBuffer"><span class="hs-identifier hs-var">Stream.popOutputBuffer</span></a></span><span>
</span><span id="line-686"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679057456"><span class="annot"><span class="annottext">chunk :: ByteString
</span><a href="#local-6989586621679057456"><span class="hs-identifier hs-var hs-var">chunk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; Int -&gt; Int -&gt; ByteString
</span><a href="Codec.Compression.Zlib.ByteStringCompat.html#mkBS"><span class="hs-identifier hs-var">mkBS</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057453"><span class="hs-identifier hs-var">outFPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057454"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057455"><span class="hs-identifier hs-var">length</span></a></span><span>
</span><span id="line-687"></span><span>                  </span><span class="annot"><span class="annottext">DecompressStream Stream -&gt; Stream (DecompressStream Stream)
forall a. a -&gt; Stream a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(DecompressStream Stream -&gt; Stream (DecompressStream Stream))
-&gt; DecompressStream Stream -&gt; Stream (DecompressStream Stream)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString
-&gt; Stream (DecompressStream Stream) -&gt; DecompressStream Stream
forall (m :: * -&gt; *).
ByteString -&gt; m (DecompressStream m) -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressOutputAvailable"><span class="hs-identifier hs-var">DecompressOutputAvailable</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057456"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream (DecompressStream Stream) -&gt; DecompressStream Stream)
-&gt; Stream (DecompressStream Stream) -&gt; DecompressStream Stream
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-688"></span><span>                    </span><span class="annot"><span class="annottext">Int -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057439"><span class="hs-identifier hs-var">fillBuffers</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Codec.Compression.Zlib.Internal.html#defaultDecompressBufferSize"><span class="hs-identifier hs-var">defaultDecompressBufferSize</span></a></span><span>
</span><span id="line-689"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057439"><span class="hs-identifier hs-var">fillBuffers</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Codec.Compression.Zlib.Internal.html#defaultDecompressBufferSize"><span class="hs-identifier hs-var">defaultDecompressBufferSize</span></a></span><span>
</span><span id="line-690"></span><span>
</span><span id="line-691"></span><span>      </span><span class="annot"><span class="annottext">Status
</span><a href="Codec.Compression.Zlib.Stream.html#StreamEnd"><span class="hs-identifier hs-var">Stream.StreamEnd</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-692"></span><span>        </span><span class="hs-comment">-- The decompressor tells us we're done.</span><span>
</span><span id="line-693"></span><span>        </span><span class="hs-comment">-- Note that there may be input bytes still available if the stream is</span><span>
</span><span id="line-694"></span><span>        </span><span class="hs-comment">-- embedded in some other data stream, so we return any trailing data.</span><span>
</span><span id="line-695"></span><span>        </span><span id="local-6989586621679057457"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057457"><span class="hs-identifier hs-var">inputBufferEmpty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream Bool
</span><a href="Codec.Compression.Zlib.Stream.html#inputBufferEmpty"><span class="hs-identifier hs-var">Stream.inputBufferEmpty</span></a></span><span>
</span><span id="line-696"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057457"><span class="hs-identifier hs-var">inputBufferEmpty</span></a></span><span>
</span><span id="line-697"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">DecompressStream Stream -&gt; Stream (DecompressStream Stream)
forall {m :: * -&gt; *}.
Monad m =&gt;
DecompressStream m -&gt; Stream (DecompressStream m)
</span><a href="#local-6989586621679057458"><span class="hs-identifier hs-var">finish</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; DecompressStream Stream
forall (m :: * -&gt; *). ByteString -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressStreamEnd"><span class="hs-identifier hs-var">DecompressStreamEnd</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier hs-var">S.empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679057459"><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057459"><span class="hs-identifier hs-var">inFPtr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057460"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057460"><span class="hs-identifier hs-var">offset</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057461"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057461"><span class="hs-identifier hs-var">length</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (ForeignPtr Word8, Int, Int)
</span><a href="Codec.Compression.Zlib.Stream.html#popRemainingInputBuffer"><span class="hs-identifier hs-var">Stream.popRemainingInputBuffer</span></a></span><span>
</span><span id="line-699"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679057463"><span class="annot"><span class="annottext">inchunk :: ByteString
</span><a href="#local-6989586621679057463"><span class="hs-identifier hs-var hs-var">inchunk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; Int -&gt; Int -&gt; ByteString
</span><a href="Codec.Compression.Zlib.ByteStringCompat.html#mkBS"><span class="hs-identifier hs-var">mkBS</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057459"><span class="hs-identifier hs-var">inFPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057460"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057461"><span class="hs-identifier hs-var">length</span></a></span><span>
</span><span id="line-700"></span><span>                  </span><span class="annot"><span class="annottext">DecompressStream Stream -&gt; Stream (DecompressStream Stream)
forall {m :: * -&gt; *}.
Monad m =&gt;
DecompressStream m -&gt; Stream (DecompressStream m)
</span><a href="#local-6989586621679057458"><span class="hs-identifier hs-var">finish</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; DecompressStream Stream
forall (m :: * -&gt; *). ByteString -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressStreamEnd"><span class="hs-identifier hs-var">DecompressStreamEnd</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057463"><span class="hs-identifier hs-var">inchunk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>
</span><span id="line-702"></span><span>      </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Error"><span class="hs-identifier hs-type">Stream.Error</span></a></span><span> </span><span id="local-6989586621679057464"><span class="annot"><span class="annottext">ErrorCode
</span><a href="#local-6989586621679057464"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span id="local-6989586621679057465"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057465"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="#local-6989586621679057464"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-703"></span><span>        </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="Codec.Compression.Zlib.Stream.html#BufferError"><span class="hs-identifier hs-var">Stream.BufferError</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DecompressStream Stream -&gt; Stream (DecompressStream Stream)
forall {m :: * -&gt; *}.
Monad m =&gt;
DecompressStream m -&gt; Stream (DecompressStream m)
</span><a href="#local-6989586621679057458"><span class="hs-identifier hs-var">finish</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DecompressError -&gt; DecompressStream Stream
forall (m :: * -&gt; *). DecompressError -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressStreamError"><span class="hs-identifier hs-var">DecompressStreamError</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressError
</span><a href="Codec.Compression.Zlib.Internal.html#TruncatedInput"><span class="hs-identifier hs-var">TruncatedInput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-704"></span><span>        </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#NeedDict"><span class="hs-identifier hs-type">Stream.NeedDict</span></a></span><span> </span><span id="local-6989586621679057466"><span class="annot"><span class="annottext">DictionaryHash
</span><a href="#local-6989586621679057466"><span class="hs-identifier hs-var">adler</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-705"></span><span>          </span><span id="local-6989586621679057467"><span class="annot"><span class="annottext">Maybe (DecompressStream Stream)
</span><a href="#local-6989586621679057467"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DictionaryHash
-&gt; Maybe ByteString -&gt; Stream (Maybe (DecompressStream Stream))
</span><a href="#local-6989586621679057468"><span class="hs-identifier hs-var">setDictionary</span></a></span><span> </span><span class="annot"><span class="annottext">DictionaryHash
</span><a href="#local-6989586621679057466"><span class="hs-identifier hs-var">adler</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679057425"><span class="hs-identifier hs-var">mdict</span></a></span><span>
</span><span id="line-706"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (DecompressStream Stream)
</span><a href="#local-6989586621679057467"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-707"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679057469"><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057469"><span class="hs-identifier hs-var">streamErr</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DecompressStream Stream -&gt; Stream (DecompressStream Stream)
forall {m :: * -&gt; *}.
Monad m =&gt;
DecompressStream m -&gt; Stream (DecompressStream m)
</span><a href="#local-6989586621679057458"><span class="hs-identifier hs-var">finish</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057469"><span class="hs-identifier hs-var">streamErr</span></a></span><span>
</span><span id="line-708"></span><span>            </span><span class="annot"><span class="annottext">Maybe (DecompressStream Stream)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057438"><span class="hs-identifier hs-var">drainBuffers</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057447"><span class="hs-identifier hs-var">lastChunk</span></a></span><span>
</span><span id="line-709"></span><span>        </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="Codec.Compression.Zlib.Stream.html#DataError"><span class="hs-identifier hs-var">Stream.DataError</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DecompressStream Stream -&gt; Stream (DecompressStream Stream)
forall {m :: * -&gt; *}.
Monad m =&gt;
DecompressStream m -&gt; Stream (DecompressStream m)
</span><a href="#local-6989586621679057458"><span class="hs-identifier hs-var">finish</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DecompressError -&gt; DecompressStream Stream
forall (m :: * -&gt; *). DecompressError -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressStreamError"><span class="hs-identifier hs-var">DecompressStreamError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; DecompressError
</span><a href="Codec.Compression.Zlib.Internal.html#DataFormatError"><span class="hs-identifier hs-var">DataFormatError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057465"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span>        </span><span class="annot"><span class="annottext">ErrorCode
</span><span class="hs-identifier">_</span></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Stream (DecompressStream Stream)
forall a. String -&gt; Stream a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057465"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-711"></span><span>
</span><span id="line-712"></span><span>  </span><span class="hs-comment">-- Note even if we end with an error we still try to flush the last chunk if</span><span>
</span><span id="line-713"></span><span>  </span><span class="hs-comment">-- there is one. The user just has to decide what they want to trust.</span><span>
</span><span id="line-714"></span><span>  </span><span id="local-6989586621679057458"><span class="annot"><span class="annottext">finish :: DecompressStream m -&gt; Stream (DecompressStream m)
</span><a href="#local-6989586621679057458"><span class="hs-identifier hs-var hs-var">finish</span></a></span></span><span> </span><span id="local-6989586621679057483"><span class="annot"><span class="annottext">DecompressStream m
</span><a href="#local-6989586621679057483"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-715"></span><span>    </span><span id="local-6989586621679057484"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057484"><span class="hs-identifier hs-var">outputBufferBytesAvailable</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream Int
</span><a href="Codec.Compression.Zlib.Stream.html#outputBufferBytesAvailable"><span class="hs-identifier hs-var">Stream.outputBufferBytesAvailable</span></a></span><span>
</span><span id="line-716"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057484"><span class="hs-identifier hs-var">outputBufferBytesAvailable</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-717"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679057485"><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057485"><span class="hs-identifier hs-var">outFPtr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057486"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057486"><span class="hs-identifier hs-var">offset</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057487"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057487"><span class="hs-identifier hs-var">length</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (ForeignPtr Word8, Int, Int)
</span><a href="Codec.Compression.Zlib.Stream.html#popOutputBuffer"><span class="hs-identifier hs-var">Stream.popOutputBuffer</span></a></span><span>
</span><span id="line-718"></span><span>              </span><span class="annot"><span class="annottext">DecompressStream m -&gt; Stream (DecompressStream m)
forall a. a -&gt; Stream a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; m (DecompressStream m) -&gt; DecompressStream m
forall (m :: * -&gt; *).
ByteString -&gt; m (DecompressStream m) -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressOutputAvailable"><span class="hs-identifier hs-var">DecompressOutputAvailable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; Int -&gt; Int -&gt; ByteString
</span><a href="Codec.Compression.Zlib.ByteStringCompat.html#mkBS"><span class="hs-identifier hs-var">mkBS</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679057485"><span class="hs-identifier hs-var">outFPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057486"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679057487"><span class="hs-identifier hs-var">length</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DecompressStream m -&gt; m (DecompressStream m)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">DecompressStream m
</span><a href="#local-6989586621679057483"><span class="hs-identifier hs-var">end</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-719"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DecompressStream m -&gt; Stream (DecompressStream m)
forall a. a -&gt; Stream a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">DecompressStream m
</span><a href="#local-6989586621679057483"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-720"></span><span>
</span><span id="line-721"></span><span>  </span><span class="annot"><a href="#local-6989586621679057468"><span class="hs-identifier hs-type">setDictionary</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#DictionaryHash"><span class="hs-identifier hs-type">Stream.DictionaryHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span>
</span><span id="line-722"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-723"></span><span>  </span><span id="local-6989586621679057468"><span class="annot"><span class="annottext">setDictionary :: DictionaryHash
-&gt; Maybe ByteString -&gt; Stream (Maybe (DecompressStream Stream))
</span><a href="#local-6989586621679057468"><span class="hs-identifier hs-var hs-var">setDictionary</span></a></span></span><span> </span><span id="local-6989586621679057488"><span class="annot"><span class="annottext">DictionaryHash
</span><a href="#local-6989586621679057488"><span class="hs-identifier hs-var">_adler</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-724"></span><span>    </span><span class="annot"><span class="annottext">Maybe (DecompressStream Stream)
-&gt; Stream (Maybe (DecompressStream Stream))
forall a. a -&gt; Stream a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (DecompressStream Stream)
 -&gt; Stream (Maybe (DecompressStream Stream)))
-&gt; Maybe (DecompressStream Stream)
-&gt; Stream (Maybe (DecompressStream Stream))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DecompressStream Stream -&gt; Maybe (DecompressStream Stream)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DecompressError -&gt; DecompressStream Stream
forall (m :: * -&gt; *). DecompressError -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressStreamError"><span class="hs-identifier hs-var">DecompressStreamError</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressError
</span><a href="Codec.Compression.Zlib.Internal.html#DictionaryRequired"><span class="hs-identifier hs-var">DictionaryRequired</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-725"></span><span>  </span><span class="annot"><a href="#local-6989586621679057468"><span class="hs-identifier hs-var">setDictionary</span></a></span><span> </span><span id="local-6989586621679057489"><span class="annot"><span class="annottext">DictionaryHash
</span><a href="#local-6989586621679057489"><span class="hs-identifier hs-var">_adler</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679057490"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057490"><span class="hs-identifier hs-var">dict</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-726"></span><span>    </span><span id="local-6989586621679057491"><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621679057491"><span class="hs-identifier hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Stream Status
</span><a href="Codec.Compression.Zlib.Stream.html#inflateSetDictionary"><span class="hs-identifier hs-var">Stream.inflateSetDictionary</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057490"><span class="hs-identifier hs-var">dict</span></a></span><span>
</span><span id="line-727"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621679057491"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-728"></span><span>      </span><span class="annot"><span class="annottext">Status
</span><a href="Codec.Compression.Zlib.Stream.html#Ok"><span class="hs-identifier hs-var">Stream.Ok</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (DecompressStream Stream)
-&gt; Stream (Maybe (DecompressStream Stream))
forall a. a -&gt; Stream a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (DecompressStream Stream)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-729"></span><span>      </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Error"><span class="hs-identifier hs-type">Stream.Error</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="Codec.Compression.Zlib.Stream.html#DataError"><span class="hs-identifier hs-var">Stream.DataError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-730"></span><span>        </span><span class="annot"><span class="annottext">Maybe (DecompressStream Stream)
-&gt; Stream (Maybe (DecompressStream Stream))
forall a. a -&gt; Stream a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (DecompressStream Stream)
 -&gt; Stream (Maybe (DecompressStream Stream)))
-&gt; Maybe (DecompressStream Stream)
-&gt; Stream (Maybe (DecompressStream Stream))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DecompressStream Stream -&gt; Maybe (DecompressStream Stream)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DecompressError -&gt; DecompressStream Stream
forall (m :: * -&gt; *). DecompressError -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressStreamError"><span class="hs-identifier hs-var">DecompressStreamError</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressError
</span><a href="Codec.Compression.Zlib.Internal.html#DictionaryMismatch"><span class="hs-identifier hs-var">DictionaryMismatch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-731"></span><span>      </span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Stream (Maybe (DecompressStream Stream))
forall a. String -&gt; Stream a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;error when setting inflate dictionary&quot;</span></span><span>
</span><span id="line-732"></span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-735"></span><span>
</span><span id="line-736"></span><span id="local-6989586621679056847"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#mkStateST"><span class="hs-identifier hs-type">mkStateST</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679056847"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#State"><span class="hs-identifier hs-type">Stream.State</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056847"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-737"></span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#mkStateIO"><span class="hs-identifier hs-type">mkStateIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#State"><span class="hs-identifier hs-type">Stream.State</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span class="hs-special">)</span><span>
</span><span id="line-738"></span><span id="mkStateST"><span class="annot"><span class="annottext">mkStateST :: forall s. ST s (State s)
</span><a href="Codec.Compression.Zlib.Internal.html#mkStateST"><span class="hs-identifier hs-var hs-var">mkStateST</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ST s (State s) -&gt; ST s (State s)
forall s a. ST s a -&gt; ST s a
</span><span class="hs-identifier hs-var">strictToLazyST</span></span><span> </span><span class="annot"><span class="annottext">ST s (State s)
forall s. ST s (State s)
</span><a href="Codec.Compression.Zlib.Stream.html#mkState"><span class="hs-identifier hs-var">Stream.mkState</span></a></span><span>
</span><span id="line-739"></span><span id="mkStateIO"><span class="annot"><span class="annottext">mkStateIO :: IO (State RealWorld)
</span><a href="Codec.Compression.Zlib.Internal.html#mkStateIO"><span class="hs-identifier hs-var hs-var">mkStateIO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ST RealWorld (State RealWorld) -&gt; IO (State RealWorld)
forall a. ST RealWorld a -&gt; IO a
</span><span class="hs-identifier hs-var">stToIO</span></span><span> </span><span class="annot"><span class="annottext">ST RealWorld (State RealWorld)
forall s. ST s (State s)
</span><a href="Codec.Compression.Zlib.Stream.html#mkState"><span class="hs-identifier hs-var">Stream.mkState</span></a></span><span>
</span><span id="line-740"></span><span>
</span><span id="line-741"></span><span id="local-6989586621679056855"><span id="local-6989586621679056856"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#runStreamST"><span class="hs-identifier hs-type">runStreamST</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056855"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#State"><span class="hs-identifier hs-type">Stream.State</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056856"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679056856"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679056855"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#State"><span class="hs-identifier hs-type">Stream.State</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056856"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-742"></span><span id="local-6989586621679056866"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#runStreamIO"><span class="hs-identifier hs-type">runStreamIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056866"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#State"><span class="hs-identifier hs-type">Stream.State</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679056866"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#State"><span class="hs-identifier hs-type">Stream.State</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-743"></span><span id="runStreamST"><span class="annot"><span class="annottext">runStreamST :: forall a s. Stream a -&gt; State s -&gt; ST s (a, State s)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamST"><span class="hs-identifier hs-var hs-var">runStreamST</span></a></span></span><span> </span><span id="local-6989586621679057501"><span class="annot"><span class="annottext">Stream a
</span><a href="#local-6989586621679057501"><span class="hs-identifier hs-var">strm</span></a></span></span><span> </span><span id="local-6989586621679057502"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057502"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ST s (a, State s) -&gt; ST s (a, State s)
forall s a. ST s a -&gt; ST s a
</span><span class="hs-identifier hs-var">strictToLazyST</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; ST s ()
forall a s. IO a -&gt; ST s a
</span><span class="hs-identifier hs-var">Unsafe.unsafeIOToST</span></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><span class="hs-identifier hs-var">noDuplicate</span></span><span> </span><span class="annot"><span class="annottext">ST s () -&gt; ST s (a, State s) -&gt; ST s (a, State s)
forall a b. ST s a -&gt; ST s b -&gt; ST s b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Stream a -&gt; State s -&gt; ST s (a, State s)
forall a s. Stream a -&gt; State s -&gt; ST s (a, State s)
</span><a href="Codec.Compression.Zlib.Stream.html#runStream"><span class="hs-identifier hs-var">Stream.runStream</span></a></span><span> </span><span class="annot"><span class="annottext">Stream a
</span><a href="#local-6989586621679057501"><span class="hs-identifier hs-var">strm</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057502"><span class="hs-identifier hs-var">zstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-744"></span><span id="runStreamIO"><span class="annot"><span class="annottext">runStreamIO :: forall a. Stream a -&gt; State RealWorld -&gt; IO (a, State RealWorld)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamIO"><span class="hs-identifier hs-var hs-var">runStreamIO</span></a></span></span><span> </span><span id="local-6989586621679057504"><span class="annot"><span class="annottext">Stream a
</span><a href="#local-6989586621679057504"><span class="hs-identifier hs-var">strm</span></a></span></span><span> </span><span id="local-6989586621679057505"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057505"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ST RealWorld (a, State RealWorld) -&gt; IO (a, State RealWorld)
forall a. ST RealWorld a -&gt; IO a
</span><span class="hs-identifier hs-var">stToIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream a -&gt; State RealWorld -&gt; ST RealWorld (a, State RealWorld)
forall a s. Stream a -&gt; State s -&gt; ST s (a, State s)
</span><a href="Codec.Compression.Zlib.Stream.html#runStream"><span class="hs-identifier hs-var">Stream.runStream</span></a></span><span> </span><span class="annot"><span class="annottext">Stream a
</span><a href="#local-6989586621679057504"><span class="hs-identifier hs-var">strm</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057505"><span class="hs-identifier hs-var">zstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#compressStreamIO"><span class="hs-identifier hs-type">compressStreamIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Format"><span class="hs-identifier hs-type">Stream.Format</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressParams"><span class="hs-identifier hs-type">CompressParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressStream"><span class="hs-identifier hs-type">CompressStream</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span>
</span><span id="line-747"></span><span id="compressStreamIO"><span class="annot"><span class="annottext">compressStreamIO :: Format -&gt; CompressParams -&gt; CompressStream IO
</span><a href="Codec.Compression.Zlib.Internal.html#compressStreamIO"><span class="hs-identifier hs-var hs-var">compressStreamIO</span></a></span></span><span> </span><span id="local-6989586621679057506"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057506"><span class="hs-identifier hs-var">format</span></a></span></span><span> </span><span id="local-6989586621679057507"><span class="annot"><span class="annottext">CompressParams
</span><a href="#local-6989586621679057507"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-748"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressInputRequired"><span class="hs-identifier hs-type">CompressInputRequired</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-749"></span><span>      </span><span class="annot"><span class="annottext">compressSupplyInput :: ByteString -&gt; IO (CompressStream IO)
</span><a href="Codec.Compression.Zlib.Internal.html#compressSupplyInput"><span class="hs-identifier hs-var">compressSupplyInput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057508"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057508"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-750"></span><span>        </span><span id="local-6989586621679057509"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057509"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (State RealWorld)
</span><a href="Codec.Compression.Zlib.Internal.html#mkStateIO"><span class="hs-identifier hs-var">mkStateIO</span></a></span><span>
</span><span id="line-751"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679057510"><span class="annot"><span class="annottext">next :: ByteString -&gt; Stream (CompressStream Stream)
</span><a href="#local-6989586621679057510"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format
-&gt; CompressParams -&gt; ByteString -&gt; Stream (CompressStream Stream)
</span><a href="Codec.Compression.Zlib.Internal.html#compressStream"><span class="hs-identifier hs-var">compressStream</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057506"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">CompressParams
</span><a href="#local-6989586621679057507"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-752"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679057511"><span class="annot"><span class="annottext">CompressStream Stream
</span><a href="#local-6989586621679057511"><span class="hs-identifier hs-var">strm'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057512"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057512"><span class="hs-identifier hs-var">zstate'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (CompressStream Stream)
-&gt; State RealWorld -&gt; IO (CompressStream Stream, State RealWorld)
forall a. Stream a -&gt; State RealWorld -&gt; IO (a, State RealWorld)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamIO"><span class="hs-identifier hs-var">runStreamIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Stream (CompressStream Stream)
</span><a href="#local-6989586621679057510"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057508"><span class="hs-identifier hs-var">chunk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057509"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-753"></span><span>        </span><span class="annot"><span class="annottext">CompressStream IO -&gt; IO (CompressStream IO)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompressStream Stream -&gt; State RealWorld -&gt; CompressStream IO
</span><a href="#local-6989586621679057513"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CompressStream Stream
</span><a href="#local-6989586621679057511"><span class="hs-identifier hs-var">strm'</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057512"><span class="hs-identifier hs-var">zstate'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-754"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-755"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-756"></span><span>    </span><span class="annot"><a href="#local-6989586621679057513"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressStream"><span class="hs-identifier hs-type">CompressStream</span></a></span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#State"><span class="hs-identifier hs-type">Stream.State</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressStream"><span class="hs-identifier hs-type">CompressStream</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span>
</span><span id="line-757"></span><span>    </span><span id="local-6989586621679057513"><span class="annot"><span class="annottext">go :: CompressStream Stream -&gt; State RealWorld -&gt; CompressStream IO
</span><a href="#local-6989586621679057513"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressInputRequired"><span class="hs-identifier hs-type">CompressInputRequired</span></a></span><span> </span><span id="local-6989586621679057514"><span class="annot"><span class="annottext">ByteString -&gt; Stream (CompressStream Stream)
</span><a href="#local-6989586621679057514"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679057515"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057515"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-758"></span><span>      </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressInputRequired"><span class="hs-identifier hs-type">CompressInputRequired</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-759"></span><span>        </span><span class="annot"><span class="annottext">compressSupplyInput :: ByteString -&gt; IO (CompressStream IO)
</span><a href="Codec.Compression.Zlib.Internal.html#compressSupplyInput"><span class="hs-identifier hs-var">compressSupplyInput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057516"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057516"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-760"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679057517"><span class="annot"><span class="annottext">CompressStream Stream
</span><a href="#local-6989586621679057517"><span class="hs-identifier hs-var">strm'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057518"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057518"><span class="hs-identifier hs-var">zstate'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (CompressStream Stream)
-&gt; State RealWorld -&gt; IO (CompressStream Stream, State RealWorld)
forall a. Stream a -&gt; State RealWorld -&gt; IO (a, State RealWorld)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamIO"><span class="hs-identifier hs-var">runStreamIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Stream (CompressStream Stream)
</span><a href="#local-6989586621679057514"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057516"><span class="hs-identifier hs-var">chunk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057515"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-761"></span><span>          </span><span class="annot"><span class="annottext">CompressStream IO -&gt; IO (CompressStream IO)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompressStream Stream -&gt; State RealWorld -&gt; CompressStream IO
</span><a href="#local-6989586621679057513"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CompressStream Stream
</span><a href="#local-6989586621679057517"><span class="hs-identifier hs-var">strm'</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057518"><span class="hs-identifier hs-var">zstate'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-762"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-763"></span><span>
</span><span id="line-764"></span><span>    </span><span class="annot"><a href="#local-6989586621679057513"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressOutputAvailable"><span class="hs-identifier hs-type">CompressOutputAvailable</span></a></span><span> </span><span id="local-6989586621679057519"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057519"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span id="local-6989586621679057520"><span class="annot"><span class="annottext">Stream (CompressStream Stream)
</span><a href="#local-6989586621679057520"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679057521"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057521"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-765"></span><span>      </span><span class="annot"><span class="annottext">ByteString -&gt; IO (CompressStream IO) -&gt; CompressStream IO
forall (m :: * -&gt; *).
ByteString -&gt; m (CompressStream m) -&gt; CompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#CompressOutputAvailable"><span class="hs-identifier hs-var">CompressOutputAvailable</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057519"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (CompressStream IO) -&gt; CompressStream IO)
-&gt; IO (CompressStream IO) -&gt; CompressStream IO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-766"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679057522"><span class="annot"><span class="annottext">CompressStream Stream
</span><a href="#local-6989586621679057522"><span class="hs-identifier hs-var">strm'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057523"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057523"><span class="hs-identifier hs-var">zstate'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (CompressStream Stream)
-&gt; State RealWorld -&gt; IO (CompressStream Stream, State RealWorld)
forall a. Stream a -&gt; State RealWorld -&gt; IO (a, State RealWorld)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamIO"><span class="hs-identifier hs-var">runStreamIO</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (CompressStream Stream)
</span><a href="#local-6989586621679057520"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057521"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-767"></span><span>        </span><span class="annot"><span class="annottext">CompressStream IO -&gt; IO (CompressStream IO)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompressStream Stream -&gt; State RealWorld -&gt; CompressStream IO
</span><a href="#local-6989586621679057513"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CompressStream Stream
</span><a href="#local-6989586621679057522"><span class="hs-identifier hs-var">strm'</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057523"><span class="hs-identifier hs-var">zstate'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-768"></span><span>
</span><span id="line-769"></span><span>    </span><span class="annot"><a href="#local-6989586621679057513"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CompressStream Stream
</span><a href="Codec.Compression.Zlib.Internal.html#CompressStreamEnd"><span class="hs-identifier hs-var">CompressStreamEnd</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompressStream IO
forall (m :: * -&gt; *). CompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#CompressStreamEnd"><span class="hs-identifier hs-var">CompressStreamEnd</span></a></span><span>
</span><span id="line-770"></span><span>
</span><span id="line-771"></span><span id="local-6989586621679056820"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#compressStreamST"><span class="hs-identifier hs-type">compressStreamST</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Format"><span class="hs-identifier hs-type">Stream.Format</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressParams"><span class="hs-identifier hs-type">CompressParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressStream"><span class="hs-identifier hs-type">CompressStream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679056820"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-772"></span><span id="compressStreamST"><span class="annot"><span class="annottext">compressStreamST :: forall s. Format -&gt; CompressParams -&gt; CompressStream (ST s)
</span><a href="Codec.Compression.Zlib.Internal.html#compressStreamST"><span class="hs-identifier hs-var hs-var">compressStreamST</span></a></span></span><span> </span><span id="local-6989586621679057527"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057527"><span class="hs-identifier hs-var">format</span></a></span></span><span> </span><span id="local-6989586621679057528"><span class="annot"><span class="annottext">CompressParams
</span><a href="#local-6989586621679057528"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-773"></span><span>    </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressInputRequired"><span class="hs-identifier hs-type">CompressInputRequired</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-774"></span><span>      </span><span class="annot"><span class="annottext">compressSupplyInput :: ByteString -&gt; ST s (CompressStream (ST s))
</span><a href="Codec.Compression.Zlib.Internal.html#compressSupplyInput"><span class="hs-identifier hs-var">compressSupplyInput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057529"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057529"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-775"></span><span>        </span><span id="local-6989586621679057530"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057530"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ST s (State s)
forall s. ST s (State s)
</span><a href="Codec.Compression.Zlib.Internal.html#mkStateST"><span class="hs-identifier hs-var">mkStateST</span></a></span><span>
</span><span id="line-776"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679057531"><span class="annot"><span class="annottext">next :: ByteString -&gt; Stream (CompressStream Stream)
</span><a href="#local-6989586621679057531"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format
-&gt; CompressParams -&gt; ByteString -&gt; Stream (CompressStream Stream)
</span><a href="Codec.Compression.Zlib.Internal.html#compressStream"><span class="hs-identifier hs-var">compressStream</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057527"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">CompressParams
</span><a href="#local-6989586621679057528"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-777"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679057532"><span class="annot"><span class="annottext">CompressStream Stream
</span><a href="#local-6989586621679057532"><span class="hs-identifier hs-var">strm'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057533"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057533"><span class="hs-identifier hs-var">zstate'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (CompressStream Stream)
-&gt; State s -&gt; ST s (CompressStream Stream, State s)
forall a s. Stream a -&gt; State s -&gt; ST s (a, State s)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamST"><span class="hs-identifier hs-var">runStreamST</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Stream (CompressStream Stream)
</span><a href="#local-6989586621679057531"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057529"><span class="hs-identifier hs-var">chunk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057530"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-778"></span><span>        </span><span class="annot"><span class="annottext">CompressStream (ST s) -&gt; ST s (CompressStream (ST s))
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompressStream Stream -&gt; State s -&gt; CompressStream (ST s)
forall s. CompressStream Stream -&gt; State s -&gt; CompressStream (ST s)
</span><a href="#local-6989586621679057534"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CompressStream Stream
</span><a href="#local-6989586621679057532"><span class="hs-identifier hs-var">strm'</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057533"><span class="hs-identifier hs-var">zstate'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-779"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-780"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-781"></span><span>    </span><span id="local-6989586621679056869"><span class="annot"><a href="#local-6989586621679057534"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressStream"><span class="hs-identifier hs-type">CompressStream</span></a></span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#State"><span class="hs-identifier hs-type">Stream.State</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056869"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressStream"><span class="hs-identifier hs-type">CompressStream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679056869"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-782"></span><span>    </span><span id="local-6989586621679057534"><span class="annot"><span class="annottext">go :: forall s. CompressStream Stream -&gt; State s -&gt; CompressStream (ST s)
</span><a href="#local-6989586621679057534"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressInputRequired"><span class="hs-identifier hs-type">CompressInputRequired</span></a></span><span> </span><span id="local-6989586621679057539"><span class="annot"><span class="annottext">ByteString -&gt; Stream (CompressStream Stream)
</span><a href="#local-6989586621679057539"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679057540"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057540"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-783"></span><span>      </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressInputRequired"><span class="hs-identifier hs-type">CompressInputRequired</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-784"></span><span>        </span><span class="annot"><span class="annottext">compressSupplyInput :: ByteString -&gt; ST s (CompressStream (ST s))
</span><a href="Codec.Compression.Zlib.Internal.html#compressSupplyInput"><span class="hs-identifier hs-var">compressSupplyInput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057541"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057541"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-785"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679057542"><span class="annot"><span class="annottext">CompressStream Stream
</span><a href="#local-6989586621679057542"><span class="hs-identifier hs-var">strm'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057543"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057543"><span class="hs-identifier hs-var">zstate'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (CompressStream Stream)
-&gt; State s -&gt; ST s (CompressStream Stream, State s)
forall a s. Stream a -&gt; State s -&gt; ST s (a, State s)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamST"><span class="hs-identifier hs-var">runStreamST</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Stream (CompressStream Stream)
</span><a href="#local-6989586621679057539"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057541"><span class="hs-identifier hs-var">chunk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057540"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-786"></span><span>          </span><span class="annot"><span class="annottext">CompressStream (ST s) -&gt; ST s (CompressStream (ST s))
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompressStream Stream -&gt; State s -&gt; CompressStream (ST s)
forall s. CompressStream Stream -&gt; State s -&gt; CompressStream (ST s)
</span><a href="#local-6989586621679057534"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CompressStream Stream
</span><a href="#local-6989586621679057542"><span class="hs-identifier hs-var">strm'</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057543"><span class="hs-identifier hs-var">zstate'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-787"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-788"></span><span>
</span><span id="line-789"></span><span>    </span><span class="annot"><a href="#local-6989586621679057534"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#CompressOutputAvailable"><span class="hs-identifier hs-type">CompressOutputAvailable</span></a></span><span> </span><span id="local-6989586621679057544"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057544"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span id="local-6989586621679057545"><span class="annot"><span class="annottext">Stream (CompressStream Stream)
</span><a href="#local-6989586621679057545"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679057546"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057546"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-790"></span><span>      </span><span class="annot"><span class="annottext">ByteString -&gt; ST s (CompressStream (ST s)) -&gt; CompressStream (ST s)
forall (m :: * -&gt; *).
ByteString -&gt; m (CompressStream m) -&gt; CompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#CompressOutputAvailable"><span class="hs-identifier hs-var">CompressOutputAvailable</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057544"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">(ST s (CompressStream (ST s)) -&gt; CompressStream (ST s))
-&gt; ST s (CompressStream (ST s)) -&gt; CompressStream (ST s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-791"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679057547"><span class="annot"><span class="annottext">CompressStream Stream
</span><a href="#local-6989586621679057547"><span class="hs-identifier hs-var">strm'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057548"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057548"><span class="hs-identifier hs-var">zstate'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (CompressStream Stream)
-&gt; State s -&gt; ST s (CompressStream Stream, State s)
forall a s. Stream a -&gt; State s -&gt; ST s (a, State s)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamST"><span class="hs-identifier hs-var">runStreamST</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (CompressStream Stream)
</span><a href="#local-6989586621679057545"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057546"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-792"></span><span>        </span><span class="annot"><span class="annottext">CompressStream (ST s) -&gt; ST s (CompressStream (ST s))
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompressStream Stream -&gt; State s -&gt; CompressStream (ST s)
forall s. CompressStream Stream -&gt; State s -&gt; CompressStream (ST s)
</span><a href="#local-6989586621679057534"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CompressStream Stream
</span><a href="#local-6989586621679057547"><span class="hs-identifier hs-var">strm'</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057548"><span class="hs-identifier hs-var">zstate'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-793"></span><span>
</span><span id="line-794"></span><span>    </span><span class="annot"><a href="#local-6989586621679057534"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CompressStream Stream
</span><a href="Codec.Compression.Zlib.Internal.html#CompressStreamEnd"><span class="hs-identifier hs-var">CompressStreamEnd</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompressStream (ST s)
forall (m :: * -&gt; *). CompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#CompressStreamEnd"><span class="hs-identifier hs-var">CompressStreamEnd</span></a></span><span>
</span><span id="line-795"></span><span>
</span><span id="line-796"></span><span>
</span><span id="line-797"></span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#decompressStreamIO"><span class="hs-identifier hs-type">decompressStreamIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Format"><span class="hs-identifier hs-type">Stream.Format</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressParams"><span class="hs-identifier hs-type">DecompressParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span>
</span><span id="line-798"></span><span id="decompressStreamIO"><span class="annot"><span class="annottext">decompressStreamIO :: Format -&gt; DecompressParams -&gt; DecompressStream IO
</span><a href="Codec.Compression.Zlib.Internal.html#decompressStreamIO"><span class="hs-identifier hs-var hs-var">decompressStreamIO</span></a></span></span><span> </span><span id="local-6989586621679057549"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057549"><span class="hs-identifier hs-var">format</span></a></span></span><span> </span><span id="local-6989586621679057550"><span class="annot"><span class="annottext">DecompressParams
</span><a href="#local-6989586621679057550"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-799"></span><span>      </span><span class="annot"><span class="annottext">(ByteString -&gt; IO (DecompressStream IO)) -&gt; DecompressStream IO
forall (m :: * -&gt; *).
(ByteString -&gt; m (DecompressStream m)) -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressInputRequired"><span class="hs-identifier hs-var">DecompressInputRequired</span></a></span><span> </span><span class="annot"><span class="annottext">((ByteString -&gt; IO (DecompressStream IO)) -&gt; DecompressStream IO)
-&gt; (ByteString -&gt; IO (DecompressStream IO)) -&gt; DecompressStream IO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057551"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057551"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-800"></span><span>        </span><span id="local-6989586621679057552"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057552"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (State RealWorld)
</span><a href="Codec.Compression.Zlib.Internal.html#mkStateIO"><span class="hs-identifier hs-var">mkStateIO</span></a></span><span>
</span><span id="line-801"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679057553"><span class="annot"><span class="annottext">next :: ByteString -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057553"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format
-&gt; DecompressParams
-&gt; Bool
-&gt; ByteString
-&gt; Stream (DecompressStream Stream)
</span><a href="Codec.Compression.Zlib.Internal.html#decompressStream"><span class="hs-identifier hs-var">decompressStream</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057549"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressParams
</span><a href="#local-6989586621679057550"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-802"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679057554"><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057554"><span class="hs-identifier hs-var">strm'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057555"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057555"><span class="hs-identifier hs-var">zstate'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
-&gt; State RealWorld -&gt; IO (DecompressStream Stream, State RealWorld)
forall a. Stream a -&gt; State RealWorld -&gt; IO (a, State RealWorld)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamIO"><span class="hs-identifier hs-var">runStreamIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057553"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057551"><span class="hs-identifier hs-var">chunk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057552"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-803"></span><span>        </span><span class="annot"><span class="annottext">DecompressStream Stream
-&gt; State RealWorld -&gt; Bool -&gt; IO (DecompressStream IO)
</span><a href="#local-6989586621679057556"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057554"><span class="hs-identifier hs-var">strm'</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057555"><span class="hs-identifier hs-var">zstate'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><span class="hs-identifier hs-var">S.null</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057551"><span class="hs-identifier hs-var">chunk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-804"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-805"></span><span>    </span><span class="annot"><a href="#local-6989586621679057556"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#State"><span class="hs-identifier hs-type">Stream.State</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-806"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span>
</span><span id="line-807"></span><span>    </span><span id="local-6989586621679057556"><span class="annot"><span class="annottext">go :: DecompressStream Stream
-&gt; State RealWorld -&gt; Bool -&gt; IO (DecompressStream IO)
</span><a href="#local-6989586621679057556"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressInputRequired"><span class="hs-identifier hs-type">DecompressInputRequired</span></a></span><span> </span><span id="local-6989586621679057558"><span class="annot"><span class="annottext">ByteString -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057558"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679057559"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057559"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-808"></span><span>      </span><span class="annot"><span class="annottext">DecompressStream IO -&gt; IO (DecompressStream IO)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(DecompressStream IO -&gt; IO (DecompressStream IO))
-&gt; DecompressStream IO -&gt; IO (DecompressStream IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO (DecompressStream IO)) -&gt; DecompressStream IO
forall (m :: * -&gt; *).
(ByteString -&gt; m (DecompressStream m)) -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressInputRequired"><span class="hs-identifier hs-var">DecompressInputRequired</span></a></span><span> </span><span class="annot"><span class="annottext">((ByteString -&gt; IO (DecompressStream IO)) -&gt; DecompressStream IO)
-&gt; (ByteString -&gt; IO (DecompressStream IO)) -&gt; DecompressStream IO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057560"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057560"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-809"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679057561"><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057561"><span class="hs-identifier hs-var">strm'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057562"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057562"><span class="hs-identifier hs-var">zstate'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
-&gt; State RealWorld -&gt; IO (DecompressStream Stream, State RealWorld)
forall a. Stream a -&gt; State RealWorld -&gt; IO (a, State RealWorld)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamIO"><span class="hs-identifier hs-var">runStreamIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057558"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057560"><span class="hs-identifier hs-var">chunk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057559"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-810"></span><span>        </span><span class="annot"><span class="annottext">DecompressStream Stream
-&gt; State RealWorld -&gt; Bool -&gt; IO (DecompressStream IO)
</span><a href="#local-6989586621679057556"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057561"><span class="hs-identifier hs-var">strm'</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057562"><span class="hs-identifier hs-var">zstate'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><span class="hs-identifier hs-var">S.null</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057560"><span class="hs-identifier hs-var">chunk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-811"></span><span>
</span><span id="line-812"></span><span>    </span><span class="annot"><a href="#local-6989586621679057556"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressOutputAvailable"><span class="hs-identifier hs-type">DecompressOutputAvailable</span></a></span><span> </span><span id="local-6989586621679057563"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057563"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span id="local-6989586621679057564"><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057564"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679057565"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057565"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679057566"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057566"><span class="hs-identifier hs-var">eof</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-813"></span><span>      </span><span class="annot"><span class="annottext">DecompressStream IO -&gt; IO (DecompressStream IO)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(DecompressStream IO -&gt; IO (DecompressStream IO))
-&gt; DecompressStream IO -&gt; IO (DecompressStream IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO (DecompressStream IO) -&gt; DecompressStream IO
forall (m :: * -&gt; *).
ByteString -&gt; m (DecompressStream m) -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressOutputAvailable"><span class="hs-identifier hs-var">DecompressOutputAvailable</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057563"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (DecompressStream IO) -&gt; DecompressStream IO)
-&gt; IO (DecompressStream IO) -&gt; DecompressStream IO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-814"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679057567"><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057567"><span class="hs-identifier hs-var">strm'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057568"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057568"><span class="hs-identifier hs-var">zstate'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
-&gt; State RealWorld -&gt; IO (DecompressStream Stream, State RealWorld)
forall a. Stream a -&gt; State RealWorld -&gt; IO (a, State RealWorld)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamIO"><span class="hs-identifier hs-var">runStreamIO</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057564"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057565"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-815"></span><span>        </span><span class="annot"><span class="annottext">DecompressStream Stream
-&gt; State RealWorld -&gt; Bool -&gt; IO (DecompressStream IO)
</span><a href="#local-6989586621679057556"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057567"><span class="hs-identifier hs-var">strm'</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057568"><span class="hs-identifier hs-var">zstate'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057566"><span class="hs-identifier hs-var">eof</span></a></span><span>
</span><span id="line-816"></span><span>
</span><span id="line-817"></span><span>    </span><span class="annot"><a href="#local-6989586621679057556"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStreamEnd"><span class="hs-identifier hs-type">DecompressStreamEnd</span></a></span><span> </span><span id="local-6989586621679057569"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057569"><span class="hs-identifier hs-var">unconsumed</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679057570"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057570"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679057571"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057571"><span class="hs-identifier hs-var">eof</span></a></span></span><span>
</span><span id="line-818"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057549"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">Format -&gt; Format -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="Codec.Compression.Zlib.Stream.html#gzipFormat"><span class="hs-identifier hs-var">Stream.gzipFormat</span></a></span><span>
</span><span id="line-819"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DecompressParams -&gt; Bool
</span><a href="Codec.Compression.Zlib.Internal.html#decompressAllMembers"><span class="hs-identifier hs-var">decompressAllMembers</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressParams
</span><a href="#local-6989586621679057550"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-820"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057571"><span class="hs-identifier hs-var">eof</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; State RealWorld -&gt; IO (DecompressStream IO)
</span><a href="#local-6989586621679057572"><span class="hs-identifier hs-var">tryFollowingStream</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057569"><span class="hs-identifier hs-var">unconsumed</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057570"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-821"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; State RealWorld -&gt; IO (DecompressStream IO)
forall {m :: * -&gt; *}.
ByteString -&gt; State RealWorld -&gt; IO (DecompressStream m)
</span><a href="#local-6989586621679057573"><span class="hs-identifier hs-var">finaliseStreamEnd</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057569"><span class="hs-identifier hs-var">unconsumed</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057570"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-822"></span><span>
</span><span id="line-823"></span><span>    </span><span class="annot"><a href="#local-6989586621679057556"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStreamError"><span class="hs-identifier hs-type">DecompressStreamError</span></a></span><span> </span><span id="local-6989586621679057574"><span class="annot"><span class="annottext">DecompressError
</span><a href="#local-6989586621679057574"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679057575"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057575"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DecompressError -&gt; State RealWorld -&gt; IO (DecompressStream IO)
forall {m :: * -&gt; *}.
DecompressError -&gt; State RealWorld -&gt; IO (DecompressStream m)
</span><a href="#local-6989586621679057576"><span class="hs-identifier hs-var">finaliseStreamError</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressError
</span><a href="#local-6989586621679057574"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057575"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-824"></span><span>
</span><span id="line-825"></span><span>    </span><span class="annot"><a href="#local-6989586621679057572"><span class="hs-identifier hs-type">tryFollowingStream</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#State"><span class="hs-identifier hs-type">Stream.State</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span>
</span><span id="line-826"></span><span>    </span><span id="local-6989586621679057572"><span class="annot"><span class="annottext">tryFollowingStream :: ByteString -&gt; State RealWorld -&gt; IO (DecompressStream IO)
</span><a href="#local-6989586621679057572"><span class="hs-identifier hs-var hs-var">tryFollowingStream</span></a></span></span><span> </span><span id="local-6989586621679057577"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057577"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span id="local-6989586621679057578"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057578"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">S.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057577"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-827"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DecompressStream IO -&gt; IO (DecompressStream IO)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(DecompressStream IO -&gt; IO (DecompressStream IO))
-&gt; DecompressStream IO -&gt; IO (DecompressStream IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO (DecompressStream IO)) -&gt; DecompressStream IO
forall (m :: * -&gt; *).
(ByteString -&gt; m (DecompressStream m)) -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressInputRequired"><span class="hs-identifier hs-var">DecompressInputRequired</span></a></span><span> </span><span class="annot"><span class="annottext">((ByteString -&gt; IO (DecompressStream IO)) -&gt; DecompressStream IO)
-&gt; (ByteString -&gt; IO (DecompressStream IO)) -&gt; DecompressStream IO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057580"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057580"><span class="hs-identifier hs-var">chunk'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">S.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057580"><span class="hs-identifier hs-var">chunk'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-828"></span><span>         </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; State RealWorld -&gt; IO (DecompressStream IO)
forall {m :: * -&gt; *}.
ByteString -&gt; State RealWorld -&gt; IO (DecompressStream m)
</span><a href="#local-6989586621679057573"><span class="hs-identifier hs-var">finaliseStreamEnd</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier hs-var">S.empty</span></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057578"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-829"></span><span>         </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(?callStack::CallStack) =&gt; ByteString -&gt; Word8
ByteString -&gt; Word8
</span><span class="hs-identifier hs-var">S.head</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057580"><span class="hs-identifier hs-var">chunk'</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x1f</span></span><span>
</span><span id="line-830"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; State RealWorld -&gt; IO (DecompressStream IO)
forall {m :: * -&gt; *}.
ByteString -&gt; State RealWorld -&gt; IO (DecompressStream m)
</span><a href="#local-6989586621679057573"><span class="hs-identifier hs-var">finaliseStreamEnd</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057580"><span class="hs-identifier hs-var">chunk'</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057578"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-831"></span><span>         </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DecompressStream IO -&gt; IO (DecompressStream IO)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(DecompressStream IO -&gt; IO (DecompressStream IO))
-&gt; DecompressStream IO -&gt; IO (DecompressStream IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO (DecompressStream IO)) -&gt; DecompressStream IO
forall (m :: * -&gt; *).
(ByteString -&gt; m (DecompressStream m)) -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressInputRequired"><span class="hs-identifier hs-var">DecompressInputRequired</span></a></span><span> </span><span class="annot"><span class="annottext">((ByteString -&gt; IO (DecompressStream IO)) -&gt; DecompressStream IO)
-&gt; (ByteString -&gt; IO (DecompressStream IO)) -&gt; DecompressStream IO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057583"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057583"><span class="hs-identifier hs-var">chunk''</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">S.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057583"><span class="hs-identifier hs-var">chunk''</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-832"></span><span>            </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; State RealWorld -&gt; IO (DecompressStream IO)
forall {m :: * -&gt; *}.
ByteString -&gt; State RealWorld -&gt; IO (DecompressStream m)
</span><a href="#local-6989586621679057573"><span class="hs-identifier hs-var">finaliseStreamEnd</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057580"><span class="hs-identifier hs-var">chunk'</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057578"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-833"></span><span>            </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString -&gt; State RealWorld -&gt; IO (DecompressStream IO)
</span><a href="#local-6989586621679057584"><span class="hs-identifier hs-var">checkHeaderSplit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(?callStack::CallStack) =&gt; ByteString -&gt; Word8
ByteString -&gt; Word8
</span><span class="hs-identifier hs-var">S.head</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057580"><span class="hs-identifier hs-var">chunk'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057583"><span class="hs-identifier hs-var">chunk''</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057578"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-834"></span><span>         </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; State RealWorld -&gt; IO (DecompressStream IO)
</span><a href="#local-6989586621679057585"><span class="hs-identifier hs-var">checkHeader</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057580"><span class="hs-identifier hs-var">chunk'</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057578"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-835"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DecompressStream IO -&gt; IO (DecompressStream IO)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(DecompressStream IO -&gt; IO (DecompressStream IO))
-&gt; DecompressStream IO -&gt; IO (DecompressStream IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO (DecompressStream IO)) -&gt; DecompressStream IO
forall (m :: * -&gt; *).
(ByteString -&gt; m (DecompressStream m)) -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressInputRequired"><span class="hs-identifier hs-var">DecompressInputRequired</span></a></span><span> </span><span class="annot"><span class="annottext">((ByteString -&gt; IO (DecompressStream IO)) -&gt; DecompressStream IO)
-&gt; (ByteString -&gt; IO (DecompressStream IO)) -&gt; DecompressStream IO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057586"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057586"><span class="hs-identifier hs-var">chunk'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">S.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057586"><span class="hs-identifier hs-var">chunk'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-836"></span><span>         </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; State RealWorld -&gt; IO (DecompressStream IO)
forall {m :: * -&gt; *}.
ByteString -&gt; State RealWorld -&gt; IO (DecompressStream m)
</span><a href="#local-6989586621679057573"><span class="hs-identifier hs-var">finaliseStreamEnd</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057577"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057578"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-837"></span><span>         </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString -&gt; State RealWorld -&gt; IO (DecompressStream IO)
</span><a href="#local-6989586621679057584"><span class="hs-identifier hs-var">checkHeaderSplit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(?callStack::CallStack) =&gt; ByteString -&gt; Word8
ByteString -&gt; Word8
</span><span class="hs-identifier hs-var">S.head</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057577"><span class="hs-identifier hs-var">chunk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057586"><span class="hs-identifier hs-var">chunk'</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057578"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-838"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; State RealWorld -&gt; IO (DecompressStream IO)
</span><a href="#local-6989586621679057585"><span class="hs-identifier hs-var">checkHeader</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057577"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057578"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-839"></span><span>
</span><span id="line-840"></span><span>    </span><span class="annot"><a href="#local-6989586621679057584"><span class="hs-identifier hs-type">checkHeaderSplit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#State"><span class="hs-identifier hs-type">Stream.State</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span>
</span><span id="line-841"></span><span>    </span><span id="local-6989586621679057584"><span class="annot"><span class="annottext">checkHeaderSplit :: Word8 -&gt; ByteString -&gt; State RealWorld -&gt; IO (DecompressStream IO)
</span><a href="#local-6989586621679057584"><span class="hs-identifier hs-var hs-var">checkHeaderSplit</span></a></span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x1f</span></span><span> </span><span id="local-6989586621679057587"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057587"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span id="local-6989586621679057588"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057588"><span class="hs-identifier hs-var">zstate</span></a></span></span><span>
</span><span id="line-842"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(?callStack::CallStack) =&gt; ByteString -&gt; Word8
ByteString -&gt; Word8
</span><span class="hs-identifier hs-var">S.head</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057587"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x8b</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-843"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679057591"><span class="annot"><span class="annottext">resume :: Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057591"><span class="hs-identifier hs-var hs-var">resume</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format
-&gt; DecompressParams
-&gt; Bool
-&gt; ByteString
-&gt; Stream (DecompressStream Stream)
</span><a href="Codec.Compression.Zlib.Internal.html#decompressStream"><span class="hs-identifier hs-var">decompressStream</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057549"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressParams
</span><a href="#local-6989586621679057550"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Word8] -&gt; ByteString
</span><span class="hs-identifier hs-var">S.pack</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x1f</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x8b</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-844"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">S.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057587"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-845"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-846"></span><span>            </span><span class="hs-comment">-- have to handle the remaining data in this chunk</span><span>
</span><span id="line-847"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressInputRequired"><span class="hs-identifier hs-type">DecompressInputRequired</span></a></span><span> </span><span id="local-6989586621679057593"><span class="annot"><span class="annottext">ByteString -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057593"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057594"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057594"><span class="hs-identifier hs-var">zstate'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
-&gt; State RealWorld -&gt; IO (DecompressStream Stream, State RealWorld)
forall a. Stream a -&gt; State RealWorld -&gt; IO (a, State RealWorld)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamIO"><span class="hs-identifier hs-var">runStreamIO</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057591"><span class="hs-identifier hs-var">resume</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057588"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-848"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679057595"><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057595"><span class="hs-identifier hs-var">strm'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057596"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057596"><span class="hs-identifier hs-var">zstate''</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
-&gt; State RealWorld -&gt; IO (DecompressStream Stream, State RealWorld)
forall a. Stream a -&gt; State RealWorld -&gt; IO (a, State RealWorld)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamIO"><span class="hs-identifier hs-var">runStreamIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057593"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(?callStack::CallStack) =&gt; ByteString -&gt; ByteString
ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">S.tail</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057587"><span class="hs-identifier hs-var">chunk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057594"><span class="hs-identifier hs-var">zstate'</span></a></span><span>
</span><span id="line-849"></span><span>            </span><span class="annot"><span class="annottext">DecompressStream Stream
-&gt; State RealWorld -&gt; Bool -&gt; IO (DecompressStream IO)
</span><a href="#local-6989586621679057556"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057595"><span class="hs-identifier hs-var">strm'</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057596"><span class="hs-identifier hs-var">zstate''</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-850"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-851"></span><span>            </span><span class="hs-comment">-- subtle special case when the chunk tail is empty</span><span>
</span><span id="line-852"></span><span>            </span><span class="hs-comment">-- yay for QC tests</span><span>
</span><span id="line-853"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679057598"><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057598"><span class="hs-identifier hs-var">strm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057599"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057599"><span class="hs-identifier hs-var">zstate'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
-&gt; State RealWorld -&gt; IO (DecompressStream Stream, State RealWorld)
forall a. Stream a -&gt; State RealWorld -&gt; IO (a, State RealWorld)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamIO"><span class="hs-identifier hs-var">runStreamIO</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057591"><span class="hs-identifier hs-var">resume</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057588"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-854"></span><span>            </span><span class="annot"><span class="annottext">DecompressStream Stream
-&gt; State RealWorld -&gt; Bool -&gt; IO (DecompressStream IO)
</span><a href="#local-6989586621679057556"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057598"><span class="hs-identifier hs-var">strm</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057599"><span class="hs-identifier hs-var">zstate'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-855"></span><span>    </span><span class="annot"><a href="#local-6989586621679057584"><span class="hs-identifier hs-var">checkHeaderSplit</span></a></span><span> </span><span id="local-6989586621679057600"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679057600"><span class="hs-identifier hs-var">byte</span></a></span></span><span> </span><span id="local-6989586621679057601"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057601"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span id="local-6989586621679057602"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057602"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-856"></span><span>        </span><span class="annot"><span class="annottext">ByteString -&gt; State RealWorld -&gt; IO (DecompressStream IO)
forall {m :: * -&gt; *}.
ByteString -&gt; State RealWorld -&gt; IO (DecompressStream m)
</span><a href="#local-6989586621679057573"><span class="hs-identifier hs-var">finaliseStreamEnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">S.cons</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679057600"><span class="hs-identifier hs-var">byte</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057601"><span class="hs-identifier hs-var">chunk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057602"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-857"></span><span>
</span><span id="line-858"></span><span>    </span><span class="annot"><a href="#local-6989586621679057585"><span class="hs-identifier hs-type">checkHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#State"><span class="hs-identifier hs-type">Stream.State</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span>
</span><span id="line-859"></span><span>    </span><span id="local-6989586621679057585"><span class="annot"><span class="annottext">checkHeader :: ByteString -&gt; State RealWorld -&gt; IO (DecompressStream IO)
</span><a href="#local-6989586621679057585"><span class="hs-identifier hs-var hs-var">checkHeader</span></a></span></span><span> </span><span id="local-6989586621679057604"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057604"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span id="local-6989586621679057605"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057605"><span class="hs-identifier hs-var">zstate</span></a></span></span><span>
</span><span id="line-860"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(?callStack::CallStack) =&gt; ByteString -&gt; Int -&gt; Word8
ByteString -&gt; Int -&gt; Word8
</span><span class="hs-identifier hs-var">S.index</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057604"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x1f</span></span><span>
</span><span id="line-861"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(?callStack::CallStack) =&gt; ByteString -&gt; Int -&gt; Word8
ByteString -&gt; Int -&gt; Word8
</span><span class="hs-identifier hs-var">S.index</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057604"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x8b</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-862"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679057607"><span class="annot"><span class="annottext">resume :: Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057607"><span class="hs-identifier hs-var hs-var">resume</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format
-&gt; DecompressParams
-&gt; Bool
-&gt; ByteString
-&gt; Stream (DecompressStream Stream)
</span><a href="Codec.Compression.Zlib.Internal.html#decompressStream"><span class="hs-identifier hs-var">decompressStream</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057549"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressParams
</span><a href="#local-6989586621679057550"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057604"><span class="hs-identifier hs-var">chunk</span></a></span><span>
</span><span id="line-863"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679057608"><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057608"><span class="hs-identifier hs-var">strm'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057609"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057609"><span class="hs-identifier hs-var">zstate'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
-&gt; State RealWorld -&gt; IO (DecompressStream Stream, State RealWorld)
forall a. Stream a -&gt; State RealWorld -&gt; IO (a, State RealWorld)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamIO"><span class="hs-identifier hs-var">runStreamIO</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057607"><span class="hs-identifier hs-var">resume</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057605"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-864"></span><span>        </span><span class="annot"><span class="annottext">DecompressStream Stream
-&gt; State RealWorld -&gt; Bool -&gt; IO (DecompressStream IO)
</span><a href="#local-6989586621679057556"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057608"><span class="hs-identifier hs-var">strm'</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057609"><span class="hs-identifier hs-var">zstate'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-865"></span><span>    </span><span class="annot"><a href="#local-6989586621679057585"><span class="hs-identifier hs-var">checkHeader</span></a></span><span> </span><span id="local-6989586621679057610"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057610"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span id="local-6989586621679057611"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057611"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; State RealWorld -&gt; IO (DecompressStream IO)
forall {m :: * -&gt; *}.
ByteString -&gt; State RealWorld -&gt; IO (DecompressStream m)
</span><a href="#local-6989586621679057573"><span class="hs-identifier hs-var">finaliseStreamEnd</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057610"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057611"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-866"></span><span>
</span><span id="line-867"></span><span>    </span><span id="local-6989586621679057573"><span class="annot"><span class="annottext">finaliseStreamEnd :: ByteString -&gt; State RealWorld -&gt; IO (DecompressStream m)
</span><a href="#local-6989586621679057573"><span class="hs-identifier hs-var hs-var">finaliseStreamEnd</span></a></span></span><span> </span><span id="local-6989586621679057614"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057614"><span class="hs-identifier hs-var">unconsumed</span></a></span></span><span> </span><span id="local-6989586621679057615"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057615"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-868"></span><span>        </span><span class="annot"><span class="annottext">((), State RealWorld)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream () -&gt; State RealWorld -&gt; IO ((), State RealWorld)
forall a. Stream a -&gt; State RealWorld -&gt; IO (a, State RealWorld)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamIO"><span class="hs-identifier hs-var">runStreamIO</span></a></span><span> </span><span class="annot"><span class="annottext">Stream ()
</span><a href="Codec.Compression.Zlib.Stream.html#finalise"><span class="hs-identifier hs-var">Stream.finalise</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057615"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-869"></span><span>        </span><span class="annot"><span class="annottext">DecompressStream m -&gt; IO (DecompressStream m)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; DecompressStream m
forall (m :: * -&gt; *). ByteString -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressStreamEnd"><span class="hs-identifier hs-var">DecompressStreamEnd</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057614"><span class="hs-identifier hs-var">unconsumed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-870"></span><span>
</span><span id="line-871"></span><span>    </span><span id="local-6989586621679057576"><span class="annot"><span class="annottext">finaliseStreamError :: DecompressError -&gt; State RealWorld -&gt; IO (DecompressStream m)
</span><a href="#local-6989586621679057576"><span class="hs-identifier hs-var hs-var">finaliseStreamError</span></a></span></span><span> </span><span id="local-6989586621679057618"><span class="annot"><span class="annottext">DecompressError
</span><a href="#local-6989586621679057618"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span id="local-6989586621679057619"><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057619"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-872"></span><span>        </span><span class="annot"><span class="annottext">((), State RealWorld)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream () -&gt; State RealWorld -&gt; IO ((), State RealWorld)
forall a. Stream a -&gt; State RealWorld -&gt; IO (a, State RealWorld)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamIO"><span class="hs-identifier hs-var">runStreamIO</span></a></span><span> </span><span class="annot"><span class="annottext">Stream ()
</span><a href="Codec.Compression.Zlib.Stream.html#finalise"><span class="hs-identifier hs-var">Stream.finalise</span></a></span><span> </span><span class="annot"><span class="annottext">State RealWorld
</span><a href="#local-6989586621679057619"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-873"></span><span>        </span><span class="annot"><span class="annottext">DecompressStream m -&gt; IO (DecompressStream m)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DecompressError -&gt; DecompressStream m
forall (m :: * -&gt; *). DecompressError -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressStreamError"><span class="hs-identifier hs-var">DecompressStreamError</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressError
</span><a href="#local-6989586621679057618"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-874"></span><span>
</span><span id="line-875"></span><span>
</span><span id="line-876"></span><span id="local-6989586621679056844"><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#decompressStreamST"><span class="hs-identifier hs-type">decompressStreamST</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Format"><span class="hs-identifier hs-type">Stream.Format</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressParams"><span class="hs-identifier hs-type">DecompressParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679056844"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-877"></span><span id="decompressStreamST"><span class="annot"><span class="annottext">decompressStreamST :: forall s. Format -&gt; DecompressParams -&gt; DecompressStream (ST s)
</span><a href="Codec.Compression.Zlib.Internal.html#decompressStreamST"><span class="hs-identifier hs-var hs-var">decompressStreamST</span></a></span></span><span> </span><span id="local-6989586621679057622"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057622"><span class="hs-identifier hs-var">format</span></a></span></span><span> </span><span id="local-6989586621679057623"><span class="annot"><span class="annottext">DecompressParams
</span><a href="#local-6989586621679057623"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-878"></span><span>      </span><span class="annot"><span class="annottext">(ByteString -&gt; ST s (DecompressStream (ST s)))
-&gt; DecompressStream (ST s)
forall (m :: * -&gt; *).
(ByteString -&gt; m (DecompressStream m)) -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressInputRequired"><span class="hs-identifier hs-var">DecompressInputRequired</span></a></span><span> </span><span class="annot"><span class="annottext">((ByteString -&gt; ST s (DecompressStream (ST s)))
 -&gt; DecompressStream (ST s))
-&gt; (ByteString -&gt; ST s (DecompressStream (ST s)))
-&gt; DecompressStream (ST s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057624"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057624"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-879"></span><span>        </span><span id="local-6989586621679057625"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057625"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ST s (State s)
forall s. ST s (State s)
</span><a href="Codec.Compression.Zlib.Internal.html#mkStateST"><span class="hs-identifier hs-var">mkStateST</span></a></span><span>
</span><span id="line-880"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679057626"><span class="annot"><span class="annottext">next :: ByteString -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057626"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format
-&gt; DecompressParams
-&gt; Bool
-&gt; ByteString
-&gt; Stream (DecompressStream Stream)
</span><a href="Codec.Compression.Zlib.Internal.html#decompressStream"><span class="hs-identifier hs-var">decompressStream</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057622"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressParams
</span><a href="#local-6989586621679057623"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-881"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679057627"><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057627"><span class="hs-identifier hs-var">strm'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057628"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057628"><span class="hs-identifier hs-var">zstate'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
-&gt; State s -&gt; ST s (DecompressStream Stream, State s)
forall a s. Stream a -&gt; State s -&gt; ST s (a, State s)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamST"><span class="hs-identifier hs-var">runStreamST</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057626"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057624"><span class="hs-identifier hs-var">chunk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057625"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-882"></span><span>        </span><span class="annot"><span class="annottext">DecompressStream Stream
-&gt; State s -&gt; Bool -&gt; ST s (DecompressStream (ST s))
forall s.
DecompressStream Stream
-&gt; State s -&gt; Bool -&gt; ST s (DecompressStream (ST s))
</span><a href="#local-6989586621679057629"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057627"><span class="hs-identifier hs-var">strm'</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057628"><span class="hs-identifier hs-var">zstate'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><span class="hs-identifier hs-var">S.null</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057624"><span class="hs-identifier hs-var">chunk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-883"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-884"></span><span>    </span><span id="local-6989586621679056874"><span class="annot"><a href="#local-6989586621679057629"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#State"><span class="hs-identifier hs-type">Stream.State</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056874"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-885"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679056874"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679056874"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-886"></span><span>    </span><span id="local-6989586621679057629"><span class="annot"><span class="annottext">go :: forall s.
DecompressStream Stream
-&gt; State s -&gt; Bool -&gt; ST s (DecompressStream (ST s))
</span><a href="#local-6989586621679057629"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressInputRequired"><span class="hs-identifier hs-type">DecompressInputRequired</span></a></span><span> </span><span id="local-6989586621679057635"><span class="annot"><span class="annottext">ByteString -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057635"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679057636"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057636"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-887"></span><span>      </span><span class="annot"><span class="annottext">DecompressStream (ST s) -&gt; ST s (DecompressStream (ST s))
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(DecompressStream (ST s) -&gt; ST s (DecompressStream (ST s)))
-&gt; DecompressStream (ST s) -&gt; ST s (DecompressStream (ST s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ST s (DecompressStream (ST s)))
-&gt; DecompressStream (ST s)
forall (m :: * -&gt; *).
(ByteString -&gt; m (DecompressStream m)) -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressInputRequired"><span class="hs-identifier hs-var">DecompressInputRequired</span></a></span><span> </span><span class="annot"><span class="annottext">((ByteString -&gt; ST s (DecompressStream (ST s)))
 -&gt; DecompressStream (ST s))
-&gt; (ByteString -&gt; ST s (DecompressStream (ST s)))
-&gt; DecompressStream (ST s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057637"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057637"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-888"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679057638"><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057638"><span class="hs-identifier hs-var">strm'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057639"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057639"><span class="hs-identifier hs-var">zstate'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
-&gt; State s -&gt; ST s (DecompressStream Stream, State s)
forall a s. Stream a -&gt; State s -&gt; ST s (a, State s)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamST"><span class="hs-identifier hs-var">runStreamST</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057635"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057637"><span class="hs-identifier hs-var">chunk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057636"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-889"></span><span>        </span><span class="annot"><span class="annottext">DecompressStream Stream
-&gt; State s -&gt; Bool -&gt; ST s (DecompressStream (ST s))
forall s.
DecompressStream Stream
-&gt; State s -&gt; Bool -&gt; ST s (DecompressStream (ST s))
</span><a href="#local-6989586621679057629"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057638"><span class="hs-identifier hs-var">strm'</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057639"><span class="hs-identifier hs-var">zstate'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><span class="hs-identifier hs-var">S.null</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057637"><span class="hs-identifier hs-var">chunk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-890"></span><span>
</span><span id="line-891"></span><span>    </span><span class="annot"><a href="#local-6989586621679057629"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressOutputAvailable"><span class="hs-identifier hs-type">DecompressOutputAvailable</span></a></span><span> </span><span id="local-6989586621679057640"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057640"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span id="local-6989586621679057641"><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057641"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679057642"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057642"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679057643"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057643"><span class="hs-identifier hs-var">eof</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-892"></span><span>      </span><span class="annot"><span class="annottext">DecompressStream (ST s) -&gt; ST s (DecompressStream (ST s))
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(DecompressStream (ST s) -&gt; ST s (DecompressStream (ST s)))
-&gt; DecompressStream (ST s) -&gt; ST s (DecompressStream (ST s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString
-&gt; ST s (DecompressStream (ST s)) -&gt; DecompressStream (ST s)
forall (m :: * -&gt; *).
ByteString -&gt; m (DecompressStream m) -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressOutputAvailable"><span class="hs-identifier hs-var">DecompressOutputAvailable</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057640"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">(ST s (DecompressStream (ST s)) -&gt; DecompressStream (ST s))
-&gt; ST s (DecompressStream (ST s)) -&gt; DecompressStream (ST s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-893"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679057644"><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057644"><span class="hs-identifier hs-var">strm'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057645"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057645"><span class="hs-identifier hs-var">zstate'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
-&gt; State s -&gt; ST s (DecompressStream Stream, State s)
forall a s. Stream a -&gt; State s -&gt; ST s (a, State s)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamST"><span class="hs-identifier hs-var">runStreamST</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057641"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057642"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-894"></span><span>        </span><span class="annot"><span class="annottext">DecompressStream Stream
-&gt; State s -&gt; Bool -&gt; ST s (DecompressStream (ST s))
forall s.
DecompressStream Stream
-&gt; State s -&gt; Bool -&gt; ST s (DecompressStream (ST s))
</span><a href="#local-6989586621679057629"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057644"><span class="hs-identifier hs-var">strm'</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057645"><span class="hs-identifier hs-var">zstate'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057643"><span class="hs-identifier hs-var">eof</span></a></span><span>
</span><span id="line-895"></span><span>
</span><span id="line-896"></span><span>    </span><span class="annot"><a href="#local-6989586621679057629"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStreamEnd"><span class="hs-identifier hs-type">DecompressStreamEnd</span></a></span><span> </span><span id="local-6989586621679057646"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057646"><span class="hs-identifier hs-var">unconsumed</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679057647"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057647"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679057648"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057648"><span class="hs-identifier hs-var">eof</span></a></span></span><span>
</span><span id="line-897"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057622"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">Format -&gt; Format -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="Codec.Compression.Zlib.Stream.html#gzipFormat"><span class="hs-identifier hs-var">Stream.gzipFormat</span></a></span><span>
</span><span id="line-898"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DecompressParams -&gt; Bool
</span><a href="Codec.Compression.Zlib.Internal.html#decompressAllMembers"><span class="hs-identifier hs-var">decompressAllMembers</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressParams
</span><a href="#local-6989586621679057623"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-899"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679057648"><span class="hs-identifier hs-var">eof</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; State s -&gt; ST s (DecompressStream (ST s))
forall s. ByteString -&gt; State s -&gt; ST s (DecompressStream (ST s))
</span><a href="#local-6989586621679057649"><span class="hs-identifier hs-var">tryFollowingStream</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057646"><span class="hs-identifier hs-var">unconsumed</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057647"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-900"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; State s -&gt; ST s (DecompressStream (ST s))
forall {s} {m :: * -&gt; *}.
ByteString -&gt; State s -&gt; ST s (DecompressStream m)
</span><a href="#local-6989586621679057650"><span class="hs-identifier hs-var">finaliseStreamEnd</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057646"><span class="hs-identifier hs-var">unconsumed</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057647"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-901"></span><span>
</span><span id="line-902"></span><span>    </span><span class="annot"><a href="#local-6989586621679057629"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStreamError"><span class="hs-identifier hs-type">DecompressStreamError</span></a></span><span> </span><span id="local-6989586621679057651"><span class="annot"><span class="annottext">DecompressError
</span><a href="#local-6989586621679057651"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679057652"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057652"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DecompressError -&gt; State s -&gt; ST s (DecompressStream (ST s))
forall {s} {m :: * -&gt; *}.
DecompressError -&gt; State s -&gt; ST s (DecompressStream m)
</span><a href="#local-6989586621679057653"><span class="hs-identifier hs-var">finaliseStreamError</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressError
</span><a href="#local-6989586621679057651"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057652"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-903"></span><span>
</span><span id="line-904"></span><span>
</span><span id="line-905"></span><span>    </span><span id="local-6989586621679056876"><span class="annot"><a href="#local-6989586621679057649"><span class="hs-identifier hs-type">tryFollowingStream</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#State"><span class="hs-identifier hs-type">Stream.State</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056876"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679056876"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679056876"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-906"></span><span>    </span><span id="local-6989586621679057649"><span class="annot"><span class="annottext">tryFollowingStream :: forall s. ByteString -&gt; State s -&gt; ST s (DecompressStream (ST s))
</span><a href="#local-6989586621679057649"><span class="hs-identifier hs-var hs-var">tryFollowingStream</span></a></span></span><span> </span><span id="local-6989586621679057679"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057679"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span id="local-6989586621679057680"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057680"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-907"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">S.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057679"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-908"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DecompressStream (ST s) -&gt; ST s (DecompressStream (ST s))
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(DecompressStream (ST s) -&gt; ST s (DecompressStream (ST s)))
-&gt; DecompressStream (ST s) -&gt; ST s (DecompressStream (ST s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ST s (DecompressStream (ST s)))
-&gt; DecompressStream (ST s)
forall (m :: * -&gt; *).
(ByteString -&gt; m (DecompressStream m)) -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressInputRequired"><span class="hs-identifier hs-var">DecompressInputRequired</span></a></span><span> </span><span class="annot"><span class="annottext">((ByteString -&gt; ST s (DecompressStream (ST s)))
 -&gt; DecompressStream (ST s))
-&gt; (ByteString -&gt; ST s (DecompressStream (ST s)))
-&gt; DecompressStream (ST s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057681"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057681"><span class="hs-identifier hs-var">chunk'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">S.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057681"><span class="hs-identifier hs-var">chunk'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-909"></span><span>         </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; State s -&gt; ST s (DecompressStream (ST s))
forall {s} {m :: * -&gt; *}.
ByteString -&gt; State s -&gt; ST s (DecompressStream m)
</span><a href="#local-6989586621679057650"><span class="hs-identifier hs-var">finaliseStreamEnd</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier hs-var">S.empty</span></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057680"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-910"></span><span>         </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(?callStack::CallStack) =&gt; ByteString -&gt; Word8
ByteString -&gt; Word8
</span><span class="hs-identifier hs-var">S.head</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057681"><span class="hs-identifier hs-var">chunk'</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x1f</span></span><span>
</span><span id="line-911"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; State s -&gt; ST s (DecompressStream (ST s))
forall {s} {m :: * -&gt; *}.
ByteString -&gt; State s -&gt; ST s (DecompressStream m)
</span><a href="#local-6989586621679057650"><span class="hs-identifier hs-var">finaliseStreamEnd</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057681"><span class="hs-identifier hs-var">chunk'</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057680"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-912"></span><span>         </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DecompressStream (ST s) -&gt; ST s (DecompressStream (ST s))
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(DecompressStream (ST s) -&gt; ST s (DecompressStream (ST s)))
-&gt; DecompressStream (ST s) -&gt; ST s (DecompressStream (ST s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ST s (DecompressStream (ST s)))
-&gt; DecompressStream (ST s)
forall (m :: * -&gt; *).
(ByteString -&gt; m (DecompressStream m)) -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressInputRequired"><span class="hs-identifier hs-var">DecompressInputRequired</span></a></span><span> </span><span class="annot"><span class="annottext">((ByteString -&gt; ST s (DecompressStream (ST s)))
 -&gt; DecompressStream (ST s))
-&gt; (ByteString -&gt; ST s (DecompressStream (ST s)))
-&gt; DecompressStream (ST s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057682"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057682"><span class="hs-identifier hs-var">chunk''</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">S.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057682"><span class="hs-identifier hs-var">chunk''</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-913"></span><span>            </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; State s -&gt; ST s (DecompressStream (ST s))
forall {s} {m :: * -&gt; *}.
ByteString -&gt; State s -&gt; ST s (DecompressStream m)
</span><a href="#local-6989586621679057650"><span class="hs-identifier hs-var">finaliseStreamEnd</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057681"><span class="hs-identifier hs-var">chunk'</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057680"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-914"></span><span>            </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString -&gt; State s -&gt; ST s (DecompressStream (ST s))
forall s.
Word8 -&gt; ByteString -&gt; State s -&gt; ST s (DecompressStream (ST s))
</span><a href="#local-6989586621679057683"><span class="hs-identifier hs-var">checkHeaderSplit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(?callStack::CallStack) =&gt; ByteString -&gt; Word8
ByteString -&gt; Word8
</span><span class="hs-identifier hs-var">S.head</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057681"><span class="hs-identifier hs-var">chunk'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057682"><span class="hs-identifier hs-var">chunk''</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057680"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-915"></span><span>         </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; State s -&gt; ST s (DecompressStream (ST s))
forall s. ByteString -&gt; State s -&gt; ST s (DecompressStream (ST s))
</span><a href="#local-6989586621679057684"><span class="hs-identifier hs-var">checkHeader</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057681"><span class="hs-identifier hs-var">chunk'</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057680"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-916"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DecompressStream (ST s) -&gt; ST s (DecompressStream (ST s))
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(DecompressStream (ST s) -&gt; ST s (DecompressStream (ST s)))
-&gt; DecompressStream (ST s) -&gt; ST s (DecompressStream (ST s))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ST s (DecompressStream (ST s)))
-&gt; DecompressStream (ST s)
forall (m :: * -&gt; *).
(ByteString -&gt; m (DecompressStream m)) -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressInputRequired"><span class="hs-identifier hs-var">DecompressInputRequired</span></a></span><span> </span><span class="annot"><span class="annottext">((ByteString -&gt; ST s (DecompressStream (ST s)))
 -&gt; DecompressStream (ST s))
-&gt; (ByteString -&gt; ST s (DecompressStream (ST s)))
-&gt; DecompressStream (ST s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057685"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057685"><span class="hs-identifier hs-var">chunk'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">S.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057685"><span class="hs-identifier hs-var">chunk'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-917"></span><span>         </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; State s -&gt; ST s (DecompressStream (ST s))
forall {s} {m :: * -&gt; *}.
ByteString -&gt; State s -&gt; ST s (DecompressStream m)
</span><a href="#local-6989586621679057650"><span class="hs-identifier hs-var">finaliseStreamEnd</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057679"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057680"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-918"></span><span>         </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString -&gt; State s -&gt; ST s (DecompressStream (ST s))
forall s.
Word8 -&gt; ByteString -&gt; State s -&gt; ST s (DecompressStream (ST s))
</span><a href="#local-6989586621679057683"><span class="hs-identifier hs-var">checkHeaderSplit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(?callStack::CallStack) =&gt; ByteString -&gt; Word8
ByteString -&gt; Word8
</span><span class="hs-identifier hs-var">S.head</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057679"><span class="hs-identifier hs-var">chunk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057685"><span class="hs-identifier hs-var">chunk'</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057680"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-919"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; State s -&gt; ST s (DecompressStream (ST s))
forall s. ByteString -&gt; State s -&gt; ST s (DecompressStream (ST s))
</span><a href="#local-6989586621679057684"><span class="hs-identifier hs-var">checkHeader</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057679"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057680"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-920"></span><span>
</span><span id="line-921"></span><span>    </span><span id="local-6989586621679056882"><span class="annot"><a href="#local-6989586621679057683"><span class="hs-identifier hs-type">checkHeaderSplit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#State"><span class="hs-identifier hs-type">Stream.State</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056882"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679056882"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679056882"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-922"></span><span>    </span><span id="local-6989586621679057683"><span class="annot"><span class="annottext">checkHeaderSplit :: forall s.
Word8 -&gt; ByteString -&gt; State s -&gt; ST s (DecompressStream (ST s))
</span><a href="#local-6989586621679057683"><span class="hs-identifier hs-var hs-var">checkHeaderSplit</span></a></span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x1f</span></span><span> </span><span id="local-6989586621679057699"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057699"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span id="local-6989586621679057700"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057700"><span class="hs-identifier hs-var">zstate</span></a></span></span><span>
</span><span id="line-923"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(?callStack::CallStack) =&gt; ByteString -&gt; Word8
ByteString -&gt; Word8
</span><span class="hs-identifier hs-var">S.head</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057699"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x8b</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-924"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679057703"><span class="annot"><span class="annottext">resume :: Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057703"><span class="hs-identifier hs-var hs-var">resume</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format
-&gt; DecompressParams
-&gt; Bool
-&gt; ByteString
-&gt; Stream (DecompressStream Stream)
</span><a href="Codec.Compression.Zlib.Internal.html#decompressStream"><span class="hs-identifier hs-var">decompressStream</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057622"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressParams
</span><a href="#local-6989586621679057623"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Word8] -&gt; ByteString
</span><span class="hs-identifier hs-var">S.pack</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x1f</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x8b</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-925"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">S.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057699"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-926"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-927"></span><span>            </span><span class="hs-comment">-- have to handle the remaining data in this chunk</span><span>
</span><span id="line-928"></span><span>            </span><span id="local-6989586621679057704"><span class="annot"><span class="annottext">(DecompressStream Stream, State s)
</span><a href="#local-6989586621679057704"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
-&gt; State s -&gt; ST s (DecompressStream Stream, State s)
forall a s. Stream a -&gt; State s -&gt; ST s (a, State s)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamST"><span class="hs-identifier hs-var">runStreamST</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057703"><span class="hs-identifier hs-var">resume</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057700"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-929"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressInputRequired"><span class="hs-identifier hs-type">DecompressInputRequired</span></a></span><span> </span><span id="local-6989586621679057705"><span class="annot"><span class="annottext">ByteString -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057705"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057706"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057706"><span class="hs-identifier hs-var">zstate'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DecompressStream Stream, State s)
</span><a href="#local-6989586621679057704"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-930"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679057707"><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057707"><span class="hs-identifier hs-var">strm'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057708"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057708"><span class="hs-identifier hs-var">zstate''</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
-&gt; State s -&gt; ST s (DecompressStream Stream, State s)
forall a s. Stream a -&gt; State s -&gt; ST s (a, State s)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamST"><span class="hs-identifier hs-var">runStreamST</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057705"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(?callStack::CallStack) =&gt; ByteString -&gt; ByteString
ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">S.tail</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057699"><span class="hs-identifier hs-var">chunk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057706"><span class="hs-identifier hs-var">zstate'</span></a></span><span>
</span><span id="line-931"></span><span>            </span><span class="annot"><span class="annottext">DecompressStream Stream
-&gt; State s -&gt; Bool -&gt; ST s (DecompressStream (ST s))
forall s.
DecompressStream Stream
-&gt; State s -&gt; Bool -&gt; ST s (DecompressStream (ST s))
</span><a href="#local-6989586621679057629"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057707"><span class="hs-identifier hs-var">strm'</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057708"><span class="hs-identifier hs-var">zstate''</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-932"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-933"></span><span>            </span><span class="hs-comment">-- subtle special case when the chunk tail is empty</span><span>
</span><span id="line-934"></span><span>            </span><span class="hs-comment">-- yay for QC tests</span><span>
</span><span id="line-935"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679057709"><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057709"><span class="hs-identifier hs-var">strm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057710"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057710"><span class="hs-identifier hs-var">zstate'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
-&gt; State s -&gt; ST s (DecompressStream Stream, State s)
forall a s. Stream a -&gt; State s -&gt; ST s (a, State s)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamST"><span class="hs-identifier hs-var">runStreamST</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057703"><span class="hs-identifier hs-var">resume</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057700"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-936"></span><span>            </span><span class="annot"><span class="annottext">DecompressStream Stream
-&gt; State s -&gt; Bool -&gt; ST s (DecompressStream (ST s))
forall s.
DecompressStream Stream
-&gt; State s -&gt; Bool -&gt; ST s (DecompressStream (ST s))
</span><a href="#local-6989586621679057629"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057709"><span class="hs-identifier hs-var">strm</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057710"><span class="hs-identifier hs-var">zstate'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-937"></span><span>    </span><span class="annot"><a href="#local-6989586621679057683"><span class="hs-identifier hs-var">checkHeaderSplit</span></a></span><span> </span><span id="local-6989586621679057711"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679057711"><span class="hs-identifier hs-var">byte</span></a></span></span><span> </span><span id="local-6989586621679057712"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057712"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span id="local-6989586621679057713"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057713"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-938"></span><span>        </span><span class="annot"><span class="annottext">ByteString -&gt; State s -&gt; ST s (DecompressStream (ST s))
forall {s} {m :: * -&gt; *}.
ByteString -&gt; State s -&gt; ST s (DecompressStream m)
</span><a href="#local-6989586621679057650"><span class="hs-identifier hs-var">finaliseStreamEnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">S.cons</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679057711"><span class="hs-identifier hs-var">byte</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057712"><span class="hs-identifier hs-var">chunk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057713"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-939"></span><span>
</span><span id="line-940"></span><span>    </span><span id="local-6989586621679057714"><span class="annot"><a href="#local-6989586621679057684"><span class="hs-identifier hs-type">checkHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Codec.Compression.Zlib.Stream.html#State"><span class="hs-identifier hs-type">Stream.State</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057714"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679057714"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Codec.Compression.Zlib.Internal.html#DecompressStream"><span class="hs-identifier hs-type">DecompressStream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679057714"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-941"></span><span>    </span><span id="local-6989586621679057684"><span class="annot"><span class="annottext">checkHeader :: forall s. ByteString -&gt; State s -&gt; ST s (DecompressStream (ST s))
</span><a href="#local-6989586621679057684"><span class="hs-identifier hs-var hs-var">checkHeader</span></a></span></span><span> </span><span id="local-6989586621679057724"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057724"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span id="local-6989586621679057725"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057725"><span class="hs-identifier hs-var">zstate</span></a></span></span><span>
</span><span id="line-942"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(?callStack::CallStack) =&gt; ByteString -&gt; Int -&gt; Word8
ByteString -&gt; Int -&gt; Word8
</span><span class="hs-identifier hs-var">S.index</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057724"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x1f</span></span><span>
</span><span id="line-943"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(?callStack::CallStack) =&gt; ByteString -&gt; Int -&gt; Word8
ByteString -&gt; Int -&gt; Word8
</span><span class="hs-identifier hs-var">S.index</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057724"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x8b</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-944"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679057726"><span class="annot"><span class="annottext">resume :: Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057726"><span class="hs-identifier hs-var hs-var">resume</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format
-&gt; DecompressParams
-&gt; Bool
-&gt; ByteString
-&gt; Stream (DecompressStream Stream)
</span><a href="Codec.Compression.Zlib.Internal.html#decompressStream"><span class="hs-identifier hs-var">decompressStream</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621679057622"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressParams
</span><a href="#local-6989586621679057623"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057724"><span class="hs-identifier hs-var">chunk</span></a></span><span>
</span><span id="line-945"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679057727"><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057727"><span class="hs-identifier hs-var">strm'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057728"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057728"><span class="hs-identifier hs-var">zstate'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
-&gt; State s -&gt; ST s (DecompressStream Stream, State s)
forall a s. Stream a -&gt; State s -&gt; ST s (a, State s)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamST"><span class="hs-identifier hs-var">runStreamST</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (DecompressStream Stream)
</span><a href="#local-6989586621679057726"><span class="hs-identifier hs-var">resume</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057725"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-946"></span><span>        </span><span class="annot"><span class="annottext">DecompressStream Stream
-&gt; State s -&gt; Bool -&gt; ST s (DecompressStream (ST s))
forall s.
DecompressStream Stream
-&gt; State s -&gt; Bool -&gt; ST s (DecompressStream (ST s))
</span><a href="#local-6989586621679057629"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressStream Stream
</span><a href="#local-6989586621679057727"><span class="hs-identifier hs-var">strm'</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057728"><span class="hs-identifier hs-var">zstate'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-947"></span><span>    </span><span class="annot"><a href="#local-6989586621679057684"><span class="hs-identifier hs-var">checkHeader</span></a></span><span> </span><span id="local-6989586621679057729"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057729"><span class="hs-identifier hs-var">chunk</span></a></span></span><span> </span><span id="local-6989586621679057730"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057730"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; State s -&gt; ST s (DecompressStream (ST s))
forall {s} {m :: * -&gt; *}.
ByteString -&gt; State s -&gt; ST s (DecompressStream m)
</span><a href="#local-6989586621679057650"><span class="hs-identifier hs-var">finaliseStreamEnd</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057729"><span class="hs-identifier hs-var">chunk</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057730"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-948"></span><span>
</span><span id="line-949"></span><span>    </span><span id="local-6989586621679057650"><span class="annot"><span class="annottext">finaliseStreamEnd :: ByteString -&gt; State s -&gt; ST s (DecompressStream m)
</span><a href="#local-6989586621679057650"><span class="hs-identifier hs-var hs-var">finaliseStreamEnd</span></a></span></span><span> </span><span id="local-6989586621679057733"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057733"><span class="hs-identifier hs-var">unconsumed</span></a></span></span><span> </span><span id="local-6989586621679057734"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057734"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-950"></span><span>        </span><span class="annot"><span class="annottext">((), State s)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream () -&gt; State s -&gt; ST s ((), State s)
forall a s. Stream a -&gt; State s -&gt; ST s (a, State s)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamST"><span class="hs-identifier hs-var">runStreamST</span></a></span><span> </span><span class="annot"><span class="annottext">Stream ()
</span><a href="Codec.Compression.Zlib.Stream.html#finalise"><span class="hs-identifier hs-var">Stream.finalise</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057734"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-951"></span><span>        </span><span class="annot"><span class="annottext">DecompressStream m -&gt; ST s (DecompressStream m)
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; DecompressStream m
forall (m :: * -&gt; *). ByteString -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressStreamEnd"><span class="hs-identifier hs-var">DecompressStreamEnd</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679057733"><span class="hs-identifier hs-var">unconsumed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-952"></span><span>
</span><span id="line-953"></span><span>    </span><span id="local-6989586621679057653"><span class="annot"><span class="annottext">finaliseStreamError :: DecompressError -&gt; State s -&gt; ST s (DecompressStream m)
</span><a href="#local-6989586621679057653"><span class="hs-identifier hs-var hs-var">finaliseStreamError</span></a></span></span><span> </span><span id="local-6989586621679057737"><span class="annot"><span class="annottext">DecompressError
</span><a href="#local-6989586621679057737"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span id="local-6989586621679057738"><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057738"><span class="hs-identifier hs-var">zstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-954"></span><span>        </span><span class="annot"><span class="annottext">((), State s)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream () -&gt; State s -&gt; ST s ((), State s)
forall a s. Stream a -&gt; State s -&gt; ST s (a, State s)
</span><a href="Codec.Compression.Zlib.Internal.html#runStreamST"><span class="hs-identifier hs-var">runStreamST</span></a></span><span> </span><span class="annot"><span class="annottext">Stream ()
</span><a href="Codec.Compression.Zlib.Stream.html#finalise"><span class="hs-identifier hs-var">Stream.finalise</span></a></span><span> </span><span class="annot"><span class="annottext">State s
</span><a href="#local-6989586621679057738"><span class="hs-identifier hs-var">zstate</span></a></span><span>
</span><span id="line-955"></span><span>        </span><span class="annot"><span class="annottext">DecompressStream m -&gt; ST s (DecompressStream m)
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DecompressError -&gt; DecompressStream m
forall (m :: * -&gt; *). DecompressError -&gt; DecompressStream m
</span><a href="Codec.Compression.Zlib.Internal.html#DecompressStreamError"><span class="hs-identifier hs-var">DecompressStreamError</span></a></span><span> </span><span class="annot"><span class="annottext">DecompressError
</span><a href="#local-6989586621679057737"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-956"></span></pre></body></html>