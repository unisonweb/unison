<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Merge.Mergeblob3</span><span>
</span><span id="line-2"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#Mergeblob3"><span class="hs-identifier">Mergeblob3</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-3"></span><span>    </span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#makeMergeblob3"><span class="hs-identifier">makeMergeblob3</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-4"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-5"></span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapped</span></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Align</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">align</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifoldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">bifoldMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NESet</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set.NonEmpty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set.NonEmpty</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.These</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">These</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unzip</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DataDeclaration</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Decl</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DataDeclaration</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DataDeclaration</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DeclNameLookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DeclNameLookup</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">expectConstructorNames</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DeclNameLookup</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DeclNameLookup</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.Mergeblob2.html"><span class="hs-identifier">Unison.Merge.Mergeblob2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.Mergeblob2.html#Mergeblob2"><span class="hs-identifier">Mergeblob2</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.PrettyPrintEnv.html"><span class="hs-identifier">Unison.Merge.PrettyPrintEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.PrettyPrintEnv.html#makePrettyPrintEnv"><span class="hs-identifier">makePrettyPrintEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.ThreeWay.html"><span class="hs-identifier">Unison.Merge.ThreeWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.ThreeWay.html#ThreeWay"><span class="hs-identifier">ThreeWay</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.ThreeWay.html"><span class="hs-identifier">Unison.Merge.ThreeWay</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ThreeWay</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html"><span class="hs-identifier">Unison.Merge.TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier">TwoWay</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html"><span class="hs-identifier">Unison.Merge.TwoWay</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TwoWay</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.Unconflicts.html"><span class="hs-identifier">Unison.Merge.Unconflicts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.Unconflicts.html#Unconflicts"><span class="hs-identifier">Unconflicts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.Unconflicts.html"><span class="hs-identifier">Unison.Merge.Unconflicts</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Unconflicts</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Names</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Names</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PrettyPrintEnvDecl</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Reference'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TypeReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TypeReferenceId</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Referent</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Referent</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.FilePrinter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">renderDefnsForUnisonFile</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.Name</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Name</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Term</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Term</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Type</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.BiMultimap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">BiMultimap</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.BiMultimap</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BiMultimap</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Defns</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">DefnsF</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">defnsAreEmpty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipDefnsWith</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipDefnsWith3</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipDefnsWith4</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ColorText</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Pretty</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Pretty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pretty</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Relation</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Relation</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unzip</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">data</span><span> </span><span id="Mergeblob3"><span class="annot"><a href="Unison.Merge.Mergeblob3.html#Mergeblob3"><span class="hs-identifier hs-var">Mergeblob3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Mergeblob3"><span class="annot"><a href="Unison.Merge.Mergeblob3.html#Mergeblob3"><span class="hs-identifier hs-var">Mergeblob3</span></a></span></span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Alibdeps%3AMergeblob3"><span class="annot"><span class="annottext">Mergeblob3 -&gt; Names
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3Alibdeps%3AMergeblob3"><span class="hs-identifier hs-var hs-var">libdeps</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>    </span><span id="%24sel%3AstageOne%3AMergeblob3"><span class="annot"><span class="annottext">Mergeblob3 -&gt; DefnsF (Map Name) Referent TypeReference
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3AstageOne%3AMergeblob3"><span class="hs-identifier hs-var hs-var">stageOne</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span id="%24sel%3AstageTwo%3AMergeblob3"><span class="annot"><span class="annottext">Mergeblob3 -&gt; DefnsF (Map Name) Referent TypeReference
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3AstageTwo%3AMergeblob3"><span class="hs-identifier hs-var hs-var">stageTwo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span id="%24sel%3AuniqueTypeGuids%3AMergeblob3"><span class="annot"><span class="annottext">Mergeblob3 -&gt; Map Name Text
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3AuniqueTypeGuids%3AMergeblob3"><span class="hs-identifier hs-var hs-var">uniqueTypeGuids</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span id="%24sel%3AunparsedFile%3AMergeblob3"><span class="annot"><span class="annottext">Mergeblob3 -&gt; Pretty ColorText
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3AunparsedFile%3AMergeblob3"><span class="hs-identifier hs-var hs-var">unparsedFile</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span id="local-6989586621679191250"><span class="annot"><a href="Unison.Merge.Mergeblob3.html#makeMergeblob3"><span class="hs-identifier hs-type">makeMergeblob3</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><a href="Unison.Merge.Mergeblob2.html#Mergeblob2"><span class="hs-identifier hs-type">Mergeblob2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191250"><span class="hs-identifier hs-type">libdep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-60"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-62"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-63"></span><span>  </span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#Mergeblob3"><span class="hs-identifier hs-type">Mergeblob3</span></a></span></span><span>
</span><span id="line-64"></span><span id="makeMergeblob3"><span class="annot"><span class="annottext">makeMergeblob3 :: forall libdep.
Mergeblob2 libdep
-&gt; TwoWay (DefnsF Set TermReferenceId TermReferenceId)
-&gt; Names
-&gt; TwoWay Text
-&gt; Mergeblob3
</span><a href="Unison.Merge.Mergeblob3.html#makeMergeblob3"><span class="hs-identifier hs-var hs-var">makeMergeblob3</span></a></span></span><span> </span><span id="local-6989586621679191624"><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679191624"><span class="hs-identifier hs-var">blob</span></a></span></span><span> </span><span id="local-6989586621679191625"><span class="annot"><span class="annottext">TwoWay (DefnsF Set TermReferenceId TermReferenceId)
</span><a href="#local-6989586621679191625"><span class="hs-identifier hs-var">dependents0</span></a></span></span><span> </span><span id="local-6989586621679191626"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679191626"><span class="hs-identifier hs-var">libdeps</span></a></span></span><span> </span><span id="local-6989586621679191627"><span class="annot"><span class="annottext">TwoWay Text
</span><a href="#local-6989586621679191627"><span class="hs-identifier hs-var">authors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679191628"><span class="hs-identifier hs-type">conflictsNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>      </span><span id="local-6989586621679191628"><span class="annot"><span class="annottext">conflictsNames :: TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191628"><span class="hs-identifier hs-var hs-var">conflictsNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-67"></span><span>        </span><span class="annot"><span class="annottext">(Map Name TermReferenceId -&gt; Set Name)
-&gt; (Map Name TermReferenceId -&gt; Set Name)
-&gt; Defns (Map Name TermReferenceId) (Map Name TermReferenceId)
-&gt; DefnsF Set Name Name
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; Defns a c -&gt; Defns b d
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">Map Name TermReferenceId -&gt; Set Name
forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span> </span><span class="annot"><span class="annottext">Map Name TermReferenceId -&gt; Set Name
forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span> </span><span class="annot"><span class="annottext">(Defns (Map Name TermReferenceId) (Map Name TermReferenceId)
 -&gt; DefnsF Set Name Name)
-&gt; TwoWay
     (Defns (Map Name TermReferenceId) (Map Name TermReferenceId))
-&gt; TwoWay (DefnsF Set Name Name)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679191624"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">conflicts</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span>      </span><span class="hs-comment">-- Identify the unconflicted dependents we need to pull into the Unison file (either first for typechecking, if</span><span>
</span><span id="line-70"></span><span>      </span><span class="hs-comment">-- there aren't conflicts, or else for manual conflict resolution without a typechecking step, if there are)</span><span>
</span><span id="line-71"></span><span>      </span><span class="annot"><a href="#local-6989586621679191632"><span class="hs-identifier hs-type">dependents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>      </span><span id="local-6989586621679191632"><span class="annot"><span class="annottext">dependents :: TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191632"><span class="hs-identifier hs-var hs-var">dependents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-73"></span><span>        </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; TwoWay (DefnsF Set Name Name)
forall name.
Ord name =&gt;
TwoWay (DefnsF Set name name)
-&gt; TwoWay (DefnsF Set name name)
-&gt; TwoWay (DefnsF Set name name)
-&gt; TwoWay (DefnsF Set name name)
</span><a href="Unison.Merge.Mergeblob3.html#filterDependents"><span class="hs-identifier hs-var">filterDependents</span></a></span><span>
</span><span id="line-74"></span><span>          </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191628"><span class="hs-identifier hs-var">conflictsNames</span></a></span><span>
</span><span id="line-75"></span><span>          </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679191624"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">soloUpdatesAndDeletes</span><span>
</span><span id="line-76"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679191634"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-77"></span><span>                </span><span id="local-6989586621679191634"><span class="annot"><span class="annottext">f :: Set TermReferenceId -&gt; Referent -&gt; NESet Name -&gt; Set Name
</span><a href="#local-6989586621679191634"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679191635"><span class="annot"><span class="annottext">Set TermReferenceId
</span><a href="#local-6989586621679191635"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span id="local-6989586621679191636"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679191636"><span class="hs-identifier hs-var">defn0</span></a></span></span><span> </span><span id="local-6989586621679191637"><span class="annot"><span class="annottext">NESet Name
</span><a href="#local-6989586621679191637"><span class="hs-identifier hs-var">names</span></a></span></span><span>
</span><span id="line-78"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679191638"><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621679191638"><span class="hs-identifier hs-var">defn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Maybe TermReferenceId
</span><span class="hs-identifier hs-var">Referent.toTermReferenceId</span></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679191636"><span class="hs-identifier hs-var">defn0</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>                    </span><span class="annot"><span class="annottext">TermReferenceId -&gt; Set TermReferenceId -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621679191638"><span class="hs-identifier hs-var">defn</span></a></span><span> </span><span class="annot"><span class="annottext">Set TermReferenceId
</span><a href="#local-6989586621679191635"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-80"></span><span>                      </span><span class="annot"><span class="annottext">NESet Name -&gt; Set Name
forall a. NESet a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.NonEmpty.toSet</span></span><span> </span><span class="annot"><span class="annottext">NESet Name
</span><a href="#local-6989586621679191637"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-81"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Name
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-82"></span><span>                </span><span class="annot"><a href="#local-6989586621679191643"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-83"></span><span>                </span><span id="local-6989586621679191643"><span class="annot"><span class="annottext">g :: Set TermReferenceId -&gt; TypeReference -&gt; NESet Name -&gt; Set Name
</span><a href="#local-6989586621679191643"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span id="local-6989586621679191644"><span class="annot"><span class="annottext">Set TermReferenceId
</span><a href="#local-6989586621679191644"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span id="local-6989586621679191645"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679191645"><span class="hs-identifier hs-var">defn0</span></a></span></span><span> </span><span id="local-6989586621679191646"><span class="annot"><span class="annottext">NESet Name
</span><a href="#local-6989586621679191646"><span class="hs-identifier hs-var">names</span></a></span></span><span>
</span><span id="line-84"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReferenceDerived</span></span><span> </span><span id="local-6989586621679191648"><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621679191648"><span class="hs-identifier hs-var">defn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679191645"><span class="hs-identifier hs-var">defn0</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>                    </span><span class="annot"><span class="annottext">TermReferenceId -&gt; Set TermReferenceId -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621679191648"><span class="hs-identifier hs-var">defn</span></a></span><span> </span><span class="annot"><span class="annottext">Set TermReferenceId
</span><a href="#local-6989586621679191644"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-86"></span><span>                      </span><span class="annot"><span class="annottext">NESet Name -&gt; Set Name
forall a. NESet a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.NonEmpty.toSet</span></span><span> </span><span class="annot"><span class="annottext">NESet Name
</span><a href="#local-6989586621679191646"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-87"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Name
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-88"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(BiMultimap Referent Name -&gt; Set TermReferenceId -&gt; Set Name)
-&gt; (BiMultimap TypeReference Name
    -&gt; Set TermReferenceId -&gt; Set Name)
-&gt; Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
-&gt; DefnsF Set TermReferenceId TermReferenceId
-&gt; DefnsF Set Name Name
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span>
</span><span id="line-89"></span><span>                  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679191649"><span class="annot"><span class="annottext">BiMultimap Referent Name
</span><a href="#local-6989586621679191649"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span id="local-6989586621679191650"><span class="annot"><span class="annottext">Set TermReferenceId
</span><a href="#local-6989586621679191650"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; NESet Name -&gt; Set Name)
-&gt; Map Referent (NESet Name) -&gt; Set Name
forall m k a. Monoid m =&gt; (k -&gt; a -&gt; m) -&gt; Map k a -&gt; m
</span><span class="hs-identifier hs-var">Map.foldMapWithKey</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set TermReferenceId -&gt; Referent -&gt; NESet Name -&gt; Set Name
</span><a href="#local-6989586621679191634"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Set TermReferenceId
</span><a href="#local-6989586621679191650"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BiMultimap Referent Name -&gt; Map Referent (NESet Name)
forall a b. BiMultimap a b -&gt; Map a (NESet b)
</span><span class="hs-identifier hs-var">BiMultimap.domain</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap Referent Name
</span><a href="#local-6989586621679191649"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>                  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679191653"><span class="annot"><span class="annottext">BiMultimap TypeReference Name
</span><a href="#local-6989586621679191653"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span id="local-6989586621679191654"><span class="annot"><span class="annottext">Set TermReferenceId
</span><a href="#local-6989586621679191654"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TypeReference -&gt; NESet Name -&gt; Set Name)
-&gt; Map TypeReference (NESet Name) -&gt; Set Name
forall m k a. Monoid m =&gt; (k -&gt; a -&gt; m) -&gt; Map k a -&gt; m
</span><span class="hs-identifier hs-var">Map.foldMapWithKey</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set TermReferenceId -&gt; TypeReference -&gt; NESet Name -&gt; Set Name
</span><a href="#local-6989586621679191643"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Set TermReferenceId
</span><a href="#local-6989586621679191654"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BiMultimap TypeReference Name -&gt; Map TypeReference (NESet Name)
forall a b. BiMultimap a b -&gt; Map a (NESet b)
</span><span class="hs-identifier hs-var">BiMultimap.domain</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap TypeReference Name
</span><a href="#local-6989586621679191653"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>                  </span><span class="annot"><span class="annottext">(Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
 -&gt; DefnsF Set TermReferenceId TermReferenceId
 -&gt; DefnsF Set Name Name)
-&gt; TwoWay
     (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
-&gt; TwoWay
     (DefnsF Set TermReferenceId TermReferenceId
      -&gt; DefnsF Set Name Name)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
-&gt; TwoWay
     (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
forall a. ThreeWay a -&gt; TwoWay a
</span><a href="Unison.Merge.ThreeWay.html#forgetLca"><span class="hs-identifier hs-var">ThreeWay.forgetLca</span></a></span><span> </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679191624"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">defns</span><span>
</span><span id="line-92"></span><span>                  </span><span class="annot"><span class="annottext">TwoWay
  (DefnsF Set TermReferenceId TermReferenceId
   -&gt; DefnsF Set Name Name)
-&gt; TwoWay (DefnsF Set TermReferenceId TermReferenceId)
-&gt; TwoWay (DefnsF Set Name Name)
forall a b. TwoWay (a -&gt; b) -&gt; TwoWay a -&gt; TwoWay b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set TermReferenceId TermReferenceId)
</span><a href="#local-6989586621679191625"><span class="hs-identifier hs-var">dependents0</span></a></span><span>
</span><span id="line-93"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679191656"><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679191656"><span class="hs-identifier hs-var">renderedConflicts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679191657"><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679191657"><span class="hs-identifier hs-var">renderedDependents</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-96"></span><span>        </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
-&gt; TwoWay
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; TwoWay Names
-&gt; Names
-&gt; (TwoWay
      (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)),
    TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)))
</span><a href="Unison.Merge.Mergeblob3.html#renderConflictsAndDependents"><span class="hs-identifier hs-var">renderConflictsAndDependents</span></a></span><span>
</span><span id="line-97"></span><span>          </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679191624"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">declNameLookups</span><span>
</span><span id="line-98"></span><span>          </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679191624"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">hydratedDefns</span><span>
</span><span id="line-99"></span><span>          </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191628"><span class="hs-identifier hs-var">conflictsNames</span></a></span><span>
</span><span id="line-100"></span><span>          </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191632"><span class="hs-identifier hs-var">dependents</span></a></span><span>
</span><span id="line-101"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
-&gt; Names
</span><a href="Unison.Merge.Mergeblob3.html#defnsToNames"><span class="hs-identifier hs-var">defnsToNames</span></a></span><span> </span><span class="annot"><span class="annottext">(Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
 -&gt; Names)
-&gt; TwoWay
     (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
-&gt; TwoWay Names
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
-&gt; TwoWay
     (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
forall a. ThreeWay a -&gt; TwoWay a
</span><a href="Unison.Merge.ThreeWay.html#forgetLca"><span class="hs-identifier hs-var">ThreeWay.forgetLca</span></a></span><span> </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679191624"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">defns</span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>          </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679191626"><span class="hs-identifier hs-var">libdeps</span></a></span><span>
</span><span id="line-103"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#Mergeblob3"><span class="hs-identifier hs-type">Mergeblob3</span></a></span><span>
</span><span id="line-104"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Names
$sel:libdeps:Mergeblob3 :: Names
libdeps :: Names
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3Alibdeps%3AMergeblob3"><span class="hs-identifier hs-var hs-var">libdeps</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>          </span><span class="annot"><span class="annottext">$sel:stageOne:Mergeblob3 :: DefnsF (Map Name) Referent TypeReference
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3AstageOne%3AMergeblob3"><span class="hs-identifier hs-var">stageOne</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-106"></span><span>            </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; DefnsF Unconflicts Referent TypeReference
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; DefnsF (Map Name) Referent TypeReference
-&gt; DefnsF (Map Name) Referent TypeReference
forall term typ.
TwoWay DeclNameLookup
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; DefnsF Unconflicts term typ
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; DefnsF (Map Name) term typ
-&gt; DefnsF (Map Name) term typ
</span><a href="Unison.Merge.Mergeblob3.html#makeStageOne"><span class="hs-identifier hs-var">makeStageOne</span></a></span><span>
</span><span id="line-107"></span><span>              </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679191624"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">declNameLookups</span><span>
</span><span id="line-108"></span><span>              </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191628"><span class="hs-identifier hs-var">conflictsNames</span></a></span><span>
</span><span id="line-109"></span><span>              </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679191624"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">unconflicts</span><span>
</span><span id="line-110"></span><span>              </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191632"><span class="hs-identifier hs-var">dependents</span></a></span><span>
</span><span id="line-111"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BiMultimap Referent Name -&gt; Map Name Referent)
-&gt; (BiMultimap TypeReference Name -&gt; Map Name TypeReference)
-&gt; Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
-&gt; DefnsF (Map Name) Referent TypeReference
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; Defns a c -&gt; Defns b d
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap Referent Name -&gt; Map Name Referent
forall a b. BiMultimap a b -&gt; Map b a
</span><span class="hs-identifier hs-var">BiMultimap.range</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap TypeReference Name -&gt; Map Name TypeReference
forall a b. BiMultimap a b -&gt; Map b a
</span><span class="hs-identifier hs-var">BiMultimap.range</span></span><span> </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679191624"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">defns</span><span class="hs-operator">.</span><span class="hs-identifier">lca</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>          </span><span class="annot"><span class="annottext">$sel:uniqueTypeGuids:Mergeblob3 :: Map Name Text
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3AuniqueTypeGuids%3AMergeblob3"><span class="hs-identifier hs-var">uniqueTypeGuids</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TwoWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
-&gt; Map Name Text
</span><a href="Unison.Merge.Mergeblob3.html#makeUniqueTypeGuids"><span class="hs-identifier hs-var">makeUniqueTypeGuids</span></a></span><span> </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679191624"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">hydratedDefns</span><span class="hs-special">,</span><span>
</span><span id="line-113"></span><span>          </span><span class="annot"><span class="annottext">$sel:stageTwo:Mergeblob3 :: DefnsF (Map Name) Referent TypeReference
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3AstageTwo%3AMergeblob3"><span class="hs-identifier hs-var">stageTwo</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-114"></span><span>            </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; DefnsF Unconflicts Referent TypeReference
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; ThreeWay (DefnsF (Map Name) Referent TypeReference)
-&gt; DefnsF (Map Name) Referent TypeReference
forall term typ.
TwoWay DeclNameLookup
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; DefnsF Unconflicts term typ
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; ThreeWay (DefnsF (Map Name) term typ)
-&gt; DefnsF (Map Name) term typ
</span><a href="Unison.Merge.Mergeblob3.html#makeStageTwo"><span class="hs-identifier hs-var">makeStageTwo</span></a></span><span>
</span><span id="line-115"></span><span>              </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679191624"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">declNameLookups</span><span>
</span><span id="line-116"></span><span>              </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191628"><span class="hs-identifier hs-var">conflictsNames</span></a></span><span>
</span><span id="line-117"></span><span>              </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679191624"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">unconflicts</span><span>
</span><span id="line-118"></span><span>              </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191632"><span class="hs-identifier hs-var">dependents</span></a></span><span>
</span><span id="line-119"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BiMultimap Referent Name -&gt; Map Name Referent)
-&gt; (BiMultimap TypeReference Name -&gt; Map Name TypeReference)
-&gt; Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
-&gt; DefnsF (Map Name) Referent TypeReference
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; Defns a c -&gt; Defns b d
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap Referent Name -&gt; Map Name Referent
forall a b. BiMultimap a b -&gt; Map b a
</span><span class="hs-identifier hs-var">BiMultimap.range</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap TypeReference Name -&gt; Map Name TypeReference
forall a b. BiMultimap a b -&gt; Map b a
</span><span class="hs-identifier hs-var">BiMultimap.range</span></span><span> </span><span class="annot"><span class="annottext">(Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
 -&gt; DefnsF (Map Name) Referent TypeReference)
-&gt; ThreeWay
     (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
-&gt; ThreeWay (DefnsF (Map Name) Referent TypeReference)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679191624"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">defns</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-120"></span><span>          </span><span class="annot"><span class="annottext">$sel:unparsedFile:Mergeblob3 :: Pretty ColorText
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3AunparsedFile%3AMergeblob3"><span class="hs-identifier hs-var">unparsedFile</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TwoWay Text
-&gt; TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; Pretty ColorText
</span><a href="Unison.Merge.Mergeblob3.html#makePrettyUnisonFile"><span class="hs-identifier hs-var">makePrettyUnisonFile</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay Text
</span><a href="#local-6989586621679191627"><span class="hs-identifier hs-var">authors</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679191656"><span class="hs-identifier hs-var">renderedConflicts</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679191657"><span class="hs-identifier hs-var">renderedDependents</span></a></span><span>
</span><span id="line-121"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span id="local-6989586621679191269"><span class="annot"><a href="Unison.Merge.Mergeblob3.html#filterDependents"><span class="hs-identifier hs-type">filterDependents</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679191269"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679191269"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191269"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679191269"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191269"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679191269"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191269"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679191269"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191269"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-129"></span><span id="filterDependents"><span class="annot"><span class="annottext">filterDependents :: forall name.
Ord name =&gt;
TwoWay (DefnsF Set name name)
-&gt; TwoWay (DefnsF Set name name)
-&gt; TwoWay (DefnsF Set name name)
-&gt; TwoWay (DefnsF Set name name)
</span><a href="Unison.Merge.Mergeblob3.html#filterDependents"><span class="hs-identifier hs-var hs-var">filterDependents</span></a></span></span><span> </span><span id="local-6989586621679191702"><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679191702"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span id="local-6989586621679191703"><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679191703"><span class="hs-identifier hs-var">soloUpdatesAndDeletes</span></a></span></span><span> </span><span id="local-6989586621679191704"><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679191704"><span class="hs-identifier hs-var">dependents0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-comment">-- There is some subset of Alice's dependents (and ditto for Bob of course) that we don't ultimately want/need to put</span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-comment">-- into the scratch file: those for which any of the following are true:</span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-comment">--   1. It is Alice-conflicted (since we only want to return *unconflicted* things).</span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-comment">--   2. It was deleted by Bob.</span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-comment">--   3. It was updated by Bob and not updated by Alice.</span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191705"><span class="annot"><span class="annottext">dependents1 :: TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679191705"><span class="hs-identifier hs-var hs-var">dependents1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-137"></span><span>        </span><span class="annot"><span class="annottext">(Set name -&gt; Set name -&gt; Set name)
-&gt; (Set name -&gt; Set name -&gt; Set name)
-&gt; Defns (Set name) (Set name)
-&gt; Defns (Set name) (Set name)
-&gt; Defns (Set name) (Set name)
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">Set name -&gt; Set name -&gt; Set name
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.difference</span></span><span> </span><span class="annot"><span class="annottext">Set name -&gt; Set name -&gt; Set name
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.difference</span></span><span>
</span><span id="line-138"></span><span>          </span><span class="annot"><span class="annottext">(Defns (Set name) (Set name)
 -&gt; Defns (Set name) (Set name) -&gt; Defns (Set name) (Set name))
-&gt; TwoWay (Defns (Set name) (Set name))
-&gt; TwoWay
     (Defns (Set name) (Set name) -&gt; Defns (Set name) (Set name))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679191704"><span class="hs-identifier hs-var">dependents0</span></a></span><span>
</span><span id="line-139"></span><span>          </span><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name) -&gt; Defns (Set name) (Set name))
-&gt; TwoWay (Defns (Set name) (Set name))
-&gt; TwoWay (Defns (Set name) (Set name))
forall a b. TwoWay (a -&gt; b) -&gt; TwoWay a -&gt; TwoWay b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679191702"><span class="hs-identifier hs-var">conflicts</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
-&gt; TwoWay (Defns (Set name) (Set name))
-&gt; TwoWay (Defns (Set name) (Set name))
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
-&gt; TwoWay (Defns (Set name) (Set name))
forall a. TwoWay a -&gt; TwoWay a
</span><a href="Unison.Merge.TwoWay.html#swap"><span class="hs-identifier hs-var">TwoWay.swap</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679191703"><span class="hs-identifier hs-var">soloUpdatesAndDeletes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span>      </span><span class="hs-comment">-- Of the remaining dependents, it's still possible that the maps are not disjoint. But whenever the same name key</span><span>
</span><span id="line-142"></span><span>      </span><span class="hs-comment">-- exists in Alice's and Bob's dependents, the value will either be equal (by Unison hash)...</span><span>
</span><span id="line-143"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-144"></span><span>      </span><span class="hs-comment">--   { alice = { terms = {&quot;foo&quot; =&gt; #alice} } }</span><span>
</span><span id="line-145"></span><span>      </span><span class="hs-comment">--   { bob   = { terms = {&quot;foo&quot; =&gt; #alice} } }</span><span>
</span><span id="line-146"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-147"></span><span>      </span><span class="hs-comment">-- ...or synhash-equal (i.e. the term or type received different auto-propagated updates)...</span><span>
</span><span id="line-148"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-149"></span><span>      </span><span class="hs-comment">--   { alice = { terms = {&quot;foo&quot; =&gt; #alice} } }</span><span>
</span><span id="line-150"></span><span>      </span><span class="hs-comment">--   { bob   = { terms = {&quot;foo&quot; =&gt; #bob}   } }</span><span>
</span><span id="line-151"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-152"></span><span>      </span><span class="hs-comment">-- So, we can arbitrarily keep Alice's, because they will render the same.</span><span>
</span><span id="line-153"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-154"></span><span>      </span><span class="hs-comment">--   { alice = { terms = {&quot;foo&quot; =&gt; #alice} } }</span><span>
</span><span id="line-155"></span><span>      </span><span class="hs-comment">--   { bob   = { terms = {}                } }</span><span>
</span><span id="line-156"></span><span>      </span><span id="local-6989586621679191708"><span class="annot"><span class="annottext">dependents2 :: TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679191708"><span class="hs-identifier hs-var hs-var">dependents2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-157"></span><span>        </span><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679191705"><span class="hs-identifier hs-var">dependents1</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
-&gt; (TwoWay (Defns (Set name) (Set name))
    -&gt; TwoWay (Defns (Set name) (Set name)))
-&gt; TwoWay (Defns (Set name) (Set name))
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (TwoWay (Defns (Set name) (Set name)))
  (TwoWay (Defns (Set name) (Set name)))
  (Defns (Set name) (Set name))
  (Defns (Set name) (Set name))
-&gt; (Defns (Set name) (Set name) -&gt; Defns (Set name) (Set name))
-&gt; TwoWay (Defns (Set name) (Set name))
-&gt; TwoWay (Defns (Set name) (Set name))
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (TwoWay (Defns (Set name) (Set name)))
  (TwoWay (Defns (Set name) (Set name)))
  (Defns (Set name) (Set name))
  (Defns (Set name) (Set name))
</span><span class="">#bob</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679191711"><span class="annot"><span class="annottext">Defns (Set name) (Set name)
</span><a href="#local-6989586621679191711"><span class="hs-identifier hs-var">bob</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-158"></span><span>          </span><span class="annot"><span class="annottext">(Set name -&gt; Set name -&gt; Set name)
-&gt; (Set name -&gt; Set name -&gt; Set name)
-&gt; Defns (Set name) (Set name)
-&gt; Defns (Set name) (Set name)
-&gt; Defns (Set name) (Set name)
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">Set name -&gt; Set name -&gt; Set name
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.difference</span></span><span> </span><span class="annot"><span class="annottext">Set name -&gt; Set name -&gt; Set name
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.difference</span></span><span> </span><span class="annot"><span class="annottext">Defns (Set name) (Set name)
</span><a href="#local-6989586621679191711"><span class="hs-identifier hs-var">bob</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679191705"><span class="hs-identifier hs-var">dependents1</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span>
</span><span id="line-159"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679191708"><span class="hs-identifier hs-var">dependents2</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span id="local-6989586621679191289"><span id="local-6989586621679191290"><span class="annot"><a href="Unison.Merge.Mergeblob3.html#makeStageOne"><span class="hs-identifier hs-type">makeStageOne</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-162"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeclNameLookup</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><a href="Unison.Merge.Unconflicts.html#Unconflicts"><span class="hs-identifier hs-type">Unconflicts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191289"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191290"><span class="hs-identifier hs-type">typ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-166"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679191289"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191290"><span class="hs-identifier hs-type">typ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-167"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679191289"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191290"><span class="hs-identifier hs-type">typ</span></a></span></span></span><span>
</span><span id="line-168"></span><span id="makeStageOne"><span class="annot"><span class="annottext">makeStageOne :: forall term typ.
TwoWay DeclNameLookup
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; DefnsF Unconflicts term typ
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; DefnsF (Map Name) term typ
-&gt; DefnsF (Map Name) term typ
</span><a href="Unison.Merge.Mergeblob3.html#makeStageOne"><span class="hs-identifier hs-var hs-var">makeStageOne</span></a></span></span><span> </span><span id="local-6989586621679191720"><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621679191720"><span class="hs-identifier hs-var">declNameLookups</span></a></span></span><span> </span><span id="local-6989586621679191721"><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191721"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span id="local-6989586621679191722"><span class="annot"><span class="annottext">DefnsF Unconflicts term typ
</span><a href="#local-6989586621679191722"><span class="hs-identifier hs-var">unconflicts</span></a></span></span><span> </span><span id="local-6989586621679191723"><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191723"><span class="hs-identifier hs-var">dependents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-169"></span><span>  </span><span class="annot"><span class="annottext">(Unconflicts term -&gt; Set Name -&gt; Map Name term -&gt; Map Name term)
-&gt; (Unconflicts typ -&gt; Set Name -&gt; Map Name typ -&gt; Map Name typ)
-&gt; DefnsF Unconflicts term typ
-&gt; DefnsF Set Name Name
-&gt; Defns (Map Name term) (Map Name typ)
-&gt; Defns (Map Name term) (Map Name typ)
forall tm1 tm2 tm3 tm4 ty1 ty2 ty3 ty4.
(tm1 -&gt; tm2 -&gt; tm3 -&gt; tm4)
-&gt; (ty1 -&gt; ty2 -&gt; ty3 -&gt; ty4)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
-&gt; Defns tm4 ty4
</span><span class="hs-identifier hs-var">zipDefnsWith3</span></span><span> </span><span class="annot"><span class="annottext">Unconflicts term -&gt; Set Name -&gt; Map Name term -&gt; Map Name term
forall v. Unconflicts v -&gt; Set Name -&gt; Map Name v -&gt; Map Name v
</span><a href="Unison.Merge.Mergeblob3.html#makeStageOneV"><span class="hs-identifier hs-var">makeStageOneV</span></a></span><span> </span><span class="annot"><span class="annottext">Unconflicts typ -&gt; Set Name -&gt; Map Name typ -&gt; Map Name typ
forall v. Unconflicts v -&gt; Set Name -&gt; Map Name v -&gt; Map Name v
</span><a href="Unison.Merge.Mergeblob3.html#makeStageOneV"><span class="hs-identifier hs-var">makeStageOneV</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts term typ
</span><a href="#local-6989586621679191722"><span class="hs-identifier hs-var">unconflicts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name) -&gt; DefnsF Set Name Name
</span><a href="#local-6989586621679191725"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191721"><span class="hs-identifier hs-var">conflicts</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF Set Name Name
-&gt; DefnsF Set Name Name -&gt; DefnsF Set Name Name
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name) -&gt; DefnsF Set Name Name
</span><a href="#local-6989586621679191725"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191723"><span class="hs-identifier hs-var">dependents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><a href="#local-6989586621679191725"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-172"></span><span>    </span><span id="local-6989586621679191725"><span class="annot"><span class="annottext">f :: TwoWay (DefnsF Set Name Name) -&gt; DefnsF Set Name Name
</span><a href="#local-6989586621679191725"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679191726"><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191726"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-173"></span><span>      </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name) -&gt; DefnsF Set Name Name
forall m. Monoid m =&gt; TwoWay m -&gt; m
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DeclNameLookup -&gt; DefnsF Set Name Name -&gt; DefnsF Set Name Name
</span><a href="Unison.Merge.Mergeblob3.html#refIdsToNames"><span class="hs-identifier hs-var">refIdsToNames</span></a></span><span> </span><span class="annot"><span class="annottext">(DeclNameLookup -&gt; DefnsF Set Name Name -&gt; DefnsF Set Name Name)
-&gt; TwoWay DeclNameLookup
-&gt; TwoWay (DefnsF Set Name Name -&gt; DefnsF Set Name Name)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621679191720"><span class="hs-identifier hs-var">declNameLookups</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name -&gt; DefnsF Set Name Name)
-&gt; TwoWay (DefnsF Set Name Name) -&gt; TwoWay (DefnsF Set Name Name)
forall a b. TwoWay (a -&gt; b) -&gt; TwoWay a -&gt; TwoWay b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191726"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span id="local-6989586621679191336"><span class="annot"><a href="Unison.Merge.Mergeblob3.html#makeStageOneV"><span class="hs-identifier hs-type">makeStageOneV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.Unconflicts.html#Unconflicts"><span class="hs-identifier hs-type">Unconflicts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191336"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621679191336"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621679191336"><span class="hs-identifier hs-type">v</span></a></span></span><span>
</span><span id="line-176"></span><span id="makeStageOneV"><span class="annot"><span class="annottext">makeStageOneV :: forall v. Unconflicts v -&gt; Set Name -&gt; Map Name v -&gt; Map Name v
</span><a href="Unison.Merge.Mergeblob3.html#makeStageOneV"><span class="hs-identifier hs-var hs-var">makeStageOneV</span></a></span></span><span> </span><span id="local-6989586621679191730"><span class="annot"><span class="annottext">Unconflicts v
</span><a href="#local-6989586621679191730"><span class="hs-identifier hs-var">unconflicts</span></a></span></span><span> </span><span id="local-6989586621679191731"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679191731"><span class="hs-identifier hs-var">namesToDelete</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name v -&gt; Set Name -&gt; Map Name v
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-operator hs-var">`Map.withoutKeys`</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679191731"><span class="hs-identifier hs-var">namesToDelete</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Map Name v -&gt; Map Name v)
-&gt; (Map Name v -&gt; Map Name v) -&gt; Map Name v -&gt; Map Name v
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Unconflicts v -&gt; Map Name v -&gt; Map Name v
forall v. Unconflicts v -&gt; Map Name v -&gt; Map Name v
</span><a href="Unison.Merge.Unconflicts.html#apply"><span class="hs-identifier hs-var">Unconflicts.apply</span></a></span><span> </span><span class="annot"><span class="annottext">Unconflicts v
</span><a href="#local-6989586621679191730"><span class="hs-identifier hs-var">unconflicts</span></a></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#makeStageTwo"><span class="hs-identifier hs-type">makeStageTwo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679191293"><span class="annot"><a href="#local-6989586621679191293"><span class="hs-identifier hs-type">term</span></a></span></span><span> </span><span id="local-6989586621679191294"><span class="annot"><a href="#local-6989586621679191294"><span class="hs-identifier hs-type">typ</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-181"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeclNameLookup</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-183"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><a href="Unison.Merge.Unconflicts.html#Unconflicts"><span class="hs-identifier hs-type">Unconflicts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191293"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191294"><span class="hs-identifier hs-type">typ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-185"></span><span>  </span><span class="annot"><a href="Unison.Merge.ThreeWay.html#ThreeWay"><span class="hs-identifier hs-type">ThreeWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679191293"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191294"><span class="hs-identifier hs-type">typ</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-186"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679191293"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191294"><span class="hs-identifier hs-type">typ</span></a></span><span>
</span><span id="line-187"></span><span id="makeStageTwo"><span class="annot"><span class="annottext">makeStageTwo :: forall term typ.
TwoWay DeclNameLookup
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; DefnsF Unconflicts term typ
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; ThreeWay (DefnsF (Map Name) term typ)
-&gt; DefnsF (Map Name) term typ
</span><a href="Unison.Merge.Mergeblob3.html#makeStageTwo"><span class="hs-identifier hs-var hs-var">makeStageTwo</span></a></span></span><span> </span><span id="local-6989586621679191755"><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621679191755"><span class="hs-identifier hs-var">declNameLookups</span></a></span></span><span> </span><span id="local-6989586621679191756"><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191756"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span id="local-6989586621679191757"><span class="annot"><span class="annottext">DefnsF Unconflicts term typ
</span><a href="#local-6989586621679191757"><span class="hs-identifier hs-var">unconflicts</span></a></span></span><span> </span><span id="local-6989586621679191758"><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191758"><span class="hs-identifier hs-var">dependents</span></a></span></span><span> </span><span id="local-6989586621679191759"><span class="annot"><span class="annottext">ThreeWay (DefnsF (Map Name) term typ)
</span><a href="#local-6989586621679191759"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><span class="annottext">(Map Name term
 -&gt; Map Name term
 -&gt; Unconflicts term
 -&gt; Map Name term
 -&gt; Map Name term)
-&gt; (Map Name typ
    -&gt; Map Name typ -&gt; Unconflicts typ -&gt; Map Name typ -&gt; Map Name typ)
-&gt; DefnsF (Map Name) term typ
-&gt; DefnsF (Map Name) term typ
-&gt; DefnsF Unconflicts term typ
-&gt; DefnsF (Map Name) term typ
-&gt; DefnsF (Map Name) term typ
forall tm1 tm2 tm3 tm4 tm5 ty1 ty2 ty3 ty4 ty5.
(tm1 -&gt; tm2 -&gt; tm3 -&gt; tm4 -&gt; tm5)
-&gt; (ty1 -&gt; ty2 -&gt; ty3 -&gt; ty4 -&gt; ty5)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
-&gt; Defns tm4 ty4
-&gt; Defns tm5 ty5
</span><span class="hs-identifier hs-var">zipDefnsWith4</span></span><span> </span><span class="annot"><span class="annottext">Map Name term
-&gt; Map Name term
-&gt; Unconflicts term
-&gt; Map Name term
-&gt; Map Name term
forall v.
Map Name v
-&gt; Map Name v -&gt; Unconflicts v -&gt; Map Name v -&gt; Map Name v
</span><a href="Unison.Merge.Mergeblob3.html#makeStageTwoV"><span class="hs-identifier hs-var">makeStageTwoV</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name typ
-&gt; Map Name typ -&gt; Unconflicts typ -&gt; Map Name typ -&gt; Map Name typ
forall v.
Map Name v
-&gt; Map Name v -&gt; Unconflicts v -&gt; Map Name v -&gt; Map Name v
</span><a href="Unison.Merge.Mergeblob3.html#makeStageTwoV"><span class="hs-identifier hs-var">makeStageTwoV</span></a></span><span> </span><span class="annot"><span class="annottext">ThreeWay (DefnsF (Map Name) term typ)
</span><a href="#local-6989586621679191759"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">lca</span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) term typ
</span><a href="#local-6989586621679191761"><span class="hs-identifier hs-var">aliceBiasedDependents</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts term typ
</span><a href="#local-6989586621679191757"><span class="hs-identifier hs-var">unconflicts</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) term typ
</span><a href="#local-6989586621679191762"><span class="hs-identifier hs-var">aliceConflicts</span></a></span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><a href="#local-6989586621679191762"><span class="hs-identifier hs-type">aliceConflicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679191293"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191294"><span class="hs-identifier hs-type">typ</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span id="local-6989586621679191762"><span class="annot"><span class="annottext">aliceConflicts :: DefnsF (Map Name) term typ
</span><a href="#local-6989586621679191762"><span class="hs-identifier hs-var hs-var">aliceConflicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-192"></span><span>      </span><span class="annot"><span class="annottext">(Map Name term -&gt; Set Name -&gt; Map Name term)
-&gt; (Map Name typ -&gt; Set Name -&gt; Map Name typ)
-&gt; DefnsF (Map Name) term typ
-&gt; DefnsF Set Name Name
-&gt; DefnsF (Map Name) term typ
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span>
</span><span id="line-193"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679191763"><span class="annot"><span class="annottext">Map Name term
</span><a href="#local-6989586621679191763"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span id="local-6989586621679191764"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679191764"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Name term -&gt; Set Name -&gt; Map Name term
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="annot"><span class="annottext">Map Name term
</span><a href="#local-6989586621679191763"><span class="hs-identifier hs-var">defns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679191764"><span class="hs-identifier hs-var">conflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; Set Name -&gt; Set Name
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679191766"><span class="hs-identifier hs-var">aliceConstructorsOfTypeConflicts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>        </span><span class="annot"><span class="annottext">Map Name typ -&gt; Set Name -&gt; Map Name typ
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span>
</span><span id="line-195"></span><span>        </span><span class="annot"><span class="annottext">ThreeWay (DefnsF (Map Name) term typ)
</span><a href="#local-6989586621679191759"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span>
</span><span id="line-196"></span><span>        </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191756"><span class="hs-identifier hs-var">conflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><a href="#local-6989586621679191766"><span class="hs-identifier hs-type">aliceConstructorsOfTypeConflicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-199"></span><span>    </span><span id="local-6989586621679191766"><span class="annot"><span class="annottext">aliceConstructorsOfTypeConflicts :: Set Name
</span><a href="#local-6989586621679191766"><span class="hs-identifier hs-var hs-var">aliceConstructorsOfTypeConflicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-200"></span><span>      </span><span class="annot"><span class="annottext">(Name -&gt; Set Name) -&gt; Set Name -&gt; Set Name
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Set a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span>
</span><span id="line-201"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; Set Name
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; Set Name) -&gt; (Name -&gt; [Name]) -&gt; Name -&gt; Set Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; DeclNameLookup -&gt; Name -&gt; [Name]
DeclNameLookup -&gt; Name -&gt; [Name]
</span><span class="hs-identifier hs-var">DeclNameLookup.expectConstructorNames</span></span><span> </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621679191755"><span class="hs-identifier hs-var">declNameLookups</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>        </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191756"><span class="hs-identifier hs-var">conflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><a href="#local-6989586621679191761"><span class="hs-identifier hs-type">aliceBiasedDependents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679191293"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191294"><span class="hs-identifier hs-type">typ</span></a></span><span>
</span><span id="line-205"></span><span>    </span><span id="local-6989586621679191761"><span class="annot"><span class="annottext">aliceBiasedDependents :: DefnsF (Map Name) term typ
</span><a href="#local-6989586621679191761"><span class="hs-identifier hs-var hs-var">aliceBiasedDependents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-206"></span><span>      </span><span class="annot"><span class="annottext">(DefnsF (Map Name) term typ
 -&gt; DefnsF (Map Name) term typ -&gt; DefnsF (Map Name) term typ)
-&gt; TwoWay (DefnsF (Map Name) term typ)
-&gt; DefnsF (Map Name) term typ
forall a b. (a -&gt; a -&gt; b) -&gt; TwoWay a -&gt; b
</span><a href="Unison.Merge.TwoWay.html#twoWay"><span class="hs-identifier hs-var">TwoWay.twoWay</span></a></span><span>
</span><span id="line-207"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map Name term -&gt; Map Name term -&gt; Map Name term)
-&gt; (Map Name typ -&gt; Map Name typ -&gt; Map Name typ)
-&gt; DefnsF (Map Name) term typ
-&gt; DefnsF (Map Name) term typ
-&gt; DefnsF (Map Name) term typ
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(term -&gt; term -&gt; term)
-&gt; Map Name term -&gt; Map Name term -&gt; Map Name term
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.unionWith</span></span><span> </span><span class="annot"><span class="annottext">term -&gt; term -&gt; term
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(typ -&gt; typ -&gt; typ) -&gt; Map Name typ -&gt; Map Name typ -&gt; Map Name typ
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.unionWith</span></span><span> </span><span class="annot"><span class="annottext">typ -&gt; typ -&gt; typ
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map Name term -&gt; Set Name -&gt; Map Name term)
-&gt; (Map Name typ -&gt; Set Name -&gt; Map Name typ)
-&gt; DefnsF (Map Name) term typ
-&gt; DefnsF Set Name Name
-&gt; DefnsF (Map Name) term typ
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">Map Name term -&gt; Set Name -&gt; Map Name term
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="annot"><span class="annottext">Map Name typ -&gt; Set Name -&gt; Map Name typ
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="annot"><span class="annottext">(DefnsF (Map Name) term typ
 -&gt; DefnsF Set Name Name -&gt; DefnsF (Map Name) term typ)
-&gt; TwoWay (DefnsF (Map Name) term typ)
-&gt; TwoWay (DefnsF Set Name Name -&gt; DefnsF (Map Name) term typ)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ThreeWay (DefnsF (Map Name) term typ)
-&gt; TwoWay (DefnsF (Map Name) term typ)
forall a. ThreeWay a -&gt; TwoWay a
</span><a href="Unison.Merge.ThreeWay.html#forgetLca"><span class="hs-identifier hs-var">ThreeWay.forgetLca</span></a></span><span> </span><span class="annot"><span class="annottext">ThreeWay (DefnsF (Map Name) term typ)
</span><a href="#local-6989586621679191759"><span class="hs-identifier hs-var">defns</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name -&gt; DefnsF (Map Name) term typ)
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; TwoWay (DefnsF (Map Name) term typ)
forall a b. TwoWay (a -&gt; b) -&gt; TwoWay a -&gt; TwoWay b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191758"><span class="hs-identifier hs-var">dependents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span id="local-6989586621679191358"><span class="annot"><a href="Unison.Merge.Mergeblob3.html#makeStageTwoV"><span class="hs-identifier hs-type">makeStageTwoV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621679191358"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621679191358"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Merge.Unconflicts.html#Unconflicts"><span class="hs-identifier hs-type">Unconflicts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191358"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621679191358"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621679191358"><span class="hs-identifier hs-type">v</span></a></span></span><span>
</span><span id="line-211"></span><span id="makeStageTwoV"><span class="annot"><span class="annottext">makeStageTwoV :: forall v.
Map Name v
-&gt; Map Name v -&gt; Unconflicts v -&gt; Map Name v -&gt; Map Name v
</span><a href="Unison.Merge.Mergeblob3.html#makeStageTwoV"><span class="hs-identifier hs-var hs-var">makeStageTwoV</span></a></span></span><span> </span><span id="local-6989586621679191774"><span class="annot"><span class="annottext">Map Name v
</span><a href="#local-6989586621679191774"><span class="hs-identifier hs-var">lca</span></a></span></span><span> </span><span id="local-6989586621679191775"><span class="annot"><span class="annottext">Map Name v
</span><a href="#local-6989586621679191775"><span class="hs-identifier hs-var">dependents</span></a></span></span><span> </span><span id="local-6989586621679191776"><span class="annot"><span class="annottext">Unconflicts v
</span><a href="#local-6989586621679191776"><span class="hs-identifier hs-var">unconflicts</span></a></span></span><span> </span><span id="local-6989586621679191777"><span class="annot"><span class="annottext">Map Name v
</span><a href="#local-6989586621679191777"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-212"></span><span>  </span><span class="annot"><span class="annottext">(v -&gt; v -&gt; v) -&gt; Map Name v -&gt; Map Name v -&gt; Map Name v
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.unionWith</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; v -&gt; v
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Map Name v
</span><a href="#local-6989586621679191777"><span class="hs-identifier hs-var">conflicts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unconflicts v -&gt; Map Name v -&gt; Map Name v
forall v. Unconflicts v -&gt; Map Name v -&gt; Map Name v
</span><a href="Unison.Merge.Unconflicts.html#apply"><span class="hs-identifier hs-var">Unconflicts.apply</span></a></span><span> </span><span class="annot"><span class="annottext">Unconflicts v
</span><a href="#local-6989586621679191776"><span class="hs-identifier hs-var">unconflicts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(v -&gt; v -&gt; v) -&gt; Map Name v -&gt; Map Name v -&gt; Map Name v
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.unionWith</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; v -&gt; v
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Map Name v
</span><a href="#local-6989586621679191775"><span class="hs-identifier hs-var">dependents</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name v
</span><a href="#local-6989586621679191774"><span class="hs-identifier hs-var">lca</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="hs-comment">-- Given just named term/type reference ids, fill out all names that occupy the term and type namespaces. This is simply</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- the given names plus all of the types' constructors.</span><span>
</span><span id="line-216"></span><span class="hs-comment">--</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- For example, if the input is</span><span>
</span><span id="line-218"></span><span class="hs-comment">--</span><span>
</span><span id="line-219"></span><span class="hs-comment">--   declNameLookup = {</span><span>
</span><span id="line-220"></span><span class="hs-comment">--     &quot;Maybe&quot; =&gt; [&quot;Maybe.Nothing&quot;, &quot;Maybe.Just&quot;]</span><span>
</span><span id="line-221"></span><span class="hs-comment">--   }</span><span>
</span><span id="line-222"></span><span class="hs-comment">--   defns = {</span><span>
</span><span id="line-223"></span><span class="hs-comment">--     terms = { &quot;foo&quot; =&gt; #foo }</span><span>
</span><span id="line-224"></span><span class="hs-comment">--     types = { &quot;Maybe&quot; =&gt; #Maybe }</span><span>
</span><span id="line-225"></span><span class="hs-comment">--   }</span><span>
</span><span id="line-226"></span><span class="hs-comment">--</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- then the output is</span><span>
</span><span id="line-228"></span><span class="hs-comment">--</span><span>
</span><span id="line-229"></span><span class="hs-comment">--   defns = {</span><span>
</span><span id="line-230"></span><span class="hs-comment">--     terms = { &quot;foo&quot;, &quot;Maybe.Nothing&quot;, &quot;Maybe.Just&quot; }</span><span>
</span><span id="line-231"></span><span class="hs-comment">--     types = { &quot;Maybe&quot; }</span><span>
</span><span id="line-232"></span><span class="hs-comment">--   }</span><span>
</span><span id="line-233"></span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#refIdsToNames"><span class="hs-identifier hs-type">refIdsToNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeclNameLookup</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-234"></span><span id="refIdsToNames"><span class="annot"><span class="annottext">refIdsToNames :: DeclNameLookup -&gt; DefnsF Set Name Name -&gt; DefnsF Set Name Name
</span><a href="Unison.Merge.Mergeblob3.html#refIdsToNames"><span class="hs-identifier hs-var hs-var">refIdsToNames</span></a></span></span><span> </span><span id="local-6989586621679191778"><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621679191778"><span class="hs-identifier hs-var">declNameLookup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-235"></span><span>  </span><span class="annot"><span class="annottext">(Set Name -&gt; DefnsF Set Name Name)
-&gt; (Set Name -&gt; DefnsF Set Name Name)
-&gt; DefnsF Set Name Name
-&gt; DefnsF Set Name Name
forall m a b. Monoid m =&gt; (a -&gt; m) -&gt; (b -&gt; m) -&gt; Defns a b -&gt; m
forall (p :: * -&gt; * -&gt; *) m a b.
(Bifoldable p, Monoid m) =&gt;
(a -&gt; m) -&gt; (b -&gt; m) -&gt; p a b -&gt; m
</span><span class="hs-identifier hs-var">bifoldMap</span></span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; DefnsF Set Name Name
</span><a href="#local-6989586621679191779"><span class="hs-identifier hs-var">goTerms</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; DefnsF Set Name Name
</span><a href="#local-6989586621679191780"><span class="hs-identifier hs-var">goTypes</span></a></span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-237"></span><span>    </span><span class="annot"><a href="#local-6989586621679191779"><span class="hs-identifier hs-type">goTerms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-238"></span><span>    </span><span id="local-6989586621679191779"><span class="annot"><span class="annottext">goTerms :: Set Name -&gt; DefnsF Set Name Name
</span><a href="#local-6989586621679191779"><span class="hs-identifier hs-var hs-var">goTerms</span></a></span></span><span> </span><span id="local-6989586621679191781"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679191781"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-239"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Set Name
terms :: Set Name
$sel:terms:Defns :: Set Name
</span><a href="#local-6989586621679191781"><span class="hs-identifier hs-var hs-var">terms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:types:Defns :: Set Name
</span><span class="hs-identifier hs-var">types</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Name
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">}</span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span>    </span><span class="annot"><a href="#local-6989586621679191780"><span class="hs-identifier hs-type">goTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-242"></span><span>    </span><span id="local-6989586621679191780"><span class="annot"><span class="annottext">goTypes :: Set Name -&gt; DefnsF Set Name Name
</span><a href="#local-6989586621679191780"><span class="hs-identifier hs-var hs-var">goTypes</span></a></span></span><span> </span><span id="local-6989586621679191785"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679191785"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-243"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span>
</span><span id="line-244"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:terms:Defns :: Set Name
</span><span class="hs-identifier hs-var">terms</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Set Name) -&gt; Set Name -&gt; Set Name
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Set a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; Set Name
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; Set Name) -&gt; (Name -&gt; [Name]) -&gt; Name -&gt; Set Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; DeclNameLookup -&gt; Name -&gt; [Name]
DeclNameLookup -&gt; Name -&gt; [Name]
</span><span class="hs-identifier hs-var">expectConstructorNames</span></span><span> </span><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621679191778"><span class="hs-identifier hs-var">declNameLookup</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679191785"><span class="hs-identifier hs-var">types</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-245"></span><span>          </span><span class="annot"><span class="annottext">Set Name
$sel:types:Defns :: Set Name
types :: Set Name
</span><span class="hs-identifier hs-var hs-var">types</span></span><span>
</span><span id="line-246"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#renderConflictsAndDependents"><span class="hs-identifier hs-type">renderConflictsAndDependents</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-249"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeclNameLookup</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-250"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-251"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-252"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-253"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-254"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span id="renderConflictsAndDependents"><span class="annot"><span class="annottext">renderConflictsAndDependents :: TwoWay DeclNameLookup
-&gt; TwoWay
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; TwoWay Names
-&gt; Names
-&gt; (TwoWay
      (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)),
    TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)))
</span><a href="Unison.Merge.Mergeblob3.html#renderConflictsAndDependents"><span class="hs-identifier hs-var hs-var">renderConflictsAndDependents</span></a></span></span><span> </span><span id="local-6989586621679191786"><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621679191786"><span class="hs-identifier hs-var">declNameLookups</span></a></span></span><span> </span><span id="local-6989586621679191787"><span class="annot"><span class="annottext">TwoWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621679191787"><span class="hs-identifier hs-var">hydratedDefns</span></a></span></span><span> </span><span id="local-6989586621679191788"><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191788"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span id="local-6989586621679191789"><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191789"><span class="hs-identifier hs-var">dependents</span></a></span></span><span> </span><span id="local-6989586621679191790"><span class="annot"><span class="annottext">TwoWay Names
</span><a href="#local-6989586621679191790"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span id="local-6989586621679191791"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679191791"><span class="hs-identifier hs-var">libdepsNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-259"></span><span>  </span><span class="annot"><span class="annottext">TwoWay
  (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText),
   DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; (TwoWay
      (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)),
    TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)))
forall a b. TwoWay (a, b) -&gt; (TwoWay a, TwoWay b)
forall (f :: * -&gt; *) a b. Unzip f =&gt; f (a, b) -&gt; (f a, f b)
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">(TwoWay
   (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText),
    DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
 -&gt; (TwoWay
       (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)),
     TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))))
-&gt; TwoWay
     (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText),
      DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; (TwoWay
      (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)),
    TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679191792"><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621679191792"><span class="hs-identifier hs-var">declNameLookup</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679191793"><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679191793"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679191794"><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679191794"><span class="hs-identifier hs-var">dependents</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-261"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191795"><span class="annot"><span class="annottext">render :: DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><a href="#local-6989586621679191795"><span class="hs-identifier hs-var hs-var">render</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeclNameLookup
-&gt; PrettyPrintEnvDecl
-&gt; DefnsF
     (Map Name)
     (Term Symbol Ann, Type Symbol Ann)
     (TermReferenceId, Decl Symbol Ann)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
forall a v.
(Var v, Monoid a) =&gt;
DeclNameLookup
-&gt; PrettyPrintEnvDecl
-&gt; DefnsF
     (Map Name) (Term v a, Type v a) (TermReferenceId, Decl v a)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><span class="hs-identifier hs-var">renderDefnsForUnisonFile</span></span><span> </span><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621679191792"><span class="hs-identifier hs-var">declNameLookup</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679191796"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">(DefnsF
   (Map Name)
   (Term Symbol Ann, Type Symbol Ann)
   (TermReferenceId, Decl Symbol Ann)
 -&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; (DefnsF
      (Map Name)
      (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
      (TermReferenceId, Decl Symbol Ann)
    -&gt; DefnsF
         (Map Name)
         (Term Symbol Ann, Type Symbol Ann)
         (TermReferenceId, Decl Symbol Ann))
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
  (DefnsF
     (Map Name)
     (Term Symbol Ann, Type Symbol Ann)
     (TermReferenceId, Decl Symbol Ann))
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (Term Symbol Ann, Type Symbol Ann)
-&gt; ((TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
    -&gt; (Term Symbol Ann, Type Symbol Ann))
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
-&gt; DefnsF
     (Map Name)
     (Term Symbol Ann, Type Symbol Ann)
     (TermReferenceId, Decl Symbol Ann)
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
 -&gt; Identity (Map Name (Term Symbol Ann, Type Symbol Ann)))
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
-&gt; Identity
     (DefnsF
        (Map Name)
        (Term Symbol Ann, Type Symbol Ann)
        (TermReferenceId, Decl Symbol Ann))
</span><span class="">#terms</span></span><span> </span><span class="annot"><span class="annottext">((Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  -&gt; Identity (Map Name (Term Symbol Ann, Type Symbol Ann)))
 -&gt; DefnsF
      (Map Name)
      (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
      (TermReferenceId, Decl Symbol Ann)
 -&gt; Identity
      (DefnsF
         (Map Name)
         (Term Symbol Ann, Type Symbol Ann)
         (TermReferenceId, Decl Symbol Ann)))
-&gt; (((TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     -&gt; Identity (Term Symbol Ann, Type Symbol Ann))
    -&gt; Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
    -&gt; Identity (Map Name (Term Symbol Ann, Type Symbol Ann)))
-&gt; ASetter
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
     (DefnsF
        (Map Name)
        (Term Symbol Ann, Type Symbol Ann)
        (TermReferenceId, Decl Symbol Ann))
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (Term Symbol Ann, Type Symbol Ann)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
 -&gt; Identity (Term Symbol Ann, Type Symbol Ann))
-&gt; Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
-&gt; Identity (Map Name (Term Symbol Ann, Type Symbol Ann))
Setter
  (Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann)))
  (Map Name (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (Term Symbol Ann, Type Symbol Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; Setter (f a) (f b) a b
</span><span class="hs-identifier hs-var">mapped</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
-&gt; (Term Symbol Ann, Type Symbol Ann)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span>
</span><span id="line-262"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><a href="#local-6989586621679191795"><span class="hs-identifier hs-var">render</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679191793"><span class="hs-identifier hs-var">conflicts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><a href="#local-6989586621679191795"><span class="hs-identifier hs-var">render</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679191794"><span class="hs-identifier hs-var">dependents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>      </span><span class="annot"><span class="annottext">(DeclNameLookup
 -&gt; (DefnsF
       (Map Name)
       (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
       (TermReferenceId, Decl Symbol Ann),
     DefnsF
       (Map Name)
       (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
       (TermReferenceId, Decl Symbol Ann))
 -&gt; (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText),
     DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)))
-&gt; TwoWay DeclNameLookup
-&gt; TwoWay
     ((DefnsF
         (Map Name)
         (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
         (TermReferenceId, Decl Symbol Ann),
       DefnsF
         (Map Name)
         (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
         (TermReferenceId, Decl Symbol Ann))
      -&gt; (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText),
          DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621679191786"><span class="hs-identifier hs-var">declNameLookups</span></a></span><span>
</span><span id="line-265"></span><span>      </span><span class="annot"><span class="annottext">TwoWay
  ((DefnsF
      (Map Name)
      (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
      (TermReferenceId, Decl Symbol Ann),
    DefnsF
      (Map Name)
      (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
      (TermReferenceId, Decl Symbol Ann))
   -&gt; (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText),
       DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)))
-&gt; TwoWay
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann),
      DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
-&gt; TwoWay
     (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText),
      DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
forall a b. TwoWay (a -&gt; b) -&gt; TwoWay a -&gt; TwoWay b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann),
   DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621679191798"><span class="hs-identifier hs-var">hydratedConflictsAndDependents</span></a></span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><a href="#local-6989586621679191798"><span class="hs-identifier hs-type">hydratedConflictsAndDependents</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-268"></span><span>      </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span>
</span><span id="line-269"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-270"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>    </span><span id="local-6989586621679191798"><span class="annot"><span class="annottext">hydratedConflictsAndDependents :: TwoWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann),
   DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621679191798"><span class="hs-identifier hs-var hs-var">hydratedConflictsAndDependents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-273"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679191799"><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679191799"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span id="local-6989586621679191800"><span class="annot"><span class="annottext">DefnsF Set Name Name
</span><a href="#local-6989586621679191800"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621679191801"><span class="annot"><span class="annottext">DefnsF Set Name Name
</span><a href="#local-6989586621679191801"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-274"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
 -&gt; Set Name
 -&gt; Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann)))
-&gt; (Map Name (TermReferenceId, Decl Symbol Ann)
    -&gt; Set Name -&gt; Map Name (TermReferenceId, Decl Symbol Ann))
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
-&gt; DefnsF Set Name Name
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
-&gt; Set Name
-&gt; Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TermReferenceId, Decl Symbol Ann)
-&gt; Set Name -&gt; Map Name (TermReferenceId, Decl Symbol Ann)
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679191799"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF Set Name Name
</span><a href="#local-6989586621679191800"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-275"></span><span>            </span><span class="annot"><span class="annottext">(Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
 -&gt; Set Name
 -&gt; Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann)))
-&gt; (Map Name (TermReferenceId, Decl Symbol Ann)
    -&gt; Set Name -&gt; Map Name (TermReferenceId, Decl Symbol Ann))
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
-&gt; DefnsF Set Name Name
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
-&gt; Set Name
-&gt; Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TermReferenceId, Decl Symbol Ann)
-&gt; Set Name -&gt; Map Name (TermReferenceId, Decl Symbol Ann)
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679191799"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF Set Name Name
</span><a href="#local-6989586621679191801"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-276"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><span class="annottext">(DefnsF
   (Map Name)
   (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
   (TermReferenceId, Decl Symbol Ann)
 -&gt; DefnsF Set Name Name
 -&gt; DefnsF Set Name Name
 -&gt; (DefnsF
       (Map Name)
       (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
       (TermReferenceId, Decl Symbol Ann),
     DefnsF
       (Map Name)
       (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
       (TermReferenceId, Decl Symbol Ann)))
-&gt; TwoWay
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
-&gt; TwoWay
     (DefnsF Set Name Name
      -&gt; DefnsF Set Name Name
      -&gt; (DefnsF
            (Map Name)
            (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
            (TermReferenceId, Decl Symbol Ann),
          DefnsF
            (Map Name)
            (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
            (TermReferenceId, Decl Symbol Ann)))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621679191787"><span class="hs-identifier hs-var">hydratedDefns</span></a></span><span>
</span><span id="line-279"></span><span>        </span><span class="annot"><span class="annottext">TwoWay
  (DefnsF Set Name Name
   -&gt; DefnsF Set Name Name
   -&gt; (DefnsF
         (Map Name)
         (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
         (TermReferenceId, Decl Symbol Ann),
       DefnsF
         (Map Name)
         (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
         (TermReferenceId, Decl Symbol Ann)))
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; TwoWay
     (DefnsF Set Name Name
      -&gt; (DefnsF
            (Map Name)
            (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
            (TermReferenceId, Decl Symbol Ann),
          DefnsF
            (Map Name)
            (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
            (TermReferenceId, Decl Symbol Ann)))
forall a b. TwoWay (a -&gt; b) -&gt; TwoWay a -&gt; TwoWay b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191788"><span class="hs-identifier hs-var">conflicts</span></a></span><span>
</span><span id="line-280"></span><span>        </span><span class="annot"><span class="annottext">TwoWay
  (DefnsF Set Name Name
   -&gt; (DefnsF
         (Map Name)
         (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
         (TermReferenceId, Decl Symbol Ann),
       DefnsF
         (Map Name)
         (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
         (TermReferenceId, Decl Symbol Ann)))
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; TwoWay
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann),
      DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
forall a b. TwoWay (a -&gt; b) -&gt; TwoWay a -&gt; TwoWay b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191789"><span class="hs-identifier hs-var">dependents</span></a></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span>    </span><span class="annot"><a href="#local-6989586621679191796"><span class="hs-identifier hs-type">ppe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PrettyPrintEnvDecl</span></span><span>
</span><span id="line-283"></span><span>    </span><span id="local-6989586621679191796"><span class="annot"><span class="annottext">ppe :: PrettyPrintEnvDecl
</span><a href="#local-6989586621679191796"><span class="hs-identifier hs-var hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-284"></span><span>      </span><span class="annot"><span class="annottext">TwoWay Names -&gt; Names -&gt; PrettyPrintEnvDecl
</span><a href="Unison.Merge.PrettyPrintEnv.html#makePrettyPrintEnv"><span class="hs-identifier hs-var">makePrettyPrintEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay Names
</span><a href="#local-6989586621679191790"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679191791"><span class="hs-identifier hs-var">libdepsNames</span></a></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#defnsToNames"><span class="hs-identifier hs-type">defnsToNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span>
</span><span id="line-287"></span><span id="defnsToNames"><span class="annot"><span class="annottext">defnsToNames :: Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
-&gt; Names
</span><a href="Unison.Merge.Mergeblob3.html#defnsToNames"><span class="hs-identifier hs-var hs-var">defnsToNames</span></a></span></span><span> </span><span id="local-6989586621679191802"><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
</span><a href="#local-6989586621679191802"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-288"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:terms:Names :: Relation Name Referent
</span><span class="hs-identifier hs-var">terms</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Name Referent -&gt; Relation Name Referent
forall a b. (Ord a, Ord b) =&gt; Map a b -&gt; Relation a b
</span><span class="hs-identifier hs-var">Relation.fromMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BiMultimap Referent Name -&gt; Map Name Referent
forall a b. BiMultimap a b -&gt; Map b a
</span><span class="hs-identifier hs-var">BiMultimap.range</span></span><span> </span><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
</span><a href="#local-6989586621679191802"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-290"></span><span>      </span><span class="annot"><span class="annottext">$sel:types:Names :: Relation Name TypeReference
</span><span class="hs-identifier hs-var">types</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Name TypeReference -&gt; Relation Name TypeReference
forall a b. (Ord a, Ord b) =&gt; Map a b -&gt; Relation a b
</span><span class="hs-identifier hs-var">Relation.fromMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BiMultimap TypeReference Name -&gt; Map Name TypeReference
forall a b. BiMultimap a b -&gt; Map b a
</span><span class="hs-identifier hs-var">BiMultimap.range</span></span><span> </span><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
</span><a href="#local-6989586621679191802"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#makePrettyUnisonFile"><span class="hs-identifier hs-type">makePrettyUnisonFile</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-294"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-295"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-296"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-297"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span>
</span><span id="line-298"></span><span id="makePrettyUnisonFile"><span class="annot"><span class="annottext">makePrettyUnisonFile :: TwoWay Text
-&gt; TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; Pretty ColorText
</span><a href="Unison.Merge.Mergeblob3.html#makePrettyUnisonFile"><span class="hs-identifier hs-var hs-var">makePrettyUnisonFile</span></a></span></span><span> </span><span id="local-6989586621679191807"><span class="annot"><span class="annottext">TwoWay Text
</span><a href="#local-6989586621679191807"><span class="hs-identifier hs-var">authors</span></a></span></span><span> </span><span id="local-6989586621679191808"><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679191808"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span id="local-6989586621679191809"><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679191809"><span class="hs-identifier hs-var">dependents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-299"></span><span>  </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall m. Monoid m =&gt; [m] -&gt; m
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span>
</span><span id="line-300"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679191808"><span class="hs-identifier hs-var">conflicts</span></a></span><span>
</span><span id="line-301"></span><span>        </span><span class="hs-comment">-- Merge the two maps together into one, remembering who authored what</span><span>
</span><span id="line-302"></span><span>        </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; (TwoWay
      (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
    -&gt; Defns
         (Map Name (These (Pretty ColorText) (Pretty ColorText)))
         (Map Name (These (Pretty ColorText) (Pretty ColorText))))
-&gt; Defns
     (Map Name (These (Pretty ColorText) (Pretty ColorText)))
     (Map Name (These (Pretty ColorText) (Pretty ColorText)))
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
 -&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
 -&gt; Defns
      (Map Name (These (Pretty ColorText) (Pretty ColorText)))
      (Map Name (These (Pretty ColorText) (Pretty ColorText))))
-&gt; TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; Defns
     (Map Name (These (Pretty ColorText) (Pretty ColorText)))
     (Map Name (These (Pretty ColorText) (Pretty ColorText)))
forall a b. (a -&gt; a -&gt; b) -&gt; TwoWay a -&gt; b
</span><a href="Unison.Merge.TwoWay.html#twoWay"><span class="hs-identifier hs-var">TwoWay.twoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map Name (Pretty ColorText)
 -&gt; Map Name (Pretty ColorText)
 -&gt; Map Name (These (Pretty ColorText) (Pretty ColorText)))
-&gt; (Map Name (Pretty ColorText)
    -&gt; Map Name (Pretty ColorText)
    -&gt; Map Name (These (Pretty ColorText) (Pretty ColorText)))
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
-&gt; Defns
     (Map Name (These (Pretty ColorText) (Pretty ColorText)))
     (Map Name (These (Pretty ColorText) (Pretty ColorText)))
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">Map Name (Pretty ColorText)
-&gt; Map Name (Pretty ColorText)
-&gt; Map Name (These (Pretty ColorText) (Pretty ColorText))
forall a b. Map Name a -&gt; Map Name b -&gt; Map Name (These a b)
forall (f :: * -&gt; *) a b.
Semialign f =&gt;
f a -&gt; f b -&gt; f (These a b)
</span><span class="hs-identifier hs-var">align</span></span><span> </span><span class="annot"><span class="annottext">Map Name (Pretty ColorText)
-&gt; Map Name (Pretty ColorText)
-&gt; Map Name (These (Pretty ColorText) (Pretty ColorText))
forall a b. Map Name a -&gt; Map Name b -&gt; Map Name (These a b)
forall (f :: * -&gt; *) a b.
Semialign f =&gt;
f a -&gt; f b -&gt; f (These a b)
</span><span class="hs-identifier hs-var">align</span></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>        </span><span class="hs-comment">-- Sort alphabetically</span><span>
</span><span id="line-304"></span><span>        </span><span class="annot"><span class="annottext">Defns
  (Map Name (These (Pretty ColorText) (Pretty ColorText)))
  (Map Name (These (Pretty ColorText) (Pretty ColorText)))
-&gt; (Defns
      (Map Name (These (Pretty ColorText) (Pretty ColorText)))
      (Map Name (These (Pretty ColorText) (Pretty ColorText)))
    -&gt; DefnsF
         []
         (These (Pretty ColorText) (Pretty ColorText))
         (These (Pretty ColorText) (Pretty ColorText)))
-&gt; DefnsF
     []
     (These (Pretty ColorText) (Pretty ColorText))
     (These (Pretty ColorText) (Pretty ColorText))
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Defns
  (Map Name (These (Pretty ColorText) (Pretty ColorText)))
  (Map Name (These (Pretty ColorText) (Pretty ColorText)))
-&gt; DefnsF
     []
     (These (Pretty ColorText) (Pretty ColorText))
     (These (Pretty ColorText) (Pretty ColorText))
forall a b. DefnsF (Map Name) a b -&gt; DefnsF [] a b
</span><a href="#local-6989586621679191810"><span class="hs-identifier hs-var">inAlphabeticalOrder</span></a></span><span>
</span><span id="line-305"></span><span>        </span><span class="hs-comment">-- Render each conflict, types then terms (even though a type can conflict with a term, in which case they</span><span>
</span><span id="line-306"></span><span>        </span><span class="hs-comment">-- would not be adjacent in the file), with an author comment above each conflicted thing</span><span>
</span><span id="line-307"></span><span>        </span><span class="annot"><span class="annottext">DefnsF
  []
  (These (Pretty ColorText) (Pretty ColorText))
  (These (Pretty ColorText) (Pretty ColorText))
-&gt; (DefnsF
      []
      (These (Pretty ColorText) (Pretty ColorText))
      (These (Pretty ColorText) (Pretty ColorText))
    -&gt; Pretty ColorText)
-&gt; Pretty ColorText
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191811"><span class="annot"><span class="annottext">f :: [These (Pretty ColorText) (Pretty ColorText)] -&gt; Pretty ColorText
</span><a href="#local-6989586621679191811"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-308"></span><span>                  </span><span class="annot"><span class="annottext">(These (Pretty ColorText) (Pretty ColorText) -&gt; Pretty ColorText)
-&gt; [These (Pretty ColorText) (Pretty ColorText)]
-&gt; Pretty ColorText
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-309"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">This</span></span><span> </span><span id="local-6989586621679191813"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679191813"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><a href="#local-6989586621679191814"><span class="hs-identifier hs-var">alice</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679191813"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-310"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">That</span></span><span> </span><span id="local-6989586621679191816"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679191816"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><a href="#local-6989586621679191817"><span class="hs-identifier hs-var">bob</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679191816"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-311"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">These</span></span><span> </span><span id="local-6989586621679191819"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679191819"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679191820"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679191820"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><a href="#local-6989586621679191814"><span class="hs-identifier hs-var">alice</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679191819"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><a href="#local-6989586621679191817"><span class="hs-identifier hs-var">bob</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679191820"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-312"></span><span>                  </span><span class="hs-keyword">where</span><span>
</span><span id="line-313"></span><span>                    </span><span id="local-6989586621679191814"><span class="annot"><span class="annottext">alice :: Pretty ColorText -&gt; Pretty ColorText
</span><a href="#local-6989586621679191814"><span class="hs-identifier hs-var hs-var">alice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Pretty ColorText) -&gt; Pretty ColorText -&gt; Pretty ColorText
forall {m}. (Monoid m, IsString m) =&gt; Maybe m -&gt; m -&gt; m
</span><a href="#local-6989586621679191821"><span class="hs-identifier hs-var">prettyBinding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Maybe (Pretty ColorText)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Pretty ColorText
forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">Pretty.text</span></span><span> </span><span class="annot"><span class="annottext">TwoWay Text
</span><a href="#local-6989586621679191807"><span class="hs-identifier hs-var">authors</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>                    </span><span id="local-6989586621679191817"><span class="annot"><span class="annottext">bob :: Pretty ColorText -&gt; Pretty ColorText
</span><a href="#local-6989586621679191817"><span class="hs-identifier hs-var hs-var">bob</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Pretty ColorText) -&gt; Pretty ColorText -&gt; Pretty ColorText
forall {m}. (Monoid m, IsString m) =&gt; Maybe m -&gt; m -&gt; m
</span><a href="#local-6989586621679191821"><span class="hs-identifier hs-var">prettyBinding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Maybe (Pretty ColorText)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Pretty ColorText
forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">Pretty.text</span></span><span> </span><span class="annot"><span class="annottext">TwoWay Text
</span><a href="#local-6989586621679191807"><span class="hs-identifier hs-var">authors</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">([These (Pretty ColorText) (Pretty ColorText)] -&gt; Pretty ColorText)
-&gt; ([These (Pretty ColorText) (Pretty ColorText)]
    -&gt; Pretty ColorText)
-&gt; DefnsF
     []
     (These (Pretty ColorText) (Pretty ColorText))
     (These (Pretty ColorText) (Pretty ColorText))
-&gt; Pretty ColorText
forall m a b. Monoid m =&gt; (a -&gt; m) -&gt; (b -&gt; m) -&gt; Defns a b -&gt; m
forall (p :: * -&gt; * -&gt; *) m a b.
(Bifoldable p, Monoid m) =&gt;
(a -&gt; m) -&gt; (b -&gt; m) -&gt; p a b -&gt; m
</span><span class="hs-identifier hs-var">bifoldMap</span></span><span> </span><span class="annot"><span class="annottext">[These (Pretty ColorText) (Pretty ColorText)] -&gt; Pretty ColorText
</span><a href="#local-6989586621679191811"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[These (Pretty ColorText) (Pretty ColorText)] -&gt; Pretty ColorText
</span><a href="#local-6989586621679191811"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-316"></span><span>          </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-317"></span><span>      </span><span class="hs-comment">-- Show message that delineates where conflicts end and dependents begin only when there are both conflicts and</span><span>
</span><span id="line-318"></span><span>      </span><span class="hs-comment">-- dependents</span><span>
</span><span id="line-319"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191828"><span class="annot"><span class="annottext">thereAre :: TwoWay (Defns (f a) (g b)) -&gt; Bool
</span><a href="#local-6989586621679191828"><span class="hs-identifier hs-var hs-var">thereAre</span></a></span></span><span> </span><span id="local-6989586621679191829"><span class="annot"><span class="annottext">TwoWay (Defns (f a) (g b))
</span><a href="#local-6989586621679191829"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TwoWay Bool -&gt; Bool
</span><a href="Unison.Merge.TwoWay.html#or"><span class="hs-identifier hs-var">TwoWay.or</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (Defns (f a) (g b) -&gt; Bool) -&gt; Defns (f a) (g b) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Defns (f a) (g b) -&gt; Bool
forall (f :: * -&gt; *) (g :: * -&gt; *) a b.
(Foldable f, Foldable g) =&gt;
Defns (f a) (g b) -&gt; Bool
</span><span class="hs-identifier hs-var">defnsAreEmpty</span></span><span> </span><span class="annot"><span class="annottext">(Defns (f a) (g b) -&gt; Bool)
-&gt; TwoWay (Defns (f a) (g b)) -&gt; TwoWay Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (f a) (g b))
</span><a href="#local-6989586621679191829"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; Bool
forall {f :: * -&gt; *} {g :: * -&gt; *} {a} {b}.
(Foldable f, Foldable g) =&gt;
TwoWay (Defns (f a) (g b)) -&gt; Bool
</span><a href="#local-6989586621679191828"><span class="hs-identifier hs-var">thereAre</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679191808"><span class="hs-identifier hs-var">conflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; Bool
forall {f :: * -&gt; *} {g :: * -&gt; *} {a} {b}.
(Foldable f, Foldable g) =&gt;
TwoWay (Defns (f a) (g b)) -&gt; Bool
</span><a href="#local-6989586621679191828"><span class="hs-identifier hs-var">thereAre</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679191809"><span class="hs-identifier hs-var">dependents</span></a></span><span>
</span><span id="line-321"></span><span>            </span><span class="hs-keyword">then</span><span>
</span><span id="line-322"></span><span>              </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall m. Monoid m =&gt; [m] -&gt; m
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span>
</span><span id="line-323"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;-- The definitions below are not conflicted, but they each depend on one or more\n&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-324"></span><span>                  </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;-- conflicted definitions above.\n\n&quot;</span></span><span>
</span><span id="line-325"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-326"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span>
</span><span id="line-327"></span><span>      </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679191809"><span class="hs-identifier hs-var">dependents</span></a></span><span>
</span><span id="line-328"></span><span>        </span><span class="hs-comment">-- Merge dependents together into one map (they are disjoint)</span><span>
</span><span id="line-329"></span><span>        </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; (TwoWay
      (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
    -&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
 -&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
 -&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
forall a b. (a -&gt; a -&gt; b) -&gt; TwoWay a -&gt; b
</span><a href="Unison.Merge.TwoWay.html#twoWay"><span class="hs-identifier hs-var">TwoWay.twoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map Name (Pretty ColorText)
 -&gt; Map Name (Pretty ColorText) -&gt; Map Name (Pretty ColorText))
-&gt; (Map Name (Pretty ColorText)
    -&gt; Map Name (Pretty ColorText) -&gt; Map Name (Pretty ColorText))
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">Map Name (Pretty ColorText)
-&gt; Map Name (Pretty ColorText) -&gt; Map Name (Pretty ColorText)
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.union</span></span><span> </span><span class="annot"><span class="annottext">Map Name (Pretty ColorText)
-&gt; Map Name (Pretty ColorText) -&gt; Map Name (Pretty ColorText)
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.union</span></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>        </span><span class="hs-comment">-- Sort alphabetically</span><span>
</span><span id="line-331"></span><span>        </span><span class="annot"><span class="annottext">DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
-&gt; (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
    -&gt; DefnsF [] (Pretty ColorText) (Pretty ColorText))
-&gt; DefnsF [] (Pretty ColorText) (Pretty ColorText)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
-&gt; DefnsF [] (Pretty ColorText) (Pretty ColorText)
forall a b. DefnsF (Map Name) a b -&gt; DefnsF [] a b
</span><a href="#local-6989586621679191810"><span class="hs-identifier hs-var">inAlphabeticalOrder</span></a></span><span>
</span><span id="line-332"></span><span>        </span><span class="hs-comment">-- Render each dependent, types then terms, without bothering to comment attribution</span><span>
</span><span id="line-333"></span><span>        </span><span class="annot"><span class="annottext">DefnsF [] (Pretty ColorText) (Pretty ColorText)
-&gt; (DefnsF [] (Pretty ColorText) (Pretty ColorText)
    -&gt; Pretty ColorText)
-&gt; Pretty ColorText
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191839"><span class="annot"><span class="annottext">f :: [Pretty ColorText] -&gt; Pretty ColorText
</span><a href="#local-6989586621679191839"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Pretty ColorText)
-&gt; [Pretty ColorText] -&gt; Pretty ColorText
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Pretty ColorText) -&gt; Pretty ColorText -&gt; Pretty ColorText
forall {m}. (Monoid m, IsString m) =&gt; Maybe m -&gt; m -&gt; m
</span><a href="#local-6989586621679191821"><span class="hs-identifier hs-var">prettyBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Pretty ColorText)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">([Pretty ColorText] -&gt; Pretty ColorText)
-&gt; ([Pretty ColorText] -&gt; Pretty ColorText)
-&gt; DefnsF [] (Pretty ColorText) (Pretty ColorText)
-&gt; Pretty ColorText
forall m a b. Monoid m =&gt; (a -&gt; m) -&gt; (b -&gt; m) -&gt; Defns a b -&gt; m
forall (p :: * -&gt; * -&gt; *) m a b.
(Bifoldable p, Monoid m) =&gt;
(a -&gt; m) -&gt; (b -&gt; m) -&gt; p a b -&gt; m
</span><span class="hs-identifier hs-var">bifoldMap</span></span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
</span><a href="#local-6989586621679191839"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
</span><a href="#local-6989586621679191839"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-336"></span><span>    </span><span id="local-6989586621679191821"><span class="annot"><span class="annottext">prettyBinding :: Maybe m -&gt; m -&gt; m
</span><a href="#local-6989586621679191821"><span class="hs-identifier hs-var hs-var">prettyBinding</span></a></span></span><span> </span><span id="local-6989586621679191854"><span class="annot"><span class="annottext">Maybe m
</span><a href="#local-6989586621679191854"><span class="hs-identifier hs-var">maybeComment</span></a></span></span><span> </span><span id="local-6989586621679191855"><span class="annot"><span class="annottext">m
</span><a href="#local-6989586621679191855"><span class="hs-identifier hs-var">binding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-337"></span><span>      </span><span class="annot"><span class="annottext">[m] -&gt; m
forall m. Monoid m =&gt; [m] -&gt; m
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span>
</span><span id="line-338"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe m
</span><a href="#local-6989586621679191854"><span class="hs-identifier hs-var">maybeComment</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-339"></span><span>            </span><span class="annot"><span class="annottext">Maybe m
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-340"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679191856"><span class="annot"><span class="annottext">m
</span><a href="#local-6989586621679191856"><span class="hs-identifier hs-var">comment</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m
</span><span class="hs-string">&quot;-- &quot;</span></span><span> </span><span class="annot"><span class="annottext">m -&gt; m -&gt; m
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">m
</span><a href="#local-6989586621679191856"><span class="hs-identifier hs-var">comment</span></a></span><span> </span><span class="annot"><span class="annottext">m -&gt; m -&gt; m
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">m
</span><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-341"></span><span>          </span><span class="annot"><span class="annottext">m
</span><a href="#local-6989586621679191855"><span class="hs-identifier hs-var">binding</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-342"></span><span>          </span><span class="annot"><span class="annottext">m
</span><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-343"></span><span>          </span><span class="annot"><span class="annottext">m
</span><span class="hs-string">&quot;\n&quot;</span></span><span>
</span><span id="line-344"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span>    </span><span id="local-6989586621679191395"><span id="local-6989586621679191396"><span class="annot"><a href="#local-6989586621679191810"><span class="hs-identifier hs-type">inAlphabeticalOrder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679191395"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191396"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679191395"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191396"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-347"></span><span>    </span><span id="local-6989586621679191810"><span class="annot"><span class="annottext">inAlphabeticalOrder :: forall a b. DefnsF (Map Name) a b -&gt; DefnsF [] a b
</span><a href="#local-6989586621679191810"><span class="hs-identifier hs-var hs-var">inAlphabeticalOrder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-348"></span><span>      </span><span class="annot"><span class="annottext">(Map Name a -&gt; [a])
-&gt; (Map Name b -&gt; [b])
-&gt; Defns (Map Name a) (Map Name b)
-&gt; Defns [a] [b]
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; Defns a c -&gt; Defns b d
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">Map Name a -&gt; [a]
forall {b}. Map Name b -&gt; [b]
</span><a href="#local-6989586621679191858"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name b -&gt; [b]
forall {b}. Map Name b -&gt; [b]
</span><a href="#local-6989586621679191858"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-349"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-350"></span><span>        </span><span id="local-6989586621679191858"><span class="annot"><span class="annottext">f :: Map Name b -&gt; [b]
</span><a href="#local-6989586621679191858"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Name, b) -&gt; b) -&gt; [(Name, b)] -&gt; [b]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Name, b) -&gt; b
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(Name, b)] -&gt; [b])
-&gt; (Map Name b -&gt; [(Name, b)]) -&gt; Map Name b -&gt; [b]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Name, b) -&gt; Text) -&gt; [(Name, b)] -&gt; [(Name, b)]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.sortOn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Text) -&gt; ((Name, b) -&gt; Name) -&gt; (Name, b) -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name, b) -&gt; Name
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Name, b)] -&gt; [(Name, b)])
-&gt; (Map Name b -&gt; [(Name, b)]) -&gt; Map Name b -&gt; [(Name, b)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map Name b -&gt; [(Name, b)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span class="hs-comment">-- Given Alice's and Bob's hydrated defns, make a mapping from unique type name to unique type GUID, preferring Alice's</span><span>
</span><span id="line-353"></span><span class="hs-comment">-- GUID if they both have one.</span><span>
</span><span id="line-354"></span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#makeUniqueTypeGuids"><span class="hs-identifier hs-type">makeUniqueTypeGuids</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-355"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span>
</span><span id="line-357"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-361"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-362"></span><span id="makeUniqueTypeGuids"><span class="annot"><span class="annottext">makeUniqueTypeGuids :: TwoWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
-&gt; Map Name Text
</span><a href="Unison.Merge.Mergeblob3.html#makeUniqueTypeGuids"><span class="hs-identifier hs-var hs-var">makeUniqueTypeGuids</span></a></span></span><span> </span><span id="local-6989586621679191864"><span class="annot"><span class="annottext">TwoWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621679191864"><span class="hs-identifier hs-var">hydratedDefns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Start off with just Alice's GUIDs</span><span>
</span><span id="line-364"></span><span>      </span><span class="annot"><a href="#local-6989586621679191865"><span class="hs-identifier hs-type">aliceGuids</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-365"></span><span>      </span><span id="local-6989586621679191865"><span class="annot"><span class="annottext">aliceGuids :: Map Name Text
</span><a href="#local-6989586621679191865"><span class="hs-identifier hs-var hs-var">aliceGuids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-366"></span><span>        </span><span class="annot"><span class="annottext">((TermReferenceId, Decl Symbol Ann) -&gt; Maybe Text)
-&gt; Map Name (TermReferenceId, Decl Symbol Ann) -&gt; Map Name Text
forall a b k. (a -&gt; Maybe b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Decl Symbol Ann -&gt; Maybe Text
forall v a. Decl v a -&gt; Maybe Text
</span><a href="#local-6989586621679191867"><span class="hs-identifier hs-var">declGuid</span></a></span><span> </span><span class="annot"><span class="annottext">(Decl Symbol Ann -&gt; Maybe Text)
-&gt; ((TermReferenceId, Decl Symbol Ann) -&gt; Decl Symbol Ann)
-&gt; (TermReferenceId, Decl Symbol Ann)
-&gt; Maybe Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TermReferenceId, Decl Symbol Ann) -&gt; Decl Symbol Ann
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TwoWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621679191864"><span class="hs-identifier hs-var">hydratedDefns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span>      </span><span class="hs-comment">-- Define a helper that adds a Bob GUID only if it's not already in the map (so, preferring Alice)</span><span>
</span><span id="line-369"></span><span>      </span><span class="annot"><a href="#local-6989586621679191868"><span class="hs-identifier hs-type">addBobGuid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-370"></span><span>      </span><span id="local-6989586621679191868"><span class="annot"><span class="annottext">addBobGuid :: Map Name Text
-&gt; (Name, (TermReferenceId, Decl Symbol Ann)) -&gt; Map Name Text
</span><a href="#local-6989586621679191868"><span class="hs-identifier hs-var hs-var">addBobGuid</span></a></span></span><span> </span><span id="local-6989586621679191869"><span class="annot"><span class="annottext">Map Name Text
</span><a href="#local-6989586621679191869"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679191870"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679191870"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermReferenceId
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679191871"><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679191871"><span class="hs-identifier hs-var">bobDecl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-371"></span><span>        </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Maybe Text)
-&gt; Name -&gt; Map Name Text -&gt; Map Name Text
forall k a.
Ord k =&gt;
(Maybe a -&gt; Maybe a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.alter</span></span><span>
</span><span id="line-372"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-373"></span><span>              </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679191873"><span class="hs-identifier hs-var">bobGuid</span></a></span><span>
</span><span id="line-374"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679191874"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679191874"><span class="hs-identifier hs-var">aliceGuid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679191874"><span class="hs-identifier hs-var">aliceGuid</span></a></span><span>
</span><span id="line-375"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>          </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679191870"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-377"></span><span>          </span><span class="annot"><span class="annottext">Map Name Text
</span><a href="#local-6989586621679191869"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-378"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-379"></span><span>          </span><span class="annot"><a href="#local-6989586621679191873"><span class="hs-identifier hs-type">bobGuid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-380"></span><span>          </span><span id="local-6989586621679191873"><span class="annot"><span class="annottext">bobGuid :: Maybe Text
</span><a href="#local-6989586621679191873"><span class="hs-identifier hs-var hs-var">bobGuid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-381"></span><span>            </span><span class="annot"><span class="annottext">Decl Symbol Ann -&gt; Maybe Text
forall v a. Decl v a -&gt; Maybe Text
</span><a href="#local-6989586621679191867"><span class="hs-identifier hs-var">declGuid</span></a></span><span> </span><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679191871"><span class="hs-identifier hs-var">bobDecl</span></a></span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span>      </span><span class="hs-comment">-- Tumble in all of Bob's GUIDs with that helper</span><span>
</span><span id="line-384"></span><span>      </span><span class="annot"><a href="#local-6989586621679191875"><span class="hs-identifier hs-type">allTheGuids</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-385"></span><span>      </span><span id="local-6989586621679191875"><span class="annot"><span class="annottext">allTheGuids :: Map Name Text
</span><a href="#local-6989586621679191875"><span class="hs-identifier hs-var hs-var">allTheGuids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-386"></span><span>        </span><span class="annot"><span class="annottext">(Map Name Text
 -&gt; (Name, (TermReferenceId, Decl Symbol Ann)) -&gt; Map Name Text)
-&gt; Map Name Text
-&gt; [(Name, (TermReferenceId, Decl Symbol Ann))]
-&gt; Map Name Text
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">List.foldl'</span></span><span> </span><span class="annot"><span class="annottext">Map Name Text
-&gt; (Name, (TermReferenceId, Decl Symbol Ann)) -&gt; Map Name Text
</span><a href="#local-6989586621679191868"><span class="hs-identifier hs-var">addBobGuid</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Text
</span><a href="#local-6989586621679191865"><span class="hs-identifier hs-var">aliceGuids</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name (TermReferenceId, Decl Symbol Ann)
-&gt; [(Name, (TermReferenceId, Decl Symbol Ann))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">TwoWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621679191864"><span class="hs-identifier hs-var">hydratedDefns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Map Name Text
</span><a href="#local-6989586621679191875"><span class="hs-identifier hs-var">allTheGuids</span></a></span><span>
</span><span id="line-388"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-389"></span><span>    </span><span id="local-6989586621679191424"><span id="local-6989586621679191425"><span class="annot"><a href="#local-6989586621679191867"><span class="hs-identifier hs-type">declGuid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decl</span></span><span> </span><span class="annot"><a href="#local-6989586621679191424"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191425"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span></span></span><span>
</span><span id="line-390"></span><span>    </span><span id="local-6989586621679191867"><span class="annot"><span class="annottext">declGuid :: forall v a. Decl v a -&gt; Maybe Text
</span><a href="#local-6989586621679191867"><span class="hs-identifier hs-var hs-var">declGuid</span></a></span></span><span> </span><span id="local-6989586621679191878"><span class="annot"><span class="annottext">Decl v a
</span><a href="#local-6989586621679191878"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-391"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Decl v a -&gt; DataDeclaration v a
forall v a. Decl v a -&gt; DataDeclaration v a
</span><span class="hs-identifier hs-var">DataDeclaration.asDataDecl</span></span><span> </span><span class="annot"><span class="annottext">Decl v a
</span><a href="#local-6989586621679191878"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span class="hs-identifier">modifier</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-392"></span><span>        </span><span class="annot"><span class="annottext">Modifier
</span><span class="hs-identifier hs-var">DataDeclaration.Structural</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-393"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">DataDeclaration.Unique</span></span><span> </span><span id="local-6989586621679191882"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679191882"><span class="hs-identifier hs-var">guid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679191882"><span class="hs-identifier hs-var">guid</span></a></span><span>
</span><span id="line-394"></span></pre></body></html>