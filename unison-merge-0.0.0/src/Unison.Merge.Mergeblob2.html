<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Merge.Mergeblob2</span><span>
</span><span id="line-2"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Merge.Mergeblob2.html#Mergeblob2"><span class="hs-identifier">Mergeblob2</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-3"></span><span>    </span><span class="annot"><a href="Unison.Merge.Mergeblob2.html#Mergeblob2Error"><span class="hs-identifier">Mergeblob2Error</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-4"></span><span>    </span><span class="annot"><a href="Unison.Merge.Mergeblob2.html#makeMergeblob2"><span class="hs-identifier">makeMergeblob2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span class="hs-keyword">where</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ConstructorReference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">GConstructorReference</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DataDeclaration</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Decl</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DeclNameLookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DeclNameLookup</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.EitherWay.html"><span class="hs-identifier">Unison.Merge.EitherWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.EitherWay.html#EitherWay"><span class="hs-identifier">EitherWay</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.FindConflictedAlias.html"><span class="hs-identifier">Unison.Merge.FindConflictedAlias</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.FindConflictedAlias.html#findConflictedAlias"><span class="hs-identifier">findConflictedAlias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.Mergeblob1.html"><span class="hs-identifier">Unison.Merge.Mergeblob1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.Mergeblob1.html#Mergeblob1"><span class="hs-identifier">Mergeblob1</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.PartitionCombinedDiffs.html"><span class="hs-identifier">Unison.Merge.PartitionCombinedDiffs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.PartitionCombinedDiffs.html#narrowConflictsToNonBuiltins"><span class="hs-identifier">narrowConflictsToNonBuiltins</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.ThreeWay.html"><span class="hs-identifier">Unison.Merge.ThreeWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.ThreeWay.html#ThreeWay"><span class="hs-identifier">ThreeWay</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.ThreeWay.html"><span class="hs-identifier">Unison.Merge.ThreeWay</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ThreeWay</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html"><span class="hs-identifier">Unison.Merge.TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html"><span class="hs-identifier">Unison.Merge.TwoWay</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TwoWay</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.Unconflicts.html"><span class="hs-identifier">Unison.Merge.Unconflicts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.Unconflicts.html#Unconflicts"><span class="hs-identifier">Unconflicts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.Unconflicts.html"><span class="hs-identifier">Unison.Merge.Unconflicts</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Unconflicts</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TermReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TypeReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TypeReferenceId</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Reference</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Referent</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Referent</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Term</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Term</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Type</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.BiMultimap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">BiMultimap</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.BiMultimap</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BiMultimap</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Defn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Defn</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Defns</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">DefnsF</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">defnsAreEmpty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipDefnsWith</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">data</span><span> </span><span id="Mergeblob2"><span class="annot"><a href="Unison.Merge.Mergeblob2.html#Mergeblob2"><span class="hs-identifier hs-var">Mergeblob2</span></a></span></span><span> </span><span id="local-6989586621679190847"><span class="annot"><a href="#local-6989586621679190847"><span class="hs-identifier hs-type">libdep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Mergeblob2"><span class="annot"><a href="Unison.Merge.Mergeblob2.html#Mergeblob2"><span class="hs-identifier hs-var">Mergeblob2</span></a></span></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Aconflicts%3AMergeblob2"><span class="annot"><span class="annottext">forall libdep.
Mergeblob2 libdep
-&gt; TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="Unison.Merge.Mergeblob2.html#%24sel%3Aconflicts%3AMergeblob2"><span class="hs-identifier hs-var hs-var">conflicts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span id="%24sel%3AcoreDependencies%3AMergeblob2"><span class="annot"><span class="annottext">forall libdep.
Mergeblob2 libdep
-&gt; TwoWay (DefnsF Set TermReference TermReference)
</span><a href="Unison.Merge.Mergeblob2.html#%24sel%3AcoreDependencies%3AMergeblob2"><span class="hs-identifier hs-var hs-var">coreDependencies</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span id="%24sel%3AdeclNameLookups%3AMergeblob2"><span class="annot"><span class="annottext">forall libdep. Mergeblob2 libdep -&gt; TwoWay DeclNameLookup
</span><a href="Unison.Merge.Mergeblob2.html#%24sel%3AdeclNameLookups%3AMergeblob2"><span class="hs-identifier hs-var hs-var">declNameLookups</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeclNameLookup</span></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>    </span><span id="%24sel%3Adefns%3AMergeblob2"><span class="annot"><span class="annottext">forall libdep.
Mergeblob2 libdep
-&gt; ThreeWay
     (Defns (BiMultimap Referent Name) (BiMultimap TermReference Name))
</span><a href="Unison.Merge.Mergeblob2.html#%24sel%3Adefns%3AMergeblob2"><span class="hs-identifier hs-var hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.ThreeWay.html#ThreeWay"><span class="hs-identifier hs-type">ThreeWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>    </span><span id="%24sel%3AhasConflicts%3AMergeblob2"><span class="annot"><span class="annottext">forall libdep. Mergeblob2 libdep -&gt; Bool
</span><a href="Unison.Merge.Mergeblob2.html#%24sel%3AhasConflicts%3AMergeblob2"><span class="hs-identifier hs-var hs-var">hasConflicts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>    </span><span id="%24sel%3AhydratedDefns%3AMergeblob2"><span class="annot"><span class="annottext">forall libdep.
Mergeblob2 libdep
-&gt; TwoWay
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
</span><a href="Unison.Merge.Mergeblob2.html#%24sel%3AhydratedDefns%3AMergeblob2"><span class="hs-identifier hs-var hs-var">hydratedDefns</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-47"></span><span>      </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span>
</span><span id="line-48"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span>
</span><span id="line-49"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>        </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span id="%24sel%3Alibdeps%3AMergeblob2"><span class="annot"><span class="annottext">forall libdep. Mergeblob2 libdep -&gt; Map NameSegment libdep
</span><a href="Unison.Merge.Mergeblob2.html#%24sel%3Alibdeps%3AMergeblob2"><span class="hs-identifier hs-var hs-var">libdeps</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="annot"><a href="#local-6989586621679190847"><span class="hs-identifier hs-type">libdep</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span id="%24sel%3AsoloUpdatesAndDeletes%3AMergeblob2"><span class="annot"><span class="annottext">forall libdep. Mergeblob2 libdep -&gt; TwoWay (DefnsF Set Name Name)
</span><a href="Unison.Merge.Mergeblob2.html#%24sel%3AsoloUpdatesAndDeletes%3AMergeblob2"><span class="hs-identifier hs-var hs-var">soloUpdatesAndDeletes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span id="%24sel%3Aunconflicts%3AMergeblob2"><span class="annot"><span class="annottext">forall libdep.
Mergeblob2 libdep -&gt; DefnsF Unconflicts Referent TermReference
</span><a href="Unison.Merge.Mergeblob2.html#%24sel%3Aunconflicts%3AMergeblob2"><span class="hs-identifier hs-var hs-var">unconflicts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><a href="Unison.Merge.Unconflicts.html#Unconflicts"><span class="hs-identifier hs-type">Unconflicts</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-keyword">data</span><span> </span><span id="Mergeblob2Error"><span class="annot"><a href="Unison.Merge.Mergeblob2.html#Mergeblob2Error"><span class="hs-identifier hs-var">Mergeblob2Error</span></a></span></span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Mergeblob2Error%27ConflictedAlias"><span class="annot"><a href="Unison.Merge.Mergeblob2.html#Mergeblob2Error%27ConflictedAlias"><span class="hs-identifier hs-var">Mergeblob2Error'ConflictedAlias</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.EitherWay.html#EitherWay"><span class="hs-identifier hs-type">EitherWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Defn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Mergeblob2Error%27ConflictedBuiltin"><span class="annot"><a href="Unison.Merge.Mergeblob2.html#Mergeblob2Error%27ConflictedBuiltin"><span class="hs-identifier hs-var">Mergeblob2Error'ConflictedBuiltin</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Defn</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span id="local-6989586621679190870"><span class="annot"><a href="Unison.Merge.Mergeblob2.html#makeMergeblob2"><span class="hs-identifier hs-type">makeMergeblob2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.Mergeblob1.html#Mergeblob1"><span class="hs-identifier hs-type">Mergeblob1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190870"><span class="hs-identifier hs-type">libdep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Unison.Merge.Mergeblob2.html#Mergeblob2Error"><span class="hs-identifier hs-type">Mergeblob2Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.Mergeblob2.html#Mergeblob2"><span class="hs-identifier hs-type">Mergeblob2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190870"><span class="hs-identifier hs-type">libdep</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-63"></span><span id="makeMergeblob2"><span class="annot"><span class="annottext">makeMergeblob2 :: forall libdep.
Mergeblob1 libdep -&gt; Either Mergeblob2Error (Mergeblob2 libdep)
</span><a href="Unison.Merge.Mergeblob2.html#makeMergeblob2"><span class="hs-identifier hs-var hs-var">makeMergeblob2</span></a></span></span><span> </span><span id="local-6989586621679191051"><span class="annot"><span class="annottext">Mergeblob1 libdep
</span><a href="#local-6989586621679191051"><span class="hs-identifier hs-var">blob</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-comment">-- Bail early if it looks like we can't proceed with the merge, because Alice or Bob has one or more conflicted alias</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><span class="annottext">TwoWay
  (Defn (Name, Name) (Name, Name)
   -&gt; EitherWay (Defn (Name, Name) (Name, Name)),
   DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference)
-&gt; ((Defn (Name, Name) (Name, Name)
     -&gt; EitherWay (Defn (Name, Name) (Name, Name)),
     DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference)
    -&gt; Either Mergeblob2Error ())
-&gt; Either Mergeblob2Error ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Defn (Name, Name) (Name, Name)
  -&gt; EitherWay (Defn (Name, Name) (Name, Name)))
 -&gt; DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference
 -&gt; (Defn (Name, Name) (Name, Name)
     -&gt; EitherWay (Defn (Name, Name) (Name, Name)),
     DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference))
-&gt; TwoWay
     (Defn (Name, Name) (Name, Name)
      -&gt; EitherWay (Defn (Name, Name) (Name, Name)))
-&gt; TwoWay
     (DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference
      -&gt; (Defn (Name, Name) (Name, Name)
          -&gt; EitherWay (Defn (Name, Name) (Name, Name)),
          DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Defn (Name, Name) (Name, Name)
 -&gt; EitherWay (Defn (Name, Name) (Name, Name)))
-&gt; (Defn (Name, Name) (Name, Name)
    -&gt; EitherWay (Defn (Name, Name) (Name, Name)))
-&gt; TwoWay
     (Defn (Name, Name) (Name, Name)
      -&gt; EitherWay (Defn (Name, Name) (Name, Name)))
forall a. a -&gt; a -&gt; TwoWay a
</span><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-var">TwoWay</span></a></span><span> </span><span class="annot"><span class="annottext">Defn (Name, Name) (Name, Name)
-&gt; EitherWay (Defn (Name, Name) (Name, Name))
forall a. a -&gt; EitherWay a
</span><a href="Unison.Merge.EitherWay.html#Alice"><span class="hs-identifier hs-var">Alice</span></a></span><span> </span><span class="annot"><span class="annottext">Defn (Name, Name) (Name, Name)
-&gt; EitherWay (Defn (Name, Name) (Name, Name))
forall a. a -&gt; EitherWay a
</span><a href="Unison.Merge.EitherWay.html#Bob"><span class="hs-identifier hs-var">Bob</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay
  (DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference
   -&gt; (Defn (Name, Name) (Name, Name)
       -&gt; EitherWay (Defn (Name, Name) (Name, Name)),
       DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference))
-&gt; TwoWay
     (DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference)
-&gt; TwoWay
     (Defn (Name, Name) (Name, Name)
      -&gt; EitherWay (Defn (Name, Name) (Name, Name)),
      DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference)
forall a b. TwoWay (a -&gt; b) -&gt; TwoWay a -&gt; TwoWay b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Mergeblob1 libdep
</span><a href="#local-6989586621679191051"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">diffs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679191057"><span class="annot"><span class="annottext">Defn (Name, Name) (Name, Name)
-&gt; EitherWay (Defn (Name, Name) (Name, Name))
</span><a href="#local-6989586621679191057"><span class="hs-identifier hs-var">who</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679191058"><span class="annot"><span class="annottext">DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference
</span><a href="#local-6989586621679191058"><span class="hs-identifier hs-var">diff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Defn (Name, Name) (Name, Name))
-&gt; (Defn (Name, Name) (Name, Name) -&gt; Either Mergeblob2Error ())
-&gt; Either Mergeblob2Error ()
forall (m :: * -&gt; *) a.
Applicative m =&gt;
Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><span class="hs-identifier hs-var">whenJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap TermReference Name)
-&gt; DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference
-&gt; Maybe (Defn (Name, Name) (Name, Name))
forall name (synhashed :: * -&gt; *) term typ.
(Ord name, forall ref. Eq (synhashed ref), Ord term, Ord typ) =&gt;
Defns (BiMultimap term name) (BiMultimap typ name)
-&gt; DefnsF3 (Map name) DiffOp synhashed term typ
-&gt; Maybe (Defn (name, name) (name, name))
</span><a href="Unison.Merge.FindConflictedAlias.html#findConflictedAlias"><span class="hs-identifier hs-var">findConflictedAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Mergeblob1 libdep
</span><a href="#local-6989586621679191051"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">defns</span><span class="hs-operator">.</span><span class="hs-identifier">lca</span><span> </span><span class="annot"><span class="annottext">DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference
</span><a href="#local-6989586621679191058"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Defn (Name, Name) (Name, Name) -&gt; Either Mergeblob2Error ())
 -&gt; Either Mergeblob2Error ())
-&gt; (Defn (Name, Name) (Name, Name) -&gt; Either Mergeblob2Error ())
-&gt; Either Mergeblob2Error ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-67"></span><span>      </span><span class="annot"><span class="annottext">Mergeblob2Error -&gt; Either Mergeblob2Error ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Mergeblob2Error -&gt; Either Mergeblob2Error ())
-&gt; (Defn (Name, Name) (Name, Name) -&gt; Mergeblob2Error)
-&gt; Defn (Name, Name) (Name, Name)
-&gt; Either Mergeblob2Error ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EitherWay (Defn (Name, Name) (Name, Name)) -&gt; Mergeblob2Error
</span><a href="Unison.Merge.Mergeblob2.html#Mergeblob2Error%27ConflictedAlias"><span class="hs-identifier hs-var">Mergeblob2Error'ConflictedAlias</span></a></span><span> </span><span class="annot"><span class="annottext">(EitherWay (Defn (Name, Name) (Name, Name)) -&gt; Mergeblob2Error)
-&gt; (Defn (Name, Name) (Name, Name)
    -&gt; EitherWay (Defn (Name, Name) (Name, Name)))
-&gt; Defn (Name, Name) (Name, Name)
-&gt; Mergeblob2Error
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Defn (Name, Name) (Name, Name)
-&gt; EitherWay (Defn (Name, Name) (Name, Name))
</span><a href="#local-6989586621679191057"><span class="hs-identifier hs-var">who</span></a></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span>  </span><span id="local-6989586621679191061"><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621679191061"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReference TermReference)
-&gt; Either
     (Defn Name Name)
     (TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId))
</span><a href="Unison.Merge.PartitionCombinedDiffs.html#narrowConflictsToNonBuiltins"><span class="hs-identifier hs-var">narrowConflictsToNonBuiltins</span></a></span><span> </span><span class="annot"><span class="annottext">Mergeblob1 libdep
</span><a href="#local-6989586621679191051"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">conflicts</span><span> </span><span class="annot"><span class="annottext">Either
  (Defn Name Name)
  (TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId))
-&gt; (Either
      (Defn Name Name)
      (TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId))
    -&gt; Either
         Mergeblob2Error
         (TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)))
-&gt; Either
     Mergeblob2Error
     (TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId))
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Defn Name Name -&gt; Mergeblob2Error)
-&gt; Either
     (Defn Name Name)
     (TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId))
-&gt; Either
     Mergeblob2Error
     (TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId))
forall a c b. (a -&gt; c) -&gt; Either a b -&gt; Either c b
</span><span class="hs-identifier hs-var">mapLeft</span></span><span> </span><span class="annot"><span class="annottext">Defn Name Name -&gt; Mergeblob2Error
</span><a href="Unison.Merge.Mergeblob2.html#Mergeblob2Error%27ConflictedBuiltin"><span class="hs-identifier hs-var">Mergeblob2Error'ConflictedBuiltin</span></a></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679191064"><span class="hs-identifier hs-type">soloUpdatesAndDeletes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>      </span><span id="local-6989586621679191064"><span class="annot"><span class="annottext">soloUpdatesAndDeletes :: TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191064"><span class="hs-identifier hs-var hs-var">soloUpdatesAndDeletes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-73"></span><span>        </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TermReference
-&gt; TwoWay (DefnsF Set Name Name)
forall term typ.
DefnsF Unconflicts term typ -&gt; TwoWay (DefnsF Set Name Name)
</span><a href="Unison.Merge.Unconflicts.html#soloUpdatesAndDeletes"><span class="hs-identifier hs-var">Unconflicts.soloUpdatesAndDeletes</span></a></span><span> </span><span class="annot"><span class="annottext">Mergeblob1 libdep
</span><a href="#local-6989586621679191051"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">unconflicts</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679191066"><span class="hs-identifier hs-type">coreDependencies</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>      </span><span id="local-6989586621679191066"><span class="annot"><span class="annottext">coreDependencies :: TwoWay (DefnsF Set TermReference TermReference)
</span><a href="#local-6989586621679191066"><span class="hs-identifier hs-var hs-var">coreDependencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-77"></span><span>        </span><span class="annot"><span class="annottext">TwoWay
  (Defns (BiMultimap Referent Name) (BiMultimap TermReference Name))
-&gt; TwoWay (DefnsF Set TermReferenceId TermReferenceId)
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; TwoWay (DefnsF Set TermReference TermReference)
</span><a href="Unison.Merge.Mergeblob2.html#identifyCoreDependencies"><span class="hs-identifier hs-var">identifyCoreDependencies</span></a></span><span>
</span><span id="line-78"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TermReference Name))
-&gt; TwoWay
     (Defns (BiMultimap Referent Name) (BiMultimap TermReference Name))
forall a. ThreeWay a -&gt; TwoWay a
</span><a href="Unison.Merge.ThreeWay.html#forgetLca"><span class="hs-identifier hs-var">ThreeWay.forgetLca</span></a></span><span> </span><span class="annot"><span class="annottext">Mergeblob1 libdep
</span><a href="#local-6989586621679191051"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">defns</span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map Name TermReferenceId -&gt; Set TermReferenceId)
-&gt; (Map Name TermReferenceId -&gt; Set TermReferenceId)
-&gt; DefnsF (Map Name) TermReferenceId TermReferenceId
-&gt; DefnsF Set TermReferenceId TermReferenceId
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; Defns a c -&gt; Defns b d
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TermReferenceId] -&gt; Set TermReferenceId
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([TermReferenceId] -&gt; Set TermReferenceId)
-&gt; (Map Name TermReferenceId -&gt; [TermReferenceId])
-&gt; Map Name TermReferenceId
-&gt; Set TermReferenceId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map Name TermReferenceId -&gt; [TermReferenceId]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TermReferenceId] -&gt; Set TermReferenceId
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([TermReferenceId] -&gt; Set TermReferenceId)
-&gt; (Map Name TermReferenceId -&gt; [TermReferenceId])
-&gt; Map Name TermReferenceId
-&gt; Set TermReferenceId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map Name TermReferenceId -&gt; [TermReferenceId]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DefnsF (Map Name) TermReferenceId TermReferenceId
 -&gt; DefnsF Set TermReferenceId TermReferenceId)
-&gt; TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
-&gt; TwoWay (DefnsF Set TermReferenceId TermReferenceId)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621679191061"><span class="hs-identifier hs-var">conflicts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>          </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191064"><span class="hs-identifier hs-var">soloUpdatesAndDeletes</span></a></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-identifier">pure</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="Unison.Merge.Mergeblob2.html#Mergeblob2"><span class="hs-identifier hs-type">Mergeblob2</span></a></span><span>
</span><span id="line-84"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
$sel:conflicts:Mergeblob2 :: TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
conflicts :: TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="Unison.Merge.Mergeblob2.html#%24sel%3Aconflicts%3AMergeblob2"><span class="hs-identifier hs-var hs-var">conflicts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>        </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set TermReference TermReference)
$sel:coreDependencies:Mergeblob2 :: TwoWay (DefnsF Set TermReference TermReference)
coreDependencies :: TwoWay (DefnsF Set TermReference TermReference)
</span><a href="Unison.Merge.Mergeblob2.html#%24sel%3AcoreDependencies%3AMergeblob2"><span class="hs-identifier hs-var hs-var">coreDependencies</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>        </span><span class="annot"><span class="annottext">$sel:declNameLookups:Mergeblob2 :: TwoWay DeclNameLookup
</span><a href="Unison.Merge.Mergeblob2.html#%24sel%3AdeclNameLookups%3AMergeblob2"><span class="hs-identifier hs-var">declNameLookups</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mergeblob1 libdep
</span><a href="#local-6989586621679191051"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">declNameLookups</span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>        </span><span class="annot"><span class="annottext">$sel:defns:Mergeblob2 :: ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TermReference Name))
</span><a href="Unison.Merge.Mergeblob2.html#%24sel%3Adefns%3AMergeblob2"><span class="hs-identifier hs-var">defns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mergeblob1 libdep
</span><a href="#local-6989586621679191051"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">defns</span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>        </span><span class="hs-comment">-- Eh, they'd either both be null, or neither, but just check both maps anyway</span><span>
</span><span id="line-89"></span><span>        </span><span class="annot"><span class="annottext">$sel:hasConflicts:Mergeblob2 :: Bool
</span><a href="Unison.Merge.Mergeblob2.html#%24sel%3AhasConflicts%3AMergeblob2"><span class="hs-identifier hs-var">hasConflicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefnsF (Map Name) TermReferenceId TermReferenceId -&gt; Bool
forall (f :: * -&gt; *) (g :: * -&gt; *) a b.
(Foldable f, Foldable g) =&gt;
Defns (f a) (g b) -&gt; Bool
</span><span class="hs-identifier hs-var">defnsAreEmpty</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621679191061"><span class="hs-identifier hs-var">conflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefnsF (Map Name) TermReferenceId TermReferenceId -&gt; Bool
forall (f :: * -&gt; *) (g :: * -&gt; *) a b.
(Foldable f, Foldable g) =&gt;
Defns (f a) (g b) -&gt; Bool
</span><span class="hs-identifier hs-var">defnsAreEmpty</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621679191061"><span class="hs-identifier hs-var">conflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>        </span><span class="annot"><span class="annottext">$sel:hydratedDefns:Mergeblob2 :: TwoWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="Unison.Merge.Mergeblob2.html#%24sel%3AhydratedDefns%3AMergeblob2"><span class="hs-identifier hs-var">hydratedDefns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThreeWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
-&gt; TwoWay
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
forall a. ThreeWay a -&gt; TwoWay a
</span><a href="Unison.Merge.ThreeWay.html#forgetLca"><span class="hs-identifier hs-var">ThreeWay.forgetLca</span></a></span><span> </span><span class="annot"><span class="annottext">Mergeblob1 libdep
</span><a href="#local-6989586621679191051"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">hydratedDefns</span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>        </span><span class="annot"><span class="annottext">$sel:libdeps:Mergeblob2 :: Map NameSegment libdep
</span><a href="Unison.Merge.Mergeblob2.html#%24sel%3Alibdeps%3AMergeblob2"><span class="hs-identifier hs-var">libdeps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mergeblob1 libdep
</span><a href="#local-6989586621679191051"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">libdeps</span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>        </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
$sel:soloUpdatesAndDeletes:Mergeblob2 :: TwoWay (DefnsF Set Name Name)
soloUpdatesAndDeletes :: TwoWay (DefnsF Set Name Name)
</span><a href="Unison.Merge.Mergeblob2.html#%24sel%3AsoloUpdatesAndDeletes%3AMergeblob2"><span class="hs-identifier hs-var hs-var">soloUpdatesAndDeletes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-93"></span><span>        </span><span class="annot"><span class="annottext">$sel:unconflicts:Mergeblob2 :: DefnsF Unconflicts Referent TermReference
</span><a href="Unison.Merge.Mergeblob2.html#%24sel%3Aunconflicts%3AMergeblob2"><span class="hs-identifier hs-var">unconflicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mergeblob1 libdep
</span><a href="#local-6989586621679191051"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">unconflicts</span><span>
</span><span id="line-94"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="annot"><a href="Unison.Merge.Mergeblob2.html#identifyCoreDependencies"><span class="hs-identifier hs-type">identifyCoreDependencies</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span id="identifyCoreDependencies"><span class="annot"><span class="annottext">identifyCoreDependencies :: TwoWay
  (Defns (BiMultimap Referent Name) (BiMultimap TermReference Name))
-&gt; TwoWay (DefnsF Set TermReferenceId TermReferenceId)
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; TwoWay (DefnsF Set TermReference TermReference)
</span><a href="Unison.Merge.Mergeblob2.html#identifyCoreDependencies"><span class="hs-identifier hs-var hs-var">identifyCoreDependencies</span></a></span></span><span> </span><span id="local-6989586621679191074"><span class="annot"><span class="annottext">TwoWay
  (Defns (BiMultimap Referent Name) (BiMultimap TermReference Name))
</span><a href="#local-6989586621679191074"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span id="local-6989586621679191075"><span class="annot"><span class="annottext">TwoWay (DefnsF Set TermReferenceId TermReferenceId)
</span><a href="#local-6989586621679191075"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span id="local-6989586621679191076"><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191076"><span class="hs-identifier hs-var">soloUpdatesAndDeletes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><span class="annottext">[TwoWay (DefnsF Set TermReference TermReference)]
-&gt; TwoWay (DefnsF Set TermReference TermReference)
forall m. Monoid m =&gt; [m] -&gt; m
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-comment">-- One source of dependencies: Alice's versions of Bob's unconflicted deletes and updates, and vice-versa.</span><span>
</span><span id="line-104"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-105"></span><span>      </span><span class="hs-comment">-- This is name-based: if Bob updates the *name* &quot;foo&quot;, then we go find the thing that Alice calls &quot;foo&quot; (if</span><span>
</span><span id="line-106"></span><span>      </span><span class="hs-comment">-- anything), no matter what its hash is.</span><span>
</span><span id="line-107"></span><span>      </span><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap TermReference Name)
-&gt; DefnsF Set TermReference TermReference
forall name.
Defns (BiMultimap Referent name) (BiMultimap TermReference name)
-&gt; DefnsF Set TermReference TermReference
</span><a href="Unison.Merge.Mergeblob2.html#defnsReferences"><span class="hs-identifier hs-var">defnsReferences</span></a></span><span>
</span><span id="line-108"></span><span>        </span><span class="annot"><span class="annottext">(Defns (BiMultimap Referent Name) (BiMultimap TermReference Name)
 -&gt; DefnsF Set TermReference TermReference)
-&gt; TwoWay
     (Defns (BiMultimap Referent Name) (BiMultimap TermReference Name))
-&gt; TwoWay (DefnsF Set TermReference TermReference)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(Set Name -&gt; BiMultimap Referent Name -&gt; BiMultimap Referent Name)
-&gt; (Set Name
    -&gt; BiMultimap TermReference Name -&gt; BiMultimap TermReference Name)
-&gt; DefnsF Set Name Name
-&gt; Defns (BiMultimap Referent Name) (BiMultimap TermReference Name)
-&gt; Defns (BiMultimap Referent Name) (BiMultimap TermReference Name)
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; BiMultimap Referent Name -&gt; BiMultimap Referent Name
forall a b.
(Ord a, Ord b) =&gt;
Set b -&gt; BiMultimap a b -&gt; BiMultimap a b
</span><span class="hs-identifier hs-var">BiMultimap.restrictRan</span></span><span> </span><span class="annot"><span class="annottext">Set Name
-&gt; BiMultimap TermReference Name -&gt; BiMultimap TermReference Name
forall a b.
(Ord a, Ord b) =&gt;
Set b -&gt; BiMultimap a b -&gt; BiMultimap a b
</span><span class="hs-identifier hs-var">BiMultimap.restrictRan</span></span><span>
</span><span id="line-109"></span><span>                </span><span class="annot"><span class="annottext">(DefnsF Set Name Name
 -&gt; Defns (BiMultimap Referent Name) (BiMultimap TermReference Name)
 -&gt; Defns
      (BiMultimap Referent Name) (BiMultimap TermReference Name))
-&gt; TwoWay (DefnsF Set Name Name)
-&gt; TwoWay
     (Defns (BiMultimap Referent Name) (BiMultimap TermReference Name)
      -&gt; Defns
           (BiMultimap Referent Name) (BiMultimap TermReference Name))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name) -&gt; TwoWay (DefnsF Set Name Name)
forall a. TwoWay a -&gt; TwoWay a
</span><a href="Unison.Merge.TwoWay.html#swap"><span class="hs-identifier hs-var">TwoWay.swap</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621679191076"><span class="hs-identifier hs-var">soloUpdatesAndDeletes</span></a></span><span>
</span><span id="line-110"></span><span>                </span><span class="annot"><span class="annottext">TwoWay
  (Defns (BiMultimap Referent Name) (BiMultimap TermReference Name)
   -&gt; Defns
        (BiMultimap Referent Name) (BiMultimap TermReference Name))
-&gt; TwoWay
     (Defns (BiMultimap Referent Name) (BiMultimap TermReference Name))
-&gt; TwoWay
     (Defns (BiMultimap Referent Name) (BiMultimap TermReference Name))
forall a b. TwoWay (a -&gt; b) -&gt; TwoWay a -&gt; TwoWay b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay
  (Defns (BiMultimap Referent Name) (BiMultimap TermReference Name))
</span><a href="#local-6989586621679191074"><span class="hs-identifier hs-var">defns</span></a></span><span>
</span><span id="line-111"></span><span>            </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>      </span><span class="hs-comment">-- The other source of dependencies: Alice's own conflicted things, and ditto for Bob.</span><span>
</span><span id="line-113"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-114"></span><span>      </span><span class="hs-comment">-- An example: suppose Alice has foo#alice and Bob has foo#bob, so foo is conflicted. Furthermore, suppose</span><span>
</span><span id="line-115"></span><span>      </span><span class="hs-comment">-- Alice has bar#bar that depends on foo#alice.</span><span>
</span><span id="line-116"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-117"></span><span>      </span><span class="hs-comment">-- We want Alice's #alice to be considered a dependency, so that when we go off and find dependents of these</span><span>
</span><span id="line-118"></span><span>      </span><span class="hs-comment">-- dependencies to put in the scratch file for type checking and propagation, we find bar#bar.</span><span>
</span><span id="line-119"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-120"></span><span>      </span><span class="hs-comment">-- Note that this is necessary even if bar#bar is unconflicted! We don't want bar#bar to be put directly</span><span>
</span><span id="line-121"></span><span>      </span><span class="hs-comment">-- into the namespace / parsing context for the conflicted merge, because it has an unnamed reference on</span><span>
</span><span id="line-122"></span><span>      </span><span class="hs-comment">-- foo#alice. It rather ought to be in the scratchfile alongside the conflicted foo#alice and foo#bob, so</span><span>
</span><span id="line-123"></span><span>      </span><span class="hs-comment">-- that when that conflict is resolved, it will propagate to bar.</span><span>
</span><span id="line-124"></span><span>      </span><span class="annot"><span class="annottext">(Set TermReferenceId -&gt; Set TermReference)
-&gt; (Set TermReferenceId -&gt; Set TermReference)
-&gt; DefnsF Set TermReferenceId TermReferenceId
-&gt; DefnsF Set TermReference TermReference
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; Defns a c -&gt; Defns b d
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TermReferenceId -&gt; TermReference)
-&gt; Set TermReferenceId -&gt; Set TermReference
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId -&gt; TermReference
forall h t. Id' h -&gt; Reference' t h
</span><span class="hs-identifier hs-var">Reference.DerivedId</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TermReferenceId -&gt; TermReference)
-&gt; Set TermReferenceId -&gt; Set TermReference
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId -&gt; TermReference
forall h t. Id' h -&gt; Reference' t h
</span><span class="hs-identifier hs-var">Reference.DerivedId</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DefnsF Set TermReferenceId TermReferenceId
 -&gt; DefnsF Set TermReference TermReference)
-&gt; TwoWay (DefnsF Set TermReferenceId TermReferenceId)
-&gt; TwoWay (DefnsF Set TermReference TermReference)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set TermReferenceId TermReferenceId)
</span><a href="#local-6989586621679191075"><span class="hs-identifier hs-var">conflicts</span></a></span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span id="local-6989586621679190936"><span class="annot"><a href="Unison.Merge.Mergeblob2.html#defnsReferences"><span class="hs-identifier hs-type">defnsReferences</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><a href="#local-6989586621679190936"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="annot"><a href="#local-6989586621679190936"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-129"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span></span><span>
</span><span id="line-130"></span><span id="defnsReferences"><span class="annot"><span class="annottext">defnsReferences :: forall name.
Defns (BiMultimap Referent name) (BiMultimap TermReference name)
-&gt; DefnsF Set TermReference TermReference
</span><a href="Unison.Merge.Mergeblob2.html#defnsReferences"><span class="hs-identifier hs-var hs-var">defnsReferences</span></a></span></span><span> </span><span id="local-6989586621679191092"><span class="annot"><span class="annottext">Defns (BiMultimap Referent name) (BiMultimap TermReference name)
</span><a href="#local-6989586621679191092"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><span class="annottext">(DefnsF Set TermReference TermReference
 -&gt; Referent -&gt; DefnsF Set TermReference TermReference)
-&gt; DefnsF Set TermReference TermReference
-&gt; [Referent]
-&gt; DefnsF Set TermReference TermReference
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">List.foldl'</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Set TermReference TermReference
-&gt; Referent -&gt; DefnsF Set TermReference TermReference
</span><a href="#local-6989586621679191094"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:terms:Defns :: Set TermReference
</span><span class="hs-identifier hs-var">terms</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set TermReference
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:types:Defns :: Set TermReference
</span><span class="hs-identifier hs-var">types</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BiMultimap TermReference name -&gt; Set TermReference
forall a b. BiMultimap a b -&gt; Set a
</span><span class="hs-identifier hs-var">BiMultimap.dom</span></span><span> </span><span class="annot"><span class="annottext">Defns (BiMultimap Referent name) (BiMultimap TermReference name)
</span><a href="#local-6989586621679191092"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Referent -&gt; [Referent]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BiMultimap Referent name -&gt; Set Referent
forall a b. BiMultimap a b -&gt; Set a
</span><span class="hs-identifier hs-var">BiMultimap.dom</span></span><span> </span><span class="annot"><span class="annottext">Defns (BiMultimap Referent name) (BiMultimap TermReference name)
</span><a href="#local-6989586621679191092"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><a href="#local-6989586621679191094"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621679191094"><span class="annot"><span class="annottext">f :: DefnsF Set TermReference TermReference
-&gt; Referent -&gt; DefnsF Set TermReference TermReference
</span><a href="#local-6989586621679191094"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679191101"><span class="annot"><span class="annottext">DefnsF Set TermReference TermReference
</span><a href="#local-6989586621679191101"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-135"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Referent.Con</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConstructorReference</span></span><span> </span><span id="local-6989586621679191104"><span class="annot"><span class="annottext">TermReference
</span><a href="#local-6989586621679191104"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConstructorId
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConstructorType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-136"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679191105"><span class="annot"><span class="annottext">types :: Set TermReference
</span><a href="#local-6989586621679191105"><span class="hs-identifier hs-var hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermReference -&gt; Set TermReference -&gt; Set TermReference
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.insert</span></span><span> </span><span class="annot"><span class="annottext">TermReference
</span><a href="#local-6989586621679191104"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF Set TermReference TermReference
</span><a href="#local-6989586621679191101"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span>
</span><span id="line-137"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:terms:Defns :: Set TermReference
</span><span class="hs-identifier hs-var">terms</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DefnsF Set TermReference TermReference
</span><a href="#local-6989586621679191101"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set TermReference
$sel:types:Defns :: Set TermReference
types :: Set TermReference
</span><span class="hs-identifier hs-var hs-var">types</span></span><span class="hs-special">}</span><span>
</span><span id="line-138"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span id="local-6989586621679191108"><span class="annot"><span class="annottext">TermReference
</span><a href="#local-6989586621679191108"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-139"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679191109"><span class="annot"><span class="annottext">terms :: Set TermReference
</span><a href="#local-6989586621679191109"><span class="hs-identifier hs-var hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermReference -&gt; Set TermReference -&gt; Set TermReference
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.insert</span></span><span> </span><span class="annot"><span class="annottext">TermReference
</span><a href="#local-6989586621679191108"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF Set TermReference TermReference
</span><a href="#local-6989586621679191101"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span>
</span><span id="line-140"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Set TermReference
$sel:terms:Defns :: Set TermReference
terms :: Set TermReference
</span><span class="hs-identifier hs-var hs-var">terms</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:types:Defns :: Set TermReference
</span><span class="hs-identifier hs-var">types</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DefnsF Set TermReference TermReference
</span><a href="#local-6989586621679191101"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-special">}</span><span>
</span><span id="line-141"></span></pre></body></html>