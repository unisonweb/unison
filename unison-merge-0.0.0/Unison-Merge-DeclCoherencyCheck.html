<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Unison.Merge.DeclCoherencyCheck</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">unison-merge-0.0.0</span><ul class="links" id="page-menu"><li><a href="src/Unison.Merge.DeclCoherencyCheck.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Unison.Merge.DeclCoherencyCheck</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Getting all failures rather than just the first</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>The &quot;decl coherency check&quot;: a type declaration in a namespace is &quot;coherent&quot; if it satisfies both of the following
 criteria.</p><ol><li value="1">For each naming of the type decl (say <a href="Foo.html">Foo</a>#foohash), there exists exactly one name for each of its constructors
      arbitrarily deep in the corresponding namespace (<a href="Foo.html">Foo</a> in this example).</li></ol><p>This allows us to render the decl naturally, as in</p><p>structural type Foo
          = Bar Nat Int
          | internal.hello.Bonk Nat</p><p>which corresponds to the three names</p><p><a href="Foo.html">Foo</a>                     =&gt; #foohash
        <a href="Foo-Bar.html">Foo.Bar</a>                 =&gt; <a id="foohash"></a>0
        &quot;Foo.internal.hello.Bonk&quot; =&gt; <a id="foohash"></a>1</p><p>We could not do if there was at least one constructor whose full name does not contain the full name of the type
      decl itself as a prefix.</p><p>A notable consequence of this requirement is that a second naming of a decl (i.e. an alias) cannot be embedded
      within the first naming, as in:</p><p>type Foo = ...
        type Foo.some.inner.namespace = ... -- an alias of Foo</p><ol><li value="2"><p>No constructor has a &quot;stray&quot; name that does not have a prefix that equals the type declaration's name. For
      example, in the namespace</p><p><a href="Foo.html">Foo</a>                 =&gt; #foohash
 <a href="Foo-Bar.html">Foo.Bar</a>             =&gt; <a id="foohash"></a>0
 <a href="Deep-What-SomeAlias.html">Deep.What.SomeAlias</a> =&gt; <a id="foohash"></a>0</p></li></ol><p>the constructor <a href="What-SomeAlias.html">What.SomeAlias</a> is &quot;stray&quot;, as the type decl #foohash has no name that matches any prefix
      (i.e. <a href="Deep-What.html">Deep.What</a> nor <a href="Deep.html">Deep</a>).</p><p>On to the implementation. We are going to traverse the namespace depth-first. As we go, we have a stateful mapping
 between decl reference that we *have* seen a name for in one of our parent namespace, and its corresponding set of
 constructors that we *haven't* yet seen names for, but expect to, before fully searching the corresponding
 sub-namespace (e.g. the child namespace named <a href="Foo.html">Foo</a> of the namepace that declares a decl <a href="Foo.html">Foo</a>).</p><p>When processing a namespace, we first process all terms. Each constructor will fall into one of three cases:</p><pre>+----------------------------------------------------------------------------------------------------------------+
| Case         | Mapping before       | Encountered constructor | Mapping after                                  |
+----------------------------------------------------------------------------------------------------------------+
| Happy path   | { #foo : {0, 1, 2} } | #foo#1                  | { #foo : {0, 2} }                              |
| Already seen | { #foo : {0, 1, 2} } | #foo#5                  | Error: duplicate naming for constructor #foo#5 |
| Never seen   | { #foo : {0, 1, 2} } | #bar#2                  | Error: stray constructor #bar#2                |
+----------------------------------------------------------------------------------------------------------------+</pre><p>In &quot;happy path&quot;, we see a naming of a constructor that we're expecting, and check it off.
 In &quot;already seen&quot;, we see a second naming of a constructor that we're no longer expecting, and fail.
 In &quot;never seen&quot;, we see a naming of a constructor before any naming of its decl, so we fail.</p><p>Next, we process all type decls. Each will again fall into one of three cases:</p><pre>+-----------------------------------------------------------------------------------------------------+
| Case             | Mapping before       | Declaration | Num constructors | New mapping              |
+-----------------------------------------------------------------------------------------------------+
| Uninhabited decl |                      | #foo        | 0                |                          |
| Inhabited decl   |                      | #foo        | 1 or more        | { #foo : {0, ..., n-1} } |
| Already seen     | { foo : {0, 1, 2}  } | #foo        | Irrelevant       | Error: nested decl alias |
+-----------------------------------------------------------------------------------------------------+</pre><p>In &quot;uninhabited decl&quot;, we find a decl with no constructors, so we don't expect anything new.
 In &quot;already seen&quot;, we find a second naming of a decl, whose constructors will necessarily violate coherency condition
   (1) above.</p><p>In &quot;inhabited decl&quot;, we find a decl with N constructors, and handle it by:
   1. Adding to our state that we expect a name for each.
   2. Recursing into the child namespace whose name matches the decl.
   3. (If we return from the recursion without short-circuiting) remove the mapping added in step (1) and assert that
      its value is the empty set (meaning we encountered a name for every constructor).</p><p>Note: This check could be moved into SQLite (with sufficient schema support) some day, but for now, we just do this
 in memory.</p><p>Note: once upon a time, decls could be &quot;incoherent&quot;. Then, we decided we want decls to be &quot;coherent&quot;. Thus, this
 machinery was invented.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:IncoherentDeclReason">IncoherentDeclReason</a><ul class="subs"><li>= <a href="#v:IncoherentDeclReason-39-ConstructorAlias">IncoherentDeclReason'ConstructorAlias</a> !<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a> !<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a> !<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a></li><li>| <a href="#v:IncoherentDeclReason-39-MissingConstructorName">IncoherentDeclReason'MissingConstructorName</a> !<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a></li><li>| <a href="#v:IncoherentDeclReason-39-NestedDeclAlias">IncoherentDeclReason'NestedDeclAlias</a> !<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a> !<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a></li><li>| <a href="#v:IncoherentDeclReason-39-StrayConstructor">IncoherentDeclReason'StrayConstructor</a> !<a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TypeReferenceId" title="U.Codebase.Reference">TypeReferenceId</a> !<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a></li></ul></li><li class="src short"><a href="#v:checkDeclCoherency">checkDeclCoherency</a> :: <a href="../base-4.18.2.1/GHC-Stack.html#t:HasCallStack" title="GHC.Stack">HasCallStack</a> =&gt; <a href="../unison-core1-0.0.0/Unison-Util-Nametree.html#t:Nametree" title="Unison.Util.Nametree">Nametree</a> (<a href="../unison-core1-0.0.0/Unison-Util-Defns.html#t:DefnsF" title="Unison.Util.Defns">DefnsF</a> (<a href="../containers-0.6.7/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="../unison-core-0.0.0/Unison-NameSegment-Internal.html#t:NameSegment" title="Unison.NameSegment.Internal">NameSegment</a>) <a href="../unison-core1-0.0.0/Unison-Referent.html#t:Referent" title="Unison.Referent">Referent</a> <a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TypeReference" title="U.Codebase.Reference">TypeReference</a>) -&gt; <a href="../containers-0.6.7/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TypeReferenceId" title="U.Codebase.Reference">TypeReferenceId</a> <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/Data-Either.html#t:Either" title="Data.Either">Either</a> <a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReason" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReason</a> <a href="../unison-core1-0.0.0/Unison-DeclNameLookup.html#t:DeclNameLookup" title="Unison.DeclNameLookup">DeclNameLookup</a></li><li class="src short"><a href="#v:lenientCheckDeclCoherency">lenientCheckDeclCoherency</a> :: <a href="../unison-core1-0.0.0/Unison-Util-Nametree.html#t:Nametree" title="Unison.Util.Nametree">Nametree</a> (<a href="../unison-core1-0.0.0/Unison-Util-Defns.html#t:DefnsF" title="Unison.Util.Defns">DefnsF</a> (<a href="../containers-0.6.7/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="../unison-core-0.0.0/Unison-NameSegment-Internal.html#t:NameSegment" title="Unison.NameSegment.Internal">NameSegment</a>) <a href="../unison-core1-0.0.0/Unison-Referent.html#t:Referent" title="Unison.Referent">Referent</a> <a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TypeReference" title="U.Codebase.Reference">TypeReference</a>) -&gt; <a href="../containers-0.6.7/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TypeReferenceId" title="U.Codebase.Reference">TypeReferenceId</a> <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Unison-Merge-PartialDeclNameLookup.html#t:PartialDeclNameLookup" title="Unison.Merge.PartialDeclNameLookup">PartialDeclNameLookup</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:IncoherentDeclReasons">IncoherentDeclReasons</a> = <a href="#v:IncoherentDeclReasons">IncoherentDeclReasons</a> {<ul class="subs"><li><a href="#v:constructorAliases">constructorAliases</a> :: ![(<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>, <a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>, <a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>)]</li><li><a href="#v:missingConstructorNames">missingConstructorNames</a> :: ![<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>]</li><li><a href="#v:nestedDeclAliases">nestedDeclAliases</a> :: ![(<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>, <a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>)]</li><li><a href="#v:strayConstructors">strayConstructors</a> :: ![(<a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TypeReferenceId" title="U.Codebase.Reference">TypeReferenceId</a>, <a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>)]</li></ul>}</li><li class="src short"><a href="#v:checkAllDeclCoherency">checkAllDeclCoherency</a> :: <span class="keyword">forall</span> m. <a href="../base-4.18.2.1/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m =&gt; (<a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TypeReferenceId" title="U.Codebase.Reference">TypeReferenceId</a> -&gt; m <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a>) -&gt; <a href="../unison-core1-0.0.0/Unison-Util-Nametree.html#t:Nametree" title="Unison.Util.Nametree">Nametree</a> (<a href="../unison-core1-0.0.0/Unison-Util-Defns.html#t:DefnsF" title="Unison.Util.Defns">DefnsF</a> (<a href="../containers-0.6.7/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="../unison-core-0.0.0/Unison-NameSegment-Internal.html#t:NameSegment" title="Unison.NameSegment.Internal">NameSegment</a>) <a href="../unison-core1-0.0.0/Unison-Referent.html#t:Referent" title="Unison.Referent">Referent</a> <a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TypeReference" title="U.Codebase.Reference">TypeReference</a>) -&gt; m (<a href="../base-4.18.2.1/Data-Either.html#t:Either" title="Data.Either">Either</a> <a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReasons" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReasons</a> <a href="../unison-core1-0.0.0/Unison-DeclNameLookup.html#t:DeclNameLookup" title="Unison.DeclNameLookup">DeclNameLookup</a>)</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:IncoherentDeclReason" class="def">IncoherentDeclReason</a> <a href="src/Unison.Merge.DeclCoherencyCheck.html#IncoherentDeclReason" class="link">Source</a> <a href="#t:IncoherentDeclReason" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:IncoherentDeclReason-39-ConstructorAlias" class="def">IncoherentDeclReason'ConstructorAlias</a> !<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a> !<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a> !<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a></td><td class="doc"><p>A second naming of a constructor was discovered underneath a decl's name, e.g.</p><p>Foo#Foo
   Foo.Bar<a id="Foo"></a>0
   Foo.Some.Other.Name.For.Bar<a id="Foo"></a>0</p></td></tr><tr><td class="src"><a id="v:IncoherentDeclReason-39-MissingConstructorName" class="def">IncoherentDeclReason'MissingConstructorName</a> !<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:IncoherentDeclReason-39-NestedDeclAlias" class="def">IncoherentDeclReason'NestedDeclAlias</a> !<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a> !<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a></td><td class="doc"><p>A second naming of a decl was discovered underneath its name, e.g.</p><p>Foo#Foo
   Foo.Bar#Foo</p></td></tr><tr><td class="src"><a id="v:IncoherentDeclReason-39-StrayConstructor" class="def">IncoherentDeclReason'StrayConstructor</a> !<a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TypeReferenceId" title="U.Codebase.Reference">TypeReferenceId</a> !<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:IncoherentDeclReason">Instances</h4><details id="i:IncoherentDeclReason" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:IncoherentDeclReason:Show:1"></span> <a href="../base-4.18.2.1/Text-Show.html#t:Show" title="Text.Show">Show</a> <a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReason" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReason</a></span> <a href="src/Unison.Merge.DeclCoherencyCheck.html#line-135" class="link">Source</a> <a href="#t:IncoherentDeclReason" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:IncoherentDeclReason:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Unison-Merge-DeclCoherencyCheck.html">Unison.Merge.DeclCoherencyCheck</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReason" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReason</a> -&gt; <a href="../base-4.18.2.1/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReason" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReason</a> -&gt; <a href="../base-4.18.2.1/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReason" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReason</a>] -&gt; <a href="../base-4.18.2.1/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:checkDeclCoherency" class="def">checkDeclCoherency</a> :: <a href="../base-4.18.2.1/GHC-Stack.html#t:HasCallStack" title="GHC.Stack">HasCallStack</a> =&gt; <a href="../unison-core1-0.0.0/Unison-Util-Nametree.html#t:Nametree" title="Unison.Util.Nametree">Nametree</a> (<a href="../unison-core1-0.0.0/Unison-Util-Defns.html#t:DefnsF" title="Unison.Util.Defns">DefnsF</a> (<a href="../containers-0.6.7/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="../unison-core-0.0.0/Unison-NameSegment-Internal.html#t:NameSegment" title="Unison.NameSegment.Internal">NameSegment</a>) <a href="../unison-core1-0.0.0/Unison-Referent.html#t:Referent" title="Unison.Referent">Referent</a> <a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TypeReference" title="U.Codebase.Reference">TypeReference</a>) -&gt; <a href="../containers-0.6.7/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TypeReferenceId" title="U.Codebase.Reference">TypeReferenceId</a> <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/Data-Either.html#t:Either" title="Data.Either">Either</a> <a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReason" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReason</a> <a href="../unison-core1-0.0.0/Unison-DeclNameLookup.html#t:DeclNameLookup" title="Unison.DeclNameLookup">DeclNameLookup</a> <a href="src/Unison.Merge.DeclCoherencyCheck.html#checkDeclCoherency" class="link">Source</a> <a href="#v:checkDeclCoherency" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:lenientCheckDeclCoherency" class="def">lenientCheckDeclCoherency</a> :: <a href="../unison-core1-0.0.0/Unison-Util-Nametree.html#t:Nametree" title="Unison.Util.Nametree">Nametree</a> (<a href="../unison-core1-0.0.0/Unison-Util-Defns.html#t:DefnsF" title="Unison.Util.Defns">DefnsF</a> (<a href="../containers-0.6.7/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="../unison-core-0.0.0/Unison-NameSegment-Internal.html#t:NameSegment" title="Unison.NameSegment.Internal">NameSegment</a>) <a href="../unison-core1-0.0.0/Unison-Referent.html#t:Referent" title="Unison.Referent">Referent</a> <a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TypeReference" title="U.Codebase.Reference">TypeReference</a>) -&gt; <a href="../containers-0.6.7/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TypeReferenceId" title="U.Codebase.Reference">TypeReferenceId</a> <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Unison-Merge-PartialDeclNameLookup.html#t:PartialDeclNameLookup" title="Unison.Merge.PartialDeclNameLookup">PartialDeclNameLookup</a> <a href="src/Unison.Merge.DeclCoherencyCheck.html#lenientCheckDeclCoherency" class="link">Source</a> <a href="#v:lenientCheckDeclCoherency" class="selflink">#</a></p><div class="doc"><p>A lenient variant of <code><a href="Unison-Merge-DeclCoherencyCheck.html#v:checkDeclCoherency" title="Unison.Merge.DeclCoherencyCheck">checkDeclCoherency</a></code> - so lenient it can't even fail! It returns partial decl name lookup,
 which doesn't require a name for every constructor, and allows a constructor with a nameless decl.</p><p>This function exists merely to extract a best-effort name mapping for the LCA of a merge. We require Alice and Bob to
 have coherent decls, but their LCA is out of the user's control and may have incoherent decls, and whether or not it
 does, we still need to compute *some* syntactic hash for its decls.</p></div></div><a href="#g:1" id="g:1"><h1>Getting all failures rather than just the first</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:IncoherentDeclReasons" class="def">IncoherentDeclReasons</a> <a href="src/Unison.Merge.DeclCoherencyCheck.html#IncoherentDeclReasons" class="link">Source</a> <a href="#t:IncoherentDeclReasons" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:IncoherentDeclReasons" class="def">IncoherentDeclReasons</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:constructorAliases" class="def">constructorAliases</a> :: ![(<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>, <a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>, <a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>)]</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:missingConstructorNames" class="def">missingConstructorNames</a> :: ![<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>]</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:nestedDeclAliases" class="def">nestedDeclAliases</a> :: ![(<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>, <a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>)]</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:strayConstructors" class="def">strayConstructors</a> :: ![(<a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TypeReferenceId" title="U.Codebase.Reference">TypeReferenceId</a>, <a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>)]</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:IncoherentDeclReasons">Instances</h4><details id="i:IncoherentDeclReasons" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:IncoherentDeclReasons:Generic:1"></span> <a href="../base-4.18.2.1/GHC-Generics.html#t:Generic" title="GHC.Generics">Generic</a> <a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReasons" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReasons</a></span> <a href="src/Unison.Merge.DeclCoherencyCheck.html#line-159" class="link">Source</a> <a href="#t:IncoherentDeclReasons" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:IncoherentDeclReasons:Generic:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Unison-Merge-DeclCoherencyCheck.html">Unison.Merge.DeclCoherencyCheck</a></p> <div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a href="../base-4.18.2.1/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReasons" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReasons</a> :: <a href="../base-4.18.2.1/Data-Kind.html#t:Type" title="Data.Kind">Type</a> -&gt; <a href="../base-4.18.2.1/Data-Kind.html#t:Type" title="Data.Kind">Type</a> <a href="#t:Rep" class="selflink">#</a></p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:from">from</a> :: <a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReasons" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReasons</a> -&gt; <a href="../base-4.18.2.1/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReasons" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReasons</a> x <a href="#v:from" class="selflink">#</a></p><p class="src"><a href="#v:to">to</a> :: <a href="../base-4.18.2.1/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReasons" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReasons</a> x -&gt; <a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReasons" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReasons</a> <a href="#v:to" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:IncoherentDeclReasons:Eq:2"></span> <a href="../base-4.18.2.1/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> <a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReasons" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReasons</a></span> <a href="src/Unison.Merge.DeclCoherencyCheck.html#line-159" class="link">Source</a> <a href="#t:IncoherentDeclReasons" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:IncoherentDeclReasons:Eq:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Unison-Merge-DeclCoherencyCheck.html">Unison.Merge.DeclCoherencyCheck</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReasons" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReasons</a> -&gt; <a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReasons" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReasons</a> -&gt; <a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReasons" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReasons</a> -&gt; <a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReasons" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReasons</a> -&gt; <a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:IncoherentDeclReasons:Rep:3"></span> <span class="keyword">type</span> <a href="../base-4.18.2.1/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReasons" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReasons</a></span> <a href="src/Unison.Merge.DeclCoherencyCheck.html#line-159" class="link">Source</a> <a href="#t:IncoherentDeclReasons" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:IncoherentDeclReasons:Rep:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Unison-Merge-DeclCoherencyCheck.html">Unison.Merge.DeclCoherencyCheck</a></p> <div class="src"><span class="keyword">type</span> <a href="../base-4.18.2.1/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReasons" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReasons</a> = <a href="../base-4.18.2.1/GHC-Generics.html#t:D1" title="GHC.Generics">D1</a> ('<a href="../base-4.18.2.1/GHC-Generics.html#v:MetaData" title="GHC.Generics">MetaData</a> &quot;IncoherentDeclReasons&quot; &quot;Unison.Merge.DeclCoherencyCheck&quot; &quot;unison-merge-0.0.0-J0UFbIl68kYKm83b9dBydP&quot; '<a href="../base-4.18.2.1/Data-Bool.html#v:False" title="Data.Bool">False</a>) (<a href="../base-4.18.2.1/GHC-Generics.html#t:C1" title="GHC.Generics">C1</a> ('<a href="../base-4.18.2.1/GHC-Generics.html#v:MetaCons" title="GHC.Generics">MetaCons</a> &quot;IncoherentDeclReasons&quot; '<a href="../base-4.18.2.1/GHC-Generics.html#v:PrefixI" title="GHC.Generics">PrefixI</a> '<a href="../base-4.18.2.1/Data-Bool.html#v:True" title="Data.Bool">True</a>) ((<a href="../base-4.18.2.1/GHC-Generics.html#t:S1" title="GHC.Generics">S1</a> ('<a href="../base-4.18.2.1/GHC-Generics.html#v:MetaSel" title="GHC.Generics">MetaSel</a> ('<a href="../base-4.18.2.1/Data-Maybe.html#v:Just" title="Data.Maybe">Just</a> &quot;constructorAliases&quot;) '<a href="../base-4.18.2.1/GHC-Generics.html#v:NoSourceUnpackedness" title="GHC.Generics">NoSourceUnpackedness</a> '<a href="../base-4.18.2.1/GHC-Generics.html#v:SourceStrict" title="GHC.Generics">SourceStrict</a> '<a href="../base-4.18.2.1/GHC-Generics.html#v:DecidedStrict" title="GHC.Generics">DecidedStrict</a>) (<a href="../base-4.18.2.1/GHC-Generics.html#t:Rec0" title="GHC.Generics">Rec0</a> [(<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>, <a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>, <a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>)]) <a href="../base-4.18.2.1/GHC-Generics.html#t::-42-:" title="GHC.Generics">:*:</a> <a href="../base-4.18.2.1/GHC-Generics.html#t:S1" title="GHC.Generics">S1</a> ('<a href="../base-4.18.2.1/GHC-Generics.html#v:MetaSel" title="GHC.Generics">MetaSel</a> ('<a href="../base-4.18.2.1/Data-Maybe.html#v:Just" title="Data.Maybe">Just</a> &quot;missingConstructorNames&quot;) '<a href="../base-4.18.2.1/GHC-Generics.html#v:NoSourceUnpackedness" title="GHC.Generics">NoSourceUnpackedness</a> '<a href="../base-4.18.2.1/GHC-Generics.html#v:SourceStrict" title="GHC.Generics">SourceStrict</a> '<a href="../base-4.18.2.1/GHC-Generics.html#v:DecidedStrict" title="GHC.Generics">DecidedStrict</a>) (<a href="../base-4.18.2.1/GHC-Generics.html#t:Rec0" title="GHC.Generics">Rec0</a> [<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>])) <a href="../base-4.18.2.1/GHC-Generics.html#t::-42-:" title="GHC.Generics">:*:</a> (<a href="../base-4.18.2.1/GHC-Generics.html#t:S1" title="GHC.Generics">S1</a> ('<a href="../base-4.18.2.1/GHC-Generics.html#v:MetaSel" title="GHC.Generics">MetaSel</a> ('<a href="../base-4.18.2.1/Data-Maybe.html#v:Just" title="Data.Maybe">Just</a> &quot;nestedDeclAliases&quot;) '<a href="../base-4.18.2.1/GHC-Generics.html#v:NoSourceUnpackedness" title="GHC.Generics">NoSourceUnpackedness</a> '<a href="../base-4.18.2.1/GHC-Generics.html#v:SourceStrict" title="GHC.Generics">SourceStrict</a> '<a href="../base-4.18.2.1/GHC-Generics.html#v:DecidedStrict" title="GHC.Generics">DecidedStrict</a>) (<a href="../base-4.18.2.1/GHC-Generics.html#t:Rec0" title="GHC.Generics">Rec0</a> [(<a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>, <a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>)]) <a href="../base-4.18.2.1/GHC-Generics.html#t::-42-:" title="GHC.Generics">:*:</a> <a href="../base-4.18.2.1/GHC-Generics.html#t:S1" title="GHC.Generics">S1</a> ('<a href="../base-4.18.2.1/GHC-Generics.html#v:MetaSel" title="GHC.Generics">MetaSel</a> ('<a href="../base-4.18.2.1/Data-Maybe.html#v:Just" title="Data.Maybe">Just</a> &quot;strayConstructors&quot;) '<a href="../base-4.18.2.1/GHC-Generics.html#v:NoSourceUnpackedness" title="GHC.Generics">NoSourceUnpackedness</a> '<a href="../base-4.18.2.1/GHC-Generics.html#v:SourceStrict" title="GHC.Generics">SourceStrict</a> '<a href="../base-4.18.2.1/GHC-Generics.html#v:DecidedStrict" title="GHC.Generics">DecidedStrict</a>) (<a href="../base-4.18.2.1/GHC-Generics.html#t:Rec0" title="GHC.Generics">Rec0</a> [(<a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TypeReferenceId" title="U.Codebase.Reference">TypeReferenceId</a>, <a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a>)]))))</div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:checkAllDeclCoherency" class="def">checkAllDeclCoherency</a> :: <span class="keyword">forall</span> m. <a href="../base-4.18.2.1/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m =&gt; (<a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TypeReferenceId" title="U.Codebase.Reference">TypeReferenceId</a> -&gt; m <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a>) -&gt; <a href="../unison-core1-0.0.0/Unison-Util-Nametree.html#t:Nametree" title="Unison.Util.Nametree">Nametree</a> (<a href="../unison-core1-0.0.0/Unison-Util-Defns.html#t:DefnsF" title="Unison.Util.Defns">DefnsF</a> (<a href="../containers-0.6.7/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="../unison-core-0.0.0/Unison-NameSegment-Internal.html#t:NameSegment" title="Unison.NameSegment.Internal">NameSegment</a>) <a href="../unison-core1-0.0.0/Unison-Referent.html#t:Referent" title="Unison.Referent">Referent</a> <a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TypeReference" title="U.Codebase.Reference">TypeReference</a>) -&gt; m (<a href="../base-4.18.2.1/Data-Either.html#t:Either" title="Data.Either">Either</a> <a href="Unison-Merge-DeclCoherencyCheck.html#t:IncoherentDeclReasons" title="Unison.Merge.DeclCoherencyCheck">IncoherentDeclReasons</a> <a href="../unison-core1-0.0.0/Unison-DeclNameLookup.html#t:DeclNameLookup" title="Unison.DeclNameLookup">DeclNameLookup</a>) <a href="src/Unison.Merge.DeclCoherencyCheck.html#checkAllDeclCoherency" class="link">Source</a> <a href="#v:checkAllDeclCoherency" class="selflink">#</a></p><div class="doc"><p>Like <code><a href="Unison-Merge-DeclCoherencyCheck.html#v:checkDeclCoherency" title="Unison.Merge.DeclCoherencyCheck">checkDeclCoherency</a></code>, but returns info about all of the incoherent decls found, not just the first.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>