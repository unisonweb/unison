<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Unison.Merge.Synhash</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">unison-merge-0.0.0</span><ul class="links" id="page-menu"><li><a href="src/Unison.Merge.Synhash.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Unison.Merge.Synhash</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Exported for debugging</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Utilities for computing the &quot;syntactic hash&quot; of a decl or term, which is a hash that is computed after substituting
 references to other terms and decls with names from a pretty-print environment.</p><p>Thus, syntactic hashes can be compared for equality to answer questions like &quot;would these definitions look the same
 when rendered for a human (even if their underlying references are different)?&quot;.</p><p>The merge algorithm currently uses syntactic hashes for determining whether an update was performed by a human, or
 was the result of auto-propagation. (Critically, this cannot handle renames very well). For example, consider
 comparing two definitions on Alice's branch; one old one from somewhere in its history, and one new:</p><p>old namespace        new namespace
   ----------------     ---------------
   foo = #bar + 3       foo = #bar2 + 3</p><p>Either Alice manually updated #bar to #bar2, or else a dependency of #bar was updated, inducing an update to #bar2.
 Computing the syntactic hash can help answer that question. Let's combine a pretty-print environment for the old
 and new namespaces together, substitute references with it, and look again at the terms:</p><p>old namespace        new namespace
   ----------------     ----------------
   foo = helper + 3     foo = helper + 3</p><p>We see now that our pretty-print environment has mapped both #bar and #bar2 to the name &quot;helper&quot;, so each version of
 &quot;foo&quot; would have the same syntactic hash. This indicates (to our merge algorithm) that this was an auto-propagated
 update.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:synhashType">synhashType</a> :: <a href="../unison-core1-0.0.0/Unison-Var.html#t:Var" title="Unison.Var">Var</a> v =&gt; <a href="../unison-parser-typechecker-0.0.0/Unison-PrettyPrintEnv.html#t:PrettyPrintEnv" title="Unison.PrettyPrintEnv">PrettyPrintEnv</a> -&gt; <a href="../unison-core1-0.0.0/Unison-Type.html#t:Type" title="Unison.Type">Type</a> v a -&gt; <a href="../unison-hash-0.0.0/Unison-Hash.html#t:Hash" title="Unison.Hash">Hash</a></li><li class="src short"><a href="#v:synhashTerm">synhashTerm</a> :: <span class="keyword">forall</span> m v a. (<a href="../base-4.18.2.1/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m, <a href="../unison-core1-0.0.0/Unison-Var.html#t:Var" title="Unison.Var">Var</a> v) =&gt; (<a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TermReferenceId" title="U.Codebase.Reference">TermReferenceId</a> -&gt; m (<a href="../unison-core1-0.0.0/Unison-Term.html#t:Term" title="Unison.Term">Term</a> v a)) -&gt; <a href="../unison-parser-typechecker-0.0.0/Unison-PrettyPrintEnv.html#t:PrettyPrintEnv" title="Unison.PrettyPrintEnv">PrettyPrintEnv</a> -&gt; <a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TermReference" title="U.Codebase.Reference">TermReference</a> -&gt; m <a href="../unison-hash-0.0.0/Unison-Hash.html#t:Hash" title="Unison.Hash">Hash</a></li><li class="src short"><a href="#v:synhashBuiltinTerm">synhashBuiltinTerm</a> :: <a href="../foldl-1.4.16/Control-Foldl-Text.html#t:Text" title="Control.Foldl.Text">Text</a> -&gt; <a href="../unison-hash-0.0.0/Unison-Hash.html#t:Hash" title="Unison.Hash">Hash</a></li><li class="src short"><a href="#v:synhashDerivedTerm">synhashDerivedTerm</a> :: <a href="../unison-core1-0.0.0/Unison-Var.html#t:Var" title="Unison.Var">Var</a> v =&gt; <a href="../unison-parser-typechecker-0.0.0/Unison-PrettyPrintEnv.html#t:PrettyPrintEnv" title="Unison.PrettyPrintEnv">PrettyPrintEnv</a> -&gt; <a href="../unison-core1-0.0.0/Unison-Term.html#t:Term" title="Unison.Term">Term</a> v a -&gt; <a href="../unison-hash-0.0.0/Unison-Hash.html#t:Hash" title="Unison.Hash">Hash</a></li><li class="src short"><a href="#v:synhashBuiltinDecl">synhashBuiltinDecl</a> :: <a href="../foldl-1.4.16/Control-Foldl-Text.html#t:Text" title="Control.Foldl.Text">Text</a> -&gt; <a href="../unison-hash-0.0.0/Unison-Hash.html#t:Hash" title="Unison.Hash">Hash</a></li><li class="src short"><a href="#v:synhashDerivedDecl">synhashDerivedDecl</a> :: <a href="../unison-core1-0.0.0/Unison-Var.html#t:Var" title="Unison.Var">Var</a> v =&gt; <a href="../unison-parser-typechecker-0.0.0/Unison-PrettyPrintEnv.html#t:PrettyPrintEnv" title="Unison.PrettyPrintEnv">PrettyPrintEnv</a> -&gt; <a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a> -&gt; <a href="../unison-core1-0.0.0/Unison-DataDeclaration.html#t:Decl" title="Unison.DataDeclaration">Decl</a> v a -&gt; <a href="../unison-hash-0.0.0/Unison-Hash.html#t:Hash" title="Unison.Hash">Hash</a></li><li class="src short"><a href="#v:hashBuiltinTermTokens">hashBuiltinTermTokens</a> :: <a href="../foldl-1.4.16/Control-Foldl-Text.html#t:Text" title="Control.Foldl.Text">Text</a> -&gt; [Token]</li><li class="src short"><a href="#v:hashDerivedTermTokens">hashDerivedTermTokens</a> :: <span class="keyword">forall</span> a v. <a href="../unison-core1-0.0.0/Unison-Var.html#t:Var" title="Unison.Var">Var</a> v =&gt; <a href="../unison-parser-typechecker-0.0.0/Unison-PrettyPrintEnv.html#t:PrettyPrintEnv" title="Unison.PrettyPrintEnv">PrettyPrintEnv</a> -&gt; <a href="../unison-core1-0.0.0/Unison-Term.html#t:Term" title="Unison.Term">Term</a> v a -&gt; [Token]</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:synhashType" class="def">synhashType</a> :: <a href="../unison-core1-0.0.0/Unison-Var.html#t:Var" title="Unison.Var">Var</a> v =&gt; <a href="../unison-parser-typechecker-0.0.0/Unison-PrettyPrintEnv.html#t:PrettyPrintEnv" title="Unison.PrettyPrintEnv">PrettyPrintEnv</a> -&gt; <a href="../unison-core1-0.0.0/Unison-Type.html#t:Type" title="Unison.Type">Type</a> v a -&gt; <a href="../unison-hash-0.0.0/Unison-Hash.html#t:Hash" title="Unison.Hash">Hash</a> <a href="src/Unison.Merge.Synhash.html#synhashType" class="link">Source</a> <a href="#v:synhashType" class="selflink">#</a></p><div class="doc"><p>Syntactically hash a type, using reference names rather than hashes.
 Two types will have the same syntactic hash if they would
 print the the same way under the given pretty-print env.</p></div></div><div class="top"><p class="src"><a id="v:synhashTerm" class="def">synhashTerm</a> :: <span class="keyword">forall</span> m v a. (<a href="../base-4.18.2.1/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m, <a href="../unison-core1-0.0.0/Unison-Var.html#t:Var" title="Unison.Var">Var</a> v) =&gt; (<a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TermReferenceId" title="U.Codebase.Reference">TermReferenceId</a> -&gt; m (<a href="../unison-core1-0.0.0/Unison-Term.html#t:Term" title="Unison.Term">Term</a> v a)) -&gt; <a href="../unison-parser-typechecker-0.0.0/Unison-PrettyPrintEnv.html#t:PrettyPrintEnv" title="Unison.PrettyPrintEnv">PrettyPrintEnv</a> -&gt; <a href="../unison-core-0.0.0/U-Codebase-Reference.html#t:TermReference" title="U.Codebase.Reference">TermReference</a> -&gt; m <a href="../unison-hash-0.0.0/Unison-Hash.html#t:Hash" title="Unison.Hash">Hash</a> <a href="src/Unison.Merge.Synhash.html#synhashTerm" class="link">Source</a> <a href="#v:synhashTerm" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:synhashBuiltinTerm" class="def">synhashBuiltinTerm</a> :: <a href="../foldl-1.4.16/Control-Foldl-Text.html#t:Text" title="Control.Foldl.Text">Text</a> -&gt; <a href="../unison-hash-0.0.0/Unison-Hash.html#t:Hash" title="Unison.Hash">Hash</a> <a href="src/Unison.Merge.Synhash.html#synhashBuiltinTerm" class="link">Source</a> <a href="#v:synhashBuiltinTerm" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:synhashDerivedTerm" class="def">synhashDerivedTerm</a> :: <a href="../unison-core1-0.0.0/Unison-Var.html#t:Var" title="Unison.Var">Var</a> v =&gt; <a href="../unison-parser-typechecker-0.0.0/Unison-PrettyPrintEnv.html#t:PrettyPrintEnv" title="Unison.PrettyPrintEnv">PrettyPrintEnv</a> -&gt; <a href="../unison-core1-0.0.0/Unison-Term.html#t:Term" title="Unison.Term">Term</a> v a -&gt; <a href="../unison-hash-0.0.0/Unison-Hash.html#t:Hash" title="Unison.Hash">Hash</a> <a href="src/Unison.Merge.Synhash.html#synhashDerivedTerm" class="link">Source</a> <a href="#v:synhashDerivedTerm" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:synhashBuiltinDecl" class="def">synhashBuiltinDecl</a> :: <a href="../foldl-1.4.16/Control-Foldl-Text.html#t:Text" title="Control.Foldl.Text">Text</a> -&gt; <a href="../unison-hash-0.0.0/Unison-Hash.html#t:Hash" title="Unison.Hash">Hash</a> <a href="src/Unison.Merge.Synhash.html#synhashBuiltinDecl" class="link">Source</a> <a href="#v:synhashBuiltinDecl" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:synhashDerivedDecl" class="def">synhashDerivedDecl</a> :: <a href="../unison-core1-0.0.0/Unison-Var.html#t:Var" title="Unison.Var">Var</a> v =&gt; <a href="../unison-parser-typechecker-0.0.0/Unison-PrettyPrintEnv.html#t:PrettyPrintEnv" title="Unison.PrettyPrintEnv">PrettyPrintEnv</a> -&gt; <a href="../unison-core1-0.0.0/Unison-Name-Internal.html#t:Name" title="Unison.Name.Internal">Name</a> -&gt; <a href="../unison-core1-0.0.0/Unison-DataDeclaration.html#t:Decl" title="Unison.DataDeclaration">Decl</a> v a -&gt; <a href="../unison-hash-0.0.0/Unison-Hash.html#t:Hash" title="Unison.Hash">Hash</a> <a href="src/Unison.Merge.Synhash.html#synhashDerivedDecl" class="link">Source</a> <a href="#v:synhashDerivedDecl" class="selflink">#</a></p><div class="doc"><p>Syntactically hash a decl, using reference names rather than hashes. Two decls will have the same syntactic hash if
 they they are the same sort of decl (both are data decls or both are effect decls), the unique type guid is the same,
 the constructors appear in the same order and have the same names, and the constructors' types have the same
 syntactic hashes.</p></div></div><a href="#g:1" id="g:1"><h1>Exported for debugging</h1></a><div class="top"><p class="src"><a id="v:hashBuiltinTermTokens" class="def">hashBuiltinTermTokens</a> :: <a href="../foldl-1.4.16/Control-Foldl-Text.html#t:Text" title="Control.Foldl.Text">Text</a> -&gt; [Token] <a href="src/Unison.Merge.Synhash.html#hashBuiltinTermTokens" class="link">Source</a> <a href="#v:hashBuiltinTermTokens" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:hashDerivedTermTokens" class="def">hashDerivedTermTokens</a> :: <span class="keyword">forall</span> a v. <a href="../unison-core1-0.0.0/Unison-Var.html#t:Var" title="Unison.Var">Var</a> v =&gt; <a href="../unison-parser-typechecker-0.0.0/Unison-PrettyPrintEnv.html#t:PrettyPrintEnv" title="Unison.PrettyPrintEnv">PrettyPrintEnv</a> -&gt; <a href="../unison-core1-0.0.0/Unison-Term.html#t:Term" title="Unison.Term">Term</a> v a -&gt; [Token] <a href="src/Unison.Merge.Synhash.html#hashDerivedTermTokens" class="link">Source</a> <a href="#v:hashDerivedTermTokens" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>