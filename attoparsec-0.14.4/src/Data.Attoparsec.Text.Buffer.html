<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns, CPP, MagicHash, RankNTypes, RecordWildCards,
    UnboxedTuples #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Module      :  Data.Attoparsec.Text.Buffer</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Copyright   :  Bryan O'Sullivan 2007-2015</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- License     :  BSD3</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Maintainer  :  bos@serpentine.com</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Stability   :  experimental</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- Portability :  GHC</span><span>
</span><span id="line-12"></span><span class="hs-comment">--</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- An immutable buffer that supports cheap appends.</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-comment">-- A Buffer is divided into an immutable read-only zone, followed by a</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- mutable area that we've preallocated, but not yet written to.</span><span>
</span><span id="line-17"></span><span class="hs-comment">--</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- We overallocate at the end of a Buffer so that we can cheaply</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- append.  Since a user of an existing Buffer cannot see past the end</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- of its immutable zone into the data that will change during an</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- append, this is safe.</span><span>
</span><span id="line-22"></span><span class="hs-comment">--</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- Once we run out of space at the end of a Buffer, we do the usual</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- doubling of the buffer size.</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.Attoparsec.Text.Buffer</span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">(</span><span>
</span><span id="line-28"></span><span>      </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buffer"><span class="hs-identifier">Buffer</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#buffer"><span class="hs-identifier">buffer</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#unbuffer"><span class="hs-identifier">unbuffer</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#unbufferAt"><span class="hs-identifier">unbufferAt</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#length"><span class="hs-identifier">length</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#pappend"><span class="hs-identifier">pappend</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#iter"><span class="hs-identifier">iter</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#iter_"><span class="hs-identifier">iter_</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#substring"><span class="hs-identifier">substring</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#lengthCodeUnits"><span class="hs-identifier">lengthCodeUnits</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#dropCodeUnits"><span class="hs-identifier">dropCodeUnits</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">assert</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldl1'</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Mon</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Monoid</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Semigroup</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Internal</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#if MIN_VERSION_text(2,0,0)
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Internal.Encoding.Utf8</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">utf8LengthByLeader</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Unsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">iterArray</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">lengthWord8</span></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Bits</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">shiftR</span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Text.Internal.Encoding.Utf16</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">chr2</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Text.Internal.Unsafe.Char</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeChr</span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Text.Unsafe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">lengthWord16</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Unsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Iter</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.Storable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">sizeOf</span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Exts</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Int</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">indexIntArray#</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unsafeCoerce#</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">writeIntArray#</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.ST</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ST</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runST</span></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">length</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Array</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-comment">-- If _cap is zero, this buffer is empty.</span><span>
</span><span id="line-64"></span><span class="hs-keyword">data</span><span> </span><span id="Buffer"><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buffer"><span class="hs-identifier hs-var">Buffer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Buf"><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buf"><span class="hs-identifier hs-var">Buf</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-65"></span><span>      </span><span id="_arr"><span class="annot"><span class="annottext">Buffer -&gt; Array
</span><a href="Data.Attoparsec.Text.Buffer.html#_arr"><span class="hs-identifier hs-var hs-var">_arr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">A.Array</span></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_off"><span class="annot"><span class="annottext">Buffer -&gt; Int
</span><a href="Data.Attoparsec.Text.Buffer.html#_off"><span class="hs-identifier hs-var hs-var">_off</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_len"><span class="annot"><span class="annottext">Buffer -&gt; Int
</span><a href="Data.Attoparsec.Text.Buffer.html#_len"><span class="hs-identifier hs-var hs-var">_len</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_cap"><span class="annot"><span class="annottext">Buffer -&gt; Int
</span><a href="Data.Attoparsec.Text.Buffer.html#_cap"><span class="hs-identifier hs-var hs-var">_cap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_gen"><span class="annot"><span class="annottext">Buffer -&gt; Int
</span><a href="Data.Attoparsec.Text.Buffer.html#_gen"><span class="hs-identifier hs-var hs-var">_gen</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679046005"><span id="local-6989586621679046009"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-73"></span><span>    </span><span id="local-6989586621679046014"><span class="annot"><span class="annottext">showsPrec :: Int -&gt; Buffer -&gt; ShowS
</span><a href="#local-6989586621679046014"><span class="hs-identifier hs-var hs-var hs-var hs-var">showsPrec</span></a></span></span><span> </span><span id="local-6989586621679046016"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046016"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; ShowS
forall a. Show a =&gt; Int -&gt; a -&gt; ShowS
</span><span class="hs-identifier hs-var">showsPrec</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046016"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ShowS) -&gt; (Buffer -&gt; Text) -&gt; Buffer -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Buffer -&gt; Text
</span><a href="Data.Attoparsec.Text.Buffer.html#unbuffer"><span class="hs-identifier hs-var">unbuffer</span></a></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-comment">-- | The initial 'Buffer' has no mutable zone, so we can avoid all</span><span>
</span><span id="line-76"></span><span class="hs-comment">-- copies in the (hopefully) common case of no further input being fed</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- to us.</span><span>
</span><span id="line-78"></span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#buffer"><span class="hs-identifier hs-type">buffer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span>
</span><span id="line-79"></span><span id="buffer"><span class="annot"><span class="annottext">buffer :: Text -&gt; Buffer
</span><a href="Data.Attoparsec.Text.Buffer.html#buffer"><span class="hs-identifier hs-var hs-var">buffer</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span id="local-6989586621679046019"><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046019"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span id="local-6989586621679046020"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046020"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span id="local-6989586621679046021"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046021"><span class="hs-identifier hs-var">len</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array -&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; Buffer
</span><a href="Data.Attoparsec.Text.Buffer.html#Buf"><span class="hs-identifier hs-var">Buf</span></a></span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046019"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046020"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046021"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046021"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#unbuffer"><span class="hs-identifier hs-type">unbuffer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-82"></span><span id="unbuffer"><span class="annot"><span class="annottext">unbuffer :: Buffer -&gt; Text
</span><a href="Data.Attoparsec.Text.Buffer.html#unbuffer"><span class="hs-identifier hs-var hs-var">unbuffer</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buf"><span class="hs-identifier hs-type">Buf</span></a></span><span> </span><span id="local-6989586621679046022"><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046022"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span id="local-6989586621679046023"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046023"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span id="local-6989586621679046024"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046024"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array -&gt; Int -&gt; Int -&gt; Text
</span><span class="hs-identifier hs-var">Text</span></span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046022"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046023"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046024"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#unbufferAt"><span class="hs-identifier hs-type">unbufferAt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-85"></span><span id="unbufferAt"><span class="annot"><span class="annottext">unbufferAt :: Int -&gt; Buffer -&gt; Text
</span><a href="Data.Attoparsec.Text.Buffer.html#unbufferAt"><span class="hs-identifier hs-var hs-var">unbufferAt</span></a></span></span><span> </span><span id="local-6989586621679046025"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046025"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buf"><span class="hs-identifier hs-type">Buf</span></a></span><span> </span><span id="local-6989586621679046026"><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046026"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span id="local-6989586621679046027"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046027"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span id="local-6989586621679046028"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046028"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Text -&gt; Text
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046025"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046025"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046028"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><span class="annottext">Array -&gt; Int -&gt; Int -&gt; Text
</span><span class="hs-identifier hs-var">Text</span></span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046026"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046027"><span class="hs-identifier hs-var">off</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046025"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046028"><span class="hs-identifier hs-var">len</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046025"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679046034"><span id="local-6989586621679046038"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buf"><span class="hs-identifier hs-type">Buf</span></a></span><span> </span><span class="annot"><span class="annottext">Array
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679046047"><span class="annot"><span class="annottext">&lt;&gt; :: Buffer -&gt; Buffer -&gt; Buffer
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span id="local-6989586621679046048"><span class="annot"><span class="annottext">Buffer
</span><a href="#local-6989586621679046048"><span class="hs-identifier hs-var">b</span></a></span></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Buffer
</span><a href="#local-6989586621679046048"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span id="local-6989586621679046049"><span class="annot"><span class="annottext">Buffer
</span><a href="#local-6989586621679046049"><span class="hs-identifier hs-var">a</span></a></span></span><span>               </span><span class="annot"><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buf"><span class="hs-identifier hs-type">Buf</span></a></span><span> </span><span class="annot"><span class="annottext">Array
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Buffer
</span><a href="#local-6989586621679046049"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-92"></span><span>    </span><span id="local-6989586621679046050"><span class="annot"><span class="annottext">Buffer
</span><a href="#local-6989586621679046050"><span class="hs-identifier hs-var">buf</span></a></span></span><span>             </span><span class="annot"><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buf"><span class="hs-identifier hs-type">Buf</span></a></span><span> </span><span id="local-6989586621679046051"><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046051"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span id="local-6989586621679046052"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046052"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span id="local-6989586621679046053"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046053"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Buffer -&gt; Array -&gt; Int -&gt; Int -&gt; Buffer
</span><a href="Data.Attoparsec.Text.Buffer.html#append"><span class="hs-identifier hs-var">append</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer
</span><a href="#local-6989586621679046050"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046051"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046052"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046053"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">&lt;&gt;</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-96"></span><span>    </span><span id="local-6989586621679046062"><span class="annot"><span class="annottext">mempty :: Buffer
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array -&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; Buffer
</span><a href="Data.Attoparsec.Text.Buffer.html#Buf"><span class="hs-identifier hs-var">Buf</span></a></span><span> </span><span class="annot"><span class="annottext">Array
</span><span class="hs-identifier hs-var">A.empty</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">mempty</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span>    </span><span id="local-6989586621679046065"><span class="annot"><span class="annottext">mappend :: Buffer -&gt; Buffer -&gt; Buffer
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mappend</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Buffer -&gt; Buffer -&gt; Buffer
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>    </span><span id="local-6989586621679046070"><span class="annot"><span class="annottext">mconcat :: [Buffer] -&gt; Buffer
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mconcat</span></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Buffer
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">Mon.mempty</span></span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span id="local-6989586621679046071"><span class="annot"><span class="annottext">[Buffer]
</span><a href="#local-6989586621679046071"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Buffer -&gt; Buffer -&gt; Buffer) -&gt; [Buffer] -&gt; Buffer
forall a. (?callStack::CallStack) =&gt; (a -&gt; a -&gt; a) -&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">foldl1'</span></span><span> </span><span class="annot"><span class="annottext">Buffer -&gt; Buffer -&gt; Buffer
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">[Buffer]
</span><a href="#local-6989586621679046071"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#pappend"><span class="hs-identifier hs-type">pappend</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span>
</span><span id="line-105"></span><span id="pappend"><span class="annot"><span class="annottext">pappend :: Buffer -&gt; Text -&gt; Buffer
</span><a href="Data.Attoparsec.Text.Buffer.html#pappend"><span class="hs-identifier hs-var hs-var">pappend</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buf"><span class="hs-identifier hs-type">Buf</span></a></span><span> </span><span class="annot"><span class="annottext">Array
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679046072"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679046072"><span class="hs-identifier hs-var">t</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Buffer
</span><a href="Data.Attoparsec.Text.Buffer.html#buffer"><span class="hs-identifier hs-var">buffer</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679046072"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-106"></span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#pappend"><span class="hs-identifier hs-var">pappend</span></a></span><span> </span><span id="local-6989586621679046073"><span class="annot"><span class="annottext">Buffer
</span><a href="#local-6989586621679046073"><span class="hs-identifier hs-var">buf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span id="local-6989586621679046074"><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046074"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span id="local-6989586621679046075"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046075"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span id="local-6989586621679046076"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046076"><span class="hs-identifier hs-var">len</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Buffer -&gt; Array -&gt; Int -&gt; Int -&gt; Buffer
</span><a href="Data.Attoparsec.Text.Buffer.html#append"><span class="hs-identifier hs-var">append</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer
</span><a href="#local-6989586621679046073"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046074"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046075"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046076"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#append"><span class="hs-identifier hs-type">append</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Array</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span>
</span><span id="line-109"></span><span id="append"><span class="annot"><span class="annottext">append :: Buffer -&gt; Array -&gt; Int -&gt; Int -&gt; Buffer
</span><a href="Data.Attoparsec.Text.Buffer.html#append"><span class="hs-identifier hs-var hs-var">append</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buf"><span class="hs-identifier hs-type">Buf</span></a></span><span> </span><span id="local-6989586621679046077"><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046077"><span class="hs-identifier hs-var">arr0</span></a></span></span><span> </span><span id="local-6989586621679046078"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046078"><span class="hs-identifier hs-var">off0</span></a></span></span><span> </span><span id="local-6989586621679046079"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046079"><span class="hs-identifier hs-var">len0</span></a></span></span><span> </span><span id="local-6989586621679046080"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046080"><span class="hs-identifier hs-var">cap0</span></a></span></span><span> </span><span id="local-6989586621679046081"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046081"><span class="hs-identifier hs-var">gen0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679046082"><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046082"><span class="hs-identifier hs-var">arr1</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679046083"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046083"><span class="hs-identifier hs-var">off1</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679046084"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046084"><span class="hs-identifier hs-var">len1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall s. ST s Buffer) -&gt; Buffer
forall a. (forall s. ST s a) -&gt; a
</span><span class="hs-identifier hs-var">runST</span></span><span> </span><span class="annot"><span class="annottext">((forall s. ST s Buffer) -&gt; Buffer)
-&gt; (forall s. ST s Buffer) -&gt; Buffer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#if MIN_VERSION_text(2,0,0)
</span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679046104"><span class="annot"><span class="annottext">woff :: Int
</span><a href="#local-6989586621679046104"><span class="hs-identifier hs-var hs-var">woff</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Storable a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">sizeOf</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">::</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">woff</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">sizeOf</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-glyph">::</span><span class="hs-identifier">Int</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">shiftR</span><span class="hs-special">`</span><span> </span><span class="hs-number">1</span><span class="hs-cpp">
#endif
</span><span>      </span><span id="local-6989586621679046106"><span class="annot"><span class="annottext">newlen :: Int
</span><a href="#local-6989586621679046106"><span class="hs-identifier hs-var hs-var">newlen</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046079"><span class="hs-identifier hs-var">len0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046084"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-116"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621679046110"><span class="annot"><span class="annottext">gen :: Int
</span><a href="#local-6989586621679046110"><span class="hs-identifier hs-var hs-var">gen</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046081"><span class="hs-identifier hs-var">gen0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Array -&gt; Int
</span><a href="Data.Attoparsec.Text.Buffer.html#readGen"><span class="hs-identifier hs-var">readGen</span></a></span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046077"><span class="hs-identifier hs-var">arr0</span></a></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046110"><span class="hs-identifier hs-var">gen</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046081"><span class="hs-identifier hs-var">gen0</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046106"><span class="hs-identifier hs-var">newlen</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046080"><span class="hs-identifier hs-var">cap0</span></a></span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-119"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679046114"><span class="annot"><span class="annottext">newgen :: Int
</span><a href="#local-6989586621679046114"><span class="hs-identifier hs-var hs-var">newgen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046110"><span class="hs-identifier hs-var">gen</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-120"></span><span>      </span><span id="local-6989586621679046115"><span class="annot"><span class="annottext">MArray s
</span><a href="#local-6989586621679046115"><span class="hs-identifier hs-var">marr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Array -&gt; ST s (MArray s)
forall s. Array -&gt; ST s (MArray s)
</span><a href="Data.Attoparsec.Text.Buffer.html#unsafeThaw"><span class="hs-identifier hs-var">unsafeThaw</span></a></span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046077"><span class="hs-identifier hs-var">arr0</span></a></span><span>
</span><span id="line-121"></span><span>      </span><span class="annot"><span class="annottext">MArray s -&gt; Int -&gt; ST s ()
forall s. MArray s -&gt; Int -&gt; ST s ()
</span><a href="Data.Attoparsec.Text.Buffer.html#writeGen"><span class="hs-identifier hs-var">writeGen</span></a></span><span> </span><span class="annot"><span class="annottext">MArray s
</span><a href="#local-6989586621679046115"><span class="hs-identifier hs-var">marr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046114"><span class="hs-identifier hs-var">newgen</span></a></span><span class="hs-cpp">
#if MIN_VERSION_text(2,0,0)
</span><span>      </span><span class="annot"><span class="annottext">Int -&gt; MArray s -&gt; Int -&gt; Array -&gt; Int -&gt; ST s ()
forall s. Int -&gt; MArray s -&gt; Int -&gt; Array -&gt; Int -&gt; ST s ()
</span><span class="hs-identifier hs-var">A.copyI</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046084"><span class="hs-identifier hs-var">len1</span></a></span><span> </span><span class="annot"><span class="annottext">MArray s
</span><a href="#local-6989586621679046115"><span class="hs-identifier hs-var">marr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046078"><span class="hs-identifier hs-var">off0</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046079"><span class="hs-identifier hs-var">len0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046082"><span class="hs-identifier hs-var">arr1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046083"><span class="hs-identifier hs-var">off1</span></a></span><span class="hs-cpp">
#else
</span><span>      </span><span class="hs-identifier">A.copyI</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">off0</span><span class="hs-operator">+</span><span class="hs-identifier">len0</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">arr1</span><span> </span><span class="hs-identifier">off1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">off0</span><span class="hs-operator">+</span><span class="hs-identifier">newlen</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>      </span><span id="local-6989586621679046119"><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046119"><span class="hs-identifier hs-var">arr2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MArray s -&gt; ST s Array
forall s. MArray s -&gt; ST s Array
</span><span class="hs-identifier hs-var">A.unsafeFreeze</span></span><span> </span><span class="annot"><span class="annottext">MArray s
</span><a href="#local-6989586621679046115"><span class="hs-identifier hs-var">marr</span></a></span><span>
</span><span id="line-128"></span><span>      </span><span class="annot"><span class="annottext">Buffer -&gt; ST s Buffer
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array -&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; Buffer
</span><a href="Data.Attoparsec.Text.Buffer.html#Buf"><span class="hs-identifier hs-var">Buf</span></a></span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046119"><span class="hs-identifier hs-var">arr2</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046078"><span class="hs-identifier hs-var">off0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046106"><span class="hs-identifier hs-var">newlen</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046080"><span class="hs-identifier hs-var">cap0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046114"><span class="hs-identifier hs-var">newgen</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-130"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679046123"><span class="annot"><span class="annottext">newcap :: Int
</span><a href="#local-6989586621679046123"><span class="hs-identifier hs-var hs-var">newcap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046106"><span class="hs-identifier hs-var">newlen</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-131"></span><span>          </span><span id="local-6989586621679046126"><span class="annot"><span class="annottext">newgen :: Int
</span><a href="#local-6989586621679046126"><span class="hs-identifier hs-var hs-var">newgen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-132"></span><span>      </span><span id="local-6989586621679046127"><span class="annot"><span class="annottext">MArray s
</span><a href="#local-6989586621679046127"><span class="hs-identifier hs-var">marr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (MArray s)
forall s. Int -&gt; ST s (MArray s)
</span><span class="hs-identifier hs-var">A.new</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046123"><span class="hs-identifier hs-var">newcap</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046104"><span class="hs-identifier hs-var">woff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>      </span><span class="annot"><span class="annottext">MArray s -&gt; Int -&gt; ST s ()
forall s. MArray s -&gt; Int -&gt; ST s ()
</span><a href="Data.Attoparsec.Text.Buffer.html#writeGen"><span class="hs-identifier hs-var">writeGen</span></a></span><span> </span><span class="annot"><span class="annottext">MArray s
</span><a href="#local-6989586621679046127"><span class="hs-identifier hs-var">marr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046126"><span class="hs-identifier hs-var">newgen</span></a></span><span class="hs-cpp">
#if MIN_VERSION_text(2,0,0)
</span><span>      </span><span class="annot"><span class="annottext">Int -&gt; MArray s -&gt; Int -&gt; Array -&gt; Int -&gt; ST s ()
forall s. Int -&gt; MArray s -&gt; Int -&gt; Array -&gt; Int -&gt; ST s ()
</span><span class="hs-identifier hs-var">A.copyI</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046079"><span class="hs-identifier hs-var">len0</span></a></span><span> </span><span class="annot"><span class="annottext">MArray s
</span><a href="#local-6989586621679046127"><span class="hs-identifier hs-var">marr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046104"><span class="hs-identifier hs-var">woff</span></a></span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046077"><span class="hs-identifier hs-var">arr0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046078"><span class="hs-identifier hs-var">off0</span></a></span><span>
</span><span id="line-136"></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; MArray s -&gt; Int -&gt; Array -&gt; Int -&gt; ST s ()
forall s. Int -&gt; MArray s -&gt; Int -&gt; Array -&gt; Int -&gt; ST s ()
</span><span class="hs-identifier hs-var">A.copyI</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046084"><span class="hs-identifier hs-var">len1</span></a></span><span> </span><span class="annot"><span class="annottext">MArray s
</span><a href="#local-6989586621679046127"><span class="hs-identifier hs-var">marr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046104"><span class="hs-identifier hs-var">woff</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046079"><span class="hs-identifier hs-var">len0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046082"><span class="hs-identifier hs-var">arr1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046083"><span class="hs-identifier hs-var">off1</span></a></span><span class="hs-cpp">
#else
</span><span>      </span><span class="hs-identifier">A.copyI</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-identifier">woff</span><span> </span><span class="hs-identifier">arr0</span><span> </span><span class="hs-identifier">off0</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">woff</span><span class="hs-operator">+</span><span class="hs-identifier">len0</span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>      </span><span class="hs-identifier">A.copyI</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">woff</span><span class="hs-operator">+</span><span class="hs-identifier">len0</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">arr1</span><span> </span><span class="hs-identifier">off1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">woff</span><span class="hs-operator">+</span><span class="hs-identifier">newlen</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>      </span><span id="local-6989586621679046129"><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046129"><span class="hs-identifier hs-var">arr2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MArray s -&gt; ST s Array
forall s. MArray s -&gt; ST s Array
</span><span class="hs-identifier hs-var">A.unsafeFreeze</span></span><span> </span><span class="annot"><span class="annottext">MArray s
</span><a href="#local-6989586621679046127"><span class="hs-identifier hs-var">marr</span></a></span><span>
</span><span id="line-142"></span><span>      </span><span class="annot"><span class="annottext">Buffer -&gt; ST s Buffer
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array -&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; Buffer
</span><a href="Data.Attoparsec.Text.Buffer.html#Buf"><span class="hs-identifier hs-var">Buf</span></a></span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046129"><span class="hs-identifier hs-var">arr2</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046104"><span class="hs-identifier hs-var">woff</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046106"><span class="hs-identifier hs-var">newlen</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046123"><span class="hs-identifier hs-var">newcap</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046126"><span class="hs-identifier hs-var">newgen</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#length"><span class="hs-identifier hs-type">length</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-145"></span><span id="length"><span class="annot"><span class="annottext">length :: Buffer -&gt; Int
</span><a href="Data.Attoparsec.Text.Buffer.html#length"><span class="hs-identifier hs-var hs-var">length</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buf"><span class="hs-identifier hs-type">Buf</span></a></span><span> </span><span class="annot"><span class="annottext">Array
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679046130"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046130"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046130"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-146"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#length"><span class="hs-pragma hs-type">length</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#substring"><span class="hs-identifier hs-type">substring</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-149"></span><span id="substring"><span class="annot"><span class="annottext">substring :: Int -&gt; Int -&gt; Buffer -&gt; Text
</span><a href="Data.Attoparsec.Text.Buffer.html#substring"><span class="hs-identifier hs-var hs-var">substring</span></a></span></span><span> </span><span id="local-6989586621679046131"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046131"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679046132"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046132"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buf"><span class="hs-identifier hs-type">Buf</span></a></span><span> </span><span id="local-6989586621679046133"><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046133"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span id="local-6989586621679046134"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046134"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span id="local-6989586621679046135"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046135"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Text -&gt; Text
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046131"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046131"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046135"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (Text -&gt; Text) -&gt; Text -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>
</span><span id="line-151"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Text -&gt; Text
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046132"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046132"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046135"><span class="hs-identifier hs-var">len</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046131"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-152"></span><span>  </span><span class="annot"><span class="annottext">Array -&gt; Int -&gt; Int -&gt; Text
</span><span class="hs-identifier hs-var">Text</span></span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046133"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046134"><span class="hs-identifier hs-var">off</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046131"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046132"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-153"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#substring"><span class="hs-pragma hs-type">substring</span></a></span><span> </span><span class="hs-pragma">#-}</span><span class="hs-cpp">

#if MIN_VERSION_text(2,0,0)
</span><span>
</span><span id="line-157"></span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#lengthCodeUnits"><span class="hs-identifier hs-type">lengthCodeUnits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-158"></span><span id="lengthCodeUnits"><span class="annot"><span class="annottext">lengthCodeUnits :: Text -&gt; Int
</span><a href="Data.Attoparsec.Text.Buffer.html#lengthCodeUnits"><span class="hs-identifier hs-var hs-var">lengthCodeUnits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Int
</span><span class="hs-identifier hs-var">lengthWord8</span></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#dropCodeUnits"><span class="hs-identifier hs-type">dropCodeUnits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-161"></span><span id="dropCodeUnits"><span class="annot"><span class="annottext">dropCodeUnits :: Int -&gt; Buffer -&gt; Text
</span><a href="Data.Attoparsec.Text.Buffer.html#dropCodeUnits"><span class="hs-identifier hs-var hs-var">dropCodeUnits</span></a></span></span><span> </span><span id="local-6989586621679046136"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046136"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buf"><span class="hs-identifier hs-type">Buf</span></a></span><span> </span><span id="local-6989586621679046137"><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046137"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span id="local-6989586621679046138"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046138"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span id="local-6989586621679046139"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046139"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-162"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Text -&gt; Text
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046136"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046136"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046139"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><span class="annottext">Array -&gt; Int -&gt; Int -&gt; Text
</span><span class="hs-identifier hs-var">Text</span></span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046137"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046138"><span class="hs-identifier hs-var">off</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046136"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046139"><span class="hs-identifier hs-var">len</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046136"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#dropCodeUnits"><span class="hs-pragma hs-type">dropCodeUnits</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-comment">-- | /O(1)/ Iterate (unsafely) one step forwards through a UTF-8</span><span>
</span><span id="line-167"></span><span class="hs-comment">-- array, returning the current character and the delta to add to give</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- the next offset to iterate at.</span><span>
</span><span id="line-169"></span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#iter"><span class="hs-identifier hs-type">iter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Iter</span></span><span>
</span><span id="line-170"></span><span id="iter"><span class="annot"><span class="annottext">iter :: Buffer -&gt; Int -&gt; Iter
</span><a href="Data.Attoparsec.Text.Buffer.html#iter"><span class="hs-identifier hs-var hs-var">iter</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buf"><span class="hs-identifier hs-type">Buf</span></a></span><span> </span><span id="local-6989586621679046140"><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046140"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span id="local-6989586621679046141"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046141"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679046142"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046142"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array -&gt; Int -&gt; Iter
</span><span class="hs-identifier hs-var">iterArray</span></span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046140"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046141"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046142"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#iter"><span class="hs-pragma hs-type">iter</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-comment">-- | /O(1)/ Iterate one step through a UTF-8 array, returning the</span><span>
</span><span id="line-174"></span><span class="hs-comment">-- delta to add to give the next offset to iterate at.</span><span>
</span><span id="line-175"></span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#iter_"><span class="hs-identifier hs-type">iter_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-176"></span><span id="iter_"><span class="annot"><span class="annottext">iter_ :: Buffer -&gt; Int -&gt; Int
</span><a href="Data.Attoparsec.Text.Buffer.html#iter_"><span class="hs-identifier hs-var hs-var">iter_</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#Buf"><span class="hs-identifier hs-type">Buf</span></a></span><span> </span><span id="local-6989586621679046143"><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046143"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span id="local-6989586621679046144"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046144"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679046145"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046145"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Int
</span><span class="hs-identifier hs-var">utf8LengthByLeader</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Int) -&gt; Word8 -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Array -&gt; Int -&gt; Word8
</span><span class="hs-identifier hs-var">A.unsafeIndex</span></span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679046143"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046144"><span class="hs-identifier hs-var">off</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046145"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#iter_"><span class="hs-pragma hs-type">iter_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span id="local-6989586621679045928"><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#unsafeThaw"><span class="hs-identifier hs-type">unsafeThaw</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Array</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679045928"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">A.MArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679045928"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-180"></span><span id="unsafeThaw"><span class="annot"><span class="annottext">unsafeThaw :: forall s. Array -&gt; ST s (MArray s)
</span><a href="Data.Attoparsec.Text.Buffer.html#unsafeThaw"><span class="hs-identifier hs-var hs-var">unsafeThaw</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">A.ByteArray</span></span><span> </span><span id="local-6989586621679046148"><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621679046148"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STRep s (MArray s) -&gt; ST s (MArray s)
forall s a. STRep s a -&gt; ST s a
</span><span class="hs-identifier hs-var">ST</span></span><span> </span><span class="annot"><span class="annottext">(STRep s (MArray s) -&gt; ST s (MArray s))
-&gt; STRep s (MArray s) -&gt; ST s (MArray s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679046150"><span class="annot"><span class="annottext">State# s
</span><a href="#local-6989586621679046150"><span class="hs-identifier hs-var">s#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-181"></span><span>                          </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# s
</span><a href="#local-6989586621679046150"><span class="hs-identifier hs-var">s#</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MutableByteArray# s -&gt; MArray s
forall s. MutableByteArray# s -&gt; MArray s
</span><span class="hs-identifier hs-var">A.MutableByteArray</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteArray# -&gt; MutableByteArray# s
forall a b. a -&gt; b
</span><span class="hs-identifier hs-var">unsafeCoerce#</span></span><span> </span><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621679046148"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#readGen"><span class="hs-identifier hs-type">readGen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Array</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-184"></span><span id="readGen"><span class="annot"><span class="annottext">readGen :: Array -&gt; Int
</span><a href="Data.Attoparsec.Text.Buffer.html#readGen"><span class="hs-identifier hs-var hs-var">readGen</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">A.ByteArray</span></span><span> </span><span id="local-6989586621679046152"><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621679046152"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteArray# -&gt; Int# -&gt; Int#
</span><span class="hs-identifier hs-var">indexIntArray#</span></span><span> </span><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621679046152"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="hs-keyword">of</span><span> </span><span id="local-6989586621679046153"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679046153"><span class="hs-identifier hs-var">r#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int
</span><span class="hs-identifier hs-var">I#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679046153"><span class="hs-identifier hs-var">r#</span></a></span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span id="local-6989586621679045929"><span class="annot"><a href="Data.Attoparsec.Text.Buffer.html#writeGen"><span class="hs-identifier hs-type">writeGen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.MArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679045929"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679045929"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-187"></span><span id="writeGen"><span class="annot"><span class="annottext">writeGen :: forall s. MArray s -&gt; Int -&gt; ST s ()
</span><a href="Data.Attoparsec.Text.Buffer.html#writeGen"><span class="hs-identifier hs-var hs-var">writeGen</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">A.MutableByteArray</span></span><span> </span><span id="local-6989586621679046154"><span class="annot"><span class="annottext">MutableByteArray# s
</span><a href="#local-6989586621679046154"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621679046155"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679046155"><span class="hs-identifier hs-var">gen#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STRep s () -&gt; ST s ()
forall s a. STRep s a -&gt; ST s a
</span><span class="hs-identifier hs-var">ST</span></span><span> </span><span class="annot"><span class="annottext">(STRep s () -&gt; ST s ()) -&gt; STRep s () -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679046156"><span class="annot"><span class="annottext">State# s
</span><a href="#local-6989586621679046156"><span class="hs-identifier hs-var">s0#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MutableByteArray# s -&gt; Int# -&gt; Int# -&gt; State# s -&gt; State# s
forall d.
MutableByteArray# d -&gt; Int# -&gt; Int# -&gt; State# d -&gt; State# d
</span><span class="hs-identifier hs-var">writeIntArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray# s
</span><a href="#local-6989586621679046154"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679046155"><span class="hs-identifier hs-var">gen#</span></a></span><span> </span><span class="annot"><span class="annottext">State# s
</span><a href="#local-6989586621679046156"><span class="hs-identifier hs-var">s0#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-189"></span><span>    </span><span id="local-6989586621679046157"><span class="annot"><span class="annottext">State# s
</span><a href="#local-6989586621679046157"><span class="hs-identifier hs-var">s1#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# s
</span><a href="#local-6989586621679046157"><span class="hs-identifier hs-var">s1#</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span class="hs-cpp">

#else
</span><span>
</span><span id="line-193"></span><span class="hs-identifier">lengthCodeUnits</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span>
</span><span id="line-194"></span><span class="hs-identifier">lengthCodeUnits</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">lengthWord16</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-identifier">dropCodeUnits</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Buffer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Text</span><span>
</span><span id="line-197"></span><span class="hs-identifier">dropCodeUnits</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Buf</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">off</span><span> </span><span class="hs-identifier">len</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-identifier">assert</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">s</span><span> </span><span class="hs-operator">&gt;=</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator">&amp;&amp;</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-operator">&lt;=</span><span> </span><span class="hs-identifier">len</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-199"></span><span>  </span><span class="hs-identifier">Text</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">off</span><span class="hs-operator">+</span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">len</span><span class="hs-glyph">-</span><span class="hs-identifier">s</span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">dropCodeUnits</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="hs-comment">-- | /O(1)/ Iterate (unsafely) one step forwards through a UTF-16</span><span>
</span><span id="line-203"></span><span class="hs-comment">-- array, returning the current character and the delta to add to give</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- the next offset to iterate at.</span><span>
</span><span id="line-205"></span><span class="hs-identifier">iter</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Buffer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Iter</span><span>
</span><span id="line-206"></span><span class="hs-identifier">iter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Buf</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">off</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">i</span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-operator">&lt;</span><span> </span><span class="hs-number">0xD800</span><span> </span><span class="hs-operator">||</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-operator">&gt;</span><span> </span><span class="hs-number">0xDBFF</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Iter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeChr</span><span> </span><span class="hs-identifier">m</span><span class="hs-special">)</span><span> </span><span class="hs-number">1</span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Iter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">chr2</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-identifier">n</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">A.unsafeIndex</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">j</span><span>
</span><span id="line-210"></span><span>        </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">A.unsafeIndex</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">k</span><span>
</span><span id="line-211"></span><span>        </span><span class="hs-identifier">j</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">off</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-identifier">i</span><span>
</span><span id="line-212"></span><span>        </span><span class="hs-identifier">k</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">j</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-number">1</span><span>
</span><span id="line-213"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">iter</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="hs-comment">-- | /O(1)/ Iterate one step through a UTF-16 array, returning the</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- delta to add to give the next offset to iterate at.</span><span>
</span><span id="line-217"></span><span class="hs-identifier">iter_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Buffer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span>
</span><span id="line-218"></span><span class="hs-identifier">iter_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Buf</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">off</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-operator">&lt;</span><span> </span><span class="hs-number">0xD800</span><span> </span><span class="hs-operator">||</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-operator">&gt;</span><span> </span><span class="hs-number">0xDBFF</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><span id="line-219"></span><span>                                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">A.unsafeIndex</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">off</span><span class="hs-operator">+</span><span class="hs-identifier">i</span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">iter_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-identifier">unsafeThaw</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">A.Array</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">A.MArray</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span class="hs-identifier">unsafeThaw</span><span> </span><span class="hs-identifier">A.Array</span><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-225"></span><span>                          </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">A.MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeCoerce#</span><span> </span><span class="hs-identifier">aBA</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="hs-identifier">readGen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">A.Array</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span>
</span><span id="line-228"></span><span class="hs-identifier">readGen</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">indexIntArray#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">A.aBA</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-number">0#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">r#</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">r#</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="hs-identifier">writeGen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">A.MArray</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span class="hs-identifier">writeGen</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">gen#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s0#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">writeIntArray#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">A.maBA</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-number">0#</span><span> </span><span class="hs-identifier">gen#</span><span> </span><span class="hs-identifier">s0#</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s1#</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span class="hs-cpp">

#endif
</span></pre></body></html>