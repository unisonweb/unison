<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.PublicSuffixList.Lookup</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.PublicSuffixList.Lookup.html#effectiveTLDPlusOne"><span class="hs-identifier">effectiveTLDPlusOne</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.PublicSuffixList.Lookup.html#effectiveTLDPlusOne%27"><span class="hs-identifier">effectiveTLDPlusOne'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.PublicSuffixList.Lookup.html#isSuffix"><span class="hs-identifier">isSuffix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.PublicSuffixList.Lookup.html#isSuffix%27"><span class="hs-identifier">isSuffix'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isNothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span>         </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Network.PublicSuffixList.DataStructure.html"><span class="hs-identifier">Network.PublicSuffixList.DataStructure</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DS</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Network.PublicSuffixList.Types.html"><span class="hs-identifier">Network.PublicSuffixList.Types</span></a></span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="annot"><span class="hs-comment">{-|
OffEnd's Bool argument represents whether we fell off a
leaf or whether we fell off a non-leaf. True means that
we fell off a leaf. Its Text argument is the component
that pushed us off the end, along with all the components
to the right of that one, interspersed with &quot;.&quot;s
-}</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">data</span><span> </span><span id="LookupResult"><span class="annot"><a href="Network.PublicSuffixList.Lookup.html#LookupResult"><span class="hs-identifier hs-var">LookupResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Inside"><span class="annot"><a href="Network.PublicSuffixList.Lookup.html#Inside"><span class="hs-identifier hs-var">Inside</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="AtLeaf"><span class="annot"><a href="Network.PublicSuffixList.Lookup.html#AtLeaf"><span class="hs-identifier hs-var">AtLeaf</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="OffEnd"><span class="annot"><a href="Network.PublicSuffixList.Lookup.html#OffEnd"><span class="hs-identifier hs-var">OffEnd</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679107579"><span id="local-6989586621679107585"><span class="annot"><span class="annottext">LookupResult -&gt; LookupResult -&gt; Bool
(LookupResult -&gt; LookupResult -&gt; Bool)
-&gt; (LookupResult -&gt; LookupResult -&gt; Bool) -&gt; Eq LookupResult
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: LookupResult -&gt; LookupResult -&gt; Bool
== :: LookupResult -&gt; LookupResult -&gt; Bool
$c/= :: LookupResult -&gt; LookupResult -&gt; Bool
/= :: LookupResult -&gt; LookupResult -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="annot"><span class="hs-comment">{-|
This function returns whether or not this domain is owned by a
registrar or a regular person. 'Nothing' means that this is a registrar
domain; 'Just x' means it's owned by a person. This is used to determine
if a cookie is allowed to bet set for a particular domain. For
example, you shouldn't be able to set a cookie for \&quot;com\&quot;.

If the value is 'Just x', then the x value is what is known as the
effective TLD plus one. This is one segment more than the suffix of the
domain. For example, the eTLD+1 for &quot;this.is.a.subdom.com&quot; is Just
&quot;subdom.com&quot;

Note that this function expects lowercase ASCII strings. These strings
should be gotten from the toASCII algorithm as described in RFC 3490.
These strings should not start or end with the \'.\' character, and should
not have two \'.\' characters next to each other.
(The toASCII algorithm is implemented in the \'idna\' hackage package,
though that package doesn't always map strings to lowercase)
-}</span></span><span>
</span><span id="line-40"></span><span class="annot"><a href="Network.PublicSuffixList.Lookup.html#effectiveTLDPlusOne%27"><span class="hs-identifier hs-type">effectiveTLDPlusOne'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.PublicSuffixList.Types.html#DataStructure"><span class="hs-identifier hs-type">DataStructure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-41"></span><span id="effectiveTLDPlusOne%27"><span class="annot"><span class="annottext">effectiveTLDPlusOne' :: DataStructure -&gt; Text -&gt; Maybe Text
</span><a href="Network.PublicSuffixList.Lookup.html#effectiveTLDPlusOne%27"><span class="hs-identifier hs-var hs-var">effectiveTLDPlusOne'</span></a></span></span><span> </span><span id="local-6989586621679107589"><span class="annot"><span class="annottext">DataStructure
</span><a href="#local-6989586621679107589"><span class="hs-identifier hs-var">dataStructure</span></a></span></span><span> </span><span id="local-6989586621679107590"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679107590"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-comment">-- Any TLD is a suffix</span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679107592"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LookupResult -&gt; LookupResult -&gt; Maybe Text
</span><a href="#local-6989586621679107593"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="annottext">LookupResult
</span><a href="#local-6989586621679107594"><span class="hs-identifier hs-var">rulesResult</span></a></span><span> </span><span class="annot"><span class="annottext">LookupResult
</span><a href="#local-6989586621679107595"><span class="hs-identifier hs-var">exceptionResult</span></a></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679107592"><span class="annot"><span class="annottext">ss :: [Text]
</span><a href="#local-6989586621679107592"><span class="hs-identifier hs-var hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Text -&gt; [Text]
Text -&gt; Text -&gt; [Text]
</span><span class="hs-identifier hs-var">T.splitOn</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679107590"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-46"></span><span>        </span><span id="local-6989586621679107600"><span class="annot"><span class="annottext">ps :: [Text]
</span><a href="#local-6989586621679107600"><span class="hs-identifier hs-var hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679107592"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-47"></span><span>        </span><span id="local-6989586621679107595"><span class="annot"><span class="annottext">exceptionResult :: LookupResult
</span><a href="#local-6989586621679107595"><span class="hs-identifier hs-var hs-var">exceptionResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; Tree Text -&gt; LookupResult
</span><a href="#local-6989586621679107602"><span class="hs-identifier hs-var">recurse</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679107600"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tree Text -&gt; LookupResult) -&gt; Tree Text -&gt; LookupResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DataStructure -&gt; Tree Text
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">DataStructure
</span><a href="#local-6989586621679107589"><span class="hs-identifier hs-var">dataStructure</span></a></span><span>
</span><span id="line-48"></span><span>        </span><span id="local-6989586621679107594"><span class="annot"><span class="annottext">rulesResult :: LookupResult
</span><a href="#local-6989586621679107594"><span class="hs-identifier hs-var hs-var">rulesResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; Tree Text -&gt; LookupResult
</span><a href="#local-6989586621679107602"><span class="hs-identifier hs-var">recurse</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679107600"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tree Text -&gt; LookupResult) -&gt; Tree Text -&gt; LookupResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DataStructure -&gt; Tree Text
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">DataStructure
</span><a href="#local-6989586621679107589"><span class="hs-identifier hs-var">dataStructure</span></a></span><span>
</span><span id="line-49"></span><span>        </span><span class="hs-comment">-- If we fell off, did we do it at a leaf? Otherwise, what's the</span><span>
</span><span id="line-50"></span><span>        </span><span class="hs-comment">-- subtree that we're at</span><span>
</span><span id="line-51"></span><span>        </span><span class="annot"><a href="#local-6989586621679107605"><span class="hs-identifier hs-type">getNext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.PublicSuffixList.Types.html#Tree"><span class="hs-identifier hs-type">Tree</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.PublicSuffixList.Types.html#Tree"><span class="hs-identifier hs-type">Tree</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>        </span><span id="local-6989586621679107605"><span class="annot"><span class="annottext">getNext :: Tree Text -&gt; Text -&gt; Either Bool (Tree Text)
</span><a href="#local-6989586621679107605"><span class="hs-identifier hs-var hs-var">getNext</span></a></span></span><span> </span><span id="local-6989586621679107606"><span class="annot"><span class="annottext">Tree Text
</span><a href="#local-6989586621679107606"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679107607"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679107607"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Map Text (Tree Text) -&gt; Maybe (Tree Text)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679107607"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Text (Tree Text) -&gt; Maybe (Tree Text))
-&gt; Map Text (Tree Text) -&gt; Maybe (Tree Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tree Text -&gt; Map Text (Tree Text)
forall e. Tree e -&gt; Map e (Tree e)
</span><a href="Network.PublicSuffixList.Types.html#children"><span class="hs-identifier hs-var">children</span></a></span><span> </span><span class="annot"><span class="annottext">Tree Text
</span><a href="#local-6989586621679107606"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-53"></span><span>          </span><span class="annot"><span class="annottext">Maybe (Tree Text)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Either Bool (Tree Text)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Text (Tree Text) -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">M.null</span></span><span> </span><span class="annot"><span class="annottext">(Map Text (Tree Text) -&gt; Bool) -&gt; Map Text (Tree Text) -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tree Text -&gt; Map Text (Tree Text)
forall e. Tree e -&gt; Map e (Tree e)
</span><a href="Network.PublicSuffixList.Types.html#children"><span class="hs-identifier hs-var">children</span></a></span><span> </span><span class="annot"><span class="annottext">Tree Text
</span><a href="#local-6989586621679107606"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679107611"><span class="annot"><span class="annottext">Tree Text
</span><a href="#local-6989586621679107611"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Tree Text -&gt; Either Bool (Tree Text)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Tree Text
</span><a href="#local-6989586621679107611"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-55"></span><span>        </span><span class="hs-comment">-- Look up the component we're looking for...</span><span>
</span><span id="line-56"></span><span>        </span><span id="local-6989586621679107613"><span class="annot"><span class="annottext">getNextWithStar :: Tree Text -&gt; Text -&gt; Either Bool (Tree Text)
</span><a href="#local-6989586621679107613"><span class="hs-identifier hs-var hs-var">getNextWithStar</span></a></span></span><span> </span><span id="local-6989586621679107614"><span class="annot"><span class="annottext">Tree Text
</span><a href="#local-6989586621679107614"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679107615"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679107615"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Tree Text -&gt; Text -&gt; Either Bool (Tree Text)
</span><a href="#local-6989586621679107605"><span class="hs-identifier hs-var">getNext</span></a></span><span> </span><span class="annot"><span class="annottext">Tree Text
</span><a href="#local-6989586621679107614"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679107615"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-57"></span><span>          </span><span class="hs-comment">-- and if that fails, look up &quot;*&quot;</span><span>
</span><span id="line-58"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Tree Text -&gt; Text -&gt; Either Bool (Tree Text)
</span><a href="#local-6989586621679107605"><span class="hs-identifier hs-var">getNext</span></a></span><span> </span><span class="annot"><span class="annottext">Tree Text
</span><a href="#local-6989586621679107614"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;*&quot;</span></span><span>
</span><span id="line-59"></span><span>          </span><span id="local-6989586621679107616"><span class="annot"><span class="annottext">Either Bool (Tree Text)
</span><a href="#local-6989586621679107616"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either Bool (Tree Text)
</span><a href="#local-6989586621679107616"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-60"></span><span>        </span><span class="annot"><a href="#local-6989586621679107602"><span class="hs-identifier hs-type">recurse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.PublicSuffixList.Types.html#Tree"><span class="hs-identifier hs-type">Tree</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.PublicSuffixList.Lookup.html#LookupResult"><span class="hs-identifier hs-type">LookupResult</span></a></span><span>
</span><span id="line-61"></span><span>        </span><span id="local-6989586621679107602"><span class="annot"><span class="annottext">recurse :: [Text] -&gt; [Text] -&gt; Tree Text -&gt; LookupResult
</span><a href="#local-6989586621679107602"><span class="hs-identifier hs-var hs-var">recurse</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679107617"><span class="annot"><span class="annottext">Tree Text
</span><a href="#local-6989586621679107617"><span class="hs-identifier hs-var">t</span></a></span></span><span>
</span><span id="line-62"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Map Text (Tree Text) -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">M.null</span></span><span> </span><span class="annot"><span class="annottext">(Map Text (Tree Text) -&gt; Bool) -&gt; Map Text (Tree Text) -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tree Text -&gt; Map Text (Tree Text)
forall e. Tree e -&gt; Map e (Tree e)
</span><a href="Network.PublicSuffixList.Types.html#children"><span class="hs-identifier hs-var">children</span></a></span><span> </span><span class="annot"><span class="annottext">Tree Text
</span><a href="#local-6989586621679107617"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LookupResult
</span><a href="Network.PublicSuffixList.Lookup.html#AtLeaf"><span class="hs-identifier hs-var">AtLeaf</span></a></span><span>
</span><span id="line-63"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LookupResult
</span><a href="Network.PublicSuffixList.Lookup.html#Inside"><span class="hs-identifier hs-var">Inside</span></a></span><span>
</span><span id="line-64"></span><span>        </span><span class="annot"><a href="#local-6989586621679107602"><span class="hs-identifier hs-var">recurse</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679107618"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679107618"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679107619"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679107619"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679107620"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679107620"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span id="local-6989586621679107621"><span class="annot"><span class="annottext">Tree Text
</span><a href="#local-6989586621679107621"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Tree Text -&gt; Text -&gt; Either Bool (Tree Text)
</span><a href="#local-6989586621679107613"><span class="hs-identifier hs-var">getNextWithStar</span></a></span><span> </span><span class="annot"><span class="annottext">Tree Text
</span><a href="#local-6989586621679107621"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679107618"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-65"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679107622"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679107622"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Text -&gt; LookupResult
</span><a href="Network.PublicSuffixList.Lookup.html#OffEnd"><span class="hs-identifier hs-var">OffEnd</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679107622"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; LookupResult) -&gt; Text -&gt; LookupResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679107618"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; [Text]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679107620"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679107624"><span class="annot"><span class="annottext">Tree Text
</span><a href="#local-6989586621679107624"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; Tree Text -&gt; LookupResult
</span><a href="#local-6989586621679107602"><span class="hs-identifier hs-var">recurse</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679107619"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679107618"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; [Text]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679107620"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tree Text
</span><a href="#local-6989586621679107624"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-67"></span><span>        </span><span class="hs-comment">-- Only match against the exception rules if we have a full match</span><span>
</span><span id="line-68"></span><span>        </span><span id="local-6989586621679107593"><span class="annot"><span class="annottext">output :: LookupResult -&gt; LookupResult -&gt; Maybe Text
</span><a href="#local-6989586621679107593"><span class="hs-identifier hs-var hs-var">output</span></a></span></span><span> </span><span class="annot"><span class="annottext">LookupResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LookupResult
</span><a href="Network.PublicSuffixList.Lookup.html#AtLeaf"><span class="hs-identifier hs-var">AtLeaf</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679107590"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-69"></span><span>        </span><span class="annot"><a href="#local-6989586621679107593"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="annottext">LookupResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.PublicSuffixList.Lookup.html#OffEnd"><span class="hs-identifier hs-type">OffEnd</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span id="local-6989586621679107637"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679107637"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe Text) -&gt; Text -&gt; Maybe Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; [Text]) -&gt; [Text] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Text -&gt; [Text]
Text -&gt; Text -&gt; [Text]
</span><span class="hs-identifier hs-var">T.splitOn</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679107637"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-70"></span><span>        </span><span class="hs-comment">-- If we have a subdomain on an existing rule, we're not a suffix</span><span>
</span><span id="line-71"></span><span>        </span><span class="annot"><a href="#local-6989586621679107593"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.PublicSuffixList.Lookup.html#OffEnd"><span class="hs-identifier hs-type">OffEnd</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679107639"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679107639"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LookupResult
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-72"></span><span>          </span><span class="hs-comment">-- A single level domain can never be a eTLD+1</span><span>
</span><span id="line-73"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe Char -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Char -&gt; Bool) -&gt; Maybe Char -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Text -&gt; Maybe Char
</span><span class="hs-identifier hs-var">T.find</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679107639"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe Text) -&gt; Text -&gt; Maybe Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Text] -&gt; [Text]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679107592"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679107592"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-74"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679107639"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-75"></span><span>        </span><span class="hs-comment">-- Otherwise, we're a suffix of a suffix, which is a suffix</span><span>
</span><span id="line-76"></span><span>        </span><span class="annot"><a href="#local-6989586621679107593"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="annottext">LookupResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LookupResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="annot"><span class="hs-comment">-- | &gt;&gt;&gt; effectiveTLDPlusOne = effectiveTLDPlusOne' Network.PublicSuffixList.DataStructure.dataStructure</span></span><span>
</span><span id="line-79"></span><span class="annot"><a href="Network.PublicSuffixList.Lookup.html#effectiveTLDPlusOne"><span class="hs-identifier hs-type">effectiveTLDPlusOne</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-80"></span><span id="effectiveTLDPlusOne"><span class="annot"><span class="annottext">effectiveTLDPlusOne :: Text -&gt; Maybe Text
</span><a href="Network.PublicSuffixList.Lookup.html#effectiveTLDPlusOne"><span class="hs-identifier hs-var hs-var">effectiveTLDPlusOne</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataStructure -&gt; Text -&gt; Maybe Text
</span><a href="Network.PublicSuffixList.Lookup.html#effectiveTLDPlusOne%27"><span class="hs-identifier hs-var">effectiveTLDPlusOne'</span></a></span><span> </span><span class="annot"><span class="annottext">DataStructure
</span><a href="Network.PublicSuffixList.DataStructure.html#dataStructure"><span class="hs-identifier hs-var">DS.dataStructure</span></a></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="annot"><span class="hs-comment">-- | &gt;&gt;&gt; isSuffix' dataStructure = isNothing . effectiveTLDPlusOne' dataStructure</span></span><span>
</span><span id="line-83"></span><span class="annot"><a href="Network.PublicSuffixList.Lookup.html#isSuffix%27"><span class="hs-identifier hs-type">isSuffix'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.PublicSuffixList.Types.html#DataStructure"><span class="hs-identifier hs-type">DataStructure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-84"></span><span id="isSuffix%27"><span class="annot"><span class="annottext">isSuffix' :: DataStructure -&gt; Text -&gt; Bool
</span><a href="Network.PublicSuffixList.Lookup.html#isSuffix%27"><span class="hs-identifier hs-var hs-var">isSuffix'</span></a></span></span><span> </span><span id="local-6989586621679107643"><span class="annot"><span class="annottext">DataStructure
</span><a href="#local-6989586621679107643"><span class="hs-identifier hs-var">dataStructure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Bool) -&gt; (Text -&gt; Maybe Text) -&gt; Text -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DataStructure -&gt; Text -&gt; Maybe Text
</span><a href="Network.PublicSuffixList.Lookup.html#effectiveTLDPlusOne%27"><span class="hs-identifier hs-var">effectiveTLDPlusOne'</span></a></span><span> </span><span class="annot"><span class="annottext">DataStructure
</span><a href="#local-6989586621679107643"><span class="hs-identifier hs-var">dataStructure</span></a></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="annot"><span class="hs-comment">-- | &gt;&gt;&gt; isSuffix = isSuffix' Network.PublicSuffixList.DataStructure.dataStructure</span></span><span>
</span><span id="line-87"></span><span class="annot"><a href="Network.PublicSuffixList.Lookup.html#isSuffix"><span class="hs-identifier hs-type">isSuffix</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-88"></span><span id="isSuffix"><span class="annot"><span class="annottext">isSuffix :: Text -&gt; Bool
</span><a href="Network.PublicSuffixList.Lookup.html#isSuffix"><span class="hs-identifier hs-var hs-var">isSuffix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Bool) -&gt; (Text -&gt; Maybe Text) -&gt; Text -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
</span><a href="Network.PublicSuffixList.Lookup.html#effectiveTLDPlusOne"><span class="hs-identifier hs-var">effectiveTLDPlusOne</span></a></span><span>
</span><span id="line-89"></span></pre></body></html>