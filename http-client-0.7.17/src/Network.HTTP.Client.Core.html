<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.HTTP.Client.Core</span><span>
</span><span id="line-4"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Core.html#withResponse"><span class="hs-identifier">withResponse</span></a></span><span>
</span><span id="line-5"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Core.html#httpLbs"><span class="hs-identifier">httpLbs</span></a></span><span>
</span><span id="line-6"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Core.html#httpNoBody"><span class="hs-identifier">httpNoBody</span></a></span><span>
</span><span id="line-7"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Core.html#httpRaw"><span class="hs-identifier">httpRaw</span></a></span><span>
</span><span id="line-8"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Core.html#httpRaw%27"><span class="hs-identifier">httpRaw'</span></a></span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Core.html#getModifiedRequestManager"><span class="hs-identifier">getModifiedRequestManager</span></a></span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Core.html#responseOpen"><span class="hs-identifier">responseOpen</span></a></span><span>
</span><span id="line-11"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Core.html#responseClose"><span class="hs-identifier">responseClose</span></a></span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Core.html#httpRedirect"><span class="hs-identifier">httpRedirect</span></a></span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Core.html#httpRedirect%27"><span class="hs-identifier">httpRedirect'</span></a></span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Core.html#withConnection"><span class="hs-identifier">withConnection</span></a></span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Core.html#handleClosedRead"><span class="hs-identifier">handleClosedRead</span></a></span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Types</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Manager.html"><span class="hs-identifier">Network.HTTP.Client.Manager</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html"><span class="hs-identifier">Network.HTTP.Client.Types</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Headers.html"><span class="hs-identifier">Network.HTTP.Client.Headers</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Body.html"><span class="hs-identifier">Network.HTTP.Client.Body</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Request.html"><span class="hs-identifier">Network.HTTP.Client.Request</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Response.html"><span class="hs-identifier">Network.HTTP.Client.Response</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Cookies.html"><span class="hs-identifier">Network.HTTP.Client.Cookies</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isJust</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Time</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">void</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Timeout</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">timeout</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.KeyedPool.html"><span class="hs-identifier">Data.KeyedPool</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.IO.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IOException</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">IOErrorType</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-comment">-- | Perform a @Request@ using a connection acquired from the given @Manager@,</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- and then provide the @Response@ to the given function. This function is</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- fully exception safe, guaranteeing that the response will be closed when the</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- inner function exits. It is defined as:</span><span>
</span><span id="line-40"></span><span class="hs-comment">--</span><span>
</span><span id="line-41"></span><span class="hs-comment">-- &gt; withResponse req man f = bracket (responseOpen req man) responseClose f</span><span>
</span><span id="line-42"></span><span class="hs-comment">--</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- It is recommended that you use this function in place of explicit calls to</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- 'responseOpen' and 'responseClose'.</span><span>
</span><span id="line-45"></span><span class="hs-comment">--</span><span>
</span><span id="line-46"></span><span class="hs-comment">-- You will need to use functions such as 'brRead' to consume the response</span><span>
</span><span id="line-47"></span><span class="hs-comment">-- body.</span><span>
</span><span id="line-48"></span><span class="hs-comment">--</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- Since 0.1.0</span><span>
</span><span id="line-50"></span><span id="local-6989586621679108118"><span class="annot"><a href="Network.HTTP.Client.Core.html#withResponse"><span class="hs-identifier hs-type">withResponse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span>
</span><span id="line-51"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Manager"><span class="hs-identifier hs-type">Manager</span></a></span><span>
</span><span id="line-52"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Client.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#BodyReader"><span class="hs-identifier hs-type">BodyReader</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679108118"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679108118"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-54"></span><span id="withResponse"><span class="annot"><span class="annottext">withResponse :: forall a.
Request -&gt; Manager -&gt; (Response BodyReader -&gt; IO a) -&gt; IO a
</span><a href="Network.HTTP.Client.Core.html#withResponse"><span class="hs-identifier hs-var hs-var">withResponse</span></a></span></span><span> </span><span id="local-6989586621679108272"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108272"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span id="local-6989586621679108273"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108273"><span class="hs-identifier hs-var">man</span></a></span></span><span> </span><span id="local-6989586621679108274"><span class="annot"><span class="annottext">Response BodyReader -&gt; IO a
</span><a href="#local-6989586621679108274"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Response BodyReader)
-&gt; (Response BodyReader -&gt; IO ())
-&gt; (Response BodyReader -&gt; IO a)
-&gt; IO a
forall a b c. IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; IO c) -&gt; IO c
</span><span class="hs-identifier hs-var">bracket</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; Manager -&gt; IO (Response BodyReader)
</span><a href="Network.HTTP.Client.Core.html#responseOpen"><span class="hs-identifier hs-var">responseOpen</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108272"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108273"><span class="hs-identifier hs-var">man</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Response BodyReader -&gt; IO ()
forall a. Response a -&gt; IO ()
</span><a href="Network.HTTP.Client.Core.html#responseClose"><span class="hs-identifier hs-var">responseClose</span></a></span><span> </span><span class="annot"><span class="annottext">Response BodyReader -&gt; IO a
</span><a href="#local-6989586621679108274"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-comment">-- | A convenience wrapper around 'withResponse' which reads in the entire</span><span>
</span><span id="line-57"></span><span class="hs-comment">-- response body and immediately closes the connection. Note that this function</span><span>
</span><span id="line-58"></span><span class="hs-comment">-- performs fully strict I\/O, and only uses a lazy ByteString in its response</span><span>
</span><span id="line-59"></span><span class="hs-comment">-- for memory efficiency. If you are anticipating a large response body, you</span><span>
</span><span id="line-60"></span><span class="hs-comment">-- are encouraged to use 'withResponse' and 'brRead' instead.</span><span>
</span><span id="line-61"></span><span class="hs-comment">--</span><span>
</span><span id="line-62"></span><span class="hs-comment">-- Since 0.1.0</span><span>
</span><span id="line-63"></span><span class="annot"><a href="Network.HTTP.Client.Core.html#httpLbs"><span class="hs-identifier hs-type">httpLbs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Manager"><span class="hs-identifier hs-type">Manager</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Client.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span id="httpLbs"><span class="annot"><span class="annottext">httpLbs :: Request -&gt; Manager -&gt; IO (Response ByteString)
</span><a href="Network.HTTP.Client.Core.html#httpLbs"><span class="hs-identifier hs-var hs-var">httpLbs</span></a></span></span><span> </span><span id="local-6989586621679108276"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108276"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span id="local-6989586621679108277"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108277"><span class="hs-identifier hs-var">man</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request
-&gt; Manager
-&gt; (Response BodyReader -&gt; IO (Response ByteString))
-&gt; IO (Response ByteString)
forall a.
Request -&gt; Manager -&gt; (Response BodyReader -&gt; IO a) -&gt; IO a
</span><a href="Network.HTTP.Client.Core.html#withResponse"><span class="hs-identifier hs-var">withResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108276"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108277"><span class="hs-identifier hs-var">man</span></a></span><span> </span><span class="annot"><span class="annottext">((Response BodyReader -&gt; IO (Response ByteString))
 -&gt; IO (Response ByteString))
-&gt; (Response BodyReader -&gt; IO (Response ByteString))
-&gt; IO (Response ByteString)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679108278"><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108278"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-65"></span><span>    </span><span id="local-6989586621679108279"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679108279"><span class="hs-identifier hs-var">bss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BodyReader -&gt; IO [ByteString]
</span><a href="Network.HTTP.Client.Body.html#brConsume"><span class="hs-identifier hs-var">brConsume</span></a></span><span> </span><span class="annot"><span class="annottext">(BodyReader -&gt; IO [ByteString]) -&gt; BodyReader -&gt; IO [ByteString]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Response BodyReader -&gt; BodyReader
forall body. Response body -&gt; body
</span><a href="Network.HTTP.Client.Types.html#responseBody"><span class="hs-identifier hs-var">responseBody</span></a></span><span> </span><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108278"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><span class="annottext">Response ByteString -&gt; IO (Response ByteString)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108278"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#responseBody"><span class="hs-identifier hs-var">responseBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.fromChunks</span></span><span> </span><span class="annot"><a href="#local-6989586621679108279"><span class="hs-identifier hs-type">bss</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-comment">-- | A convenient wrapper around 'withResponse' which ignores the response</span><span>
</span><span id="line-69"></span><span class="hs-comment">-- body. This is useful, for example, when performing a HEAD request.</span><span>
</span><span id="line-70"></span><span class="hs-comment">--</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- Since 0.3.2</span><span>
</span><span id="line-72"></span><span class="annot"><a href="Network.HTTP.Client.Core.html#httpNoBody"><span class="hs-identifier hs-type">httpNoBody</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Manager"><span class="hs-identifier hs-type">Manager</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Client.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span id="httpNoBody"><span class="annot"><span class="annottext">httpNoBody :: Request -&gt; Manager -&gt; IO (Response ())
</span><a href="Network.HTTP.Client.Core.html#httpNoBody"><span class="hs-identifier hs-var hs-var">httpNoBody</span></a></span></span><span> </span><span id="local-6989586621679108283"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108283"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span id="local-6989586621679108284"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108284"><span class="hs-identifier hs-var">man</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request
-&gt; Manager
-&gt; (Response BodyReader -&gt; IO (Response ()))
-&gt; IO (Response ())
forall a.
Request -&gt; Manager -&gt; (Response BodyReader -&gt; IO a) -&gt; IO a
</span><a href="Network.HTTP.Client.Core.html#withResponse"><span class="hs-identifier hs-var">withResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108283"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108284"><span class="hs-identifier hs-var">man</span></a></span><span> </span><span class="annot"><span class="annottext">((Response BodyReader -&gt; IO (Response ())) -&gt; IO (Response ()))
-&gt; (Response BodyReader -&gt; IO (Response ())) -&gt; IO (Response ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Response () -&gt; IO (Response ())
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Response () -&gt; IO (Response ()))
-&gt; (Response BodyReader -&gt; Response ())
-&gt; Response BodyReader
-&gt; IO (Response ())
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Response BodyReader -&gt; Response ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="annot"><span class="hs-comment">-- | Get a 'Response' without any redirect following.</span></span><span>
</span><span id="line-77"></span><span class="annot"><a href="Network.HTTP.Client.Core.html#httpRaw"><span class="hs-identifier hs-type">httpRaw</span></a></span><span>
</span><span id="line-78"></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span>
</span><span id="line-79"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Manager"><span class="hs-identifier hs-type">Manager</span></a></span><span>
</span><span id="line-80"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Client.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#BodyReader"><span class="hs-identifier hs-type">BodyReader</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span id="httpRaw"><span class="annot"><span class="annottext">httpRaw :: Request -&gt; Manager -&gt; IO (Response BodyReader)
</span><a href="Network.HTTP.Client.Core.html#httpRaw"><span class="hs-identifier hs-var hs-var">httpRaw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IO (Request, Response BodyReader) -&gt; IO (Response BodyReader))
-&gt; (Manager -&gt; IO (Request, Response BodyReader))
-&gt; Manager
-&gt; IO (Response BodyReader)
forall a b. (a -&gt; b) -&gt; (Manager -&gt; a) -&gt; Manager -&gt; b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Request, Response BodyReader) -&gt; Response BodyReader)
-&gt; IO (Request, Response BodyReader) -&gt; IO (Response BodyReader)
forall a b. (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(Request, Response BodyReader) -&gt; Response BodyReader
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Manager -&gt; IO (Request, Response BodyReader))
 -&gt; Manager -&gt; IO (Response BodyReader))
-&gt; (Request -&gt; Manager -&gt; IO (Request, Response BodyReader))
-&gt; Request
-&gt; Manager
-&gt; IO (Response BodyReader)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; Manager -&gt; IO (Request, Response BodyReader)
</span><a href="Network.HTTP.Client.Core.html#httpRaw%27"><span class="hs-identifier hs-var">httpRaw'</span></a></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">-- | Get a 'Response' without any redirect following.</span><span>
</span><span id="line-84"></span><span class="hs-comment">--</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- This extended version of 'httpRaw' also returns the potentially modified Request.</span><span>
</span><span id="line-86"></span><span class="annot"><a href="Network.HTTP.Client.Core.html#httpRaw%27"><span class="hs-identifier hs-type">httpRaw'</span></a></span><span>
</span><span id="line-87"></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span>
</span><span id="line-88"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Manager"><span class="hs-identifier hs-type">Manager</span></a></span><span>
</span><span id="line-89"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Client.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#BodyReader"><span class="hs-identifier hs-type">BodyReader</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span id="httpRaw%27"><span class="annot"><span class="annottext">httpRaw' :: Request -&gt; Manager -&gt; IO (Request, Response BodyReader)
</span><a href="Network.HTTP.Client.Core.html#httpRaw%27"><span class="hs-identifier hs-var hs-var">httpRaw'</span></a></span></span><span> </span><span id="local-6989586621679108288"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108288"><span class="hs-identifier hs-var">req0</span></a></span></span><span> </span><span id="local-6989586621679108289"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108289"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679108290"><span class="annot"><span class="annottext">req' :: Request
</span><a href="#local-6989586621679108290"><span class="hs-identifier hs-var hs-var">req'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Manager -&gt; Request -&gt; Request
</span><a href="Network.HTTP.Client.Types.html#mSetProxy"><span class="hs-identifier hs-var">mSetProxy</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108289"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108288"><span class="hs-identifier hs-var">req0</span></a></span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679108292"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108292"><span class="hs-identifier hs-var">req</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679108293"><span class="annot"><span class="annottext">CookieJar
</span><a href="#local-6989586621679108293"><span class="hs-identifier hs-var">cookie_jar'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Request -&gt; Maybe CookieJar
</span><a href="Network.HTTP.Client.Types.html#cookieJar"><span class="hs-identifier hs-var">cookieJar</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108290"><span class="hs-identifier hs-var">req'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-93"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679108295"><span class="annot"><span class="annottext">CookieJar
</span><a href="#local-6989586621679108295"><span class="hs-identifier hs-var">cj</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-94"></span><span>            </span><span id="local-6989586621679108296"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679108296"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><span class="hs-identifier hs-var">getCurrentTime</span></span><span>
</span><span id="line-95"></span><span>            </span><span class="annot"><span class="annottext">(Request, CookieJar) -&gt; IO (Request, CookieJar)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((Request, CookieJar) -&gt; IO (Request, CookieJar))
-&gt; (Request, CookieJar) -&gt; IO (Request, CookieJar)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; CookieJar -&gt; UTCTime -&gt; (Request, CookieJar)
</span><a href="Network.HTTP.Client.Cookies.html#insertCookiesIntoRequest"><span class="hs-identifier hs-var">insertCookiesIntoRequest</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108290"><span class="hs-identifier hs-var">req'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CookieJar -&gt; UTCTime -&gt; CookieJar
</span><a href="Network.HTTP.Client.Cookies.html#evictExpiredCookies"><span class="hs-identifier hs-var">evictExpiredCookies</span></a></span><span> </span><span class="annot"><span class="annottext">CookieJar
</span><a href="#local-6989586621679108295"><span class="hs-identifier hs-var">cj</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679108296"><span class="hs-identifier hs-var">now</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679108296"><span class="hs-identifier hs-var">now</span></a></span><span>
</span><span id="line-96"></span><span>        </span><span class="annot"><span class="annottext">Maybe CookieJar
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Request, CookieJar) -&gt; IO (Request, CookieJar)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108290"><span class="hs-identifier hs-var">req'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CookieJar
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">Data.Monoid.mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679108300"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679108300"><span class="hs-identifier hs-var">timeout'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679108301"><span class="annot"><span class="annottext">Managed Connection
</span><a href="#local-6989586621679108301"><span class="hs-identifier hs-var">mconn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Int
-&gt; IO (Managed Connection) -&gt; IO (Maybe Int, Managed Connection)
forall {a} {resource}.
Integral a =&gt;
Maybe Int
-&gt; IO (Managed resource) -&gt; IO (Maybe a, Managed resource)
</span><a href="#local-6989586621679108302"><span class="hs-identifier hs-var">getConnectionWrapper</span></a></span><span>
</span><span id="line-98"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; Maybe Int
</span><a href="#local-6989586621679108303"><span class="hs-identifier hs-var">responseTimeout'</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108292"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; Manager -&gt; IO (Managed Connection)
</span><a href="Network.HTTP.Client.Manager.html#getConn"><span class="hs-identifier hs-var">getConn</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108292"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108289"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-comment">-- Originally, we would only test for exceptions when sending the request,</span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-comment">-- not on calling @getResponse@. However, some servers seem to close</span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-comment">-- connections after accepting the request headers, so we need to check for</span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-comment">-- exceptions in both.</span><span>
</span><span id="line-105"></span><span>    </span><span id="local-6989586621679108305"><span class="annot"><span class="annottext">Either SomeException (Response BodyReader)
</span><a href="#local-6989586621679108305"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Response BodyReader)
-&gt; IO (Either SomeException (Response BodyReader))
forall e a. Exception e =&gt; IO a -&gt; IO (Either e a)
</span><span class="hs-identifier hs-var">try</span></span><span> </span><span class="annot"><span class="annottext">(IO (Response BodyReader)
 -&gt; IO (Either SomeException (Response BodyReader)))
-&gt; IO (Response BodyReader)
-&gt; IO (Either SomeException (Response BodyReader))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-106"></span><span>        </span><span id="local-6989586621679108307"><span class="annot"><span class="annottext">Maybe (IO ())
</span><a href="#local-6989586621679108307"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Request -&gt; Connection -&gt; IO (Maybe (IO ()))
</span><a href="Network.HTTP.Client.Request.html#requestBuilder"><span class="hs-identifier hs-var">requestBuilder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; Request
</span><a href="Network.HTTP.Client.Manager.html#dropProxyAuthSecure"><span class="hs-identifier hs-var">dropProxyAuthSecure</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108292"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Managed Connection -&gt; Connection
forall resource. Managed resource -&gt; resource
</span><a href="Data.KeyedPool.html#managedResource"><span class="hs-identifier hs-var">managedResource</span></a></span><span> </span><span class="annot"><span class="annottext">Managed Connection
</span><a href="#local-6989586621679108301"><span class="hs-identifier hs-var">mconn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span>        </span><span class="annot"><span class="annottext">Maybe MaxHeaderLength
-&gt; Maybe Int
-&gt; Request
-&gt; Managed Connection
-&gt; Maybe (IO ())
-&gt; IO (Response BodyReader)
</span><a href="Network.HTTP.Client.Response.html#getResponse"><span class="hs-identifier hs-var">getResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Manager -&gt; Maybe MaxHeaderLength
</span><a href="Network.HTTP.Client.Types.html#mMaxHeaderLength"><span class="hs-identifier hs-var">mMaxHeaderLength</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108289"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679108300"><span class="hs-identifier hs-var">timeout'</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108292"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">Managed Connection
</span><a href="#local-6989586621679108301"><span class="hs-identifier hs-var">mconn</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (IO ())
</span><a href="#local-6989586621679108307"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either SomeException (Response BodyReader)
</span><a href="#local-6989586621679108305"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-111"></span><span>        </span><span class="hs-comment">-- Connection was reused, and might have been closed. Try again</span><span>
</span><span id="line-112"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679108313"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679108313"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Managed Connection -&gt; Bool
forall resource. Managed resource -&gt; Bool
</span><a href="Data.KeyedPool.html#managedReused"><span class="hs-identifier hs-var">managedReused</span></a></span><span> </span><span class="annot"><span class="annottext">Managed Connection
</span><a href="#local-6989586621679108301"><span class="hs-identifier hs-var">mconn</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Manager -&gt; SomeException -&gt; Bool
</span><a href="Network.HTTP.Client.Types.html#mRetryableException"><span class="hs-identifier hs-var">mRetryableException</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108289"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679108313"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-113"></span><span>            </span><span class="annot"><span class="annottext">Managed Connection -&gt; Reuse -&gt; IO ()
forall resource. Managed resource -&gt; Reuse -&gt; IO ()
</span><a href="Data.KeyedPool.html#managedRelease"><span class="hs-identifier hs-var">managedRelease</span></a></span><span> </span><span class="annot"><span class="annottext">Managed Connection
</span><a href="#local-6989586621679108301"><span class="hs-identifier hs-var">mconn</span></a></span><span> </span><span class="annot"><span class="annottext">Reuse
</span><a href="Data.KeyedPool.html#DontReuse"><span class="hs-identifier hs-var">DontReuse</span></a></span><span>
</span><span id="line-114"></span><span>            </span><span class="annot"><span class="annottext">Request -&gt; Manager -&gt; IO (Request, Response BodyReader)
</span><a href="Network.HTTP.Client.Core.html#httpRaw%27"><span class="hs-identifier hs-var">httpRaw'</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108292"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108289"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-115"></span><span>        </span><span class="hs-comment">-- Not reused, or a non-retry, so this is a real exception</span><span>
</span><span id="line-116"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679108319"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679108319"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-117"></span><span>          </span><span class="hs-comment">-- Explicitly release connection for all real exceptions:</span><span>
</span><span id="line-118"></span><span>          </span><span class="hs-comment">-- https://github.com/snoyberg/http-client/pull/454</span><span>
</span><span id="line-119"></span><span>          </span><span class="annot"><span class="annottext">Managed Connection -&gt; Reuse -&gt; IO ()
forall resource. Managed resource -&gt; Reuse -&gt; IO ()
</span><a href="Data.KeyedPool.html#managedRelease"><span class="hs-identifier hs-var">managedRelease</span></a></span><span> </span><span class="annot"><span class="annottext">Managed Connection
</span><a href="#local-6989586621679108301"><span class="hs-identifier hs-var">mconn</span></a></span><span> </span><span class="annot"><span class="annottext">Reuse
</span><a href="Data.KeyedPool.html#DontReuse"><span class="hs-identifier hs-var">DontReuse</span></a></span><span>
</span><span id="line-120"></span><span>          </span><span class="annot"><span class="annottext">SomeException -&gt; IO (Request, Response BodyReader)
forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679108319"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-121"></span><span>        </span><span class="hs-comment">-- Everything went ok, so the connection is good. If any exceptions get</span><span>
</span><span id="line-122"></span><span>        </span><span class="hs-comment">-- thrown in the response body, just throw them as normal.</span><span>
</span><span id="line-123"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679108321"><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108321"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Request -&gt; Maybe CookieJar
</span><a href="Network.HTTP.Client.Types.html#cookieJar"><span class="hs-identifier hs-var">cookieJar</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108290"><span class="hs-identifier hs-var">req'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-124"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">CookieJar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-125"></span><span>                </span><span id="local-6989586621679108322"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679108322"><span class="hs-identifier hs-var">now'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><span class="hs-identifier hs-var">getCurrentTime</span></span><span>
</span><span id="line-126"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679108323"><span class="annot"><span class="annottext">CookieJar
</span><a href="#local-6989586621679108323"><span class="hs-identifier hs-var">cookie_jar</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Response BodyReader
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Response BodyReader
-&gt; Request
-&gt; UTCTime
-&gt; CookieJar
-&gt; (CookieJar, Response BodyReader)
forall a.
Response a
-&gt; Request -&gt; UTCTime -&gt; CookieJar -&gt; (CookieJar, Response a)
</span><a href="Network.HTTP.Client.Cookies.html#updateCookieJar"><span class="hs-identifier hs-var">updateCookieJar</span></a></span><span> </span><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108321"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108292"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679108322"><span class="hs-identifier hs-var">now'</span></a></span><span> </span><span class="annot"><span class="annottext">CookieJar
</span><a href="#local-6989586621679108293"><span class="hs-identifier hs-var">cookie_jar'</span></a></span><span>
</span><span id="line-127"></span><span>                </span><span class="annot"><span class="annottext">(Request, Response BodyReader) -&gt; IO (Request, Response BodyReader)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108292"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108321"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Network.HTTP.Client.Types.html#responseCookieJar"><span class="hs-identifier hs-var">responseCookieJar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679108323"><span class="hs-identifier hs-type">cookie_jar</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>            </span><span class="annot"><span class="annottext">Maybe CookieJar
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Request, Response BodyReader) -&gt; IO (Request, Response BodyReader)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108292"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108321"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-130"></span><span>    </span><span id="local-6989586621679108302"><span class="annot"><span class="annottext">getConnectionWrapper :: Maybe Int
-&gt; IO (Managed resource) -&gt; IO (Maybe a, Managed resource)
</span><a href="#local-6989586621679108302"><span class="hs-identifier hs-var hs-var">getConnectionWrapper</span></a></span></span><span> </span><span id="local-6989586621679108346"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679108346"><span class="hs-identifier hs-var">mtimeout</span></a></span></span><span> </span><span id="local-6989586621679108347"><span class="annot"><span class="annottext">IO (Managed resource)
</span><a href="#local-6989586621679108347"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-131"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679108346"><span class="hs-identifier hs-var">mtimeout</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-132"></span><span>            </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Managed resource -&gt; (Maybe a, Managed resource))
-&gt; IO (Managed resource) -&gt; IO (Maybe a, Managed resource)
forall a b. (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO (Managed resource)
</span><a href="#local-6989586621679108347"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-133"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679108348"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679108348"><span class="hs-identifier hs-var">timeout'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-134"></span><span>                </span><span id="local-6989586621679108349"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679108349"><span class="hs-identifier hs-var">before</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><span class="hs-identifier hs-var">getCurrentTime</span></span><span>
</span><span id="line-135"></span><span>                </span><span id="local-6989586621679108350"><span class="annot"><span class="annottext">Maybe (Managed resource)
</span><a href="#local-6989586621679108350"><span class="hs-identifier hs-var">mres</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO (Managed resource) -&gt; IO (Maybe (Managed resource))
forall a. Int -&gt; IO a -&gt; IO (Maybe a)
</span><span class="hs-identifier hs-var">timeout</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679108348"><span class="hs-identifier hs-var">timeout'</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Managed resource)
</span><a href="#local-6989586621679108347"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-136"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Managed resource)
</span><a href="#local-6989586621679108350"><span class="hs-identifier hs-var">mres</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-137"></span><span>                     </span><span class="annot"><span class="annottext">Maybe (Managed resource)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HttpExceptionContent -&gt; IO (Maybe a, Managed resource)
forall a. HttpExceptionContent -&gt; IO a
</span><a href="Network.HTTP.Client.Types.html#throwHttp"><span class="hs-identifier hs-var">throwHttp</span></a></span><span> </span><span class="annot"><span class="annottext">HttpExceptionContent
</span><a href="Network.HTTP.Client.Types.html#ConnectionTimeout"><span class="hs-identifier hs-var">ConnectionTimeout</span></a></span><span>
</span><span id="line-138"></span><span>                     </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679108353"><span class="annot"><span class="annottext">Managed resource
</span><a href="#local-6989586621679108353"><span class="hs-identifier hs-var">mConn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-139"></span><span>                         </span><span id="local-6989586621679108354"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679108354"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><span class="hs-identifier hs-var">getCurrentTime</span></span><span>
</span><span id="line-140"></span><span>                         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679108358"><span class="annot"><span class="annottext">timeSpentMicro :: NominalDiffTime
</span><a href="#local-6989586621679108358"><span class="hs-identifier hs-var hs-var">timeSpentMicro</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; NominalDiffTime
</span><span class="hs-identifier hs-var">diffUTCTime</span></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679108354"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679108349"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; NominalDiffTime -&gt; NominalDiffTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><span class="hs-number">1000000</span></span><span>
</span><span id="line-141"></span><span>                             </span><span id="local-6989586621679108372"><span class="annot"><span class="annottext">remainingTime :: a
</span><a href="#local-6989586621679108372"><span class="hs-identifier hs-var hs-var">remainingTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; a
forall b. Integral b =&gt; NominalDiffTime -&gt; b
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="annot"><span class="annottext">(NominalDiffTime -&gt; a) -&gt; NominalDiffTime -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; NominalDiffTime
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679108348"><span class="hs-identifier hs-var">timeout'</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; NominalDiffTime -&gt; NominalDiffTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621679108358"><span class="hs-identifier hs-var">timeSpentMicro</span></a></span><span>
</span><span id="line-142"></span><span>                         </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679108372"><span class="hs-identifier hs-var">remainingTime</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span>
</span><span id="line-143"></span><span>                             </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-144"></span><span>                                 </span><span class="annot"><span class="annottext">Managed resource -&gt; Reuse -&gt; IO ()
forall resource. Managed resource -&gt; Reuse -&gt; IO ()
</span><a href="Data.KeyedPool.html#managedRelease"><span class="hs-identifier hs-var">managedRelease</span></a></span><span> </span><span class="annot"><span class="annottext">Managed resource
</span><a href="#local-6989586621679108353"><span class="hs-identifier hs-var">mConn</span></a></span><span> </span><span class="annot"><span class="annottext">Reuse
</span><a href="Data.KeyedPool.html#DontReuse"><span class="hs-identifier hs-var">DontReuse</span></a></span><span>
</span><span id="line-145"></span><span>                                 </span><span class="annot"><span class="annottext">HttpExceptionContent -&gt; IO (Maybe a, Managed resource)
forall a. HttpExceptionContent -&gt; IO a
</span><a href="Network.HTTP.Client.Types.html#throwHttp"><span class="hs-identifier hs-var">throwHttp</span></a></span><span> </span><span class="annot"><span class="annottext">HttpExceptionContent
</span><a href="Network.HTTP.Client.Types.html#ConnectionTimeout"><span class="hs-identifier hs-var">ConnectionTimeout</span></a></span><span>
</span><span id="line-146"></span><span>                             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(Maybe a, Managed resource) -&gt; IO (Maybe a, Managed resource)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679108372"><span class="hs-identifier hs-var">remainingTime</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Managed resource
</span><a href="#local-6989586621679108353"><span class="hs-identifier hs-var">mConn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>    </span><span id="local-6989586621679108303"><span class="annot"><span class="annottext">responseTimeout' :: Request -&gt; Maybe Int
</span><a href="#local-6989586621679108303"><span class="hs-identifier hs-var hs-var">responseTimeout'</span></a></span></span><span> </span><span id="local-6989586621679108376"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108376"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-149"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Request -&gt; ResponseTimeout
</span><a href="Network.HTTP.Client.Types.html#responseTimeout"><span class="hs-identifier hs-var">responseTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108376"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-150"></span><span>            </span><span class="annot"><span class="annottext">ResponseTimeout
</span><a href="Network.HTTP.Client.Types.html#ResponseTimeoutDefault"><span class="hs-identifier hs-var">ResponseTimeoutDefault</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-151"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Manager -&gt; ResponseTimeout
</span><a href="Network.HTTP.Client.Types.html#mResponseTimeout"><span class="hs-identifier hs-var">mResponseTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108289"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-152"></span><span>                    </span><span class="annot"><span class="annottext">ResponseTimeout
</span><a href="Network.HTTP.Client.Types.html#ResponseTimeoutDefault"><span class="hs-identifier hs-var">ResponseTimeoutDefault</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30000000</span></span><span>
</span><span id="line-153"></span><span>                    </span><span class="annot"><span class="annottext">ResponseTimeout
</span><a href="Network.HTTP.Client.Types.html#ResponseTimeoutNone"><span class="hs-identifier hs-var">ResponseTimeoutNone</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-154"></span><span>                    </span><span class="annot"><a href="Network.HTTP.Client.Types.html#ResponseTimeoutMicro"><span class="hs-identifier hs-type">ResponseTimeoutMicro</span></a></span><span> </span><span id="local-6989586621679108382"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679108382"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679108382"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-155"></span><span>            </span><span class="annot"><span class="annottext">ResponseTimeout
</span><a href="Network.HTTP.Client.Types.html#ResponseTimeoutNone"><span class="hs-identifier hs-var">ResponseTimeoutNone</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-156"></span><span>            </span><span class="annot"><a href="Network.HTTP.Client.Types.html#ResponseTimeoutMicro"><span class="hs-identifier hs-type">ResponseTimeoutMicro</span></a></span><span> </span><span id="local-6989586621679108383"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679108383"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679108383"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-comment">-- | The used Manager can be overridden (by requestManagerOverride) and the used</span><span>
</span><span id="line-159"></span><span class="hs-comment">-- Request can be modified (through managerModifyRequest). This function allows</span><span>
</span><span id="line-160"></span><span class="hs-comment">-- to retrieve the possibly overridden Manager and the possibly modified</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- Request.</span><span>
</span><span id="line-162"></span><span class="hs-comment">--</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- (In case the Manager is overridden by requestManagerOverride, the Request is</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- being modified by managerModifyRequest of the new Manager, not the old one.)</span><span>
</span><span id="line-165"></span><span class="annot"><a href="Network.HTTP.Client.Core.html#getModifiedRequestManager"><span class="hs-identifier hs-type">getModifiedRequestManager</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Manager"><span class="hs-identifier hs-type">Manager</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Client.Types.html#Manager"><span class="hs-identifier hs-type">Manager</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span id="getModifiedRequestManager"><span class="annot"><span class="annottext">getModifiedRequestManager :: Manager -&gt; Request -&gt; IO (Manager, Request)
</span><a href="Network.HTTP.Client.Core.html#getModifiedRequestManager"><span class="hs-identifier hs-var hs-var">getModifiedRequestManager</span></a></span></span><span> </span><span id="local-6989586621679108384"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108384"><span class="hs-identifier hs-var">manager0</span></a></span></span><span> </span><span id="local-6989586621679108385"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108385"><span class="hs-identifier hs-var">req0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679108386"><span class="annot"><span class="annottext">manager :: Manager
</span><a href="#local-6989586621679108386"><span class="hs-identifier hs-var hs-var">manager</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Manager -&gt; Maybe Manager -&gt; Manager
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108384"><span class="hs-identifier hs-var">manager0</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; Maybe Manager
</span><a href="Network.HTTP.Client.Types.html#requestManagerOverride"><span class="hs-identifier hs-var">requestManagerOverride</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108385"><span class="hs-identifier hs-var">req0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>  </span><span id="local-6989586621679108388"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108388"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Manager -&gt; Request -&gt; IO Request
</span><a href="Network.HTTP.Client.Types.html#mModifyRequest"><span class="hs-identifier hs-var">mModifyRequest</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108386"><span class="hs-identifier hs-var">manager</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108385"><span class="hs-identifier hs-var">req0</span></a></span><span>
</span><span id="line-169"></span><span>  </span><span class="annot"><span class="annottext">(Manager, Request) -&gt; IO (Manager, Request)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108386"><span class="hs-identifier hs-var">manager</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108388"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-comment">-- | The most low-level function for initiating an HTTP request.</span><span>
</span><span id="line-172"></span><span class="hs-comment">--</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- The first argument to this function gives a full specification</span><span>
</span><span id="line-174"></span><span class="hs-comment">-- on the request: the host to connect to, whether to use SSL,</span><span>
</span><span id="line-175"></span><span class="hs-comment">-- headers, etc. Please see 'Request' for full details.  The</span><span>
</span><span id="line-176"></span><span class="hs-comment">-- second argument specifies which 'Manager' should be used.</span><span>
</span><span id="line-177"></span><span class="hs-comment">--</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- This function then returns a 'Response' with a</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- 'BodyReader'.  The 'Response' contains the status code</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- and headers that were sent back to us, and the</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- 'BodyReader' contains the body of the request.  Note</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- that this 'BodyReader' allows you to have fully</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- interleaved IO actions during your HTTP download, making it</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- possible to download very large responses in constant memory.</span><span>
</span><span id="line-185"></span><span class="hs-comment">--</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- An important note: the response body returned by this function represents a</span><span>
</span><span id="line-187"></span><span class="hs-comment">-- live HTTP connection. As such, if you do not use the response body, an open</span><span>
</span><span id="line-188"></span><span class="hs-comment">-- socket will be retained indefinitely. You must be certain to call</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- 'responseClose' on this response to free up resources.</span><span>
</span><span id="line-190"></span><span class="hs-comment">--</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- This function automatically performs any necessary redirects, as specified</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- by the 'redirectCount' setting.</span><span>
</span><span id="line-193"></span><span class="hs-comment">--</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- When implementing a (reverse) proxy using this function or relating</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- functions, it's wise to remove Transfer-Encoding:, Content-Length:,</span><span>
</span><span id="line-196"></span><span class="hs-comment">-- Content-Encoding: and Accept-Encoding: from request and response</span><span>
</span><span id="line-197"></span><span class="hs-comment">-- headers to be relayed.</span><span>
</span><span id="line-198"></span><span class="hs-comment">--</span><span>
</span><span id="line-199"></span><span class="hs-comment">-- Since 0.1.0</span><span>
</span><span id="line-200"></span><span class="annot"><a href="Network.HTTP.Client.Core.html#responseOpen"><span class="hs-identifier hs-type">responseOpen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Manager"><span class="hs-identifier hs-type">Manager</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Client.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#BodyReader"><span class="hs-identifier hs-type">BodyReader</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span id="responseOpen"><span class="annot"><span class="annottext">responseOpen :: Request -&gt; Manager -&gt; IO (Response BodyReader)
</span><a href="Network.HTTP.Client.Core.html#responseOpen"><span class="hs-identifier hs-var hs-var">responseOpen</span></a></span></span><span> </span><span id="local-6989586621679108393"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108393"><span class="hs-identifier hs-var">inputReq</span></a></span></span><span> </span><span id="local-6989586621679108394"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108394"><span class="hs-identifier hs-var">manager'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RequestHeaders -&gt; HeadersValidationResult
</span><a href="Network.HTTP.Client.Headers.html#validateHeaders"><span class="hs-identifier hs-var">validateHeaders</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; RequestHeaders
</span><a href="Network.HTTP.Client.Types.html#requestHeaders"><span class="hs-identifier hs-var">requestHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108393"><span class="hs-identifier hs-var">inputReq</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><span class="annottext">HeadersValidationResult
</span><a href="Network.HTTP.Client.Headers.html#GoodHeaders"><span class="hs-identifier hs-var">GoodHeaders</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><a href="Network.HTTP.Client.Headers.html#BadHeaders"><span class="hs-identifier hs-type">BadHeaders</span></a></span><span> </span><span id="local-6989586621679108399"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679108399"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HttpExceptionContent -&gt; IO ()
forall a. HttpExceptionContent -&gt; IO a
</span><a href="Network.HTTP.Client.Types.html#throwHttp"><span class="hs-identifier hs-var">throwHttp</span></a></span><span> </span><span class="annot"><span class="annottext">(HttpExceptionContent -&gt; IO ()) -&gt; HttpExceptionContent -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; HttpExceptionContent
</span><a href="Network.HTTP.Client.Types.html#InvalidRequestHeader"><span class="hs-identifier hs-var">InvalidRequestHeader</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679108399"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679108401"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108401"><span class="hs-identifier hs-var">manager</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679108402"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108402"><span class="hs-identifier hs-var">req0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Manager -&gt; Request -&gt; IO (Manager, Request)
</span><a href="Network.HTTP.Client.Core.html#getModifiedRequestManager"><span class="hs-identifier hs-var">getModifiedRequestManager</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108394"><span class="hs-identifier hs-var">manager'</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108393"><span class="hs-identifier hs-var">inputReq</span></a></span><span>
</span><span id="line-206"></span><span>  </span><span class="annot"><span class="annottext">Request -&gt; IO (Response BodyReader) -&gt; IO (Response BodyReader)
forall a. Request -&gt; IO a -&gt; IO a
</span><a href="#local-6989586621679108403"><span class="hs-identifier hs-var">wrapExc</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108402"><span class="hs-identifier hs-var">req0</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Response BodyReader) -&gt; IO (Response BodyReader))
-&gt; IO (Response BodyReader) -&gt; IO (Response BodyReader)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Manager -&gt; forall a. Request -&gt; IO a -&gt; IO a
</span><a href="Network.HTTP.Client.Types.html#mWrapException"><span class="hs-identifier hs-var">mWrapException</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108401"><span class="hs-identifier hs-var">manager</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108402"><span class="hs-identifier hs-var">req0</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Response BodyReader) -&gt; IO (Response BodyReader))
-&gt; IO (Response BodyReader) -&gt; IO (Response BodyReader)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679108405"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108405"><span class="hs-identifier hs-var">req</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679108406"><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108406"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Manager -&gt; Int -&gt; Request -&gt; IO (Request, Response BodyReader)
</span><a href="#local-6989586621679108407"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108401"><span class="hs-identifier hs-var">manager</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; Int
</span><a href="Network.HTTP.Client.Types.html#redirectCount"><span class="hs-identifier hs-var">redirectCount</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108402"><span class="hs-identifier hs-var">req0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108402"><span class="hs-identifier hs-var">req0</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><span class="annottext">Request -&gt; Request -&gt; Response BodyReader -&gt; IO ()
</span><a href="Network.HTTP.Client.Types.html#checkResponse"><span class="hs-identifier hs-var">checkResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108405"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108405"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108406"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-209"></span><span>    </span><span class="annot"><span class="annottext">Manager -&gt; Response BodyReader -&gt; IO (Response BodyReader)
</span><a href="Network.HTTP.Client.Types.html#mModifyResponse"><span class="hs-identifier hs-var">mModifyResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108401"><span class="hs-identifier hs-var">manager</span></a></span><span> </span><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108406"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-210"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#responseBody"><span class="hs-identifier hs-var">responseBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679108403"><span class="hs-identifier hs-type">wrapExc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108402"><span class="hs-identifier hs-type">req0</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Client.Types.html#responseBody"><span class="hs-identifier hs-var">responseBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108406"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621679108176"><span class="annot"><a href="#local-6989586621679108403"><span class="hs-identifier hs-type">wrapExc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679108176"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679108176"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-214"></span><span>    </span><span id="local-6989586621679108403"><span class="annot"><span class="annottext">wrapExc :: forall a. Request -&gt; IO a -&gt; IO a
</span><a href="#local-6989586621679108403"><span class="hs-identifier hs-var hs-var">wrapExc</span></a></span></span><span> </span><span id="local-6989586621679108412"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108412"><span class="hs-identifier hs-var">req0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HttpExceptionContentWrapper -&gt; IO a) -&gt; IO a -&gt; IO a
forall e a. Exception e =&gt; (e -&gt; IO a) -&gt; IO a -&gt; IO a
</span><span class="hs-identifier hs-var">handle</span></span><span> </span><span class="annot"><span class="annottext">((HttpExceptionContentWrapper -&gt; IO a) -&gt; IO a -&gt; IO a)
-&gt; (HttpExceptionContentWrapper -&gt; IO a) -&gt; IO a -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HttpException -&gt; IO a
forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(HttpException -&gt; IO a)
-&gt; (HttpExceptionContentWrapper -&gt; HttpException)
-&gt; HttpExceptionContentWrapper
-&gt; IO a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; HttpExceptionContentWrapper -&gt; HttpException
</span><a href="Network.HTTP.Client.Types.html#toHttpException"><span class="hs-identifier hs-var">toHttpException</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108412"><span class="hs-identifier hs-var">req0</span></a></span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span>    </span><span id="local-6989586621679108407"><span class="annot"><span class="annottext">go :: Manager -&gt; Int -&gt; Request -&gt; IO (Request, Response BodyReader)
</span><a href="#local-6989586621679108407"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679108418"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108418"><span class="hs-identifier hs-var">manager0</span></a></span></span><span> </span><span id="local-6989586621679108419"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679108419"><span class="hs-identifier hs-var">count</span></a></span></span><span> </span><span id="local-6989586621679108420"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108420"><span class="hs-identifier hs-var">req'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; (Request -&gt; IO (Response BodyReader, Request, Bool))
-&gt; Request
-&gt; IO (Request, Response BodyReader)
</span><a href="Network.HTTP.Client.Core.html#httpRedirect%27"><span class="hs-identifier hs-var">httpRedirect'</span></a></span><span>
</span><span id="line-217"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679108419"><span class="hs-identifier hs-var">count</span></a></span><span>
</span><span id="line-218"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679108421"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108421"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-219"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679108422"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108422"><span class="hs-identifier hs-var">manager</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679108423"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108423"><span class="hs-identifier hs-var">modReq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Manager -&gt; Request -&gt; IO (Manager, Request)
</span><a href="Network.HTTP.Client.Core.html#getModifiedRequestManager"><span class="hs-identifier hs-var">getModifiedRequestManager</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108418"><span class="hs-identifier hs-var">manager0</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108421"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-220"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679108424"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108424"><span class="hs-identifier hs-var">req''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679108425"><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108425"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Request -&gt; Manager -&gt; IO (Request, Response BodyReader)
</span><a href="Network.HTTP.Client.Core.html#httpRaw%27"><span class="hs-identifier hs-var">httpRaw'</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108423"><span class="hs-identifier hs-var">modReq</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108422"><span class="hs-identifier hs-var">manager</span></a></span><span>
</span><span id="line-221"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679108429"><span class="annot"><span class="annottext">mreq :: Maybe Request
</span><a href="#local-6989586621679108429"><span class="hs-identifier hs-var hs-var">mreq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Request -&gt; Int
</span><a href="Network.HTTP.Client.Types.html#redirectCount"><span class="hs-identifier hs-var">redirectCount</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108423"><span class="hs-identifier hs-var">modReq</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-222"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe Request
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-223"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Request
-&gt; Request -&gt; RequestHeaders -&gt; CookieJar -&gt; Int -&gt; Maybe Request
</span><a href="Network.HTTP.Client.Response.html#getRedirectedRequest"><span class="hs-identifier hs-var">getRedirectedRequest</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108420"><span class="hs-identifier hs-var">req'</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108424"><span class="hs-identifier hs-var">req''</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Response BodyReader -&gt; RequestHeaders
forall body. Response body -&gt; RequestHeaders
</span><a href="Network.HTTP.Client.Types.html#responseHeaders"><span class="hs-identifier hs-var">responseHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108425"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Response BodyReader -&gt; CookieJar
forall body. Response body -&gt; CookieJar
</span><a href="Network.HTTP.Client.Types.html#responseCookieJar"><span class="hs-identifier hs-var">responseCookieJar</span></a></span><span> </span><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108425"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status -&gt; Int
</span><span class="hs-identifier hs-var">statusCode</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Response BodyReader -&gt; Status
forall body. Response body -&gt; Status
</span><a href="Network.HTTP.Client.Types.html#responseStatus"><span class="hs-identifier hs-var">responseStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108425"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>        </span><span class="annot"><span class="annottext">(Response BodyReader, Request, Bool)
-&gt; IO (Response BodyReader, Request, Bool)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108425"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Request -&gt; Maybe Request -&gt; Request
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108424"><span class="hs-identifier hs-var">req''</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Request
</span><a href="#local-6989586621679108429"><span class="hs-identifier hs-var">mreq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Request -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe Request
</span><a href="#local-6989586621679108429"><span class="hs-identifier hs-var">mreq</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>      </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108420"><span class="hs-identifier hs-var">req'</span></a></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="annot"><span class="hs-comment">-- | Redirect loop.</span></span><span>
</span><span id="line-228"></span><span class="annot"><a href="Network.HTTP.Client.Core.html#httpRedirect"><span class="hs-identifier hs-type">httpRedirect</span></a></span><span>
</span><span id="line-229"></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ 'redirectCount'</span></span><span>
</span><span id="line-230"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Client.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Client.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#BodyReader"><span class="hs-identifier hs-type">BodyReader</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ function which performs a request and returns a response, and possibly another request if there's a redirect.</span></span><span>
</span><span id="line-231"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span>
</span><span id="line-232"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Client.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#BodyReader"><span class="hs-identifier hs-type">BodyReader</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span id="httpRedirect"><span class="annot"><span class="annottext">httpRedirect :: Int
-&gt; (Request -&gt; IO (Response BodyReader, Maybe Request))
-&gt; Request
-&gt; IO (Response BodyReader)
</span><a href="Network.HTTP.Client.Core.html#httpRedirect"><span class="hs-identifier hs-var hs-var">httpRedirect</span></a></span></span><span> </span><span id="local-6989586621679108434"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679108434"><span class="hs-identifier hs-var">count0</span></a></span></span><span> </span><span id="local-6989586621679108435"><span class="annot"><span class="annottext">Request -&gt; IO (Response BodyReader, Maybe Request)
</span><a href="#local-6989586621679108435"><span class="hs-identifier hs-var">http0</span></a></span></span><span> </span><span id="local-6989586621679108436"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108436"><span class="hs-identifier hs-var">req0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Request, Response BodyReader) -&gt; Response BodyReader)
-&gt; IO (Request, Response BodyReader) -&gt; IO (Response BodyReader)
forall a b. (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(Request, Response BodyReader) -&gt; Response BodyReader
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(IO (Request, Response BodyReader) -&gt; IO (Response BodyReader))
-&gt; IO (Request, Response BodyReader) -&gt; IO (Response BodyReader)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; (Request -&gt; IO (Response BodyReader, Request, Bool))
-&gt; Request
-&gt; IO (Request, Response BodyReader)
</span><a href="Network.HTTP.Client.Core.html#httpRedirect%27"><span class="hs-identifier hs-var">httpRedirect'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679108434"><span class="hs-identifier hs-var">count0</span></a></span><span> </span><span class="annot"><span class="annottext">Request -&gt; IO (Response BodyReader, Request, Bool)
</span><a href="#local-6989586621679108437"><span class="hs-identifier hs-var">http'</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108436"><span class="hs-identifier hs-var">req0</span></a></span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-comment">-- adapt callback API</span><span>
</span><span id="line-236"></span><span>    </span><span id="local-6989586621679108437"><span class="annot"><span class="annottext">http' :: Request -&gt; IO (Response BodyReader, Request, Bool)
</span><a href="#local-6989586621679108437"><span class="hs-identifier hs-var hs-var">http'</span></a></span></span><span> </span><span id="local-6989586621679108440"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108440"><span class="hs-identifier hs-var">req'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-237"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679108441"><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108441"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679108442"><span class="annot"><span class="annottext">Maybe Request
</span><a href="#local-6989586621679108442"><span class="hs-identifier hs-var">mbReq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Request -&gt; IO (Response BodyReader, Maybe Request)
</span><a href="#local-6989586621679108435"><span class="hs-identifier hs-var">http0</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108440"><span class="hs-identifier hs-var">req'</span></a></span><span>
</span><span id="line-238"></span><span>        </span><span class="annot"><span class="annottext">(Response BodyReader, Request, Bool)
-&gt; IO (Response BodyReader, Request, Bool)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108441"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Request -&gt; Maybe Request -&gt; Request
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108436"><span class="hs-identifier hs-var">req0</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Request
</span><a href="#local-6989586621679108442"><span class="hs-identifier hs-var">mbReq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Request -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe Request
</span><a href="#local-6989586621679108442"><span class="hs-identifier hs-var">mbReq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span class="annot"><a href="Network.HTTP.Client.Core.html#handleClosedRead"><span class="hs-identifier hs-type">handleClosedRead</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span><span>
</span><span id="line-241"></span><span id="handleClosedRead"><span class="annot"><span class="annottext">handleClosedRead :: SomeException -&gt; IO ByteString
</span><a href="Network.HTTP.Client.Core.html#handleClosedRead"><span class="hs-identifier hs-var hs-var">handleClosedRead</span></a></span></span><span> </span><span id="local-6989586621679108443"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679108443"><span class="hs-identifier hs-var">se</span></a></span></span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">HttpExceptionContent
</span><a href="Network.HTTP.Client.Types.html#ConnectionClosed"><span class="hs-identifier hs-var">ConnectionClosed</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HttpExceptionContentWrapper -&gt; HttpExceptionContent)
-&gt; Maybe HttpExceptionContentWrapper -&gt; Maybe HttpExceptionContent
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">HttpExceptionContentWrapper -&gt; HttpExceptionContent
</span><a href="Network.HTTP.Client.Types.html#unHttpExceptionContentWrapper"><span class="hs-identifier hs-var">unHttpExceptionContentWrapper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeException -&gt; Maybe HttpExceptionContentWrapper
forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><span class="hs-identifier hs-var">fromException</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679108443"><span class="hs-identifier hs-var">se</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier hs-var">L.empty</span></span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Client.Types.html#HttpExceptionRequest"><span class="hs-identifier hs-type">HttpExceptionRequest</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HttpExceptionContent
</span><a href="Network.HTTP.Client.Types.html#ConnectionClosed"><span class="hs-identifier hs-var">ConnectionClosed</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe HttpException
forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><span class="hs-identifier hs-var">fromException</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679108443"><span class="hs-identifier hs-var">se</span></a></span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier hs-var">L.empty</span></span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IOError</span></span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IOErrorType
</span><span class="hs-identifier hs-var">ResourceVanished</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe CInt
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe IOException
forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><span class="hs-identifier hs-var">fromException</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679108443"><span class="hs-identifier hs-var">se</span></a></span><span>
</span><span id="line-247"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier hs-var">L.empty</span></span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-249"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; IO ByteString
forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679108443"><span class="hs-identifier hs-var">se</span></a></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="hs-comment">-- | Redirect loop.</span><span>
</span><span id="line-252"></span><span class="hs-comment">--</span><span>
</span><span id="line-253"></span><span class="hs-comment">-- This extended version of 'httpRaw' also returns the Request potentially modified by @managerModifyRequest@.</span><span>
</span><span id="line-254"></span><span class="annot"><a href="Network.HTTP.Client.Core.html#httpRedirect%27"><span class="hs-identifier hs-type">httpRedirect'</span></a></span><span>
</span><span id="line-255"></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ 'redirectCount'</span></span><span>
</span><span id="line-256"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Client.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Client.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#BodyReader"><span class="hs-identifier hs-type">BodyReader</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ function which performs a request and returns a response, the potentially modified request, and a Bool indicating if there was a redirect.</span></span><span>
</span><span id="line-257"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span>
</span><span id="line-258"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Client.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#BodyReader"><span class="hs-identifier hs-type">BodyReader</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span id="httpRedirect%27"><span class="annot"><span class="annottext">httpRedirect' :: Int
-&gt; (Request -&gt; IO (Response BodyReader, Request, Bool))
-&gt; Request
-&gt; IO (Request, Response BodyReader)
</span><a href="Network.HTTP.Client.Core.html#httpRedirect%27"><span class="hs-identifier hs-var hs-var">httpRedirect'</span></a></span></span><span> </span><span id="local-6989586621679108451"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679108451"><span class="hs-identifier hs-var">count0</span></a></span></span><span> </span><span id="local-6989586621679108452"><span class="annot"><span class="annottext">Request -&gt; IO (Response BodyReader, Request, Bool)
</span><a href="#local-6989586621679108452"><span class="hs-identifier hs-var">http'</span></a></span></span><span> </span><span id="local-6989586621679108453"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108453"><span class="hs-identifier hs-var">req0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Request
-&gt; [Response ByteString]
-&gt; IO (Request, Response BodyReader)
forall {t}.
(Ord t, Num t) =&gt;
t
-&gt; Request
-&gt; [Response ByteString]
-&gt; IO (Request, Response BodyReader)
</span><a href="#local-6989586621679108454"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679108451"><span class="hs-identifier hs-var">count0</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108453"><span class="hs-identifier hs-var">req0</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-261"></span><span>    </span><span id="local-6989586621679108454"><span class="annot"><span class="annottext">go :: t
-&gt; Request
-&gt; [Response ByteString]
-&gt; IO (Request, Response BodyReader)
</span><a href="#local-6989586621679108454"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679108468"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679108468"><span class="hs-identifier hs-var">count</span></a></span></span><span> </span><span class="annot"><span class="annottext">Request
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679108469"><span class="annot"><span class="annottext">[Response ByteString]
</span><a href="#local-6989586621679108469"><span class="hs-identifier hs-var">ress</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679108468"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HttpExceptionContent -&gt; IO (Request, Response BodyReader)
forall a. HttpExceptionContent -&gt; IO a
</span><a href="Network.HTTP.Client.Types.html#throwHttp"><span class="hs-identifier hs-var">throwHttp</span></a></span><span> </span><span class="annot"><span class="annottext">(HttpExceptionContent -&gt; IO (Request, Response BodyReader))
-&gt; HttpExceptionContent -&gt; IO (Request, Response BodyReader)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Response ByteString] -&gt; HttpExceptionContent
</span><a href="Network.HTTP.Client.Types.html#TooManyRedirects"><span class="hs-identifier hs-var">TooManyRedirects</span></a></span><span> </span><span class="annot"><span class="annottext">[Response ByteString]
</span><a href="#local-6989586621679108469"><span class="hs-identifier hs-var">ress</span></a></span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><a href="#local-6989586621679108454"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679108472"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679108472"><span class="hs-identifier hs-var">count</span></a></span></span><span> </span><span id="local-6989586621679108473"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108473"><span class="hs-identifier hs-var">req'</span></a></span></span><span> </span><span id="local-6989586621679108474"><span class="annot"><span class="annottext">[Response ByteString]
</span><a href="#local-6989586621679108474"><span class="hs-identifier hs-var">ress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-263"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679108475"><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108475"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679108476"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108476"><span class="hs-identifier hs-var">req</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679108477"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679108477"><span class="hs-identifier hs-var">isRedirect</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Request -&gt; IO (Response BodyReader, Request, Bool)
</span><a href="#local-6989586621679108452"><span class="hs-identifier hs-var">http'</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108473"><span class="hs-identifier hs-var">req'</span></a></span><span>
</span><span id="line-264"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679108477"><span class="hs-identifier hs-var">isRedirect</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-265"></span><span>            </span><span class="hs-comment">-- Allow the original connection to return to the</span><span>
</span><span id="line-266"></span><span>            </span><span class="hs-comment">-- connection pool immediately by flushing the body.</span><span>
</span><span id="line-267"></span><span>            </span><span class="hs-comment">-- If the response body is too large, don't flush, but</span><span>
</span><span id="line-268"></span><span>            </span><span class="hs-comment">-- instead just close the connection.</span><span>
</span><span id="line-269"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679108479"><span class="annot"><span class="annottext">maxFlush :: Int
</span><a href="#local-6989586621679108479"><span class="hs-identifier hs-var hs-var">maxFlush</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1024</span></span><span>
</span><span id="line-270"></span><span>            </span><span id="local-6989586621679108480"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679108480"><span class="hs-identifier hs-var">lbs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BodyReader -&gt; Int -&gt; IO ByteString
</span><a href="Network.HTTP.Client.Body.html#brReadSome"><span class="hs-identifier hs-var">brReadSome</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Response BodyReader -&gt; BodyReader
forall body. Response body -&gt; body
</span><a href="Network.HTTP.Client.Types.html#responseBody"><span class="hs-identifier hs-var">responseBody</span></a></span><span> </span><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108475"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679108479"><span class="hs-identifier hs-var">maxFlush</span></a></span><span>
</span><span id="line-271"></span><span>                </span><span class="hs-comment">-- The connection may already be closed, e.g.</span><span>
</span><span id="line-272"></span><span>                </span><span class="hs-comment">-- when using withResponseHistory. See</span><span>
</span><span id="line-273"></span><span>                </span><span class="hs-comment">-- https://github.com/snoyberg/http-client/issues/169</span><span>
</span><span id="line-274"></span><span>                </span><span class="annot"><span class="annottext">IO ByteString -&gt; (SomeException -&gt; IO ByteString) -&gt; IO ByteString
forall e a. Exception e =&gt; IO a -&gt; (e -&gt; IO a) -&gt; IO a
</span><span class="hs-operator hs-var">`Control.Exception.catch`</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; IO ByteString
</span><a href="Network.HTTP.Client.Core.html#handleClosedRead"><span class="hs-identifier hs-var">handleClosedRead</span></a></span><span>
</span><span id="line-275"></span><span>            </span><span class="annot"><span class="annottext">Response BodyReader -&gt; IO ()
forall a. Response a -&gt; IO ()
</span><a href="Network.HTTP.Client.Core.html#responseClose"><span class="hs-identifier hs-var">responseClose</span></a></span><span> </span><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108475"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span>            </span><span class="hs-comment">-- And now perform the actual redirect</span><span>
</span><span id="line-278"></span><span>            </span><span class="annot"><span class="annottext">t
-&gt; Request
-&gt; [Response ByteString]
-&gt; IO (Request, Response BodyReader)
</span><a href="#local-6989586621679108454"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679108472"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108476"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108475"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#responseBody"><span class="hs-identifier hs-var">responseBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679108480"><span class="hs-identifier hs-type">lbs</span></a></span><span> </span><span class="hs-special">}</span><span class="annot"><span class="annottext">Response ByteString
-&gt; [Response ByteString] -&gt; [Response ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Response ByteString]
</span><a href="#local-6989586621679108474"><span class="hs-identifier hs-var">ress</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-280"></span><span>            </span><span class="annot"><span class="annottext">(Request, Response BodyReader) -&gt; IO (Request, Response BodyReader)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108476"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Response BodyReader
</span><a href="#local-6989586621679108475"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="hs-comment">-- | Close any open resources associated with the given @Response@. In general,</span><span>
</span><span id="line-283"></span><span class="hs-comment">-- this will either close an active @Connection@ or return it to the @Manager@</span><span>
</span><span id="line-284"></span><span class="hs-comment">-- to be reused.</span><span>
</span><span id="line-285"></span><span class="hs-comment">--</span><span>
</span><span id="line-286"></span><span class="hs-comment">-- Since 0.1.0</span><span>
</span><span id="line-287"></span><span id="local-6989586621679108123"><span class="annot"><a href="Network.HTTP.Client.Core.html#responseClose"><span class="hs-identifier hs-type">responseClose</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108123"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-288"></span><span id="responseClose"><span class="annot"><span class="annottext">responseClose :: forall a. Response a -&gt; IO ()
</span><a href="Network.HTTP.Client.Core.html#responseClose"><span class="hs-identifier hs-var hs-var">responseClose</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResponseClose -&gt; IO ()
</span><a href="Network.HTTP.Client.Types.html#runResponseClose"><span class="hs-identifier hs-var">runResponseClose</span></a></span><span> </span><span class="annot"><span class="annottext">(ResponseClose -&gt; IO ())
-&gt; (Response a -&gt; ResponseClose) -&gt; Response a -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Response a -&gt; ResponseClose
forall body. Response body -&gt; ResponseClose
</span><a href="Network.HTTP.Client.Types.html#responseClose%27"><span class="hs-identifier hs-var">responseClose'</span></a></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span class="hs-comment">-- | Perform an action using a @Connection@ acquired from the given @Manager@.</span><span>
</span><span id="line-291"></span><span class="hs-comment">--</span><span>
</span><span id="line-292"></span><span class="hs-comment">-- You should use this only when you have to read and write interactively</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- through the connection (e.g. connection by the WebSocket protocol).</span><span>
</span><span id="line-294"></span><span class="hs-comment">--</span><span>
</span><span id="line-295"></span><span class="hs-comment">-- @since 0.5.13</span><span>
</span><span id="line-296"></span><span id="local-6989586621679108196"><span class="annot"><a href="Network.HTTP.Client.Core.html#withConnection"><span class="hs-identifier hs-type">withConnection</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Types.html#Manager"><span class="hs-identifier hs-type">Manager</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Client.Types.html#Connection"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679108196"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679108196"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-297"></span><span id="withConnection"><span class="annot"><span class="annottext">withConnection :: forall a. Request -&gt; Manager -&gt; (Connection -&gt; IO a) -&gt; IO a
</span><a href="Network.HTTP.Client.Core.html#withConnection"><span class="hs-identifier hs-var hs-var">withConnection</span></a></span></span><span> </span><span id="local-6989586621679108488"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108488"><span class="hs-identifier hs-var">origReq</span></a></span></span><span> </span><span id="local-6989586621679108489"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108489"><span class="hs-identifier hs-var">man</span></a></span></span><span> </span><span id="local-6989586621679108490"><span class="annot"><span class="annottext">Connection -&gt; IO a
</span><a href="#local-6989586621679108490"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-298"></span><span>    </span><span id="local-6989586621679108491"><span class="annot"><span class="annottext">Managed Connection
</span><a href="#local-6989586621679108491"><span class="hs-identifier hs-var">mHttpConn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Request -&gt; Manager -&gt; IO (Managed Connection)
</span><a href="Network.HTTP.Client.Manager.html#getConn"><span class="hs-identifier hs-var">getConn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Manager -&gt; Request -&gt; Request
</span><a href="Network.HTTP.Client.Types.html#mSetProxy"><span class="hs-identifier hs-var">mSetProxy</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108489"><span class="hs-identifier hs-var">man</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108488"><span class="hs-identifier hs-var">origReq</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679108489"><span class="hs-identifier hs-var">man</span></a></span><span>
</span><span id="line-299"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; IO a
</span><a href="#local-6989586621679108490"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Managed Connection -&gt; Connection
forall resource. Managed resource -&gt; resource
</span><a href="Data.KeyedPool.html#managedResource"><span class="hs-identifier hs-var">managedResource</span></a></span><span> </span><span class="annot"><span class="annottext">Managed Connection
</span><a href="#local-6989586621679108491"><span class="hs-identifier hs-var">mHttpConn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO () -&gt; IO a
forall a b. IO a -&gt; IO b -&gt; IO a
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">Managed Connection -&gt; IO ()
forall resource. Managed resource -&gt; IO ()
</span><a href="Data.KeyedPool.html#keepAlive"><span class="hs-identifier hs-var">keepAlive</span></a></span><span> </span><span class="annot"><span class="annottext">Managed Connection
</span><a href="#local-6989586621679108491"><span class="hs-identifier hs-var">mHttpConn</span></a></span><span>
</span><span id="line-300"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO a
</span><span class="hs-operator hs-var">`finally`</span></span><span> </span><span class="annot"><span class="annottext">Managed Connection -&gt; Reuse -&gt; IO ()
forall resource. Managed resource -&gt; Reuse -&gt; IO ()
</span><a href="Data.KeyedPool.html#managedRelease"><span class="hs-identifier hs-var">managedRelease</span></a></span><span> </span><span class="annot"><span class="annottext">Managed Connection
</span><a href="#local-6989586621679108491"><span class="hs-identifier hs-var">mHttpConn</span></a></span><span> </span><span class="annot"><span class="annottext">Reuse
</span><a href="Data.KeyedPool.html#DontReuse"><span class="hs-identifier hs-var">DontReuse</span></a></span><span>
</span><span id="line-301"></span></pre></body></html>