<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="annot"><span class="hs-comment">-- | A left-unique relation.</span></span><span>
</span><span id="line-2"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Util.BiMultimap</span><span>
</span><span id="line-3"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier">BiMultimap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-4"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#empty"><span class="hs-identifier">Unison.Util.BiMultimap.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Basic queries</span></span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#isEmpty"><span class="hs-identifier">isEmpty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Lookup</span></span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#memberDom"><span class="hs-identifier">memberDom</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#lookupDom"><span class="hs-identifier">lookupDom</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#lookupRan"><span class="hs-identifier">lookupRan</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#unsafeLookupRan"><span class="hs-identifier">unsafeLookupRan</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#lookupPreimage"><span class="hs-identifier">lookupPreimage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Mapping / traversing</span></span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#unsafeTraverseDom"><span class="hs-identifier">unsafeTraverseDom</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Filtering</span></span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#filter"><span class="hs-identifier">filter</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#filterDom"><span class="hs-identifier">filterDom</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#filterDomain"><span class="hs-identifier">filterDomain</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#restrictDom"><span class="hs-identifier">restrictDom</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#restrictRan"><span class="hs-identifier">restrictRan</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#withoutDom"><span class="hs-identifier">withoutDom</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#withoutRan"><span class="hs-identifier">withoutRan</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Maps</span></span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#domain"><span class="hs-identifier">domain</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#range"><span class="hs-identifier">range</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#unsafeFromDomain"><span class="hs-identifier">unsafeFromDomain</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#fromRange"><span class="hs-identifier">fromRange</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Sets</span></span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#dom"><span class="hs-identifier">dom</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#ran"><span class="hs-identifier">ran</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Relations</span></span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#toRelation"><span class="hs-identifier">toRelation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Insert</span></span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#insert"><span class="hs-identifier">insert</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#unsafeInsert"><span class="hs-identifier">unsafeInsert</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Union</span></span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><a href="Unison.Util.BiMultimap.html#unsafeUnion"><span class="hs-identifier">unsafeUnion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">where</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NESet</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set.NonEmpty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set.NonEmpty</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Util.Relation.html"><span class="hs-identifier">Unison.Util.Relation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Util.Relation.html#Relation"><span class="hs-identifier">Relation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Util.Relation.html"><span class="hs-identifier">Unison.Util.Relation</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Relation</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">filter</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">-- | A left-unique relation.</span><span>
</span><span id="line-61"></span><span class="hs-comment">--</span><span>
</span><span id="line-62"></span><span class="hs-comment">-- &quot;Left-unique&quot; means that for all @(x, y)@ in the relation, @y@ is related only to @x@.</span><span>
</span><span id="line-63"></span><span class="hs-keyword">data</span><span> </span><span id="BiMultimap"><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-var">BiMultimap</span></a></span></span><span> </span><span id="local-6989586621679121106"><span class="annot"><a href="#local-6989586621679121106"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679121107"><span class="annot"><a href="#local-6989586621679121107"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BiMultimap"><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-var">BiMultimap</span></a></span></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="toMultimap"><span class="annot"><span class="annottext">forall a b. BiMultimap a b -&gt; Map a (NESet b)
</span><a href="Unison.Util.BiMultimap.html#toMultimap"><span class="hs-identifier hs-var hs-var">toMultimap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679121106"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><a href="#local-6989586621679121107"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>    </span><span id="toMapR"><span class="annot"><span class="annottext">forall a b. BiMultimap a b -&gt; Map b a
</span><a href="Unison.Util.BiMultimap.html#toMapR"><span class="hs-identifier hs-var hs-var">toMapR</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679121107"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121106"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679121361"><span id="local-6989586621679121367"><span class="annot"><span class="annottext">BiMultimap a b -&gt; BiMultimap a b -&gt; Bool
(BiMultimap a b -&gt; BiMultimap a b -&gt; Bool)
-&gt; (BiMultimap a b -&gt; BiMultimap a b -&gt; Bool)
-&gt; Eq (BiMultimap a b)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall a b.
(Eq a, Eq b) =&gt;
BiMultimap a b -&gt; BiMultimap a b -&gt; Bool
$c== :: forall a b.
(Eq a, Eq b) =&gt;
BiMultimap a b -&gt; BiMultimap a b -&gt; Bool
== :: BiMultimap a b -&gt; BiMultimap a b -&gt; Bool
$c/= :: forall a b.
(Eq a, Eq b) =&gt;
BiMultimap a b -&gt; BiMultimap a b -&gt; Bool
/= :: BiMultimap a b -&gt; BiMultimap a b -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679121379"><span id="local-6989586621679121385"><span id="local-6989586621679121390"><span id="local-6989586621679121394"><span id="local-6989586621679121397"><span id="local-6989586621679121400"><span id="local-6989586621679121403"><span class="annot"><span class="annottext">Eq (BiMultimap a b)
Eq (BiMultimap a b) =&gt;
(BiMultimap a b -&gt; BiMultimap a b -&gt; Ordering)
-&gt; (BiMultimap a b -&gt; BiMultimap a b -&gt; Bool)
-&gt; (BiMultimap a b -&gt; BiMultimap a b -&gt; Bool)
-&gt; (BiMultimap a b -&gt; BiMultimap a b -&gt; Bool)
-&gt; (BiMultimap a b -&gt; BiMultimap a b -&gt; Bool)
-&gt; (BiMultimap a b -&gt; BiMultimap a b -&gt; BiMultimap a b)
-&gt; (BiMultimap a b -&gt; BiMultimap a b -&gt; BiMultimap a b)
-&gt; Ord (BiMultimap a b)
BiMultimap a b -&gt; BiMultimap a b -&gt; Bool
BiMultimap a b -&gt; BiMultimap a b -&gt; Ordering
BiMultimap a b -&gt; BiMultimap a b -&gt; BiMultimap a b
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall a b. (Ord a, Ord b) =&gt; Eq (BiMultimap a b)
forall a b.
(Ord a, Ord b) =&gt;
BiMultimap a b -&gt; BiMultimap a b -&gt; Bool
forall a b.
(Ord a, Ord b) =&gt;
BiMultimap a b -&gt; BiMultimap a b -&gt; Ordering
forall a b.
(Ord a, Ord b) =&gt;
BiMultimap a b -&gt; BiMultimap a b -&gt; BiMultimap a b
$ccompare :: forall a b.
(Ord a, Ord b) =&gt;
BiMultimap a b -&gt; BiMultimap a b -&gt; Ordering
compare :: BiMultimap a b -&gt; BiMultimap a b -&gt; Ordering
$c&lt; :: forall a b.
(Ord a, Ord b) =&gt;
BiMultimap a b -&gt; BiMultimap a b -&gt; Bool
&lt; :: BiMultimap a b -&gt; BiMultimap a b -&gt; Bool
$c&lt;= :: forall a b.
(Ord a, Ord b) =&gt;
BiMultimap a b -&gt; BiMultimap a b -&gt; Bool
&lt;= :: BiMultimap a b -&gt; BiMultimap a b -&gt; Bool
$c&gt; :: forall a b.
(Ord a, Ord b) =&gt;
BiMultimap a b -&gt; BiMultimap a b -&gt; Bool
&gt; :: BiMultimap a b -&gt; BiMultimap a b -&gt; Bool
$c&gt;= :: forall a b.
(Ord a, Ord b) =&gt;
BiMultimap a b -&gt; BiMultimap a b -&gt; Bool
&gt;= :: BiMultimap a b -&gt; BiMultimap a b -&gt; Bool
$cmax :: forall a b.
(Ord a, Ord b) =&gt;
BiMultimap a b -&gt; BiMultimap a b -&gt; BiMultimap a b
max :: BiMultimap a b -&gt; BiMultimap a b -&gt; BiMultimap a b
$cmin :: forall a b.
(Ord a, Ord b) =&gt;
BiMultimap a b -&gt; BiMultimap a b -&gt; BiMultimap a b
min :: BiMultimap a b -&gt; BiMultimap a b -&gt; BiMultimap a b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679121411"><span id="local-6989586621679121419"><span id="local-6989586621679121423"><span class="annot"><span class="annottext">Int -&gt; BiMultimap a b -&gt; ShowS
[BiMultimap a b] -&gt; ShowS
BiMultimap a b -&gt; String
(Int -&gt; BiMultimap a b -&gt; ShowS)
-&gt; (BiMultimap a b -&gt; String)
-&gt; ([BiMultimap a b] -&gt; ShowS)
-&gt; Show (BiMultimap a b)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall a b. (Show a, Show b) =&gt; Int -&gt; BiMultimap a b -&gt; ShowS
forall a b. (Show a, Show b) =&gt; [BiMultimap a b] -&gt; ShowS
forall a b. (Show a, Show b) =&gt; BiMultimap a b -&gt; String
$cshowsPrec :: forall a b. (Show a, Show b) =&gt; Int -&gt; BiMultimap a b -&gt; ShowS
showsPrec :: Int -&gt; BiMultimap a b -&gt; ShowS
$cshow :: forall a b. (Show a, Show b) =&gt; BiMultimap a b -&gt; String
show :: BiMultimap a b -&gt; String
$cshowList :: forall a b. (Show a, Show b) =&gt; [BiMultimap a b] -&gt; ShowS
showList :: [BiMultimap a b] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="annot"><span class="hs-comment">-- | An empty left-unique relation.</span></span><span>
</span><span id="line-70"></span><span id="local-6989586621679121140"><span id="local-6989586621679121141"><span class="annot"><a href="Unison.Util.BiMultimap.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121140"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121141"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121140"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121141"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-71"></span><span id="empty"><span class="annot"><span class="annottext">empty :: forall a b. (Ord a, Ord b) =&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#empty"><span class="hs-identifier hs-var hs-var">empty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map a (NESet b) -&gt; Map b a -&gt; BiMultimap a b
forall a b. Map a (NESet b) -&gt; Map b a -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-var">BiMultimap</span></a></span><span> </span><span class="annot"><span class="annottext">Map a (NESet b)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Map b a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="annot"><span class="hs-comment">-- | Is a left-unique relation empty?</span></span><span>
</span><span id="line-74"></span><span id="local-6989586621679121147"><span id="local-6989586621679121148"><span class="annot"><a href="Unison.Util.BiMultimap.html#isEmpty"><span class="hs-identifier hs-type">isEmpty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121147"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121148"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-75"></span><span id="isEmpty"><span class="annot"><span class="annottext">isEmpty :: forall a b. BiMultimap a b -&gt; Bool
</span><a href="Unison.Util.BiMultimap.html#isEmpty"><span class="hs-identifier hs-var hs-var">isEmpty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><span class="annottext">Map a (NESet b) -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.null</span></span><span> </span><span class="annot"><span class="annottext">(Map a (NESet b) -&gt; Bool)
-&gt; (BiMultimap a b -&gt; Map a (NESet b)) -&gt; BiMultimap a b -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap a b -&gt; Map a (NESet b)
forall a b. BiMultimap a b -&gt; Map a (NESet b)
</span><a href="Unison.Util.BiMultimap.html#domain"><span class="hs-identifier hs-var">domain</span></a></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span id="local-6989586621679121156"><span id="local-6989586621679121157"><span class="annot"><a href="Unison.Util.BiMultimap.html#memberDom"><span class="hs-identifier hs-type">memberDom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121156"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679121156"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121156"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121157"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-79"></span><span id="memberDom"><span class="annot"><span class="annottext">memberDom :: forall a b. Ord a =&gt; a -&gt; BiMultimap a b -&gt; Bool
</span><a href="Unison.Util.BiMultimap.html#memberDom"><span class="hs-identifier hs-var hs-var">memberDom</span></a></span></span><span> </span><span id="local-6989586621679121436"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121436"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; Map a (NESet b) -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.member</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121436"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(Map a (NESet b) -&gt; Bool)
-&gt; (BiMultimap a b -&gt; Map a (NESet b)) -&gt; BiMultimap a b -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap a b -&gt; Map a (NESet b)
forall a b. BiMultimap a b -&gt; Map a (NESet b)
</span><a href="Unison.Util.BiMultimap.html#domain"><span class="hs-identifier hs-var">domain</span></a></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-comment">-- | Look up the set of @b@ related to an @a@.</span><span>
</span><span id="line-83"></span><span class="hs-comment">--</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- /O(log a)/.</span><span>
</span><span id="line-85"></span><span id="local-6989586621679121162"><span id="local-6989586621679121163"><span class="annot"><a href="Unison.Util.BiMultimap.html#lookupDom"><span class="hs-identifier hs-type">lookupDom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121162"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679121162"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121162"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121163"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679121163"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-86"></span><span id="lookupDom"><span class="annot"><span class="annottext">lookupDom :: forall a b. Ord a =&gt; a -&gt; BiMultimap a b -&gt; Set b
</span><a href="Unison.Util.BiMultimap.html#lookupDom"><span class="hs-identifier hs-var hs-var">lookupDom</span></a></span></span><span> </span><span id="local-6989586621679121440"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121440"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; Map a (NESet b) -&gt; Set b
forall a b. Ord a =&gt; a -&gt; Map a (NESet b) -&gt; Set b
</span><a href="Unison.Util.BiMultimap.html#lookupDom_"><span class="hs-identifier hs-var">lookupDom_</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121440"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">(Map a (NESet b) -&gt; Set b)
-&gt; (BiMultimap a b -&gt; Map a (NESet b)) -&gt; BiMultimap a b -&gt; Set b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap a b -&gt; Map a (NESet b)
forall a b. BiMultimap a b -&gt; Map a (NESet b)
</span><a href="Unison.Util.BiMultimap.html#domain"><span class="hs-identifier hs-var">domain</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span id="local-6989586621679121167"><span id="local-6989586621679121168"><span class="annot"><a href="Unison.Util.BiMultimap.html#lookupDom_"><span class="hs-identifier hs-type">lookupDom_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121167"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679121167"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679121167"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><a href="#local-6989586621679121168"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679121168"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-90"></span><span id="lookupDom_"><span class="annot"><span class="annottext">lookupDom_ :: forall a b. Ord a =&gt; a -&gt; Map a (NESet b) -&gt; Set b
</span><a href="Unison.Util.BiMultimap.html#lookupDom_"><span class="hs-identifier hs-var hs-var">lookupDom_</span></a></span></span><span> </span><span id="local-6989586621679121444"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121444"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679121445"><span class="annot"><span class="annottext">Map a (NESet b)
</span><a href="#local-6989586621679121445"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-91"></span><span>  </span><span class="annot"><span class="annottext">Set b -&gt; (NESet b -&gt; Set b) -&gt; Maybe (NESet b) -&gt; Set b
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Set b
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span> </span><span class="annot"><span class="annottext">NESet b -&gt; Set b
forall a. NESet a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.NonEmpty.toSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Map a (NESet b) -&gt; Maybe (NESet b)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121444"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map a (NESet b)
</span><a href="#local-6989586621679121445"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-comment">-- | Look up the @a@ related to a @b@.</span><span>
</span><span id="line-94"></span><span class="hs-comment">--</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- /O(log b)/.</span><span>
</span><span id="line-96"></span><span id="local-6989586621679121177"><span id="local-6989586621679121178"><span class="annot"><a href="Unison.Util.BiMultimap.html#lookupRan"><span class="hs-identifier hs-type">lookupRan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121177"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679121177"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121178"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121177"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679121178"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-97"></span><span id="lookupRan"><span class="annot"><span class="annottext">lookupRan :: forall b a. Ord b =&gt; b -&gt; BiMultimap a b -&gt; Maybe a
</span><a href="Unison.Util.BiMultimap.html#lookupRan"><span class="hs-identifier hs-var hs-var">lookupRan</span></a></span></span><span> </span><span id="local-6989586621679121452"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679121452"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><span class="annottext">Map a (NESet b)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679121453"><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121453"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><span class="annottext">b -&gt; Map b a -&gt; Maybe a
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679121452"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121453"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-comment">-- | Look up the @a@ related to a @b@.</span><span>
</span><span id="line-101"></span><span class="hs-comment">--</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- /O(log b)/.</span><span>
</span><span id="line-103"></span><span id="local-6989586621679121181"><span id="local-6989586621679121182"><span class="annot"><a href="Unison.Util.BiMultimap.html#unsafeLookupRan"><span class="hs-identifier hs-type">unsafeLookupRan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121181"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679121181"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121182"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121181"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679121182"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-104"></span><span id="unsafeLookupRan"><span class="annot"><span class="annottext">unsafeLookupRan :: forall b a. Ord b =&gt; b -&gt; BiMultimap a b -&gt; a
</span><a href="Unison.Util.BiMultimap.html#unsafeLookupRan"><span class="hs-identifier hs-var hs-var">unsafeLookupRan</span></a></span></span><span> </span><span id="local-6989586621679121456"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679121456"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><span class="annottext">Map a (NESet b)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679121457"><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121457"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-105"></span><span>  </span><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121457"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Map b a -&gt; b -&gt; a
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">Map.!</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679121456"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-comment">-- | Look up the preimage of a @b@, that is, the set of @b@ that are related to the same @a@ as the input @b@.</span><span>
</span><span id="line-108"></span><span class="hs-comment">--</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- /O(log a + log b)</span><span>
</span><span id="line-110"></span><span id="local-6989586621679121187"><span id="local-6989586621679121188"><span class="annot"><a href="Unison.Util.BiMultimap.html#lookupPreimage"><span class="hs-identifier hs-type">lookupPreimage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121187"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121188"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679121188"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121187"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121188"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679121188"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-111"></span><span id="lookupPreimage"><span class="annot"><span class="annottext">lookupPreimage :: forall a b. (Ord a, Ord b) =&gt; b -&gt; BiMultimap a b -&gt; Set b
</span><a href="Unison.Util.BiMultimap.html#lookupPreimage"><span class="hs-identifier hs-var hs-var">lookupPreimage</span></a></span></span><span> </span><span id="local-6989586621679121463"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679121463"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span id="local-6989586621679121464"><span class="annot"><span class="annottext">Map a (NESet b)
</span><a href="#local-6989586621679121464"><span class="hs-identifier hs-var">domain</span></a></span></span><span> </span><span id="local-6989586621679121465"><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121465"><span class="hs-identifier hs-var">range</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><span class="annottext">Set b -&gt; (a -&gt; Set b) -&gt; Maybe a -&gt; Set b
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Set b
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679121466"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121466"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Map a (NESet b) -&gt; Set b
forall a b. Ord a =&gt; a -&gt; Map a (NESet b) -&gt; Set b
</span><a href="Unison.Util.BiMultimap.html#lookupDom_"><span class="hs-identifier hs-var">lookupDom_</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121466"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map a (NESet b)
</span><a href="#local-6989586621679121464"><span class="hs-identifier hs-var">domain</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; Map b a -&gt; Maybe a
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679121463"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121465"><span class="hs-identifier hs-var">range</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-comment">-- | Traverse over the domain a left-unique relation.</span><span>
</span><span id="line-115"></span><span class="hs-comment">--</span><span>
</span><span id="line-116"></span><span class="hs-comment">-- The caller is responsible for maintaining left-uniqueness.</span><span>
</span><span id="line-117"></span><span class="annot"><a href="Unison.Util.BiMultimap.html#unsafeTraverseDom"><span class="hs-identifier hs-type">unsafeTraverseDom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679121194"><span class="annot"><a href="#local-6989586621679121194"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679121192"><span class="annot"><a href="#local-6989586621679121192"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621679121191"><span class="annot"><a href="#local-6989586621679121191"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679121193"><span class="annot"><a href="#local-6989586621679121193"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679121191"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121192"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121193"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679121194"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679121191"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121192"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121194"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121193"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679121191"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121192"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121193"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span id="unsafeTraverseDom"><span class="annot"><span class="annottext">unsafeTraverseDom :: forall a b (m :: * -&gt; *) x.
(Monad m, Ord b, Ord x) =&gt;
(a -&gt; m b) -&gt; BiMultimap a x -&gt; m (BiMultimap b x)
</span><a href="Unison.Util.BiMultimap.html#unsafeTraverseDom"><span class="hs-identifier hs-var hs-var">unsafeTraverseDom</span></a></span></span><span> </span><span id="local-6989586621679121480"><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621679121480"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679121481"><span class="annot"><span class="annottext">BiMultimap a x
</span><a href="#local-6989586621679121481"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-119"></span><span>  </span><span class="annot"><span class="annottext">((a, NESet x)
 -&gt; (BiMultimap b x -&gt; m (BiMultimap b x))
 -&gt; BiMultimap b x
 -&gt; m (BiMultimap b x))
-&gt; (BiMultimap b x -&gt; m (BiMultimap b x))
-&gt; [(a, NESet x)]
-&gt; BiMultimap b x
-&gt; m (BiMultimap b x)
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">(a, NESet x)
-&gt; (BiMultimap b x -&gt; m (BiMultimap b x))
-&gt; BiMultimap b x
-&gt; m (BiMultimap b x)
</span><a href="#local-6989586621679121483"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">BiMultimap b x -&gt; m (BiMultimap b x)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map a (NESet x) -&gt; [(a, NESet x)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BiMultimap a x -&gt; Map a (NESet x)
forall a b. BiMultimap a b -&gt; Map a (NESet b)
</span><a href="Unison.Util.BiMultimap.html#domain"><span class="hs-identifier hs-var">domain</span></a></span><span> </span><span class="annot"><span class="annottext">BiMultimap a x
</span><a href="#local-6989586621679121481"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BiMultimap b x
forall a b. (Ord a, Ord b) =&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#empty"><span class="hs-identifier hs-var">Unison.Util.BiMultimap.empty</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-121"></span><span>    </span><span class="annot"><a href="#local-6989586621679121483"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679121194"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><a href="#local-6989586621679121193"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121192"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121193"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679121191"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121192"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121193"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121192"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121193"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679121191"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121192"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121193"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>    </span><span id="local-6989586621679121483"><span class="annot"><span class="annottext">g :: (a, NESet x)
-&gt; (BiMultimap b x -&gt; m (BiMultimap b x))
-&gt; BiMultimap b x
-&gt; m (BiMultimap b x)
</span><a href="#local-6989586621679121483"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679121485"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121485"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679121486"><span class="annot"><span class="annottext">NESet x
</span><a href="#local-6989586621679121486"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679121487"><span class="annot"><span class="annottext">BiMultimap b x -&gt; m (BiMultimap b x)
</span><a href="#local-6989586621679121487"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span id="local-6989586621679121488"><span class="annot"><span class="annottext">Map b (NESet x)
</span><a href="#local-6989586621679121488"><span class="hs-identifier hs-var">domain0</span></a></span></span><span> </span><span id="local-6989586621679121489"><span class="annot"><span class="annottext">Map x b
</span><a href="#local-6989586621679121489"><span class="hs-identifier hs-var">range0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-123"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621679121490"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679121490"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621679121480"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121485"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-124"></span><span>      </span><span class="annot"><span class="annottext">BiMultimap b x -&gt; m (BiMultimap b x)
</span><a href="#local-6989586621679121487"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">(BiMultimap b x -&gt; m (BiMultimap b x))
-&gt; BiMultimap b x -&gt; m (BiMultimap b x)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Map b (NESet x) -&gt; Map x b -&gt; BiMultimap b x
forall a b. Map a (NESet b) -&gt; Map b a -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-var">BiMultimap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; NESet x -&gt; Map b (NESet x) -&gt; Map b (NESet x)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679121490"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">NESet x
</span><a href="#local-6989586621679121486"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Map b (NESet x)
</span><a href="#local-6989586621679121488"><span class="hs-identifier hs-var">domain0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; NESet x -&gt; Map x b -&gt; Map x b
forall b a. Ord b =&gt; a -&gt; NESet b -&gt; Map b a -&gt; Map b a
</span><a href="Unison.Util.BiMultimap.html#deriveRangeFromDomain"><span class="hs-identifier hs-var">deriveRangeFromDomain</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679121490"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">NESet x
</span><a href="#local-6989586621679121486"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Map x b
</span><a href="#local-6989586621679121489"><span class="hs-identifier hs-var">range0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="annot"><span class="hs-comment">-- | Filter a left-unique relation, keeping only members @(a, b)@ that satisfy a predicate.</span></span><span>
</span><span id="line-127"></span><span id="local-6989586621679121214"><span id="local-6989586621679121215"><span class="annot"><a href="Unison.Util.BiMultimap.html#filter"><span class="hs-identifier hs-type">filter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121214"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121215"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679121214"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679121215"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121214"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121215"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121214"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121215"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-128"></span><span id="filter"><span class="annot"><span class="annottext">filter :: forall a b.
(Ord a, Ord b) =&gt;
(a -&gt; b -&gt; Bool) -&gt; BiMultimap a b -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#filter"><span class="hs-identifier hs-var hs-var">filter</span></a></span></span><span> </span><span id="local-6989586621679121496"><span class="annot"><span class="annottext">a -&gt; b -&gt; Bool
</span><a href="#local-6989586621679121496"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span id="local-6989586621679121497"><span class="annot"><span class="annottext">Map a (NESet b)
</span><a href="#local-6989586621679121497"><span class="hs-identifier hs-var">domain</span></a></span></span><span> </span><span id="local-6989586621679121498"><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121498"><span class="hs-identifier hs-var">range</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-129"></span><span>  </span><span class="annot"><span class="annottext">Map a (NESet b) -&gt; Map b a -&gt; BiMultimap a b
forall a b. Map a (NESet b) -&gt; Map b a -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-var">BiMultimap</span></a></span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(a -&gt; NESet b -&gt; Maybe (NESet b))
-&gt; Map a (NESet b) -&gt; Map a (NESet b)
forall k a b. (k -&gt; a -&gt; Maybe b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.mapMaybeWithKey</span></span><span>
</span><span id="line-131"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679121500"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121500"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679121501"><span class="annot"><span class="annottext">NESet b
</span><a href="#local-6989586621679121501"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-132"></span><span>            </span><span class="annot"><span class="annottext">NESet b
</span><a href="#local-6989586621679121501"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-133"></span><span>              </span><span class="annot"><span class="annottext">NESet b -&gt; (NESet b -&gt; Set b) -&gt; Set b
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(b -&gt; Bool) -&gt; NESet b -&gt; Set b
forall a. (a -&gt; Bool) -&gt; NESet a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.NonEmpty.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b -&gt; Bool
</span><a href="#local-6989586621679121496"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121500"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>              </span><span class="annot"><span class="annottext">Set b -&gt; (Set b -&gt; Maybe (NESet b)) -&gt; Maybe (NESet b)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Set b -&gt; Maybe (NESet b)
forall a. Set a -&gt; Maybe (NESet a)
</span><span class="hs-identifier hs-var">Set.NonEmpty.nonEmptySet</span></span><span>
</span><span id="line-135"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>        </span><span class="annot"><span class="annottext">Map a (NESet b)
</span><a href="#local-6989586621679121497"><span class="hs-identifier hs-var">domain</span></a></span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(b -&gt; a -&gt; Bool) -&gt; Map b a -&gt; Map b a
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; b -&gt; Bool) -&gt; b -&gt; a -&gt; Bool
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; Bool
</span><a href="#local-6989586621679121496"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121498"><span class="hs-identifier hs-var">range</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="annot"><span class="hs-comment">-- | Filter a left-unique relation, keeping only members @(a, b)@ whose @a@ satisfies a predicate.</span></span><span>
</span><span id="line-141"></span><span id="local-6989586621679121230"><span id="local-6989586621679121231"><span class="annot"><a href="Unison.Util.BiMultimap.html#filterDom"><span class="hs-identifier hs-type">filterDom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121230"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121231"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679121230"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121230"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121231"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121230"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121231"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-142"></span><span id="filterDom"><span class="annot"><span class="annottext">filterDom :: forall a b.
(Ord a, Ord b) =&gt;
(a -&gt; Bool) -&gt; BiMultimap a b -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#filterDom"><span class="hs-identifier hs-var hs-var">filterDom</span></a></span></span><span> </span><span id="local-6989586621679121510"><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679121510"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679121511"><span class="annot"><span class="annottext">BiMultimap a b
</span><a href="#local-6989586621679121511"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-143"></span><span>  </span><span class="annot"><span class="annottext">Map a (NESet b) -&gt; BiMultimap a b
forall b a. Ord b =&gt; Map a (NESet b) -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#unsafeFromDomain"><span class="hs-identifier hs-var">unsafeFromDomain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; NESet b -&gt; Bool) -&gt; Map a (NESet b) -&gt; Map a (NESet b)
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679121512"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121512"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">NESet b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679121510"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121512"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BiMultimap a b -&gt; Map a (NESet b)
forall a b. BiMultimap a b -&gt; Map a (NESet b)
</span><a href="Unison.Util.BiMultimap.html#domain"><span class="hs-identifier hs-var">domain</span></a></span><span> </span><span class="annot"><span class="annottext">BiMultimap a b
</span><a href="#local-6989586621679121511"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="annot"><span class="hs-comment">-- | Filter a left-unique relation, keeping only members @(a, b)@ whose @a@ and set of @b@ satisfies a predicate.</span></span><span>
</span><span id="line-146"></span><span id="local-6989586621679121236"><span id="local-6989586621679121237"><span class="annot"><a href="Unison.Util.BiMultimap.html#filterDomain"><span class="hs-identifier hs-type">filterDomain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121236"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121237"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679121236"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><a href="#local-6989586621679121237"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121236"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121237"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121236"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121237"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-147"></span><span id="filterDomain"><span class="annot"><span class="annottext">filterDomain :: forall a b.
(Ord a, Ord b) =&gt;
(a -&gt; NESet b -&gt; Bool) -&gt; BiMultimap a b -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#filterDomain"><span class="hs-identifier hs-var hs-var">filterDomain</span></a></span></span><span> </span><span id="local-6989586621679121516"><span class="annot"><span class="annottext">a -&gt; NESet b -&gt; Bool
</span><a href="#local-6989586621679121516"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679121517"><span class="annot"><span class="annottext">BiMultimap a b
</span><a href="#local-6989586621679121517"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><span class="annottext">Map a (NESet b) -&gt; BiMultimap a b
forall b a. Ord b =&gt; Map a (NESet b) -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#unsafeFromDomain"><span class="hs-identifier hs-var">unsafeFromDomain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; NESet b -&gt; Bool) -&gt; Map a (NESet b) -&gt; Map a (NESet b)
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filterWithKey</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; NESet b -&gt; Bool
</span><a href="#local-6989586621679121516"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BiMultimap a b -&gt; Map a (NESet b)
forall a b. BiMultimap a b -&gt; Map a (NESet b)
</span><a href="Unison.Util.BiMultimap.html#domain"><span class="hs-identifier hs-var">domain</span></a></span><span> </span><span class="annot"><span class="annottext">BiMultimap a b
</span><a href="#local-6989586621679121517"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="annot"><span class="hs-comment">-- | Restrict a left-unique relation to only those @(a, b)@ members whose @a@ is in the given set.</span></span><span>
</span><span id="line-151"></span><span id="local-6989586621679121240"><span id="local-6989586621679121241"><span class="annot"><a href="Unison.Util.BiMultimap.html#restrictDom"><span class="hs-identifier hs-type">restrictDom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121240"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121241"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679121240"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121240"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121241"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121240"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121241"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-152"></span><span id="restrictDom"><span class="annot"><span class="annottext">restrictDom :: forall a b.
(Ord a, Ord b) =&gt;
Set a -&gt; BiMultimap a b -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#restrictDom"><span class="hs-identifier hs-var hs-var">restrictDom</span></a></span></span><span> </span><span id="local-6989586621679121522"><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679121522"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621679121523"><span class="annot"><span class="annottext">BiMultimap a b
</span><a href="#local-6989586621679121523"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-153"></span><span>  </span><span class="annot"><span class="annottext">Map a (NESet b) -&gt; BiMultimap a b
forall b a. Ord b =&gt; Map a (NESet b) -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#unsafeFromDomain"><span class="hs-identifier hs-var">unsafeFromDomain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map a (NESet b) -&gt; Set a -&gt; Map a (NESet b)
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BiMultimap a b -&gt; Map a (NESet b)
forall a b. BiMultimap a b -&gt; Map a (NESet b)
</span><a href="Unison.Util.BiMultimap.html#domain"><span class="hs-identifier hs-var">domain</span></a></span><span> </span><span class="annot"><span class="annottext">BiMultimap a b
</span><a href="#local-6989586621679121523"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679121522"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="annot"><span class="hs-comment">-- | Restrict a left-unique relation to only those @(a, b)@ members whose @b@ is in the given set.</span></span><span>
</span><span id="line-156"></span><span id="local-6989586621679121246"><span id="local-6989586621679121247"><span class="annot"><a href="Unison.Util.BiMultimap.html#restrictRan"><span class="hs-identifier hs-type">restrictRan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121246"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121247"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679121247"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121246"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121247"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121246"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121247"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-157"></span><span id="restrictRan"><span class="annot"><span class="annottext">restrictRan :: forall a b.
(Ord a, Ord b) =&gt;
Set b -&gt; BiMultimap a b -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#restrictRan"><span class="hs-identifier hs-var hs-var">restrictRan</span></a></span></span><span> </span><span id="local-6989586621679121530"><span class="annot"><span class="annottext">Set b
</span><a href="#local-6989586621679121530"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span id="local-6989586621679121531"><span class="annot"><span class="annottext">BiMultimap a b
</span><a href="#local-6989586621679121531"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><span class="annottext">Map b a -&gt; BiMultimap a b
forall a b. (Ord a, Ord b) =&gt; Map b a -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#fromRange"><span class="hs-identifier hs-var">fromRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map b a -&gt; Set b -&gt; Map b a
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BiMultimap a b -&gt; Map b a
forall a b. BiMultimap a b -&gt; Map b a
</span><a href="Unison.Util.BiMultimap.html#range"><span class="hs-identifier hs-var">range</span></a></span><span> </span><span class="annot"><span class="annottext">BiMultimap a b
</span><a href="#local-6989586621679121531"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set b
</span><a href="#local-6989586621679121530"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="annot"><span class="hs-comment">-- | Restrict a left-unique relation to only those @(a, b)@ members whose @a@ is not in the given set.</span></span><span>
</span><span id="line-161"></span><span id="local-6989586621679121532"><span id="local-6989586621679121533"><span class="annot"><a href="Unison.Util.BiMultimap.html#withoutDom"><span class="hs-identifier hs-type">withoutDom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121532"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121533"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679121532"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121532"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121533"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121532"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121533"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-162"></span><span id="withoutDom"><span class="annot"><span class="annottext">withoutDom :: forall a b.
(Ord a, Ord b) =&gt;
Set a -&gt; BiMultimap a b -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#withoutDom"><span class="hs-identifier hs-var hs-var">withoutDom</span></a></span></span><span> </span><span id="local-6989586621679121538"><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679121538"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621679121539"><span class="annot"><span class="annottext">BiMultimap a b
</span><a href="#local-6989586621679121539"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><span class="annottext">Map a (NESet b) -&gt; BiMultimap a b
forall b a. Ord b =&gt; Map a (NESet b) -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#unsafeFromDomain"><span class="hs-identifier hs-var">unsafeFromDomain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map a (NESet b) -&gt; Set a -&gt; Map a (NESet b)
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.withoutKeys</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BiMultimap a b -&gt; Map a (NESet b)
forall a b. BiMultimap a b -&gt; Map a (NESet b)
</span><a href="Unison.Util.BiMultimap.html#domain"><span class="hs-identifier hs-var">domain</span></a></span><span> </span><span class="annot"><span class="annottext">BiMultimap a b
</span><a href="#local-6989586621679121539"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679121538"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="annot"><span class="hs-comment">-- | Restrict a left-unique relation to only those @(a, b)@ members whose @b@ is not in the given set.</span></span><span>
</span><span id="line-166"></span><span id="local-6989586621679121541"><span id="local-6989586621679121542"><span class="annot"><a href="Unison.Util.BiMultimap.html#withoutRan"><span class="hs-identifier hs-type">withoutRan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121541"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121542"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679121542"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121541"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121542"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121541"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121542"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-167"></span><span id="withoutRan"><span class="annot"><span class="annottext">withoutRan :: forall a b.
(Ord a, Ord b) =&gt;
Set b -&gt; BiMultimap a b -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#withoutRan"><span class="hs-identifier hs-var hs-var">withoutRan</span></a></span></span><span> </span><span id="local-6989586621679121548"><span class="annot"><span class="annottext">Set b
</span><a href="#local-6989586621679121548"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span id="local-6989586621679121549"><span class="annot"><span class="annottext">BiMultimap a b
</span><a href="#local-6989586621679121549"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-168"></span><span>  </span><span class="annot"><span class="annottext">Map b a -&gt; BiMultimap a b
forall a b. (Ord a, Ord b) =&gt; Map b a -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#fromRange"><span class="hs-identifier hs-var">fromRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map b a -&gt; Set b -&gt; Map b a
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.withoutKeys</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BiMultimap a b -&gt; Map b a
forall a b. BiMultimap a b -&gt; Map b a
</span><a href="Unison.Util.BiMultimap.html#range"><span class="hs-identifier hs-var">range</span></a></span><span> </span><span class="annot"><span class="annottext">BiMultimap a b
</span><a href="#local-6989586621679121549"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set b
</span><a href="#local-6989586621679121548"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span id="local-6989586621679121550"><span id="local-6989586621679121551"><span class="annot"><a href="Unison.Util.BiMultimap.html#domain"><span class="hs-identifier hs-type">domain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121550"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121551"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679121550"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><a href="#local-6989586621679121551"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-171"></span><span id="domain"><span class="annot"><span class="annottext">domain :: forall a b. BiMultimap a b -&gt; Map a (NESet b)
</span><a href="Unison.Util.BiMultimap.html#domain"><span class="hs-identifier hs-var hs-var">domain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BiMultimap a b -&gt; Map a (NESet b)
forall a b. BiMultimap a b -&gt; Map a (NESet b)
</span><a href="Unison.Util.BiMultimap.html#toMultimap"><span class="hs-identifier hs-var">toMultimap</span></a></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="annot"><span class="hs-comment">-- | /O(1)/.</span></span><span>
</span><span id="line-174"></span><span id="local-6989586621679121552"><span id="local-6989586621679121553"><span class="annot"><a href="Unison.Util.BiMultimap.html#range"><span class="hs-identifier hs-type">range</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121552"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121553"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679121553"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121552"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-175"></span><span id="range"><span class="annot"><span class="annottext">range :: forall a b. BiMultimap a b -&gt; Map b a
</span><a href="Unison.Util.BiMultimap.html#range"><span class="hs-identifier hs-var hs-var">range</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BiMultimap a b -&gt; Map b a
forall a b. BiMultimap a b -&gt; Map b a
</span><a href="Unison.Util.BiMultimap.html#toMapR"><span class="hs-identifier hs-var">toMapR</span></a></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-comment">-- | Construct a left-unique relation from a mapping from its left-elements to set-of-right-elements. The caller is</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- responsible for ensuring that no right-element is mapped to by two different left-elements.</span><span>
</span><span id="line-179"></span><span id="local-6989586621679121234"><span id="local-6989586621679121235"><span class="annot"><a href="Unison.Util.BiMultimap.html#unsafeFromDomain"><span class="hs-identifier hs-type">unsafeFromDomain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121234"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679121235"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><a href="#local-6989586621679121234"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121235"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121234"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-180"></span><span id="unsafeFromDomain"><span class="annot"><span class="annottext">unsafeFromDomain :: forall b a. Ord b =&gt; Map a (NESet b) -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#unsafeFromDomain"><span class="hs-identifier hs-var hs-var">unsafeFromDomain</span></a></span></span><span> </span><span id="local-6989586621679121556"><span class="annot"><span class="annottext">Map a (NESet b)
</span><a href="#local-6989586621679121556"><span class="hs-identifier hs-var">domain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-181"></span><span>  </span><span class="annot"><span class="annottext">Map a (NESet b) -&gt; Map b a -&gt; BiMultimap a b
forall a b. Map a (NESet b) -&gt; Map b a -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-var">BiMultimap</span></a></span><span> </span><span class="annot"><span class="annottext">Map a (NESet b)
</span><a href="#local-6989586621679121556"><span class="hs-identifier hs-var">domain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map a (NESet b) -&gt; Map b a
forall a b. Ord b =&gt; Map a (NESet b) -&gt; Map b a
</span><a href="Unison.Util.BiMultimap.html#invertDomain"><span class="hs-identifier hs-var">invertDomain</span></a></span><span> </span><span class="annot"><span class="annottext">Map a (NESet b)
</span><a href="#local-6989586621679121556"><span class="hs-identifier hs-var">domain</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="annot"><a href="Unison.Util.BiMultimap.html#invertDomain"><span class="hs-identifier hs-type">invertDomain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679121263"><span class="annot"><a href="#local-6989586621679121263"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679121262"><span class="annot"><a href="#local-6989586621679121262"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121262"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679121263"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><a href="#local-6989586621679121262"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679121262"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121263"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-184"></span><span id="invertDomain"><span class="annot"><span class="annottext">invertDomain :: forall a b. Ord b =&gt; Map a (NESet b) -&gt; Map b a
</span><a href="Unison.Util.BiMultimap.html#invertDomain"><span class="hs-identifier hs-var hs-var">invertDomain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-185"></span><span>  </span><span class="annot"><span class="annottext">(Map b a -&gt; a -&gt; NESet b -&gt; Map b a)
-&gt; Map b a -&gt; Map a (NESet b) -&gt; Map b a
forall a k b. (a -&gt; k -&gt; b -&gt; a) -&gt; a -&gt; Map k b -&gt; a
</span><span class="hs-identifier hs-var">Map.foldlWithKey'</span></span><span> </span><span class="annot"><span class="annottext">Map b a -&gt; a -&gt; NESet b -&gt; Map b a
</span><a href="#local-6989586621679121561"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Map b a
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><a href="#local-6989586621679121561"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679121262"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121263"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679121263"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><a href="#local-6989586621679121262"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679121262"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121263"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span id="local-6989586621679121561"><span class="annot"><span class="annottext">f :: Map b a -&gt; a -&gt; NESet b -&gt; Map b a
</span><a href="#local-6989586621679121561"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679121563"><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121563"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679121564"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121564"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679121565"><span class="annot"><span class="annottext">NESet b
</span><a href="#local-6989586621679121565"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-189"></span><span>      </span><span class="annot"><span class="annottext">(Map b a -&gt; b -&gt; Map b a) -&gt; Map b a -&gt; NESet b -&gt; Map b a
forall a b. (a -&gt; b -&gt; a) -&gt; a -&gt; NESet b -&gt; a
</span><span class="hs-identifier hs-var">Set.NonEmpty.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Map b a -&gt; b -&gt; Map b a
</span><a href="#local-6989586621679121567"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121564"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121563"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">NESet b
</span><a href="#local-6989586621679121565"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><a href="#local-6989586621679121567"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679121263"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679121262"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121263"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679121262"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679121262"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121263"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621679121567"><span class="annot"><span class="annottext">g :: a -&gt; Map b a -&gt; b -&gt; Map b a
</span><a href="#local-6989586621679121567"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span id="local-6989586621679121568"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121568"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679121569"><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121569"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679121570"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679121570"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-193"></span><span>      </span><span class="annot"><span class="annottext">b -&gt; a -&gt; Map b a -&gt; Map b a
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679121570"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121568"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121569"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="annot"><span class="hs-comment">-- | Construct a left-unique relation from a mapping from its right-elements to its left-elements.</span></span><span>
</span><span id="line-196"></span><span id="local-6989586621679121250"><span id="local-6989586621679121251"><span class="annot"><a href="Unison.Util.BiMultimap.html#fromRange"><span class="hs-identifier hs-type">fromRange</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121250"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121251"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679121251"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121250"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121250"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121251"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-197"></span><span id="fromRange"><span class="annot"><span class="annottext">fromRange :: forall a b. (Ord a, Ord b) =&gt; Map b a -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#fromRange"><span class="hs-identifier hs-var hs-var">fromRange</span></a></span></span><span> </span><span id="local-6989586621679121575"><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121575"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-198"></span><span>  </span><span class="annot"><span class="annottext">Map a (NESet b) -&gt; Map b a -&gt; BiMultimap a b
forall a b. Map a (NESet b) -&gt; Map b a -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-var">BiMultimap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map a (NESet b) -&gt; b -&gt; a -&gt; Map a (NESet b))
-&gt; Map a (NESet b) -&gt; Map b a -&gt; Map a (NESet b)
forall a k b. (a -&gt; k -&gt; b -&gt; a) -&gt; a -&gt; Map k b -&gt; a
</span><span class="hs-identifier hs-var">Map.foldlWithKey'</span></span><span> </span><span class="annot"><span class="annottext">Map a (NESet b) -&gt; b -&gt; a -&gt; Map a (NESet b)
forall {k} {a}.
(Ord k, Ord a) =&gt;
Map k (NESet a) -&gt; a -&gt; k -&gt; Map k (NESet a)
</span><a href="#local-6989586621679121576"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Map a (NESet b)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121575"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121575"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-199"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-200"></span><span>    </span><span id="local-6989586621679121576"><span class="annot"><span class="annottext">f :: Map k (NESet a) -&gt; a -&gt; k -&gt; Map k (NESet a)
</span><a href="#local-6989586621679121576"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679121585"><span class="annot"><span class="annottext">Map k (NESet a)
</span><a href="#local-6989586621679121585"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679121586"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121586"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679121587"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679121587"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-201"></span><span>      </span><span class="annot"><span class="annottext">(NESet a -&gt; NESet a -&gt; NESet a)
-&gt; k -&gt; NESet a -&gt; Map k (NESet a) -&gt; Map k (NESet a)
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insertWith</span></span><span> </span><span class="annot"><span class="annottext">NESet a -&gt; NESet a -&gt; NESet a
forall a. Ord a =&gt; NESet a -&gt; NESet a -&gt; NESet a
</span><span class="hs-identifier hs-var">Set.NonEmpty.union</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679121587"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; NESet a
forall a. a -&gt; NESet a
</span><span class="hs-identifier hs-var">Set.NonEmpty.singleton</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121586"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map k (NESet a)
</span><a href="#local-6989586621679121585"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="hs-comment">-- | Returns the domain of the relation, as a Set, in its entirety.</span><span>
</span><span id="line-204"></span><span class="hs-comment">--</span><span>
</span><span id="line-205"></span><span class="hs-comment">-- /O(a)/.</span><span>
</span><span id="line-206"></span><span id="local-6989586621679121281"><span id="local-6989586621679121282"><span class="annot"><a href="Unison.Util.BiMultimap.html#dom"><span class="hs-identifier hs-type">dom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121281"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121282"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679121281"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-207"></span><span id="dom"><span class="annot"><span class="annottext">dom :: forall a b. BiMultimap a b -&gt; Set a
</span><a href="Unison.Util.BiMultimap.html#dom"><span class="hs-identifier hs-var hs-var">dom</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-208"></span><span>  </span><span class="annot"><span class="annottext">Map a (NESet b) -&gt; Set a
forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span> </span><span class="annot"><span class="annottext">(Map a (NESet b) -&gt; Set a)
-&gt; (BiMultimap a b -&gt; Map a (NESet b)) -&gt; BiMultimap a b -&gt; Set a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap a b -&gt; Map a (NESet b)
forall a b. BiMultimap a b -&gt; Map a (NESet b)
</span><a href="Unison.Util.BiMultimap.html#toMultimap"><span class="hs-identifier hs-var">toMultimap</span></a></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="hs-comment">-- | Returns the range of the relation, as a Set, in its entirety.</span><span>
</span><span id="line-211"></span><span class="hs-comment">--</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- /O(a)/.</span><span>
</span><span id="line-213"></span><span id="local-6989586621679121287"><span id="local-6989586621679121288"><span class="annot"><a href="Unison.Util.BiMultimap.html#ran"><span class="hs-identifier hs-type">ran</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121287"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121288"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679121288"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-214"></span><span id="ran"><span class="annot"><span class="annottext">ran :: forall a b. BiMultimap a b -&gt; Set b
</span><a href="Unison.Util.BiMultimap.html#ran"><span class="hs-identifier hs-var hs-var">ran</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-215"></span><span>  </span><span class="annot"><span class="annottext">Map b a -&gt; Set b
forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span> </span><span class="annot"><span class="annottext">(Map b a -&gt; Set b)
-&gt; (BiMultimap a b -&gt; Map b a) -&gt; BiMultimap a b -&gt; Set b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap a b -&gt; Map b a
forall a b. BiMultimap a b -&gt; Map b a
</span><a href="Unison.Util.BiMultimap.html#toMapR"><span class="hs-identifier hs-var">toMapR</span></a></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="annot"><span class="hs-comment">-- | Convert a left-unique relation to a relation (forgetting its left-uniqueness).</span></span><span>
</span><span id="line-218"></span><span id="local-6989586621679121291"><span id="local-6989586621679121292"><span class="annot"><a href="Unison.Util.BiMultimap.html#toRelation"><span class="hs-identifier hs-type">toRelation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121291"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121292"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121291"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121292"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.Relation.html#Relation"><span class="hs-identifier hs-type">Relation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121291"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121292"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-219"></span><span id="toRelation"><span class="annot"><span class="annottext">toRelation :: forall a b. (Ord a, Ord b) =&gt; BiMultimap a b -&gt; Relation a b
</span><a href="Unison.Util.BiMultimap.html#toRelation"><span class="hs-identifier hs-var hs-var">toRelation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-220"></span><span>  </span><span class="annot"><span class="annottext">Map a (Set b) -&gt; Relation a b
forall a b. (Ord a, Ord b) =&gt; Map a (Set b) -&gt; Relation a b
</span><a href="Unison.Util.Relation.html#fromMultimap"><span class="hs-identifier hs-var">Relation.fromMultimap</span></a></span><span> </span><span class="annot"><span class="annottext">(Map a (Set b) -&gt; Relation a b)
-&gt; (BiMultimap a b -&gt; Map a (Set b))
-&gt; BiMultimap a b
-&gt; Relation a b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(NESet b -&gt; Set b) -&gt; Map a (NESet b) -&gt; Map a (Set b)
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.map</span></span><span> </span><span class="annot"><span class="annottext">NESet b -&gt; Set b
forall a. NESet a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.NonEmpty.toSet</span></span><span> </span><span class="annot"><span class="annottext">(Map a (NESet b) -&gt; Map a (Set b))
-&gt; (BiMultimap a b -&gt; Map a (NESet b))
-&gt; BiMultimap a b
-&gt; Map a (Set b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap a b -&gt; Map a (NESet b)
forall a b. BiMultimap a b -&gt; Map a (NESet b)
</span><a href="Unison.Util.BiMultimap.html#domain"><span class="hs-identifier hs-var">domain</span></a></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span class="hs-comment">-- | Insert a pair into a left-unique relation, maintaining left-uniqueness, preferring the latest inserted element.</span><span>
</span><span id="line-223"></span><span class="hs-comment">--</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- That is, if a left-unique relation already contains the pair @(x, y)@, then inserting the pair @(z, y)@ will cause</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- the @(x, y)@ pair to be deleted.</span><span>
</span><span id="line-226"></span><span id="local-6989586621679121301"><span id="local-6989586621679121302"><span class="annot"><a href="Unison.Util.BiMultimap.html#insert"><span class="hs-identifier hs-type">insert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121301"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121302"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679121301"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679121302"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121301"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121302"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121301"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121302"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-227"></span><span id="insert"><span class="annot"><span class="annottext">insert :: forall a b.
(Ord a, Ord b) =&gt;
a -&gt; b -&gt; BiMultimap a b -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#insert"><span class="hs-identifier hs-var hs-var">insert</span></a></span></span><span> </span><span id="local-6989586621679121606"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121606"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679121607"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679121607"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679121608"><span class="annot"><span class="annottext">m :: BiMultimap a b
</span><a href="#local-6989586621679121608"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span id="local-6989586621679121609"><span class="annot"><span class="annottext">Map a (NESet b)
</span><a href="#local-6989586621679121609"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679121610"><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121610"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Maybe a -&gt; (UpsertResult a, Maybe a))
-&gt; b -&gt; Map b a -&gt; (UpsertResult a, Map b a)
forall (f :: * -&gt; *) k a.
(Functor f, Ord k) =&gt;
(Maybe a -&gt; f (Maybe a)) -&gt; k -&gt; Map k a -&gt; f (Map k a)
</span><span class="hs-identifier hs-var">Map.alterF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe a -&gt; (UpsertResult a, Maybe a)
forall a. Eq a =&gt; a -&gt; Maybe a -&gt; (UpsertResult a, Maybe a)
</span><a href="Unison.Util.BiMultimap.html#upsertFunc"><span class="hs-identifier hs-var">upsertFunc</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121606"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679121607"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121610"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UpsertResult a
</span><a href="Unison.Util.BiMultimap.html#Ignored"><span class="hs-identifier hs-var">Ignored</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map b a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BiMultimap a b
</span><a href="#local-6989586621679121608"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UpsertResult a
</span><a href="Unison.Util.BiMultimap.html#Inserted"><span class="hs-identifier hs-var">Inserted</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679121615"><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121615"><span class="hs-identifier hs-var">r'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map a (NESet b) -&gt; Map b a -&gt; BiMultimap a b
forall a b. Map a (NESet b) -&gt; Map b a -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-var">BiMultimap</span></a></span><span> </span><span class="annot"><span class="annottext">Map a (NESet b)
</span><a href="#local-6989586621679121616"><span class="hs-identifier hs-var">l'</span></a></span><span> </span><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121615"><span class="hs-identifier hs-var">r'</span></a></span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Util.BiMultimap.html#Replaced"><span class="hs-identifier hs-type">Replaced</span></a></span><span> </span><span id="local-6989586621679121618"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121618"><span class="hs-identifier hs-var">old</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679121619"><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121619"><span class="hs-identifier hs-var">r'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-232"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679121624"><span class="annot"><span class="annottext">l'' :: Map a (NESet b)
</span><a href="#local-6989586621679121624"><span class="hs-identifier hs-var hs-var">l''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NESet b -&gt; Maybe (NESet b))
-&gt; a -&gt; Map a (NESet b) -&gt; Map a (NESet b)
forall k a. Ord k =&gt; (a -&gt; Maybe a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.update</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set b -&gt; Maybe (NESet b)
forall a. Set a -&gt; Maybe (NESet a)
</span><span class="hs-identifier hs-var">Set.NonEmpty.nonEmptySet</span></span><span> </span><span class="annot"><span class="annottext">(Set b -&gt; Maybe (NESet b))
-&gt; (NESet b -&gt; Set b) -&gt; NESet b -&gt; Maybe (NESet b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; NESet b -&gt; Set b
forall a. Ord a =&gt; a -&gt; NESet a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.NonEmpty.delete</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679121607"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121618"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">Map a (NESet b)
</span><a href="#local-6989586621679121616"><span class="hs-identifier hs-var">l'</span></a></span><span>
</span><span id="line-233"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Map a (NESet b) -&gt; Map b a -&gt; BiMultimap a b
forall a b. Map a (NESet b) -&gt; Map b a -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-var">BiMultimap</span></a></span><span> </span><span class="annot"><span class="annottext">Map a (NESet b)
</span><a href="#local-6989586621679121624"><span class="hs-identifier hs-var">l''</span></a></span><span> </span><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121619"><span class="hs-identifier hs-var">r'</span></a></span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-235"></span><span>    </span><span id="local-6989586621679121616"><span class="annot"><span class="annottext">l' :: Map a (NESet b)
</span><a href="#local-6989586621679121616"><span class="hs-identifier hs-var hs-var">l'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe (NESet b) -&gt; NESet b)
-&gt; a -&gt; Map a (NESet b) -&gt; Map a (NESet b)
forall k v. Ord k =&gt; (Maybe v -&gt; v) -&gt; k -&gt; Map k v -&gt; Map k v
</span><span class="hs-identifier hs-var">Map.upsert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NESet b -&gt; (NESet b -&gt; NESet b) -&gt; Maybe (NESet b) -&gt; NESet b
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; NESet b
forall a. a -&gt; NESet a
</span><span class="hs-identifier hs-var">Set.NonEmpty.singleton</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679121607"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; NESet b -&gt; NESet b
forall a. Ord a =&gt; a -&gt; NESet a -&gt; NESet a
</span><span class="hs-identifier hs-var">Set.NonEmpty.insert</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679121607"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121606"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Map a (NESet b)
</span><a href="#local-6989586621679121609"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="hs-comment">-- @upsertFunc x@ returns a function that upserts @x@, suitable for passing to @Map.alterF@.</span><span>
</span><span id="line-238"></span><span id="local-6989586621679121310"><span class="annot"><a href="Unison.Util.BiMultimap.html#upsertFunc"><span class="hs-identifier hs-type">upsertFunc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679121310"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679121310"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679121310"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Util.BiMultimap.html#UpsertResult"><span class="hs-identifier hs-type">UpsertResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121310"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679121310"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-239"></span><span id="upsertFunc"><span class="annot"><span class="annottext">upsertFunc :: forall a. Eq a =&gt; a -&gt; Maybe a -&gt; (UpsertResult a, Maybe a)
</span><a href="Unison.Util.BiMultimap.html#upsertFunc"><span class="hs-identifier hs-var hs-var">upsertFunc</span></a></span></span><span> </span><span id="local-6989586621679121635"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121635"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span id="local-6989586621679121636"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679121636"><span class="hs-identifier hs-var">existing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-240"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679121636"><span class="hs-identifier hs-var">existing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-241"></span><span>    </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UpsertResult a
forall old. UpsertResult old
</span><a href="Unison.Util.BiMultimap.html#Inserted"><span class="hs-identifier hs-var">Inserted</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121635"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679121637"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121637"><span class="hs-identifier hs-var">old</span></a></span></span><span>
</span><span id="line-243"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121637"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121635"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UpsertResult a
forall old. UpsertResult old
</span><a href="Unison.Util.BiMultimap.html#Ignored"><span class="hs-identifier hs-var">Ignored</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679121636"><span class="hs-identifier hs-var">existing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; UpsertResult a
forall old. old -&gt; UpsertResult old
</span><a href="Unison.Util.BiMultimap.html#Replaced"><span class="hs-identifier hs-var">Replaced</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121637"><span class="hs-identifier hs-var">old</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121635"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span class="hs-keyword">data</span><span> </span><span id="UpsertResult"><span class="annot"><a href="Unison.Util.BiMultimap.html#UpsertResult"><span class="hs-identifier hs-var">UpsertResult</span></a></span></span><span> </span><span id="local-6989586621679121318"><span class="annot"><a href="#local-6989586621679121318"><span class="hs-identifier hs-type">old</span></a></span></span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Ignored"><span class="annot"><a href="Unison.Util.BiMultimap.html#Ignored"><span class="hs-identifier hs-var">Ignored</span></a></span></span><span> </span><span class="hs-comment">-- Ignored because an equivalent thing was already there</span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Inserted"><span class="annot"><a href="Unison.Util.BiMultimap.html#Inserted"><span class="hs-identifier hs-var">Inserted</span></a></span></span><span> </span><span class="hs-comment">-- Inserted something new</span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Replaced"><span class="annot"><a href="Unison.Util.BiMultimap.html#Replaced"><span class="hs-identifier hs-var">Replaced</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679121318"><span class="hs-identifier hs-type">old</span></a></span><span> </span><span class="hs-comment">-- Replaced what was there, here's the old thing</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="annot"><span class="hs-comment">-- | Like @insert x y@, but the caller is responsible maintaining left-uniqueness.</span></span><span>
</span><span id="line-252"></span><span id="local-6989586621679121638"><span id="local-6989586621679121639"><span class="annot"><a href="Unison.Util.BiMultimap.html#unsafeInsert"><span class="hs-identifier hs-type">unsafeInsert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121638"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121639"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679121638"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679121639"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121638"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121639"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121638"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121639"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-253"></span><span id="unsafeInsert"><span class="annot"><span class="annottext">unsafeInsert :: forall a b.
(Ord a, Ord b) =&gt;
a -&gt; b -&gt; BiMultimap a b -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#unsafeInsert"><span class="hs-identifier hs-var hs-var">unsafeInsert</span></a></span></span><span> </span><span id="local-6989586621679121645"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121645"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679121646"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679121646"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span id="local-6989586621679121647"><span class="annot"><span class="annottext">Map a (NESet b)
</span><a href="#local-6989586621679121647"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621679121648"><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121648"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-254"></span><span>  </span><span class="annot"><span class="annottext">Map a (NESet b) -&gt; Map b a -&gt; BiMultimap a b
forall a b. Map a (NESet b) -&gt; Map b a -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-var">BiMultimap</span></a></span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Maybe (NESet b) -&gt; NESet b)
-&gt; a -&gt; Map a (NESet b) -&gt; Map a (NESet b)
forall k v. Ord k =&gt; (Maybe v -&gt; v) -&gt; k -&gt; Map k v -&gt; Map k v
</span><span class="hs-identifier hs-var">Map.upsert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NESet b -&gt; (NESet b -&gt; NESet b) -&gt; Maybe (NESet b) -&gt; NESet b
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; NESet b
forall a. a -&gt; NESet a
</span><span class="hs-identifier hs-var">Set.NonEmpty.singleton</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679121646"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; NESet b -&gt; NESet b
forall a. Ord a =&gt; a -&gt; NESet a -&gt; NESet a
</span><span class="hs-identifier hs-var">Set.NonEmpty.insert</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679121646"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121645"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map a (NESet b)
</span><a href="#local-6989586621679121647"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; a -&gt; Map b a -&gt; Map b a
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679121646"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121645"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121648"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span class="hs-comment">-- | Union two left-unique relations together.</span><span>
</span><span id="line-259"></span><span class="hs-comment">--</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- The caller is responsible for maintaining left-uniqueness.</span><span>
</span><span id="line-261"></span><span id="local-6989586621679121649"><span id="local-6989586621679121650"><span class="annot"><a href="Unison.Util.BiMultimap.html#unsafeUnion"><span class="hs-identifier hs-type">unsafeUnion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121649"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121650"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121649"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121650"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121649"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121650"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-type">BiMultimap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121649"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121650"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-262"></span><span id="unsafeUnion"><span class="annot"><span class="annottext">unsafeUnion :: forall a b.
(Ord a, Ord b) =&gt;
BiMultimap a b -&gt; BiMultimap a b -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#unsafeUnion"><span class="hs-identifier hs-var hs-var">unsafeUnion</span></a></span></span><span> </span><span id="local-6989586621679121656"><span class="annot"><span class="annottext">BiMultimap a b
</span><a href="#local-6989586621679121656"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621679121657"><span class="annot"><span class="annottext">BiMultimap a b
</span><a href="#local-6989586621679121657"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-263"></span><span>  </span><span class="annot"><span class="annottext">Map a (NESet b) -&gt; Map b a -&gt; BiMultimap a b
forall a b. Map a (NESet b) -&gt; Map b a -&gt; BiMultimap a b
</span><a href="Unison.Util.BiMultimap.html#BiMultimap"><span class="hs-identifier hs-var">BiMultimap</span></a></span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(NESet b -&gt; NESet b -&gt; NESet b)
-&gt; Map a (NESet b) -&gt; Map a (NESet b) -&gt; Map a (NESet b)
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.unionWith</span></span><span> </span><span class="annot"><span class="annottext">NESet b -&gt; NESet b -&gt; NESet b
forall a. Ord a =&gt; NESet a -&gt; NESet a -&gt; NESet a
</span><span class="hs-identifier hs-var">Set.NonEmpty.union</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BiMultimap a b -&gt; Map a (NESet b)
forall a b. BiMultimap a b -&gt; Map a (NESet b)
</span><a href="Unison.Util.BiMultimap.html#toMultimap"><span class="hs-identifier hs-var">toMultimap</span></a></span><span> </span><span class="annot"><span class="annottext">BiMultimap a b
</span><a href="#local-6989586621679121656"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BiMultimap a b -&gt; Map a (NESet b)
forall a b. BiMultimap a b -&gt; Map a (NESet b)
</span><a href="Unison.Util.BiMultimap.html#toMultimap"><span class="hs-identifier hs-var">toMultimap</span></a></span><span> </span><span class="annot"><span class="annottext">BiMultimap a b
</span><a href="#local-6989586621679121657"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map b a -&gt; Map b a -&gt; Map b a
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.union</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BiMultimap a b -&gt; Map b a
forall a b. BiMultimap a b -&gt; Map b a
</span><a href="Unison.Util.BiMultimap.html#toMapR"><span class="hs-identifier hs-var">toMapR</span></a></span><span> </span><span class="annot"><span class="annottext">BiMultimap a b
</span><a href="#local-6989586621679121656"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BiMultimap a b -&gt; Map b a
forall a b. BiMultimap a b -&gt; Map b a
</span><a href="Unison.Util.BiMultimap.html#toMapR"><span class="hs-identifier hs-var">toMapR</span></a></span><span> </span><span class="annot"><span class="annottext">BiMultimap a b
</span><a href="#local-6989586621679121657"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="hs-comment">------------------------------------------------------------------------------------------------------------------------</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="hs-comment">-- @deriveRangeFromDomain x ys range@ is a helper that inserts @(x, y1)@, @(x, y2)@, ... into range @r@.</span><span>
</span><span id="line-270"></span><span id="local-6989586621679121212"><span id="local-6989586621679121213"><span class="annot"><a href="Unison.Util.BiMultimap.html#deriveRangeFromDomain"><span class="hs-identifier hs-type">deriveRangeFromDomain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679121212"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679121213"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><a href="#local-6989586621679121212"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679121212"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121213"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679121212"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121213"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-271"></span><span id="deriveRangeFromDomain"><span class="annot"><span class="annottext">deriveRangeFromDomain :: forall b a. Ord b =&gt; a -&gt; NESet b -&gt; Map b a -&gt; Map b a
</span><a href="Unison.Util.BiMultimap.html#deriveRangeFromDomain"><span class="hs-identifier hs-var hs-var">deriveRangeFromDomain</span></a></span></span><span> </span><span id="local-6989586621679121664"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121664"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679121665"><span class="annot"><span class="annottext">NESet b
</span><a href="#local-6989586621679121665"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span id="local-6989586621679121666"><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121666"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-272"></span><span>  </span><span class="annot"><span class="annottext">(b -&gt; Map b a -&gt; Map b a) -&gt; Map b a -&gt; NESet b -&gt; Map b a
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; NESet a -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(b -&gt; a -&gt; Map b a -&gt; Map b a) -&gt; a -&gt; b -&gt; Map b a -&gt; Map b a
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; a -&gt; Map b a -&gt; Map b a
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121664"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map b a
</span><a href="#local-6989586621679121666"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">NESet b
</span><a href="#local-6989586621679121665"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-273"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Util.BiMultimap.html#deriveRangeFromDomain"><span class="hs-pragma hs-type">deriveRangeFromDomain</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-274"></span></pre></body></html>