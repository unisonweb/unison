<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE MagicHash #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RoleAnnotations #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE UnboxedTuples #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE Unsafe #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">-- | Variant of @MutVar@ that has one less indirection for primitive types.</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- The difference is illustrated by comparing @MutVar Int@ and @PrimVar Int@:</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- * @MutVar Int@: @MutVar# --&gt; I#@</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- * @PrimVar Int@: @MutableByteArray#@</span><span>
</span><span id="line-12"></span><span class="hs-comment">--</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- This module is adapted from a module in Edward Kmett\'s @prim-ref@ library.</span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.Primitive.PrimVar</span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">(</span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Primitive References</span></span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier">PrimVar</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#newPrimVar"><span class="hs-identifier">newPrimVar</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#newPinnedPrimVar"><span class="hs-identifier">newPinnedPrimVar</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#newAlignedPinnedPrimVar"><span class="hs-identifier">newAlignedPinnedPrimVar</span></a></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#readPrimVar"><span class="hs-identifier">readPrimVar</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#writePrimVar"><span class="hs-identifier">writePrimVar</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#modifyPrimVar"><span class="hs-identifier">modifyPrimVar</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#primVarContents"><span class="hs-identifier">primVarContents</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#primVarToMutablePrimArray"><span class="hs-identifier">primVarToMutablePrimArray</span></a></span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Atomic Operations</span></span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><span class="hs-comment">-- $atomic</span></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#casInt"><span class="hs-identifier">casInt</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#fetchAddInt"><span class="hs-identifier">fetchAddInt</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#fetchSubInt"><span class="hs-identifier">fetchSubInt</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#fetchAndInt"><span class="hs-identifier">fetchAndInt</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#fetchNandInt"><span class="hs-identifier">fetchNandInt</span></a></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#fetchOrInt"><span class="hs-identifier">fetchOrInt</span></a></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#fetchXorInt"><span class="hs-identifier">fetchXorInt</span></a></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#atomicReadInt"><span class="hs-identifier">atomicReadInt</span></a></span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#atomicWriteInt"><span class="hs-identifier">atomicWriteInt</span></a></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.Monad.Primitive.html"><span class="hs-identifier">Control.Monad.Primitive</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Primitive.html"><span class="hs-identifier">Data.Primitive</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Exts</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">castPtr</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-45"></span><span class="annot"><span class="hs-comment">-- * Primitive References</span></span><span>
</span><span id="line-46"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="annot"><span class="hs-comment">-- | A 'PrimVar' behaves like a single-element mutable primitive array.</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">newtype</span><span> </span><span id="PrimVar"><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-var">PrimVar</span></a></span></span><span> </span><span id="local-6989586621679111778"><span class="annot"><a href="#local-6989586621679111778"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679111779"><span class="annot"><a href="#local-6989586621679111779"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PrimVar"><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-var">PrimVar</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimArray.html#MutablePrimArray"><span class="hs-identifier hs-type">MutablePrimArray</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111778"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111779"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">role</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="annot"><span class="hs-identifier">nominal</span></span><span> </span><span class="annot"><span class="hs-identifier">nominal</span></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="annot"><span class="hs-comment">-- | Create a primitive reference.</span></span><span>
</span><span id="line-54"></span><span id="local-6989586621679111762"><span id="local-6989586621679111764"><span class="annot"><a href="Data.Primitive.PrimVar.html#newPrimVar"><span class="hs-identifier hs-type">newPrimVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimMonad"><span class="hs-identifier hs-type">PrimMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111762"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.Types.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111764"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679111764"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679111762"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimState"><span class="hs-identifier hs-type">PrimState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111762"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679111764"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-55"></span><span id="newPrimVar"><span class="annot"><span class="annottext">newPrimVar :: forall (m :: * -&gt; *) a.
(PrimMonad m, Prim a) =&gt;
a -&gt; m (PrimVar (PrimState m) a)
</span><a href="Data.Primitive.PrimVar.html#newPrimVar"><span class="hs-identifier hs-var hs-var">newPrimVar</span></a></span></span><span> </span><span id="local-6989586621679111866"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679111866"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-56"></span><span>  </span><span id="local-6989586621679111867"><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a
</span><a href="#local-6989586621679111867"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m (MutablePrimArray (PrimState m) a)
forall (m :: * -&gt; *) a.
(PrimMonad m, Prim a) =&gt;
Int -&gt; m (MutablePrimArray (PrimState m) a)
</span><a href="Data.Primitive.PrimArray.html#newPrimArray"><span class="hs-identifier hs-var">newPrimArray</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
forall a (m :: * -&gt; *).
(Prim a, PrimMonad m) =&gt;
MutablePrimArray (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><a href="Data.Primitive.PrimArray.html#writePrimArray"><span class="hs-identifier hs-var">writePrimArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a
</span><a href="#local-6989586621679111867"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679111866"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><span class="annottext">PrimVar (PrimState m) a -&gt; m (PrimVar (PrimState m) a)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a -&gt; PrimVar (PrimState m) a
forall s a. MutablePrimArray s a -&gt; PrimVar s a
</span><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-var">PrimVar</span></a></span><span> </span><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a
</span><a href="#local-6989586621679111867"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#newPrimVar"><span class="hs-pragma hs-type">newPrimVar</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="annot"><span class="hs-comment">-- | Create a pinned primitive reference.</span></span><span>
</span><span id="line-62"></span><span id="local-6989586621679111870"><span id="local-6989586621679111871"><span class="annot"><a href="Data.Primitive.PrimVar.html#newPinnedPrimVar"><span class="hs-identifier hs-type">newPinnedPrimVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimMonad"><span class="hs-identifier hs-type">PrimMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111870"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.Types.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111871"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679111871"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679111870"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimState"><span class="hs-identifier hs-type">PrimState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111870"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679111871"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-63"></span><span id="newPinnedPrimVar"><span class="annot"><span class="annottext">newPinnedPrimVar :: forall (m :: * -&gt; *) a.
(PrimMonad m, Prim a) =&gt;
a -&gt; m (PrimVar (PrimState m) a)
</span><a href="Data.Primitive.PrimVar.html#newPinnedPrimVar"><span class="hs-identifier hs-var hs-var">newPinnedPrimVar</span></a></span></span><span> </span><span id="local-6989586621679111882"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679111882"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-64"></span><span>  </span><span id="local-6989586621679111883"><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a
</span><a href="#local-6989586621679111883"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m (MutablePrimArray (PrimState m) a)
forall (m :: * -&gt; *) a.
(PrimMonad m, Prim a) =&gt;
Int -&gt; m (MutablePrimArray (PrimState m) a)
</span><a href="Data.Primitive.PrimArray.html#newPinnedPrimArray"><span class="hs-identifier hs-var">newPinnedPrimArray</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
forall a (m :: * -&gt; *).
(Prim a, PrimMonad m) =&gt;
MutablePrimArray (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><a href="Data.Primitive.PrimArray.html#writePrimArray"><span class="hs-identifier hs-var">writePrimArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a
</span><a href="#local-6989586621679111883"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679111882"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><span class="annottext">PrimVar (PrimState m) a -&gt; m (PrimVar (PrimState m) a)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a -&gt; PrimVar (PrimState m) a
forall s a. MutablePrimArray s a -&gt; PrimVar s a
</span><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-var">PrimVar</span></a></span><span> </span><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a
</span><a href="#local-6989586621679111883"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#newPinnedPrimVar"><span class="hs-pragma hs-type">newPinnedPrimVar</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="annot"><span class="hs-comment">-- | Create a pinned primitive reference with the appropriate alignment for its contents.</span></span><span>
</span><span id="line-70"></span><span id="local-6989586621679111885"><span id="local-6989586621679111886"><span class="annot"><a href="Data.Primitive.PrimVar.html#newAlignedPinnedPrimVar"><span class="hs-identifier hs-type">newAlignedPinnedPrimVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimMonad"><span class="hs-identifier hs-type">PrimMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111885"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.Types.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111886"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679111886"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679111885"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimState"><span class="hs-identifier hs-type">PrimState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111885"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679111886"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-71"></span><span id="newAlignedPinnedPrimVar"><span class="annot"><span class="annottext">newAlignedPinnedPrimVar :: forall (m :: * -&gt; *) a.
(PrimMonad m, Prim a) =&gt;
a -&gt; m (PrimVar (PrimState m) a)
</span><a href="Data.Primitive.PrimVar.html#newAlignedPinnedPrimVar"><span class="hs-identifier hs-var hs-var">newAlignedPinnedPrimVar</span></a></span></span><span> </span><span id="local-6989586621679111897"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679111897"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-72"></span><span>  </span><span id="local-6989586621679111898"><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a
</span><a href="#local-6989586621679111898"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m (MutablePrimArray (PrimState m) a)
forall (m :: * -&gt; *) a.
(PrimMonad m, Prim a) =&gt;
Int -&gt; m (MutablePrimArray (PrimState m) a)
</span><a href="Data.Primitive.PrimArray.html#newAlignedPinnedPrimArray"><span class="hs-identifier hs-var">newAlignedPinnedPrimArray</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
forall a (m :: * -&gt; *).
(Prim a, PrimMonad m) =&gt;
MutablePrimArray (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><a href="Data.Primitive.PrimArray.html#writePrimArray"><span class="hs-identifier hs-var">writePrimArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a
</span><a href="#local-6989586621679111898"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679111897"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><span class="annottext">PrimVar (PrimState m) a -&gt; m (PrimVar (PrimState m) a)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a -&gt; PrimVar (PrimState m) a
forall s a. MutablePrimArray s a -&gt; PrimVar s a
</span><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-var">PrimVar</span></a></span><span> </span><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a
</span><a href="#local-6989586621679111898"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#newAlignedPinnedPrimVar"><span class="hs-pragma hs-type">newAlignedPinnedPrimVar</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="annot"><span class="hs-comment">-- | Read a value from the 'PrimVar'.</span></span><span>
</span><span id="line-78"></span><span id="local-6989586621679111784"><span id="local-6989586621679111785"><span class="annot"><a href="Data.Primitive.PrimVar.html#readPrimVar"><span class="hs-identifier hs-type">readPrimVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimMonad"><span class="hs-identifier hs-type">PrimMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111784"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.Types.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111785"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimState"><span class="hs-identifier hs-type">PrimState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111784"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679111785"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679111784"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111785"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-79"></span><span id="readPrimVar"><span class="annot"><span class="annottext">readPrimVar :: forall (m :: * -&gt; *) a.
(PrimMonad m, Prim a) =&gt;
PrimVar (PrimState m) a -&gt; m a
</span><a href="Data.Primitive.PrimVar.html#readPrimVar"><span class="hs-identifier hs-var hs-var">readPrimVar</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span id="local-6989586621679111904"><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a
</span><a href="#local-6989586621679111904"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a -&gt; Int -&gt; m a
forall a (m :: * -&gt; *).
(Prim a, PrimMonad m) =&gt;
MutablePrimArray (PrimState m) a -&gt; Int -&gt; m a
</span><a href="Data.Primitive.PrimArray.html#readPrimArray"><span class="hs-identifier hs-var">readPrimArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a
</span><a href="#local-6989586621679111904"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-80"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#readPrimVar"><span class="hs-pragma hs-type">readPrimVar</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="annot"><span class="hs-comment">-- | Write a value to the 'PrimVar'.</span></span><span>
</span><span id="line-83"></span><span id="local-6989586621679111790"><span id="local-6989586621679111791"><span class="annot"><a href="Data.Primitive.PrimVar.html#writePrimVar"><span class="hs-identifier hs-type">writePrimVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimMonad"><span class="hs-identifier hs-type">PrimMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111790"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.Types.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111791"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimState"><span class="hs-identifier hs-type">PrimState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111790"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679111791"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679111791"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679111790"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-84"></span><span id="writePrimVar"><span class="annot"><span class="annottext">writePrimVar :: forall (m :: * -&gt; *) a.
(PrimMonad m, Prim a) =&gt;
PrimVar (PrimState m) a -&gt; a -&gt; m ()
</span><a href="Data.Primitive.PrimVar.html#writePrimVar"><span class="hs-identifier hs-var hs-var">writePrimVar</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span id="local-6989586621679111910"><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a
</span><a href="#local-6989586621679111910"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679111911"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679111911"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
forall a (m :: * -&gt; *).
(Prim a, PrimMonad m) =&gt;
MutablePrimArray (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><a href="Data.Primitive.PrimArray.html#writePrimArray"><span class="hs-identifier hs-var">writePrimArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutablePrimArray (PrimState m) a
</span><a href="#local-6989586621679111910"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679111911"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-85"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#writePrimVar"><span class="hs-pragma hs-type">writePrimVar</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="annot"><span class="hs-comment">-- | Mutate the contents of a 'PrimVar'.</span></span><span>
</span><span id="line-88"></span><span id="local-6989586621679111794"><span id="local-6989586621679111795"><span class="annot"><a href="Data.Primitive.PrimVar.html#modifyPrimVar"><span class="hs-identifier hs-type">modifyPrimVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimMonad"><span class="hs-identifier hs-type">PrimMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111794"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Primitive.Types.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111795"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimState"><span class="hs-identifier hs-type">PrimState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111794"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679111795"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679111795"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679111795"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679111794"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-89"></span><span id="modifyPrimVar"><span class="annot"><span class="annottext">modifyPrimVar :: forall (m :: * -&gt; *) a.
(PrimMonad m, Prim a) =&gt;
PrimVar (PrimState m) a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Data.Primitive.PrimVar.html#modifyPrimVar"><span class="hs-identifier hs-var hs-var">modifyPrimVar</span></a></span></span><span> </span><span id="local-6989586621679111920"><span class="annot"><span class="annottext">PrimVar (PrimState m) a
</span><a href="#local-6989586621679111920"><span class="hs-identifier hs-var">pv</span></a></span></span><span> </span><span id="local-6989586621679111921"><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679111921"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-90"></span><span>    </span><span id="local-6989586621679111922"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679111922"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PrimVar (PrimState m) a -&gt; m a
forall (m :: * -&gt; *) a.
(PrimMonad m, Prim a) =&gt;
PrimVar (PrimState m) a -&gt; m a
</span><a href="Data.Primitive.PrimVar.html#readPrimVar"><span class="hs-identifier hs-var">readPrimVar</span></a></span><span> </span><span class="annot"><span class="annottext">PrimVar (PrimState m) a
</span><a href="#local-6989586621679111920"><span class="hs-identifier hs-var">pv</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><span class="annottext">PrimVar (PrimState m) a -&gt; a -&gt; m ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Prim a) =&gt;
PrimVar (PrimState m) a -&gt; a -&gt; m ()
</span><a href="Data.Primitive.PrimVar.html#writePrimVar"><span class="hs-identifier hs-var">writePrimVar</span></a></span><span> </span><span class="annot"><span class="annottext">PrimVar (PrimState m) a
</span><a href="#local-6989586621679111920"><span class="hs-identifier hs-var">pv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679111921"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679111922"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#modifyPrimVar"><span class="hs-pragma hs-type">modifyPrimVar</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679111801"><span id="local-6989586621679111802"><span id="local-6989586621679111925"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111801"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111802"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span id="local-6989586621679111929"><span class="annot"><span class="annottext">MutablePrimArray s a
</span><a href="#local-6989586621679111929"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679111930"><span class="annot"><span class="annottext">== :: PrimVar s a -&gt; PrimVar s a -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span id="local-6989586621679111931"><span class="annot"><span class="annottext">MutablePrimArray s a
</span><a href="#local-6989586621679111931"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutablePrimArray s a -&gt; MutablePrimArray s a -&gt; Bool
forall s a. MutablePrimArray s a -&gt; MutablePrimArray s a -&gt; Bool
</span><a href="Data.Primitive.PrimArray.html#sameMutablePrimArray"><span class="hs-identifier hs-var">sameMutablePrimArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutablePrimArray s a
</span><a href="#local-6989586621679111929"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">MutablePrimArray s a
</span><a href="#local-6989586621679111931"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">==</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">-- | Yield a pointer to the data of a 'PrimVar'. This operation is only safe on pinned byte arrays allocated by</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- 'newPinnedPrimVar' or 'newAlignedPinnedPrimVar'.</span><span>
</span><span id="line-100"></span><span id="local-6989586621679111805"><span id="local-6989586621679111806"><span class="annot"><a href="Data.Primitive.PrimVar.html#primVarContents"><span class="hs-identifier hs-type">primVarContents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111805"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111806"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="#local-6989586621679111806"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-101"></span><span id="primVarContents"><span class="annot"><span class="annottext">primVarContents :: forall s a. PrimVar s a -&gt; Ptr a
</span><a href="Data.Primitive.PrimVar.html#primVarContents"><span class="hs-identifier hs-var hs-var">primVarContents</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span id="local-6989586621679111933"><span class="annot"><span class="annottext">MutablePrimArray s a
</span><a href="#local-6989586621679111933"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr a -&gt; Ptr a
forall a b. Ptr a -&gt; Ptr b
</span><span class="hs-identifier hs-var">castPtr</span></span><span> </span><span class="annot"><span class="annottext">(Ptr a -&gt; Ptr a) -&gt; Ptr a -&gt; Ptr a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MutablePrimArray s a -&gt; Ptr a
forall s a. MutablePrimArray s a -&gt; Ptr a
</span><a href="Data.Primitive.PrimArray.html#mutablePrimArrayContents"><span class="hs-identifier hs-var">mutablePrimArrayContents</span></a></span><span> </span><span class="annot"><span class="annottext">MutablePrimArray s a
</span><a href="#local-6989586621679111933"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-102"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#primVarContents"><span class="hs-pragma hs-type">primVarContents</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="annot"><span class="hs-comment">-- | Convert a 'PrimVar' to a one-elment 'MutablePrimArray'.</span></span><span>
</span><span id="line-105"></span><span id="local-6989586621679111816"><span id="local-6989586621679111817"><span class="annot"><a href="Data.Primitive.PrimVar.html#primVarToMutablePrimArray"><span class="hs-identifier hs-type">primVarToMutablePrimArray</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111816"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111817"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Primitive.PrimArray.html#MutablePrimArray"><span class="hs-identifier hs-type">MutablePrimArray</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111816"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111817"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-106"></span><span id="primVarToMutablePrimArray"><span class="annot"><span class="annottext">primVarToMutablePrimArray :: forall s a. PrimVar s a -&gt; MutablePrimArray s a
</span><a href="Data.Primitive.PrimVar.html#primVarToMutablePrimArray"><span class="hs-identifier hs-var hs-var">primVarToMutablePrimArray</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span id="local-6989586621679111936"><span class="annot"><span class="annottext">MutablePrimArray s a
</span><a href="#local-6989586621679111936"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutablePrimArray s a
</span><a href="#local-6989586621679111936"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-107"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#primVarToMutablePrimArray"><span class="hs-pragma hs-type">primVarToMutablePrimArray</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-110"></span><span class="annot"><span class="hs-comment">-- * Atomic Operations</span></span><span>
</span><span id="line-111"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-comment">-- $atomic</span><span>
</span><span id="line-114"></span><span class="hs-comment">-- Atomic operations on `PrimVar s Int`. All atomic operations imply a full memory barrier.</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="annot"><span class="hs-comment">-- | Given a primitive reference, the expected old value, and the new value, perform an atomic compare and swap i.e. write the new value if the current value matches the provided old value. Returns the value of the element before the operation.</span></span><span>
</span><span id="line-117"></span><span id="local-6989586621679111820"><span class="annot"><a href="Data.Primitive.PrimVar.html#casInt"><span class="hs-identifier hs-type">casInt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.Monad.Primitive.html#PrimMonad"><span class="hs-identifier hs-type">PrimMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111820"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimState"><span class="hs-identifier hs-type">PrimState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111820"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679111820"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-118"></span><span id="casInt"><span class="annot"><span class="annottext">casInt :: forall (m :: * -&gt; *).
PrimMonad m =&gt;
PrimVar (PrimState m) Int -&gt; Int -&gt; Int -&gt; m Int
</span><a href="Data.Primitive.PrimVar.html#casInt"><span class="hs-identifier hs-var hs-var">casInt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimArray.html#MutablePrimArray"><span class="hs-identifier hs-type">MutablePrimArray</span></a></span><span> </span><span id="local-6989586621679111939"><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
</span><a href="#local-6989586621679111939"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621679111940"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111940"><span class="hs-identifier hs-var">old</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621679111941"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111941"><span class="hs-identifier hs-var">new</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(State# (PrimState m) -&gt; (# State# (PrimState m), Int #)) -&gt; m Int
forall a.
(State# (PrimState m) -&gt; (# State# (PrimState m), a #)) -&gt; m a
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
(State# (PrimState m) -&gt; (# State# (PrimState m), a #)) -&gt; m a
</span><a href="Control.Monad.Primitive.html#primitive"><span class="hs-identifier hs-var">primitive</span></a></span><span> </span><span class="annot"><span class="annottext">((State# (PrimState m) -&gt; (# State# (PrimState m), Int #))
 -&gt; m Int)
-&gt; (State# (PrimState m) -&gt; (# State# (PrimState m), Int #))
-&gt; m Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679111943"><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111943"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
-&gt; Int#
-&gt; Int#
-&gt; Int#
-&gt; State# (PrimState m)
-&gt; (# State# (PrimState m), Int# #)
forall d.
MutableByteArray# d
-&gt; Int# -&gt; Int# -&gt; Int# -&gt; State# d -&gt; (# State# d, Int# #)
</span><span class="hs-identifier hs-var">casIntArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
</span><a href="#local-6989586621679111939"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111940"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111941"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111943"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621679111944"><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111944"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679111945"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111945"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111944"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int
</span><span class="hs-identifier hs-var">I#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111945"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-120"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#casInt"><span class="hs-pragma hs-type">casInt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="annot"><span class="hs-comment">-- | Given a reference, and a value to add, atomically add the value to the element. Returns the value of the element before the operation.</span></span><span>
</span><span id="line-123"></span><span id="local-6989586621679111824"><span class="annot"><a href="Data.Primitive.PrimVar.html#fetchAddInt"><span class="hs-identifier hs-type">fetchAddInt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.Monad.Primitive.html#PrimMonad"><span class="hs-identifier hs-type">PrimMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111824"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimState"><span class="hs-identifier hs-type">PrimState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111824"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679111824"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-124"></span><span id="fetchAddInt"><span class="annot"><span class="annottext">fetchAddInt :: forall (m :: * -&gt; *).
PrimMonad m =&gt;
PrimVar (PrimState m) Int -&gt; Int -&gt; m Int
</span><a href="Data.Primitive.PrimVar.html#fetchAddInt"><span class="hs-identifier hs-var hs-var">fetchAddInt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimArray.html#MutablePrimArray"><span class="hs-identifier hs-type">MutablePrimArray</span></a></span><span> </span><span id="local-6989586621679111948"><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
</span><a href="#local-6989586621679111948"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621679111949"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111949"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(State# (PrimState m) -&gt; (# State# (PrimState m), Int #)) -&gt; m Int
forall a.
(State# (PrimState m) -&gt; (# State# (PrimState m), a #)) -&gt; m a
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
(State# (PrimState m) -&gt; (# State# (PrimState m), a #)) -&gt; m a
</span><a href="Control.Monad.Primitive.html#primitive"><span class="hs-identifier hs-var">primitive</span></a></span><span> </span><span class="annot"><span class="annottext">((State# (PrimState m) -&gt; (# State# (PrimState m), Int #))
 -&gt; m Int)
-&gt; (State# (PrimState m) -&gt; (# State# (PrimState m), Int #))
-&gt; m Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679111950"><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111950"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
-&gt; Int#
-&gt; Int#
-&gt; State# (PrimState m)
-&gt; (# State# (PrimState m), Int# #)
forall d.
MutableByteArray# d
-&gt; Int# -&gt; Int# -&gt; State# d -&gt; (# State# d, Int# #)
</span><span class="hs-identifier hs-var">fetchAddIntArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
</span><a href="#local-6989586621679111948"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111949"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111950"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621679111951"><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111951"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679111952"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111952"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111951"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int
</span><span class="hs-identifier hs-var">I#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111952"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-126"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#fetchAddInt"><span class="hs-pragma hs-type">fetchAddInt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="annot"><span class="hs-comment">-- | Given a reference, and a value to subtract, atomically subtract the value from the element. Returns the value of the element before the operation.</span></span><span>
</span><span id="line-129"></span><span id="local-6989586621679111953"><span class="annot"><a href="Data.Primitive.PrimVar.html#fetchSubInt"><span class="hs-identifier hs-type">fetchSubInt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.Monad.Primitive.html#PrimMonad"><span class="hs-identifier hs-type">PrimMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111953"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimState"><span class="hs-identifier hs-type">PrimState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111953"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679111953"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-130"></span><span id="fetchSubInt"><span class="annot"><span class="annottext">fetchSubInt :: forall (m :: * -&gt; *).
PrimMonad m =&gt;
PrimVar (PrimState m) Int -&gt; Int -&gt; m Int
</span><a href="Data.Primitive.PrimVar.html#fetchSubInt"><span class="hs-identifier hs-var hs-var">fetchSubInt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimArray.html#MutablePrimArray"><span class="hs-identifier hs-type">MutablePrimArray</span></a></span><span> </span><span id="local-6989586621679111956"><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
</span><a href="#local-6989586621679111956"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621679111957"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111957"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(State# (PrimState m) -&gt; (# State# (PrimState m), Int #)) -&gt; m Int
forall a.
(State# (PrimState m) -&gt; (# State# (PrimState m), a #)) -&gt; m a
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
(State# (PrimState m) -&gt; (# State# (PrimState m), a #)) -&gt; m a
</span><a href="Control.Monad.Primitive.html#primitive"><span class="hs-identifier hs-var">primitive</span></a></span><span> </span><span class="annot"><span class="annottext">((State# (PrimState m) -&gt; (# State# (PrimState m), Int #))
 -&gt; m Int)
-&gt; (State# (PrimState m) -&gt; (# State# (PrimState m), Int #))
-&gt; m Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679111958"><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111958"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
-&gt; Int#
-&gt; Int#
-&gt; State# (PrimState m)
-&gt; (# State# (PrimState m), Int# #)
forall d.
MutableByteArray# d
-&gt; Int# -&gt; Int# -&gt; State# d -&gt; (# State# d, Int# #)
</span><span class="hs-identifier hs-var">fetchSubIntArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
</span><a href="#local-6989586621679111956"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111957"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111958"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621679111959"><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111959"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679111960"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111960"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111959"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int
</span><span class="hs-identifier hs-var">I#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111960"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-132"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#fetchSubInt"><span class="hs-pragma hs-type">fetchSubInt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="annot"><span class="hs-comment">-- | Given a reference, and a value to bitwise and, atomically and the value with the element. Returns the value of the element before the operation.</span></span><span>
</span><span id="line-135"></span><span id="local-6989586621679111961"><span class="annot"><a href="Data.Primitive.PrimVar.html#fetchAndInt"><span class="hs-identifier hs-type">fetchAndInt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.Monad.Primitive.html#PrimMonad"><span class="hs-identifier hs-type">PrimMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111961"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimState"><span class="hs-identifier hs-type">PrimState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111961"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679111961"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-136"></span><span id="fetchAndInt"><span class="annot"><span class="annottext">fetchAndInt :: forall (m :: * -&gt; *).
PrimMonad m =&gt;
PrimVar (PrimState m) Int -&gt; Int -&gt; m Int
</span><a href="Data.Primitive.PrimVar.html#fetchAndInt"><span class="hs-identifier hs-var hs-var">fetchAndInt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimArray.html#MutablePrimArray"><span class="hs-identifier hs-type">MutablePrimArray</span></a></span><span> </span><span id="local-6989586621679111964"><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
</span><a href="#local-6989586621679111964"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621679111965"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111965"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(State# (PrimState m) -&gt; (# State# (PrimState m), Int #)) -&gt; m Int
forall a.
(State# (PrimState m) -&gt; (# State# (PrimState m), a #)) -&gt; m a
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
(State# (PrimState m) -&gt; (# State# (PrimState m), a #)) -&gt; m a
</span><a href="Control.Monad.Primitive.html#primitive"><span class="hs-identifier hs-var">primitive</span></a></span><span> </span><span class="annot"><span class="annottext">((State# (PrimState m) -&gt; (# State# (PrimState m), Int #))
 -&gt; m Int)
-&gt; (State# (PrimState m) -&gt; (# State# (PrimState m), Int #))
-&gt; m Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679111966"><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111966"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
-&gt; Int#
-&gt; Int#
-&gt; State# (PrimState m)
-&gt; (# State# (PrimState m), Int# #)
forall d.
MutableByteArray# d
-&gt; Int# -&gt; Int# -&gt; State# d -&gt; (# State# d, Int# #)
</span><span class="hs-identifier hs-var">fetchAndIntArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
</span><a href="#local-6989586621679111964"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111965"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111966"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621679111967"><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111967"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679111968"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111968"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111967"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int
</span><span class="hs-identifier hs-var">I#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111968"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-138"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#fetchAndInt"><span class="hs-pragma hs-type">fetchAndInt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="annot"><span class="hs-comment">-- | Given a reference, and a value to bitwise nand, atomically nand the value with the element. Returns the value of the element before the operation.</span></span><span>
</span><span id="line-141"></span><span id="local-6989586621679111969"><span class="annot"><a href="Data.Primitive.PrimVar.html#fetchNandInt"><span class="hs-identifier hs-type">fetchNandInt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.Monad.Primitive.html#PrimMonad"><span class="hs-identifier hs-type">PrimMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111969"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimState"><span class="hs-identifier hs-type">PrimState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111969"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679111969"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-142"></span><span id="fetchNandInt"><span class="annot"><span class="annottext">fetchNandInt :: forall (m :: * -&gt; *).
PrimMonad m =&gt;
PrimVar (PrimState m) Int -&gt; Int -&gt; m Int
</span><a href="Data.Primitive.PrimVar.html#fetchNandInt"><span class="hs-identifier hs-var hs-var">fetchNandInt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimArray.html#MutablePrimArray"><span class="hs-identifier hs-type">MutablePrimArray</span></a></span><span> </span><span id="local-6989586621679111972"><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
</span><a href="#local-6989586621679111972"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621679111973"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111973"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(State# (PrimState m) -&gt; (# State# (PrimState m), Int #)) -&gt; m Int
forall a.
(State# (PrimState m) -&gt; (# State# (PrimState m), a #)) -&gt; m a
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
(State# (PrimState m) -&gt; (# State# (PrimState m), a #)) -&gt; m a
</span><a href="Control.Monad.Primitive.html#primitive"><span class="hs-identifier hs-var">primitive</span></a></span><span> </span><span class="annot"><span class="annottext">((State# (PrimState m) -&gt; (# State# (PrimState m), Int #))
 -&gt; m Int)
-&gt; (State# (PrimState m) -&gt; (# State# (PrimState m), Int #))
-&gt; m Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679111974"><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111974"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
-&gt; Int#
-&gt; Int#
-&gt; State# (PrimState m)
-&gt; (# State# (PrimState m), Int# #)
forall d.
MutableByteArray# d
-&gt; Int# -&gt; Int# -&gt; State# d -&gt; (# State# d, Int# #)
</span><span class="hs-identifier hs-var">fetchNandIntArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
</span><a href="#local-6989586621679111972"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111973"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111974"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621679111975"><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111975"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679111976"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111976"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111975"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int
</span><span class="hs-identifier hs-var">I#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111976"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-144"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#fetchNandInt"><span class="hs-pragma hs-type">fetchNandInt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="annot"><span class="hs-comment">-- | Given a reference, and a value to bitwise or, atomically or the value with the element. Returns the value of the element before the operation.</span></span><span>
</span><span id="line-147"></span><span id="local-6989586621679111977"><span class="annot"><a href="Data.Primitive.PrimVar.html#fetchOrInt"><span class="hs-identifier hs-type">fetchOrInt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.Monad.Primitive.html#PrimMonad"><span class="hs-identifier hs-type">PrimMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111977"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimState"><span class="hs-identifier hs-type">PrimState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111977"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679111977"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-148"></span><span id="fetchOrInt"><span class="annot"><span class="annottext">fetchOrInt :: forall (m :: * -&gt; *).
PrimMonad m =&gt;
PrimVar (PrimState m) Int -&gt; Int -&gt; m Int
</span><a href="Data.Primitive.PrimVar.html#fetchOrInt"><span class="hs-identifier hs-var hs-var">fetchOrInt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimArray.html#MutablePrimArray"><span class="hs-identifier hs-type">MutablePrimArray</span></a></span><span> </span><span id="local-6989586621679111980"><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
</span><a href="#local-6989586621679111980"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621679111981"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111981"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(State# (PrimState m) -&gt; (# State# (PrimState m), Int #)) -&gt; m Int
forall a.
(State# (PrimState m) -&gt; (# State# (PrimState m), a #)) -&gt; m a
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
(State# (PrimState m) -&gt; (# State# (PrimState m), a #)) -&gt; m a
</span><a href="Control.Monad.Primitive.html#primitive"><span class="hs-identifier hs-var">primitive</span></a></span><span> </span><span class="annot"><span class="annottext">((State# (PrimState m) -&gt; (# State# (PrimState m), Int #))
 -&gt; m Int)
-&gt; (State# (PrimState m) -&gt; (# State# (PrimState m), Int #))
-&gt; m Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679111982"><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111982"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
-&gt; Int#
-&gt; Int#
-&gt; State# (PrimState m)
-&gt; (# State# (PrimState m), Int# #)
forall d.
MutableByteArray# d
-&gt; Int# -&gt; Int# -&gt; State# d -&gt; (# State# d, Int# #)
</span><span class="hs-identifier hs-var">fetchOrIntArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
</span><a href="#local-6989586621679111980"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111981"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111982"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621679111983"><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111983"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679111984"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111984"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111983"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int
</span><span class="hs-identifier hs-var">I#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111984"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-150"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#fetchOrInt"><span class="hs-pragma hs-type">fetchOrInt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="annot"><span class="hs-comment">-- | Given a reference, and a value to bitwise xor, atomically xor the value with the element. Returns the value of the element before the operation.</span></span><span>
</span><span id="line-153"></span><span id="local-6989586621679111985"><span class="annot"><a href="Data.Primitive.PrimVar.html#fetchXorInt"><span class="hs-identifier hs-type">fetchXorInt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.Monad.Primitive.html#PrimMonad"><span class="hs-identifier hs-type">PrimMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111985"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimState"><span class="hs-identifier hs-type">PrimState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111985"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679111985"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-154"></span><span id="fetchXorInt"><span class="annot"><span class="annottext">fetchXorInt :: forall (m :: * -&gt; *).
PrimMonad m =&gt;
PrimVar (PrimState m) Int -&gt; Int -&gt; m Int
</span><a href="Data.Primitive.PrimVar.html#fetchXorInt"><span class="hs-identifier hs-var hs-var">fetchXorInt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimArray.html#MutablePrimArray"><span class="hs-identifier hs-type">MutablePrimArray</span></a></span><span> </span><span id="local-6989586621679111988"><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
</span><a href="#local-6989586621679111988"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621679111989"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111989"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(State# (PrimState m) -&gt; (# State# (PrimState m), Int #)) -&gt; m Int
forall a.
(State# (PrimState m) -&gt; (# State# (PrimState m), a #)) -&gt; m a
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
(State# (PrimState m) -&gt; (# State# (PrimState m), a #)) -&gt; m a
</span><a href="Control.Monad.Primitive.html#primitive"><span class="hs-identifier hs-var">primitive</span></a></span><span> </span><span class="annot"><span class="annottext">((State# (PrimState m) -&gt; (# State# (PrimState m), Int #))
 -&gt; m Int)
-&gt; (State# (PrimState m) -&gt; (# State# (PrimState m), Int #))
-&gt; m Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679111990"><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111990"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
-&gt; Int#
-&gt; Int#
-&gt; State# (PrimState m)
-&gt; (# State# (PrimState m), Int# #)
forall d.
MutableByteArray# d
-&gt; Int# -&gt; Int# -&gt; State# d -&gt; (# State# d, Int# #)
</span><span class="hs-identifier hs-var">fetchXorIntArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
</span><a href="#local-6989586621679111988"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111989"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111990"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621679111991"><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111991"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679111992"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111992"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111991"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int
</span><span class="hs-identifier hs-var">I#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111992"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-156"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#fetchXorInt"><span class="hs-pragma hs-type">fetchXorInt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="annot"><span class="hs-comment">-- | Given a reference, atomically read an element.</span></span><span>
</span><span id="line-159"></span><span id="local-6989586621679111831"><span class="annot"><a href="Data.Primitive.PrimVar.html#atomicReadInt"><span class="hs-identifier hs-type">atomicReadInt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.Monad.Primitive.html#PrimMonad"><span class="hs-identifier hs-type">PrimMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111831"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimState"><span class="hs-identifier hs-type">PrimState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111831"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679111831"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-160"></span><span id="atomicReadInt"><span class="annot"><span class="annottext">atomicReadInt :: forall (m :: * -&gt; *).
PrimMonad m =&gt;
PrimVar (PrimState m) Int -&gt; m Int
</span><a href="Data.Primitive.PrimVar.html#atomicReadInt"><span class="hs-identifier hs-var hs-var">atomicReadInt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimArray.html#MutablePrimArray"><span class="hs-identifier hs-type">MutablePrimArray</span></a></span><span> </span><span id="local-6989586621679111995"><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
</span><a href="#local-6989586621679111995"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(State# (PrimState m) -&gt; (# State# (PrimState m), Int #)) -&gt; m Int
forall a.
(State# (PrimState m) -&gt; (# State# (PrimState m), a #)) -&gt; m a
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
(State# (PrimState m) -&gt; (# State# (PrimState m), a #)) -&gt; m a
</span><a href="Control.Monad.Primitive.html#primitive"><span class="hs-identifier hs-var">primitive</span></a></span><span> </span><span class="annot"><span class="annottext">((State# (PrimState m) -&gt; (# State# (PrimState m), Int #))
 -&gt; m Int)
-&gt; (State# (PrimState m) -&gt; (# State# (PrimState m), Int #))
-&gt; m Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679111996"><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111996"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
-&gt; Int# -&gt; State# (PrimState m) -&gt; (# State# (PrimState m), Int# #)
forall d.
MutableByteArray# d -&gt; Int# -&gt; State# d -&gt; (# State# d, Int# #)
</span><span class="hs-identifier hs-var">atomicReadIntArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
</span><a href="#local-6989586621679111995"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111996"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621679111997"><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111997"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679111998"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111998"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679111997"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int
</span><span class="hs-identifier hs-var">I#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679111998"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-162"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#atomicReadInt"><span class="hs-pragma hs-type">atomicReadInt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="annot"><span class="hs-comment">-- | Given a reference, atomically write an element.</span></span><span>
</span><span id="line-165"></span><span id="local-6989586621679111833"><span class="annot"><a href="Data.Primitive.PrimVar.html#atomicWriteInt"><span class="hs-identifier hs-type">atomicWriteInt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.Monad.Primitive.html#PrimMonad"><span class="hs-identifier hs-type">PrimMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111833"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Primitive.html#PrimState"><span class="hs-identifier hs-type">PrimState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679111833"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679111833"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-166"></span><span id="atomicWriteInt"><span class="annot"><span class="annottext">atomicWriteInt :: forall (m :: * -&gt; *).
PrimMonad m =&gt;
PrimVar (PrimState m) Int -&gt; Int -&gt; m ()
</span><a href="Data.Primitive.PrimVar.html#atomicWriteInt"><span class="hs-identifier hs-var hs-var">atomicWriteInt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimVar.html#PrimVar"><span class="hs-identifier hs-type">PrimVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Primitive.PrimArray.html#MutablePrimArray"><span class="hs-identifier hs-type">MutablePrimArray</span></a></span><span> </span><span id="local-6989586621679112001"><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
</span><a href="#local-6989586621679112001"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621679112002"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679112002"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(State# (PrimState m) -&gt; State# (PrimState m)) -&gt; m ()
forall (m :: * -&gt; *).
PrimMonad m =&gt;
(State# (PrimState m) -&gt; State# (PrimState m)) -&gt; m ()
</span><a href="Control.Monad.Primitive.html#primitive_"><span class="hs-identifier hs-var">primitive_</span></a></span><span> </span><span class="annot"><span class="annottext">((State# (PrimState m) -&gt; State# (PrimState m)) -&gt; m ())
-&gt; (State# (PrimState m) -&gt; State# (PrimState m)) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679112004"><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679112004"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
-&gt; Int# -&gt; Int# -&gt; State# (PrimState m) -&gt; State# (PrimState m)
forall d.
MutableByteArray# d -&gt; Int# -&gt; Int# -&gt; State# d -&gt; State# d
</span><span class="hs-identifier hs-var">atomicWriteIntArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray# (PrimState m)
</span><a href="#local-6989586621679112001"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679112002"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">State# (PrimState m)
</span><a href="#local-6989586621679112004"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-167"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Primitive.PrimVar.html#atomicWriteInt"><span class="hs-pragma hs-type">atomicWriteInt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-168"></span></pre></body></html>