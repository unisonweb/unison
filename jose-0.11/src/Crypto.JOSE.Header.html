<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- Copyright (C) 2016, 2017  Fraser Tweedale</span><span>
</span><span id="line-2"></span><span class="hs-comment">--</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- you may not use this file except in compliance with the License.</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- You may obtain a copy of the License at</span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-comment">--      http://www.apache.org/licenses/LICENSE-2.0</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Unless required by applicable law or agreed to in writing, software</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- See the License for the specific language governing permissions and</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- limitations under the License.</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE KindSignatures #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="annot"><span class="hs-comment">{-|

Types and functions for working with JOSE header parameters.

-}</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Crypto.JOSE.Header</span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">(</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Defining header data types</span></span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier">HeaderParam</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#ProtectionIndicator"><span class="hs-identifier">ProtectionIndicator</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#Protection"><span class="hs-identifier">Protection</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#protection"><span class="hs-identifier">protection</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#isProtected"><span class="hs-identifier">isProtected</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#param"><span class="hs-identifier">param</span></a></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Defining header parsers</span></span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><span class="hs-comment">-- $parsing</span></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#HasParams"><span class="hs-identifier">HasParams</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#headerRequired"><span class="hs-identifier">headerRequired</span></a></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#headerRequiredProtected"><span class="hs-identifier">headerRequiredProtected</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#headerOptional"><span class="hs-identifier">headerOptional</span></a></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#headerOptional%27"><span class="hs-identifier">headerOptional'</span></a></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#headerOptionalProtected"><span class="hs-identifier">headerOptionalProtected</span></a></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Parsing headers</span></span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#parseParams"><span class="hs-identifier">parseParams</span></a></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#parseCrit"><span class="hs-identifier">parseCrit</span></a></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Encoding headers</span></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#protectedParamsEncoded"><span class="hs-identifier">protectedParamsEncoded</span></a></span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#unprotectedParams"><span class="hs-identifier">unprotectedParams</span></a></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Header fields shared by JWS and JWE</span></span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#HasAlg"><span class="hs-identifier">HasAlg</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#HasJku"><span class="hs-identifier">HasJku</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#HasJwk"><span class="hs-identifier">HasJwk</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#HasKid"><span class="hs-identifier">HasKid</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#HasX5u"><span class="hs-identifier">HasX5u</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#HasX5c"><span class="hs-identifier">HasX5c</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#HasX5t"><span class="hs-identifier">HasX5t</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#HasX5tS256"><span class="hs-identifier">HasX5tS256</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#HasTyp"><span class="hs-identifier">HasTyp</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#HasCty"><span class="hs-identifier">HasCty</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#HasCrit"><span class="hs-identifier">HasCrit</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Fail</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Fail</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Proxy</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Lens'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Getter</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">review</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">to</span></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">FromJSON</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Object</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Value</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">encode</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">object</span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Pair</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Parser</span></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.Key</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Key</span></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.KeyMap</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Crypto.JOSE.JWA.JWS.html"><span class="hs-identifier">Crypto.JOSE.JWA.JWS</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">JWA.JWS</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Crypto.JOSE.JWK.html"><span class="hs-identifier">Crypto.JOSE.JWK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.JWK.html#JWK"><span class="hs-identifier">JWK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Crypto.JOSE.Types.Internal.html"><span class="hs-identifier">Crypto.JOSE.Types.Internal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Types.Internal.html#base64url"><span class="hs-identifier">base64url</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Crypto.JOSE.Types.html"><span class="hs-identifier">Crypto.JOSE.Types</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Types</span></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-comment">-- | A thing with parameters.</span><span>
</span><span id="line-86"></span><span class="hs-comment">--</span><span>
</span><span id="line-87"></span><span class="hs-keyword">class</span><span> </span><span id="HasParams"><span class="annot"><a href="Crypto.JOSE.Header.html#HasParams"><span class="hs-identifier hs-var">HasParams</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679348531"><span class="annot"><a href="#local-6989586621679348531"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-comment">-- | Return a list of parameters,</span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-comment">-- each paired with whether it is protected or not.</span><span>
</span><span id="line-90"></span><span>  </span><span id="params"><span class="annot"><a href="Crypto.JOSE.Header.html#params"><span class="hs-identifier hs-type">params</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679348565"><span class="annot"><a href="Crypto.JOSE.Header.html#ProtectionIndicator"><span class="hs-identifier hs-type">ProtectionIndicator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348565"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679348531"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348565"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pair</span></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-comment">-- | List of &quot;known extensions&quot;, i.e. keys that may appear in the</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-comment">-- &quot;crit&quot; header parameter.</span><span>
</span><span id="line-94"></span><span>  </span><span id="extensions"><span class="annot"><a href="Crypto.JOSE.Header.html#extensions"><span class="hs-identifier hs-type">extensions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679348531"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span>
</span><span id="line-95"></span><span>  </span><span id="local-6989586621679348736"><span class="annot"><a href="Crypto.JOSE.Header.html#extensions"><span class="hs-identifier hs-var hs-var">extensions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Proxy a -&gt; [Text]
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>  </span><span id="parseParamsFor"><span class="annot"><a href="Crypto.JOSE.Header.html#parseParamsFor"><span class="hs-identifier hs-type">parseParamsFor</span></a></span></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679348545"><span id="local-6989586621679348546"><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HasParams"><span class="hs-identifier hs-type">HasParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348545"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#ProtectionIndicator"><span class="hs-identifier hs-type">ProtectionIndicator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348546"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679348545"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Object</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Object</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Parser</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679348531"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348546"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-comment">-- | Parse a pair of objects (protected and unprotected header)</span><span>
</span><span id="line-102"></span><span class="hs-comment">--</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- This internally invokes 'parseParamsFor' applied to a proxy for</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- the target type.  (This allows the parsing of the &quot;crit&quot; parameter</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- to access &quot;known extensions&quot; understood by the target type.)</span><span>
</span><span id="line-106"></span><span class="hs-comment">--</span><span>
</span><span id="line-107"></span><span class="annot"><a href="Crypto.JOSE.Header.html#parseParams"><span class="hs-identifier hs-type">parseParams</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679348538"><span class="annot"><a href="#local-6989586621679348538"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679348539"><span class="annot"><a href="#local-6989586621679348539"><span class="hs-identifier hs-type">p</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HasParams"><span class="hs-identifier hs-type">HasParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348538"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#ProtectionIndicator"><span class="hs-identifier hs-type">ProtectionIndicator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348539"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Object</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ protected header</span></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Object</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ unprotected header</span></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Parser</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679348538"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348539"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span id="parseParams"><span class="annot"><span class="annottext">parseParams :: forall (a :: * -&gt; *) p.
(HasParams a, ProtectionIndicator p) =&gt;
Maybe Object -&gt; Maybe Object -&gt; Parser (a p)
</span><a href="Crypto.JOSE.Header.html#parseParams"><span class="hs-identifier hs-var hs-var">parseParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy a -&gt; Maybe Object -&gt; Maybe Object -&gt; Parser (a p)
forall (a :: * -&gt; *) (b :: * -&gt; *) p.
(HasParams a, HasParams b, ProtectionIndicator p) =&gt;
Proxy b -&gt; Maybe Object -&gt; Maybe Object -&gt; Parser (a p)
forall (b :: * -&gt; *) p.
(HasParams b, ProtectionIndicator p) =&gt;
Proxy b -&gt; Maybe Object -&gt; Maybe Object -&gt; Parser (a p)
</span><a href="Crypto.JOSE.Header.html#parseParamsFor"><span class="hs-identifier hs-var">parseParamsFor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy a
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679348538"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span id="local-6989586621679348549"><span id="local-6989586621679348550"><span class="annot"><a href="Crypto.JOSE.Header.html#protectedParams"><span class="hs-identifier hs-type">protectedParams</span></a></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HasParams"><span class="hs-identifier hs-type">HasParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348549"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#ProtectionIndicator"><span class="hs-identifier hs-type">ProtectionIndicator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348550"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679348549"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348550"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span></span></span><span> </span><span class="annot"><span class="hs-comment">{- ^ Object -}</span></span><span>
</span><span id="line-117"></span><span id="protectedParams"><span class="annot"><span class="annottext">protectedParams :: forall (a :: * -&gt; *) p.
(HasParams a, ProtectionIndicator p) =&gt;
a p -&gt; Maybe Value
</span><a href="Crypto.JOSE.Header.html#protectedParams"><span class="hs-identifier hs-var hs-var">protectedParams</span></a></span></span><span> </span><span id="local-6989586621679348750"><span class="annot"><span class="annottext">a p
</span><a href="#local-6989586621679348750"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Bool, Pair) -&gt; Pair) -&gt; [(Bool, Pair)] -&gt; [Pair]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Bool, Pair) -&gt; Pair
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(Bool, Pair)] -&gt; [Pair])
-&gt; (a p -&gt; [(Bool, Pair)]) -&gt; a p -&gt; [Pair]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Bool, Pair) -&gt; Bool) -&gt; [(Bool, Pair)] -&gt; [(Bool, Pair)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">(Bool, Pair) -&gt; Bool
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">([(Bool, Pair)] -&gt; [(Bool, Pair)])
-&gt; (a p -&gt; [(Bool, Pair)]) -&gt; a p -&gt; [(Bool, Pair)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a p -&gt; [(Bool, Pair)]
forall p. ProtectionIndicator p =&gt; a p -&gt; [(Bool, Pair)]
forall (a :: * -&gt; *) p.
(HasParams a, ProtectionIndicator p) =&gt;
a p -&gt; [(Bool, Pair)]
</span><a href="Crypto.JOSE.Header.html#params"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a p
</span><a href="#local-6989586621679348750"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-120"></span><span>    </span><span id="local-6989586621679348754"><span class="annot"><span class="annottext">[Pair]
</span><a href="#local-6989586621679348754"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Maybe Value
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">object</span></span><span> </span><span class="annot"><span class="annottext">[Pair]
</span><a href="#local-6989586621679348754"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-comment">-- | Return the base64url-encoded protected parameters</span><span>
</span><span id="line-123"></span><span class="hs-comment">--</span><span>
</span><span id="line-124"></span><span id="local-6989586621679348566"><span id="local-6989586621679348567"><span class="annot"><a href="Crypto.JOSE.Header.html#protectedParamsEncoded"><span class="hs-identifier hs-type">protectedParamsEncoded</span></a></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HasParams"><span class="hs-identifier hs-type">HasParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348566"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#ProtectionIndicator"><span class="hs-identifier hs-type">ProtectionIndicator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348567"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679348566"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348567"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ByteString</span></span></span></span><span>
</span><span id="line-127"></span><span id="protectedParamsEncoded"><span class="annot"><span class="annottext">protectedParamsEncoded :: forall (a :: * -&gt; *) p.
(HasParams a, ProtectionIndicator p) =&gt;
a p -&gt; ByteString
</span><a href="Crypto.JOSE.Header.html#protectedParamsEncoded"><span class="hs-identifier hs-var hs-var">protectedParamsEncoded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><span class="annottext">ByteString -&gt; (Value -&gt; ByteString) -&gt; Maybe Value -&gt; ByteString
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">ByteString
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AReview ByteString ByteString -&gt; ByteString -&gt; ByteString
forall b (m :: * -&gt; *) t. MonadReader b m =&gt; AReview t b -&gt; m t
</span><span class="hs-identifier hs-var">review</span></span><span> </span><span class="annot"><span class="annottext">AReview ByteString ByteString
forall s1 s2.
(AsEmpty s1, AsEmpty s2, Cons s1 s1 Word8 Word8,
 Cons s2 s2 Word8 Word8) =&gt;
Prism' s1 s2
Prism' ByteString ByteString
</span><a href="Crypto.JOSE.Types.Internal.html#base64url"><span class="hs-identifier hs-var">base64url</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (Value -&gt; ByteString) -&gt; Value -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">encode</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Value -&gt; ByteString)
-&gt; (a p -&gt; Maybe Value) -&gt; a p -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a p -&gt; Maybe Value
forall (a :: * -&gt; *) p.
(HasParams a, ProtectionIndicator p) =&gt;
a p -&gt; Maybe Value
</span><a href="Crypto.JOSE.Header.html#protectedParams"><span class="hs-identifier hs-var">protectedParams</span></a></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="hs-comment">-- | Return unprotected params as a JSON 'Value' (always an object)</span><span>
</span><span id="line-131"></span><span class="hs-comment">--</span><span>
</span><span id="line-132"></span><span id="local-6989586621679348776"><span id="local-6989586621679348777"><span class="annot"><a href="Crypto.JOSE.Header.html#unprotectedParams"><span class="hs-identifier hs-type">unprotectedParams</span></a></span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HasParams"><span class="hs-identifier hs-type">HasParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348776"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#ProtectionIndicator"><span class="hs-identifier hs-type">ProtectionIndicator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348777"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679348776"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348777"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span></span></span><span> </span><span class="annot"><span class="hs-comment">{- ^ Object -}</span></span><span>
</span><span id="line-135"></span><span id="unprotectedParams"><span class="annot"><span class="annottext">unprotectedParams :: forall (a :: * -&gt; *) p.
(HasParams a, ProtectionIndicator p) =&gt;
a p -&gt; Maybe Value
</span><a href="Crypto.JOSE.Header.html#unprotectedParams"><span class="hs-identifier hs-var hs-var">unprotectedParams</span></a></span></span><span> </span><span id="local-6989586621679348782"><span class="annot"><span class="annottext">a p
</span><a href="#local-6989586621679348782"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Bool, Pair) -&gt; Pair) -&gt; [(Bool, Pair)] -&gt; [Pair]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Bool, Pair) -&gt; Pair
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(Bool, Pair)] -&gt; [Pair])
-&gt; (a p -&gt; [(Bool, Pair)]) -&gt; a p -&gt; [Pair]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Bool, Pair) -&gt; Bool) -&gt; [(Bool, Pair)] -&gt; [(Bool, Pair)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; ((Bool, Pair) -&gt; Bool) -&gt; (Bool, Pair) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Bool, Pair) -&gt; Bool
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Bool, Pair)] -&gt; [(Bool, Pair)])
-&gt; (a p -&gt; [(Bool, Pair)]) -&gt; a p -&gt; [(Bool, Pair)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a p -&gt; [(Bool, Pair)]
forall p. ProtectionIndicator p =&gt; a p -&gt; [(Bool, Pair)]
forall (a :: * -&gt; *) p.
(HasParams a, ProtectionIndicator p) =&gt;
a p -&gt; [(Bool, Pair)]
</span><a href="Crypto.JOSE.Header.html#params"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a p
</span><a href="#local-6989586621679348782"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-138"></span><span>    </span><span id="local-6989586621679348784"><span class="annot"><span class="annottext">[Pair]
</span><a href="#local-6989586621679348784"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Maybe Value
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">object</span></span><span> </span><span class="annot"><span class="annottext">[Pair]
</span><a href="#local-6989586621679348784"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-comment">-- | Whether a header is protected or unprotected</span><span>
</span><span id="line-141"></span><span class="hs-comment">--</span><span>
</span><span id="line-142"></span><span class="hs-keyword">data</span><span> </span><span id="Protection"><span class="annot"><a href="Crypto.JOSE.Header.html#Protection"><span class="hs-identifier hs-var">Protection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Protected"><span class="annot"><a href="Crypto.JOSE.Header.html#Protected"><span class="hs-identifier hs-var">Protected</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Unprotected"><span class="annot"><a href="Crypto.JOSE.Header.html#Unprotected"><span class="hs-identifier hs-var">Unprotected</span></a></span></span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679348788"><span id="local-6989586621679348790"><span class="annot"><span class="annottext">Protection -&gt; Protection -&gt; Bool
(Protection -&gt; Protection -&gt; Bool)
-&gt; (Protection -&gt; Protection -&gt; Bool) -&gt; Eq Protection
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Protection -&gt; Protection -&gt; Bool
== :: Protection -&gt; Protection -&gt; Bool
$c/= :: Protection -&gt; Protection -&gt; Bool
/= :: Protection -&gt; Protection -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348795"><span id="local-6989586621679348797"><span id="local-6989586621679348801"><span class="annot"><span class="annottext">Int -&gt; Protection -&gt; ShowS
[Protection] -&gt; ShowS
Protection -&gt; String
(Int -&gt; Protection -&gt; ShowS)
-&gt; (Protection -&gt; String)
-&gt; ([Protection] -&gt; ShowS)
-&gt; Show Protection
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Protection -&gt; ShowS
showsPrec :: Int -&gt; Protection -&gt; ShowS
$cshow :: Protection -&gt; String
show :: Protection -&gt; String
$cshowList :: [Protection] -&gt; ShowS
showList :: [Protection] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679348596"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="ProtectionIndicator"><span class="annot"><a href="Crypto.JOSE.Header.html#ProtectionIndicator"><span class="hs-identifier hs-var">ProtectionIndicator</span></a></span></span><span> </span><span id="local-6989586621679348596"><span class="annot"><a href="#local-6989586621679348596"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-comment">-- | Get a value for indicating protection.</span><span>
</span><span id="line-147"></span><span>  </span><span id="getProtected"><span class="annot"><a href="Crypto.JOSE.Header.html#getProtected"><span class="hs-identifier hs-type">getProtected</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679348596"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-comment">-- | Get a 'Just' a value for indicating no protection, or 'Nothing'</span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-comment">-- if the type does not support unprotected headers.</span><span>
</span><span id="line-151"></span><span>  </span><span id="getUnprotected"><span class="annot"><a href="Crypto.JOSE.Header.html#getUnprotected"><span class="hs-identifier hs-type">getUnprotected</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679348596"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#ProtectionIndicator"><span class="hs-identifier hs-type">ProtectionIndicator</span></a></span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#Protection"><span class="hs-identifier hs-type">Protection</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-154"></span><span>  </span><span id="local-6989586621679348813"><span class="annot"><span class="annottext">getProtected :: Protection
</span><a href="Crypto.JOSE.Header.html#getProtected"><span class="hs-identifier hs-var hs-var hs-var hs-var">getProtected</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Protection
</span><a href="Crypto.JOSE.Header.html#Protected"><span class="hs-identifier hs-var">Protected</span></a></span><span>
</span><span id="line-155"></span><span>  </span><span id="local-6989586621679348814"><span class="annot"><span class="annottext">getUnprotected :: Maybe Protection
</span><a href="Crypto.JOSE.Header.html#getUnprotected"><span class="hs-identifier hs-var hs-var hs-var hs-var">getUnprotected</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Protection -&gt; Maybe Protection
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Protection
</span><a href="Crypto.JOSE.Header.html#Unprotected"><span class="hs-identifier hs-var">Unprotected</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#ProtectionIndicator"><span class="hs-identifier hs-type">ProtectionIndicator</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-158"></span><span>  </span><span id="local-6989586621679348821"><span class="annot"><span class="annottext">getProtected :: ()
</span><a href="Crypto.JOSE.Header.html#getProtected"><span class="hs-identifier hs-var hs-var hs-var hs-var">getProtected</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>  </span><span id="local-6989586621679348822"><span class="annot"><span class="annottext">getUnprotected :: Maybe ()
</span><a href="Crypto.JOSE.Header.html#getUnprotected"><span class="hs-identifier hs-var hs-var hs-var hs-var">getUnprotected</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ()
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="hs-comment">-- | A header value, along with a protection indicator.</span><span>
</span><span id="line-163"></span><span class="hs-comment">--</span><span>
</span><span id="line-164"></span><span class="hs-keyword">data</span><span> </span><span id="HeaderParam"><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-var">HeaderParam</span></a></span></span><span> </span><span id="local-6989586621679348615"><span class="annot"><a href="#local-6989586621679348615"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621679348616"><span class="annot"><a href="#local-6989586621679348616"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HeaderParam"><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-var">HeaderParam</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679348615"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348616"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679348827"><span id="local-6989586621679348831"><span class="annot"><span class="annottext">HeaderParam p a -&gt; HeaderParam p a -&gt; Bool
(HeaderParam p a -&gt; HeaderParam p a -&gt; Bool)
-&gt; (HeaderParam p a -&gt; HeaderParam p a -&gt; Bool)
-&gt; Eq (HeaderParam p a)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall p a.
(Eq p, Eq a) =&gt;
HeaderParam p a -&gt; HeaderParam p a -&gt; Bool
$c== :: forall p a.
(Eq p, Eq a) =&gt;
HeaderParam p a -&gt; HeaderParam p a -&gt; Bool
== :: HeaderParam p a -&gt; HeaderParam p a -&gt; Bool
$c/= :: forall p a.
(Eq p, Eq a) =&gt;
HeaderParam p a -&gt; HeaderParam p a -&gt; Bool
/= :: HeaderParam p a -&gt; HeaderParam p a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679348837"><span id="local-6989586621679348843"><span id="local-6989586621679348847"><span class="annot"><span class="annottext">Int -&gt; HeaderParam p a -&gt; ShowS
[HeaderParam p a] -&gt; ShowS
HeaderParam p a -&gt; String
(Int -&gt; HeaderParam p a -&gt; ShowS)
-&gt; (HeaderParam p a -&gt; String)
-&gt; ([HeaderParam p a] -&gt; ShowS)
-&gt; Show (HeaderParam p a)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall p a. (Show p, Show a) =&gt; Int -&gt; HeaderParam p a -&gt; ShowS
forall p a. (Show p, Show a) =&gt; [HeaderParam p a] -&gt; ShowS
forall p a. (Show p, Show a) =&gt; HeaderParam p a -&gt; String
$cshowsPrec :: forall p a. (Show p, Show a) =&gt; Int -&gt; HeaderParam p a -&gt; ShowS
showsPrec :: Int -&gt; HeaderParam p a -&gt; ShowS
$cshow :: forall p a. (Show p, Show a) =&gt; HeaderParam p a -&gt; String
show :: HeaderParam p a -&gt; String
$cshowList :: forall p a. (Show p, Show a) =&gt; [HeaderParam p a] -&gt; ShowS
showList :: [HeaderParam p a] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679348612"><span id="local-6989586621679348851"><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-type">HeaderParam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348612"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-168"></span><span>  </span><span id="local-6989586621679348855"><span class="annot"><span class="annottext">fmap :: forall a b. (a -&gt; b) -&gt; HeaderParam p a -&gt; HeaderParam p b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">fmap</span></span></span><span> </span><span id="local-6989586621679348856"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679348856"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-type">HeaderParam</span></a></span><span> </span><span id="local-6989586621679348857"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679348857"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679348858"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679348858"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p -&gt; b -&gt; HeaderParam p b
forall p a. p -&gt; a -&gt; HeaderParam p a
</span><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-var">HeaderParam</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679348857"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679348856"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679348858"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="annot"><span class="hs-comment">-- | Lens for the 'Protection' of a 'HeaderParam'</span></span><span>
</span><span id="line-171"></span><span id="local-6989586621679348618"><span id="local-6989586621679348619"><span class="annot"><a href="Crypto.JOSE.Header.html#protection"><span class="hs-identifier hs-type">protection</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-type">HeaderParam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348618"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348619"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679348618"><span class="hs-identifier hs-type">p</span></a></span></span></span><span>
</span><span id="line-172"></span><span id="protection"><span class="annot"><span class="annottext">protection :: forall p a (f :: * -&gt; *).
Functor f =&gt;
(p -&gt; f p) -&gt; HeaderParam p a -&gt; f (HeaderParam p a)
</span><a href="Crypto.JOSE.Header.html#protection"><span class="hs-identifier hs-var hs-var">protection</span></a></span></span><span> </span><span id="local-6989586621679348861"><span class="annot"><span class="annottext">p -&gt; f p
</span><a href="#local-6989586621679348861"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-type">HeaderParam</span></a></span><span> </span><span id="local-6989586621679348862"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679348862"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679348863"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679348863"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(p -&gt; HeaderParam p a) -&gt; f p -&gt; f (HeaderParam p a)
forall a b. (a -&gt; b) -&gt; f a -&gt; f b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679348864"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679348864"><span class="hs-identifier hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">p -&gt; a -&gt; HeaderParam p a
forall p a. p -&gt; a -&gt; HeaderParam p a
</span><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-var">HeaderParam</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679348864"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679348863"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">p -&gt; f p
</span><a href="#local-6989586621679348861"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679348862"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span class="hs-pragma">{-# ANN</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#protection"><span class="hs-pragma hs-type">protection</span></a></span><span> </span><span class="annot"><span class="hs-pragma">&quot;HLint: ignore Avoid lambda using `infix`&quot;</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="annot"><span class="hs-comment">-- | Lens for a 'HeaderParam' value</span></span><span>
</span><span id="line-176"></span><span id="local-6989586621679348623"><span id="local-6989586621679348624"><span class="annot"><a href="Crypto.JOSE.Header.html#param"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-type">HeaderParam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348624"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348623"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679348623"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-177"></span><span id="param"><span class="annot"><span class="annottext">param :: forall p a (f :: * -&gt; *).
Functor f =&gt;
(a -&gt; f a) -&gt; HeaderParam p a -&gt; f (HeaderParam p a)
</span><a href="Crypto.JOSE.Header.html#param"><span class="hs-identifier hs-var hs-var">param</span></a></span></span><span> </span><span id="local-6989586621679348867"><span class="annot"><span class="annottext">a -&gt; f a
</span><a href="#local-6989586621679348867"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-type">HeaderParam</span></a></span><span> </span><span id="local-6989586621679348868"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679348868"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679348869"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679348869"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; HeaderParam p a) -&gt; f a -&gt; f (HeaderParam p a)
forall a b. (a -&gt; b) -&gt; f a -&gt; f b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679348870"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679348870"><span class="hs-identifier hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">p -&gt; a -&gt; HeaderParam p a
forall p a. p -&gt; a -&gt; HeaderParam p a
</span><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-var">HeaderParam</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679348868"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679348870"><span class="hs-identifier hs-var">v'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; f a
</span><a href="#local-6989586621679348867"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679348869"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span class="hs-pragma">{-# ANN</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#param"><span class="hs-pragma hs-type">param</span></a></span><span> </span><span class="annot"><span class="hs-pragma">&quot;HLint: ignore Avoid lambda&quot;</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="annot"><span class="hs-comment">-- | Getter for whether a parameter is protected</span></span><span>
</span><span id="line-181"></span><span id="local-6989586621679348628"><span id="local-6989586621679348629"><span class="annot"><a href="Crypto.JOSE.Header.html#isProtected"><span class="hs-identifier hs-type">isProtected</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#ProtectionIndicator"><span class="hs-identifier hs-type">ProtectionIndicator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348628"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Getter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-type">HeaderParam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348628"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348629"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-182"></span><span id="isProtected"><span class="annot"><span class="annottext">isProtected :: forall p a. ProtectionIndicator p =&gt; Getter (HeaderParam p a) Bool
</span><a href="Crypto.JOSE.Header.html#isProtected"><span class="hs-identifier hs-var hs-var">isProtected</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(p -&gt; f p) -&gt; HeaderParam p a -&gt; f (HeaderParam p a)
forall p a (f :: * -&gt; *).
Functor f =&gt;
(p -&gt; f p) -&gt; HeaderParam p a -&gt; f (HeaderParam p a)
</span><a href="Crypto.JOSE.Header.html#protection"><span class="hs-identifier hs-var">protection</span></a></span><span> </span><span class="annot"><span class="annottext">((p -&gt; f p) -&gt; HeaderParam p a -&gt; f (HeaderParam p a))
-&gt; ((Bool -&gt; f Bool) -&gt; p -&gt; f p)
-&gt; (Bool -&gt; f Bool)
-&gt; HeaderParam p a
-&gt; f (HeaderParam p a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(p -&gt; Bool) -&gt; (Bool -&gt; f Bool) -&gt; p -&gt; f p
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s a.
(Profunctor p, Contravariant f) =&gt;
(s -&gt; a) -&gt; Optic' p f s a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">p -&gt; p -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">p
forall a. ProtectionIndicator a =&gt; a
</span><a href="Crypto.JOSE.Header.html#getProtected"><span class="hs-identifier hs-var">getProtected</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="annot"><span class="hs-comment">{- $parsing

The 'parseParamsFor' function defines the parser for a header type.

@
'parseParamsFor'
  :: ('HasParams' a, HasParams b)
  =&gt; Proxy b -&gt; Maybe Object -&gt; Maybe Object -&gt; 'Parser' a
@

It is defined over two objects: the /protected header/ and the
/unprotected header/.  The following functions are provided for
parsing header parameters:

['headerOptional']
  An optional parameter that may be protected or unprotected.
['headerRequired']
  A required parameter that may be protected or unprotected.
['headerOptionalProtected']
  An optional parameter that, if present, MUST be carried in the protected header.
['headerRequiredProtected']
  A required parameter that, if present, MUST be carried in the protected header.

Duplicate headers are forbidden.  The above functions all perform
duplicate header detection.  If you do not use them, be sure to
perform this detection yourself!

An example parser:

@
instance HasParams ACMEHeader where
  'parseParamsFor' proxy hp hu = ACMEHeader
    \&lt;$&gt; 'parseParamsFor' proxy hp hu
    \&lt;*&gt; 'headerRequiredProtected' &quot;nonce&quot; hp hu
@

-}</span></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-comment">-- | Parse an optional parameter that may be carried in either</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- the protected or the unprotected header.</span><span>
</span><span id="line-225"></span><span class="hs-comment">--</span><span>
</span><span id="line-226"></span><span id="local-6989586621679348641"><span id="local-6989586621679348643"><span class="annot"><a href="Crypto.JOSE.Header.html#headerOptional"><span class="hs-identifier hs-type">headerOptional</span></a></span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621679348641"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#ProtectionIndicator"><span class="hs-identifier hs-type">ProtectionIndicator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348643"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Object</span></span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Object</span></span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Parser</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-type">HeaderParam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348643"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348641"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-232"></span><span id="headerOptional"><span class="annot"><span class="annottext">headerOptional :: forall a p.
(FromJSON a, ProtectionIndicator p) =&gt;
Text
-&gt; Maybe Object -&gt; Maybe Object -&gt; Parser (Maybe (HeaderParam p a))
</span><a href="Crypto.JOSE.Header.html#headerOptional"><span class="hs-identifier hs-var hs-var">headerOptional</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Parser a)
-&gt; Text
-&gt; Maybe Object
-&gt; Maybe Object
-&gt; Parser (Maybe (HeaderParam p a))
forall p a.
ProtectionIndicator p =&gt;
(Value -&gt; Parser a)
-&gt; Text
-&gt; Maybe Object
-&gt; Maybe Object
-&gt; Parser (Maybe (HeaderParam p a))
</span><a href="Crypto.JOSE.Header.html#headerOptional%27"><span class="hs-identifier hs-var">headerOptional'</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Parser a
forall a. FromJSON a =&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">parseJSON</span></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="hs-comment">-- | Parse an optional parameter that may be carried in either</span><span>
</span><span id="line-235"></span><span class="hs-comment">-- the protected or the unprotected header.  Like 'headerOptional',</span><span>
</span><span id="line-236"></span><span class="hs-comment">-- but with an explicit argument for the parser.</span><span>
</span><span id="line-237"></span><span class="hs-comment">--</span><span>
</span><span id="line-238"></span><span id="local-6989586621679348646"><span id="local-6989586621679348647"><span class="annot"><a href="Crypto.JOSE.Header.html#headerOptional%27"><span class="hs-identifier hs-type">headerOptional'</span></a></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#ProtectionIndicator"><span class="hs-identifier hs-type">ProtectionIndicator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348646"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Parser</span></span><span> </span><span class="annot"><a href="#local-6989586621679348647"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Object</span></span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Object</span></span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Parser</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-type">HeaderParam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348646"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348647"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-245"></span><span id="headerOptional%27"><span class="annot"><span class="annottext">headerOptional' :: forall p a.
ProtectionIndicator p =&gt;
(Value -&gt; Parser a)
-&gt; Text
-&gt; Maybe Object
-&gt; Maybe Object
-&gt; Parser (Maybe (HeaderParam p a))
</span><a href="Crypto.JOSE.Header.html#headerOptional%27"><span class="hs-identifier hs-var hs-var">headerOptional'</span></a></span></span><span> </span><span id="local-6989586621679348902"><span class="annot"><span class="annottext">Value -&gt; Parser a
</span><a href="#local-6989586621679348902"><span class="hs-identifier hs-var">parser</span></a></span></span><span> </span><span id="local-6989586621679348903"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348903"><span class="hs-identifier hs-var">kText</span></a></span></span><span> </span><span id="local-6989586621679348904"><span class="annot"><span class="annottext">Maybe Object
</span><a href="#local-6989586621679348904"><span class="hs-identifier hs-var">hp</span></a></span></span><span> </span><span id="local-6989586621679348905"><span class="annot"><span class="annottext">Maybe Object
</span><a href="#local-6989586621679348905"><span class="hs-identifier hs-var">hu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Object
</span><a href="#local-6989586621679348904"><span class="hs-identifier hs-var">hp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Object -&gt; (Object -&gt; Maybe Value) -&gt; Maybe Value
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Object -&gt; Maybe Value
forall v. Key -&gt; KeyMap v -&gt; Maybe v
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679348907"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Object
</span><a href="#local-6989586621679348905"><span class="hs-identifier hs-var">hu</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Object -&gt; (Object -&gt; Maybe Value) -&gt; Maybe Value
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Object -&gt; Maybe Value
forall v. Key -&gt; KeyMap v -&gt; Maybe v
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679348907"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser (Maybe (HeaderParam p a))
forall a. String -&gt; Parser a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Parser (Maybe (HeaderParam p a)))
-&gt; String -&gt; Parser (Maybe (HeaderParam p a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;duplicate header &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348903"><span class="hs-identifier hs-var">kText</span></a></span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679348909"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679348909"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HeaderParam p a -&gt; Maybe (HeaderParam p a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(HeaderParam p a -&gt; Maybe (HeaderParam p a))
-&gt; (a -&gt; HeaderParam p a) -&gt; a -&gt; Maybe (HeaderParam p a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">p -&gt; a -&gt; HeaderParam p a
forall p a. p -&gt; a -&gt; HeaderParam p a
</span><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-var">HeaderParam</span></a></span><span> </span><span class="annot"><span class="annottext">p
forall a. ProtectionIndicator a =&gt; a
</span><a href="Crypto.JOSE.Header.html#getProtected"><span class="hs-identifier hs-var">getProtected</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Maybe (HeaderParam p a))
-&gt; Parser a -&gt; Parser (Maybe (HeaderParam p a))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Parser a
</span><a href="#local-6989586621679348902"><span class="hs-identifier hs-var">parser</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679348909"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679348911"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679348911"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Parser (Maybe (HeaderParam p a))
-&gt; (p -&gt; Parser (Maybe (HeaderParam p a)))
-&gt; Maybe p
-&gt; Parser (Maybe (HeaderParam p a))
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Parser (Maybe (HeaderParam p a))
forall a. String -&gt; Parser a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unprotected header not supported&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679348912"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679348912"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HeaderParam p a -&gt; Maybe (HeaderParam p a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(HeaderParam p a -&gt; Maybe (HeaderParam p a))
-&gt; (a -&gt; HeaderParam p a) -&gt; a -&gt; Maybe (HeaderParam p a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">p -&gt; a -&gt; HeaderParam p a
forall p a. p -&gt; a -&gt; HeaderParam p a
</span><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-var">HeaderParam</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679348912"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Maybe (HeaderParam p a))
-&gt; Parser a -&gt; Parser (Maybe (HeaderParam p a))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Parser a
</span><a href="#local-6989586621679348902"><span class="hs-identifier hs-var">parser</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679348911"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>    </span><span class="annot"><span class="annottext">Maybe p
forall a. ProtectionIndicator a =&gt; Maybe a
</span><a href="Crypto.JOSE.Header.html#getUnprotected"><span class="hs-identifier hs-var">getUnprotected</span></a></span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (HeaderParam p a) -&gt; Parser (Maybe (HeaderParam p a))
forall a. a -&gt; Parser a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (HeaderParam p a)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-254"></span><span>    </span><span id="local-6989586621679348907"><span class="annot"><span class="annottext">k :: Key
</span><a href="#local-6989586621679348907"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Key
</span><span class="hs-identifier hs-var">Key.fromText</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348903"><span class="hs-identifier hs-var">kText</span></a></span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="hs-comment">-- | Parse an optional parameter that, if present, MUST be carried</span><span>
</span><span id="line-257"></span><span class="hs-comment">-- in the protected header.</span><span>
</span><span id="line-258"></span><span class="hs-comment">--</span><span>
</span><span id="line-259"></span><span id="local-6989586621679348668"><span class="annot"><a href="Crypto.JOSE.Header.html#headerOptionalProtected"><span class="hs-identifier hs-type">headerOptionalProtected</span></a></span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621679348668"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Object</span></span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Object</span></span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Parser</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679348668"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-265"></span><span id="headerOptionalProtected"><span class="annot"><span class="annottext">headerOptionalProtected :: forall a.
FromJSON a =&gt;
Text -&gt; Maybe Object -&gt; Maybe Object -&gt; Parser (Maybe a)
</span><a href="Crypto.JOSE.Header.html#headerOptionalProtected"><span class="hs-identifier hs-var hs-var">headerOptionalProtected</span></a></span></span><span> </span><span id="local-6989586621679348924"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348924"><span class="hs-identifier hs-var">kText</span></a></span></span><span> </span><span id="local-6989586621679348925"><span class="annot"><span class="annottext">Maybe Object
</span><a href="#local-6989586621679348925"><span class="hs-identifier hs-var">hp</span></a></span></span><span> </span><span id="local-6989586621679348926"><span class="annot"><span class="annottext">Maybe Object
</span><a href="#local-6989586621679348926"><span class="hs-identifier hs-var">hu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Object
</span><a href="#local-6989586621679348925"><span class="hs-identifier hs-var">hp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Object -&gt; (Object -&gt; Maybe Value) -&gt; Maybe Value
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Object -&gt; Maybe Value
forall v. Key -&gt; KeyMap v -&gt; Maybe v
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679348927"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Object
</span><a href="#local-6989586621679348926"><span class="hs-identifier hs-var">hu</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Object -&gt; (Object -&gt; Maybe Value) -&gt; Maybe Value
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Object -&gt; Maybe Value
forall v. Key -&gt; KeyMap v -&gt; Maybe v
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679348927"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser (Maybe a)
forall a. String -&gt; Parser a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Parser (Maybe a)) -&gt; String -&gt; Parser (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;duplicate header &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348924"><span class="hs-identifier hs-var">kText</span></a></span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser (Maybe a)
forall a. String -&gt; Parser a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Parser (Maybe a)) -&gt; String -&gt; Parser (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;header must be protected: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348924"><span class="hs-identifier hs-var">kText</span></a></span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679348928"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679348928"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Maybe a) -&gt; Parser a -&gt; Parser (Maybe a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Parser a
forall a. FromJSON a =&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">parseJSON</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679348928"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-269"></span><span>  </span><span class="annot"><span class="annottext">(Maybe Value, Maybe Value)
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; Parser (Maybe a)
forall a. a -&gt; Parser a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-271"></span><span>    </span><span id="local-6989586621679348927"><span class="annot"><span class="annottext">k :: Key
</span><a href="#local-6989586621679348927"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Key
</span><span class="hs-identifier hs-var">Key.fromText</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348924"><span class="hs-identifier hs-var">kText</span></a></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="hs-comment">-- | Parse a required parameter that may be carried in either</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- the protected or the unprotected header.</span><span>
</span><span id="line-275"></span><span class="hs-comment">--</span><span>
</span><span id="line-276"></span><span id="local-6989586621679348670"><span id="local-6989586621679348671"><span class="annot"><a href="Crypto.JOSE.Header.html#headerRequired"><span class="hs-identifier hs-type">headerRequired</span></a></span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621679348670"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Header.html#ProtectionIndicator"><span class="hs-identifier hs-type">ProtectionIndicator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348671"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Object</span></span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Object</span></span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Parser</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-type">HeaderParam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348671"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679348670"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-282"></span><span id="headerRequired"><span class="annot"><span class="annottext">headerRequired :: forall a p.
(FromJSON a, ProtectionIndicator p) =&gt;
Text -&gt; Maybe Object -&gt; Maybe Object -&gt; Parser (HeaderParam p a)
</span><a href="Crypto.JOSE.Header.html#headerRequired"><span class="hs-identifier hs-var hs-var">headerRequired</span></a></span></span><span> </span><span id="local-6989586621679348945"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348945"><span class="hs-identifier hs-var">kText</span></a></span></span><span> </span><span id="local-6989586621679348946"><span class="annot"><span class="annottext">Maybe Object
</span><a href="#local-6989586621679348946"><span class="hs-identifier hs-var">hp</span></a></span></span><span> </span><span id="local-6989586621679348947"><span class="annot"><span class="annottext">Maybe Object
</span><a href="#local-6989586621679348947"><span class="hs-identifier hs-var">hu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Object
</span><a href="#local-6989586621679348946"><span class="hs-identifier hs-var">hp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Object -&gt; (Object -&gt; Maybe Value) -&gt; Maybe Value
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Object -&gt; Maybe Value
forall v. Key -&gt; KeyMap v -&gt; Maybe v
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679348948"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Object
</span><a href="#local-6989586621679348947"><span class="hs-identifier hs-var">hu</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Object -&gt; (Object -&gt; Maybe Value) -&gt; Maybe Value
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Object -&gt; Maybe Value
forall v. Key -&gt; KeyMap v -&gt; Maybe v
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679348948"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-283"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser (HeaderParam p a)
forall a. String -&gt; Parser a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Parser (HeaderParam p a))
-&gt; String -&gt; Parser (HeaderParam p a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;duplicate header &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348945"><span class="hs-identifier hs-var">kText</span></a></span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679348949"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679348949"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">p -&gt; a -&gt; HeaderParam p a
forall p a. p -&gt; a -&gt; HeaderParam p a
</span><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-var">HeaderParam</span></a></span><span> </span><span class="annot"><span class="annottext">p
forall a. ProtectionIndicator a =&gt; a
</span><a href="Crypto.JOSE.Header.html#getProtected"><span class="hs-identifier hs-var">getProtected</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; HeaderParam p a) -&gt; Parser a -&gt; Parser (HeaderParam p a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Parser a
forall a. FromJSON a =&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">parseJSON</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679348949"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679348950"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679348950"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Parser (HeaderParam p a)
-&gt; (p -&gt; Parser (HeaderParam p a))
-&gt; Maybe p
-&gt; Parser (HeaderParam p a)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Parser (HeaderParam p a)
forall a. String -&gt; Parser a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unprotected header not supported&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679348951"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679348951"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">p -&gt; a -&gt; HeaderParam p a
forall p a. p -&gt; a -&gt; HeaderParam p a
</span><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-var">HeaderParam</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679348951"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; HeaderParam p a) -&gt; Parser a -&gt; Parser (HeaderParam p a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Parser a
forall a. FromJSON a =&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">parseJSON</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679348950"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>    </span><span class="annot"><span class="annottext">Maybe p
forall a. ProtectionIndicator a =&gt; Maybe a
</span><a href="Crypto.JOSE.Header.html#getUnprotected"><span class="hs-identifier hs-var">getUnprotected</span></a></span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser (HeaderParam p a)
forall a. String -&gt; Parser a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Parser (HeaderParam p a))
-&gt; String -&gt; Parser (HeaderParam p a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;missing required header &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679348948"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-291"></span><span>    </span><span id="local-6989586621679348948"><span class="annot"><span class="annottext">k :: Key
</span><a href="#local-6989586621679348948"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Key
</span><span class="hs-identifier hs-var">Key.fromText</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348945"><span class="hs-identifier hs-var">kText</span></a></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="hs-comment">-- | Parse a required parameter that MUST be carried</span><span>
</span><span id="line-294"></span><span class="hs-comment">-- in the protected header.</span><span>
</span><span id="line-295"></span><span class="hs-comment">--</span><span>
</span><span id="line-296"></span><span id="local-6989586621679348674"><span class="annot"><a href="Crypto.JOSE.Header.html#headerRequiredProtected"><span class="hs-identifier hs-type">headerRequiredProtected</span></a></span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621679348674"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Object</span></span><span>
</span><span id="line-300"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Object</span></span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Parser</span></span><span> </span><span class="annot"><a href="#local-6989586621679348674"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-302"></span><span id="headerRequiredProtected"><span class="annot"><span class="annottext">headerRequiredProtected :: forall a.
FromJSON a =&gt;
Text -&gt; Maybe Object -&gt; Maybe Object -&gt; Parser a
</span><a href="Crypto.JOSE.Header.html#headerRequiredProtected"><span class="hs-identifier hs-var hs-var">headerRequiredProtected</span></a></span></span><span> </span><span id="local-6989586621679348965"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348965"><span class="hs-identifier hs-var">kText</span></a></span></span><span> </span><span id="local-6989586621679348966"><span class="annot"><span class="annottext">Maybe Object
</span><a href="#local-6989586621679348966"><span class="hs-identifier hs-var">hp</span></a></span></span><span> </span><span id="local-6989586621679348967"><span class="annot"><span class="annottext">Maybe Object
</span><a href="#local-6989586621679348967"><span class="hs-identifier hs-var">hu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Object
</span><a href="#local-6989586621679348966"><span class="hs-identifier hs-var">hp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Object -&gt; (Object -&gt; Maybe Value) -&gt; Maybe Value
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Object -&gt; Maybe Value
forall v. Key -&gt; KeyMap v -&gt; Maybe v
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679348968"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Object
</span><a href="#local-6989586621679348967"><span class="hs-identifier hs-var">hu</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Object -&gt; (Object -&gt; Maybe Value) -&gt; Maybe Value
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Object -&gt; Maybe Value
forall v. Key -&gt; KeyMap v -&gt; Maybe v
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679348968"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser a
forall a. String -&gt; Parser a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Parser a) -&gt; String -&gt; Parser a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;duplicate header &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348965"><span class="hs-identifier hs-var">kText</span></a></span><span>
</span><span id="line-304"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser a
forall a. String -&gt; Parser a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Parser a) -&gt; String -&gt; Parser a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;header must be protected: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348965"><span class="hs-identifier hs-var">kText</span></a></span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679348969"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679348969"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Parser a
forall a. FromJSON a =&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">parseJSON</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679348969"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-306"></span><span>  </span><span class="annot"><span class="annottext">(Maybe Value, Maybe Value)
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser a
forall a. String -&gt; Parser a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Parser a) -&gt; String -&gt; Parser a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;missing required protected header: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348965"><span class="hs-identifier hs-var">kText</span></a></span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-308"></span><span>    </span><span id="local-6989586621679348968"><span class="annot"><span class="annottext">k :: Key
</span><a href="#local-6989586621679348968"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Key
</span><span class="hs-identifier hs-var">Key.fromText</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348965"><span class="hs-identifier hs-var">kText</span></a></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span id="local-6989586621679348678"><span id="local-6989586621679348679"><span id="local-6989586621679348680"><span class="annot"><a href="Crypto.JOSE.Header.html#critObjectParser"><span class="hs-identifier hs-type">critObjectParser</span></a></span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679348678"><span class="hs-identifier hs-type">t0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679348679"><span class="hs-identifier hs-type">t1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fail.MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679348680"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679348678"><span class="hs-identifier hs-type">t0</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679348679"><span class="hs-identifier hs-type">t1</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Object</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679348680"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span></span></span></span><span>
</span><span id="line-314"></span><span id="critObjectParser"><span class="annot"><span class="annottext">critObjectParser :: forall (t0 :: * -&gt; *) (t1 :: * -&gt; *) (m :: * -&gt; *).
(Foldable t0, Foldable t1, MonadFail m) =&gt;
t0 Text -&gt; t1 Text -&gt; Object -&gt; Text -&gt; m Text
</span><a href="Crypto.JOSE.Header.html#critObjectParser"><span class="hs-identifier hs-var hs-var">critObjectParser</span></a></span></span><span> </span><span id="local-6989586621679348987"><span class="annot"><span class="annottext">t0 Text
</span><a href="#local-6989586621679348987"><span class="hs-identifier hs-var">reserved</span></a></span></span><span> </span><span id="local-6989586621679348988"><span class="annot"><span class="annottext">t1 Text
</span><a href="#local-6989586621679348988"><span class="hs-identifier hs-var">exts</span></a></span></span><span> </span><span id="local-6989586621679348989"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679348989"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621679348990"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348990"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348990"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; t0 Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; t0 a -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">t0 Text
</span><a href="#local-6989586621679348987"><span class="hs-identifier hs-var">reserved</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m Text
forall a. String -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">Fail.fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;crit key is reserved&quot;</span></span><span>
</span><span id="line-316"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348990"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; t1 Text -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`notElem`</span></span><span> </span><span class="annot"><span class="annottext">t1 Text
</span><a href="#local-6989586621679348988"><span class="hs-identifier hs-var">exts</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m Text
forall a. String -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">Fail.fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;crit key is not understood&quot;</span></span><span>
</span><span id="line-317"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Key
</span><span class="hs-identifier hs-var">Key.fromText</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348990"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Object -&gt; Bool
forall a. Key -&gt; KeyMap a -&gt; Bool
</span><span class="hs-operator hs-var">`M.member`</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679348989"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m Text
forall a. String -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">Fail.fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;crit key is not present in headers&quot;</span></span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; m Text
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679348990"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span class="hs-comment">-- | Parse a &quot;crit&quot; header param</span><span>
</span><span id="line-321"></span><span class="hs-comment">--</span><span>
</span><span id="line-322"></span><span class="hs-comment">-- Fails if:</span><span>
</span><span id="line-323"></span><span class="hs-comment">--</span><span>
</span><span id="line-324"></span><span class="hs-comment">-- * any reserved header appears in &quot;crit&quot; header</span><span>
</span><span id="line-325"></span><span class="hs-comment">-- * any value in &quot;crit&quot; is not a recognised extension</span><span>
</span><span id="line-326"></span><span class="hs-comment">-- * any value in &quot;crit&quot; does not have a corresponding key in the object</span><span>
</span><span id="line-327"></span><span class="hs-comment">--</span><span>
</span><span id="line-328"></span><span id="local-6989586621679348689"><span id="local-6989586621679348690"><span id="local-6989586621679348691"><span id="local-6989586621679348692"><span id="local-6989586621679348693"><span class="annot"><a href="Crypto.JOSE.Header.html#parseCrit"><span class="hs-identifier hs-type">parseCrit</span></a></span><span>
</span><span id="line-329"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679348689"><span class="hs-identifier hs-type">t0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679348690"><span class="hs-identifier hs-type">t1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Traversable</span></span><span> </span><span class="annot"><a href="#local-6989586621679348691"><span class="hs-identifier hs-type">t2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Traversable</span></span><span> </span><span class="annot"><a href="#local-6989586621679348692"><span class="hs-identifier hs-type">t3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fail.MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679348693"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679348689"><span class="hs-identifier hs-type">t0</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ reserved header parameters</span></span><span>
</span><span id="line-331"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679348690"><span class="hs-identifier hs-type">t1</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ recognised extensions</span></span><span>
</span><span id="line-332"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Object</span></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ full header (union of protected and unprotected headers)</span></span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679348691"><span class="hs-identifier hs-type">t2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679348692"><span class="hs-identifier hs-type">t3</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ crit header</span></span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679348693"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679348691"><span class="hs-identifier hs-type">t2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679348692"><span class="hs-identifier hs-type">t3</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-335"></span><span id="parseCrit"><span class="annot"><span class="annottext">parseCrit :: forall (t0 :: * -&gt; *) (t1 :: * -&gt; *) (t2 :: * -&gt; *) (t3 :: * -&gt; *)
       (m :: * -&gt; *).
(Foldable t0, Foldable t1, Traversable t2, Traversable t3,
 MonadFail m) =&gt;
t0 Text -&gt; t1 Text -&gt; Object -&gt; t2 (t3 Text) -&gt; m (t2 (t3 Text))
</span><a href="Crypto.JOSE.Header.html#parseCrit"><span class="hs-identifier hs-var hs-var">parseCrit</span></a></span></span><span> </span><span id="local-6989586621679349007"><span class="annot"><span class="annottext">t0 Text
</span><a href="#local-6989586621679349007"><span class="hs-identifier hs-var">reserved</span></a></span></span><span> </span><span id="local-6989586621679349008"><span class="annot"><span class="annottext">t1 Text
</span><a href="#local-6989586621679349008"><span class="hs-identifier hs-var">exts</span></a></span></span><span> </span><span id="local-6989586621679349009"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679349009"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(t3 Text -&gt; m (t3 Text)) -&gt; t2 (t3 Text) -&gt; m (t2 (t3 Text))
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; t2 a -&gt; m (t2 b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text -&gt; m Text) -&gt; t3 Text -&gt; m (t3 Text)
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; t3 a -&gt; m (t3 b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t0 Text -&gt; t1 Text -&gt; Object -&gt; Text -&gt; m Text
forall (t0 :: * -&gt; *) (t1 :: * -&gt; *) (m :: * -&gt; *).
(Foldable t0, Foldable t1, MonadFail m) =&gt;
t0 Text -&gt; t1 Text -&gt; Object -&gt; Text -&gt; m Text
</span><a href="Crypto.JOSE.Header.html#critObjectParser"><span class="hs-identifier hs-var">critObjectParser</span></a></span><span> </span><span class="annot"><span class="annottext">t0 Text
</span><a href="#local-6989586621679349007"><span class="hs-identifier hs-var">reserved</span></a></span><span> </span><span class="annot"><span class="annottext">t1 Text
</span><a href="#local-6989586621679349008"><span class="hs-identifier hs-var">exts</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679349009"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>  </span><span class="hs-comment">-- TODO fail on duplicate strings</span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span class="hs-keyword">class</span><span> </span><span id="HasAlg"><span class="annot"><a href="Crypto.JOSE.Header.html#HasAlg"><span class="hs-identifier hs-var">HasAlg</span></a></span></span><span> </span><span id="local-6989586621679349011"><span class="annot"><a href="#local-6989586621679349011"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-340"></span><span>  </span><span id="alg"><span class="annot"><a href="Crypto.JOSE.Header.html#alg"><span class="hs-identifier hs-type">alg</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679349013"><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679349011"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349013"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-type">HeaderParam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349013"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="Crypto.JOSE.JWA.JWS.html#Alg"><span class="hs-identifier hs-type">JWA.JWS.Alg</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span class="hs-keyword">class</span><span> </span><span id="HasJku"><span class="annot"><a href="Crypto.JOSE.Header.html#HasJku"><span class="hs-identifier hs-var">HasJku</span></a></span></span><span> </span><span id="local-6989586621679349015"><span class="annot"><a href="#local-6989586621679349015"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-343"></span><span>  </span><span id="jku"><span class="annot"><a href="Crypto.JOSE.Header.html#jku"><span class="hs-identifier hs-type">jku</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679349017"><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679349015"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349017"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-type">HeaderParam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349017"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Types.URI</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span class="hs-keyword">class</span><span> </span><span id="HasJwk"><span class="annot"><a href="Crypto.JOSE.Header.html#HasJwk"><span class="hs-identifier hs-var">HasJwk</span></a></span></span><span> </span><span id="local-6989586621679349019"><span class="annot"><a href="#local-6989586621679349019"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-346"></span><span>  </span><span id="jwk"><span class="annot"><a href="Crypto.JOSE.Header.html#jwk"><span class="hs-identifier hs-type">jwk</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679349021"><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679349019"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349021"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-type">HeaderParam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349021"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="Crypto.JOSE.JWK.html#JWK"><span class="hs-identifier hs-type">JWK</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="hs-keyword">class</span><span> </span><span id="HasKid"><span class="annot"><a href="Crypto.JOSE.Header.html#HasKid"><span class="hs-identifier hs-var">HasKid</span></a></span></span><span> </span><span id="local-6989586621679349022"><span class="annot"><a href="#local-6989586621679349022"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-349"></span><span>  </span><span id="kid"><span class="annot"><a href="Crypto.JOSE.Header.html#kid"><span class="hs-identifier hs-type">kid</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679349024"><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679349022"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349024"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-type">HeaderParam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349024"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="hs-keyword">class</span><span> </span><span id="HasX5u"><span class="annot"><a href="Crypto.JOSE.Header.html#HasX5u"><span class="hs-identifier hs-var">HasX5u</span></a></span></span><span> </span><span id="local-6989586621679349025"><span class="annot"><a href="#local-6989586621679349025"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-352"></span><span>  </span><span id="x5u"><span class="annot"><a href="Crypto.JOSE.Header.html#x5u"><span class="hs-identifier hs-type">x5u</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679349027"><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679349025"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349027"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-type">HeaderParam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349027"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Types.URI</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span class="hs-keyword">class</span><span> </span><span id="HasX5c"><span class="annot"><a href="Crypto.JOSE.Header.html#HasX5c"><span class="hs-identifier hs-var">HasX5c</span></a></span></span><span> </span><span id="local-6989586621679349028"><span class="annot"><a href="#local-6989586621679349028"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-355"></span><span>  </span><span id="x5c"><span class="annot"><a href="Crypto.JOSE.Header.html#x5c"><span class="hs-identifier hs-type">x5c</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679349030"><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679349028"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349030"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-type">HeaderParam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349030"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Types.SignedCertificate</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span class="hs-keyword">class</span><span> </span><span id="HasX5t"><span class="annot"><a href="Crypto.JOSE.Header.html#HasX5t"><span class="hs-identifier hs-var">HasX5t</span></a></span></span><span> </span><span id="local-6989586621679349032"><span class="annot"><a href="#local-6989586621679349032"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-358"></span><span>  </span><span id="x5t"><span class="annot"><a href="Crypto.JOSE.Header.html#x5t"><span class="hs-identifier hs-type">x5t</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679349034"><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679349032"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349034"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-type">HeaderParam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349034"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="Crypto.JOSE.Types.html#Base64SHA1"><span class="hs-identifier hs-type">Types.Base64SHA1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span class="hs-keyword">class</span><span> </span><span id="HasX5tS256"><span class="annot"><a href="Crypto.JOSE.Header.html#HasX5tS256"><span class="hs-identifier hs-var">HasX5tS256</span></a></span></span><span> </span><span id="local-6989586621679349036"><span class="annot"><a href="#local-6989586621679349036"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-361"></span><span>  </span><span id="x5tS256"><span class="annot"><a href="Crypto.JOSE.Header.html#x5tS256"><span class="hs-identifier hs-type">x5tS256</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679349038"><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679349036"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349038"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-type">HeaderParam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349038"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="Crypto.JOSE.Types.html#Base64SHA256"><span class="hs-identifier hs-type">Types.Base64SHA256</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span class="hs-keyword">class</span><span> </span><span id="HasTyp"><span class="annot"><a href="Crypto.JOSE.Header.html#HasTyp"><span class="hs-identifier hs-var">HasTyp</span></a></span></span><span> </span><span id="local-6989586621679349040"><span class="annot"><a href="#local-6989586621679349040"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-364"></span><span>  </span><span id="typ"><span class="annot"><a href="Crypto.JOSE.Header.html#typ"><span class="hs-identifier hs-type">typ</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679349042"><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679349040"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349042"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-type">HeaderParam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349042"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span class="hs-keyword">class</span><span> </span><span id="HasCty"><span class="annot"><a href="Crypto.JOSE.Header.html#HasCty"><span class="hs-identifier hs-var">HasCty</span></a></span></span><span> </span><span id="local-6989586621679349043"><span class="annot"><a href="#local-6989586621679349043"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-367"></span><span>  </span><span id="cty"><span class="annot"><a href="Crypto.JOSE.Header.html#cty"><span class="hs-identifier hs-type">cty</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679349045"><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679349043"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349045"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.Header.html#HeaderParam"><span class="hs-identifier hs-type">HeaderParam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349045"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span class="hs-keyword">class</span><span> </span><span id="HasCrit"><span class="annot"><a href="Crypto.JOSE.Header.html#HasCrit"><span class="hs-identifier hs-var">HasCrit</span></a></span></span><span> </span><span id="local-6989586621679349046"><span class="annot"><a href="#local-6989586621679349046"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-370"></span><span>  </span><span id="crit"><span class="annot"><a href="Crypto.JOSE.Header.html#crit"><span class="hs-identifier hs-type">crit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679349048"><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679349046"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679349048"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-371"></span></pre></body></html>