<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Control.Concurrent.Extra</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">extra-1.7.16: Extra functions I use.</span><ul class="links" id="page-menu"><li><a href="src/Control.Concurrent.Extra.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Control.Concurrent.Extra</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Lock</a></li><li><a href="#g:2">Var</a></li><li><a href="#g:3">Barrier</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Extra functions for <a href="../base-4.18.2.1/Control-Concurrent.html">Control.Concurrent</a>.</p><p>This module includes three new types of <code><a href="../base-4.18.2.1/Control-Concurrent-MVar.html#t:MVar" title="Control.Concurrent.MVar">MVar</a></code>, namely <code><a href="Control-Concurrent-Extra.html#t:Lock" title="Control.Concurrent.Extra">Lock</a></code> (no associated value),
   <code><a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a></code> (never empty) and <code><a href="Control-Concurrent-Extra.html#t:Barrier" title="Control.Concurrent.Extra">Barrier</a></code> (filled at most once). See
   <a href="https://neilmitchell.blogspot.co.uk/2012/06/flavours-of-mvar_04.html">this blog post</a>
   for examples and justification.</p><p>If you need greater control of exceptions and threads
   see the <a href="https://hackage.haskell.org/package/slave-thread">slave-thread</a> package.
   If you need elaborate relationships between threads
   see the <a href="https://hackage.haskell.org/package/async">async</a> package.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short">module <a href="../base-4.18.2.1/Control-Concurrent.html">Control.Concurrent</a></li><li class="src short"><a href="#v:withNumCapabilities">withNumCapabilities</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a</li><li class="src short"><a href="#v:once">once</a> :: <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a)</li><li class="src short"><a href="#v:onceFork">onceFork</a> :: <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a)</li><li class="src short"><span class="keyword">data</span> <a href="#t:Lock">Lock</a></li><li class="src short"><a href="#v:newLock">newLock</a> :: <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Control-Concurrent-Extra.html#t:Lock" title="Control.Concurrent.Extra">Lock</a></li><li class="src short"><a href="#v:withLock">withLock</a> :: <a href="Control-Concurrent-Extra.html#t:Lock" title="Control.Concurrent.Extra">Lock</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a</li><li class="src short"><a href="#v:withLockTry">withLockTry</a> :: <a href="Control-Concurrent-Extra.html#t:Lock" title="Control.Concurrent.Extra">Lock</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../base-4.18.2.1/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> a)</li><li class="src short"><span class="keyword">data</span> <a href="#t:Var">Var</a> a</li><li class="src short"><a href="#v:newVar">newVar</a> :: a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a> a)</li><li class="src short"><a href="#v:readVar">readVar</a> :: <a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a</li><li class="src short"><a href="#v:writeVar">writeVar</a> :: <a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a> a -&gt; a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:writeVar-39-">writeVar'</a> :: <a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a> a -&gt; a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:modifyVar">modifyVar</a> :: <a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a> a -&gt; (a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (a, b)) -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> b</li><li class="src short"><a href="#v:modifyVar-39-">modifyVar'</a> :: <a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a> a -&gt; (a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (a, b)) -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> b</li><li class="src short"><a href="#v:modifyVar_">modifyVar_</a> :: <a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a> a -&gt; (a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a) -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:modifyVar_-39-">modifyVar_'</a> :: <a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a> a -&gt; (a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a) -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:withVar">withVar</a> :: <a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a> a -&gt; (a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> b) -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> b</li><li class="src short"><span class="keyword">data</span> <a href="#t:Barrier">Barrier</a> a</li><li class="src short"><a href="#v:newBarrier">newBarrier</a> :: <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Control-Concurrent-Extra.html#t:Barrier" title="Control.Concurrent.Extra">Barrier</a> a)</li><li class="src short"><a href="#v:signalBarrier">signalBarrier</a> :: <a href="Control-Exception-Extra.html#t:Partial" title="Control.Exception.Extra">Partial</a> =&gt; <a href="Control-Concurrent-Extra.html#t:Barrier" title="Control.Concurrent.Extra">Barrier</a> a -&gt; a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:waitBarrier">waitBarrier</a> :: <a href="Control-Concurrent-Extra.html#t:Barrier" title="Control.Concurrent.Extra">Barrier</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a</li><li class="src short"><a href="#v:waitBarrierMaybe">waitBarrierMaybe</a> :: <a href="Control-Concurrent-Extra.html#t:Barrier" title="Control.Concurrent.Extra">Barrier</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../base-4.18.2.1/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> a)</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src">module <a href="../base-4.18.2.1/Control-Concurrent.html">Control.Concurrent</a></p></div><div class="top"><p class="src"><a id="v:withNumCapabilities" class="def">withNumCapabilities</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a <a href="src/Control.Concurrent.Extra.html#withNumCapabilities" class="link">Source</a> <a href="#v:withNumCapabilities" class="selflink">#</a></p><div class="doc"><p>On GHC 7.6 and above with the <code>-threaded</code> flag, brackets a call to <code><a href="../base-4.18.2.1/Control-Concurrent.html#v:setNumCapabilities" title="Control.Concurrent">setNumCapabilities</a></code>.
   On lower versions (which lack <code><a href="../base-4.18.2.1/Control-Concurrent.html#v:setNumCapabilities" title="Control.Concurrent">setNumCapabilities</a></code>) this function just runs the argument action.</p></div></div><div class="top"><p class="src"><a id="v:once" class="def">once</a> :: <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a) <a href="src/Control.Concurrent.Extra.html#once" class="link">Source</a> <a href="#v:once" class="selflink">#</a></p><div class="doc"><p>Given an action, produce a wrapped action that runs at most once.
   If the function raises an exception, the same exception will be reraised each time.</p><pre>let x ||| y = do t1 &lt;- onceFork x; t2 &lt;- onceFork y; t1; t2
\(x :: IO Int) -&gt; void (once x) == pure ()
\(x :: IO Int) -&gt; join (once x) == x
\(x :: IO Int) -&gt; (do y &lt;- once x; y; y) == x
\(x :: IO Int) -&gt; (do y &lt;- once x; y ||| y) == x</pre></div></div><div class="top"><p class="src"><a id="v:onceFork" class="def">onceFork</a> :: <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a) <a href="src/Control.Concurrent.Extra.html#onceFork" class="link">Source</a> <a href="#v:onceFork" class="selflink">#</a></p><div class="doc"><p>Like <code><a href="Control-Concurrent-Extra.html#v:once" title="Control.Concurrent.Extra">once</a></code>, but immediately starts running the computation on a background thread.</p><pre>\(x :: IO Int) -&gt; join (onceFork x) == x
\(x :: IO Int) -&gt; (do a &lt;- onceFork x; a; a) == x</pre></div></div><a href="#g:1" id="g:1"><h1>Lock</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Lock" class="def">Lock</a> <a href="src/Control.Concurrent.Extra.html#Lock" class="link">Source</a> <a href="#t:Lock" class="selflink">#</a></p><div class="doc"><p>Like an <code><a href="../base-4.18.2.1/Control-Concurrent-MVar.html#t:MVar" title="Control.Concurrent.MVar">MVar</a></code>, but has no value.
   Used to guarantee single-threaded access, typically to some system resource.
   As an example:</p><pre>lock &lt;- <code><a href="Control-Concurrent-Extra.html#v:newLock" title="Control.Concurrent.Extra">newLock</a></code>
let output = <code><a href="Control-Concurrent-Extra.html#v:withLock" title="Control.Concurrent.Extra">withLock</a></code> lock . putStrLn
forkIO $ do ...; output &quot;hello&quot;
forkIO $ do ...; output &quot;world&quot;
</pre><p>Here we are creating a lock to ensure that when writing output our messages
   do not get interleaved. This use of <code><a href="../base-4.18.2.1/Control-Concurrent-MVar.html#t:MVar" title="Control.Concurrent.MVar">MVar</a></code> never blocks on a put. It is permissible,
   but rare, that a withLock contains a withLock inside it - but if so,
   watch out for deadlocks.</p></div></div><div class="top"><p class="src"><a id="v:newLock" class="def">newLock</a> :: <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Control-Concurrent-Extra.html#t:Lock" title="Control.Concurrent.Extra">Lock</a> <a href="src/Control.Concurrent.Extra.html#newLock" class="link">Source</a> <a href="#v:newLock" class="selflink">#</a></p><div class="doc"><p>Create a new <code><a href="Control-Concurrent-Extra.html#t:Lock" title="Control.Concurrent.Extra">Lock</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:withLock" class="def">withLock</a> :: <a href="Control-Concurrent-Extra.html#t:Lock" title="Control.Concurrent.Extra">Lock</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a <a href="src/Control.Concurrent.Extra.html#withLock" class="link">Source</a> <a href="#v:withLock" class="selflink">#</a></p><div class="doc"><p>Perform some operation while holding <code><a href="Control-Concurrent-Extra.html#t:Lock" title="Control.Concurrent.Extra">Lock</a></code>. Will prevent all other
   operations from using the <code><a href="Control-Concurrent-Extra.html#t:Lock" title="Control.Concurrent.Extra">Lock</a></code> while the action is ongoing.</p></div></div><div class="top"><p class="src"><a id="v:withLockTry" class="def">withLockTry</a> :: <a href="Control-Concurrent-Extra.html#t:Lock" title="Control.Concurrent.Extra">Lock</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../base-4.18.2.1/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> a) <a href="src/Control.Concurrent.Extra.html#withLockTry" class="link">Source</a> <a href="#v:withLockTry" class="selflink">#</a></p><div class="doc"><p>Like <code><a href="Control-Concurrent-Extra.html#v:withLock" title="Control.Concurrent.Extra">withLock</a></code> but will never block. If the operation cannot be executed
   immediately it will return <code><a href="../base-4.18.2.1/Data-Maybe.html#v:Nothing" title="Data.Maybe">Nothing</a></code>.</p></div></div><a href="#g:2" id="g:2"><h1>Var</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Var" class="def">Var</a> a <a href="src/Control.Concurrent.Extra.html#Var" class="link">Source</a> <a href="#t:Var" class="selflink">#</a></p><div class="doc"><p>Like an <code><a href="../base-4.18.2.1/Control-Concurrent-MVar.html#t:MVar" title="Control.Concurrent.MVar">MVar</a></code>, but must always be full.
   Used to operate on a mutable variable in a thread-safe way.
   As an example:</p><pre>hits &lt;- <code><a href="Control-Concurrent-Extra.html#v:newVar" title="Control.Concurrent.Extra">newVar</a></code> 0
forkIO $ do ...; <code><a href="Control-Concurrent-Extra.html#v:modifyVar_" title="Control.Concurrent.Extra">modifyVar_</a></code> hits (+1); ...
i &lt;- <code><a href="Control-Concurrent-Extra.html#v:readVar" title="Control.Concurrent.Extra">readVar</a></code> hits
print (&quot;HITS&quot;,i)
</pre><p>Here we have a variable which we modify atomically, so modifications are
   not interleaved. This use of <code><a href="../base-4.18.2.1/Control-Concurrent-MVar.html#t:MVar" title="Control.Concurrent.MVar">MVar</a></code> never blocks on a put. No modifyVar
   operation should ever block, and they should always complete in a reasonable
   timeframe. A <code><a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a></code> should not be used to protect some external resource, only
   the variable contained within. Information from a <code><a href="Control-Concurrent-Extra.html#v:readVar" title="Control.Concurrent.Extra">readVar</a></code> should not be subsequently
   inserted back into the <code><a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:newVar" class="def">newVar</a> :: a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a> a) <a href="src/Control.Concurrent.Extra.html#newVar" class="link">Source</a> <a href="#v:newVar" class="selflink">#</a></p><div class="doc"><p>Create a new <code><a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a></code> with a value.</p></div></div><div class="top"><p class="src"><a id="v:readVar" class="def">readVar</a> :: <a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a <a href="src/Control.Concurrent.Extra.html#readVar" class="link">Source</a> <a href="#v:readVar" class="selflink">#</a></p><div class="doc"><p>Read the current value of the <code><a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:writeVar" class="def">writeVar</a> :: <a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a> a -&gt; a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Control.Concurrent.Extra.html#writeVar" class="link">Source</a> <a href="#v:writeVar" class="selflink">#</a></p><div class="doc"><p>Write a value to become the new value of <code><a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:writeVar-39-" class="def">writeVar'</a> :: <a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a> a -&gt; a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Control.Concurrent.Extra.html#writeVar%27" class="link">Source</a> <a href="#v:writeVar-39-" class="selflink">#</a></p><div class="doc"><p>Strict variant of <code><a href="Control-Concurrent-Extra.html#v:writeVar" title="Control.Concurrent.Extra">writeVar</a></code></p></div></div><div class="top"><p class="src"><a id="v:modifyVar" class="def">modifyVar</a> :: <a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a> a -&gt; (a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (a, b)) -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> b <a href="src/Control.Concurrent.Extra.html#modifyVar" class="link">Source</a> <a href="#v:modifyVar" class="selflink">#</a></p><div class="doc"><p>Modify a <code><a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a></code> producing a new value and a return result.</p></div></div><div class="top"><p class="src"><a id="v:modifyVar-39-" class="def">modifyVar'</a> :: <a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a> a -&gt; (a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (a, b)) -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> b <a href="src/Control.Concurrent.Extra.html#modifyVar%27" class="link">Source</a> <a href="#v:modifyVar-39-" class="selflink">#</a></p><div class="doc"><p>Strict variant of <code><a href="Control-Concurrent-Extra.html#v:modifyVar-39-" title="Control.Concurrent.Extra">modifyVar'</a></code></p></div></div><div class="top"><p class="src"><a id="v:modifyVar_" class="def">modifyVar_</a> :: <a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a> a -&gt; (a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a) -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Control.Concurrent.Extra.html#modifyVar_" class="link">Source</a> <a href="#v:modifyVar_" class="selflink">#</a></p><div class="doc"><p>Modify a <code><a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a></code>, a restricted version of <code><a href="Control-Concurrent-Extra.html#v:modifyVar" title="Control.Concurrent.Extra">modifyVar</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:modifyVar_-39-" class="def">modifyVar_'</a> :: <a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a> a -&gt; (a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a) -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Control.Concurrent.Extra.html#modifyVar_%27" class="link">Source</a> <a href="#v:modifyVar_-39-" class="selflink">#</a></p><div class="doc"><p>Strict variant of <code><a href="Control-Concurrent-Extra.html#v:modifyVar_" title="Control.Concurrent.Extra">modifyVar_</a></code></p></div></div><div class="top"><p class="src"><a id="v:withVar" class="def">withVar</a> :: <a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a> a -&gt; (a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> b) -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> b <a href="src/Control.Concurrent.Extra.html#withVar" class="link">Source</a> <a href="#v:withVar" class="selflink">#</a></p><div class="doc"><p>Perform some operation using the value in the <code><a href="Control-Concurrent-Extra.html#t:Var" title="Control.Concurrent.Extra">Var</a></code>,
   a restricted version of <code><a href="Control-Concurrent-Extra.html#v:modifyVar" title="Control.Concurrent.Extra">modifyVar</a></code>.</p></div></div><a href="#g:3" id="g:3"><h1>Barrier</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Barrier" class="def">Barrier</a> a <a href="src/Control.Concurrent.Extra.html#Barrier" class="link">Source</a> <a href="#t:Barrier" class="selflink">#</a></p><div class="doc"><p>Starts out empty, then is filled exactly once. As an example:</p><pre>bar &lt;- <code><a href="Control-Concurrent-Extra.html#v:newBarrier" title="Control.Concurrent.Extra">newBarrier</a></code>
forkIO $ do ...; val &lt;- ...; <code><a href="Control-Concurrent-Extra.html#v:signalBarrier" title="Control.Concurrent.Extra">signalBarrier</a></code> bar val
print =&lt;&lt; <code><a href="Control-Concurrent-Extra.html#v:waitBarrier" title="Control.Concurrent.Extra">waitBarrier</a></code> bar
</pre><p>Here we create a barrier which will contain some computed value.
   A thread is forked to fill the barrier, while the main thread waits
   for it to complete. A barrier has similarities to a future or promise
   from other languages, has been known as an IVar in other Haskell work,
   and in some ways is like a manually managed thunk.</p></div></div><div class="top"><p class="src"><a id="v:newBarrier" class="def">newBarrier</a> :: <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Control-Concurrent-Extra.html#t:Barrier" title="Control.Concurrent.Extra">Barrier</a> a) <a href="src/Control.Concurrent.Extra.html#newBarrier" class="link">Source</a> <a href="#v:newBarrier" class="selflink">#</a></p><div class="doc"><p>Create a new <code><a href="Control-Concurrent-Extra.html#t:Barrier" title="Control.Concurrent.Extra">Barrier</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:signalBarrier" class="def">signalBarrier</a> :: <a href="Control-Exception-Extra.html#t:Partial" title="Control.Exception.Extra">Partial</a> =&gt; <a href="Control-Concurrent-Extra.html#t:Barrier" title="Control.Concurrent.Extra">Barrier</a> a -&gt; a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Control.Concurrent.Extra.html#signalBarrier" class="link">Source</a> <a href="#v:signalBarrier" class="selflink">#</a></p><div class="doc"><p>Write a value into the Barrier, releasing anyone at <code><a href="Control-Concurrent-Extra.html#v:waitBarrier" title="Control.Concurrent.Extra">waitBarrier</a></code>.
   Any subsequent attempts to signal the <code><a href="Control-Concurrent-Extra.html#t:Barrier" title="Control.Concurrent.Extra">Barrier</a></code> will throw an exception.</p></div></div><div class="top"><p class="src"><a id="v:waitBarrier" class="def">waitBarrier</a> :: <a href="Control-Concurrent-Extra.html#t:Barrier" title="Control.Concurrent.Extra">Barrier</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> a <a href="src/Control.Concurrent.Extra.html#waitBarrier" class="link">Source</a> <a href="#v:waitBarrier" class="selflink">#</a></p><div class="doc"><p>Wait until a barrier has been signaled with <code><a href="Control-Concurrent-Extra.html#v:signalBarrier" title="Control.Concurrent.Extra">signalBarrier</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:waitBarrierMaybe" class="def">waitBarrierMaybe</a> :: <a href="Control-Concurrent-Extra.html#t:Barrier" title="Control.Concurrent.Extra">Barrier</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../base-4.18.2.1/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> a) <a href="src/Control.Concurrent.Extra.html#waitBarrierMaybe" class="link">Source</a> <a href="#v:waitBarrierMaybe" class="selflink">#</a></p><div class="doc"><p>A version of <code><a href="Control-Concurrent-Extra.html#v:waitBarrier" title="Control.Concurrent.Extra">waitBarrier</a></code> that never blocks, returning <code><a href="../base-4.18.2.1/Data-Maybe.html#v:Nothing" title="Data.Maybe">Nothing</a></code>
   if the barrier has not yet been signaled.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>