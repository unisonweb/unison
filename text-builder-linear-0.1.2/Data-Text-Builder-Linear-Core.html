<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Data.Text.Builder.Linear.Core</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">text-builder-linear-0.1.2: Builder for Text and ByteString based on linear types</span><ul class="links" id="page-menu"><li><a href="src/Data.Text.Builder.Linear.Core.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(c) 2022 Andrew Lelechenko<br />(c) 2023 Pierre Le Marre</td></tr><tr><th>License</th><td>BSD3</td></tr><tr><th>Maintainer</th><td>Andrew Lelechenko &lt;andrew.lelechenko@gmail.com&gt;</td></tr><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>GHC2021</td></tr></table><p class="caption">Data.Text.Builder.Linear.Core</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Type</a></li><li><a href="#g:2">Basic interface</a></li><li><a href="#g:3">Text concatenation</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Low-level routines for <code><a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></code> manipulations.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:Buffer">Buffer</a> :: <a href="../base-4.18.2.1/GHC-Exts.html#t:TYPE" title="GHC.Exts">TYPE</a> ('<a href="../base-4.18.2.1/GHC-Exts.html#v:BoxedRep" title="GHC.Exts">BoxedRep</a> '<a href="../base-4.18.2.1/GHC-Exts.html#v:Unlifted" title="GHC.Exts">Unlifted</a>)</li><li class="src short"><a href="#v:runBuffer">runBuffer</a> :: (<a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a>) %1 -&gt; <a href="../text-2.0.2/Data-Text.html#t:Text" title="Data.Text">Text</a></li><li class="src short"><a href="#v:runBufferBS">runBufferBS</a> :: (<a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a>) %1 -&gt; <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a></li><li class="src short"><a href="#v:dupBuffer">dupBuffer</a> :: <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; (# <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a>, <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> #)</li><li class="src short"><a href="#v:consumeBuffer">consumeBuffer</a> :: <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; ()</li><li class="src short"><a href="#v:eraseBuffer">eraseBuffer</a> :: <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></li><li class="src short"><a href="#v:byteSizeOfBuffer">byteSizeOfBuffer</a> :: <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; (# <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a>, <a href="../base-4.18.2.1/Data-Word.html#t:Word" title="Data.Word">Word</a> #)</li><li class="src short"><a href="#v:lengthOfBuffer">lengthOfBuffer</a> :: <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; (# <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a>, <a href="../base-4.18.2.1/Data-Word.html#t:Word" title="Data.Word">Word</a> #)</li><li class="src short"><a href="#v:dropBuffer">dropBuffer</a> :: <a href="../base-4.18.2.1/Data-Word.html#t:Word" title="Data.Word">Word</a> -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></li><li class="src short"><a href="#v:takeBuffer">takeBuffer</a> :: <a href="../base-4.18.2.1/Data-Word.html#t:Word" title="Data.Word">Word</a> -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></li><li class="src short"><a href="#v:newEmptyBuffer">newEmptyBuffer</a> :: <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; (# <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a>, <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> #)</li><li class="src short"><a href="#v:appendBounded">appendBounded</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; (<span class="keyword">forall</span> s. <a href="../text-2.0.2/Data-Text-Array.html#t:MArray" title="Data.Text.Array">MArray</a> s -&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:ST" title="Control.Monad.ST.Safe">ST</a> s <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a>) -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></li><li class="src short"><a href="#v:appendExact">appendExact</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; (<span class="keyword">forall</span> s. <a href="../text-2.0.2/Data-Text-Array.html#t:MArray" title="Data.Text.Array">MArray</a> s -&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:ST" title="Control.Monad.ST.Safe">ST</a> s ()) -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></li><li class="src short"><a href="#v:prependBounded">prependBounded</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; (<span class="keyword">forall</span> s. <a href="../text-2.0.2/Data-Text-Array.html#t:MArray" title="Data.Text.Array">MArray</a> s -&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:ST" title="Control.Monad.ST.Safe">ST</a> s <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a>) -&gt; (<span class="keyword">forall</span> s. <a href="../text-2.0.2/Data-Text-Array.html#t:MArray" title="Data.Text.Array">MArray</a> s -&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:ST" title="Control.Monad.ST.Safe">ST</a> s <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a>) -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></li><li class="src short"><a href="#v:prependExact">prependExact</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; (<span class="keyword">forall</span> s. <a href="../text-2.0.2/Data-Text-Array.html#t:MArray" title="Data.Text.Array">MArray</a> s -&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:ST" title="Control.Monad.ST.Safe">ST</a> s ()) -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></li><li class="src short"><a href="#v:-62--60-">(&gt;&lt;)</a> :: <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Type</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Buffer" class="def">Buffer</a> :: <a href="../base-4.18.2.1/GHC-Exts.html#t:TYPE" title="GHC.Exts">TYPE</a> ('<a href="../base-4.18.2.1/GHC-Exts.html#v:BoxedRep" title="GHC.Exts">BoxedRep</a> '<a href="../base-4.18.2.1/GHC-Exts.html#v:Unlifted" title="GHC.Exts">Unlifted</a>) <a href="src/Data.Text.Builder.Linear.Core.html#Buffer" class="link">Source</a> <a href="#t:Buffer" class="selflink">#</a></p><div class="doc"><p>Internally <code><a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></code> is a mutable buffer.
 If a client gets hold of a variable of type <code><a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></code>,
 they'd be able to pass a mutable buffer to concurrent threads.
 That's why API below is carefully designed to prevent such possibility:
 clients always work with linear functions <code><a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></code> &#8888; <code><a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></code> instead
 and run them on an empty <code><a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></code> to extract results.</p><p>In terms of <a href="https://hackage.haskell.org/package/linear-base"><code>linear-base</code></a>
 <code><a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></code> is <a href="https://hackage.haskell.org/package/linear-base/docs/Prelude-Linear.html#t:Consumable"><code>Consumable</code></a>
 (see <code><a href="Data-Text-Builder-Linear-Core.html#v:consumeBuffer" title="Data.Text.Builder.Linear.Core">consumeBuffer</a></code>)
 and <a href="https://hackage.haskell.org/package/linear-base/docs/Prelude-Linear.html#t:Dupable"><code>Dupable</code></a>
 (see <code><a href="Data-Text-Builder-Linear-Core.html#v:dupBuffer" title="Data.Text.Builder.Linear.Core">dupBuffer</a></code>),
 but not <a href="https://hackage.haskell.org/package/linear-base/docs/Prelude-Linear.html#t:Movable"><code>Movable</code></a>.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:set -XOverloadedStrings -XLinearTypes
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>import Data.Text.Builder.Linear.Buffer
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>runBuffer (\b -&gt; '!' .&lt;| &quot;foo&quot; &lt;| (b |&gt; &quot;bar&quot; |&gt;. '.'))
</code></strong>&quot;!foobar.&quot;
</pre><p>Remember: this is a strict builder, so on contrary to <a href="../text-2.0.2/Data-Text-Lazy-Builder.html">Data.Text.Lazy.Builder</a>
 for optimal performance you should use strict left folds instead of lazy right ones.</p><p><code><a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></code> is an unlifted datatype,
 so you can put it into an unboxed tuple <code>(# ..., ... #)</code>,
 but not into <code>(..., ...)</code>.</p></div></div><a href="#g:2" id="g:2"><h1>Basic interface</h1></a><div class="top"><p class="src"><a id="v:runBuffer" class="def">runBuffer</a> :: (<a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a>) %1 -&gt; <a href="../text-2.0.2/Data-Text.html#t:Text" title="Data.Text">Text</a> <a href="src/Data.Text.Builder.Linear.Core.html#runBuffer" class="link">Source</a> <a href="#v:runBuffer" class="selflink">#</a></p><div class="doc"><p>Run a linear function on an empty <code><a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></code>, producing a strict <code><a href="../text-2.0.2/Data-Text.html#t:Text" title="Data.Text">Text</a></code>.</p><p>Be careful to write <code>runBuffer (\b -&gt; ...)</code> instead of <code>runBuffer $ \b -&gt; ...</code>,
 because current implementation of linear types lacks special support for <code><a href="../base-4.18.2.1/Data-Function.html#v:-36-" title="Data.Function">($)</a></code>.
 Another option is to enable <code>{-# LANGUAGE BlockArguments #-}</code>
 and write <code>runBuffer \b -&gt; ...</code>.
 Alternatively, you can import
 <a href="https://hackage.haskell.org/package/linear-base/docs/Prelude-Linear.html#v:-36-"><code>($)</code></a>
 from <a href="https://hackage.haskell.org/package/linear-base"><code>linear-base</code></a>.</p><p><code><a href="Data-Text-Builder-Linear-Core.html#v:runBuffer" title="Data.Text.Builder.Linear.Core">runBuffer</a></code> is similar in spirit to mutable arrays API in
 <a href="https://hackage.haskell.org/package/linear-base/docs/Data-Array-Mutable-Linear.html"><code>Data.Array.Mutable.Linear</code></a>,
 which provides functions like
 <a href="https://hackage.haskell.org/package/linear-base/docs/Data-Array-Mutable-Linear.html#v:fromList"><code>fromList</code></a> &#8759; [<code>a</code>] &#8594; (<code>Vector</code> <code>a</code> &#8888; <a href="https://hackage.haskell.org/package/linear-base-0.3.0/docs/Prelude-Linear.html#t:Ur"><code>Ur</code></a> b) &#8888; <a href="https://hackage.haskell.org/package/linear-base-0.3.0/docs/Prelude-Linear.html#t:Ur"><code>Ur</code></a> <code>b</code>.
 Here the initial buffer is always empty and <code>b</code> is <code><a href="../text-2.0.2/Data-Text.html#t:Text" title="Data.Text">Text</a></code>. Since <code><a href="../text-2.0.2/Data-Text.html#t:Text" title="Data.Text">Text</a></code> is
 <a href="https://hackage.haskell.org/package/linear-base/docs/Prelude-Linear.html#t:Movable"><code>Movable</code></a>,
 <code><a href="../text-2.0.2/Data-Text.html#t:Text" title="Data.Text">Text</a></code> and <a href="https://hackage.haskell.org/package/linear-base-0.3.0/docs/Prelude-Linear.html#t:Ur"><code>Ur</code></a> <code><a href="../text-2.0.2/Data-Text.html#t:Text" title="Data.Text">Text</a></code> are equivalent.</p></div></div><div class="top"><p class="src"><a id="v:runBufferBS" class="def">runBufferBS</a> :: (<a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a>) %1 -&gt; <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a> <a href="src/Data.Text.Builder.Linear.Core.html#runBufferBS" class="link">Source</a> <a href="#v:runBufferBS" class="selflink">#</a></p><div class="doc"><p>Same as <code><a href="Data-Text-Builder-Linear-Core.html#v:runBuffer" title="Data.Text.Builder.Linear.Core">runBuffer</a></code>, but returning a UTF-8 encoded strict <code><a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:dupBuffer" class="def">dupBuffer</a> :: <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; (# <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a>, <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> #) <a href="src/Data.Text.Builder.Linear.Core.html#dupBuffer" class="link">Source</a> <a href="#v:dupBuffer" class="selflink">#</a></p><div class="doc"><p>Duplicate builder. Feel free to process results in parallel threads.
 Similar to
 <a href="https://hackage.haskell.org/package/linear-base/docs/Prelude-Linear.html#t:Dupable"><code>Dupable</code></a>
 from <a href="https://hackage.haskell.org/package/linear-base"><code>linear-base</code></a>.</p><p>It is a bit tricky to use because of
 <a href="https://ghc.gitlab.haskell.org/ghc/doc/users_guide/exts/linear_types.html#limitations">current limitations</a>
 of linear types with regards to <code>let</code> and <code>where</code>. E. g., one cannot write</p><pre>let (# b1, b2 #) = dupBuffer b in (&quot;foo&quot; &lt;| b1) &gt;&lt; (b2 |&gt; &quot;bar&quot;)</pre><p>Instead write:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:set -XOverloadedStrings -XLinearTypes -XUnboxedTuples
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>import Data.Text.Builder.Linear.Buffer
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>runBuffer (\b -&gt; case dupBuffer b of (# b1, b2 #) -&gt; (&quot;foo&quot; &lt;| b1) &gt;&lt; (b2 |&gt; &quot;bar&quot;))
</code></strong>&quot;foobar&quot;
</pre><p>Note the unboxed tuple: <code><a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></code> is an unlifted datatype,
 so it cannot be put into <code>(..., ...)</code>.</p></div></div><div class="top"><p class="src"><a id="v:consumeBuffer" class="def">consumeBuffer</a> :: <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; () <a href="src/Data.Text.Builder.Linear.Core.html#consumeBuffer" class="link">Source</a> <a href="#v:consumeBuffer" class="selflink">#</a></p><div class="doc"><p>Consume buffer linearly,
 similar to
 <a href="https://hackage.haskell.org/package/linear-base/docs/Prelude-Linear.html#t:Consumable"><code>Consumable</code></a>
 from <a href="https://hackage.haskell.org/package/linear-base"><code>linear-base</code></a>.</p></div></div><div class="top"><p class="src"><a id="v:eraseBuffer" class="def">eraseBuffer</a> :: <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> <a href="src/Data.Text.Builder.Linear.Core.html#eraseBuffer" class="link">Source</a> <a href="#v:eraseBuffer" class="selflink">#</a></p><div class="doc"><p>Erase buffer's content, replacing it with an empty <code><a href="../text-2.0.2/Data-Text.html#t:Text" title="Data.Text">Text</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:byteSizeOfBuffer" class="def">byteSizeOfBuffer</a> :: <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; (# <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a>, <a href="../base-4.18.2.1/Data-Word.html#t:Word" title="Data.Word">Word</a> #) <a href="src/Data.Text.Builder.Linear.Core.html#byteSizeOfBuffer" class="link">Source</a> <a href="#v:byteSizeOfBuffer" class="selflink">#</a></p><div class="doc"><p>Return buffer's size in <strong>bytes</strong> (not in <code><a href="../base-4.18.2.1/Data-Char.html#t:Char" title="Data.Char">Char</a></code>s).
 This could be useful to implement a lazy builder atop of a strict one.</p></div></div><div class="top"><p class="src"><a id="v:lengthOfBuffer" class="def">lengthOfBuffer</a> :: <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; (# <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a>, <a href="../base-4.18.2.1/Data-Word.html#t:Word" title="Data.Word">Word</a> #) <a href="src/Data.Text.Builder.Linear.Core.html#lengthOfBuffer" class="link">Source</a> <a href="#v:lengthOfBuffer" class="selflink">#</a></p><div class="doc"><p>Return buffer's length in <code><a href="../base-4.18.2.1/Data-Char.html#t:Char" title="Data.Char">Char</a></code>s (not in bytes).
 This could be useful to implement <code>dropEndBuffer</code> and <code>takeEndBuffer</code>, e. g.,</p><pre>import Data.Unrestricted.Linear

dropEndBuffer :: Word -&gt; Buffer %1 -&gt; Buffer
dropEndBuffer n buf = case lengthOfBuffer buf of
  (# buf', len #) -&gt; case move len of
    Ur len' -&gt; takeBuffer (len' - n) buf'
</pre></div></div><div class="top"><p class="src"><a id="v:dropBuffer" class="def">dropBuffer</a> :: <a href="../base-4.18.2.1/Data-Word.html#t:Word" title="Data.Word">Word</a> -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> <a href="src/Data.Text.Builder.Linear.Core.html#dropBuffer" class="link">Source</a> <a href="#v:dropBuffer" class="selflink">#</a></p><div class="doc"><p>Slice <code><a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></code> by dropping given number of <code><a href="../base-4.18.2.1/Data-Char.html#t:Char" title="Data.Char">Char</a></code>s.</p></div></div><div class="top"><p class="src"><a id="v:takeBuffer" class="def">takeBuffer</a> :: <a href="../base-4.18.2.1/Data-Word.html#t:Word" title="Data.Word">Word</a> -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> <a href="src/Data.Text.Builder.Linear.Core.html#takeBuffer" class="link">Source</a> <a href="#v:takeBuffer" class="selflink">#</a></p><div class="doc"><p>Slice <code><a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></code> by taking given number of <code><a href="../base-4.18.2.1/Data-Char.html#t:Char" title="Data.Char">Char</a></code>s.</p></div></div><div class="top"><p class="src"><a id="v:newEmptyBuffer" class="def">newEmptyBuffer</a> :: <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; (# <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a>, <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> #) <a href="src/Data.Text.Builder.Linear.Core.html#newEmptyBuffer" class="link">Source</a> <a href="#v:newEmptyBuffer" class="selflink">#</a></p><div class="doc"><p>Create an empty <code><a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></code>.</p><p>The first <code><a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></code> is the input and the second is a new empty <code><a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></code>.</p><p>This function is needed in some situations, e.g. with
 <code><a href="Data-Text-Builder-Linear-Buffer.html#v:justifyRight" title="Data.Text.Builder.Linear.Buffer">justifyRight</a></code>. The following example creates
 a utility function that justify a text and then append it to a buffer.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:set -XOverloadedStrings -XLinearTypes -XUnboxedTuples
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>import Data.Text.Builder.Linear.Buffer
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>import Data.Text (Text)
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>appendJustified :: Buffer %1 -&gt; Text -&gt; Buffer
appendJustified b t = case newEmptyBuffer b of
  -- Note that we need to create a new buffer from the text, in order
  -- to justify only the text and not the input buffer.
  (# b', empty #) -&gt; b' &gt;&lt; justifyRight 12 ' ' (empty |&gt; t)
:}
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>runBuffer (\b -&gt; (b |&gt; &quot;Test:&quot;) `appendJustified` &quot;foo&quot; `appendJustified` &quot;bar&quot;)
</code></strong>&quot;Test:         foo         bar&quot;
</pre><p>Note: a previous buffer is necessary in order to create an empty buffer with
 the same characteristics.</p></div></div><a href="#g:3" id="g:3"><h1>Text concatenation</h1></a><div class="top"><p class="src"><a id="v:appendBounded" class="def">appendBounded</a> <a href="src/Data.Text.Builder.Linear.Core.html#appendBounded" class="link">Source</a> <a href="#v:appendBounded" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a></td><td class="doc"><p>Upper bound for the number of bytes, written by an action</p></td></tr><tr><td class="src">-&gt; (<span class="keyword">forall</span> s. <a href="../text-2.0.2/Data-Text-Array.html#t:MArray" title="Data.Text.Array">MArray</a> s -&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:ST" title="Control.Monad.ST.Safe">ST</a> s <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a>)</td><td class="doc"><p>Action, which writes bytes <strong>starting</strong> from the given offset
 and returns an actual number of bytes written.</p></td></tr><tr><td class="src">-&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Low-level routine to append data of unknown size to a <code><a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:appendExact" class="def">appendExact</a> <a href="src/Data.Text.Builder.Linear.Core.html#appendExact" class="link">Source</a> <a href="#v:appendExact" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a></td><td class="doc"><p>Exact number of bytes, written by an action</p></td></tr><tr><td class="src">-&gt; (<span class="keyword">forall</span> s. <a href="../text-2.0.2/Data-Text-Array.html#t:MArray" title="Data.Text.Array">MArray</a> s -&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:ST" title="Control.Monad.ST.Safe">ST</a> s ())</td><td class="doc"><p>Action, which writes bytes <strong>starting</strong> from the given offset</p></td></tr><tr><td class="src">-&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Low-level routine to append data of known size to a <code><a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:prependBounded" class="def">prependBounded</a> <a href="src/Data.Text.Builder.Linear.Core.html#prependBounded" class="link">Source</a> <a href="#v:prependBounded" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a></td><td class="doc"><p>Upper bound for the number of bytes, written by an action</p></td></tr><tr><td class="src">-&gt; (<span class="keyword">forall</span> s. <a href="../text-2.0.2/Data-Text-Array.html#t:MArray" title="Data.Text.Array">MArray</a> s -&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:ST" title="Control.Monad.ST.Safe">ST</a> s <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a>)</td><td class="doc"><p>Action, which writes bytes <strong>finishing</strong> before the given offset
 and returns an actual number of bytes written.</p></td></tr><tr><td class="src">-&gt; (<span class="keyword">forall</span> s. <a href="../text-2.0.2/Data-Text-Array.html#t:MArray" title="Data.Text.Array">MArray</a> s -&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:ST" title="Control.Monad.ST.Safe">ST</a> s <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a>)</td><td class="doc"><p>Action, which writes bytes <strong>starting</strong> from the given offset
 and returns an actual number of bytes written.</p></td></tr><tr><td class="src">-&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Low-level routine to prepend data of unknown size to a <code><a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:prependExact" class="def">prependExact</a> <a href="src/Data.Text.Builder.Linear.Core.html#prependExact" class="link">Source</a> <a href="#v:prependExact" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a></td><td class="doc"><p>Exact number of bytes, written by an action</p></td></tr><tr><td class="src">-&gt; (<span class="keyword">forall</span> s. <a href="../text-2.0.2/Data-Text-Array.html#t:MArray" title="Data.Text.Array">MArray</a> s -&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:ST" title="Control.Monad.ST.Safe">ST</a> s ())</td><td class="doc"><p>Action, which writes bytes <strong>starting</strong> from the given offset</p></td></tr><tr><td class="src">-&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Low-level routine to append data of known size to a <code><a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:-62--60-" class="def">(&gt;&lt;)</a> :: <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> %1 -&gt; <a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a> <span class="fixity">infix 6</span><span class="rightedge"></span> <a href="src/Data.Text.Builder.Linear.Core.html#%3E%3C" class="link">Source</a> <a href="#v:-62--60-" class="selflink">#</a></p><div class="doc"><p>Concatenate two <code><a href="Data-Text-Builder-Linear-Core.html#t:Buffer" title="Data.Text.Builder.Linear.Core">Buffer</a></code>s, potentially mutating both of them.</p><p>You likely need to use <code><a href="Data-Text-Builder-Linear-Core.html#v:dupBuffer" title="Data.Text.Builder.Linear.Core">dupBuffer</a></code> to get hold on two builders at once:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:set -XOverloadedStrings -XLinearTypes -XUnboxedTuples
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>import Data.Text.Builder.Linear.Buffer
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>runBuffer (\b -&gt; case dupBuffer b of (# b1, b2 #) -&gt; (&quot;foo&quot; &lt;| b1) &gt;&lt; (b2 |&gt; &quot;bar&quot;))
</code></strong>&quot;foobar&quot;
</pre></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>