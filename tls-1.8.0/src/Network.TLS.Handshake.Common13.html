<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings, GeneralizedNewtypeDeriving, BangPatterns #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Module      : Network.TLS.Handshake.Common13</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- License     : BSD-style</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Stability   : experimental</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Portability : unknown</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.TLS.Handshake.Common13</span><span>
</span><span id="line-11"></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#makeFinished"><span class="hs-identifier">makeFinished</span></a></span><span>
</span><span id="line-12"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#checkFinished"><span class="hs-identifier">checkFinished</span></a></span><span>
</span><span id="line-13"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#makeServerKeyShare"><span class="hs-identifier">makeServerKeyShare</span></a></span><span>
</span><span id="line-14"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#makeClientKeyShare"><span class="hs-identifier">makeClientKeyShare</span></a></span><span>
</span><span id="line-15"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#fromServerKeyShare"><span class="hs-identifier">fromServerKeyShare</span></a></span><span>
</span><span id="line-16"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#makeCertVerify"><span class="hs-identifier">makeCertVerify</span></a></span><span>
</span><span id="line-17"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#checkCertVerify"><span class="hs-identifier">checkCertVerify</span></a></span><span>
</span><span id="line-18"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#makePSKBinder"><span class="hs-identifier">makePSKBinder</span></a></span><span>
</span><span id="line-19"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#replacePSKBinder"><span class="hs-identifier">replacePSKBinder</span></a></span><span>
</span><span id="line-20"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#sendChangeCipherSpec13"><span class="hs-identifier">sendChangeCipherSpec13</span></a></span><span>
</span><span id="line-21"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#handshakeTerminate13"><span class="hs-identifier">handshakeTerminate13</span></a></span><span>
</span><span id="line-22"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#makeCertRequest"><span class="hs-identifier">makeCertRequest</span></a></span><span>
</span><span id="line-23"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#createTLS13TicketInfo"><span class="hs-identifier">createTLS13TicketInfo</span></a></span><span>
</span><span id="line-24"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#ageToObfuscatedAge"><span class="hs-identifier">ageToObfuscatedAge</span></a></span><span>
</span><span id="line-25"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#isAgeValid"><span class="hs-identifier">isAgeValid</span></a></span><span>
</span><span id="line-26"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#getAge"><span class="hs-identifier">getAge</span></a></span><span>
</span><span id="line-27"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#checkFreshness"><span class="hs-identifier">checkFreshness</span></a></span><span>
</span><span id="line-28"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#getCurrentTimeFromBase"><span class="hs-identifier">getCurrentTimeFromBase</span></a></span><span>
</span><span id="line-29"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#getSessionData13"><span class="hs-identifier">getSessionData13</span></a></span><span>
</span><span id="line-30"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#ensureNullCompression"><span class="hs-identifier">ensureNullCompression</span></a></span><span>
</span><span id="line-31"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#isHashSignatureValid13"><span class="hs-identifier">isHashSignatureValid13</span></a></span><span>
</span><span id="line-32"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#safeNonNegative32"><span class="hs-identifier">safeNonNegative32</span></a></span><span>
</span><span id="line-33"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#RecvHandshake13M"><span class="hs-identifier">RecvHandshake13M</span></a></span><span>
</span><span id="line-34"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#runRecvHandshake13"><span class="hs-identifier">runRecvHandshake13</span></a></span><span>
</span><span id="line-35"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#recvHandshake13"><span class="hs-identifier">recvHandshake13</span></a></span><span>
</span><span id="line-36"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#recvHandshake13hash"><span class="hs-identifier">recvHandshake13hash</span></a></span><span>
</span><span id="line-37"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#CipherChoice"><span class="hs-identifier">CipherChoice</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#makeCipherChoice"><span class="hs-identifier">makeCipherChoice</span></a></span><span>
</span><span id="line-39"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#initEarlySecret"><span class="hs-identifier">initEarlySecret</span></a></span><span>
</span><span id="line-40"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#calculateEarlySecret"><span class="hs-identifier">calculateEarlySecret</span></a></span><span>
</span><span id="line-41"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#calculateHandshakeSecret"><span class="hs-identifier">calculateHandshakeSecret</span></a></span><span>
</span><span id="line-42"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#calculateApplicationSecret"><span class="hs-identifier">calculateApplicationSecret</span></a></span><span>
</span><span id="line-43"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#calculateResumptionSecret"><span class="hs-identifier">calculateResumptionSecret</span></a></span><span>
</span><span id="line-44"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#derivePSK"><span class="hs-identifier">derivePSK</span></a></span><span>
</span><span id="line-45"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#checkKeyShareKeyLength"><span class="hs-identifier">checkKeyShareKeyLength</span></a></span><span>
</span><span id="line-46"></span><span>       </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteArray</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BA</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.UnixTime</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.C.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CTime</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Cipher.html"><span class="hs-identifier">Network.TLS.Cipher</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Compression.html"><span class="hs-identifier">Network.TLS.Compression</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html"><span class="hs-identifier">Network.TLS.Context.Internal</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Crypto.html"><span class="hs-identifier">Network.TLS.Crypto</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Network.TLS.Crypto.IES.html"><span class="hs-identifier">Network.TLS.Crypto.IES</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IES</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Extension.html"><span class="hs-identifier">Network.TLS.Extension</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Certificate.html"><span class="hs-identifier">Network.TLS.Handshake.Certificate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Handshake.Certificate.html#extractCAname"><span class="hs-identifier">extractCAname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html"><span class="hs-identifier">Network.TLS.Handshake.Common</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Handshake.Common.html#unexpected"><span class="hs-identifier">unexpected</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Key.html"><span class="hs-identifier">Network.TLS.Handshake.Key</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Process.html"><span class="hs-identifier">Network.TLS.Handshake.Process</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Handshake.Process.html#processHandshake13"><span class="hs-identifier">processHandshake13</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Signature.html"><span class="hs-identifier">Network.TLS.Handshake.Signature</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html"><span class="hs-identifier">Network.TLS.Handshake.State</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State13.html"><span class="hs-identifier">Network.TLS.Handshake.State13</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.IO.html"><span class="hs-identifier">Network.TLS.IO</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Imports.html"><span class="hs-identifier">Network.TLS.Imports</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.KeySchedule.html"><span class="hs-identifier">Network.TLS.KeySchedule</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.MAC.html"><span class="hs-identifier">Network.TLS.MAC</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Parameters.html"><span class="hs-identifier">Network.TLS.Parameters</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.State.html"><span class="hs-identifier">Network.TLS.State</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Struct.html"><span class="hs-identifier">Network.TLS.Struct</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Struct13.html"><span class="hs-identifier">Network.TLS.Struct13</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Types.html"><span class="hs-identifier">Network.TLS.Types</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Wire.html"><span class="hs-identifier">Network.TLS.Wire</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.MVar</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State.Strict</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">writeIORef</span></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span id="local-6989586621679190470"><span class="annot"><a href="Network.TLS.Handshake.Common13.html#makeFinished"><span class="hs-identifier hs-type">makeFinished</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679190470"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Crypto.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679190470"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Struct13.html#Handshake13"><span class="hs-identifier hs-type">Handshake13</span></a></span></span><span>
</span><span id="line-83"></span><span id="makeFinished"><span class="annot"><span class="annottext">makeFinished :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Context -&gt; Hash -&gt; ByteString -&gt; m Handshake13
</span><a href="Network.TLS.Handshake.Common13.html#makeFinished"><span class="hs-identifier hs-var hs-var">makeFinished</span></a></span></span><span> </span><span id="local-6989586621679190867"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190867"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679190868"><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679190868"><span class="hs-identifier hs-var">usedHash</span></a></span></span><span> </span><span id="local-6989586621679190869"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190869"><span class="hs-identifier hs-var">baseKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-84"></span><span>    </span><span id="local-6989586621679190870"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190870"><span class="hs-identifier hs-var">finished</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.Handshake.Common13.html#makeVerifyData"><span class="hs-identifier hs-var">makeVerifyData</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679190868"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190869"><span class="hs-identifier hs-var">baseKey</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; m ByteString -&gt; m ByteString
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; m ByteString
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m ByteString
</span><a href="Network.TLS.Handshake.State13.html#transcriptHash"><span class="hs-identifier hs-var">transcriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190867"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe ByteString) -&gt; Maybe ByteString -&gt; IO ()
forall a. IORef a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">writeIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; IORef (Maybe ByteString)
</span><a href="Network.TLS.Context.Internal.html#ctxFinished"><span class="hs-identifier hs-var">ctxFinished</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190867"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190870"><span class="hs-identifier hs-var">finished</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><span class="annottext">Handshake13 -&gt; m Handshake13
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Handshake13 -&gt; m Handshake13) -&gt; Handshake13 -&gt; m Handshake13
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Handshake13
</span><a href="Network.TLS.Struct13.html#Finished13"><span class="hs-identifier hs-var">Finished13</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190870"><span class="hs-identifier hs-var">finished</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span id="local-6989586621679190490"><span class="annot"><a href="Network.TLS.Handshake.Common13.html#checkFinished"><span class="hs-identifier hs-type">checkFinished</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679190490"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Crypto.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679190490"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-89"></span><span id="checkFinished"><span class="annot"><span class="annottext">checkFinished :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Context -&gt; Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString -&gt; m ()
</span><a href="Network.TLS.Handshake.Common13.html#checkFinished"><span class="hs-identifier hs-var hs-var">checkFinished</span></a></span></span><span> </span><span id="local-6989586621679190890"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190890"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679190891"><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679190891"><span class="hs-identifier hs-var">usedHash</span></a></span></span><span> </span><span id="local-6989586621679190892"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190892"><span class="hs-identifier hs-var">baseKey</span></a></span></span><span> </span><span id="local-6989586621679190893"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190893"><span class="hs-identifier hs-var">hashValue</span></a></span></span><span> </span><span id="local-6989586621679190894"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190894"><span class="hs-identifier hs-var">verifyData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679190895"><span class="annot"><span class="annottext">verifyData' :: ByteString
</span><a href="#local-6989586621679190895"><span class="hs-identifier hs-var hs-var">verifyData'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.Handshake.Common13.html#makeVerifyData"><span class="hs-identifier hs-var">makeVerifyData</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679190891"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190892"><span class="hs-identifier hs-var">baseKey</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190893"><span class="hs-identifier hs-var">hashValue</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190894"><span class="hs-identifier hs-var">verifyData</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190895"><span class="hs-identifier hs-var">verifyData'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TLSError -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">(TLSError -&gt; m ()) -&gt; TLSError -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool, AlertDescription) -&gt; TLSError
</span><a href="Network.TLS.Struct.html#Error_Protocol"><span class="hs-identifier hs-var">Error_Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;broken Finished&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#DecodeError"><span class="hs-identifier hs-var">DecodeError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190895"><span class="hs-identifier hs-var">verifyData'</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190894"><span class="hs-identifier hs-var">verifyData</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; m a
</span><a href="Network.TLS.Handshake.Signature.html#decryptError"><span class="hs-identifier hs-var">decryptError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cannot verify finished&quot;</span></span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe ByteString) -&gt; Maybe ByteString -&gt; IO ()
forall a. IORef a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">writeIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; IORef (Maybe ByteString)
</span><a href="Network.TLS.Context.Internal.html#ctxPeerFinished"><span class="hs-identifier hs-var">ctxPeerFinished</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190890"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190894"><span class="hs-identifier hs-var">verifyData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#makeVerifyData"><span class="hs-identifier hs-type">makeVerifyData</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Crypto.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-96"></span><span id="makeVerifyData"><span class="annot"><span class="annottext">makeVerifyData :: Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.Handshake.Common13.html#makeVerifyData"><span class="hs-identifier hs-var hs-var">makeVerifyData</span></a></span></span><span> </span><span id="local-6989586621679190905"><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679190905"><span class="hs-identifier hs-var">usedHash</span></a></span></span><span> </span><span id="local-6989586621679190906"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190906"><span class="hs-identifier hs-var">baseKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.MAC.html#hmac"><span class="hs-identifier hs-var">hmac</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679190905"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190908"><span class="hs-identifier hs-var">finishedKey</span></a></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-98"></span><span>    </span><span id="local-6989586621679190909"><span class="annot"><span class="annottext">hashSize :: Int
</span><a href="#local-6989586621679190909"><span class="hs-identifier hs-var hs-var">hashSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; Int
</span><a href="Network.TLS.Crypto.html#hashDigestSize"><span class="hs-identifier hs-var">hashDigestSize</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679190905"><span class="hs-identifier hs-var">usedHash</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span id="local-6989586621679190908"><span class="annot"><span class="annottext">finishedKey :: ByteString
</span><a href="#local-6989586621679190908"><span class="hs-identifier hs-var hs-var">finishedKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString -&gt; Int -&gt; ByteString
</span><a href="Network.TLS.KeySchedule.html#hkdfExpandLabel"><span class="hs-identifier hs-var">hkdfExpandLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679190905"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190906"><span class="hs-identifier hs-var">baseKey</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;finished&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679190909"><span class="hs-identifier hs-var">hashSize</span></a></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#makeServerKeyShare"><span class="hs-identifier hs-type">makeServerKeyShare</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Extension.html#KeyShareEntry"><span class="hs-identifier hs-type">KeyShareEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Extension.html#KeyShareEntry"><span class="hs-identifier hs-type">KeyShareEntry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span id="makeServerKeyShare"><span class="annot"><span class="annottext">makeServerKeyShare :: Context -&gt; KeyShareEntry -&gt; IO (ByteString, KeyShareEntry)
</span><a href="Network.TLS.Handshake.Common13.html#makeServerKeyShare"><span class="hs-identifier hs-var hs-var">makeServerKeyShare</span></a></span></span><span> </span><span id="local-6989586621679190914"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190914"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Extension.html#KeyShareEntry"><span class="hs-identifier hs-type">KeyShareEntry</span></a></span><span> </span><span id="local-6989586621679190916"><span class="annot"><span class="annottext">Group
</span><a href="#local-6989586621679190916"><span class="hs-identifier hs-var">grp</span></a></span></span><span> </span><span id="local-6989586621679190917"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190917"><span class="hs-identifier hs-var">wcpub</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either CryptoError GroupPublic
</span><a href="#local-6989586621679190918"><span class="hs-identifier hs-var">ecpub</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-105"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span>  </span><span id="local-6989586621679190919"><span class="annot"><span class="annottext">CryptoError
</span><a href="#local-6989586621679190919"><span class="hs-identifier hs-var">e</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TLSError -&gt; IO (ByteString, KeyShareEntry)
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">(TLSError -&gt; IO (ByteString, KeyShareEntry))
-&gt; TLSError -&gt; IO (ByteString, KeyShareEntry)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool, AlertDescription) -&gt; TLSError
</span><a href="Network.TLS.Struct.html#Error_Protocol"><span class="hs-identifier hs-var">Error_Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CryptoError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">CryptoError
</span><a href="#local-6989586621679190919"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#IllegalParameter"><span class="hs-identifier hs-var">IllegalParameter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679190922"><span class="annot"><span class="annottext">GroupPublic
</span><a href="#local-6989586621679190922"><span class="hs-identifier hs-var">cpub</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-107"></span><span>      </span><span id="local-6989586621679190923"><span class="annot"><span class="annottext">Maybe (GroupPublic, GroupKey)
</span><a href="#local-6989586621679190923"><span class="hs-identifier hs-var">ecdhePair</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; GroupPublic -&gt; IO (Maybe (GroupPublic, GroupKey))
</span><a href="Network.TLS.Handshake.Key.html#generateECDHEShared"><span class="hs-identifier hs-var">generateECDHEShared</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190914"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">GroupPublic
</span><a href="#local-6989586621679190922"><span class="hs-identifier hs-var">cpub</span></a></span><span>
</span><span id="line-108"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (GroupPublic, GroupKey)
</span><a href="#local-6989586621679190923"><span class="hs-identifier hs-var">ecdhePair</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-109"></span><span>          </span><span class="annot"><span class="annottext">Maybe (GroupPublic, GroupKey)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TLSError -&gt; IO (ByteString, KeyShareEntry)
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">(TLSError -&gt; IO (ByteString, KeyShareEntry))
-&gt; TLSError -&gt; IO (ByteString, KeyShareEntry)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool, AlertDescription) -&gt; TLSError
</span><a href="Network.TLS.Struct.html#Error_Protocol"><span class="hs-identifier hs-var">Error_Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679190925"><span class="hs-identifier hs-var">msgInvalidPublic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#IllegalParameter"><span class="hs-identifier hs-var">IllegalParameter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679190926"><span class="annot"><span class="annottext">GroupPublic
</span><a href="#local-6989586621679190926"><span class="hs-identifier hs-var">spub</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679190927"><span class="annot"><span class="annottext">GroupKey
</span><a href="#local-6989586621679190927"><span class="hs-identifier hs-var">share</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-111"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679190928"><span class="annot"><span class="annottext">wspub :: ByteString
</span><a href="#local-6989586621679190928"><span class="hs-identifier hs-var hs-var">wspub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GroupPublic -&gt; ByteString
</span><a href="Network.TLS.Crypto.IES.html#encodeGroupPublic"><span class="hs-identifier hs-var">IES.encodeGroupPublic</span></a></span><span> </span><span class="annot"><span class="annottext">GroupPublic
</span><a href="#local-6989586621679190926"><span class="hs-identifier hs-var">spub</span></a></span><span>
</span><span id="line-112"></span><span>                  </span><span id="local-6989586621679190930"><span class="annot"><span class="annottext">serverKeyShare :: KeyShareEntry
</span><a href="#local-6989586621679190930"><span class="hs-identifier hs-var hs-var">serverKeyShare</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Group -&gt; ByteString -&gt; KeyShareEntry
</span><a href="Network.TLS.Extension.html#KeyShareEntry"><span class="hs-identifier hs-var">KeyShareEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Group
</span><a href="#local-6989586621679190916"><span class="hs-identifier hs-var">grp</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190928"><span class="hs-identifier hs-var">wspub</span></a></span><span>
</span><span id="line-113"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(ByteString, KeyShareEntry) -&gt; IO (ByteString, KeyShareEntry)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupKey -&gt; ByteString
forall bin bout.
(ByteArrayAccess bin, ByteArray bout) =&gt;
bin -&gt; bout
</span><span class="hs-identifier hs-var">BA.convert</span></span><span> </span><span class="annot"><span class="annottext">GroupKey
</span><a href="#local-6989586621679190927"><span class="hs-identifier hs-var">share</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">KeyShareEntry
</span><a href="#local-6989586621679190930"><span class="hs-identifier hs-var">serverKeyShare</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-115"></span><span>    </span><span id="local-6989586621679190918"><span class="annot"><span class="annottext">ecpub :: Either CryptoError GroupPublic
</span><a href="#local-6989586621679190918"><span class="hs-identifier hs-var hs-var">ecpub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Group -&gt; ByteString -&gt; Either CryptoError GroupPublic
</span><a href="Network.TLS.Crypto.IES.html#decodeGroupPublic"><span class="hs-identifier hs-var">IES.decodeGroupPublic</span></a></span><span> </span><span class="annot"><span class="annottext">Group
</span><a href="#local-6989586621679190916"><span class="hs-identifier hs-var">grp</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190917"><span class="hs-identifier hs-var">wcpub</span></a></span><span>
</span><span id="line-116"></span><span>    </span><span id="local-6989586621679190925"><span class="annot"><span class="annottext">msgInvalidPublic :: String
</span><a href="#local-6989586621679190925"><span class="hs-identifier hs-var hs-var">msgInvalidPublic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;invalid client &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Group -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Group
</span><a href="#local-6989586621679190916"><span class="hs-identifier hs-var">grp</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; public key&quot;</span></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#makeClientKeyShare"><span class="hs-identifier hs-type">makeClientKeyShare</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Crypto.Types.html#Group"><span class="hs-identifier hs-type">Group</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Crypto.IES.html#GroupPrivate"><span class="hs-identifier hs-type">IES.GroupPrivate</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Extension.html#KeyShareEntry"><span class="hs-identifier hs-type">KeyShareEntry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span id="makeClientKeyShare"><span class="annot"><span class="annottext">makeClientKeyShare :: Context -&gt; Group -&gt; IO (GroupPrivate, KeyShareEntry)
</span><a href="Network.TLS.Handshake.Common13.html#makeClientKeyShare"><span class="hs-identifier hs-var hs-var">makeClientKeyShare</span></a></span></span><span> </span><span id="local-6989586621679190939"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190939"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679190940"><span class="annot"><span class="annottext">Group
</span><a href="#local-6989586621679190940"><span class="hs-identifier hs-var">grp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679190941"><span class="annot"><span class="annottext">GroupPrivate
</span><a href="#local-6989586621679190941"><span class="hs-identifier hs-var">cpri</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679190942"><span class="annot"><span class="annottext">GroupPublic
</span><a href="#local-6989586621679190942"><span class="hs-identifier hs-var">cpub</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; Group -&gt; IO (GroupPrivate, GroupPublic)
</span><a href="Network.TLS.Handshake.Key.html#generateECDHE"><span class="hs-identifier hs-var">generateECDHE</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190939"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Group
</span><a href="#local-6989586621679190940"><span class="hs-identifier hs-var">grp</span></a></span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679190944"><span class="annot"><span class="annottext">wcpub :: ByteString
</span><a href="#local-6989586621679190944"><span class="hs-identifier hs-var hs-var">wcpub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GroupPublic -&gt; ByteString
</span><a href="Network.TLS.Crypto.IES.html#encodeGroupPublic"><span class="hs-identifier hs-var">IES.encodeGroupPublic</span></a></span><span> </span><span class="annot"><span class="annottext">GroupPublic
</span><a href="#local-6989586621679190942"><span class="hs-identifier hs-var">cpub</span></a></span><span>
</span><span id="line-122"></span><span>        </span><span id="local-6989586621679190945"><span class="annot"><span class="annottext">clientKeyShare :: KeyShareEntry
</span><a href="#local-6989586621679190945"><span class="hs-identifier hs-var hs-var">clientKeyShare</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Group -&gt; ByteString -&gt; KeyShareEntry
</span><a href="Network.TLS.Extension.html#KeyShareEntry"><span class="hs-identifier hs-var">KeyShareEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Group
</span><a href="#local-6989586621679190940"><span class="hs-identifier hs-var">grp</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190944"><span class="hs-identifier hs-var">wcpub</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span class="annot"><span class="annottext">(GroupPrivate, KeyShareEntry) -&gt; IO (GroupPrivate, KeyShareEntry)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GroupPrivate
</span><a href="#local-6989586621679190941"><span class="hs-identifier hs-var">cpri</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">KeyShareEntry
</span><a href="#local-6989586621679190945"><span class="hs-identifier hs-var">clientKeyShare</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#fromServerKeyShare"><span class="hs-identifier hs-type">fromServerKeyShare</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Extension.html#KeyShareEntry"><span class="hs-identifier hs-type">KeyShareEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Crypto.IES.html#GroupPrivate"><span class="hs-identifier hs-type">IES.GroupPrivate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-126"></span><span id="fromServerKeyShare"><span class="annot"><span class="annottext">fromServerKeyShare :: KeyShareEntry -&gt; GroupPrivate -&gt; IO ByteString
</span><a href="Network.TLS.Handshake.Common13.html#fromServerKeyShare"><span class="hs-identifier hs-var hs-var">fromServerKeyShare</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Extension.html#KeyShareEntry"><span class="hs-identifier hs-type">KeyShareEntry</span></a></span><span> </span><span id="local-6989586621679190946"><span class="annot"><span class="annottext">Group
</span><a href="#local-6989586621679190946"><span class="hs-identifier hs-var">grp</span></a></span></span><span> </span><span id="local-6989586621679190947"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190947"><span class="hs-identifier hs-var">wspub</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679190948"><span class="annot"><span class="annottext">GroupPrivate
</span><a href="#local-6989586621679190948"><span class="hs-identifier hs-var">cpri</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either CryptoError GroupPublic
</span><a href="#local-6989586621679190949"><span class="hs-identifier hs-var">espub</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span>  </span><span id="local-6989586621679190950"><span class="annot"><span class="annottext">CryptoError
</span><a href="#local-6989586621679190950"><span class="hs-identifier hs-var">e</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TLSError -&gt; IO ByteString
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">(TLSError -&gt; IO ByteString) -&gt; TLSError -&gt; IO ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool, AlertDescription) -&gt; TLSError
</span><a href="Network.TLS.Struct.html#Error_Protocol"><span class="hs-identifier hs-var">Error_Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CryptoError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">CryptoError
</span><a href="#local-6989586621679190950"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#IllegalParameter"><span class="hs-identifier hs-var">IllegalParameter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679190951"><span class="annot"><span class="annottext">GroupPublic
</span><a href="#local-6989586621679190951"><span class="hs-identifier hs-var">spub</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GroupPublic -&gt; GroupPrivate -&gt; Maybe GroupKey
</span><a href="Network.TLS.Crypto.IES.html#groupGetShared"><span class="hs-identifier hs-var">IES.groupGetShared</span></a></span><span> </span><span class="annot"><span class="annottext">GroupPublic
</span><a href="#local-6989586621679190951"><span class="hs-identifier hs-var">spub</span></a></span><span> </span><span class="annot"><span class="annottext">GroupPrivate
</span><a href="#local-6989586621679190948"><span class="hs-identifier hs-var">cpri</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679190953"><span class="annot"><span class="annottext">GroupKey
</span><a href="#local-6989586621679190953"><span class="hs-identifier hs-var">shared</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ByteString) -&gt; ByteString -&gt; IO ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GroupKey -&gt; ByteString
forall bin bout.
(ByteArrayAccess bin, ByteArray bout) =&gt;
bin -&gt; bout
</span><span class="hs-identifier hs-var">BA.convert</span></span><span> </span><span class="annot"><span class="annottext">GroupKey
</span><a href="#local-6989586621679190953"><span class="hs-identifier hs-var">shared</span></a></span><span>
</span><span id="line-130"></span><span>    </span><span class="annot"><span class="annottext">Maybe GroupKey
</span><span class="hs-identifier hs-var">Nothing</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TLSError -&gt; IO ByteString
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">(TLSError -&gt; IO ByteString) -&gt; TLSError -&gt; IO ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool, AlertDescription) -&gt; TLSError
</span><a href="Network.TLS.Struct.html#Error_Protocol"><span class="hs-identifier hs-var">Error_Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cannot generate a shared secret on (EC)DH&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#IllegalParameter"><span class="hs-identifier hs-var">IllegalParameter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-132"></span><span>    </span><span id="local-6989586621679190949"><span class="annot"><span class="annottext">espub :: Either CryptoError GroupPublic
</span><a href="#local-6989586621679190949"><span class="hs-identifier hs-var hs-var">espub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Group -&gt; ByteString -&gt; Either CryptoError GroupPublic
</span><a href="Network.TLS.Crypto.IES.html#decodeGroupPublic"><span class="hs-identifier hs-var">IES.decodeGroupPublic</span></a></span><span> </span><span class="annot"><span class="annottext">Group
</span><a href="#local-6989586621679190946"><span class="hs-identifier hs-var">grp</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190947"><span class="hs-identifier hs-var">wspub</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#serverContextString"><span class="hs-identifier hs-type">serverContextString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-137"></span><span id="serverContextString"><span class="annot"><span class="annottext">serverContextString :: ByteString
</span><a href="Network.TLS.Handshake.Common13.html#serverContextString"><span class="hs-identifier hs-var hs-var">serverContextString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;TLS 1.3, server CertificateVerify&quot;</span></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#clientContextString"><span class="hs-identifier hs-type">clientContextString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-140"></span><span id="clientContextString"><span class="annot"><span class="annottext">clientContextString :: ByteString
</span><a href="Network.TLS.Handshake.Common13.html#clientContextString"><span class="hs-identifier hs-var hs-var">clientContextString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;TLS 1.3, client CertificateVerify&quot;</span></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span id="local-6989586621679190512"><span class="annot"><a href="Network.TLS.Handshake.Common13.html#makeCertVerify"><span class="hs-identifier hs-type">makeCertVerify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679190512"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PubKey</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Struct.html#HashAndSignatureAlgorithm"><span class="hs-identifier hs-type">HashAndSignatureAlgorithm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679190512"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Struct13.html#Handshake13"><span class="hs-identifier hs-type">Handshake13</span></a></span></span><span>
</span><span id="line-143"></span><span id="makeCertVerify"><span class="annot"><span class="annottext">makeCertVerify :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Context
-&gt; PubKey
-&gt; HashAndSignatureAlgorithm
-&gt; ByteString
-&gt; m Handshake13
</span><a href="Network.TLS.Handshake.Common13.html#makeCertVerify"><span class="hs-identifier hs-var hs-var">makeCertVerify</span></a></span></span><span> </span><span id="local-6989586621679190964"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190964"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679190965"><span class="annot"><span class="annottext">PubKey
</span><a href="#local-6989586621679190965"><span class="hs-identifier hs-var">pub</span></a></span></span><span> </span><span id="local-6989586621679190966"><span class="annot"><span class="annottext">HashAndSignatureAlgorithm
</span><a href="#local-6989586621679190966"><span class="hs-identifier hs-var">hs</span></a></span></span><span> </span><span id="local-6989586621679190967"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190967"><span class="hs-identifier hs-var">hashValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-144"></span><span>    </span><span id="local-6989586621679190968"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621679190968"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Role -&gt; m Role
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Role -&gt; m Role) -&gt; IO Role -&gt; m Role
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; TLSSt Role -&gt; IO Role
forall a. Context -&gt; TLSSt a -&gt; IO a
</span><a href="Network.TLS.Context.Internal.html#usingState_"><span class="hs-identifier hs-var">usingState_</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190964"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSt Role
</span><a href="Network.TLS.State.html#isClientContext"><span class="hs-identifier hs-var">isClientContext</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679190973"><span class="annot"><span class="annottext">ctxStr :: ByteString
</span><a href="#local-6989586621679190973"><span class="hs-identifier hs-var hs-var">ctxStr</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621679190968"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Network.TLS.Types.html#ClientRole"><span class="hs-identifier hs-var">ClientRole</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="Network.TLS.Handshake.Common13.html#clientContextString"><span class="hs-identifier hs-var">clientContextString</span></a></span><span>
</span><span id="line-146"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="Network.TLS.Handshake.Common13.html#serverContextString"><span class="hs-identifier hs-var">serverContextString</span></a></span><span>
</span><span id="line-147"></span><span>        </span><span id="local-6989586621679190975"><span class="annot"><span class="annottext">target :: ByteString
</span><a href="#local-6989586621679190975"><span class="hs-identifier hs-var hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.Handshake.Common13.html#makeTarget"><span class="hs-identifier hs-var">makeTarget</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190973"><span class="hs-identifier hs-var">ctxStr</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190967"><span class="hs-identifier hs-var">hashValue</span></a></span><span>
</span><span id="line-148"></span><span>    </span><span class="annot"><span class="annottext">HashAndSignatureAlgorithm -&gt; ByteString -&gt; Handshake13
</span><a href="Network.TLS.Struct13.html#CertVerify13"><span class="hs-identifier hs-var">CertVerify13</span></a></span><span> </span><span class="annot"><span class="annottext">HashAndSignatureAlgorithm
</span><a href="#local-6989586621679190966"><span class="hs-identifier hs-var">hs</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Handshake13) -&gt; m ByteString -&gt; m Handshake13
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Context
-&gt; PubKey
-&gt; HashAndSignatureAlgorithm
-&gt; ByteString
-&gt; m ByteString
forall (m :: * -&gt; *).
MonadIO m =&gt;
Context
-&gt; PubKey
-&gt; HashAndSignatureAlgorithm
-&gt; ByteString
-&gt; m ByteString
</span><a href="Network.TLS.Handshake.Common13.html#sign"><span class="hs-identifier hs-var">sign</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190964"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">PubKey
</span><a href="#local-6989586621679190965"><span class="hs-identifier hs-var">pub</span></a></span><span> </span><span class="annot"><span class="annottext">HashAndSignatureAlgorithm
</span><a href="#local-6989586621679190966"><span class="hs-identifier hs-var">hs</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190975"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span id="local-6989586621679190519"><span class="annot"><a href="Network.TLS.Handshake.Common13.html#checkCertVerify"><span class="hs-identifier hs-type">checkCertVerify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679190519"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PubKey</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Struct.html#HashAndSignatureAlgorithm"><span class="hs-identifier hs-type">HashAndSignatureAlgorithm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Struct.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679190519"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-151"></span><span id="checkCertVerify"><span class="annot"><span class="annottext">checkCertVerify :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Context
-&gt; PubKey
-&gt; HashAndSignatureAlgorithm
-&gt; ByteString
-&gt; ByteString
-&gt; m Bool
</span><a href="Network.TLS.Handshake.Common13.html#checkCertVerify"><span class="hs-identifier hs-var hs-var">checkCertVerify</span></a></span></span><span> </span><span id="local-6989586621679190987"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190987"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679190988"><span class="annot"><span class="annottext">PubKey
</span><a href="#local-6989586621679190988"><span class="hs-identifier hs-var">pub</span></a></span></span><span> </span><span id="local-6989586621679190989"><span class="annot"><span class="annottext">HashAndSignatureAlgorithm
</span><a href="#local-6989586621679190989"><span class="hs-identifier hs-var">hs</span></a></span></span><span> </span><span id="local-6989586621679190990"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190990"><span class="hs-keyword hs-var">signature</span></a></span></span><span> </span><span id="local-6989586621679190991"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190991"><span class="hs-identifier hs-var">hashValue</span></a></span></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PubKey
</span><a href="#local-6989586621679190988"><span class="hs-identifier hs-var">pub</span></a></span><span> </span><span class="annot"><span class="annottext">PubKey -&gt; HashAndSignatureAlgorithm -&gt; Bool
</span><a href="Network.TLS.Handshake.Signature.html#signatureCompatible13"><span class="hs-operator hs-var">`signatureCompatible13`</span></a></span><span> </span><span class="annot"><span class="annottext">HashAndSignatureAlgorithm
</span><a href="#local-6989586621679190989"><span class="hs-identifier hs-var">hs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; m Bool
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; m Bool) -&gt; IO Bool -&gt; m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-153"></span><span>        </span><span id="local-6989586621679190993"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621679190993"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; TLSSt Role -&gt; IO Role
forall a. Context -&gt; TLSSt a -&gt; IO a
</span><a href="Network.TLS.Context.Internal.html#usingState_"><span class="hs-identifier hs-var">usingState_</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190987"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSt Role
</span><a href="Network.TLS.State.html#isClientContext"><span class="hs-identifier hs-var">isClientContext</span></a></span><span>
</span><span id="line-154"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679190995"><span class="annot"><span class="annottext">ctxStr :: ByteString
</span><a href="#local-6989586621679190995"><span class="hs-identifier hs-var hs-var">ctxStr</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621679190993"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Network.TLS.Types.html#ClientRole"><span class="hs-identifier hs-var">ClientRole</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="Network.TLS.Handshake.Common13.html#serverContextString"><span class="hs-identifier hs-var">serverContextString</span></a></span><span> </span><span class="hs-comment">-- opposite context</span><span>
</span><span id="line-155"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="Network.TLS.Handshake.Common13.html#clientContextString"><span class="hs-identifier hs-var">clientContextString</span></a></span><span>
</span><span id="line-156"></span><span>            </span><span id="local-6989586621679190996"><span class="annot"><span class="annottext">target :: ByteString
</span><a href="#local-6989586621679190996"><span class="hs-identifier hs-var hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.Handshake.Common13.html#makeTarget"><span class="hs-identifier hs-var">makeTarget</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190995"><span class="hs-identifier hs-var">ctxStr</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190991"><span class="hs-identifier hs-var">hashValue</span></a></span><span>
</span><span id="line-157"></span><span>            </span><span id="local-6989586621679190997"><span class="annot"><span class="annottext">sigParams :: SignatureParams
</span><a href="#local-6989586621679190997"><span class="hs-identifier hs-var hs-var">sigParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PubKey -&gt; Maybe HashAndSignatureAlgorithm -&gt; SignatureParams
</span><a href="Network.TLS.Handshake.Signature.html#signatureParams"><span class="hs-identifier hs-var">signatureParams</span></a></span><span> </span><span class="annot"><span class="annottext">PubKey
</span><a href="#local-6989586621679190988"><span class="hs-identifier hs-var">pub</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashAndSignatureAlgorithm -&gt; Maybe HashAndSignatureAlgorithm
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">HashAndSignatureAlgorithm
</span><a href="#local-6989586621679190989"><span class="hs-identifier hs-var">hs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>        </span><span class="annot"><span class="annottext">HashAndSignatureAlgorithm -&gt; IO ()
</span><a href="Network.TLS.Handshake.Common13.html#checkHashSignatureValid13"><span class="hs-identifier hs-var">checkHashSignatureValid13</span></a></span><span> </span><span class="annot"><span class="annottext">HashAndSignatureAlgorithm
</span><a href="#local-6989586621679190989"><span class="hs-identifier hs-var">hs</span></a></span><span>
</span><span id="line-159"></span><span>        </span><span class="annot"><span class="annottext">Context -&gt; Maybe HashAndSignatureAlgorithm -&gt; IO ()
</span><a href="Network.TLS.Handshake.Signature.html#checkSupportedHashSignature"><span class="hs-identifier hs-var">checkSupportedHashSignature</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190987"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashAndSignatureAlgorithm -&gt; Maybe HashAndSignatureAlgorithm
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">HashAndSignatureAlgorithm
</span><a href="#local-6989586621679190989"><span class="hs-identifier hs-var">hs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>        </span><span class="annot"><span class="annottext">Context -&gt; SignatureParams -&gt; ByteString -&gt; ByteString -&gt; IO Bool
</span><a href="Network.TLS.Handshake.Key.html#verifyPublic"><span class="hs-identifier hs-var">verifyPublic</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190987"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">SignatureParams
</span><a href="#local-6989586621679190997"><span class="hs-identifier hs-var">sigParams</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190996"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679190990"><span class="hs-keyword hs-var">signature</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#makeTarget"><span class="hs-identifier hs-type">makeTarget</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-164"></span><span id="makeTarget"><span class="annot"><span class="annottext">makeTarget :: ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.Handshake.Common13.html#makeTarget"><span class="hs-identifier hs-var hs-var">makeTarget</span></a></span></span><span> </span><span id="local-6989586621679191002"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191002"><span class="hs-identifier hs-var">contextString</span></a></span></span><span> </span><span id="local-6989586621679191003"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191003"><span class="hs-identifier hs-var">hashValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Put -&gt; ByteString
</span><span class="hs-identifier hs-var">runPut</span></span><span> </span><span class="annot"><span class="annottext">(Put -&gt; ByteString) -&gt; Put -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; Put
</span><a href="Network.TLS.Wire.html#putBytes"><span class="hs-identifier hs-var">putBytes</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Put) -&gt; ByteString -&gt; Put
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; CompressionID -&gt; ByteString
</span><span class="hs-identifier hs-var">B.replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">64</span></span><span> </span><span class="annot"><span class="annottext">CompressionID
</span><span class="hs-number">32</span></span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; Put
</span><a href="Network.TLS.Wire.html#putBytes"><span class="hs-identifier hs-var">putBytes</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191002"><span class="hs-identifier hs-var">contextString</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><span class="annottext">Putter CompressionID
</span><span class="hs-identifier hs-var">putWord8</span></span><span> </span><span class="annot"><span class="annottext">CompressionID
</span><span class="hs-number">0</span></span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; Put
</span><a href="Network.TLS.Wire.html#putBytes"><span class="hs-identifier hs-var">putBytes</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191003"><span class="hs-identifier hs-var">hashValue</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span id="local-6989586621679190518"><span class="annot"><a href="Network.TLS.Handshake.Common13.html#sign"><span class="hs-identifier hs-type">sign</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679190518"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PubKey</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Struct.html#HashAndSignatureAlgorithm"><span class="hs-identifier hs-type">HashAndSignatureAlgorithm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679190518"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Struct.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span></span><span>
</span><span id="line-171"></span><span id="sign"><span class="annot"><span class="annottext">sign :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Context
-&gt; PubKey
-&gt; HashAndSignatureAlgorithm
-&gt; ByteString
-&gt; m ByteString
</span><a href="Network.TLS.Handshake.Common13.html#sign"><span class="hs-identifier hs-var hs-var">sign</span></a></span></span><span> </span><span id="local-6989586621679191011"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191011"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679191012"><span class="annot"><span class="annottext">PubKey
</span><a href="#local-6989586621679191012"><span class="hs-identifier hs-var">pub</span></a></span></span><span> </span><span id="local-6989586621679191013"><span class="annot"><span class="annottext">HashAndSignatureAlgorithm
</span><a href="#local-6989586621679191013"><span class="hs-identifier hs-var">hs</span></a></span></span><span> </span><span id="local-6989586621679191014"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191014"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ByteString -&gt; m ByteString
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; m ByteString) -&gt; IO ByteString -&gt; m ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-172"></span><span>    </span><span id="local-6989586621679191015"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621679191015"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; TLSSt Role -&gt; IO Role
forall a. Context -&gt; TLSSt a -&gt; IO a
</span><a href="Network.TLS.Context.Internal.html#usingState_"><span class="hs-identifier hs-var">usingState_</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191011"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSt Role
</span><a href="Network.TLS.State.html#isClientContext"><span class="hs-identifier hs-var">isClientContext</span></a></span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191016"><span class="annot"><span class="annottext">sigParams :: SignatureParams
</span><a href="#local-6989586621679191016"><span class="hs-identifier hs-var hs-var">sigParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PubKey -&gt; Maybe HashAndSignatureAlgorithm -&gt; SignatureParams
</span><a href="Network.TLS.Handshake.Signature.html#signatureParams"><span class="hs-identifier hs-var">signatureParams</span></a></span><span> </span><span class="annot"><span class="annottext">PubKey
</span><a href="#local-6989586621679191012"><span class="hs-identifier hs-var">pub</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashAndSignatureAlgorithm -&gt; Maybe HashAndSignatureAlgorithm
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">HashAndSignatureAlgorithm
</span><a href="#local-6989586621679191013"><span class="hs-identifier hs-var">hs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; Role -&gt; SignatureParams -&gt; ByteString -&gt; IO ByteString
</span><a href="Network.TLS.Handshake.Key.html#signPrivate"><span class="hs-identifier hs-var">signPrivate</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191011"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621679191015"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">SignatureParams
</span><a href="#local-6989586621679191016"><span class="hs-identifier hs-var">sigParams</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191014"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#makePSKBinder"><span class="hs-identifier hs-type">makePSKBinder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#BaseSecret"><span class="hs-identifier hs-type">BaseSecret</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#EarlySecret"><span class="hs-identifier hs-type">EarlySecret</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Crypto.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-179"></span><span id="makePSKBinder"><span class="annot"><span class="annottext">makePSKBinder :: Context
-&gt; BaseSecret EarlySecret
-&gt; Hash
-&gt; Int
-&gt; Maybe ByteString
-&gt; IO ByteString
</span><a href="Network.TLS.Handshake.Common13.html#makePSKBinder"><span class="hs-identifier hs-var hs-var">makePSKBinder</span></a></span></span><span> </span><span id="local-6989586621679191018"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191018"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Types.html#BaseSecret"><span class="hs-identifier hs-type">BaseSecret</span></a></span><span> </span><span id="local-6989586621679191020"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191020"><span class="hs-identifier hs-var">sec</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679191021"><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191021"><span class="hs-identifier hs-var">usedHash</span></a></span></span><span> </span><span id="local-6989586621679191022"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679191022"><span class="hs-identifier hs-var">truncLen</span></a></span></span><span> </span><span id="local-6989586621679191023"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679191023"><span class="hs-identifier hs-var">mch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-180"></span><span>    </span><span id="local-6989586621679191024"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679191024"><span class="hs-identifier hs-var">rmsgs0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; HandshakeM [ByteString] -&gt; IO [ByteString]
forall (m :: * -&gt; *) a. MonadIO m =&gt; Context -&gt; HandshakeM a -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#usingHState"><span class="hs-identifier hs-var">usingHState</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191018"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">HandshakeM [ByteString]
</span><a href="Network.TLS.Handshake.State.html#getHandshakeMessagesRev"><span class="hs-identifier hs-var">getHandshakeMessagesRev</span></a></span><span> </span><span class="hs-comment">-- fixme</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191031"><span class="annot"><span class="annottext">rmsgs :: [ByteString]
</span><a href="#local-6989586621679191031"><span class="hs-identifier hs-var hs-var">rmsgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679191023"><span class="hs-identifier hs-var">mch</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-182"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679191032"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191032"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="#local-6989586621679191033"><span class="hs-identifier hs-var">trunc</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191032"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679191024"><span class="hs-identifier hs-var">rmsgs0</span></a></span><span>
</span><span id="line-183"></span><span>          </span><span class="annot"><span class="annottext">Maybe ByteString
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="#local-6989586621679191033"><span class="hs-identifier hs-var">trunc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679191024"><span class="hs-identifier hs-var">rmsgs0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; [ByteString]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; [ByteString]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679191024"><span class="hs-identifier hs-var">rmsgs0</span></a></span><span>
</span><span id="line-184"></span><span>        </span><span id="local-6989586621679191036"><span class="annot"><span class="annottext">hChTruncated :: ByteString
</span><a href="#local-6989586621679191036"><span class="hs-identifier hs-var hs-var">hChTruncated</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.Crypto.html#hash"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191021"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B.concat</span></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; [ByteString]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679191031"><span class="hs-identifier hs-var">rmsgs</span></a></span><span>
</span><span id="line-185"></span><span>        </span><span id="local-6989586621679191042"><span class="annot"><span class="annottext">binderKey :: ByteString
</span><a href="#local-6989586621679191042"><span class="hs-identifier hs-var hs-var">binderKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.KeySchedule.html#deriveSecret"><span class="hs-identifier hs-var">deriveSecret</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191021"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191020"><span class="hs-identifier hs-var">sec</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;res binder&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.Crypto.html#hash"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191021"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ByteString) -&gt; ByteString -&gt; IO ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.Handshake.Common13.html#makeVerifyData"><span class="hs-identifier hs-var">makeVerifyData</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191021"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191042"><span class="hs-identifier hs-var">binderKey</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191036"><span class="hs-identifier hs-var">hChTruncated</span></a></span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-188"></span><span>    </span><span id="local-6989586621679191033"><span class="annot"><span class="annottext">trunc :: ByteString -&gt; ByteString
</span><a href="#local-6989586621679191033"><span class="hs-identifier hs-var hs-var">trunc</span></a></span></span><span> </span><span id="local-6989586621679191044"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191044"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">B.take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679191046"><span class="hs-identifier hs-var">takeLen</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191044"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-189"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-190"></span><span>        </span><span id="local-6989586621679191047"><span class="annot"><span class="annottext">totalLen :: Int
</span><a href="#local-6989586621679191047"><span class="hs-identifier hs-var hs-var">totalLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191044"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-191"></span><span>        </span><span id="local-6989586621679191046"><span class="annot"><span class="annottext">takeLen :: Int
</span><a href="#local-6989586621679191046"><span class="hs-identifier hs-var hs-var">takeLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679191047"><span class="hs-identifier hs-var">totalLen</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679191022"><span class="hs-identifier hs-var">truncLen</span></a></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#replacePSKBinder"><span class="hs-identifier hs-type">replacePSKBinder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-194"></span><span id="replacePSKBinder"><span class="annot"><span class="annottext">replacePSKBinder :: ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.Handshake.Common13.html#replacePSKBinder"><span class="hs-identifier hs-var hs-var">replacePSKBinder</span></a></span></span><span> </span><span id="local-6989586621679191050"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191050"><span class="hs-identifier hs-var">pskz</span></a></span></span><span> </span><span id="local-6989586621679191051"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191051"><span class="hs-identifier hs-var">binder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191052"><span class="hs-identifier hs-var">identities</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><span class="hs-operator hs-var">`B.append`</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191054"><span class="hs-identifier hs-var">binders</span></a></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621679191057"><span class="annot"><span class="annottext">bindersSize :: Int
</span><a href="#local-6989586621679191057"><span class="hs-identifier hs-var hs-var">bindersSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191051"><span class="hs-identifier hs-var">binder</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span>
</span><span id="line-197"></span><span>    </span><span id="local-6989586621679191052"><span class="annot"><span class="annottext">identities :: ByteString
</span><a href="#local-6989586621679191052"><span class="hs-identifier hs-var hs-var">identities</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">B.take</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191050"><span class="hs-identifier hs-var">pskz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679191057"><span class="hs-identifier hs-var">bindersSize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191050"><span class="hs-identifier hs-var">pskz</span></a></span><span>
</span><span id="line-198"></span><span>    </span><span id="local-6989586621679191054"><span class="annot"><span class="annottext">binders :: ByteString
</span><a href="#local-6989586621679191054"><span class="hs-identifier hs-var hs-var">binders</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Put -&gt; ByteString
</span><span class="hs-identifier hs-var">runPut</span></span><span> </span><span class="annot"><span class="annottext">(Put -&gt; ByteString) -&gt; Put -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Put
</span><a href="Network.TLS.Wire.html#putOpaque16"><span class="hs-identifier hs-var">putOpaque16</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Put) -&gt; ByteString -&gt; Put
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Put -&gt; ByteString
</span><span class="hs-identifier hs-var">runPut</span></span><span> </span><span class="annot"><span class="annottext">(Put -&gt; ByteString) -&gt; Put -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Put
</span><a href="Network.TLS.Wire.html#putOpaque8"><span class="hs-identifier hs-var">putOpaque8</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191051"><span class="hs-identifier hs-var">binder</span></a></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span id="local-6989586621679190534"><span class="annot"><a href="Network.TLS.Handshake.Common13.html#sendChangeCipherSpec13"><span class="hs-identifier hs-type">sendChangeCipherSpec13</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679190534"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.IO.html#PacketFlightM"><span class="hs-identifier hs-type">PacketFlightM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190534"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-203"></span><span id="sendChangeCipherSpec13"><span class="annot"><span class="annottext">sendChangeCipherSpec13 :: forall b. Monoid b =&gt; Context -&gt; PacketFlightM b ()
</span><a href="Network.TLS.Handshake.Common13.html#sendChangeCipherSpec13"><span class="hs-identifier hs-var hs-var">sendChangeCipherSpec13</span></a></span></span><span> </span><span id="local-6989586621679191076"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191076"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-204"></span><span>    </span><span id="local-6989586621679191077"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679191077"><span class="hs-identifier hs-var">sent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; HandshakeM Bool -&gt; PacketFlightM b Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; Context -&gt; HandshakeM a -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#usingHState"><span class="hs-identifier hs-var">usingHState</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191076"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(HandshakeM Bool -&gt; PacketFlightM b Bool)
-&gt; HandshakeM Bool -&gt; PacketFlightM b Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-205"></span><span>                </span><span id="local-6989586621679191078"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679191078"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HandshakeM Bool
</span><a href="Network.TLS.Handshake.State.html#getCCS13Sent"><span class="hs-identifier hs-var">getCCS13Sent</span></a></span><span>
</span><span id="line-206"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; HandshakeM () -&gt; HandshakeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679191078"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">(HandshakeM () -&gt; HandshakeM ()) -&gt; HandshakeM () -&gt; HandshakeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; HandshakeM ()
</span><a href="Network.TLS.Handshake.State.html#setCCS13Sent"><span class="hs-identifier hs-var">setCCS13Sent</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-207"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; HandshakeM Bool
forall a. a -&gt; HandshakeM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679191078"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; PacketFlightM b () -&gt; PacketFlightM b ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679191077"><span class="hs-identifier hs-var">sent</span></a></span><span> </span><span class="annot"><span class="annottext">(PacketFlightM b () -&gt; PacketFlightM b ())
-&gt; PacketFlightM b () -&gt; PacketFlightM b ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Packet13 -&gt; PacketFlightM b ()
forall b. Monoid b =&gt; Context -&gt; Packet13 -&gt; PacketFlightM b ()
</span><a href="Network.TLS.IO.html#loadPacket13"><span class="hs-identifier hs-var">loadPacket13</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191076"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Packet13
</span><a href="Network.TLS.Struct13.html#ChangeCipherSpec13"><span class="hs-identifier hs-var">ChangeCipherSpec13</span></a></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-comment">-- | TLS13 handshake wrap up &amp; clean up.  Contrary to @handshakeTerminate@, this</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- does not handle session, which is managed separately for TLS 1.3.  This does</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- not reset byte counters because renegotiation is not allowed.  And a few more</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- state attributes are preserved, necessary for TLS13 handshake modes, session</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- tickets and post-handshake authentication.</span><span>
</span><span id="line-217"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#handshakeTerminate13"><span class="hs-identifier hs-type">handshakeTerminate13</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span id="handshakeTerminate13"><span class="annot"><span class="annottext">handshakeTerminate13 :: Context -&gt; IO ()
</span><a href="Network.TLS.Handshake.Common13.html#handshakeTerminate13"><span class="hs-identifier hs-var hs-var">handshakeTerminate13</span></a></span></span><span> </span><span id="local-6989586621679191083"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191083"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-comment">-- forget most handshake data</span><span>
</span><span id="line-220"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe HandshakeState)
-&gt; (Maybe HandshakeState -&gt; IO (Maybe HandshakeState)) -&gt; IO ()
forall a. MVar a -&gt; (a -&gt; IO a) -&gt; IO ()
</span><span class="hs-identifier hs-var">modifyMVar_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; MVar (Maybe HandshakeState)
</span><a href="Network.TLS.Context.Internal.html#ctxHandshake"><span class="hs-identifier hs-var">ctxHandshake</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191083"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Maybe HandshakeState -&gt; IO (Maybe HandshakeState)) -&gt; IO ())
-&gt; (Maybe HandshakeState -&gt; IO (Maybe HandshakeState)) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679191086"><span class="annot"><span class="annottext">Maybe HandshakeState
</span><a href="#local-6989586621679191086"><span class="hs-identifier hs-var">mhshake</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-221"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe HandshakeState
</span><a href="#local-6989586621679191086"><span class="hs-identifier hs-var">mhshake</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-222"></span><span>            </span><span class="annot"><span class="annottext">Maybe HandshakeState
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe HandshakeState -&gt; IO (Maybe HandshakeState)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe HandshakeState
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-223"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679191087"><span class="annot"><span class="annottext">HandshakeState
</span><a href="#local-6989586621679191087"><span class="hs-identifier hs-var">hshake</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-224"></span><span>                </span><span class="annot"><span class="annottext">Maybe HandshakeState -&gt; IO (Maybe HandshakeState)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe HandshakeState -&gt; IO (Maybe HandshakeState))
-&gt; Maybe HandshakeState -&gt; IO (Maybe HandshakeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HandshakeState -&gt; Maybe HandshakeState
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; ClientRandom -&gt; HandshakeState
</span><a href="Network.TLS.Handshake.State.html#newEmptyHandshake"><span class="hs-identifier hs-var">newEmptyHandshake</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HandshakeState -&gt; Version
</span><a href="Network.TLS.Handshake.State.html#hstClientVersion"><span class="hs-identifier hs-var">hstClientVersion</span></a></span><span> </span><span class="annot"><span class="annottext">HandshakeState
</span><a href="#local-6989586621679191087"><span class="hs-identifier hs-var">hshake</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HandshakeState -&gt; ClientRandom
</span><a href="Network.TLS.Handshake.State.html#hstClientRandom"><span class="hs-identifier hs-var">hstClientRandom</span></a></span><span> </span><span class="annot"><span class="annottext">HandshakeState
</span><a href="#local-6989586621679191087"><span class="hs-identifier hs-var">hshake</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstServerRandom"><span class="hs-identifier hs-var">hstServerRandom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstServerRandom"><span class="hs-identifier hs-var">hstServerRandom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191087"><span class="hs-identifier hs-type">hshake</span></a></span><span>
</span><span id="line-226"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstMasterSecret"><span class="hs-identifier hs-var">hstMasterSecret</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstMasterSecret"><span class="hs-identifier hs-var">hstMasterSecret</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191087"><span class="hs-identifier hs-type">hshake</span></a></span><span>
</span><span id="line-227"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstNegotiatedGroup"><span class="hs-identifier hs-var">hstNegotiatedGroup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstNegotiatedGroup"><span class="hs-identifier hs-var">hstNegotiatedGroup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191087"><span class="hs-identifier hs-type">hshake</span></a></span><span>
</span><span id="line-228"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstHandshakeDigest"><span class="hs-identifier hs-var">hstHandshakeDigest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstHandshakeDigest"><span class="hs-identifier hs-var">hstHandshakeDigest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191087"><span class="hs-identifier hs-type">hshake</span></a></span><span>
</span><span id="line-229"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstTLS13HandshakeMode"><span class="hs-identifier hs-var">hstTLS13HandshakeMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstTLS13HandshakeMode"><span class="hs-identifier hs-var">hstTLS13HandshakeMode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191087"><span class="hs-identifier hs-type">hshake</span></a></span><span>
</span><span id="line-230"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstTLS13RTT0Status"><span class="hs-identifier hs-var">hstTLS13RTT0Status</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstTLS13RTT0Status"><span class="hs-identifier hs-var">hstTLS13RTT0Status</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191087"><span class="hs-identifier hs-type">hshake</span></a></span><span>
</span><span id="line-231"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstTLS13ResumptionSecret"><span class="hs-identifier hs-var">hstTLS13ResumptionSecret</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstTLS13ResumptionSecret"><span class="hs-identifier hs-var">hstTLS13ResumptionSecret</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191087"><span class="hs-identifier hs-type">hshake</span></a></span><span>
</span><span id="line-232"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-comment">-- forget handshake data stored in TLS state</span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; TLSSt () -&gt; IO ()
forall a. Context -&gt; TLSSt a -&gt; IO a
</span><a href="Network.TLS.Context.Internal.html#usingState_"><span class="hs-identifier hs-var">usingState_</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191083"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(TLSSt () -&gt; IO ()) -&gt; TLSSt () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-235"></span><span>        </span><span class="annot"><span class="annottext">Maybe KeyShare -&gt; TLSSt ()
</span><a href="Network.TLS.State.html#setTLS13KeyShare"><span class="hs-identifier hs-var">setTLS13KeyShare</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe KeyShare
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-236"></span><span>        </span><span class="annot"><span class="annottext">Maybe PreSharedKey -&gt; TLSSt ()
</span><a href="Network.TLS.State.html#setTLS13PreSharedKey"><span class="hs-identifier hs-var">setTLS13PreSharedKey</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PreSharedKey
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-comment">-- mark the secure connection up and running.</span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; Established -&gt; IO ()
</span><a href="Network.TLS.Context.Internal.html#setEstablished"><span class="hs-identifier hs-var">setEstablished</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191083"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Established
</span><a href="Network.TLS.Context.Internal.html#Established"><span class="hs-identifier hs-var">Established</span></a></span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#makeCertRequest"><span class="hs-identifier hs-type">makeCertRequest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Parameters.html#ServerParams"><span class="hs-identifier hs-type">ServerParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#CertReqContext"><span class="hs-identifier hs-type">CertReqContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Struct13.html#Handshake13"><span class="hs-identifier hs-type">Handshake13</span></a></span><span>
</span><span id="line-243"></span><span id="makeCertRequest"><span class="annot"><span class="annottext">makeCertRequest :: ServerParams -&gt; Context -&gt; ByteString -&gt; Handshake13
</span><a href="Network.TLS.Handshake.Common13.html#makeCertRequest"><span class="hs-identifier hs-var hs-var">makeCertRequest</span></a></span></span><span> </span><span id="local-6989586621679191103"><span class="annot"><span class="annottext">ServerParams
</span><a href="#local-6989586621679191103"><span class="hs-identifier hs-var">sparams</span></a></span></span><span> </span><span id="local-6989586621679191104"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191104"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679191105"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191105"><span class="hs-identifier hs-var">certReqCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191108"><span class="annot"><span class="annottext">sigAlgs :: ByteString
</span><a href="#local-6989586621679191108"><span class="hs-identifier hs-var hs-var">sigAlgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SignatureAlgorithms -&gt; ByteString
forall a. Extension a =&gt; a -&gt; ByteString
</span><a href="Network.TLS.Extension.html#extensionEncode"><span class="hs-identifier hs-var">extensionEncode</span></a></span><span> </span><span class="annot"><span class="annottext">(SignatureAlgorithms -&gt; ByteString)
-&gt; SignatureAlgorithms -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[HashAndSignatureAlgorithm] -&gt; SignatureAlgorithms
</span><a href="Network.TLS.Extension.html#SignatureAlgorithms"><span class="hs-identifier hs-var">SignatureAlgorithms</span></a></span><span> </span><span class="annot"><span class="annottext">([HashAndSignatureAlgorithm] -&gt; SignatureAlgorithms)
-&gt; [HashAndSignatureAlgorithm] -&gt; SignatureAlgorithms
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Supported -&gt; [HashAndSignatureAlgorithm]
</span><a href="Network.TLS.Parameters.html#supportedHashSignatures"><span class="hs-identifier hs-var">supportedHashSignatures</span></a></span><span> </span><span class="annot"><span class="annottext">(Supported -&gt; [HashAndSignatureAlgorithm])
-&gt; Supported -&gt; [HashAndSignatureAlgorithm]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Supported
</span><a href="Network.TLS.Context.Internal.html#ctxSupported"><span class="hs-identifier hs-var">ctxSupported</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191104"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-245"></span><span>        </span><span id="local-6989586621679191113"><span class="annot"><span class="annottext">caDns :: [DistinguishedName]
</span><a href="#local-6989586621679191113"><span class="hs-identifier hs-var hs-var">caDns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SignedCertificate -&gt; DistinguishedName)
-&gt; [SignedCertificate] -&gt; [DistinguishedName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">SignedCertificate -&gt; DistinguishedName
</span><a href="Network.TLS.Handshake.Certificate.html#extractCAname"><span class="hs-identifier hs-var">extractCAname</span></a></span><span> </span><span class="annot"><span class="annottext">([SignedCertificate] -&gt; [DistinguishedName])
-&gt; [SignedCertificate] -&gt; [DistinguishedName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerParams -&gt; [SignedCertificate]
</span><a href="Network.TLS.Parameters.html#serverCACertificates"><span class="hs-identifier hs-var">serverCACertificates</span></a></span><span> </span><span class="annot"><span class="annottext">ServerParams
</span><a href="#local-6989586621679191103"><span class="hs-identifier hs-var">sparams</span></a></span><span>
</span><span id="line-246"></span><span>        </span><span id="local-6989586621679191117"><span class="annot"><span class="annottext">caDnsEncoded :: ByteString
</span><a href="#local-6989586621679191117"><span class="hs-identifier hs-var hs-var">caDnsEncoded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CertificateAuthorities -&gt; ByteString
forall a. Extension a =&gt; a -&gt; ByteString
</span><a href="Network.TLS.Extension.html#extensionEncode"><span class="hs-identifier hs-var">extensionEncode</span></a></span><span> </span><span class="annot"><span class="annottext">(CertificateAuthorities -&gt; ByteString)
-&gt; CertificateAuthorities -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[DistinguishedName] -&gt; CertificateAuthorities
</span><a href="Network.TLS.Extension.html#CertificateAuthorities"><span class="hs-identifier hs-var">CertificateAuthorities</span></a></span><span> </span><span class="annot"><span class="annottext">[DistinguishedName]
</span><a href="#local-6989586621679191113"><span class="hs-identifier hs-var">caDns</span></a></span><span>
</span><span id="line-247"></span><span>        </span><span id="local-6989586621679191120"><span class="annot"><span class="annottext">caExtension :: [ExtensionRaw]
</span><a href="#local-6989586621679191120"><span class="hs-identifier hs-var hs-var">caExtension</span></a></span></span><span>
</span><span id="line-248"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[DistinguishedName] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[DistinguishedName]
</span><a href="#local-6989586621679191113"><span class="hs-identifier hs-var">caDns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-249"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ExtensionID -&gt; ByteString -&gt; ExtensionRaw
</span><a href="Network.TLS.Struct.html#ExtensionRaw"><span class="hs-identifier hs-var">ExtensionRaw</span></a></span><span> </span><span class="annot"><span class="annottext">ExtensionID
</span><a href="Network.TLS.Extension.html#extensionID_CertificateAuthorities"><span class="hs-identifier hs-var">extensionID_CertificateAuthorities</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191117"><span class="hs-identifier hs-var">caDnsEncoded</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-250"></span><span>        </span><span id="local-6989586621679191124"><span class="annot"><span class="annottext">crexts :: [ExtensionRaw]
</span><a href="#local-6989586621679191124"><span class="hs-identifier hs-var hs-var">crexts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExtensionID -&gt; ByteString -&gt; ExtensionRaw
</span><a href="Network.TLS.Struct.html#ExtensionRaw"><span class="hs-identifier hs-var">ExtensionRaw</span></a></span><span> </span><span class="annot"><span class="annottext">ExtensionID
</span><a href="Network.TLS.Extension.html#extensionID_SignatureAlgorithms"><span class="hs-identifier hs-var">extensionID_SignatureAlgorithms</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191108"><span class="hs-identifier hs-var">sigAlgs</span></a></span><span> </span><span class="annot"><span class="annottext">ExtensionRaw -&gt; [ExtensionRaw] -&gt; [ExtensionRaw]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ExtensionRaw]
</span><a href="#local-6989586621679191120"><span class="hs-identifier hs-var">caExtension</span></a></span><span>
</span><span id="line-251"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ExtensionRaw] -&gt; Handshake13
</span><a href="Network.TLS.Struct13.html#CertRequest13"><span class="hs-identifier hs-var">CertRequest13</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191105"><span class="hs-identifier hs-var">certReqCtx</span></a></span><span> </span><span class="annot"><span class="annottext">[ExtensionRaw]
</span><a href="#local-6989586621679191124"><span class="hs-identifier hs-var">crexts</span></a></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#createTLS13TicketInfo"><span class="hs-identifier hs-type">createTLS13TicketInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#Second"><span class="hs-identifier hs-type">Second</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#Second"><span class="hs-identifier hs-type">Second</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#Millisecond"><span class="hs-identifier hs-type">Millisecond</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#TLS13TicketInfo"><span class="hs-identifier hs-type">TLS13TicketInfo</span></a></span><span>
</span><span id="line-256"></span><span id="createTLS13TicketInfo"><span class="annot"><span class="annottext">createTLS13TicketInfo :: Second
-&gt; Either Context Second -&gt; Maybe Millisecond -&gt; IO TLS13TicketInfo
</span><a href="Network.TLS.Handshake.Common13.html#createTLS13TicketInfo"><span class="hs-identifier hs-var hs-var">createTLS13TicketInfo</span></a></span></span><span> </span><span id="local-6989586621679191127"><span class="annot"><span class="annottext">Second
</span><a href="#local-6989586621679191127"><span class="hs-identifier hs-var">life</span></a></span></span><span> </span><span id="local-6989586621679191128"><span class="annot"><span class="annottext">Either Context Second
</span><a href="#local-6989586621679191128"><span class="hs-identifier hs-var">ecw</span></a></span></span><span> </span><span id="local-6989586621679191129"><span class="annot"><span class="annottext">Maybe Millisecond
</span><a href="#local-6989586621679191129"><span class="hs-identifier hs-var">mrtt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-comment">-- Left:  serverSendTime</span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-comment">-- Right: clientReceiveTime</span><span>
</span><span id="line-259"></span><span>    </span><span id="local-6989586621679191130"><span class="annot"><span class="annottext">Millisecond
</span><a href="#local-6989586621679191130"><span class="hs-identifier hs-var">bTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Millisecond
</span><a href="Network.TLS.Handshake.Common13.html#getCurrentTimeFromBase"><span class="hs-identifier hs-var">getCurrentTimeFromBase</span></a></span><span>
</span><span id="line-260"></span><span>    </span><span id="local-6989586621679191131"><span class="annot"><span class="annottext">Second
</span><a href="#local-6989586621679191131"><span class="hs-identifier hs-var">add</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either Context Second
</span><a href="#local-6989586621679191128"><span class="hs-identifier hs-var">ecw</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-261"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679191132"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191132"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Second -&gt; CompressionID -&gt; Second)
-&gt; Second -&gt; ByteString -&gt; Second
forall a. (a -&gt; CompressionID -&gt; a) -&gt; a -&gt; ByteString -&gt; a
</span><span class="hs-identifier hs-var">B.foldl'</span></span><span> </span><span class="annot"><span class="annottext">Second -&gt; CompressionID -&gt; Second
forall {a} {a}. (Integral a, Num a) =&gt; a -&gt; a -&gt; a
</span><a href="#local-6989586621679191134"><span class="hs-operator hs-var">(*+)</span></a></span><span> </span><span class="annot"><span class="annottext">Second
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Second) -&gt; IO ByteString -&gt; IO Second
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Int -&gt; IO ByteString
</span><a href="Network.TLS.Context.Internal.html#getStateRNG"><span class="hs-identifier hs-var">getStateRNG</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191132"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span>
</span><span id="line-262"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679191136"><span class="annot"><span class="annottext">Second
</span><a href="#local-6989586621679191136"><span class="hs-identifier hs-var">ad</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Second -&gt; IO Second
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Second
</span><a href="#local-6989586621679191136"><span class="hs-identifier hs-var">ad</span></a></span><span>
</span><span id="line-263"></span><span>    </span><span class="annot"><span class="annottext">TLS13TicketInfo -&gt; IO TLS13TicketInfo
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(TLS13TicketInfo -&gt; IO TLS13TicketInfo)
-&gt; TLS13TicketInfo -&gt; IO TLS13TicketInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Second
-&gt; Second -&gt; Millisecond -&gt; Maybe Millisecond -&gt; TLS13TicketInfo
</span><a href="Network.TLS.Types.html#TLS13TicketInfo"><span class="hs-identifier hs-var">TLS13TicketInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Second
</span><a href="#local-6989586621679191127"><span class="hs-identifier hs-var">life</span></a></span><span> </span><span class="annot"><span class="annottext">Second
</span><a href="#local-6989586621679191131"><span class="hs-identifier hs-var">add</span></a></span><span> </span><span class="annot"><span class="annottext">Millisecond
</span><a href="#local-6989586621679191130"><span class="hs-identifier hs-var">bTime</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Millisecond
</span><a href="#local-6989586621679191129"><span class="hs-identifier hs-var">mrtt</span></a></span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-265"></span><span>    </span><span id="local-6989586621679191160"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679191160"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679191134"><span class="annot"><span class="annottext">*+ :: a -&gt; a -&gt; a
</span><a href="#local-6989586621679191134"><span class="hs-operator hs-var hs-var">*+</span></a></span></span><span> </span><span id="local-6989586621679191161"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679191161"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679191160"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">256</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679191161"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#ageToObfuscatedAge"><span class="hs-identifier hs-type">ageToObfuscatedAge</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#Second"><span class="hs-identifier hs-type">Second</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#TLS13TicketInfo"><span class="hs-identifier hs-type">TLS13TicketInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#Second"><span class="hs-identifier hs-type">Second</span></a></span><span>
</span><span id="line-268"></span><span id="ageToObfuscatedAge"><span class="annot"><span class="annottext">ageToObfuscatedAge :: Second -&gt; TLS13TicketInfo -&gt; Second
</span><a href="Network.TLS.Handshake.Common13.html#ageToObfuscatedAge"><span class="hs-identifier hs-var hs-var">ageToObfuscatedAge</span></a></span></span><span> </span><span id="local-6989586621679191163"><span class="annot"><span class="annottext">Second
</span><a href="#local-6989586621679191163"><span class="hs-identifier hs-var">age</span></a></span></span><span> </span><span id="local-6989586621679191164"><span class="annot"><span class="annottext">TLS13TicketInfo
</span><a href="#local-6989586621679191164"><span class="hs-identifier hs-var">tinfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Second
</span><a href="#local-6989586621679191165"><span class="hs-identifier hs-var">obfage</span></a></span><span>
</span><span id="line-269"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679191165"><span class="annot"><span class="annottext">obfage :: Second
</span><a href="#local-6989586621679191165"><span class="hs-identifier hs-var hs-var">obfage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Second
</span><a href="#local-6989586621679191163"><span class="hs-identifier hs-var">age</span></a></span><span> </span><span class="annot"><span class="annottext">Second -&gt; Second -&gt; Second
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">TLS13TicketInfo -&gt; Second
</span><a href="Network.TLS.Types.html#ageAdd"><span class="hs-identifier hs-var">ageAdd</span></a></span><span> </span><span class="annot"><span class="annottext">TLS13TicketInfo
</span><a href="#local-6989586621679191164"><span class="hs-identifier hs-var">tinfo</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#obfuscatedAgeToAge"><span class="hs-identifier hs-type">obfuscatedAgeToAge</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#Second"><span class="hs-identifier hs-type">Second</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#TLS13TicketInfo"><span class="hs-identifier hs-type">TLS13TicketInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#Second"><span class="hs-identifier hs-type">Second</span></a></span><span>
</span><span id="line-273"></span><span id="obfuscatedAgeToAge"><span class="annot"><span class="annottext">obfuscatedAgeToAge :: Second -&gt; TLS13TicketInfo -&gt; Second
</span><a href="Network.TLS.Handshake.Common13.html#obfuscatedAgeToAge"><span class="hs-identifier hs-var hs-var">obfuscatedAgeToAge</span></a></span></span><span> </span><span id="local-6989586621679191169"><span class="annot"><span class="annottext">Second
</span><a href="#local-6989586621679191169"><span class="hs-identifier hs-var">obfage</span></a></span></span><span> </span><span id="local-6989586621679191170"><span class="annot"><span class="annottext">TLS13TicketInfo
</span><a href="#local-6989586621679191170"><span class="hs-identifier hs-var">tinfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Second
</span><a href="#local-6989586621679191171"><span class="hs-identifier hs-var">age</span></a></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679191171"><span class="annot"><span class="annottext">age :: Second
</span><a href="#local-6989586621679191171"><span class="hs-identifier hs-var hs-var">age</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Second
</span><a href="#local-6989586621679191169"><span class="hs-identifier hs-var">obfage</span></a></span><span> </span><span class="annot"><span class="annottext">Second -&gt; Second -&gt; Second
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">TLS13TicketInfo -&gt; Second
</span><a href="Network.TLS.Types.html#ageAdd"><span class="hs-identifier hs-var">ageAdd</span></a></span><span> </span><span class="annot"><span class="annottext">TLS13TicketInfo
</span><a href="#local-6989586621679191170"><span class="hs-identifier hs-var">tinfo</span></a></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#isAgeValid"><span class="hs-identifier hs-type">isAgeValid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#Second"><span class="hs-identifier hs-type">Second</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#TLS13TicketInfo"><span class="hs-identifier hs-type">TLS13TicketInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-278"></span><span id="isAgeValid"><span class="annot"><span class="annottext">isAgeValid :: Second -&gt; TLS13TicketInfo -&gt; Bool
</span><a href="Network.TLS.Handshake.Common13.html#isAgeValid"><span class="hs-identifier hs-var hs-var">isAgeValid</span></a></span></span><span> </span><span id="local-6989586621679191173"><span class="annot"><span class="annottext">Second
</span><a href="#local-6989586621679191173"><span class="hs-identifier hs-var">age</span></a></span></span><span> </span><span id="local-6989586621679191174"><span class="annot"><span class="annottext">TLS13TicketInfo
</span><a href="#local-6989586621679191174"><span class="hs-identifier hs-var">tinfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Second
</span><a href="#local-6989586621679191173"><span class="hs-identifier hs-var">age</span></a></span><span> </span><span class="annot"><span class="annottext">Second -&gt; Second -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">TLS13TicketInfo -&gt; Second
</span><a href="Network.TLS.Types.html#lifetime"><span class="hs-identifier hs-var">lifetime</span></a></span><span> </span><span class="annot"><span class="annottext">TLS13TicketInfo
</span><a href="#local-6989586621679191174"><span class="hs-identifier hs-var">tinfo</span></a></span><span> </span><span class="annot"><span class="annottext">Second -&gt; Second -&gt; Second
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Second
</span><span class="hs-number">1000</span></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#getAge"><span class="hs-identifier hs-type">getAge</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#TLS13TicketInfo"><span class="hs-identifier hs-type">TLS13TicketInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#Second"><span class="hs-identifier hs-type">Second</span></a></span><span>
</span><span id="line-281"></span><span id="getAge"><span class="annot"><span class="annottext">getAge :: TLS13TicketInfo -&gt; IO Second
</span><a href="Network.TLS.Handshake.Common13.html#getAge"><span class="hs-identifier hs-var hs-var">getAge</span></a></span></span><span> </span><span id="local-6989586621679191177"><span class="annot"><span class="annottext">TLS13TicketInfo
</span><a href="#local-6989586621679191177"><span class="hs-identifier hs-var">tinfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191178"><span class="annot"><span class="annottext">clientReceiveTime :: Millisecond
</span><a href="#local-6989586621679191178"><span class="hs-identifier hs-var hs-var">clientReceiveTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLS13TicketInfo -&gt; Millisecond
</span><a href="Network.TLS.Types.html#txrxTime"><span class="hs-identifier hs-var">txrxTime</span></a></span><span> </span><span class="annot"><span class="annottext">TLS13TicketInfo
</span><a href="#local-6989586621679191177"><span class="hs-identifier hs-var">tinfo</span></a></span><span>
</span><span id="line-283"></span><span>    </span><span id="local-6989586621679191180"><span class="annot"><span class="annottext">Millisecond
</span><a href="#local-6989586621679191180"><span class="hs-identifier hs-var">clientSendTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Millisecond
</span><a href="Network.TLS.Handshake.Common13.html#getCurrentTimeFromBase"><span class="hs-identifier hs-var">getCurrentTimeFromBase</span></a></span><span>
</span><span id="line-284"></span><span>    </span><span class="annot"><span class="annottext">Second -&gt; IO Second
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Second -&gt; IO Second) -&gt; Second -&gt; IO Second
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Millisecond -&gt; Second
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Millisecond
</span><a href="#local-6989586621679191180"><span class="hs-identifier hs-var">clientSendTime</span></a></span><span> </span><span class="annot"><span class="annottext">Millisecond -&gt; Millisecond -&gt; Millisecond
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Millisecond
</span><a href="#local-6989586621679191178"><span class="hs-identifier hs-var">clientReceiveTime</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- milliseconds</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#checkFreshness"><span class="hs-identifier hs-type">checkFreshness</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#TLS13TicketInfo"><span class="hs-identifier hs-type">TLS13TicketInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#Second"><span class="hs-identifier hs-type">Second</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-287"></span><span id="checkFreshness"><span class="annot"><span class="annottext">checkFreshness :: TLS13TicketInfo -&gt; Second -&gt; IO Bool
</span><a href="Network.TLS.Handshake.Common13.html#checkFreshness"><span class="hs-identifier hs-var hs-var">checkFreshness</span></a></span></span><span> </span><span id="local-6989586621679191182"><span class="annot"><span class="annottext">TLS13TicketInfo
</span><a href="#local-6989586621679191182"><span class="hs-identifier hs-var">tinfo</span></a></span></span><span> </span><span id="local-6989586621679191183"><span class="annot"><span class="annottext">Second
</span><a href="#local-6989586621679191183"><span class="hs-identifier hs-var">obfAge</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-288"></span><span>    </span><span id="local-6989586621679191184"><span class="annot"><span class="annottext">Millisecond
</span><a href="#local-6989586621679191184"><span class="hs-identifier hs-var">serverReceiveTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Millisecond
</span><a href="Network.TLS.Handshake.Common13.html#getCurrentTimeFromBase"><span class="hs-identifier hs-var">getCurrentTimeFromBase</span></a></span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191189"><span class="annot"><span class="annottext">freshness :: Millisecond
</span><a href="#local-6989586621679191189"><span class="hs-identifier hs-var hs-var">freshness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Millisecond
</span><a href="#local-6989586621679191190"><span class="hs-identifier hs-var">expectedArrivalTime</span></a></span><span> </span><span class="annot"><span class="annottext">Millisecond -&gt; Millisecond -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Millisecond
</span><a href="#local-6989586621679191184"><span class="hs-identifier hs-var">serverReceiveTime</span></a></span><span>
</span><span id="line-290"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Millisecond
</span><a href="#local-6989586621679191190"><span class="hs-identifier hs-var">expectedArrivalTime</span></a></span><span> </span><span class="annot"><span class="annottext">Millisecond -&gt; Millisecond -&gt; Millisecond
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Millisecond
</span><a href="#local-6989586621679191184"><span class="hs-identifier hs-var">serverReceiveTime</span></a></span><span>
</span><span id="line-291"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Millisecond
</span><a href="#local-6989586621679191184"><span class="hs-identifier hs-var">serverReceiveTime</span></a></span><span> </span><span class="annot"><span class="annottext">Millisecond -&gt; Millisecond -&gt; Millisecond
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Millisecond
</span><a href="#local-6989586621679191190"><span class="hs-identifier hs-var">expectedArrivalTime</span></a></span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-comment">-- Some implementations round age up to second.</span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-comment">-- We take max of 2000 and rtt in the case where rtt is too small.</span><span>
</span><span id="line-294"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191194"><span class="annot"><span class="annottext">tolerance :: Millisecond
</span><a href="#local-6989586621679191194"><span class="hs-identifier hs-var hs-var">tolerance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Millisecond -&gt; Millisecond -&gt; Millisecond
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">Millisecond
</span><span class="hs-number">2000</span></span><span> </span><span class="annot"><span class="annottext">Millisecond
</span><a href="#local-6989586621679191196"><span class="hs-identifier hs-var">rtt</span></a></span><span>
</span><span id="line-295"></span><span>        </span><span id="local-6989586621679191198"><span class="annot"><span class="annottext">isFresh :: Bool
</span><a href="#local-6989586621679191198"><span class="hs-identifier hs-var hs-var">isFresh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Millisecond
</span><a href="#local-6989586621679191189"><span class="hs-identifier hs-var">freshness</span></a></span><span> </span><span class="annot"><span class="annottext">Millisecond -&gt; Millisecond -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Millisecond
</span><a href="#local-6989586621679191194"><span class="hs-identifier hs-var">tolerance</span></a></span><span>
</span><span id="line-296"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; IO Bool) -&gt; Bool -&gt; IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679191200"><span class="hs-identifier hs-var">isAlive</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679191198"><span class="hs-identifier hs-var">isFresh</span></a></span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-298"></span><span>    </span><span id="local-6989586621679191202"><span class="annot"><span class="annottext">serverSendTime :: Millisecond
</span><a href="#local-6989586621679191202"><span class="hs-identifier hs-var hs-var">serverSendTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLS13TicketInfo -&gt; Millisecond
</span><a href="Network.TLS.Types.html#txrxTime"><span class="hs-identifier hs-var">txrxTime</span></a></span><span> </span><span class="annot"><span class="annottext">TLS13TicketInfo
</span><a href="#local-6989586621679191182"><span class="hs-identifier hs-var">tinfo</span></a></span><span>
</span><span id="line-299"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679191196"><span class="annot"><span class="annottext">Millisecond
</span><a href="#local-6989586621679191196"><span class="hs-identifier hs-var">rtt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLS13TicketInfo -&gt; Maybe Millisecond
</span><a href="Network.TLS.Types.html#estimatedRTT"><span class="hs-identifier hs-var">estimatedRTT</span></a></span><span> </span><span class="annot"><span class="annottext">TLS13TicketInfo
</span><a href="#local-6989586621679191182"><span class="hs-identifier hs-var">tinfo</span></a></span><span>
</span><span id="line-300"></span><span>    </span><span id="local-6989586621679191204"><span class="annot"><span class="annottext">age :: Second
</span><a href="#local-6989586621679191204"><span class="hs-identifier hs-var hs-var">age</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Second -&gt; TLS13TicketInfo -&gt; Second
</span><a href="Network.TLS.Handshake.Common13.html#obfuscatedAgeToAge"><span class="hs-identifier hs-var">obfuscatedAgeToAge</span></a></span><span> </span><span class="annot"><span class="annottext">Second
</span><a href="#local-6989586621679191183"><span class="hs-identifier hs-var">obfAge</span></a></span><span> </span><span class="annot"><span class="annottext">TLS13TicketInfo
</span><a href="#local-6989586621679191182"><span class="hs-identifier hs-var">tinfo</span></a></span><span>
</span><span id="line-301"></span><span>    </span><span id="local-6989586621679191190"><span class="annot"><span class="annottext">expectedArrivalTime :: Millisecond
</span><a href="#local-6989586621679191190"><span class="hs-identifier hs-var hs-var">expectedArrivalTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Millisecond
</span><a href="#local-6989586621679191202"><span class="hs-identifier hs-var">serverSendTime</span></a></span><span> </span><span class="annot"><span class="annottext">Millisecond -&gt; Millisecond -&gt; Millisecond
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Millisecond
</span><a href="#local-6989586621679191196"><span class="hs-identifier hs-var">rtt</span></a></span><span> </span><span class="annot"><span class="annottext">Millisecond -&gt; Millisecond -&gt; Millisecond
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Second -&gt; Millisecond
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Second
</span><a href="#local-6989586621679191204"><span class="hs-identifier hs-var">age</span></a></span><span>
</span><span id="line-302"></span><span>    </span><span id="local-6989586621679191200"><span class="annot"><span class="annottext">isAlive :: Bool
</span><a href="#local-6989586621679191200"><span class="hs-identifier hs-var hs-var">isAlive</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Second -&gt; TLS13TicketInfo -&gt; Bool
</span><a href="Network.TLS.Handshake.Common13.html#isAgeValid"><span class="hs-identifier hs-var">isAgeValid</span></a></span><span> </span><span class="annot"><span class="annottext">Second
</span><a href="#local-6989586621679191204"><span class="hs-identifier hs-var">age</span></a></span><span> </span><span class="annot"><span class="annottext">TLS13TicketInfo
</span><a href="#local-6989586621679191182"><span class="hs-identifier hs-var">tinfo</span></a></span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#getCurrentTimeFromBase"><span class="hs-identifier hs-type">getCurrentTimeFromBase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#Millisecond"><span class="hs-identifier hs-type">Millisecond</span></a></span><span>
</span><span id="line-305"></span><span id="getCurrentTimeFromBase"><span class="annot"><span class="annottext">getCurrentTimeFromBase :: IO Millisecond
</span><a href="Network.TLS.Handshake.Common13.html#getCurrentTimeFromBase"><span class="hs-identifier hs-var hs-var">getCurrentTimeFromBase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnixTime -&gt; Millisecond
</span><a href="Network.TLS.Handshake.Common13.html#millisecondsFromBase"><span class="hs-identifier hs-var">millisecondsFromBase</span></a></span><span> </span><span class="annot"><span class="annottext">(UnixTime -&gt; Millisecond) -&gt; IO UnixTime -&gt; IO Millisecond
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO UnixTime
</span><span class="hs-identifier hs-var">getUnixTime</span></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#millisecondsFromBase"><span class="hs-identifier hs-type">millisecondsFromBase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UnixTime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#Millisecond"><span class="hs-identifier hs-type">Millisecond</span></a></span><span>
</span><span id="line-308"></span><span id="millisecondsFromBase"><span class="annot"><span class="annottext">millisecondsFromBase :: UnixTime -&gt; Millisecond
</span><a href="Network.TLS.Handshake.Common13.html#millisecondsFromBase"><span class="hs-identifier hs-var hs-var">millisecondsFromBase</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UnixTime</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">CTime</span></span><span> </span><span id="local-6989586621679191214"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679191214"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679191215"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679191215"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-309"></span><span>    </span><span class="annot"><span class="annottext">Int64 -&gt; Millisecond
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679191214"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Int64 -&gt; Int64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679191216"><span class="hs-identifier hs-var">base</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Int64 -&gt; Int64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">1000</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Millisecond -&gt; Millisecond -&gt; Millisecond
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; Millisecond
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679191215"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; Int32 -&gt; Int32
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><span class="hs-number">1000</span></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-311"></span><span>    </span><span id="local-6989586621679191216"><span class="annot"><span class="annottext">base :: Int64
</span><a href="#local-6989586621679191216"><span class="hs-identifier hs-var hs-var">base</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">1483228800</span></span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-comment">-- UnixTime (CTime base) _= parseUnixTimeGMT webDateFormat &quot;Sun, 01 Jan 2017 00:00:00 GMT&quot;</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#getSessionData13"><span class="hs-identifier hs-type">getSessionData13</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Cipher.html#Cipher"><span class="hs-identifier hs-type">Cipher</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#TLS13TicketInfo"><span class="hs-identifier hs-type">TLS13TicketInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#SessionData"><span class="hs-identifier hs-type">SessionData</span></a></span><span>
</span><span id="line-317"></span><span id="getSessionData13"><span class="annot"><span class="annottext">getSessionData13 :: Context
-&gt; Cipher -&gt; TLS13TicketInfo -&gt; Int -&gt; ByteString -&gt; IO SessionData
</span><a href="Network.TLS.Handshake.Common13.html#getSessionData13"><span class="hs-identifier hs-var hs-var">getSessionData13</span></a></span></span><span> </span><span id="local-6989586621679191219"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191219"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679191220"><span class="annot"><span class="annottext">Cipher
</span><a href="#local-6989586621679191220"><span class="hs-identifier hs-var">usedCipher</span></a></span></span><span> </span><span id="local-6989586621679191221"><span class="annot"><span class="annottext">TLS13TicketInfo
</span><a href="#local-6989586621679191221"><span class="hs-identifier hs-var">tinfo</span></a></span></span><span> </span><span id="local-6989586621679191222"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679191222"><span class="hs-identifier hs-var">maxSize</span></a></span></span><span> </span><span id="local-6989586621679191223"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191223"><span class="hs-identifier hs-var">psk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-318"></span><span>    </span><span id="local-6989586621679191224"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679191224"><span class="hs-identifier hs-var">ver</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; TLSSt Version -&gt; IO Version
forall a. Context -&gt; TLSSt a -&gt; IO a
</span><a href="Network.TLS.Context.Internal.html#usingState_"><span class="hs-identifier hs-var">usingState_</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191219"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSt Version
</span><a href="Network.TLS.State.html#getVersion"><span class="hs-identifier hs-var">getVersion</span></a></span><span>
</span><span id="line-319"></span><span>    </span><span id="local-6989586621679191226"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679191226"><span class="hs-identifier hs-var">malpn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; TLSSt (Maybe ByteString) -&gt; IO (Maybe ByteString)
forall a. Context -&gt; TLSSt a -&gt; IO a
</span><a href="Network.TLS.Context.Internal.html#usingState_"><span class="hs-identifier hs-var">usingState_</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191219"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSt (Maybe ByteString)
</span><a href="Network.TLS.State.html#getNegotiatedProtocol"><span class="hs-identifier hs-var">getNegotiatedProtocol</span></a></span><span>
</span><span id="line-320"></span><span>    </span><span id="local-6989586621679191228"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679191228"><span class="hs-identifier hs-var">sni</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; TLSSt (Maybe String) -&gt; IO (Maybe String)
forall a. Context -&gt; TLSSt a -&gt; IO a
</span><a href="Network.TLS.Context.Internal.html#usingState_"><span class="hs-identifier hs-var">usingState_</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191219"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSt (Maybe String)
</span><a href="Network.TLS.State.html#getClientSNI"><span class="hs-identifier hs-var">getClientSNI</span></a></span><span>
</span><span id="line-321"></span><span>    </span><span id="local-6989586621679191230"><span class="annot"><span class="annottext">Maybe Group
</span><a href="#local-6989586621679191230"><span class="hs-identifier hs-var">mgrp</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; HandshakeM (Maybe Group) -&gt; IO (Maybe Group)
forall (m :: * -&gt; *) a. MonadIO m =&gt; Context -&gt; HandshakeM a -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#usingHState"><span class="hs-identifier hs-var">usingHState</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191219"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">HandshakeM (Maybe Group)
</span><a href="Network.TLS.Handshake.State.html#getNegotiatedGroup"><span class="hs-identifier hs-var">getNegotiatedGroup</span></a></span><span>
</span><span id="line-322"></span><span>    </span><span class="annot"><span class="annottext">SessionData -&gt; IO SessionData
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#SessionData"><span class="hs-identifier hs-type">SessionData</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-323"></span><span>        </span><span class="annot"><span class="annottext">sessionVersion :: Version
</span><a href="Network.TLS.Types.html#sessionVersion"><span class="hs-identifier hs-var">sessionVersion</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679191224"><span class="hs-identifier hs-var">ver</span></a></span><span>
</span><span id="line-324"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sessionCipher :: ExtensionID
</span><a href="Network.TLS.Types.html#sessionCipher"><span class="hs-identifier hs-var">sessionCipher</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cipher -&gt; ExtensionID
</span><a href="Network.TLS.Cipher.html#cipherID"><span class="hs-identifier hs-var">cipherID</span></a></span><span> </span><span class="annot"><span class="annottext">Cipher
</span><a href="#local-6989586621679191220"><span class="hs-identifier hs-var">usedCipher</span></a></span><span>
</span><span id="line-325"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sessionCompression :: CompressionID
</span><a href="Network.TLS.Types.html#sessionCompression"><span class="hs-identifier hs-var">sessionCompression</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompressionID
</span><span class="hs-number">0</span></span><span>
</span><span id="line-326"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sessionClientSNI :: Maybe String
</span><a href="Network.TLS.Types.html#sessionClientSNI"><span class="hs-identifier hs-var">sessionClientSNI</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679191228"><span class="hs-identifier hs-var">sni</span></a></span><span>
</span><span id="line-327"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sessionSecret :: ByteString
</span><a href="Network.TLS.Types.html#sessionSecret"><span class="hs-identifier hs-var">sessionSecret</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191223"><span class="hs-identifier hs-var">psk</span></a></span><span>
</span><span id="line-328"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sessionGroup :: Maybe Group
</span><a href="Network.TLS.Types.html#sessionGroup"><span class="hs-identifier hs-var">sessionGroup</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Group
</span><a href="#local-6989586621679191230"><span class="hs-identifier hs-var">mgrp</span></a></span><span>
</span><span id="line-329"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sessionTicketInfo :: Maybe TLS13TicketInfo
</span><a href="Network.TLS.Types.html#sessionTicketInfo"><span class="hs-identifier hs-var">sessionTicketInfo</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLS13TicketInfo -&gt; Maybe TLS13TicketInfo
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TLS13TicketInfo
</span><a href="#local-6989586621679191221"><span class="hs-identifier hs-var">tinfo</span></a></span><span>
</span><span id="line-330"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sessionALPN :: Maybe ByteString
</span><a href="Network.TLS.Types.html#sessionALPN"><span class="hs-identifier hs-var">sessionALPN</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679191226"><span class="hs-identifier hs-var">malpn</span></a></span><span>
</span><span id="line-331"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sessionMaxEarlyDataSize :: Int
</span><a href="Network.TLS.Types.html#sessionMaxEarlyDataSize"><span class="hs-identifier hs-var">sessionMaxEarlyDataSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679191222"><span class="hs-identifier hs-var">maxSize</span></a></span><span>
</span><span id="line-332"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sessionFlags :: [SessionFlag]
</span><a href="Network.TLS.Types.html#sessionFlags"><span class="hs-identifier hs-var">sessionFlags</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-333"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span id="local-6989586621679190583"><span class="annot"><a href="Network.TLS.Handshake.Common13.html#ensureNullCompression"><span class="hs-identifier hs-type">ensureNullCompression</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679190583"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#CompressionID"><span class="hs-identifier hs-type">CompressionID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679190583"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-338"></span><span id="ensureNullCompression"><span class="annot"><span class="annottext">ensureNullCompression :: forall (m :: * -&gt; *). MonadIO m =&gt; CompressionID -&gt; m ()
</span><a href="Network.TLS.Handshake.Common13.html#ensureNullCompression"><span class="hs-identifier hs-var hs-var">ensureNullCompression</span></a></span></span><span> </span><span id="local-6989586621679191251"><span class="annot"><span class="annottext">CompressionID
</span><a href="#local-6989586621679191251"><span class="hs-identifier hs-var">compression</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-339"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompressionID
</span><a href="#local-6989586621679191251"><span class="hs-identifier hs-var">compression</span></a></span><span> </span><span class="annot"><span class="annottext">CompressionID -&gt; CompressionID -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Compression -&gt; CompressionID
</span><a href="Network.TLS.Compression.html#compressionID"><span class="hs-identifier hs-var">compressionID</span></a></span><span> </span><span class="annot"><span class="annottext">Compression
</span><a href="Network.TLS.Compression.html#nullCompression"><span class="hs-identifier hs-var">nullCompression</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-340"></span><span>        </span><span class="annot"><span class="annottext">TLSError -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">(TLSError -&gt; m ()) -&gt; TLSError -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool, AlertDescription) -&gt; TLSError
</span><a href="Network.TLS.Struct.html#Error_Protocol"><span class="hs-identifier hs-var">Error_Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;compression is not allowed in TLS 1.3&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#IllegalParameter"><span class="hs-identifier hs-var">IllegalParameter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span class="hs-comment">-- Word32 is used in TLS 1.3 protocol.</span><span>
</span><span id="line-343"></span><span class="hs-comment">-- Int is used for API for Haskell TLS because it is natural.</span><span>
</span><span id="line-344"></span><span class="hs-comment">-- If Int is 64 bits, users can specify bigger number than Word32.</span><span>
</span><span id="line-345"></span><span class="hs-comment">-- If Int is 32 bits, 2^31 or larger may be converted into minus numbers.</span><span>
</span><span id="line-346"></span><span id="local-6989586621679190586"><span class="annot"><a href="Network.TLS.Handshake.Common13.html#safeNonNegative32"><span class="hs-identifier hs-type">safeNonNegative32</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679190586"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679190586"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FiniteBits</span></span><span> </span><span class="annot"><a href="#local-6989586621679190586"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679190586"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679190586"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-347"></span><span id="safeNonNegative32"><span class="annot"><span class="annottext">safeNonNegative32 :: forall a. (Num a, Ord a, FiniteBits a) =&gt; a -&gt; a
</span><a href="Network.TLS.Handshake.Common13.html#safeNonNegative32"><span class="hs-identifier hs-var hs-var">safeNonNegative32</span></a></span></span><span> </span><span id="local-6989586621679191269"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679191269"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679191269"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a -&gt; Int
forall b. FiniteBits b =&gt; b -&gt; Int
</span><span class="hs-identifier hs-var">finiteBitSize</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679191269"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679191269"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-350"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679191269"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`min`</span></span><span> </span><span class="annot"><span class="annottext">Second -&gt; a
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Second
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="hs-keyword">newtype</span><span> </span><span id="RecvHandshake13M"><span class="annot"><a href="Network.TLS.Handshake.Common13.html#RecvHandshake13M"><span class="hs-identifier hs-var">RecvHandshake13M</span></a></span></span><span> </span><span id="local-6989586621679190660"><span class="annot"><a href="#local-6989586621679190660"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679190661"><span class="annot"><a href="#local-6989586621679190661"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RecvHandshake13M"><span class="annot"><a href="Network.TLS.Handshake.Common13.html#RecvHandshake13M"><span class="hs-identifier hs-var">RecvHandshake13M</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.TLS.Struct13.html#Handshake13"><span class="hs-identifier hs-type">Handshake13</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679190660"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190661"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679191276"><span id="local-6989586621679191281"><span class="annot"><span class="annottext">(forall a b.
 (a -&gt; b) -&gt; RecvHandshake13M m a -&gt; RecvHandshake13M m b)
-&gt; (forall a b. a -&gt; RecvHandshake13M m b -&gt; RecvHandshake13M m a)
-&gt; Functor (RecvHandshake13M m)
forall a b. a -&gt; RecvHandshake13M m b -&gt; RecvHandshake13M m a
forall a b.
(a -&gt; b) -&gt; RecvHandshake13M m a -&gt; RecvHandshake13M m b
forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; RecvHandshake13M m b -&gt; RecvHandshake13M m a
forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; RecvHandshake13M m a -&gt; RecvHandshake13M m b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; RecvHandshake13M m a -&gt; RecvHandshake13M m b
fmap :: forall a b.
(a -&gt; b) -&gt; RecvHandshake13M m a -&gt; RecvHandshake13M m b
$c&lt;$ :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; RecvHandshake13M m b -&gt; RecvHandshake13M m a
&lt;$ :: forall a b. a -&gt; RecvHandshake13M m b -&gt; RecvHandshake13M m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679191291"><span id="local-6989586621679191296"><span id="local-6989586621679191300"><span id="local-6989586621679191304"><span id="local-6989586621679191308"><span class="annot"><span class="annottext">Functor (RecvHandshake13M m)
Functor (RecvHandshake13M m) =&gt;
(forall a. a -&gt; RecvHandshake13M m a)
-&gt; (forall a b.
    RecvHandshake13M m (a -&gt; b)
    -&gt; RecvHandshake13M m a -&gt; RecvHandshake13M m b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c)
    -&gt; RecvHandshake13M m a
    -&gt; RecvHandshake13M m b
    -&gt; RecvHandshake13M m c)
-&gt; (forall a b.
    RecvHandshake13M m a
    -&gt; RecvHandshake13M m b -&gt; RecvHandshake13M m b)
-&gt; (forall a b.
    RecvHandshake13M m a
    -&gt; RecvHandshake13M m b -&gt; RecvHandshake13M m a)
-&gt; Applicative (RecvHandshake13M m)
forall a. a -&gt; RecvHandshake13M m a
forall a b.
RecvHandshake13M m a
-&gt; RecvHandshake13M m b -&gt; RecvHandshake13M m a
forall a b.
RecvHandshake13M m a
-&gt; RecvHandshake13M m b -&gt; RecvHandshake13M m b
forall a b.
RecvHandshake13M m (a -&gt; b)
-&gt; RecvHandshake13M m a -&gt; RecvHandshake13M m b
forall a b c.
(a -&gt; b -&gt; c)
-&gt; RecvHandshake13M m a
-&gt; RecvHandshake13M m b
-&gt; RecvHandshake13M m c
forall (m :: * -&gt; *). Monad m =&gt; Functor (RecvHandshake13M m)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; RecvHandshake13M m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
RecvHandshake13M m a
-&gt; RecvHandshake13M m b -&gt; RecvHandshake13M m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
RecvHandshake13M m a
-&gt; RecvHandshake13M m b -&gt; RecvHandshake13M m b
forall (m :: * -&gt; *) a b.
Monad m =&gt;
RecvHandshake13M m (a -&gt; b)
-&gt; RecvHandshake13M m a -&gt; RecvHandshake13M m b
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; b -&gt; c)
-&gt; RecvHandshake13M m a
-&gt; RecvHandshake13M m b
-&gt; RecvHandshake13M m c
forall (f :: * -&gt; *).
Functor f =&gt;
(forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
$cpure :: forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; RecvHandshake13M m a
pure :: forall a. a -&gt; RecvHandshake13M m a
$c&lt;*&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
RecvHandshake13M m (a -&gt; b)
-&gt; RecvHandshake13M m a -&gt; RecvHandshake13M m b
&lt;*&gt; :: forall a b.
RecvHandshake13M m (a -&gt; b)
-&gt; RecvHandshake13M m a -&gt; RecvHandshake13M m b
$cliftA2 :: forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; b -&gt; c)
-&gt; RecvHandshake13M m a
-&gt; RecvHandshake13M m b
-&gt; RecvHandshake13M m c
liftA2 :: forall a b c.
(a -&gt; b -&gt; c)
-&gt; RecvHandshake13M m a
-&gt; RecvHandshake13M m b
-&gt; RecvHandshake13M m c
$c*&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
RecvHandshake13M m a
-&gt; RecvHandshake13M m b -&gt; RecvHandshake13M m b
*&gt; :: forall a b.
RecvHandshake13M m a
-&gt; RecvHandshake13M m b -&gt; RecvHandshake13M m b
$c&lt;* :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
RecvHandshake13M m a
-&gt; RecvHandshake13M m b -&gt; RecvHandshake13M m a
&lt;* :: forall a b.
RecvHandshake13M m a
-&gt; RecvHandshake13M m b -&gt; RecvHandshake13M m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679191318"><span id="local-6989586621679191323"><span id="local-6989586621679191327"><span class="annot"><span class="annottext">Applicative (RecvHandshake13M m)
Applicative (RecvHandshake13M m) =&gt;
(forall a b.
 RecvHandshake13M m a
 -&gt; (a -&gt; RecvHandshake13M m b) -&gt; RecvHandshake13M m b)
-&gt; (forall a b.
    RecvHandshake13M m a
    -&gt; RecvHandshake13M m b -&gt; RecvHandshake13M m b)
-&gt; (forall a. a -&gt; RecvHandshake13M m a)
-&gt; Monad (RecvHandshake13M m)
forall a. a -&gt; RecvHandshake13M m a
forall a b.
RecvHandshake13M m a
-&gt; RecvHandshake13M m b -&gt; RecvHandshake13M m b
forall a b.
RecvHandshake13M m a
-&gt; (a -&gt; RecvHandshake13M m b) -&gt; RecvHandshake13M m b
forall (m :: * -&gt; *). Monad m =&gt; Applicative (RecvHandshake13M m)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; RecvHandshake13M m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
RecvHandshake13M m a
-&gt; RecvHandshake13M m b -&gt; RecvHandshake13M m b
forall (m :: * -&gt; *) a b.
Monad m =&gt;
RecvHandshake13M m a
-&gt; (a -&gt; RecvHandshake13M m b) -&gt; RecvHandshake13M m b
forall (m :: * -&gt; *).
Applicative m =&gt;
(forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
$c&gt;&gt;= :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
RecvHandshake13M m a
-&gt; (a -&gt; RecvHandshake13M m b) -&gt; RecvHandshake13M m b
&gt;&gt;= :: forall a b.
RecvHandshake13M m a
-&gt; (a -&gt; RecvHandshake13M m b) -&gt; RecvHandshake13M m b
$c&gt;&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
RecvHandshake13M m a
-&gt; RecvHandshake13M m b -&gt; RecvHandshake13M m b
&gt;&gt; :: forall a b.
RecvHandshake13M m a
-&gt; RecvHandshake13M m b -&gt; RecvHandshake13M m b
$creturn :: forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; RecvHandshake13M m a
return :: forall a. a -&gt; RecvHandshake13M m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679191337"><span class="annot"><span class="annottext">Monad (RecvHandshake13M m)
Monad (RecvHandshake13M m) =&gt;
(forall a. IO a -&gt; RecvHandshake13M m a)
-&gt; MonadIO (RecvHandshake13M m)
forall a. IO a -&gt; RecvHandshake13M m a
forall (m :: * -&gt; *).
Monad m =&gt;
(forall a. IO a -&gt; m a) -&gt; MonadIO m
forall (m :: * -&gt; *). MonadIO m =&gt; Monad (RecvHandshake13M m)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; RecvHandshake13M m a
$cliftIO :: forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; RecvHandshake13M m a
liftIO :: forall a. IO a -&gt; RecvHandshake13M m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span id="local-6989586621679190647"><span id="local-6989586621679190648"><span class="annot"><a href="Network.TLS.Handshake.Common13.html#recvHandshake13"><span class="hs-identifier hs-type">recvHandshake13</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679190647"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-357"></span><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-358"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Struct13.html#Handshake13"><span class="hs-identifier hs-type">Handshake13</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#RecvHandshake13M"><span class="hs-identifier hs-type">RecvHandshake13M</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190647"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190648"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#RecvHandshake13M"><span class="hs-identifier hs-type">RecvHandshake13M</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190647"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190648"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-360"></span><span id="recvHandshake13"><span class="annot"><span class="annottext">recvHandshake13 :: forall (m :: * -&gt; *) a.
MonadIO m =&gt;
Context
-&gt; (Handshake13 -&gt; RecvHandshake13M m a) -&gt; RecvHandshake13M m a
</span><a href="Network.TLS.Handshake.Common13.html#recvHandshake13"><span class="hs-identifier hs-var hs-var">recvHandshake13</span></a></span></span><span> </span><span id="local-6989586621679191347"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191347"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679191348"><span class="annot"><span class="annottext">Handshake13 -&gt; RecvHandshake13M m a
</span><a href="#local-6989586621679191348"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; RecvHandshake13M m Handshake13
forall (m :: * -&gt; *).
MonadIO m =&gt;
Context -&gt; RecvHandshake13M m Handshake13
</span><a href="Network.TLS.Handshake.Common13.html#getHandshake13"><span class="hs-identifier hs-var">getHandshake13</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191347"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">RecvHandshake13M m Handshake13
-&gt; (Handshake13 -&gt; RecvHandshake13M m a) -&gt; RecvHandshake13M m a
forall a b.
RecvHandshake13M m a
-&gt; (a -&gt; RecvHandshake13M m b) -&gt; RecvHandshake13M m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Handshake13 -&gt; RecvHandshake13M m a
</span><a href="#local-6989586621679191348"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span id="local-6989586621679190652"><span id="local-6989586621679190653"><span class="annot"><a href="Network.TLS.Handshake.Common13.html#recvHandshake13hash"><span class="hs-identifier hs-type">recvHandshake13hash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679190652"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-363"></span><span>                    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-364"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Struct13.html#Handshake13"><span class="hs-identifier hs-type">Handshake13</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#RecvHandshake13M"><span class="hs-identifier hs-type">RecvHandshake13M</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190652"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190653"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#RecvHandshake13M"><span class="hs-identifier hs-type">RecvHandshake13M</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190652"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190653"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-366"></span><span id="recvHandshake13hash"><span class="annot"><span class="annottext">recvHandshake13hash :: forall (m :: * -&gt; *) a.
MonadIO m =&gt;
Context
-&gt; (ByteString -&gt; Handshake13 -&gt; RecvHandshake13M m a)
-&gt; RecvHandshake13M m a
</span><a href="Network.TLS.Handshake.Common13.html#recvHandshake13hash"><span class="hs-identifier hs-var hs-var">recvHandshake13hash</span></a></span></span><span> </span><span id="local-6989586621679191356"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191356"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679191357"><span class="annot"><span class="annottext">ByteString -&gt; Handshake13 -&gt; RecvHandshake13M m a
</span><a href="#local-6989586621679191357"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-367"></span><span>    </span><span id="local-6989586621679191358"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191358"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; RecvHandshake13M m ByteString
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m ByteString
</span><a href="Network.TLS.Handshake.State13.html#transcriptHash"><span class="hs-identifier hs-var">transcriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191356"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-368"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; RecvHandshake13M m Handshake13
forall (m :: * -&gt; *).
MonadIO m =&gt;
Context -&gt; RecvHandshake13M m Handshake13
</span><a href="Network.TLS.Handshake.Common13.html#getHandshake13"><span class="hs-identifier hs-var">getHandshake13</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191356"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">RecvHandshake13M m Handshake13
-&gt; (Handshake13 -&gt; RecvHandshake13M m a) -&gt; RecvHandshake13M m a
forall a b.
RecvHandshake13M m a
-&gt; (a -&gt; RecvHandshake13M m b) -&gt; RecvHandshake13M m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Handshake13 -&gt; RecvHandshake13M m a
</span><a href="#local-6989586621679191357"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191358"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span id="local-6989586621679190651"><span class="annot"><a href="Network.TLS.Handshake.Common13.html#getHandshake13"><span class="hs-identifier hs-type">getHandshake13</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679190651"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#RecvHandshake13M"><span class="hs-identifier hs-type">RecvHandshake13M</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190651"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Struct13.html#Handshake13"><span class="hs-identifier hs-type">Handshake13</span></a></span></span><span>
</span><span id="line-371"></span><span id="getHandshake13"><span class="annot"><span class="annottext">getHandshake13 :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Context -&gt; RecvHandshake13M m Handshake13
</span><a href="Network.TLS.Handshake.Common13.html#getHandshake13"><span class="hs-identifier hs-var hs-var">getHandshake13</span></a></span></span><span> </span><span id="local-6989586621679191368"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191368"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT [Handshake13] m Handshake13
-&gt; RecvHandshake13M m Handshake13
forall (m :: * -&gt; *) a.
StateT [Handshake13] m a -&gt; RecvHandshake13M m a
</span><a href="Network.TLS.Handshake.Common13.html#RecvHandshake13M"><span class="hs-identifier hs-var">RecvHandshake13M</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT [Handshake13] m Handshake13
 -&gt; RecvHandshake13M m Handshake13)
-&gt; StateT [Handshake13] m Handshake13
-&gt; RecvHandshake13M m Handshake13
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-372"></span><span>    </span><span id="local-6989586621679191369"><span class="annot"><span class="annottext">[Handshake13]
</span><a href="#local-6989586621679191369"><span class="hs-identifier hs-var">currentState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT [Handshake13] m [Handshake13]
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Handshake13]
</span><a href="#local-6989586621679191369"><span class="hs-identifier hs-var">currentState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-374"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679191371"><span class="annot"><span class="annottext">Handshake13
</span><a href="#local-6989586621679191371"><span class="hs-identifier hs-var">h</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679191372"><span class="annot"><span class="annottext">[Handshake13]
</span><a href="#local-6989586621679191372"><span class="hs-identifier hs-var">hs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Handshake13 -&gt; [Handshake13] -&gt; StateT [Handshake13] m Handshake13
forall {m :: * -&gt; *} {s}.
(MonadIO m, MonadState s m) =&gt;
Handshake13 -&gt; s -&gt; m Handshake13
</span><a href="#local-6989586621679191373"><span class="hs-identifier hs-var">found</span></a></span><span> </span><span class="annot"><span class="annottext">Handshake13
</span><a href="#local-6989586621679191371"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">[Handshake13]
</span><a href="#local-6989586621679191372"><span class="hs-identifier hs-var">hs</span></a></span><span>
</span><span id="line-375"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StateT [Handshake13] m Handshake13
</span><a href="#local-6989586621679191374"><span class="hs-identifier hs-var">recvLoop</span></a></span><span>
</span><span id="line-376"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-377"></span><span>    </span><span id="local-6989586621679191373"><span class="annot"><span class="annottext">found :: Handshake13 -&gt; s -&gt; m Handshake13
</span><a href="#local-6989586621679191373"><span class="hs-identifier hs-var hs-var">found</span></a></span></span><span> </span><span id="local-6989586621679191393"><span class="annot"><span class="annottext">Handshake13
</span><a href="#local-6989586621679191393"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679191394"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679191394"><span class="hs-identifier hs-var">hs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; Handshake13 -&gt; IO ()
</span><a href="Network.TLS.Handshake.Process.html#processHandshake13"><span class="hs-identifier hs-var">processHandshake13</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191368"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Handshake13
</span><a href="#local-6989586621679191393"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m () -&gt; m () -&gt; m ()
forall a b. m a -&gt; m b -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">s -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679191394"><span class="hs-identifier hs-var">hs</span></a></span><span> </span><span class="annot"><span class="annottext">m () -&gt; m Handshake13 -&gt; m Handshake13
forall a b. m a -&gt; m b -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Handshake13 -&gt; m Handshake13
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Handshake13
</span><a href="#local-6989586621679191393"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-378"></span><span>    </span><span id="local-6989586621679191374"><span class="annot"><span class="annottext">recvLoop :: StateT [Handshake13] m Handshake13
</span><a href="#local-6989586621679191374"><span class="hs-identifier hs-var hs-var">recvLoop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-379"></span><span>        </span><span id="local-6989586621679191416"><span class="annot"><span class="annottext">Either TLSError Packet13
</span><a href="#local-6989586621679191416"><span class="hs-identifier hs-var">epkt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either TLSError Packet13)
-&gt; StateT [Handshake13] m (Either TLSError Packet13)
forall a. IO a -&gt; StateT [Handshake13] m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; IO (Either TLSError Packet13)
</span><a href="Network.TLS.IO.html#recvPacket13"><span class="hs-identifier hs-var">recvPacket13</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191368"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either TLSError Packet13
</span><a href="#local-6989586621679191416"><span class="hs-identifier hs-var">epkt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-381"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Struct13.html#Handshake13"><span class="hs-identifier hs-type">Handshake13</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; StateT [Handshake13] m Handshake13
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;invalid recvPacket13 result&quot;</span></span><span>
</span><span id="line-382"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Struct13.html#Handshake13"><span class="hs-identifier hs-type">Handshake13</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679191420"><span class="annot"><span class="annottext">Handshake13
</span><a href="#local-6989586621679191420"><span class="hs-identifier hs-var">h</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679191421"><span class="annot"><span class="annottext">[Handshake13]
</span><a href="#local-6989586621679191421"><span class="hs-identifier hs-var">hs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Handshake13 -&gt; [Handshake13] -&gt; StateT [Handshake13] m Handshake13
forall {m :: * -&gt; *} {s}.
(MonadIO m, MonadState s m) =&gt;
Handshake13 -&gt; s -&gt; m Handshake13
</span><a href="#local-6989586621679191373"><span class="hs-identifier hs-var">found</span></a></span><span> </span><span class="annot"><span class="annottext">Handshake13
</span><a href="#local-6989586621679191420"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">[Handshake13]
</span><a href="#local-6989586621679191421"><span class="hs-identifier hs-var">hs</span></a></span><span>
</span><span id="line-383"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">Packet13
</span><a href="Network.TLS.Struct13.html#ChangeCipherSpec13"><span class="hs-identifier hs-var">ChangeCipherSpec13</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StateT [Handshake13] m Handshake13
</span><a href="#local-6989586621679191374"><span class="hs-identifier hs-var">recvLoop</span></a></span><span>
</span><span id="line-384"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679191422"><span class="annot"><span class="annottext">Packet13
</span><a href="#local-6989586621679191422"><span class="hs-identifier hs-var">x</span></a></span></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; StateT [Handshake13] m Handshake13
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; Maybe String -&gt; m a
</span><a href="Network.TLS.Handshake.Common.html#unexpected"><span class="hs-identifier hs-var">unexpected</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Packet13 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Packet13
</span><a href="#local-6989586621679191422"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;handshake 13&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679191423"><span class="annot"><span class="annottext">TLSError
</span><a href="#local-6989586621679191423"><span class="hs-identifier hs-var">err</span></a></span></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TLSError -&gt; StateT [Handshake13] m Handshake13
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">TLSError
</span><a href="#local-6989586621679191423"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span id="local-6989586621679190670"><span id="local-6989586621679190671"><span class="annot"><a href="Network.TLS.Handshake.Common13.html#runRecvHandshake13"><span class="hs-identifier hs-type">runRecvHandshake13</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679190670"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#RecvHandshake13M"><span class="hs-identifier hs-type">RecvHandshake13M</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190670"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190671"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679190670"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190671"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-388"></span><span id="runRecvHandshake13"><span class="annot"><span class="annottext">runRecvHandshake13 :: forall (m :: * -&gt; *) a. MonadIO m =&gt; RecvHandshake13M m a -&gt; m a
</span><a href="Network.TLS.Handshake.Common13.html#runRecvHandshake13"><span class="hs-identifier hs-var hs-var">runRecvHandshake13</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#RecvHandshake13M"><span class="hs-identifier hs-type">RecvHandshake13M</span></a></span><span> </span><span id="local-6989586621679191433"><span class="annot"><span class="annottext">StateT [Handshake13] m a
</span><a href="#local-6989586621679191433"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-389"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679191434"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679191434"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679191435"><span class="annot"><span class="annottext">[Handshake13]
</span><a href="#local-6989586621679191435"><span class="hs-identifier hs-var">new</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT [Handshake13] m a -&gt; [Handshake13] -&gt; m (a, [Handshake13])
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var">runStateT</span></span><span> </span><span class="annot"><span class="annottext">StateT [Handshake13] m a
</span><a href="#local-6989586621679191433"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-390"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Handshake13] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Handshake13]
</span><a href="#local-6989586621679191435"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; Maybe String -&gt; m a
</span><a href="Network.TLS.Handshake.Common.html#unexpected"><span class="hs-identifier hs-var">unexpected</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spurious handshake 13&quot;</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-391"></span><span>    </span><span class="annot"><span class="annottext">a -&gt; m a
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679191434"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span class="hs-comment">-- some hash/signature combinations have been deprecated in TLS13 and should</span><span>
</span><span id="line-396"></span><span class="hs-comment">-- not be used</span><span>
</span><span id="line-397"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#checkHashSignatureValid13"><span class="hs-identifier hs-type">checkHashSignatureValid13</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Struct.html#HashAndSignatureAlgorithm"><span class="hs-identifier hs-type">HashAndSignatureAlgorithm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span id="checkHashSignatureValid13"><span class="annot"><span class="annottext">checkHashSignatureValid13 :: HashAndSignatureAlgorithm -&gt; IO ()
</span><a href="Network.TLS.Handshake.Common13.html#checkHashSignatureValid13"><span class="hs-identifier hs-var hs-var">checkHashSignatureValid13</span></a></span></span><span> </span><span id="local-6989586621679191437"><span class="annot"><span class="annottext">HashAndSignatureAlgorithm
</span><a href="#local-6989586621679191437"><span class="hs-identifier hs-var">hs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-399"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashAndSignatureAlgorithm -&gt; Bool
</span><a href="Network.TLS.Handshake.Common13.html#isHashSignatureValid13"><span class="hs-identifier hs-var">isHashSignatureValid13</span></a></span><span> </span><span class="annot"><span class="annottext">HashAndSignatureAlgorithm
</span><a href="#local-6989586621679191437"><span class="hs-identifier hs-var">hs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-400"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191446"><span class="annot"><span class="annottext">msg :: String
</span><a href="#local-6989586621679191446"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;invalid TLS13 hash and signature algorithm: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">HashAndSignatureAlgorithm -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">HashAndSignatureAlgorithm
</span><a href="#local-6989586621679191437"><span class="hs-identifier hs-var">hs</span></a></span><span>
</span><span id="line-401"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">TLSError -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">(TLSError -&gt; IO ()) -&gt; TLSError -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool, AlertDescription) -&gt; TLSError
</span><a href="Network.TLS.Struct.html#Error_Protocol"><span class="hs-identifier hs-var">Error_Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679191446"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#IllegalParameter"><span class="hs-identifier hs-var">IllegalParameter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#isHashSignatureValid13"><span class="hs-identifier hs-type">isHashSignatureValid13</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Struct.html#HashAndSignatureAlgorithm"><span class="hs-identifier hs-type">HashAndSignatureAlgorithm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-404"></span><span id="isHashSignatureValid13"><span class="annot"><span class="annottext">isHashSignatureValid13 :: HashAndSignatureAlgorithm -&gt; Bool
</span><a href="Network.TLS.Handshake.Common13.html#isHashSignatureValid13"><span class="hs-identifier hs-var hs-var">isHashSignatureValid13</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashAlgorithm
</span><a href="Network.TLS.Struct.html#HashIntrinsic"><span class="hs-identifier hs-var">HashIntrinsic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679191448"><span class="annot"><span class="annottext">SignatureAlgorithm
</span><a href="#local-6989586621679191448"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-405"></span><span>    </span><span class="annot"><span class="annottext">SignatureAlgorithm
</span><a href="#local-6989586621679191448"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SignatureAlgorithm -&gt; [SignatureAlgorithm] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SignatureAlgorithm
</span><a href="Network.TLS.Struct.html#SignatureRSApssRSAeSHA256"><span class="hs-identifier hs-var">SignatureRSApssRSAeSHA256</span></a></span><span>
</span><span id="line-406"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SignatureAlgorithm
</span><a href="Network.TLS.Struct.html#SignatureRSApssRSAeSHA384"><span class="hs-identifier hs-var">SignatureRSApssRSAeSHA384</span></a></span><span>
</span><span id="line-407"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SignatureAlgorithm
</span><a href="Network.TLS.Struct.html#SignatureRSApssRSAeSHA512"><span class="hs-identifier hs-var">SignatureRSApssRSAeSHA512</span></a></span><span>
</span><span id="line-408"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SignatureAlgorithm
</span><a href="Network.TLS.Struct.html#SignatureEd25519"><span class="hs-identifier hs-var">SignatureEd25519</span></a></span><span>
</span><span id="line-409"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SignatureAlgorithm
</span><a href="Network.TLS.Struct.html#SignatureEd448"><span class="hs-identifier hs-var">SignatureEd448</span></a></span><span>
</span><span id="line-410"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SignatureAlgorithm
</span><a href="Network.TLS.Struct.html#SignatureRSApsspssSHA256"><span class="hs-identifier hs-var">SignatureRSApsspssSHA256</span></a></span><span>
</span><span id="line-411"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SignatureAlgorithm
</span><a href="Network.TLS.Struct.html#SignatureRSApsspssSHA384"><span class="hs-identifier hs-var">SignatureRSApsspssSHA384</span></a></span><span>
</span><span id="line-412"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SignatureAlgorithm
</span><a href="Network.TLS.Struct.html#SignatureRSApsspssSHA512"><span class="hs-identifier hs-var">SignatureRSApsspssSHA512</span></a></span><span>
</span><span id="line-413"></span><span>             </span><span class="hs-special">]</span><span>
</span><span id="line-414"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#isHashSignatureValid13"><span class="hs-identifier hs-var">isHashSignatureValid13</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679191458"><span class="annot"><span class="annottext">HashAlgorithm
</span><a href="#local-6989586621679191458"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SignatureAlgorithm
</span><a href="Network.TLS.Struct.html#SignatureECDSA"><span class="hs-identifier hs-var">SignatureECDSA</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-415"></span><span>    </span><span class="annot"><span class="annottext">HashAlgorithm
</span><a href="#local-6989586621679191458"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">HashAlgorithm -&gt; [HashAlgorithm] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">HashAlgorithm
</span><a href="Network.TLS.Struct.html#HashSHA256"><span class="hs-identifier hs-var">HashSHA256</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashAlgorithm
</span><a href="Network.TLS.Struct.html#HashSHA384"><span class="hs-identifier hs-var">HashSHA384</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashAlgorithm
</span><a href="Network.TLS.Struct.html#HashSHA512"><span class="hs-identifier hs-var">HashSHA512</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-416"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#isHashSignatureValid13"><span class="hs-identifier hs-var">isHashSignatureValid13</span></a></span><span> </span><span class="annot"><span class="annottext">HashAndSignatureAlgorithm
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span class="hs-keyword">data</span><span> </span><span id="CipherChoice"><span class="annot"><a href="Network.TLS.Handshake.Common13.html#CipherChoice"><span class="hs-identifier hs-var">CipherChoice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CipherChoice"><span class="annot"><a href="Network.TLS.Handshake.Common13.html#CipherChoice"><span class="hs-identifier hs-var">CipherChoice</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-419"></span><span>    </span><span id="cVersion"><span class="annot"><span class="annottext">CipherChoice -&gt; Version
</span><a href="Network.TLS.Handshake.Common13.html#cVersion"><span class="hs-identifier hs-var hs-var">cVersion</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span>
</span><span id="line-420"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="cCipher"><span class="annot"><span class="annottext">CipherChoice -&gt; Cipher
</span><a href="Network.TLS.Handshake.Common13.html#cCipher"><span class="hs-identifier hs-var hs-var">cCipher</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Cipher.html#Cipher"><span class="hs-identifier hs-type">Cipher</span></a></span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="cHash"><span class="annot"><span class="annottext">CipherChoice -&gt; Hash
</span><a href="Network.TLS.Handshake.Common13.html#cHash"><span class="hs-identifier hs-var hs-var">cHash</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Crypto.html#Hash"><span class="hs-identifier hs-type">Hash</span></a></span><span>
</span><span id="line-422"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="cZero"><span class="annot"><span class="annottext">CipherChoice -&gt; ByteString
</span><a href="Network.TLS.Handshake.Common13.html#cZero"><span class="hs-identifier hs-var hs-var">cZero</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#makeCipherChoice"><span class="hs-identifier hs-type">makeCipherChoice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Cipher.html#Cipher"><span class="hs-identifier hs-type">Cipher</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#CipherChoice"><span class="hs-identifier hs-type">CipherChoice</span></a></span><span>
</span><span id="line-426"></span><span id="makeCipherChoice"><span class="annot"><span class="annottext">makeCipherChoice :: Version -&gt; Cipher -&gt; CipherChoice
</span><a href="Network.TLS.Handshake.Common13.html#makeCipherChoice"><span class="hs-identifier hs-var hs-var">makeCipherChoice</span></a></span></span><span> </span><span id="local-6989586621679191468"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679191468"><span class="hs-identifier hs-var">ver</span></a></span></span><span> </span><span id="local-6989586621679191469"><span class="annot"><span class="annottext">Cipher
</span><a href="#local-6989586621679191469"><span class="hs-identifier hs-var">cipher</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Version -&gt; Cipher -&gt; Hash -&gt; ByteString -&gt; CipherChoice
</span><a href="Network.TLS.Handshake.Common13.html#CipherChoice"><span class="hs-identifier hs-var">CipherChoice</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679191468"><span class="hs-identifier hs-var">ver</span></a></span><span> </span><span class="annot"><span class="annottext">Cipher
</span><a href="#local-6989586621679191469"><span class="hs-identifier hs-var">cipher</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191470"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191471"><span class="hs-identifier hs-var">zero</span></a></span><span>
</span><span id="line-427"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-428"></span><span>    </span><span id="local-6989586621679191470"><span class="annot"><span class="annottext">h :: Hash
</span><a href="#local-6989586621679191470"><span class="hs-identifier hs-var hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cipher -&gt; Hash
</span><a href="Network.TLS.Cipher.html#cipherHash"><span class="hs-identifier hs-var">cipherHash</span></a></span><span> </span><span class="annot"><span class="annottext">Cipher
</span><a href="#local-6989586621679191469"><span class="hs-identifier hs-var">cipher</span></a></span><span>
</span><span id="line-429"></span><span>    </span><span id="local-6989586621679191471"><span class="annot"><span class="annottext">zero :: ByteString
</span><a href="#local-6989586621679191471"><span class="hs-identifier hs-var hs-var">zero</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; CompressionID -&gt; ByteString
</span><span class="hs-identifier hs-var">B.replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash -&gt; Int
</span><a href="Network.TLS.Crypto.html#hashDigestSize"><span class="hs-identifier hs-var">hashDigestSize</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191470"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CompressionID
</span><span class="hs-number">0</span></span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#calculateEarlySecret"><span class="hs-identifier hs-type">calculateEarlySecret</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#CipherChoice"><span class="hs-identifier hs-type">CipherChoice</span></a></span><span>
</span><span id="line-434"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Types.html#BaseSecret"><span class="hs-identifier hs-type">BaseSecret</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#EarlySecret"><span class="hs-identifier hs-type">EarlySecret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Types.html#SecretPair"><span class="hs-identifier hs-type">SecretPair</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#EarlySecret"><span class="hs-identifier hs-type">EarlySecret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span id="calculateEarlySecret"><span class="annot"><span class="annottext">calculateEarlySecret :: Context
-&gt; CipherChoice
-&gt; Either ByteString (BaseSecret EarlySecret)
-&gt; Bool
-&gt; IO (SecretPair EarlySecret)
</span><a href="Network.TLS.Handshake.Common13.html#calculateEarlySecret"><span class="hs-identifier hs-var hs-var">calculateEarlySecret</span></a></span></span><span> </span><span id="local-6989586621679191474"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191474"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679191475"><span class="annot"><span class="annottext">CipherChoice
</span><a href="#local-6989586621679191475"><span class="hs-identifier hs-var">choice</span></a></span></span><span> </span><span id="local-6989586621679191476"><span class="annot"><span class="annottext">Either ByteString (BaseSecret EarlySecret)
</span><a href="#local-6989586621679191476"><span class="hs-identifier hs-var">maux</span></a></span></span><span> </span><span id="local-6989586621679191477"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679191477"><span class="hs-identifier hs-var">initialized</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-437"></span><span>    </span><span id="local-6989586621679191478"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191478"><span class="hs-identifier hs-var">hCh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679191477"><span class="hs-identifier hs-var">initialized</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-438"></span><span>               </span><span class="annot"><span class="annottext">Context -&gt; IO ByteString
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m ByteString
</span><a href="Network.TLS.Handshake.State13.html#transcriptHash"><span class="hs-identifier hs-var">transcriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191474"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-439"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-440"></span><span>               </span><span id="local-6989586621679191479"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679191479"><span class="hs-identifier hs-var">hmsgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; HandshakeM [ByteString] -&gt; IO [ByteString]
forall (m :: * -&gt; *) a. MonadIO m =&gt; Context -&gt; HandshakeM a -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#usingHState"><span class="hs-identifier hs-var">usingHState</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191474"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">HandshakeM [ByteString]
</span><a href="Network.TLS.Handshake.State.html#getHandshakeMessages"><span class="hs-identifier hs-var">getHandshakeMessages</span></a></span><span>
</span><span id="line-441"></span><span>               </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ByteString) -&gt; ByteString -&gt; IO ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.Crypto.html#hash"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191481"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B.concat</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679191479"><span class="hs-identifier hs-var">hmsgs</span></a></span><span>
</span><span id="line-442"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191482"><span class="annot"><span class="annottext">earlySecret :: ByteString
</span><a href="#local-6989586621679191482"><span class="hs-identifier hs-var hs-var">earlySecret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either ByteString (BaseSecret EarlySecret)
</span><a href="#local-6989586621679191476"><span class="hs-identifier hs-var">maux</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-443"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Types.html#BaseSecret"><span class="hs-identifier hs-type">BaseSecret</span></a></span><span> </span><span id="local-6989586621679191483"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191483"><span class="hs-identifier hs-var">sec</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191483"><span class="hs-identifier hs-var">sec</span></a></span><span>
</span><span id="line-444"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span>  </span><span id="local-6989586621679191484"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191484"><span class="hs-identifier hs-var">psk</span></a></span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.KeySchedule.html#hkdfExtract"><span class="hs-identifier hs-var">hkdfExtract</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191481"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191486"><span class="hs-identifier hs-var">zero</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191484"><span class="hs-identifier hs-var">psk</span></a></span><span>
</span><span id="line-445"></span><span>        </span><span id="local-6989586621679191488"><span class="annot"><span class="annottext">clientEarlySecret :: ByteString
</span><a href="#local-6989586621679191488"><span class="hs-identifier hs-var hs-var">clientEarlySecret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.KeySchedule.html#deriveSecret"><span class="hs-identifier hs-var">deriveSecret</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191481"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191482"><span class="hs-identifier hs-var">earlySecret</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;c e traffic&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191478"><span class="hs-identifier hs-var">hCh</span></a></span><span>
</span><span id="line-446"></span><span>        </span><span id="local-6989586621679191489"><span class="annot"><span class="annottext">cets :: ClientTrafficSecret EarlySecret
</span><a href="#local-6989586621679191489"><span class="hs-identifier hs-var hs-var">cets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ClientTrafficSecret EarlySecret
forall a. ByteString -&gt; ClientTrafficSecret a
</span><a href="Network.TLS.Types.html#ClientTrafficSecret"><span class="hs-identifier hs-var">ClientTrafficSecret</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191488"><span class="hs-identifier hs-var">clientEarlySecret</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#ClientTrafficSecret"><span class="hs-identifier hs-type">ClientTrafficSecret</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#EarlySecret"><span class="hs-identifier hs-type">EarlySecret</span></a></span><span>
</span><span id="line-447"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; ClientTrafficSecret EarlySecret -&gt; IO ()
forall a. LogLabel a =&gt; Context -&gt; a -&gt; IO ()
</span><a href="Network.TLS.Handshake.Key.html#logKey"><span class="hs-identifier hs-var">logKey</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191474"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ClientTrafficSecret EarlySecret
</span><a href="#local-6989586621679191489"><span class="hs-identifier hs-var">cets</span></a></span><span>
</span><span id="line-448"></span><span>    </span><span class="annot"><span class="annottext">SecretPair EarlySecret -&gt; IO (SecretPair EarlySecret)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(SecretPair EarlySecret -&gt; IO (SecretPair EarlySecret))
-&gt; SecretPair EarlySecret -&gt; IO (SecretPair EarlySecret)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BaseSecret EarlySecret
-&gt; ClientTrafficSecret EarlySecret -&gt; SecretPair EarlySecret
forall a. BaseSecret a -&gt; ClientTrafficSecret a -&gt; SecretPair a
</span><a href="Network.TLS.Types.html#SecretPair"><span class="hs-identifier hs-var">SecretPair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; BaseSecret EarlySecret
forall a. ByteString -&gt; BaseSecret a
</span><a href="Network.TLS.Types.html#BaseSecret"><span class="hs-identifier hs-var">BaseSecret</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191482"><span class="hs-identifier hs-var">earlySecret</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ClientTrafficSecret EarlySecret
</span><a href="#local-6989586621679191489"><span class="hs-identifier hs-var">cets</span></a></span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-450"></span><span>    </span><span id="local-6989586621679191481"><span class="annot"><span class="annottext">usedHash :: Hash
</span><a href="#local-6989586621679191481"><span class="hs-identifier hs-var hs-var">usedHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CipherChoice -&gt; Hash
</span><a href="Network.TLS.Handshake.Common13.html#cHash"><span class="hs-identifier hs-var">cHash</span></a></span><span> </span><span class="annot"><span class="annottext">CipherChoice
</span><a href="#local-6989586621679191475"><span class="hs-identifier hs-var">choice</span></a></span><span>
</span><span id="line-451"></span><span>    </span><span id="local-6989586621679191486"><span class="annot"><span class="annottext">zero :: ByteString
</span><a href="#local-6989586621679191486"><span class="hs-identifier hs-var hs-var">zero</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CipherChoice -&gt; ByteString
</span><a href="Network.TLS.Handshake.Common13.html#cZero"><span class="hs-identifier hs-var">cZero</span></a></span><span> </span><span class="annot"><span class="annottext">CipherChoice
</span><a href="#local-6989586621679191475"><span class="hs-identifier hs-var">choice</span></a></span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#initEarlySecret"><span class="hs-identifier hs-type">initEarlySecret</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#CipherChoice"><span class="hs-identifier hs-type">CipherChoice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#BaseSecret"><span class="hs-identifier hs-type">BaseSecret</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#EarlySecret"><span class="hs-identifier hs-type">EarlySecret</span></a></span><span>
</span><span id="line-454"></span><span id="initEarlySecret"><span class="annot"><span class="annottext">initEarlySecret :: CipherChoice -&gt; Maybe ByteString -&gt; BaseSecret EarlySecret
</span><a href="Network.TLS.Handshake.Common13.html#initEarlySecret"><span class="hs-identifier hs-var hs-var">initEarlySecret</span></a></span></span><span> </span><span id="local-6989586621679191493"><span class="annot"><span class="annottext">CipherChoice
</span><a href="#local-6989586621679191493"><span class="hs-identifier hs-var">choice</span></a></span></span><span> </span><span id="local-6989586621679191494"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679191494"><span class="hs-identifier hs-var">mpsk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; BaseSecret EarlySecret
forall a. ByteString -&gt; BaseSecret a
</span><a href="Network.TLS.Types.html#BaseSecret"><span class="hs-identifier hs-var">BaseSecret</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191495"><span class="hs-identifier hs-var">sec</span></a></span><span>
</span><span id="line-455"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-456"></span><span>    </span><span id="local-6989586621679191495"><span class="annot"><span class="annottext">sec :: ByteString
</span><a href="#local-6989586621679191495"><span class="hs-identifier hs-var hs-var">sec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.KeySchedule.html#hkdfExtract"><span class="hs-identifier hs-var">hkdfExtract</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191496"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191497"><span class="hs-identifier hs-var">zero</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191498"><span class="hs-identifier hs-var">zeroOrPSK</span></a></span><span>
</span><span id="line-457"></span><span>    </span><span id="local-6989586621679191496"><span class="annot"><span class="annottext">usedHash :: Hash
</span><a href="#local-6989586621679191496"><span class="hs-identifier hs-var hs-var">usedHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CipherChoice -&gt; Hash
</span><a href="Network.TLS.Handshake.Common13.html#cHash"><span class="hs-identifier hs-var">cHash</span></a></span><span> </span><span class="annot"><span class="annottext">CipherChoice
</span><a href="#local-6989586621679191493"><span class="hs-identifier hs-var">choice</span></a></span><span>
</span><span id="line-458"></span><span>    </span><span id="local-6989586621679191497"><span class="annot"><span class="annottext">zero :: ByteString
</span><a href="#local-6989586621679191497"><span class="hs-identifier hs-var hs-var">zero</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CipherChoice -&gt; ByteString
</span><a href="Network.TLS.Handshake.Common13.html#cZero"><span class="hs-identifier hs-var">cZero</span></a></span><span> </span><span class="annot"><span class="annottext">CipherChoice
</span><a href="#local-6989586621679191493"><span class="hs-identifier hs-var">choice</span></a></span><span>
</span><span id="line-459"></span><span>    </span><span id="local-6989586621679191498"><span class="annot"><span class="annottext">zeroOrPSK :: ByteString
</span><a href="#local-6989586621679191498"><span class="hs-identifier hs-var hs-var">zeroOrPSK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679191494"><span class="hs-identifier hs-var">mpsk</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-460"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679191499"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191499"><span class="hs-identifier hs-var">psk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191499"><span class="hs-identifier hs-var">psk</span></a></span><span>
</span><span id="line-461"></span><span>      </span><span class="annot"><span class="annottext">Maybe ByteString
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191497"><span class="hs-identifier hs-var">zero</span></a></span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#calculateHandshakeSecret"><span class="hs-identifier hs-type">calculateHandshakeSecret</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#CipherChoice"><span class="hs-identifier hs-type">CipherChoice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#BaseSecret"><span class="hs-identifier hs-type">BaseSecret</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#EarlySecret"><span class="hs-identifier hs-type">EarlySecret</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-464"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Types.html#SecretTriple"><span class="hs-identifier hs-type">SecretTriple</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#HandshakeSecret"><span class="hs-identifier hs-type">HandshakeSecret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span id="calculateHandshakeSecret"><span class="annot"><span class="annottext">calculateHandshakeSecret :: Context
-&gt; CipherChoice
-&gt; BaseSecret EarlySecret
-&gt; ByteString
-&gt; IO (SecretTriple HandshakeSecret)
</span><a href="Network.TLS.Handshake.Common13.html#calculateHandshakeSecret"><span class="hs-identifier hs-var hs-var">calculateHandshakeSecret</span></a></span></span><span> </span><span id="local-6989586621679191500"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191500"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679191501"><span class="annot"><span class="annottext">CipherChoice
</span><a href="#local-6989586621679191501"><span class="hs-identifier hs-var">choice</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Types.html#BaseSecret"><span class="hs-identifier hs-type">BaseSecret</span></a></span><span> </span><span id="local-6989586621679191502"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191502"><span class="hs-identifier hs-var">sec</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679191503"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191503"><span class="hs-identifier hs-var">ecdhe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-466"></span><span>        </span><span id="local-6989586621679191504"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191504"><span class="hs-identifier hs-var">hChSh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO ByteString
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m ByteString
</span><a href="Network.TLS.Handshake.State13.html#transcriptHash"><span class="hs-identifier hs-var">transcriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191500"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-467"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191507"><span class="annot"><span class="annottext">handshakeSecret :: ByteString
</span><a href="#local-6989586621679191507"><span class="hs-identifier hs-var hs-var">handshakeSecret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.KeySchedule.html#hkdfExtract"><span class="hs-identifier hs-var">hkdfExtract</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191508"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.KeySchedule.html#deriveSecret"><span class="hs-identifier hs-var">deriveSecret</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191508"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191502"><span class="hs-identifier hs-var">sec</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;derived&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.Crypto.html#hash"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191508"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191503"><span class="hs-identifier hs-var">ecdhe</span></a></span><span>
</span><span id="line-468"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191510"><span class="annot"><span class="annottext">clientHandshakeSecret :: ByteString
</span><a href="#local-6989586621679191510"><span class="hs-identifier hs-var hs-var">clientHandshakeSecret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.KeySchedule.html#deriveSecret"><span class="hs-identifier hs-var">deriveSecret</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191508"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191507"><span class="hs-identifier hs-var">handshakeSecret</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;c hs traffic&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191504"><span class="hs-identifier hs-var">hChSh</span></a></span><span>
</span><span id="line-469"></span><span>            </span><span id="local-6989586621679191512"><span class="annot"><span class="annottext">serverHandshakeSecret :: ByteString
</span><a href="#local-6989586621679191512"><span class="hs-identifier hs-var hs-var">serverHandshakeSecret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.KeySchedule.html#deriveSecret"><span class="hs-identifier hs-var">deriveSecret</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191508"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191507"><span class="hs-identifier hs-var">handshakeSecret</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;s hs traffic&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191504"><span class="hs-identifier hs-var">hChSh</span></a></span><span>
</span><span id="line-470"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191513"><span class="annot"><span class="annottext">shts :: ServerTrafficSecret HandshakeSecret
</span><a href="#local-6989586621679191513"><span class="hs-identifier hs-var hs-var">shts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ServerTrafficSecret HandshakeSecret
forall a. ByteString -&gt; ServerTrafficSecret a
</span><a href="Network.TLS.Types.html#ServerTrafficSecret"><span class="hs-identifier hs-var">ServerTrafficSecret</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191512"><span class="hs-identifier hs-var">serverHandshakeSecret</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#ServerTrafficSecret"><span class="hs-identifier hs-type">ServerTrafficSecret</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#HandshakeSecret"><span class="hs-identifier hs-type">HandshakeSecret</span></a></span><span>
</span><span id="line-471"></span><span>            </span><span id="local-6989586621679191515"><span class="annot"><span class="annottext">chts :: ClientTrafficSecret HandshakeSecret
</span><a href="#local-6989586621679191515"><span class="hs-identifier hs-var hs-var">chts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ClientTrafficSecret HandshakeSecret
forall a. ByteString -&gt; ClientTrafficSecret a
</span><a href="Network.TLS.Types.html#ClientTrafficSecret"><span class="hs-identifier hs-var">ClientTrafficSecret</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191510"><span class="hs-identifier hs-var">clientHandshakeSecret</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#ClientTrafficSecret"><span class="hs-identifier hs-type">ClientTrafficSecret</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#HandshakeSecret"><span class="hs-identifier hs-type">HandshakeSecret</span></a></span><span>
</span><span id="line-472"></span><span>        </span><span class="annot"><span class="annottext">Context -&gt; ServerTrafficSecret HandshakeSecret -&gt; IO ()
forall a. LogLabel a =&gt; Context -&gt; a -&gt; IO ()
</span><a href="Network.TLS.Handshake.Key.html#logKey"><span class="hs-identifier hs-var">logKey</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191500"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ServerTrafficSecret HandshakeSecret
</span><a href="#local-6989586621679191513"><span class="hs-identifier hs-var">shts</span></a></span><span>
</span><span id="line-473"></span><span>        </span><span class="annot"><span class="annottext">Context -&gt; ClientTrafficSecret HandshakeSecret -&gt; IO ()
forall a. LogLabel a =&gt; Context -&gt; a -&gt; IO ()
</span><a href="Network.TLS.Handshake.Key.html#logKey"><span class="hs-identifier hs-var">logKey</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191500"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ClientTrafficSecret HandshakeSecret
</span><a href="#local-6989586621679191515"><span class="hs-identifier hs-var">chts</span></a></span><span>
</span><span id="line-474"></span><span>        </span><span class="annot"><span class="annottext">SecretTriple HandshakeSecret -&gt; IO (SecretTriple HandshakeSecret)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(SecretTriple HandshakeSecret -&gt; IO (SecretTriple HandshakeSecret))
-&gt; SecretTriple HandshakeSecret
-&gt; IO (SecretTriple HandshakeSecret)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BaseSecret HandshakeSecret
-&gt; ClientTrafficSecret HandshakeSecret
-&gt; ServerTrafficSecret HandshakeSecret
-&gt; SecretTriple HandshakeSecret
forall a.
BaseSecret a
-&gt; ClientTrafficSecret a -&gt; ServerTrafficSecret a -&gt; SecretTriple a
</span><a href="Network.TLS.Types.html#SecretTriple"><span class="hs-identifier hs-var">SecretTriple</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; BaseSecret HandshakeSecret
forall a. ByteString -&gt; BaseSecret a
</span><a href="Network.TLS.Types.html#BaseSecret"><span class="hs-identifier hs-var">BaseSecret</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191507"><span class="hs-identifier hs-var">handshakeSecret</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ClientTrafficSecret HandshakeSecret
</span><a href="#local-6989586621679191515"><span class="hs-identifier hs-var">chts</span></a></span><span> </span><span class="annot"><span class="annottext">ServerTrafficSecret HandshakeSecret
</span><a href="#local-6989586621679191513"><span class="hs-identifier hs-var">shts</span></a></span><span>
</span><span id="line-475"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-476"></span><span>    </span><span id="local-6989586621679191508"><span class="annot"><span class="annottext">usedHash :: Hash
</span><a href="#local-6989586621679191508"><span class="hs-identifier hs-var hs-var">usedHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CipherChoice -&gt; Hash
</span><a href="Network.TLS.Handshake.Common13.html#cHash"><span class="hs-identifier hs-var">cHash</span></a></span><span> </span><span class="annot"><span class="annottext">CipherChoice
</span><a href="#local-6989586621679191501"><span class="hs-identifier hs-var">choice</span></a></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#calculateApplicationSecret"><span class="hs-identifier hs-type">calculateApplicationSecret</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#CipherChoice"><span class="hs-identifier hs-type">CipherChoice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#BaseSecret"><span class="hs-identifier hs-type">BaseSecret</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#HandshakeSecret"><span class="hs-identifier hs-type">HandshakeSecret</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-479"></span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Types.html#SecretTriple"><span class="hs-identifier hs-type">SecretTriple</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#ApplicationSecret"><span class="hs-identifier hs-type">ApplicationSecret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span id="calculateApplicationSecret"><span class="annot"><span class="annottext">calculateApplicationSecret :: Context
-&gt; CipherChoice
-&gt; BaseSecret HandshakeSecret
-&gt; ByteString
-&gt; IO (SecretTriple ApplicationSecret)
</span><a href="Network.TLS.Handshake.Common13.html#calculateApplicationSecret"><span class="hs-identifier hs-var hs-var">calculateApplicationSecret</span></a></span></span><span> </span><span id="local-6989586621679191517"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191517"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679191518"><span class="annot"><span class="annottext">CipherChoice
</span><a href="#local-6989586621679191518"><span class="hs-identifier hs-var">choice</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Types.html#BaseSecret"><span class="hs-identifier hs-type">BaseSecret</span></a></span><span> </span><span id="local-6989586621679191519"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191519"><span class="hs-identifier hs-var">sec</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679191520"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191520"><span class="hs-identifier hs-var">hChSf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-481"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191523"><span class="annot"><span class="annottext">applicationSecret :: ByteString
</span><a href="#local-6989586621679191523"><span class="hs-identifier hs-var hs-var">applicationSecret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.KeySchedule.html#hkdfExtract"><span class="hs-identifier hs-var">hkdfExtract</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191524"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.KeySchedule.html#deriveSecret"><span class="hs-identifier hs-var">deriveSecret</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191524"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191519"><span class="hs-identifier hs-var">sec</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;derived&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.Crypto.html#hash"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191524"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191525"><span class="hs-identifier hs-var">zero</span></a></span><span>
</span><span id="line-482"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191527"><span class="annot"><span class="annottext">clientApplicationSecret0 :: ByteString
</span><a href="#local-6989586621679191527"><span class="hs-identifier hs-var hs-var">clientApplicationSecret0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.KeySchedule.html#deriveSecret"><span class="hs-identifier hs-var">deriveSecret</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191524"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191523"><span class="hs-identifier hs-var">applicationSecret</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;c ap traffic&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191520"><span class="hs-identifier hs-var">hChSf</span></a></span><span>
</span><span id="line-483"></span><span>        </span><span id="local-6989586621679191529"><span class="annot"><span class="annottext">serverApplicationSecret0 :: ByteString
</span><a href="#local-6989586621679191529"><span class="hs-identifier hs-var hs-var">serverApplicationSecret0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.KeySchedule.html#deriveSecret"><span class="hs-identifier hs-var">deriveSecret</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191524"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191523"><span class="hs-identifier hs-var">applicationSecret</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;s ap traffic&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191520"><span class="hs-identifier hs-var">hChSf</span></a></span><span>
</span><span id="line-484"></span><span>        </span><span id="local-6989586621679191531"><span class="annot"><span class="annottext">exporterMasterSecret :: ByteString
</span><a href="#local-6989586621679191531"><span class="hs-identifier hs-var hs-var">exporterMasterSecret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.KeySchedule.html#deriveSecret"><span class="hs-identifier hs-var">deriveSecret</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191524"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191523"><span class="hs-identifier hs-var">applicationSecret</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;exp master&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191520"><span class="hs-identifier hs-var">hChSf</span></a></span><span>
</span><span id="line-485"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; TLSSt () -&gt; IO ()
forall a. Context -&gt; TLSSt a -&gt; IO a
</span><a href="Network.TLS.Context.Internal.html#usingState_"><span class="hs-identifier hs-var">usingState_</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191517"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(TLSSt () -&gt; IO ()) -&gt; TLSSt () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TLSSt ()
</span><a href="Network.TLS.State.html#setExporterMasterSecret"><span class="hs-identifier hs-var">setExporterMasterSecret</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191531"><span class="hs-identifier hs-var">exporterMasterSecret</span></a></span><span>
</span><span id="line-486"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191533"><span class="annot"><span class="annottext">sts0 :: ServerTrafficSecret ApplicationSecret
</span><a href="#local-6989586621679191533"><span class="hs-identifier hs-var hs-var">sts0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ServerTrafficSecret ApplicationSecret
forall a. ByteString -&gt; ServerTrafficSecret a
</span><a href="Network.TLS.Types.html#ServerTrafficSecret"><span class="hs-identifier hs-var">ServerTrafficSecret</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191529"><span class="hs-identifier hs-var">serverApplicationSecret0</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#ServerTrafficSecret"><span class="hs-identifier hs-type">ServerTrafficSecret</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#ApplicationSecret"><span class="hs-identifier hs-type">ApplicationSecret</span></a></span><span>
</span><span id="line-487"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191534"><span class="annot"><span class="annottext">cts0 :: ClientTrafficSecret ApplicationSecret
</span><a href="#local-6989586621679191534"><span class="hs-identifier hs-var hs-var">cts0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ClientTrafficSecret ApplicationSecret
forall a. ByteString -&gt; ClientTrafficSecret a
</span><a href="Network.TLS.Types.html#ClientTrafficSecret"><span class="hs-identifier hs-var">ClientTrafficSecret</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191527"><span class="hs-identifier hs-var">clientApplicationSecret0</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#ClientTrafficSecret"><span class="hs-identifier hs-type">ClientTrafficSecret</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#ApplicationSecret"><span class="hs-identifier hs-type">ApplicationSecret</span></a></span><span>
</span><span id="line-488"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; ServerTrafficSecret ApplicationSecret -&gt; IO ()
forall a. LogLabel a =&gt; Context -&gt; a -&gt; IO ()
</span><a href="Network.TLS.Handshake.Key.html#logKey"><span class="hs-identifier hs-var">logKey</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191517"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ServerTrafficSecret ApplicationSecret
</span><a href="#local-6989586621679191533"><span class="hs-identifier hs-var">sts0</span></a></span><span>
</span><span id="line-489"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; ClientTrafficSecret ApplicationSecret -&gt; IO ()
forall a. LogLabel a =&gt; Context -&gt; a -&gt; IO ()
</span><a href="Network.TLS.Handshake.Key.html#logKey"><span class="hs-identifier hs-var">logKey</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191517"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ClientTrafficSecret ApplicationSecret
</span><a href="#local-6989586621679191534"><span class="hs-identifier hs-var">cts0</span></a></span><span>
</span><span id="line-490"></span><span>    </span><span class="annot"><span class="annottext">SecretTriple ApplicationSecret
-&gt; IO (SecretTriple ApplicationSecret)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(SecretTriple ApplicationSecret
 -&gt; IO (SecretTriple ApplicationSecret))
-&gt; SecretTriple ApplicationSecret
-&gt; IO (SecretTriple ApplicationSecret)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BaseSecret ApplicationSecret
-&gt; ClientTrafficSecret ApplicationSecret
-&gt; ServerTrafficSecret ApplicationSecret
-&gt; SecretTriple ApplicationSecret
forall a.
BaseSecret a
-&gt; ClientTrafficSecret a -&gt; ServerTrafficSecret a -&gt; SecretTriple a
</span><a href="Network.TLS.Types.html#SecretTriple"><span class="hs-identifier hs-var">SecretTriple</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; BaseSecret ApplicationSecret
forall a. ByteString -&gt; BaseSecret a
</span><a href="Network.TLS.Types.html#BaseSecret"><span class="hs-identifier hs-var">BaseSecret</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191523"><span class="hs-identifier hs-var">applicationSecret</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ClientTrafficSecret ApplicationSecret
</span><a href="#local-6989586621679191534"><span class="hs-identifier hs-var">cts0</span></a></span><span> </span><span class="annot"><span class="annottext">ServerTrafficSecret ApplicationSecret
</span><a href="#local-6989586621679191533"><span class="hs-identifier hs-var">sts0</span></a></span><span>
</span><span id="line-491"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-492"></span><span>    </span><span id="local-6989586621679191524"><span class="annot"><span class="annottext">usedHash :: Hash
</span><a href="#local-6989586621679191524"><span class="hs-identifier hs-var hs-var">usedHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CipherChoice -&gt; Hash
</span><a href="Network.TLS.Handshake.Common13.html#cHash"><span class="hs-identifier hs-var">cHash</span></a></span><span> </span><span class="annot"><span class="annottext">CipherChoice
</span><a href="#local-6989586621679191518"><span class="hs-identifier hs-var">choice</span></a></span><span>
</span><span id="line-493"></span><span>    </span><span id="local-6989586621679191525"><span class="annot"><span class="annottext">zero :: ByteString
</span><a href="#local-6989586621679191525"><span class="hs-identifier hs-var hs-var">zero</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CipherChoice -&gt; ByteString
</span><a href="Network.TLS.Handshake.Common13.html#cZero"><span class="hs-identifier hs-var">cZero</span></a></span><span> </span><span class="annot"><span class="annottext">CipherChoice
</span><a href="#local-6989586621679191518"><span class="hs-identifier hs-var">choice</span></a></span><span>
</span><span id="line-494"></span><span>
</span><span id="line-495"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#calculateResumptionSecret"><span class="hs-identifier hs-type">calculateResumptionSecret</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#CipherChoice"><span class="hs-identifier hs-type">CipherChoice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#BaseSecret"><span class="hs-identifier hs-type">BaseSecret</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#ApplicationSecret"><span class="hs-identifier hs-type">ApplicationSecret</span></a></span><span>
</span><span id="line-496"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Types.html#BaseSecret"><span class="hs-identifier hs-type">BaseSecret</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#ResumptionSecret"><span class="hs-identifier hs-type">ResumptionSecret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span id="calculateResumptionSecret"><span class="annot"><span class="annottext">calculateResumptionSecret :: Context
-&gt; CipherChoice
-&gt; BaseSecret ApplicationSecret
-&gt; IO (BaseSecret ResumptionSecret)
</span><a href="Network.TLS.Handshake.Common13.html#calculateResumptionSecret"><span class="hs-identifier hs-var hs-var">calculateResumptionSecret</span></a></span></span><span> </span><span id="local-6989586621679191535"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191535"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679191536"><span class="annot"><span class="annottext">CipherChoice
</span><a href="#local-6989586621679191536"><span class="hs-identifier hs-var">choice</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Types.html#BaseSecret"><span class="hs-identifier hs-type">BaseSecret</span></a></span><span> </span><span id="local-6989586621679191537"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191537"><span class="hs-identifier hs-var">sec</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-498"></span><span>    </span><span id="local-6989586621679191538"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191538"><span class="hs-identifier hs-var">hChCf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO ByteString
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m ByteString
</span><a href="Network.TLS.Handshake.State13.html#transcriptHash"><span class="hs-identifier hs-var">transcriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679191535"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-499"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679191540"><span class="annot"><span class="annottext">resumptionMasterSecret :: ByteString
</span><a href="#local-6989586621679191540"><span class="hs-identifier hs-var hs-var">resumptionMasterSecret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.KeySchedule.html#deriveSecret"><span class="hs-identifier hs-var">deriveSecret</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191541"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191537"><span class="hs-identifier hs-var">sec</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;res master&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191538"><span class="hs-identifier hs-var">hChCf</span></a></span><span>
</span><span id="line-500"></span><span>    </span><span class="annot"><span class="annottext">BaseSecret ResumptionSecret -&gt; IO (BaseSecret ResumptionSecret)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(BaseSecret ResumptionSecret -&gt; IO (BaseSecret ResumptionSecret))
-&gt; BaseSecret ResumptionSecret -&gt; IO (BaseSecret ResumptionSecret)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; BaseSecret ResumptionSecret
forall a. ByteString -&gt; BaseSecret a
</span><a href="Network.TLS.Types.html#BaseSecret"><span class="hs-identifier hs-var">BaseSecret</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191540"><span class="hs-identifier hs-var">resumptionMasterSecret</span></a></span><span>
</span><span id="line-501"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-502"></span><span>    </span><span id="local-6989586621679191541"><span class="annot"><span class="annottext">usedHash :: Hash
</span><a href="#local-6989586621679191541"><span class="hs-identifier hs-var hs-var">usedHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CipherChoice -&gt; Hash
</span><a href="Network.TLS.Handshake.Common13.html#cHash"><span class="hs-identifier hs-var">cHash</span></a></span><span> </span><span class="annot"><span class="annottext">CipherChoice
</span><a href="#local-6989586621679191536"><span class="hs-identifier hs-var">choice</span></a></span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#derivePSK"><span class="hs-identifier hs-type">derivePSK</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#CipherChoice"><span class="hs-identifier hs-type">CipherChoice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#BaseSecret"><span class="hs-identifier hs-type">BaseSecret</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#ResumptionSecret"><span class="hs-identifier hs-type">ResumptionSecret</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-505"></span><span id="derivePSK"><span class="annot"><span class="annottext">derivePSK :: CipherChoice
-&gt; BaseSecret ResumptionSecret -&gt; ByteString -&gt; ByteString
</span><a href="Network.TLS.Handshake.Common13.html#derivePSK"><span class="hs-identifier hs-var hs-var">derivePSK</span></a></span></span><span> </span><span id="local-6989586621679191542"><span class="annot"><span class="annottext">CipherChoice
</span><a href="#local-6989586621679191542"><span class="hs-identifier hs-var">choice</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Types.html#BaseSecret"><span class="hs-identifier hs-type">BaseSecret</span></a></span><span> </span><span id="local-6989586621679191543"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191543"><span class="hs-identifier hs-var">sec</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679191544"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191544"><span class="hs-identifier hs-var">nonce</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-506"></span><span>    </span><span class="annot"><span class="annottext">Hash -&gt; ByteString -&gt; ByteString -&gt; ByteString -&gt; Int -&gt; ByteString
</span><a href="Network.TLS.KeySchedule.html#hkdfExpandLabel"><span class="hs-identifier hs-var">hkdfExpandLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191545"><span class="hs-identifier hs-var">usedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191543"><span class="hs-identifier hs-var">sec</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;resumption&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191544"><span class="hs-identifier hs-var">nonce</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679191546"><span class="hs-identifier hs-var">hashSize</span></a></span><span>
</span><span id="line-507"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-508"></span><span>    </span><span id="local-6989586621679191545"><span class="annot"><span class="annottext">usedHash :: Hash
</span><a href="#local-6989586621679191545"><span class="hs-identifier hs-var hs-var">usedHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CipherChoice -&gt; Hash
</span><a href="Network.TLS.Handshake.Common13.html#cHash"><span class="hs-identifier hs-var">cHash</span></a></span><span> </span><span class="annot"><span class="annottext">CipherChoice
</span><a href="#local-6989586621679191542"><span class="hs-identifier hs-var">choice</span></a></span><span>
</span><span id="line-509"></span><span>    </span><span id="local-6989586621679191546"><span class="annot"><span class="annottext">hashSize :: Int
</span><a href="#local-6989586621679191546"><span class="hs-identifier hs-var hs-var">hashSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; Int
</span><a href="Network.TLS.Crypto.html#hashDigestSize"><span class="hs-identifier hs-var">hashDigestSize</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679191545"><span class="hs-identifier hs-var">usedHash</span></a></span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-512"></span><span>
</span><span id="line-513"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#checkKeyShareKeyLength"><span class="hs-identifier hs-type">checkKeyShareKeyLength</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Extension.html#KeyShareEntry"><span class="hs-identifier hs-type">KeyShareEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-514"></span><span id="checkKeyShareKeyLength"><span class="annot"><span class="annottext">checkKeyShareKeyLength :: KeyShareEntry -&gt; Bool
</span><a href="Network.TLS.Handshake.Common13.html#checkKeyShareKeyLength"><span class="hs-identifier hs-var hs-var">checkKeyShareKeyLength</span></a></span></span><span> </span><span id="local-6989586621679191547"><span class="annot"><span class="annottext">KeyShareEntry
</span><a href="#local-6989586621679191547"><span class="hs-identifier hs-var">ks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Group -&gt; Int
</span><a href="Network.TLS.Handshake.Common13.html#keyShareKeyLength"><span class="hs-identifier hs-var">keyShareKeyLength</span></a></span><span> </span><span class="annot"><span class="annottext">Group
</span><a href="#local-6989586621679191549"><span class="hs-identifier hs-var">grp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679191550"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-515"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-516"></span><span>    </span><span id="local-6989586621679191549"><span class="annot"><span class="annottext">grp :: Group
</span><a href="#local-6989586621679191549"><span class="hs-identifier hs-var hs-var">grp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KeyShareEntry -&gt; Group
</span><a href="Network.TLS.Extension.html#keyShareEntryGroup"><span class="hs-identifier hs-var">keyShareEntryGroup</span></a></span><span> </span><span class="annot"><span class="annottext">KeyShareEntry
</span><a href="#local-6989586621679191547"><span class="hs-identifier hs-var">ks</span></a></span><span>
</span><span id="line-517"></span><span>    </span><span id="local-6989586621679191550"><span class="annot"><span class="annottext">key :: ByteString
</span><a href="#local-6989586621679191550"><span class="hs-identifier hs-var hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KeyShareEntry -&gt; ByteString
</span><a href="Network.TLS.Extension.html#keyShareEntryKeyExchange"><span class="hs-identifier hs-var">keyShareEntryKeyExchange</span></a></span><span> </span><span class="annot"><span class="annottext">KeyShareEntry
</span><a href="#local-6989586621679191547"><span class="hs-identifier hs-var">ks</span></a></span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#keyShareKeyLength"><span class="hs-identifier hs-type">keyShareKeyLength</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Crypto.Types.html#Group"><span class="hs-identifier hs-type">Group</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-520"></span><span id="keyShareKeyLength"><span class="annot"><span class="annottext">keyShareKeyLength :: Group -&gt; Int
</span><a href="Network.TLS.Handshake.Common13.html#keyShareKeyLength"><span class="hs-identifier hs-var hs-var">keyShareKeyLength</span></a></span></span><span> </span><span class="annot"><span class="annottext">Group
</span><a href="Network.TLS.Crypto.Types.html#P256"><span class="hs-identifier hs-var">P256</span></a></span><span>      </span><span class="hs-glyph">=</span><span>   </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">65</span></span><span> </span><span class="hs-comment">-- 32 * 2 + 1</span><span>
</span><span id="line-521"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#keyShareKeyLength"><span class="hs-identifier hs-var">keyShareKeyLength</span></a></span><span> </span><span class="annot"><span class="annottext">Group
</span><a href="Network.TLS.Crypto.Types.html#P384"><span class="hs-identifier hs-var">P384</span></a></span><span>      </span><span class="hs-glyph">=</span><span>   </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">97</span></span><span> </span><span class="hs-comment">-- 48 * 2 + 1</span><span>
</span><span id="line-522"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#keyShareKeyLength"><span class="hs-identifier hs-var">keyShareKeyLength</span></a></span><span> </span><span class="annot"><span class="annottext">Group
</span><a href="Network.TLS.Crypto.Types.html#P521"><span class="hs-identifier hs-var">P521</span></a></span><span>      </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">133</span></span><span> </span><span class="hs-comment">-- 66 * 2 + 1</span><span>
</span><span id="line-523"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#keyShareKeyLength"><span class="hs-identifier hs-var">keyShareKeyLength</span></a></span><span> </span><span class="annot"><span class="annottext">Group
</span><a href="Network.TLS.Crypto.Types.html#X25519"><span class="hs-identifier hs-var">X25519</span></a></span><span>    </span><span class="hs-glyph">=</span><span>   </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span>
</span><span id="line-524"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#keyShareKeyLength"><span class="hs-identifier hs-var">keyShareKeyLength</span></a></span><span> </span><span class="annot"><span class="annottext">Group
</span><a href="Network.TLS.Crypto.Types.html#X448"><span class="hs-identifier hs-var">X448</span></a></span><span>      </span><span class="hs-glyph">=</span><span>   </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">56</span></span><span>
</span><span id="line-525"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#keyShareKeyLength"><span class="hs-identifier hs-var">keyShareKeyLength</span></a></span><span> </span><span class="annot"><span class="annottext">Group
</span><a href="Network.TLS.Crypto.Types.html#FFDHE2048"><span class="hs-identifier hs-var">FFDHE2048</span></a></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">256</span></span><span>
</span><span id="line-526"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#keyShareKeyLength"><span class="hs-identifier hs-var">keyShareKeyLength</span></a></span><span> </span><span class="annot"><span class="annottext">Group
</span><a href="Network.TLS.Crypto.Types.html#FFDHE3072"><span class="hs-identifier hs-var">FFDHE3072</span></a></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">384</span></span><span>
</span><span id="line-527"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#keyShareKeyLength"><span class="hs-identifier hs-var">keyShareKeyLength</span></a></span><span> </span><span class="annot"><span class="annottext">Group
</span><a href="Network.TLS.Crypto.Types.html#FFDHE4096"><span class="hs-identifier hs-var">FFDHE4096</span></a></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">512</span></span><span>
</span><span id="line-528"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#keyShareKeyLength"><span class="hs-identifier hs-var">keyShareKeyLength</span></a></span><span> </span><span class="annot"><span class="annottext">Group
</span><a href="Network.TLS.Crypto.Types.html#FFDHE6144"><span class="hs-identifier hs-var">FFDHE6144</span></a></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">768</span></span><span>
</span><span id="line-529"></span><span class="annot"><a href="Network.TLS.Handshake.Common13.html#keyShareKeyLength"><span class="hs-identifier hs-var">keyShareKeyLength</span></a></span><span> </span><span class="annot"><span class="annottext">Group
</span><a href="Network.TLS.Crypto.Types.html#FFDHE8192"><span class="hs-identifier hs-var">FFDHE8192</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1024</span></span><span>
</span><span id="line-530"></span></pre></body></html>