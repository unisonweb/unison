<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.TLS.Handshake.Common</span><span>
</span><span id="line-4"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#handshakeFailed"><span class="hs-identifier">handshakeFailed</span></a></span><span>
</span><span id="line-5"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#handleException"><span class="hs-identifier">handleException</span></a></span><span>
</span><span id="line-6"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#unexpected"><span class="hs-identifier">unexpected</span></a></span><span>
</span><span id="line-7"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#newSession"><span class="hs-identifier">newSession</span></a></span><span>
</span><span id="line-8"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#handshakeTerminate"><span class="hs-identifier">handshakeTerminate</span></a></span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><span class="hs-comment">-- * sending packets</span></span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#sendChangeCipherAndFinish"><span class="hs-identifier">sendChangeCipherAndFinish</span></a></span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><span class="hs-comment">-- * receiving packets</span></span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#recvChangeCipherAndFinish"><span class="hs-identifier">recvChangeCipherAndFinish</span></a></span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#RecvState"><span class="hs-identifier">RecvState</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#runRecvState"><span class="hs-identifier">runRecvState</span></a></span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#recvPacketHandshake"><span class="hs-identifier">recvPacketHandshake</span></a></span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#onRecvStateHandshake"><span class="hs-identifier">onRecvStateHandshake</span></a></span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#ensureRecvComplete"><span class="hs-identifier">ensureRecvComplete</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#processExtendedMasterSec"><span class="hs-identifier">processExtendedMasterSec</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#extensionLookup"><span class="hs-identifier">extensionLookup</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#getSessionData"><span class="hs-identifier">getSessionData</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#storePrivInfo"><span class="hs-identifier">storePrivInfo</span></a></span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#isSupportedGroup"><span class="hs-identifier">isSupportedGroup</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#checkSupportedGroup"><span class="hs-identifier">checkSupportedGroup</span></a></span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#errorToAlert"><span class="hs-identifier">errorToAlert</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#errorToAlertMessage"><span class="hs-identifier">errorToAlertMessage</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.MVar</span></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Parameters.html"><span class="hs-identifier">Network.TLS.Parameters</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Compression.html"><span class="hs-identifier">Network.TLS.Compression</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html"><span class="hs-identifier">Network.TLS.Context.Internal</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Extension.html"><span class="hs-identifier">Network.TLS.Extension</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Session.html"><span class="hs-identifier">Network.TLS.Session</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Struct.html"><span class="hs-identifier">Network.TLS.Struct</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Struct13.html"><span class="hs-identifier">Network.TLS.Struct13</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.IO.html"><span class="hs-identifier">Network.TLS.IO</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.State.html"><span class="hs-identifier">Network.TLS.State</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Key.html"><span class="hs-identifier">Network.TLS.Handshake.Key</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Process.html"><span class="hs-identifier">Network.TLS.Handshake.Process</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html"><span class="hs-identifier">Network.TLS.Handshake.State</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Record.State.html"><span class="hs-identifier">Network.TLS.Record.State</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Measurement.html"><span class="hs-identifier">Network.TLS.Measurement</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Types.html"><span class="hs-identifier">Network.TLS.Types</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Cipher.html"><span class="hs-identifier">Network.TLS.Cipher</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Crypto.html"><span class="hs-identifier">Network.TLS.Crypto</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Util.html"><span class="hs-identifier">Network.TLS.Util</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.X509.html"><span class="hs-identifier">Network.TLS.X509</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Imports.html"><span class="hs-identifier">Network.TLS.Imports</span></a></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State.Strict</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IOException</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">handle</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromException</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">writeIORef</span></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#handshakeFailed"><span class="hs-identifier hs-type">handshakeFailed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Struct.html#TLSError"><span class="hs-identifier hs-type">TLSError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span id="handshakeFailed"><span class="annot"><span class="annottext">handshakeFailed :: TLSError -&gt; IO ()
</span><a href="Network.TLS.Handshake.Common.html#handshakeFailed"><span class="hs-identifier hs-var hs-var">handshakeFailed</span></a></span></span><span> </span><span id="local-6989586621679190049"><span class="annot"><span class="annottext">TLSError
</span><a href="#local-6989586621679190049"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLSException -&gt; IO ()
forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(TLSException -&gt; IO ()) -&gt; TLSException -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TLSError -&gt; TLSException
</span><a href="Network.TLS.Struct.html#HandshakeFailed"><span class="hs-identifier hs-var">HandshakeFailed</span></a></span><span> </span><span class="annot"><span class="annottext">TLSError
</span><a href="#local-6989586621679190049"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#handleException"><span class="hs-identifier hs-type">handleException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span id="handleException"><span class="annot"><span class="annottext">handleException :: Context -&gt; IO () -&gt; IO ()
</span><a href="Network.TLS.Handshake.Common.html#handleException"><span class="hs-identifier hs-var hs-var">handleException</span></a></span></span><span> </span><span id="local-6989586621679190051"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190051"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679190052"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679190052"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; (SomeException -&gt; IO ()) -&gt; IO ()
forall a. IO a -&gt; (SomeException -&gt; IO a) -&gt; IO a
</span><a href="Network.TLS.Util.html#catchException"><span class="hs-identifier hs-var">catchException</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679190052"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">((SomeException -&gt; IO ()) -&gt; IO ())
-&gt; (SomeException -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679190054"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679190054"><span class="hs-identifier hs-var">exception</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-comment">-- If the error was an Uncontextualized TLSException, we replace the</span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-comment">-- context with HandshakeFailed. If it's anything else, we convert</span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-comment">-- it to a string and wrap it with Error_Misc and HandshakeFailed.</span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679190058"><span class="annot"><span class="annottext">tlserror :: TLSError
</span><a href="#local-6989586621679190058"><span class="hs-identifier hs-var hs-var">tlserror</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe TLSException
forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><span class="hs-identifier hs-var">fromException</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679190054"><span class="hs-identifier hs-var">exception</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-65"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679190059"><span class="annot"><span class="annottext">TLSException
</span><a href="#local-6989586621679190059"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Network.TLS.Struct.html#Uncontextualized"><span class="hs-identifier hs-type">Uncontextualized</span></a></span><span> </span><span id="local-6989586621679190061"><span class="annot"><span class="annottext">TLSError
</span><a href="#local-6989586621679190061"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TLSException
</span><a href="#local-6989586621679190059"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TLSError
</span><a href="#local-6989586621679190061"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-66"></span><span>          </span><span class="annot"><span class="annottext">Maybe TLSException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TLSError
</span><a href="Network.TLS.Struct.html#Error_Misc"><span class="hs-identifier hs-var">Error_Misc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeException -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679190054"><span class="hs-identifier hs-var">exception</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; Established -&gt; IO ()
</span><a href="Network.TLS.Context.Internal.html#setEstablished"><span class="hs-identifier hs-var">setEstablished</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190051"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Established
</span><a href="Network.TLS.Context.Internal.html#NotEstablished"><span class="hs-identifier hs-var">NotEstablished</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><span class="annottext">(IOException -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall e a. Exception e =&gt; (e -&gt; IO a) -&gt; IO a -&gt; IO a
</span><span class="hs-identifier hs-var">handle</span></span><span> </span><span class="annot"><span class="annottext">IOException -&gt; IO ()
</span><a href="#local-6989586621679190066"><span class="hs-identifier hs-var">ignoreIOErr</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-69"></span><span>        </span><span id="local-6989586621679190067"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679190067"><span class="hs-identifier hs-var">tls13</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO Bool
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m Bool
</span><a href="Network.TLS.Context.Internal.html#tls13orLater"><span class="hs-identifier hs-var">tls13orLater</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190051"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-70"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679190067"><span class="hs-identifier hs-var">tls13</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-71"></span><span>            </span><span class="annot"><span class="annottext">Context -&gt; Packet13 -&gt; IO ()
</span><a href="Network.TLS.IO.html#sendPacket13"><span class="hs-identifier hs-var">sendPacket13</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190051"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Packet13 -&gt; IO ()) -&gt; Packet13 -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(AlertLevel, AlertDescription)] -&gt; Packet13
</span><a href="Network.TLS.Struct13.html#Alert13"><span class="hs-identifier hs-var">Alert13</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TLSError -&gt; (AlertLevel, AlertDescription)
</span><a href="Network.TLS.Handshake.Common.html#errorToAlert"><span class="hs-identifier hs-var">errorToAlert</span></a></span><span> </span><span class="annot"><span class="annottext">TLSError
</span><a href="#local-6989586621679190058"><span class="hs-identifier hs-var">tlserror</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-72"></span><span>          </span><span class="hs-keyword">else</span><span>
</span><span id="line-73"></span><span>            </span><span class="annot"><span class="annottext">Context -&gt; Packet -&gt; IO ()
</span><a href="Network.TLS.IO.html#sendPacket"><span class="hs-identifier hs-var">sendPacket</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190051"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Packet -&gt; IO ()) -&gt; Packet -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(AlertLevel, AlertDescription)] -&gt; Packet
</span><a href="Network.TLS.Struct.html#Alert"><span class="hs-identifier hs-var">Alert</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TLSError -&gt; (AlertLevel, AlertDescription)
</span><a href="Network.TLS.Handshake.Common.html#errorToAlert"><span class="hs-identifier hs-var">errorToAlert</span></a></span><span> </span><span class="annot"><span class="annottext">TLSError
</span><a href="#local-6989586621679190058"><span class="hs-identifier hs-var">tlserror</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><span class="annottext">TLSError -&gt; IO ()
</span><a href="Network.TLS.Handshake.Common.html#handshakeFailed"><span class="hs-identifier hs-var">handshakeFailed</span></a></span><span> </span><span class="annot"><span class="annottext">TLSError
</span><a href="#local-6989586621679190058"><span class="hs-identifier hs-var">tlserror</span></a></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><a href="#local-6989586621679190066"><span class="hs-identifier hs-type">ignoreIOErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IOException</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>    </span><span id="local-6989586621679190066"><span class="annot"><span class="annottext">ignoreIOErr :: IOException -&gt; IO ()
</span><a href="#local-6989586621679190066"><span class="hs-identifier hs-var hs-var">ignoreIOErr</span></a></span></span><span> </span><span class="annot"><span class="annottext">IOException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#errorToAlert"><span class="hs-identifier hs-type">errorToAlert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Struct.html#TLSError"><span class="hs-identifier hs-type">TLSError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Struct.html#AlertLevel"><span class="hs-identifier hs-type">AlertLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Struct.html#AlertDescription"><span class="hs-identifier hs-type">AlertDescription</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span id="errorToAlert"><span class="annot"><span class="annottext">errorToAlert :: TLSError -&gt; (AlertLevel, AlertDescription)
</span><a href="Network.TLS.Handshake.Common.html#errorToAlert"><span class="hs-identifier hs-var hs-var">errorToAlert</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Struct.html#Error_Protocol"><span class="hs-identifier hs-type">Error_Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679190074"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679190074"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679190075"><span class="annot"><span class="annottext">AlertDescription
</span><a href="#local-6989586621679190075"><span class="hs-identifier hs-var">ad</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679190076"><span class="annot"><span class="annottext">lvl :: AlertLevel
</span><a href="#local-6989586621679190076"><span class="hs-identifier hs-var hs-var">lvl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679190074"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">AlertLevel
</span><a href="Network.TLS.Struct.html#AlertLevel_Fatal"><span class="hs-identifier hs-var">AlertLevel_Fatal</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">AlertLevel
</span><a href="Network.TLS.Struct.html#AlertLevel_Warning"><span class="hs-identifier hs-var">AlertLevel_Warning</span></a></span><span>
</span><span id="line-81"></span><span>                                             </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AlertLevel
</span><a href="#local-6989586621679190076"><span class="hs-identifier hs-var">lvl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="#local-6989586621679190075"><span class="hs-identifier hs-var">ad</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#errorToAlert"><span class="hs-identifier hs-var">errorToAlert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Struct.html#Error_Packet_unexpected"><span class="hs-identifier hs-type">Error_Packet_unexpected</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AlertLevel
</span><a href="Network.TLS.Struct.html#AlertLevel_Fatal"><span class="hs-identifier hs-var">AlertLevel_Fatal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#UnexpectedMessage"><span class="hs-identifier hs-var">UnexpectedMessage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#errorToAlert"><span class="hs-identifier hs-var">errorToAlert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Struct.html#Error_Packet_Parsing"><span class="hs-identifier hs-type">Error_Packet_Parsing</span></a></span><span> </span><span id="local-6989586621679190082"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679190082"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;invalid version&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><span class="hs-operator hs-var">`isInfixOf`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679190082"><span class="hs-identifier hs-var">msg</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AlertLevel
</span><a href="Network.TLS.Struct.html#AlertLevel_Fatal"><span class="hs-identifier hs-var">AlertLevel_Fatal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#ProtocolVersion"><span class="hs-identifier hs-var">ProtocolVersion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;request_update&quot;</span></span><span>  </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><span class="hs-operator hs-var">`isInfixOf`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679190082"><span class="hs-identifier hs-var">msg</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AlertLevel
</span><a href="Network.TLS.Struct.html#AlertLevel_Fatal"><span class="hs-identifier hs-var">AlertLevel_Fatal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#IllegalParameter"><span class="hs-identifier hs-var">IllegalParameter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AlertLevel
</span><a href="Network.TLS.Struct.html#AlertLevel_Fatal"><span class="hs-identifier hs-var">AlertLevel_Fatal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#DecodeError"><span class="hs-identifier hs-var">DecodeError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#errorToAlert"><span class="hs-identifier hs-var">errorToAlert</span></a></span><span> </span><span class="annot"><span class="annottext">TLSError
</span><span class="hs-identifier">_</span></span><span>                             </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AlertLevel
</span><a href="Network.TLS.Struct.html#AlertLevel_Fatal"><span class="hs-identifier hs-var">AlertLevel_Fatal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#InternalError"><span class="hs-identifier hs-var">InternalError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-comment">-- | Return the message that a TLS endpoint can add to its local log for the</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- specified library error.</span><span>
</span><span id="line-91"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#errorToAlertMessage"><span class="hs-identifier hs-type">errorToAlertMessage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Struct.html#TLSError"><span class="hs-identifier hs-type">TLSError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-92"></span><span id="errorToAlertMessage"><span class="annot"><span class="annottext">errorToAlertMessage :: TLSError -&gt; String
</span><a href="Network.TLS.Handshake.Common.html#errorToAlertMessage"><span class="hs-identifier hs-var hs-var">errorToAlertMessage</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Struct.html#Error_Protocol"><span class="hs-identifier hs-type">Error_Protocol</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679190088"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679190088"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679190088"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-93"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#errorToAlertMessage"><span class="hs-identifier hs-var">errorToAlertMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Struct.html#Error_Packet_unexpected"><span class="hs-identifier hs-type">Error_Packet_unexpected</span></a></span><span> </span><span id="local-6989586621679190089"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679190089"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679190089"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-94"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#errorToAlertMessage"><span class="hs-identifier hs-var">errorToAlertMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Struct.html#Error_Packet_Parsing"><span class="hs-identifier hs-type">Error_Packet_Parsing</span></a></span><span> </span><span id="local-6989586621679190090"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679190090"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679190090"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-95"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#errorToAlertMessage"><span class="hs-identifier hs-var">errorToAlertMessage</span></a></span><span> </span><span id="local-6989586621679190091"><span class="annot"><span class="annottext">TLSError
</span><a href="#local-6989586621679190091"><span class="hs-identifier hs-var">e</span></a></span></span><span>                               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLSError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TLSError
</span><a href="#local-6989586621679190091"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span id="local-6989586621679189834"><span id="local-6989586621679189835"><span class="annot"><a href="Network.TLS.Handshake.Common.html#unexpected"><span class="hs-identifier hs-type">unexpected</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679189834"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679189834"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679189835"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-98"></span><span id="unexpected"><span class="annot"><span class="annottext">unexpected :: forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; Maybe String -&gt; m a
</span><a href="Network.TLS.Handshake.Common.html#unexpected"><span class="hs-identifier hs-var hs-var">unexpected</span></a></span></span><span> </span><span id="local-6989586621679190095"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679190095"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679190096"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679190096"><span class="hs-identifier hs-var">expected</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLSError -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">(TLSError -&gt; m a) -&gt; TLSError -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; TLSError
</span><a href="Network.TLS.Struct.html#Error_Packet_unexpected"><span class="hs-identifier hs-var">Error_Packet_unexpected</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679190095"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; (String -&gt; String) -&gt; Maybe String -&gt; String
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; expected: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679190096"><span class="hs-identifier hs-var">expected</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#newSession"><span class="hs-identifier hs-type">newSession</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.TLS.Struct.html#Session"><span class="hs-identifier hs-type">Session</span></a></span><span>
</span><span id="line-101"></span><span id="newSession"><span class="annot"><span class="annottext">newSession :: Context -&gt; IO Session
</span><a href="Network.TLS.Handshake.Common.html#newSession"><span class="hs-identifier hs-var hs-var">newSession</span></a></span></span><span> </span><span id="local-6989586621679190099"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190099"><span class="hs-identifier hs-var">ctx</span></a></span></span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Supported -&gt; Bool
</span><a href="Network.TLS.Parameters.html#supportedSession"><span class="hs-identifier hs-var">supportedSession</span></a></span><span> </span><span class="annot"><span class="annottext">(Supported -&gt; Bool) -&gt; Supported -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Supported
</span><a href="Network.TLS.Context.Internal.html#ctxSupported"><span class="hs-identifier hs-var">ctxSupported</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190099"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SessionID -&gt; Session
</span><a href="Network.TLS.Struct.html#Session"><span class="hs-identifier hs-var">Session</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe SessionID -&gt; Session)
-&gt; (SessionID -&gt; Maybe SessionID) -&gt; SessionID -&gt; Session
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SessionID -&gt; Maybe SessionID
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(SessionID -&gt; Session) -&gt; IO SessionID -&gt; IO Session
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Int -&gt; IO SessionID
</span><a href="Network.TLS.Context.Internal.html#getStateRNG"><span class="hs-identifier hs-var">getStateRNG</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190099"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Session -&gt; IO Session
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Session -&gt; IO Session) -&gt; Session -&gt; IO Session
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe SessionID -&gt; Session
</span><a href="Network.TLS.Struct.html#Session"><span class="hs-identifier hs-var">Session</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SessionID
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="annot"><span class="hs-comment">-- | when a new handshake is done, wrap up &amp; clean up.</span></span><span>
</span><span id="line-106"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#handshakeTerminate"><span class="hs-identifier hs-type">handshakeTerminate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span id="handshakeTerminate"><span class="annot"><span class="annottext">handshakeTerminate :: Context -&gt; IO ()
</span><a href="Network.TLS.Handshake.Common.html#handshakeTerminate"><span class="hs-identifier hs-var hs-var">handshakeTerminate</span></a></span></span><span> </span><span id="local-6989586621679190106"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190106"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-108"></span><span>    </span><span id="local-6989586621679190107"><span class="annot"><span class="annottext">Session
</span><a href="#local-6989586621679190107"><span class="hs-identifier hs-var">session</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; TLSSt Session -&gt; IO Session
forall a. Context -&gt; TLSSt a -&gt; IO a
</span><a href="Network.TLS.Context.Internal.html#usingState_"><span class="hs-identifier hs-var">usingState_</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190106"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSt Session
</span><a href="Network.TLS.State.html#getSession"><span class="hs-identifier hs-var">getSession</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-comment">-- only callback the session established if we have a session</span><span>
</span><span id="line-110"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Session
</span><a href="#local-6989586621679190107"><span class="hs-identifier hs-var">session</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-111"></span><span>        </span><span class="annot"><a href="Network.TLS.Struct.html#Session"><span class="hs-identifier hs-type">Session</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679190110"><span class="annot"><span class="annottext">SessionID
</span><a href="#local-6989586621679190110"><span class="hs-identifier hs-var">sessionId</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>            </span><span id="local-6989586621679190111"><span class="annot"><span class="annottext">Maybe SessionData
</span><a href="#local-6989586621679190111"><span class="hs-identifier hs-var">sessionData</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO (Maybe SessionData)
</span><a href="Network.TLS.Handshake.Common.html#getSessionData"><span class="hs-identifier hs-var">getSessionData</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190106"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-113"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679190112"><span class="annot"><span class="annottext">sessionId' :: SessionID
</span><a href="#local-6989586621679190112"><span class="hs-identifier hs-var hs-var">sessionId'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SessionID -&gt; SessionID
</span><span class="hs-identifier hs-var">B.copy</span></span><span> </span><span class="annot"><span class="annottext">SessionID
</span><a href="#local-6989586621679190110"><span class="hs-identifier hs-var">sessionId</span></a></span><span>
</span><span id="line-114"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SessionManager -&gt; SessionID -&gt; SessionData -&gt; IO ()
</span><a href="Network.TLS.Session.html#sessionEstablish"><span class="hs-identifier hs-var">sessionEstablish</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Shared -&gt; SessionManager
</span><a href="Network.TLS.Parameters.html#sharedSessionManager"><span class="hs-identifier hs-var">sharedSessionManager</span></a></span><span> </span><span class="annot"><span class="annottext">(Shared -&gt; SessionManager) -&gt; Shared -&gt; SessionManager
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Shared
</span><a href="Network.TLS.Context.Internal.html#ctxShared"><span class="hs-identifier hs-var">ctxShared</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190106"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SessionID
</span><a href="#local-6989586621679190112"><span class="hs-identifier hs-var">sessionId'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe SessionData -&gt; SessionData
forall a. String -&gt; Maybe a -&gt; a
</span><a href="Network.TLS.Util.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;session-data&quot;</span></span><span> </span><span class="annot"><span class="annottext">Maybe SessionData
</span><a href="#local-6989586621679190111"><span class="hs-identifier hs-var">sessionData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>        </span><span class="annot"><span class="annottext">Session
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-comment">-- forget most handshake data and reset bytes counters.</span><span>
</span><span id="line-117"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe HandshakeState)
-&gt; (Maybe HandshakeState -&gt; IO (Maybe HandshakeState)) -&gt; IO ()
forall a. MVar a -&gt; (a -&gt; IO a) -&gt; IO ()
</span><span class="hs-identifier hs-var">modifyMVar_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; MVar (Maybe HandshakeState)
</span><a href="Network.TLS.Context.Internal.html#ctxHandshake"><span class="hs-identifier hs-var">ctxHandshake</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190106"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Maybe HandshakeState -&gt; IO (Maybe HandshakeState)) -&gt; IO ())
-&gt; (Maybe HandshakeState -&gt; IO (Maybe HandshakeState)) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679190121"><span class="annot"><span class="annottext">Maybe HandshakeState
</span><a href="#local-6989586621679190121"><span class="hs-identifier hs-var">mhshake</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-118"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe HandshakeState
</span><a href="#local-6989586621679190121"><span class="hs-identifier hs-var">mhshake</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-119"></span><span>            </span><span class="annot"><span class="annottext">Maybe HandshakeState
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe HandshakeState -&gt; IO (Maybe HandshakeState)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe HandshakeState
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-120"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679190122"><span class="annot"><span class="annottext">HandshakeState
</span><a href="#local-6989586621679190122"><span class="hs-identifier hs-var">hshake</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-121"></span><span>                </span><span class="annot"><span class="annottext">Maybe HandshakeState -&gt; IO (Maybe HandshakeState)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe HandshakeState -&gt; IO (Maybe HandshakeState))
-&gt; Maybe HandshakeState -&gt; IO (Maybe HandshakeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HandshakeState -&gt; Maybe HandshakeState
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; ClientRandom -&gt; HandshakeState
</span><a href="Network.TLS.Handshake.State.html#newEmptyHandshake"><span class="hs-identifier hs-var">newEmptyHandshake</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HandshakeState -&gt; Version
</span><a href="Network.TLS.Handshake.State.html#hstClientVersion"><span class="hs-identifier hs-var">hstClientVersion</span></a></span><span> </span><span class="annot"><span class="annottext">HandshakeState
</span><a href="#local-6989586621679190122"><span class="hs-identifier hs-var">hshake</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HandshakeState -&gt; ClientRandom
</span><a href="Network.TLS.Handshake.State.html#hstClientRandom"><span class="hs-identifier hs-var">hstClientRandom</span></a></span><span> </span><span class="annot"><span class="annottext">HandshakeState
</span><a href="#local-6989586621679190122"><span class="hs-identifier hs-var">hshake</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstServerRandom"><span class="hs-identifier hs-var">hstServerRandom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstServerRandom"><span class="hs-identifier hs-var">hstServerRandom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190122"><span class="hs-identifier hs-type">hshake</span></a></span><span>
</span><span id="line-123"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstMasterSecret"><span class="hs-identifier hs-var">hstMasterSecret</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstMasterSecret"><span class="hs-identifier hs-var">hstMasterSecret</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190122"><span class="hs-identifier hs-type">hshake</span></a></span><span>
</span><span id="line-124"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstExtendedMasterSec"><span class="hs-identifier hs-var">hstExtendedMasterSec</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstExtendedMasterSec"><span class="hs-identifier hs-var">hstExtendedMasterSec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190122"><span class="hs-identifier hs-type">hshake</span></a></span><span>
</span><span id="line-125"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstNegotiatedGroup"><span class="hs-identifier hs-var">hstNegotiatedGroup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.State.html#hstNegotiatedGroup"><span class="hs-identifier hs-var">hstNegotiatedGroup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190122"><span class="hs-identifier hs-type">hshake</span></a></span><span>
</span><span id="line-126"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-127"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; (Measurement -&gt; Measurement) -&gt; IO ()
</span><a href="Network.TLS.Context.Internal.html#updateMeasure"><span class="hs-identifier hs-var">updateMeasure</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190106"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; Measurement
</span><a href="Network.TLS.Measurement.html#resetBytesCounters"><span class="hs-identifier hs-var">resetBytesCounters</span></a></span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-comment">-- mark the secure connection up and running.</span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; Established -&gt; IO ()
</span><a href="Network.TLS.Context.Internal.html#setEstablished"><span class="hs-identifier hs-var">setEstablished</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190106"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Established
</span><a href="Network.TLS.Context.Internal.html#Established"><span class="hs-identifier hs-var">Established</span></a></span><span>
</span><span id="line-130"></span><span>    </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#sendChangeCipherAndFinish"><span class="hs-identifier hs-type">sendChangeCipherAndFinish</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-133"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-134"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span id="sendChangeCipherAndFinish"><span class="annot"><span class="annottext">sendChangeCipherAndFinish :: Context -&gt; Role -&gt; IO ()
</span><a href="Network.TLS.Handshake.Common.html#sendChangeCipherAndFinish"><span class="hs-identifier hs-var hs-var">sendChangeCipherAndFinish</span></a></span></span><span> </span><span id="local-6989586621679190133"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190133"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679190134"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621679190134"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; Packet -&gt; IO ()
</span><a href="Network.TLS.IO.html#sendPacket"><span class="hs-identifier hs-var">sendPacket</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190133"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Packet
</span><a href="Network.TLS.Struct.html#ChangeCipherSpec"><span class="hs-identifier hs-var">ChangeCipherSpec</span></a></span><span>
</span><span id="line-137"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO ()
</span><a href="Network.TLS.Context.Internal.html#contextFlush"><span class="hs-identifier hs-var">contextFlush</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190133"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span id="local-6989586621679190137"><span class="annot"><span class="annottext">SessionID
</span><a href="#local-6989586621679190137"><span class="hs-identifier hs-var">cf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; TLSSt Version -&gt; IO Version
forall a. Context -&gt; TLSSt a -&gt; IO a
</span><a href="Network.TLS.Context.Internal.html#usingState_"><span class="hs-identifier hs-var">usingState_</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190133"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSt Version
</span><a href="Network.TLS.State.html#getVersion"><span class="hs-identifier hs-var">getVersion</span></a></span><span> </span><span class="annot"><span class="annottext">IO Version -&gt; (Version -&gt; IO SessionID) -&gt; IO SessionID
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679190139"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679190139"><span class="hs-identifier hs-var">ver</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Context -&gt; HandshakeM SessionID -&gt; IO SessionID
forall (m :: * -&gt; *) a. MonadIO m =&gt; Context -&gt; HandshakeM a -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#usingHState"><span class="hs-identifier hs-var">usingHState</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190133"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(HandshakeM SessionID -&gt; IO SessionID)
-&gt; HandshakeM SessionID -&gt; IO SessionID
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Role -&gt; HandshakeM SessionID
</span><a href="Network.TLS.Handshake.State.html#getHandshakeDigest"><span class="hs-identifier hs-var">getHandshakeDigest</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679190139"><span class="hs-identifier hs-var">ver</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621679190134"><span class="hs-keyword hs-var">role</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; Packet -&gt; IO ()
</span><a href="Network.TLS.IO.html#sendPacket"><span class="hs-identifier hs-var">sendPacket</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190133"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Handshake] -&gt; Packet
</span><a href="Network.TLS.Struct.html#Handshake"><span class="hs-identifier hs-var">Handshake</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SessionID -&gt; Handshake
</span><a href="Network.TLS.Struct.html#Finished"><span class="hs-identifier hs-var">Finished</span></a></span><span> </span><span class="annot"><span class="annottext">SessionID
</span><a href="#local-6989586621679190137"><span class="hs-identifier hs-var">cf</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><span class="annottext">IORef (Maybe SessionID) -&gt; Maybe SessionID -&gt; IO ()
forall a. IORef a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">writeIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; IORef (Maybe SessionID)
</span><a href="Network.TLS.Context.Internal.html#ctxFinished"><span class="hs-identifier hs-var">ctxFinished</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190133"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe SessionID -&gt; IO ()) -&gt; Maybe SessionID -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SessionID -&gt; Maybe SessionID
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SessionID
</span><a href="#local-6989586621679190137"><span class="hs-identifier hs-var">cf</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO ()
</span><a href="Network.TLS.Context.Internal.html#contextFlush"><span class="hs-identifier hs-var">contextFlush</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190133"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#recvChangeCipherAndFinish"><span class="hs-identifier hs-type">recvChangeCipherAndFinish</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span id="recvChangeCipherAndFinish"><span class="annot"><span class="annottext">recvChangeCipherAndFinish :: Context -&gt; IO ()
</span><a href="Network.TLS.Handshake.Common.html#recvChangeCipherAndFinish"><span class="hs-identifier hs-var hs-var">recvChangeCipherAndFinish</span></a></span></span><span> </span><span id="local-6989586621679190145"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190145"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; RecvState IO -&gt; IO ()
</span><a href="Network.TLS.Handshake.Common.html#runRecvState"><span class="hs-identifier hs-var">runRecvState</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190145"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Packet -&gt; IO (RecvState IO)) -&gt; RecvState IO
forall (m :: * -&gt; *). (Packet -&gt; m (RecvState m)) -&gt; RecvState m
</span><a href="Network.TLS.Handshake.Common.html#RecvStateNext"><span class="hs-identifier hs-var">RecvStateNext</span></a></span><span> </span><span class="annot"><span class="annottext">Packet -&gt; IO (RecvState IO)
forall {m :: * -&gt; *} {m :: * -&gt; *}.
(MonadIO m, MonadIO m) =&gt;
Packet -&gt; m (RecvState m)
</span><a href="#local-6989586621679190147"><span class="hs-identifier hs-var">expectChangeCipher</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679190147"><span class="annot"><span class="annottext">expectChangeCipher :: Packet -&gt; m (RecvState m)
</span><a href="#local-6989586621679190147"><span class="hs-identifier hs-var hs-var">expectChangeCipher</span></a></span></span><span> </span><span class="annot"><span class="annottext">Packet
</span><a href="Network.TLS.Struct.html#ChangeCipherSpec"><span class="hs-identifier hs-var">ChangeCipherSpec</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RecvState m -&gt; m (RecvState m)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(RecvState m -&gt; m (RecvState m)) -&gt; RecvState m -&gt; m (RecvState m)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Handshake -&gt; m (RecvState m)) -&gt; RecvState m
forall (m :: * -&gt; *). (Handshake -&gt; m (RecvState m)) -&gt; RecvState m
</span><a href="Network.TLS.Handshake.Common.html#RecvStateHandshake"><span class="hs-identifier hs-var">RecvStateHandshake</span></a></span><span> </span><span class="annot"><span class="annottext">Handshake -&gt; m (RecvState m)
forall {m :: * -&gt; *} {m :: * -&gt; *}.
MonadIO m =&gt;
Handshake -&gt; m (RecvState m)
</span><a href="#local-6989586621679190174"><span class="hs-identifier hs-var">expectFinish</span></a></span><span>
</span><span id="line-146"></span><span>        </span><span class="annot"><a href="#local-6989586621679190147"><span class="hs-identifier hs-var">expectChangeCipher</span></a></span><span> </span><span id="local-6989586621679190175"><span class="annot"><span class="annottext">Packet
</span><a href="#local-6989586621679190175"><span class="hs-identifier hs-var">p</span></a></span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; m (RecvState m)
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; Maybe String -&gt; m a
</span><a href="Network.TLS.Handshake.Common.html#unexpected"><span class="hs-identifier hs-var">unexpected</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Packet -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Packet
</span><a href="#local-6989586621679190175"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;change cipher&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>        </span><span id="local-6989586621679190174"><span class="annot"><span class="annottext">expectFinish :: Handshake -&gt; m (RecvState m)
</span><a href="#local-6989586621679190174"><span class="hs-identifier hs-var hs-var">expectFinish</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Struct.html#Finished"><span class="hs-identifier hs-type">Finished</span></a></span><span> </span><span class="annot"><span class="annottext">SessionID
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RecvState m -&gt; m (RecvState m)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">RecvState m
forall (m :: * -&gt; *). RecvState m
</span><a href="Network.TLS.Handshake.Common.html#RecvStateDone"><span class="hs-identifier hs-var">RecvStateDone</span></a></span><span>
</span><span id="line-148"></span><span>        </span><span class="annot"><a href="#local-6989586621679190174"><span class="hs-identifier hs-var">expectFinish</span></a></span><span> </span><span id="local-6989586621679190192"><span class="annot"><span class="annottext">Handshake
</span><a href="#local-6989586621679190192"><span class="hs-identifier hs-var">p</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; m (RecvState m)
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; Maybe String -&gt; m a
</span><a href="Network.TLS.Handshake.Common.html#unexpected"><span class="hs-identifier hs-var">unexpected</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handshake -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Handshake
</span><a href="#local-6989586621679190192"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Handshake Finished&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-keyword">data</span><span> </span><span id="RecvState"><span class="annot"><a href="Network.TLS.Handshake.Common.html#RecvState"><span class="hs-identifier hs-var">RecvState</span></a></span></span><span> </span><span id="local-6989586621679189875"><span class="annot"><a href="#local-6989586621679189875"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-151"></span><span>      </span><span id="RecvStateNext"><span class="annot"><a href="Network.TLS.Handshake.Common.html#RecvStateNext"><span class="hs-identifier hs-var">RecvStateNext</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Struct.html#Packet"><span class="hs-identifier hs-type">Packet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679189875"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Handshake.Common.html#RecvState"><span class="hs-identifier hs-type">RecvState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679189875"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="RecvStateHandshake"><span class="annot"><a href="Network.TLS.Handshake.Common.html#RecvStateHandshake"><span class="hs-identifier hs-var">RecvStateHandshake</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Struct.html#Handshake"><span class="hs-identifier hs-type">Handshake</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679189875"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Handshake.Common.html#RecvState"><span class="hs-identifier hs-type">RecvState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679189875"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="RecvStateDone"><span class="annot"><a href="Network.TLS.Handshake.Common.html#RecvStateDone"><span class="hs-identifier hs-var">RecvStateDone</span></a></span></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#recvPacketHandshake"><span class="hs-identifier hs-type">recvPacketHandshake</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.TLS.Struct.html#Handshake"><span class="hs-identifier hs-type">Handshake</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-156"></span><span id="recvPacketHandshake"><span class="annot"><span class="annottext">recvPacketHandshake :: Context -&gt; IO [Handshake]
</span><a href="Network.TLS.Handshake.Common.html#recvPacketHandshake"><span class="hs-identifier hs-var hs-var">recvPacketHandshake</span></a></span></span><span> </span><span id="local-6989586621679190193"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190193"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-157"></span><span>    </span><span id="local-6989586621679190194"><span class="annot"><span class="annottext">Either TLSError Packet
</span><a href="#local-6989586621679190194"><span class="hs-identifier hs-var">pkts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO (Either TLSError Packet)
</span><a href="Network.TLS.IO.html#recvPacket"><span class="hs-identifier hs-var">recvPacket</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190193"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either TLSError Packet
</span><a href="#local-6989586621679190194"><span class="hs-identifier hs-var">pkts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-159"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Struct.html#Handshake"><span class="hs-identifier hs-type">Handshake</span></a></span><span> </span><span id="local-6989586621679190196"><span class="annot"><span class="annottext">[Handshake]
</span><a href="#local-6989586621679190196"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Handshake] -&gt; IO [Handshake]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[Handshake]
</span><a href="#local-6989586621679190196"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-160"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679190197"><span class="annot"><span class="annottext">x :: Packet
</span><a href="#local-6989586621679190197"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Struct.html#AppData"><span class="hs-identifier hs-type">AppData</span></a></span><span> </span><span class="annot"><span class="annottext">SessionID
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-161"></span><span>            </span><span class="hs-comment">-- If a TLS13 server decides to reject RTT0 data, the server should</span><span>
</span><span id="line-162"></span><span>            </span><span class="hs-comment">-- skip records for RTT0 data up to the maximum limit.</span><span>
</span><span id="line-163"></span><span>            </span><span id="local-6989586621679190199"><span class="annot"><span class="annottext">Established
</span><a href="#local-6989586621679190199"><span class="hs-identifier hs-var">established</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO Established
</span><a href="Network.TLS.Context.Internal.html#ctxEstablished"><span class="hs-identifier hs-var">ctxEstablished</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190193"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-164"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Established
</span><a href="#local-6989586621679190199"><span class="hs-identifier hs-var">established</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-165"></span><span>                </span><span class="annot"><a href="Network.TLS.Context.Internal.html#EarlyDataNotAllowed"><span class="hs-identifier hs-type">EarlyDataNotAllowed</span></a></span><span> </span><span id="local-6989586621679190202"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679190202"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-166"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679190202"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Context -&gt; Established -&gt; IO ()
</span><a href="Network.TLS.Context.Internal.html#setEstablished"><span class="hs-identifier hs-var">setEstablished</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190193"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Established -&gt; IO ()) -&gt; Established -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Established
</span><a href="Network.TLS.Context.Internal.html#EarlyDataNotAllowed"><span class="hs-identifier hs-var">EarlyDataNotAllowed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679190202"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>                                  </span><span class="annot"><span class="annottext">Context -&gt; IO [Handshake]
</span><a href="Network.TLS.Handshake.Common.html#recvPacketHandshake"><span class="hs-identifier hs-var">recvPacketHandshake</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190193"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-168"></span><span>                </span><span class="annot"><span class="annottext">Established
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; IO [Handshake]
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; Maybe String -&gt; m a
</span><a href="Network.TLS.Handshake.Common.html#unexpected"><span class="hs-identifier hs-var">unexpected</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Packet -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Packet
</span><a href="#local-6989586621679190197"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;handshake&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679190204"><span class="annot"><span class="annottext">Packet
</span><a href="#local-6989586621679190204"><span class="hs-identifier hs-var">x</span></a></span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; IO [Handshake]
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; Maybe String -&gt; m a
</span><a href="Network.TLS.Handshake.Common.html#unexpected"><span class="hs-identifier hs-var">unexpected</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Packet -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Packet
</span><a href="#local-6989586621679190204"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;handshake&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679190205"><span class="annot"><span class="annottext">TLSError
</span><a href="#local-6989586621679190205"><span class="hs-identifier hs-var">err</span></a></span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TLSError -&gt; IO [Handshake]
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">TLSError
</span><a href="#local-6989586621679190205"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="annot"><span class="hs-comment">-- | process a list of handshakes message in the recv state machine.</span></span><span>
</span><span id="line-173"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#onRecvStateHandshake"><span class="hs-identifier hs-type">onRecvStateHandshake</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#RecvState"><span class="hs-identifier hs-type">RecvState</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.TLS.Struct.html#Handshake"><span class="hs-identifier hs-type">Handshake</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Handshake.Common.html#RecvState"><span class="hs-identifier hs-type">RecvState</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span id="onRecvStateHandshake"><span class="annot"><span class="annottext">onRecvStateHandshake :: Context -&gt; RecvState IO -&gt; [Handshake] -&gt; IO (RecvState IO)
</span><a href="Network.TLS.Handshake.Common.html#onRecvStateHandshake"><span class="hs-identifier hs-var hs-var">onRecvStateHandshake</span></a></span></span><span> </span><span class="annot"><span class="annottext">Context
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621679190206"><span class="annot"><span class="annottext">RecvState IO
</span><a href="#local-6989586621679190206"><span class="hs-identifier hs-var">recvState</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RecvState IO -&gt; IO (RecvState IO)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">RecvState IO
</span><a href="#local-6989586621679190206"><span class="hs-identifier hs-var">recvState</span></a></span><span>
</span><span id="line-175"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#onRecvStateHandshake"><span class="hs-identifier hs-var">onRecvStateHandshake</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Handshake.Common.html#RecvStateNext"><span class="hs-identifier hs-type">RecvStateNext</span></a></span><span> </span><span id="local-6989586621679190207"><span class="annot"><span class="annottext">Packet -&gt; IO (RecvState IO)
</span><a href="#local-6989586621679190207"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679190208"><span class="annot"><span class="annottext">[Handshake]
</span><a href="#local-6989586621679190208"><span class="hs-identifier hs-var">hms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Packet -&gt; IO (RecvState IO)
</span><a href="#local-6989586621679190207"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Handshake] -&gt; Packet
</span><a href="Network.TLS.Struct.html#Handshake"><span class="hs-identifier hs-var">Handshake</span></a></span><span> </span><span class="annot"><span class="annottext">[Handshake]
</span><a href="#local-6989586621679190208"><span class="hs-identifier hs-var">hms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#onRecvStateHandshake"><span class="hs-identifier hs-var">onRecvStateHandshake</span></a></span><span> </span><span id="local-6989586621679190209"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190209"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Handshake.Common.html#RecvStateHandshake"><span class="hs-identifier hs-type">RecvStateHandshake</span></a></span><span> </span><span id="local-6989586621679190210"><span class="annot"><span class="annottext">Handshake -&gt; IO (RecvState IO)
</span><a href="#local-6989586621679190210"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679190211"><span class="annot"><span class="annottext">Handshake
</span><a href="#local-6989586621679190211"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679190212"><span class="annot"><span class="annottext">[Handshake]
</span><a href="#local-6989586621679190212"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-177"></span><span>    </span><span id="local-6989586621679190213"><span class="annot"><span class="annottext">RecvState IO
</span><a href="#local-6989586621679190213"><span class="hs-identifier hs-var">nstate</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Handshake -&gt; IO (RecvState IO)
</span><a href="#local-6989586621679190210"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Handshake
</span><a href="#local-6989586621679190211"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; Handshake -&gt; IO ()
</span><a href="Network.TLS.Handshake.Process.html#processHandshake"><span class="hs-identifier hs-var">processHandshake</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190209"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Handshake
</span><a href="#local-6989586621679190211"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; RecvState IO -&gt; [Handshake] -&gt; IO (RecvState IO)
</span><a href="Network.TLS.Handshake.Common.html#onRecvStateHandshake"><span class="hs-identifier hs-var">onRecvStateHandshake</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190209"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">RecvState IO
</span><a href="#local-6989586621679190213"><span class="hs-identifier hs-var">nstate</span></a></span><span> </span><span class="annot"><span class="annottext">[Handshake]
</span><a href="#local-6989586621679190212"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-180"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#onRecvStateHandshake"><span class="hs-identifier hs-var">onRecvStateHandshake</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RecvState IO
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Handshake]
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; IO (RecvState IO)
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; Maybe String -&gt; m a
</span><a href="Network.TLS.Handshake.Common.html#unexpected"><span class="hs-identifier hs-var">unexpected</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spurious handshake&quot;</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#runRecvState"><span class="hs-identifier hs-type">runRecvState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Common.html#RecvState"><span class="hs-identifier hs-type">RecvState</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span id="runRecvState"><span class="annot"><span class="annottext">runRecvState :: Context -&gt; RecvState IO -&gt; IO ()
</span><a href="Network.TLS.Handshake.Common.html#runRecvState"><span class="hs-identifier hs-var hs-var">runRecvState</span></a></span></span><span> </span><span class="annot"><span class="annottext">Context
</span><span class="hs-identifier">_</span></span><span>    </span><span class="annot"><span class="annottext">RecvState IO
</span><a href="Network.TLS.Handshake.Common.html#RecvStateDone"><span class="hs-identifier hs-var">RecvStateDone</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#runRecvState"><span class="hs-identifier hs-var">runRecvState</span></a></span><span> </span><span id="local-6989586621679190215"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190215"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Handshake.Common.html#RecvStateNext"><span class="hs-identifier hs-type">RecvStateNext</span></a></span><span> </span><span id="local-6989586621679190216"><span class="annot"><span class="annottext">Packet -&gt; IO (RecvState IO)
</span><a href="#local-6989586621679190216"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO (Either TLSError Packet)
</span><a href="Network.TLS.IO.html#recvPacket"><span class="hs-identifier hs-var">recvPacket</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190215"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Either TLSError Packet)
-&gt; (Either TLSError Packet -&gt; IO (RecvState IO))
-&gt; IO (RecvState IO)
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">(TLSError -&gt; IO (RecvState IO))
-&gt; (Packet -&gt; IO (RecvState IO))
-&gt; Either TLSError Packet
-&gt; IO (RecvState IO)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">TLSError -&gt; IO (RecvState IO)
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">Packet -&gt; IO (RecvState IO)
</span><a href="#local-6989586621679190216"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">IO (RecvState IO) -&gt; (RecvState IO -&gt; IO ()) -&gt; IO ()
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; RecvState IO -&gt; IO ()
</span><a href="Network.TLS.Handshake.Common.html#runRecvState"><span class="hs-identifier hs-var">runRecvState</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190215"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-185"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#runRecvState"><span class="hs-identifier hs-var">runRecvState</span></a></span><span> </span><span id="local-6989586621679190218"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190218"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679190219"><span class="annot"><span class="annottext">RecvState IO
</span><a href="#local-6989586621679190219"><span class="hs-identifier hs-var">iniState</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO [Handshake]
</span><a href="Network.TLS.Handshake.Common.html#recvPacketHandshake"><span class="hs-identifier hs-var">recvPacketHandshake</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190218"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">IO [Handshake]
-&gt; ([Handshake] -&gt; IO (RecvState IO)) -&gt; IO (RecvState IO)
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; RecvState IO -&gt; [Handshake] -&gt; IO (RecvState IO)
</span><a href="Network.TLS.Handshake.Common.html#onRecvStateHandshake"><span class="hs-identifier hs-var">onRecvStateHandshake</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190218"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">RecvState IO
</span><a href="#local-6989586621679190219"><span class="hs-identifier hs-var">iniState</span></a></span><span> </span><span class="annot"><span class="annottext">IO (RecvState IO) -&gt; (RecvState IO -&gt; IO ()) -&gt; IO ()
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; RecvState IO -&gt; IO ()
</span><a href="Network.TLS.Handshake.Common.html#runRecvState"><span class="hs-identifier hs-var">runRecvState</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190218"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span id="local-6989586621679189886"><span class="annot"><a href="Network.TLS.Handshake.Common.html#ensureRecvComplete"><span class="hs-identifier hs-type">ensureRecvComplete</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679189886"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679189886"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-188"></span><span id="ensureRecvComplete"><span class="annot"><span class="annottext">ensureRecvComplete :: forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m ()
</span><a href="Network.TLS.Handshake.Common.html#ensureRecvComplete"><span class="hs-identifier hs-var hs-var">ensureRecvComplete</span></a></span></span><span> </span><span id="local-6989586621679190227"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190227"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-189"></span><span>    </span><span id="local-6989586621679190228"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679190228"><span class="hs-identifier hs-var">complete</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; m Bool
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; m Bool) -&gt; IO Bool -&gt; m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO Bool
</span><a href="Network.TLS.IO.html#isRecvComplete"><span class="hs-identifier hs-var">isRecvComplete</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190227"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679190228"><span class="hs-identifier hs-var">complete</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-191"></span><span>        </span><span class="annot"><span class="annottext">TLSError -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">(TLSError -&gt; m ()) -&gt; TLSError -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool, AlertDescription) -&gt; TLSError
</span><a href="Network.TLS.Struct.html#Error_Protocol"><span class="hs-identifier hs-var">Error_Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;received incomplete message at key change&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#UnexpectedMessage"><span class="hs-identifier hs-var">UnexpectedMessage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span id="local-6989586621679189889"><span class="annot"><a href="Network.TLS.Handshake.Common.html#processExtendedMasterSec"><span class="hs-identifier hs-type">processExtendedMasterSec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679189889"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Extension.html#MessageType"><span class="hs-identifier hs-type">MessageType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.TLS.Struct.html#ExtensionRaw"><span class="hs-identifier hs-type">ExtensionRaw</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679189889"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-194"></span><span id="processExtendedMasterSec"><span class="annot"><span class="annottext">processExtendedMasterSec :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Context -&gt; Version -&gt; MessageType -&gt; [ExtensionRaw] -&gt; m Bool
</span><a href="Network.TLS.Handshake.Common.html#processExtendedMasterSec"><span class="hs-identifier hs-var hs-var">processExtendedMasterSec</span></a></span></span><span> </span><span id="local-6989586621679190252"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190252"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679190253"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679190253"><span class="hs-identifier hs-var">ver</span></a></span></span><span> </span><span id="local-6989586621679190254"><span class="annot"><span class="annottext">MessageType
</span><a href="#local-6989586621679190254"><span class="hs-identifier hs-var">msgt</span></a></span></span><span> </span><span id="local-6989586621679190255"><span class="annot"><span class="annottext">[ExtensionRaw]
</span><a href="#local-6989586621679190255"><span class="hs-identifier hs-var">exts</span></a></span></span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679190253"><span class="hs-identifier hs-var">ver</span></a></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Version -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="Network.TLS.Types.html#TLS10"><span class="hs-identifier hs-var">TLS10</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679190253"><span class="hs-identifier hs-var">ver</span></a></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Version -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="Network.TLS.Types.html#TLS12"><span class="hs-identifier hs-var">TLS12</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m Bool
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EMS processing is not compatible with TLS 1.3&quot;</span></span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EMSMode
</span><a href="#local-6989586621679190260"><span class="hs-identifier hs-var">ems</span></a></span><span> </span><span class="annot"><span class="annottext">EMSMode -&gt; EMSMode -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">EMSMode
</span><a href="Network.TLS.Parameters.html#NoEMS"><span class="hs-identifier hs-var">NoEMS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>    </span><span class="hs-glyph">=</span><span>
</span><span id="line-199"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ExtensionID -&gt; [ExtensionRaw] -&gt; Maybe SessionID
</span><a href="Network.TLS.Handshake.Common.html#extensionLookup"><span class="hs-identifier hs-var">extensionLookup</span></a></span><span> </span><span class="annot"><span class="annottext">ExtensionID
</span><a href="Network.TLS.Extension.html#extensionID_ExtendedMasterSecret"><span class="hs-identifier hs-var">extensionID_ExtendedMasterSecret</span></a></span><span> </span><span class="annot"><span class="annottext">[ExtensionRaw]
</span><a href="#local-6989586621679190255"><span class="hs-identifier hs-var">exts</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SessionID
-&gt; (SessionID -&gt; Maybe ExtendedMasterSecret)
-&gt; Maybe ExtendedMasterSecret
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">MessageType -&gt; SessionID -&gt; Maybe ExtendedMasterSecret
forall a. Extension a =&gt; MessageType -&gt; SessionID -&gt; Maybe a
</span><a href="Network.TLS.Extension.html#extensionDecode"><span class="hs-identifier hs-var">extensionDecode</span></a></span><span> </span><span class="annot"><span class="annottext">MessageType
</span><a href="#local-6989586621679190254"><span class="hs-identifier hs-var">msgt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-200"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">ExtendedMasterSecret
</span><a href="Network.TLS.Extension.html#ExtendedMasterSecret"><span class="hs-identifier hs-var">ExtendedMasterSecret</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Context -&gt; HandshakeM () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; Context -&gt; HandshakeM a -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#usingHState"><span class="hs-identifier hs-var">usingHState</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190252"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; HandshakeM ()
</span><a href="Network.TLS.Handshake.State.html#setExtendedMasterSec"><span class="hs-identifier hs-var">setExtendedMasterSec</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m () -&gt; m Bool -&gt; m Bool
forall a b. m a -&gt; m b -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-201"></span><span>            </span><span class="annot"><span class="annottext">Maybe ExtendedMasterSecret
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EMSMode
</span><a href="#local-6989586621679190260"><span class="hs-identifier hs-var">ems</span></a></span><span> </span><span class="annot"><span class="annottext">EMSMode -&gt; EMSMode -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">EMSMode
</span><a href="Network.TLS.Parameters.html#RequireEMS"><span class="hs-identifier hs-var">RequireEMS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TLSError -&gt; m Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">(TLSError -&gt; m Bool) -&gt; TLSError -&gt; m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool, AlertDescription) -&gt; TLSError
</span><a href="Network.TLS.Struct.html#Error_Protocol"><span class="hs-identifier hs-var">Error_Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679190267"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#HandshakeFailure"><span class="hs-identifier hs-var">HandshakeFailure</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679190260"><span class="annot"><span class="annottext">ems :: EMSMode
</span><a href="#local-6989586621679190260"><span class="hs-identifier hs-var hs-var">ems</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Supported -&gt; EMSMode
</span><a href="Network.TLS.Parameters.html#supportedExtendedMasterSec"><span class="hs-identifier hs-var">supportedExtendedMasterSec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; Supported
</span><a href="Network.TLS.Context.Internal.html#ctxSupported"><span class="hs-identifier hs-var">ctxSupported</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190252"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>        </span><span id="local-6989586621679190267"><span class="annot"><span class="annottext">err :: String
</span><a href="#local-6989586621679190267"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;peer does not support Extended Master Secret&quot;</span></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#getSessionData"><span class="hs-identifier hs-type">getSessionData</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#SessionData"><span class="hs-identifier hs-type">SessionData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span id="getSessionData"><span class="annot"><span class="annottext">getSessionData :: Context -&gt; IO (Maybe SessionData)
</span><a href="Network.TLS.Handshake.Common.html#getSessionData"><span class="hs-identifier hs-var hs-var">getSessionData</span></a></span></span><span> </span><span id="local-6989586621679190271"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190271"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-208"></span><span>    </span><span id="local-6989586621679190272"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679190272"><span class="hs-identifier hs-var">ver</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; TLSSt Version -&gt; IO Version
forall a. Context -&gt; TLSSt a -&gt; IO a
</span><a href="Network.TLS.Context.Internal.html#usingState_"><span class="hs-identifier hs-var">usingState_</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190271"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSt Version
</span><a href="Network.TLS.State.html#getVersion"><span class="hs-identifier hs-var">getVersion</span></a></span><span>
</span><span id="line-209"></span><span>    </span><span id="local-6989586621679190273"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679190273"><span class="hs-identifier hs-var">sni</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; TLSSt (Maybe String) -&gt; IO (Maybe String)
forall a. Context -&gt; TLSSt a -&gt; IO a
</span><a href="Network.TLS.Context.Internal.html#usingState_"><span class="hs-identifier hs-var">usingState_</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190271"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSt (Maybe String)
</span><a href="Network.TLS.State.html#getClientSNI"><span class="hs-identifier hs-var">getClientSNI</span></a></span><span>
</span><span id="line-210"></span><span>    </span><span id="local-6989586621679190275"><span class="annot"><span class="annottext">Maybe SessionID
</span><a href="#local-6989586621679190275"><span class="hs-identifier hs-var">mms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; HandshakeM (Maybe SessionID) -&gt; IO (Maybe SessionID)
forall (m :: * -&gt; *) a. MonadIO m =&gt; Context -&gt; HandshakeM a -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#usingHState"><span class="hs-identifier hs-var">usingHState</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190271"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HandshakeState -&gt; Maybe SessionID) -&gt; HandshakeM (Maybe SessionID)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">HandshakeState -&gt; Maybe SessionID
</span><a href="Network.TLS.Handshake.State.html#hstMasterSecret"><span class="hs-identifier hs-var">hstMasterSecret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679190277"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679190277"><span class="hs-identifier hs-var">ems</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; HandshakeM Bool -&gt; IO Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; Context -&gt; HandshakeM a -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#usingHState"><span class="hs-identifier hs-var">usingHState</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190271"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">HandshakeM Bool
</span><a href="Network.TLS.Handshake.State.html#getExtendedMasterSec"><span class="hs-identifier hs-var">getExtendedMasterSec</span></a></span><span>
</span><span id="line-212"></span><span>    </span><span id="local-6989586621679190279"><span class="annot"><span class="annottext">RecordState
</span><a href="#local-6989586621679190279"><span class="hs-identifier hs-var">tx</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO RecordState -&gt; IO RecordState
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO RecordState -&gt; IO RecordState)
-&gt; IO RecordState -&gt; IO RecordState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MVar RecordState -&gt; IO RecordState
forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readMVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; MVar RecordState
</span><a href="Network.TLS.Context.Internal.html#ctxTxState"><span class="hs-identifier hs-var">ctxTxState</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190271"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621679190282"><span class="annot"><span class="annottext">Maybe SessionID
</span><a href="#local-6989586621679190282"><span class="hs-identifier hs-var">alpn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; TLSSt (Maybe SessionID) -&gt; IO (Maybe SessionID)
forall a. Context -&gt; TLSSt a -&gt; IO a
</span><a href="Network.TLS.Context.Internal.html#usingState_"><span class="hs-identifier hs-var">usingState_</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190271"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSt (Maybe SessionID)
</span><a href="Network.TLS.State.html#getNegotiatedProtocol"><span class="hs-identifier hs-var">getNegotiatedProtocol</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679190284"><span class="annot"><span class="annottext">cipher :: ExtensionID
</span><a href="#local-6989586621679190284"><span class="hs-identifier hs-var hs-var">cipher</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cipher -&gt; ExtensionID
</span><a href="Network.TLS.Cipher.html#cipherID"><span class="hs-identifier hs-var">cipherID</span></a></span><span> </span><span class="annot"><span class="annottext">(Cipher -&gt; ExtensionID) -&gt; Cipher -&gt; ExtensionID
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe Cipher -&gt; Cipher
forall a. String -&gt; Maybe a -&gt; a
</span><a href="Network.TLS.Util.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cipher&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Cipher -&gt; Cipher) -&gt; Maybe Cipher -&gt; Cipher
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecordState -&gt; Maybe Cipher
</span><a href="Network.TLS.Record.State.html#stCipher"><span class="hs-identifier hs-var">stCipher</span></a></span><span> </span><span class="annot"><span class="annottext">RecordState
</span><a href="#local-6989586621679190279"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-215"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679190287"><span class="annot"><span class="annottext">compression :: CompressionID
</span><a href="#local-6989586621679190287"><span class="hs-identifier hs-var hs-var">compression</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Compression -&gt; CompressionID
</span><a href="Network.TLS.Compression.html#compressionID"><span class="hs-identifier hs-var">compressionID</span></a></span><span> </span><span class="annot"><span class="annottext">(Compression -&gt; CompressionID) -&gt; Compression -&gt; CompressionID
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RecordState -&gt; Compression
</span><a href="Network.TLS.Record.State.html#stCompression"><span class="hs-identifier hs-var">stCompression</span></a></span><span> </span><span class="annot"><span class="annottext">RecordState
</span><a href="#local-6989586621679190279"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-216"></span><span>        </span><span id="local-6989586621679190290"><span class="annot"><span class="annottext">flags :: [SessionFlag]
</span><a href="#local-6989586621679190290"><span class="hs-identifier hs-var hs-var">flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SessionFlag
</span><a href="Network.TLS.Types.html#SessionEMS"><span class="hs-identifier hs-var">SessionEMS</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679190277"><span class="hs-identifier hs-var">ems</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe SessionID
</span><a href="#local-6989586621679190275"><span class="hs-identifier hs-var">mms</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-218"></span><span>        </span><span class="annot"><span class="annottext">Maybe SessionID
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe SessionData -&gt; IO (Maybe SessionData)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe SessionData
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-219"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679190292"><span class="annot"><span class="annottext">SessionID
</span><a href="#local-6989586621679190292"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe SessionData -&gt; IO (Maybe SessionData)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe SessionData -&gt; IO (Maybe SessionData))
-&gt; Maybe SessionData -&gt; IO (Maybe SessionData)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SessionData -&gt; Maybe SessionData
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><a href="Network.TLS.Types.html#SessionData"><span class="hs-identifier hs-type">SessionData</span></a></span><span>
</span><span id="line-220"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sessionVersion :: Version
</span><a href="#local-6989586621679190294"><span class="hs-identifier hs-var">sessionVersion</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679190272"><span class="hs-identifier hs-var">ver</span></a></span><span>
</span><span id="line-221"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sessionCipher :: ExtensionID
</span><a href="#local-6989586621679190295"><span class="hs-identifier hs-var">sessionCipher</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExtensionID
</span><a href="#local-6989586621679190284"><span class="hs-identifier hs-var">cipher</span></a></span><span>
</span><span id="line-222"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sessionCompression :: CompressionID
</span><a href="#local-6989586621679190296"><span class="hs-identifier hs-var">sessionCompression</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompressionID
</span><a href="#local-6989586621679190287"><span class="hs-identifier hs-var">compression</span></a></span><span>
</span><span id="line-223"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sessionClientSNI :: Maybe String
</span><a href="#local-6989586621679190297"><span class="hs-identifier hs-var">sessionClientSNI</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679190273"><span class="hs-identifier hs-var">sni</span></a></span><span>
</span><span id="line-224"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sessionSecret :: SessionID
</span><a href="#local-6989586621679190298"><span class="hs-identifier hs-var">sessionSecret</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SessionID
</span><a href="#local-6989586621679190292"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-225"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sessionGroup :: Maybe Group
</span><a href="#local-6989586621679190299"><span class="hs-identifier hs-var">sessionGroup</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Group
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-226"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sessionTicketInfo :: Maybe TLS13TicketInfo
</span><a href="#local-6989586621679190300"><span class="hs-identifier hs-var">sessionTicketInfo</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TLS13TicketInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-227"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sessionALPN :: Maybe SessionID
</span><a href="#local-6989586621679190301"><span class="hs-identifier hs-var">sessionALPN</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SessionID
</span><a href="#local-6989586621679190282"><span class="hs-identifier hs-var">alpn</span></a></span><span>
</span><span id="line-228"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sessionMaxEarlyDataSize :: Int
</span><a href="#local-6989586621679190302"><span class="hs-identifier hs-var">sessionMaxEarlyDataSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-229"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sessionFlags :: [SessionFlag]
</span><a href="#local-6989586621679190303"><span class="hs-identifier hs-var">sessionFlags</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SessionFlag]
</span><a href="#local-6989586621679190290"><span class="hs-identifier hs-var">flags</span></a></span><span>
</span><span id="line-230"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#extensionLookup"><span class="hs-identifier hs-type">extensionLookup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Struct.html#ExtensionID"><span class="hs-identifier hs-type">ExtensionID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.TLS.Struct.html#ExtensionRaw"><span class="hs-identifier hs-type">ExtensionRaw</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-233"></span><span id="extensionLookup"><span class="annot"><span class="annottext">extensionLookup :: ExtensionID -&gt; [ExtensionRaw] -&gt; Maybe SessionID
</span><a href="Network.TLS.Handshake.Common.html#extensionLookup"><span class="hs-identifier hs-var hs-var">extensionLookup</span></a></span></span><span> </span><span id="local-6989586621679190305"><span class="annot"><span class="annottext">ExtensionID
</span><a href="#local-6989586621679190305"><span class="hs-identifier hs-var">toFind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ExtensionRaw -&gt; SessionID)
-&gt; Maybe ExtensionRaw -&gt; Maybe SessionID
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Struct.html#ExtensionRaw"><span class="hs-identifier hs-type">ExtensionRaw</span></a></span><span> </span><span class="annot"><span class="annottext">ExtensionID
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679190307"><span class="annot"><span class="annottext">SessionID
</span><a href="#local-6989586621679190307"><span class="hs-identifier hs-var">content</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SessionID
</span><a href="#local-6989586621679190307"><span class="hs-identifier hs-var">content</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>                       </span><span class="annot"><span class="annottext">(Maybe ExtensionRaw -&gt; Maybe SessionID)
-&gt; ([ExtensionRaw] -&gt; Maybe ExtensionRaw)
-&gt; [ExtensionRaw]
-&gt; Maybe SessionID
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ExtensionRaw -&gt; Bool) -&gt; [ExtensionRaw] -&gt; Maybe ExtensionRaw
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Struct.html#ExtensionRaw"><span class="hs-identifier hs-type">ExtensionRaw</span></a></span><span> </span><span id="local-6989586621679190309"><span class="annot"><span class="annottext">ExtensionID
</span><a href="#local-6989586621679190309"><span class="hs-identifier hs-var">eid</span></a></span></span><span> </span><span class="annot"><span class="annottext">SessionID
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExtensionID
</span><a href="#local-6989586621679190309"><span class="hs-identifier hs-var">eid</span></a></span><span> </span><span class="annot"><span class="annottext">ExtensionID -&gt; ExtensionID -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ExtensionID
</span><a href="#local-6989586621679190305"><span class="hs-identifier hs-var">toFind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="hs-comment">-- | Store the specified keypair.  Whether the public key and private key</span><span>
</span><span id="line-237"></span><span class="hs-comment">-- actually match is left for the peer to discover.  We're not presently</span><span>
</span><span id="line-238"></span><span class="hs-comment">-- burning  CPU to detect that misconfiguration.  We verify only that the</span><span>
</span><span id="line-239"></span><span class="hs-comment">-- types of keys match and that it does not include an algorithm that would</span><span>
</span><span id="line-240"></span><span class="hs-comment">-- not be safe.</span><span>
</span><span id="line-241"></span><span id="local-6989586621679189918"><span class="annot"><a href="Network.TLS.Handshake.Common.html#storePrivInfo"><span class="hs-identifier hs-type">storePrivInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679189918"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-242"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-243"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CertificateChain</span></span><span>
</span><span id="line-244"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PrivKey</span></span><span>
</span><span id="line-245"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679189918"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PubKey</span></span></span><span>
</span><span id="line-246"></span><span id="storePrivInfo"><span class="annot"><span class="annottext">storePrivInfo :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Context -&gt; CertificateChain -&gt; PrivKey -&gt; m PubKey
</span><a href="Network.TLS.Handshake.Common.html#storePrivInfo"><span class="hs-identifier hs-var hs-var">storePrivInfo</span></a></span></span><span> </span><span id="local-6989586621679190319"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190319"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679190320"><span class="annot"><span class="annottext">CertificateChain
</span><a href="#local-6989586621679190320"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span id="local-6989586621679190321"><span class="annot"><span class="annottext">PrivKey
</span><a href="#local-6989586621679190321"><span class="hs-identifier hs-var">privkey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CertificateChain</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679190323"><span class="annot"><span class="annottext">SignedExact Certificate
</span><a href="#local-6989586621679190323"><span class="hs-identifier hs-var">c</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[SignedExact Certificate]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CertificateChain
</span><a href="#local-6989586621679190320"><span class="hs-identifier hs-var">cc</span></a></span><span>
</span><span id="line-248"></span><span>        </span><span id="local-6989586621679190324"><span class="annot"><span class="annottext">pubkey :: PubKey
</span><a href="#local-6989586621679190324"><span class="hs-identifier hs-var hs-var">pubkey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Certificate -&gt; PubKey
</span><span class="hs-identifier hs-var">certPubKey</span></span><span> </span><span class="annot"><span class="annottext">(Certificate -&gt; PubKey) -&gt; Certificate -&gt; PubKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SignedExact Certificate -&gt; Certificate
</span><span class="hs-identifier hs-var">getCertificate</span></span><span> </span><span class="annot"><span class="annottext">SignedExact Certificate
</span><a href="#local-6989586621679190323"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-249"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PubKey, PrivKey) -&gt; Bool
</span><a href="Network.TLS.Handshake.Key.html#isDigitalSignaturePair"><span class="hs-identifier hs-var">isDigitalSignaturePair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PubKey
</span><a href="#local-6989586621679190324"><span class="hs-identifier hs-var">pubkey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrivKey
</span><a href="#local-6989586621679190321"><span class="hs-identifier hs-var">privkey</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-250"></span><span>        </span><span class="annot"><span class="annottext">TLSError -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">(TLSError -&gt; m ()) -&gt; TLSError -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool, AlertDescription) -&gt; TLSError
</span><a href="Network.TLS.Struct.html#Error_Protocol"><span class="hs-identifier hs-var">Error_Protocol</span></a></span><span>
</span><span id="line-251"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mismatched or unsupported private key pair&quot;</span></span><span>
</span><span id="line-252"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-253"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#InternalError"><span class="hs-identifier hs-var">InternalError</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; HandshakeM () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; Context -&gt; HandshakeM a -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#usingHState"><span class="hs-identifier hs-var">usingHState</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190319"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(HandshakeM () -&gt; m ()) -&gt; HandshakeM () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PubKey, PrivKey) -&gt; HandshakeM ()
</span><a href="Network.TLS.Handshake.State.html#setPublicPrivateKeys"><span class="hs-identifier hs-var">setPublicPrivateKeys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PubKey
</span><a href="#local-6989586621679190324"><span class="hs-identifier hs-var">pubkey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrivKey
</span><a href="#local-6989586621679190321"><span class="hs-identifier hs-var">privkey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>    </span><span class="annot"><span class="annottext">PubKey -&gt; m PubKey
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">PubKey
</span><a href="#local-6989586621679190324"><span class="hs-identifier hs-var">pubkey</span></a></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="hs-comment">-- verify that the group selected by the peer is supported in the local</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- configuration</span><span>
</span><span id="line-259"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#checkSupportedGroup"><span class="hs-identifier hs-type">checkSupportedGroup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Crypto.Types.html#Group"><span class="hs-identifier hs-type">Group</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span id="checkSupportedGroup"><span class="annot"><span class="annottext">checkSupportedGroup :: Context -&gt; Group -&gt; IO ()
</span><a href="Network.TLS.Handshake.Common.html#checkSupportedGroup"><span class="hs-identifier hs-var hs-var">checkSupportedGroup</span></a></span></span><span> </span><span id="local-6989586621679190329"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190329"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679190330"><span class="annot"><span class="annottext">Group
</span><a href="#local-6989586621679190330"><span class="hs-identifier hs-var">grp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-261"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; Group -&gt; Bool
</span><a href="Network.TLS.Handshake.Common.html#isSupportedGroup"><span class="hs-identifier hs-var">isSupportedGroup</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190329"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Group
</span><a href="#local-6989586621679190330"><span class="hs-identifier hs-var">grp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-262"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679190335"><span class="annot"><span class="annottext">msg :: String
</span><a href="#local-6989586621679190335"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unsupported (EC)DHE group: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Group -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Group
</span><a href="#local-6989586621679190330"><span class="hs-identifier hs-var">grp</span></a></span><span>
</span><span id="line-263"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">TLSError -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">(TLSError -&gt; IO ()) -&gt; TLSError -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool, AlertDescription) -&gt; TLSError
</span><a href="Network.TLS.Struct.html#Error_Protocol"><span class="hs-identifier hs-var">Error_Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679190335"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#IllegalParameter"><span class="hs-identifier hs-var">IllegalParameter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span class="annot"><a href="Network.TLS.Handshake.Common.html#isSupportedGroup"><span class="hs-identifier hs-type">isSupportedGroup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Crypto.Types.html#Group"><span class="hs-identifier hs-type">Group</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-266"></span><span id="isSupportedGroup"><span class="annot"><span class="annottext">isSupportedGroup :: Context -&gt; Group -&gt; Bool
</span><a href="Network.TLS.Handshake.Common.html#isSupportedGroup"><span class="hs-identifier hs-var hs-var">isSupportedGroup</span></a></span></span><span> </span><span id="local-6989586621679190336"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190336"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679190337"><span class="annot"><span class="annottext">Group
</span><a href="#local-6989586621679190337"><span class="hs-identifier hs-var">grp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Group
</span><a href="#local-6989586621679190337"><span class="hs-identifier hs-var">grp</span></a></span><span> </span><span class="annot"><span class="annottext">Group -&gt; [Group] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">Supported -&gt; [Group]
</span><a href="Network.TLS.Parameters.html#supportedGroups"><span class="hs-identifier hs-var">supportedGroups</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; Supported
</span><a href="Network.TLS.Context.Internal.html#ctxSupported"><span class="hs-identifier hs-var">ctxSupported</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679190336"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span></pre></body></html>