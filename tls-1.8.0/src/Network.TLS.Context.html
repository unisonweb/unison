<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- Module      : Network.TLS.Context</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- License     : BSD-style</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Stability   : experimental</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Portability : unknown</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.TLS.Context</span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-special">(</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Context configuration</span></span><span>
</span><span id="line-12"></span><span>      </span><span class="annot"><a href="Network.TLS.Context.html#TLSParams"><span class="hs-identifier">TLSParams</span></a></span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Context object and accessor</span></span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier">Context</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Hooks.html#Hooks"><span class="hs-identifier">Hooks</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Established"><span class="hs-identifier">Established</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#ctxEOF"><span class="hs-identifier">ctxEOF</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#ctxHasSSLv2ClientHello"><span class="hs-identifier">ctxHasSSLv2ClientHello</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#ctxDisableSSLv2ClientHello"><span class="hs-identifier">ctxDisableSSLv2ClientHello</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#ctxEstablished"><span class="hs-identifier">ctxEstablished</span></a></span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#withLog"><span class="hs-identifier">withLog</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#ctxWithHooks"><span class="hs-identifier">ctxWithHooks</span></a></span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#contextModifyHooks"><span class="hs-identifier">contextModifyHooks</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#setEOF"><span class="hs-identifier">setEOF</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#setEstablished"><span class="hs-identifier">setEstablished</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#contextFlush"><span class="hs-identifier">contextFlush</span></a></span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#contextClose"><span class="hs-identifier">contextClose</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#contextSend"><span class="hs-identifier">contextSend</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#contextRecv"><span class="hs-identifier">contextRecv</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#updateMeasure"><span class="hs-identifier">updateMeasure</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#withMeasure"><span class="hs-identifier">withMeasure</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#withReadLock"><span class="hs-identifier">withReadLock</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#withWriteLock"><span class="hs-identifier">withWriteLock</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#withStateLock"><span class="hs-identifier">withStateLock</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#withRWLock"><span class="hs-identifier">withRWLock</span></a></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><span class="hs-comment">-- * information</span></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Information"><span class="hs-identifier">Information</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#contextGetInformation"><span class="hs-identifier">contextGetInformation</span></a></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><span class="hs-comment">-- * New contexts</span></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.html#contextNew"><span class="hs-identifier">contextNew</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Deprecated new contexts methods</span></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.html#contextNewOnHandle"><span class="hs-identifier">contextNewOnHandle</span></a></span><span class="hs-cpp">
#ifdef INCLUDE_NETWORK
</span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.html#contextNewOnSocket"><span class="hs-identifier">contextNewOnSocket</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Context hooks</span></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.html#contextHookSetHandshakeRecv"><span class="hs-identifier">contextHookSetHandshakeRecv</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.html#contextHookSetHandshake13Recv"><span class="hs-identifier">contextHookSetHandshake13Recv</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.html#contextHookSetCertificateRecv"><span class="hs-identifier">contextHookSetCertificateRecv</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.html#contextHookSetLogging"><span class="hs-identifier">contextHookSetLogging</span></a></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Using context states</span></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier">throwCore</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#usingState"><span class="hs-identifier">usingState</span></a></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#usingState_"><span class="hs-identifier">usingState_</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#runTxState"><span class="hs-identifier">runTxState</span></a></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#runRxState"><span class="hs-identifier">runRxState</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#usingHState"><span class="hs-identifier">usingHState</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#getHState"><span class="hs-identifier">getHState</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#getStateRNG"><span class="hs-identifier">getStateRNG</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#tls13orLater"><span class="hs-identifier">tls13orLater</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.html#getFinished"><span class="hs-identifier">getFinished</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.html#getPeerFinished"><span class="hs-identifier">getPeerFinished</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Backend.html"><span class="hs-identifier">Network.TLS.Backend</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html"><span class="hs-identifier">Network.TLS.Context.Internal</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Struct.html"><span class="hs-identifier">Network.TLS.Struct</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Struct13.html"><span class="hs-identifier">Network.TLS.Struct13</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.State.html"><span class="hs-identifier">Network.TLS.State</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Hooks.html"><span class="hs-identifier">Network.TLS.Hooks</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Record.State.html"><span class="hs-identifier">Network.TLS.Record.State</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Record.Layer.html"><span class="hs-identifier">Network.TLS.Record.Layer</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Record.Reading.html"><span class="hs-identifier">Network.TLS.Record.Reading</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Record.Writing.html"><span class="hs-identifier">Network.TLS.Record.Writing</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Parameters.html"><span class="hs-identifier">Network.TLS.Parameters</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Measurement.html"><span class="hs-identifier">Network.TLS.Measurement</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Types.html"><span class="hs-identifier">Network.TLS.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Types.html#Role"><span class="hs-identifier">Role</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.html"><span class="hs-identifier">Network.TLS.Handshake</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Handshake.Client.html#handshakeClient"><span class="hs-identifier">handshakeClient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Client.html#handshakeClientWith"><span class="hs-identifier">handshakeClientWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Server.html#handshakeServer"><span class="hs-identifier">handshakeServer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Server.html#handshakeServerWith"><span class="hs-identifier">handshakeServerWith</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.PostHandshake.html"><span class="hs-identifier">Network.TLS.PostHandshake</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Handshake.Server.html#requestCertificateServer"><span class="hs-identifier">requestCertificateServer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Client.html#postHandshakeAuthClientWith"><span class="hs-identifier">postHandshakeAuthClientWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Server.html#postHandshakeAuthServerWith"><span class="hs-identifier">postHandshakeAuthServerWith</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.X509.html"><span class="hs-identifier">Network.TLS.X509</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.RNG.html"><span class="hs-identifier">Network.TLS.RNG</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.MVar</span></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State.Strict</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IORef</span></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-comment">-- deprecated imports</span><span class="hs-cpp">
#ifdef INCLUDE_NETWORK
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Socket</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Socket</span></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Handle</span></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-keyword">class</span><span> </span><span id="TLSParams"><span class="annot"><a href="Network.TLS.Context.html#TLSParams"><span class="hs-identifier hs-var">TLSParams</span></a></span></span><span> </span><span id="local-6989586621679195888"><span class="annot"><a href="#local-6989586621679195888"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-99"></span><span>    </span><span id="getTLSCommonParams"><span class="annot"><a href="Network.TLS.Context.html#getTLSCommonParams"><span class="hs-identifier hs-type">getTLSCommonParams</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679195888"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Parameters.html#CommonParams"><span class="hs-identifier hs-type">CommonParams</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span id="getTLSRole"><span class="annot"><a href="Network.TLS.Context.html#getTLSRole"><span class="hs-identifier hs-type">getTLSRole</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679195888"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Types.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-101"></span><span>    </span><span id="doHandshake"><span class="annot"><a href="Network.TLS.Context.html#doHandshake"><span class="hs-identifier hs-type">doHandshake</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679195888"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>    </span><span id="doHandshakeWith"><span class="annot"><a href="Network.TLS.Context.html#doHandshakeWith"><span class="hs-identifier hs-type">doHandshakeWith</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679195888"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Struct.html#Handshake"><span class="hs-identifier hs-type">Handshake</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>    </span><span id="doRequestCertificate"><span class="annot"><a href="Network.TLS.Context.html#doRequestCertificate"><span class="hs-identifier hs-type">doRequestCertificate</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679195888"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-104"></span><span>    </span><span id="doPostHandshakeAuthWith"><span class="annot"><a href="Network.TLS.Context.html#doPostHandshakeAuthWith"><span class="hs-identifier hs-type">doPostHandshakeAuthWith</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679195888"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Struct13.html#Handshake13"><span class="hs-identifier hs-type">Handshake13</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Network.TLS.Context.html#TLSParams"><span class="hs-identifier hs-type">TLSParams</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Parameters.html#ClientParams"><span class="hs-identifier hs-type">ClientParams</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-107"></span><span>    </span><span id="local-6989586621679196015"><span class="annot"><span class="annottext">getTLSCommonParams :: ClientParams -&gt; CommonParams
</span><a href="Network.TLS.Context.html#getTLSCommonParams"><span class="hs-identifier hs-var hs-var hs-var hs-var">getTLSCommonParams</span></a></span></span><span> </span><span id="local-6989586621679196016"><span class="annot"><span class="annottext">ClientParams
</span><a href="#local-6989586621679196016"><span class="hs-identifier hs-var">cparams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ClientParams -&gt; Supported
</span><a href="Network.TLS.Parameters.html#clientSupported"><span class="hs-identifier hs-var">clientSupported</span></a></span><span> </span><span class="annot"><span class="annottext">ClientParams
</span><a href="#local-6989586621679196016"><span class="hs-identifier hs-var">cparams</span></a></span><span>
</span><span id="line-108"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ClientParams -&gt; Shared
</span><a href="Network.TLS.Parameters.html#clientShared"><span class="hs-identifier hs-var">clientShared</span></a></span><span> </span><span class="annot"><span class="annottext">ClientParams
</span><a href="#local-6989586621679196016"><span class="hs-identifier hs-var">cparams</span></a></span><span>
</span><span id="line-109"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ClientParams -&gt; DebugParams
</span><a href="Network.TLS.Parameters.html#clientDebug"><span class="hs-identifier hs-var">clientDebug</span></a></span><span> </span><span class="annot"><span class="annottext">ClientParams
</span><a href="#local-6989586621679196016"><span class="hs-identifier hs-var">cparams</span></a></span><span>
</span><span id="line-110"></span><span>                                 </span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>    </span><span id="local-6989586621679196020"><span class="annot"><span class="annottext">getTLSRole :: ClientParams -&gt; Role
</span><a href="Network.TLS.Context.html#getTLSRole"><span class="hs-identifier hs-var hs-var hs-var hs-var">getTLSRole</span></a></span></span><span> </span><span class="annot"><span class="annottext">ClientParams
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Network.TLS.Types.html#ClientRole"><span class="hs-identifier hs-var">ClientRole</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span id="local-6989586621679196022"><span class="annot"><span class="annottext">doHandshake :: ClientParams -&gt; Context -&gt; IO ()
</span><a href="Network.TLS.Context.html#doHandshake"><span class="hs-identifier hs-var hs-var hs-var hs-var">doHandshake</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClientParams -&gt; Context -&gt; IO ()
</span><a href="Network.TLS.Handshake.Client.html#handshakeClient"><span class="hs-identifier hs-var">handshakeClient</span></a></span><span>
</span><span id="line-113"></span><span>    </span><span id="local-6989586621679196023"><span class="annot"><span class="annottext">doHandshakeWith :: ClientParams -&gt; Context -&gt; Handshake -&gt; IO ()
</span><a href="Network.TLS.Context.html#doHandshakeWith"><span class="hs-identifier hs-var hs-var hs-var hs-var">doHandshakeWith</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClientParams -&gt; Context -&gt; Handshake -&gt; IO ()
</span><a href="Network.TLS.Handshake.Client.html#handshakeClientWith"><span class="hs-identifier hs-var">handshakeClientWith</span></a></span><span>
</span><span id="line-114"></span><span>    </span><span id="local-6989586621679196026"><span class="annot"><span class="annottext">doRequestCertificate :: ClientParams -&gt; Context -&gt; IO Bool
</span><a href="Network.TLS.Context.html#doRequestCertificate"><span class="hs-identifier hs-var hs-var hs-var hs-var">doRequestCertificate</span></a></span></span><span> </span><span class="annot"><span class="annottext">ClientParams
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-115"></span><span>    </span><span id="local-6989586621679196027"><span class="annot"><span class="annottext">doPostHandshakeAuthWith :: ClientParams -&gt; Context -&gt; Handshake13 -&gt; IO ()
</span><a href="Network.TLS.Context.html#doPostHandshakeAuthWith"><span class="hs-identifier hs-var hs-var hs-var hs-var">doPostHandshakeAuthWith</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClientParams -&gt; Context -&gt; Handshake13 -&gt; IO ()
</span><a href="Network.TLS.Handshake.Client.html#postHandshakeAuthClientWith"><span class="hs-identifier hs-var">postHandshakeAuthClientWith</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Network.TLS.Context.html#TLSParams"><span class="hs-identifier hs-type">TLSParams</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Parameters.html#ServerParams"><span class="hs-identifier hs-type">ServerParams</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-118"></span><span>    </span><span id="local-6989586621679196035"><span class="annot"><span class="annottext">getTLSCommonParams :: ServerParams -&gt; CommonParams
</span><a href="Network.TLS.Context.html#getTLSCommonParams"><span class="hs-identifier hs-var hs-var hs-var hs-var">getTLSCommonParams</span></a></span></span><span> </span><span id="local-6989586621679196036"><span class="annot"><span class="annottext">ServerParams
</span><a href="#local-6989586621679196036"><span class="hs-identifier hs-var">sparams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ServerParams -&gt; Supported
</span><a href="Network.TLS.Parameters.html#serverSupported"><span class="hs-identifier hs-var">serverSupported</span></a></span><span> </span><span class="annot"><span class="annottext">ServerParams
</span><a href="#local-6989586621679196036"><span class="hs-identifier hs-var">sparams</span></a></span><span>
</span><span id="line-119"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ServerParams -&gt; Shared
</span><a href="Network.TLS.Parameters.html#serverShared"><span class="hs-identifier hs-var">serverShared</span></a></span><span> </span><span class="annot"><span class="annottext">ServerParams
</span><a href="#local-6989586621679196036"><span class="hs-identifier hs-var">sparams</span></a></span><span>
</span><span id="line-120"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ServerParams -&gt; DebugParams
</span><a href="Network.TLS.Parameters.html#serverDebug"><span class="hs-identifier hs-var">serverDebug</span></a></span><span> </span><span class="annot"><span class="annottext">ServerParams
</span><a href="#local-6989586621679196036"><span class="hs-identifier hs-var">sparams</span></a></span><span>
</span><span id="line-121"></span><span>                                 </span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>    </span><span id="local-6989586621679196040"><span class="annot"><span class="annottext">getTLSRole :: ServerParams -&gt; Role
</span><a href="Network.TLS.Context.html#getTLSRole"><span class="hs-identifier hs-var hs-var hs-var hs-var">getTLSRole</span></a></span></span><span> </span><span class="annot"><span class="annottext">ServerParams
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Network.TLS.Types.html#ServerRole"><span class="hs-identifier hs-var">ServerRole</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span id="local-6989586621679196042"><span class="annot"><span class="annottext">doHandshake :: ServerParams -&gt; Context -&gt; IO ()
</span><a href="Network.TLS.Context.html#doHandshake"><span class="hs-identifier hs-var hs-var hs-var hs-var">doHandshake</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerParams -&gt; Context -&gt; IO ()
</span><a href="Network.TLS.Handshake.Server.html#handshakeServer"><span class="hs-identifier hs-var">handshakeServer</span></a></span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621679196043"><span class="annot"><span class="annottext">doHandshakeWith :: ServerParams -&gt; Context -&gt; Handshake -&gt; IO ()
</span><a href="Network.TLS.Context.html#doHandshakeWith"><span class="hs-identifier hs-var hs-var hs-var hs-var">doHandshakeWith</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerParams -&gt; Context -&gt; Handshake -&gt; IO ()
</span><a href="Network.TLS.Handshake.Server.html#handshakeServerWith"><span class="hs-identifier hs-var">handshakeServerWith</span></a></span><span>
</span><span id="line-125"></span><span>    </span><span id="local-6989586621679196044"><span class="annot"><span class="annottext">doRequestCertificate :: ServerParams -&gt; Context -&gt; IO Bool
</span><a href="Network.TLS.Context.html#doRequestCertificate"><span class="hs-identifier hs-var hs-var hs-var hs-var">doRequestCertificate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerParams -&gt; Context -&gt; IO Bool
</span><a href="Network.TLS.Handshake.Server.html#requestCertificateServer"><span class="hs-identifier hs-var">requestCertificateServer</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span id="local-6989586621679196045"><span class="annot"><span class="annottext">doPostHandshakeAuthWith :: ServerParams -&gt; Context -&gt; Handshake13 -&gt; IO ()
</span><a href="Network.TLS.Context.html#doPostHandshakeAuthWith"><span class="hs-identifier hs-var hs-var hs-var hs-var">doPostHandshakeAuthWith</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerParams -&gt; Context -&gt; Handshake13 -&gt; IO ()
</span><a href="Network.TLS.Handshake.Server.html#postHandshakeAuthServerWith"><span class="hs-identifier hs-var">postHandshakeAuthServerWith</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="annot"><span class="hs-comment">-- | create a new context using the backend and parameters specified.</span></span><span>
</span><span id="line-129"></span><span id="local-6989586621679195895"><span id="local-6989586621679195897"><span id="local-6989586621679195899"><span class="annot"><a href="Network.TLS.Context.html#contextNew"><span class="hs-identifier hs-type">contextNew</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679195895"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Backend.html#HasBackend"><span class="hs-identifier hs-type">HasBackend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679195897"><span class="hs-identifier hs-type">backend</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.html#TLSParams"><span class="hs-identifier hs-type">TLSParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679195899"><span class="hs-identifier hs-type">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679195897"><span class="hs-identifier hs-type">backend</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Backend abstraction with specific method to interact with the connection type.</span></span><span>
</span><span id="line-131"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679195899"><span class="hs-identifier hs-type">params</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Parameters of the context.</span></span><span>
</span><span id="line-132"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679195895"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span></span></span></span><span>
</span><span id="line-133"></span><span id="contextNew"><span class="annot"><span class="annottext">contextNew :: forall (m :: * -&gt; *) backend params.
(MonadIO m, HasBackend backend, TLSParams params) =&gt;
backend -&gt; params -&gt; m Context
</span><a href="Network.TLS.Context.html#contextNew"><span class="hs-identifier hs-var hs-var">contextNew</span></a></span></span><span> </span><span id="local-6989586621679196079"><span class="annot"><span class="annottext">backend
</span><a href="#local-6989586621679196079"><span class="hs-identifier hs-var">backend</span></a></span></span><span> </span><span id="local-6989586621679196080"><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679196080"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO Context -&gt; m Context
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Context -&gt; m Context) -&gt; IO Context -&gt; m Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><span class="annottext">backend -&gt; IO ()
forall a. HasBackend a =&gt; a -&gt; IO ()
</span><a href="Network.TLS.Backend.html#initializeBackend"><span class="hs-identifier hs-var">initializeBackend</span></a></span><span> </span><span class="annot"><span class="annottext">backend
</span><a href="#local-6989586621679196079"><span class="hs-identifier hs-var">backend</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679196084"><span class="annot"><span class="annottext">Supported
</span><a href="#local-6989586621679196084"><span class="hs-identifier hs-var">supported</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679196085"><span class="annot"><span class="annottext">Shared
</span><a href="#local-6989586621679196085"><span class="hs-identifier hs-var">shared</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679196086"><span class="annot"><span class="annottext">DebugParams
</span><a href="#local-6989586621679196086"><span class="hs-identifier hs-var">debug</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">params -&gt; CommonParams
forall a. TLSParams a =&gt; a -&gt; CommonParams
</span><a href="Network.TLS.Context.html#getTLSCommonParams"><span class="hs-identifier hs-var">getTLSCommonParams</span></a></span><span> </span><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679196080"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>    </span><span id="local-6989586621679196087"><span class="annot"><span class="annottext">Seed
</span><a href="#local-6989586621679196087"><span class="hs-identifier hs-var">seed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DebugParams -&gt; Maybe Seed
</span><a href="Network.TLS.Parameters.html#debugSeed"><span class="hs-identifier hs-var">debugSeed</span></a></span><span> </span><span class="annot"><span class="annottext">DebugParams
</span><a href="#local-6989586621679196086"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-139"></span><span>                </span><span class="annot"><span class="annottext">Maybe Seed
</span><span class="hs-identifier hs-var">Nothing</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679196089"><span class="annot"><span class="annottext">Seed
</span><a href="#local-6989586621679196089"><span class="hs-identifier hs-var">seed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Seed
forall (randomly :: * -&gt; *). MonadRandom randomly =&gt; randomly Seed
</span><span class="hs-identifier hs-var">seedNew</span></span><span>
</span><span id="line-140"></span><span>                                  </span><span class="annot"><span class="annottext">DebugParams -&gt; Seed -&gt; IO ()
</span><a href="Network.TLS.Parameters.html#debugPrintSeed"><span class="hs-identifier hs-var">debugPrintSeed</span></a></span><span> </span><span class="annot"><span class="annottext">DebugParams
</span><a href="#local-6989586621679196086"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">Seed
</span><a href="#local-6989586621679196089"><span class="hs-identifier hs-var">seed</span></a></span><span>
</span><span id="line-141"></span><span>                                  </span><span class="annot"><span class="annottext">Seed -&gt; IO Seed
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Seed
</span><a href="#local-6989586621679196089"><span class="hs-identifier hs-var">seed</span></a></span><span>
</span><span id="line-142"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679196092"><span class="annot"><span class="annottext">Seed
</span><a href="#local-6989586621679196092"><span class="hs-identifier hs-var">determ</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Seed -&gt; IO Seed
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Seed
</span><a href="#local-6989586621679196092"><span class="hs-identifier hs-var">determ</span></a></span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679196093"><span class="annot"><span class="annottext">rng :: StateRNG
</span><a href="#local-6989586621679196093"><span class="hs-identifier hs-var hs-var">rng</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Seed -&gt; StateRNG
</span><a href="Network.TLS.RNG.html#newStateRNG"><span class="hs-identifier hs-var">newStateRNG</span></a></span><span> </span><span class="annot"><span class="annottext">Seed
</span><a href="#local-6989586621679196087"><span class="hs-identifier hs-var">seed</span></a></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679196096"><span class="annot"><span class="annottext">role :: Role
</span><a href="#local-6989586621679196096"><span class="hs-keyword hs-var hs-var">role</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">params -&gt; Role
forall a. TLSParams a =&gt; a -&gt; Role
</span><a href="Network.TLS.Context.html#getTLSRole"><span class="hs-identifier hs-var">getTLSRole</span></a></span><span> </span><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679196080"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-146"></span><span>        </span><span id="local-6989586621679196097"><span class="annot"><span class="annottext">st :: TLSState
</span><a href="#local-6989586621679196097"><span class="hs-identifier hs-var hs-var">st</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateRNG -&gt; Role -&gt; TLSState
</span><a href="Network.TLS.State.html#newTLSState"><span class="hs-identifier hs-var">newTLSState</span></a></span><span> </span><span class="annot"><span class="annottext">StateRNG
</span><a href="#local-6989586621679196093"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621679196096"><span class="hs-keyword hs-var">role</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>    </span><span id="local-6989586621679196099"><span class="annot"><span class="annottext">MVar TLSState
</span><a href="#local-6989586621679196099"><span class="hs-identifier hs-var">stvar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TLSState -&gt; IO (MVar TLSState)
forall a. a -&gt; IO (MVar a)
</span><span class="hs-identifier hs-var">newMVar</span></span><span> </span><span class="annot"><span class="annottext">TLSState
</span><a href="#local-6989586621679196097"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span id="local-6989586621679196101"><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621679196101"><span class="hs-identifier hs-var">eof</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO (IORef Bool)
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-150"></span><span>    </span><span id="local-6989586621679196103"><span class="annot"><span class="annottext">IORef Established
</span><a href="#local-6989586621679196103"><span class="hs-identifier hs-var">established</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Established -&gt; IO (IORef Established)
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">Established
</span><a href="Network.TLS.Context.Internal.html#NotEstablished"><span class="hs-identifier hs-var">NotEstablished</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span id="local-6989586621679196105"><span class="annot"><span class="annottext">IORef Measurement
</span><a href="#local-6989586621679196105"><span class="hs-identifier hs-var">stats</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; IO (IORef Measurement)
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Network.TLS.Measurement.html#newMeasurement"><span class="hs-identifier hs-var">newMeasurement</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-comment">-- we enable the reception of SSLv2 ClientHello message only in the</span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-comment">-- server context, where we might be dealing with an old/compat client.</span><span>
</span><span id="line-154"></span><span>    </span><span id="local-6989586621679196107"><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621679196107"><span class="hs-identifier hs-var">sslv2Compat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO (IORef Bool)
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621679196096"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Network.TLS.Types.html#ServerRole"><span class="hs-identifier hs-var">ServerRole</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>    </span><span id="local-6989586621679196108"><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621679196108"><span class="hs-identifier hs-var">needEmptyPacket</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO (IORef Bool)
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-156"></span><span>    </span><span id="local-6989586621679196109"><span class="annot"><span class="annottext">IORef Hooks
</span><a href="#local-6989586621679196109"><span class="hs-identifier hs-var">hooks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hooks -&gt; IO (IORef Hooks)
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">Hooks
</span><a href="Network.TLS.Hooks.html#defaultHooks"><span class="hs-identifier hs-var">defaultHooks</span></a></span><span>
</span><span id="line-157"></span><span>    </span><span id="local-6989586621679196111"><span class="annot"><span class="annottext">MVar RecordState
</span><a href="#local-6989586621679196111"><span class="hs-identifier hs-var">tx</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RecordState -&gt; IO (MVar RecordState)
forall a. a -&gt; IO (MVar a)
</span><span class="hs-identifier hs-var">newMVar</span></span><span> </span><span class="annot"><span class="annottext">RecordState
</span><a href="Network.TLS.Record.State.html#newRecordState"><span class="hs-identifier hs-var">newRecordState</span></a></span><span>
</span><span id="line-158"></span><span>    </span><span id="local-6989586621679196113"><span class="annot"><span class="annottext">MVar RecordState
</span><a href="#local-6989586621679196113"><span class="hs-identifier hs-var">rx</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RecordState -&gt; IO (MVar RecordState)
forall a. a -&gt; IO (MVar a)
</span><span class="hs-identifier hs-var">newMVar</span></span><span> </span><span class="annot"><span class="annottext">RecordState
</span><a href="Network.TLS.Record.State.html#newRecordState"><span class="hs-identifier hs-var">newRecordState</span></a></span><span>
</span><span id="line-159"></span><span>    </span><span id="local-6989586621679196114"><span class="annot"><span class="annottext">MVar (Maybe HandshakeState)
</span><a href="#local-6989586621679196114"><span class="hs-identifier hs-var">hs</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe HandshakeState -&gt; IO (MVar (Maybe HandshakeState))
forall a. a -&gt; IO (MVar a)
</span><span class="hs-identifier hs-var">newMVar</span></span><span> </span><span class="annot"><span class="annottext">Maybe HandshakeState
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621679196115"><span class="annot"><span class="annottext">IORef [PendingAction]
</span><a href="#local-6989586621679196115"><span class="hs-keyword hs-var">as</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[PendingAction] -&gt; IO (IORef [PendingAction])
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-161"></span><span>    </span><span id="local-6989586621679196116"><span class="annot"><span class="annottext">IORef [Handshake13]
</span><a href="#local-6989586621679196116"><span class="hs-identifier hs-var">crs</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Handshake13] -&gt; IO (IORef [Handshake13])
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-162"></span><span>    </span><span id="local-6989586621679196117"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679196117"><span class="hs-identifier hs-var">lockWrite</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO (MVar ())
forall a. a -&gt; IO (MVar a)
</span><span class="hs-identifier hs-var">newMVar</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>    </span><span id="local-6989586621679196118"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679196118"><span class="hs-identifier hs-var">lockRead</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO (MVar ())
forall a. a -&gt; IO (MVar a)
</span><span class="hs-identifier hs-var">newMVar</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>    </span><span id="local-6989586621679196119"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679196119"><span class="hs-identifier hs-var">lockState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO (MVar ())
forall a. a -&gt; IO (MVar a)
</span><span class="hs-identifier hs-var">newMVar</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>    </span><span id="local-6989586621679196120"><span class="annot"><span class="annottext">IORef (Maybe FinishedData)
</span><a href="#local-6989586621679196120"><span class="hs-identifier hs-var">finished</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe FinishedData -&gt; IO (IORef (Maybe FinishedData))
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">Maybe FinishedData
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-166"></span><span>    </span><span id="local-6989586621679196121"><span class="annot"><span class="annottext">IORef (Maybe FinishedData)
</span><a href="#local-6989586621679196121"><span class="hs-identifier hs-var">peerFinished</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe FinishedData -&gt; IO (IORef (Maybe FinishedData))
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">Maybe FinishedData
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679196133"><span class="annot"><span class="annottext">ctx :: Context
</span><a href="#local-6989586621679196133"><span class="hs-identifier hs-var hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-169"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctxConnection :: Backend
</span><a href="Network.TLS.Context.Internal.html#ctxConnection"><span class="hs-identifier hs-var">ctxConnection</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">backend -&gt; Backend
forall a. HasBackend a =&gt; a -&gt; Backend
</span><a href="Network.TLS.Backend.html#getBackend"><span class="hs-identifier hs-var">getBackend</span></a></span><span> </span><span class="annot"><span class="annottext">backend
</span><a href="#local-6989586621679196079"><span class="hs-identifier hs-var">backend</span></a></span><span>
</span><span id="line-170"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxShared :: Shared
</span><a href="Network.TLS.Context.Internal.html#ctxShared"><span class="hs-identifier hs-var">ctxShared</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Shared
</span><a href="#local-6989586621679196085"><span class="hs-identifier hs-var">shared</span></a></span><span>
</span><span id="line-171"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxSupported :: Supported
</span><a href="Network.TLS.Context.Internal.html#ctxSupported"><span class="hs-identifier hs-var">ctxSupported</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Supported
</span><a href="#local-6989586621679196084"><span class="hs-identifier hs-var">supported</span></a></span><span>
</span><span id="line-172"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxState :: MVar TLSState
</span><a href="Network.TLS.Context.Internal.html#ctxState"><span class="hs-identifier hs-var">ctxState</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar TLSState
</span><a href="#local-6989586621679196099"><span class="hs-identifier hs-var">stvar</span></a></span><span>
</span><span id="line-173"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxFragmentSize :: Maybe Int
</span><a href="Network.TLS.Context.Internal.html#ctxFragmentSize"><span class="hs-identifier hs-var">ctxFragmentSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16384</span></span><span>
</span><span id="line-174"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxTxState :: MVar RecordState
</span><a href="Network.TLS.Context.Internal.html#ctxTxState"><span class="hs-identifier hs-var">ctxTxState</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar RecordState
</span><a href="#local-6989586621679196111"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-175"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxRxState :: MVar RecordState
</span><a href="Network.TLS.Context.Internal.html#ctxRxState"><span class="hs-identifier hs-var">ctxRxState</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar RecordState
</span><a href="#local-6989586621679196113"><span class="hs-identifier hs-var">rx</span></a></span><span>
</span><span id="line-176"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxHandshake :: MVar (Maybe HandshakeState)
</span><a href="Network.TLS.Context.Internal.html#ctxHandshake"><span class="hs-identifier hs-var">ctxHandshake</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar (Maybe HandshakeState)
</span><a href="#local-6989586621679196114"><span class="hs-identifier hs-var">hs</span></a></span><span>
</span><span id="line-177"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxDoHandshake :: Context -&gt; IO ()
</span><a href="Network.TLS.Context.Internal.html#ctxDoHandshake"><span class="hs-identifier hs-var">ctxDoHandshake</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">params -&gt; Context -&gt; IO ()
forall a. TLSParams a =&gt; a -&gt; Context -&gt; IO ()
</span><a href="Network.TLS.Context.html#doHandshake"><span class="hs-identifier hs-var">doHandshake</span></a></span><span> </span><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679196080"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-178"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxDoHandshakeWith :: Context -&gt; Handshake -&gt; IO ()
</span><a href="Network.TLS.Context.Internal.html#ctxDoHandshakeWith"><span class="hs-identifier hs-var">ctxDoHandshakeWith</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">params -&gt; Context -&gt; Handshake -&gt; IO ()
forall a. TLSParams a =&gt; a -&gt; Context -&gt; Handshake -&gt; IO ()
</span><a href="Network.TLS.Context.html#doHandshakeWith"><span class="hs-identifier hs-var">doHandshakeWith</span></a></span><span> </span><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679196080"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-179"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxDoRequestCertificate :: Context -&gt; IO Bool
</span><a href="Network.TLS.Context.Internal.html#ctxDoRequestCertificate"><span class="hs-identifier hs-var">ctxDoRequestCertificate</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">params -&gt; Context -&gt; IO Bool
forall a. TLSParams a =&gt; a -&gt; Context -&gt; IO Bool
</span><a href="Network.TLS.Context.html#doRequestCertificate"><span class="hs-identifier hs-var">doRequestCertificate</span></a></span><span> </span><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679196080"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-180"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxDoPostHandshakeAuthWith :: Context -&gt; Handshake13 -&gt; IO ()
</span><a href="Network.TLS.Context.Internal.html#ctxDoPostHandshakeAuthWith"><span class="hs-identifier hs-var">ctxDoPostHandshakeAuthWith</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">params -&gt; Context -&gt; Handshake13 -&gt; IO ()
forall a. TLSParams a =&gt; a -&gt; Context -&gt; Handshake13 -&gt; IO ()
</span><a href="Network.TLS.Context.html#doPostHandshakeAuthWith"><span class="hs-identifier hs-var">doPostHandshakeAuthWith</span></a></span><span> </span><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679196080"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-181"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxMeasurement :: IORef Measurement
</span><a href="Network.TLS.Context.Internal.html#ctxMeasurement"><span class="hs-identifier hs-var">ctxMeasurement</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Measurement
</span><a href="#local-6989586621679196105"><span class="hs-identifier hs-var">stats</span></a></span><span>
</span><span id="line-182"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxEOF_ :: IORef Bool
</span><a href="Network.TLS.Context.Internal.html#ctxEOF_"><span class="hs-identifier hs-var">ctxEOF_</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621679196101"><span class="hs-identifier hs-var">eof</span></a></span><span>
</span><span id="line-183"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxEstablished_ :: IORef Established
</span><a href="Network.TLS.Context.Internal.html#ctxEstablished_"><span class="hs-identifier hs-var">ctxEstablished_</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Established
</span><a href="#local-6989586621679196103"><span class="hs-identifier hs-var">established</span></a></span><span>
</span><span id="line-184"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxSSLv2ClientHello :: IORef Bool
</span><a href="Network.TLS.Context.Internal.html#ctxSSLv2ClientHello"><span class="hs-identifier hs-var">ctxSSLv2ClientHello</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621679196107"><span class="hs-identifier hs-var">sslv2Compat</span></a></span><span>
</span><span id="line-185"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxNeedEmptyPacket :: IORef Bool
</span><a href="Network.TLS.Context.Internal.html#ctxNeedEmptyPacket"><span class="hs-identifier hs-var">ctxNeedEmptyPacket</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621679196108"><span class="hs-identifier hs-var">needEmptyPacket</span></a></span><span>
</span><span id="line-186"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxHooks :: IORef Hooks
</span><a href="Network.TLS.Context.Internal.html#ctxHooks"><span class="hs-identifier hs-var">ctxHooks</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Hooks
</span><a href="#local-6989586621679196109"><span class="hs-identifier hs-var">hooks</span></a></span><span>
</span><span id="line-187"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxLockWrite :: MVar ()
</span><a href="Network.TLS.Context.Internal.html#ctxLockWrite"><span class="hs-identifier hs-var">ctxLockWrite</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679196117"><span class="hs-identifier hs-var">lockWrite</span></a></span><span>
</span><span id="line-188"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxLockRead :: MVar ()
</span><a href="Network.TLS.Context.Internal.html#ctxLockRead"><span class="hs-identifier hs-var">ctxLockRead</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679196118"><span class="hs-identifier hs-var">lockRead</span></a></span><span>
</span><span id="line-189"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxLockState :: MVar ()
</span><a href="Network.TLS.Context.Internal.html#ctxLockState"><span class="hs-identifier hs-var">ctxLockState</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679196119"><span class="hs-identifier hs-var">lockState</span></a></span><span>
</span><span id="line-190"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxPendingActions :: IORef [PendingAction]
</span><a href="Network.TLS.Context.Internal.html#ctxPendingActions"><span class="hs-identifier hs-var">ctxPendingActions</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef [PendingAction]
</span><a href="#local-6989586621679196115"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-191"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxCertRequests :: IORef [Handshake13]
</span><a href="Network.TLS.Context.Internal.html#ctxCertRequests"><span class="hs-identifier hs-var">ctxCertRequests</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef [Handshake13]
</span><a href="#local-6989586621679196116"><span class="hs-identifier hs-var">crs</span></a></span><span>
</span><span id="line-192"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxKeyLogger :: String -&gt; IO ()
</span><a href="Network.TLS.Context.Internal.html#ctxKeyLogger"><span class="hs-identifier hs-var">ctxKeyLogger</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DebugParams -&gt; String -&gt; IO ()
</span><a href="Network.TLS.Parameters.html#debugKeyLogger"><span class="hs-identifier hs-var">debugKeyLogger</span></a></span><span> </span><span class="annot"><span class="annottext">DebugParams
</span><a href="#local-6989586621679196086"><span class="hs-identifier hs-var">debug</span></a></span><span>
</span><span id="line-193"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxRecordLayer :: RecordLayer FinishedData
</span><a href="Network.TLS.Context.Internal.html#ctxRecordLayer"><span class="hs-identifier hs-var">ctxRecordLayer</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RecordLayer FinishedData
</span><a href="#local-6989586621679196162"><span class="hs-identifier hs-var">recordLayer</span></a></span><span>
</span><span id="line-194"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxHandshakeSync :: HandshakeSync
</span><a href="Network.TLS.Context.Internal.html#ctxHandshakeSync"><span class="hs-identifier hs-var">ctxHandshakeSync</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Context -&gt; ClientState -&gt; IO ())
-&gt; (Context -&gt; ServerState -&gt; IO ()) -&gt; HandshakeSync
</span><a href="Network.TLS.Context.Internal.html#HandshakeSync"><span class="hs-identifier hs-var">HandshakeSync</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ClientState -&gt; IO ()
forall {m :: * -&gt; *} {p} {p}. Monad m =&gt; p -&gt; p -&gt; m ()
</span><a href="#local-6989586621679196165"><span class="hs-identifier hs-var">syncNoOp</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ServerState -&gt; IO ()
forall {m :: * -&gt; *} {p} {p}. Monad m =&gt; p -&gt; p -&gt; m ()
</span><a href="#local-6989586621679196165"><span class="hs-identifier hs-var">syncNoOp</span></a></span><span>
</span><span id="line-195"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxQUICMode :: Bool
</span><a href="Network.TLS.Context.Internal.html#ctxQUICMode"><span class="hs-identifier hs-var">ctxQUICMode</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-196"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxFinished :: IORef (Maybe FinishedData)
</span><a href="Network.TLS.Context.Internal.html#ctxFinished"><span class="hs-identifier hs-var">ctxFinished</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe FinishedData)
</span><a href="#local-6989586621679196120"><span class="hs-identifier hs-var">finished</span></a></span><span>
</span><span id="line-197"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxPeerFinished :: IORef (Maybe FinishedData)
</span><a href="Network.TLS.Context.Internal.html#ctxPeerFinished"><span class="hs-identifier hs-var">ctxPeerFinished</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe FinishedData)
</span><a href="#local-6989586621679196121"><span class="hs-identifier hs-var">peerFinished</span></a></span><span>
</span><span id="line-198"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span>        </span><span id="local-6989586621679196165"><span class="annot"><span class="annottext">syncNoOp :: p -&gt; p -&gt; m ()
</span><a href="#local-6989586621679196165"><span class="hs-identifier hs-var hs-var">syncNoOp</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span>        </span><span id="local-6989586621679196162"><span class="annot"><span class="annottext">recordLayer :: RecordLayer FinishedData
</span><a href="#local-6989586621679196162"><span class="hs-identifier hs-var hs-var">recordLayer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.TLS.Record.Layer.html#RecordLayer"><span class="hs-identifier hs-type">RecordLayer</span></a></span><span>
</span><span id="line-203"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">recordEncode :: Record Plaintext -&gt; IO (Either TLSError FinishedData)
</span><a href="Network.TLS.Record.Layer.html#recordEncode"><span class="hs-identifier hs-var">recordEncode</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; Record Plaintext -&gt; IO (Either TLSError FinishedData)
</span><a href="Network.TLS.Record.Writing.html#encodeRecord"><span class="hs-identifier hs-var">encodeRecord</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679196133"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-204"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recordEncode13 :: Record Plaintext -&gt; IO (Either TLSError FinishedData)
</span><a href="Network.TLS.Record.Layer.html#recordEncode13"><span class="hs-identifier hs-var">recordEncode13</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; Record Plaintext -&gt; IO (Either TLSError FinishedData)
</span><a href="Network.TLS.Record.Writing.html#encodeRecord13"><span class="hs-identifier hs-var">encodeRecord13</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679196133"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-205"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recordSendBytes :: FinishedData -&gt; IO ()
</span><a href="Network.TLS.Record.Layer.html#recordSendBytes"><span class="hs-identifier hs-var">recordSendBytes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; FinishedData -&gt; IO ()
</span><a href="Network.TLS.Record.Writing.html#sendBytes"><span class="hs-identifier hs-var">sendBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679196133"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-206"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recordRecv :: Bool -&gt; Int -&gt; IO (Either TLSError (Record Plaintext))
</span><a href="Network.TLS.Record.Layer.html#recordRecv"><span class="hs-identifier hs-var">recordRecv</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; Bool -&gt; Int -&gt; IO (Either TLSError (Record Plaintext))
</span><a href="Network.TLS.Record.Reading.html#recvRecord"><span class="hs-identifier hs-var">recvRecord</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679196133"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-207"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recordRecv13 :: IO (Either TLSError (Record Plaintext))
</span><a href="Network.TLS.Record.Layer.html#recordRecv13"><span class="hs-identifier hs-var">recordRecv13</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO (Either TLSError (Record Plaintext))
</span><a href="Network.TLS.Record.Reading.html#recvRecord13"><span class="hs-identifier hs-var">recvRecord13</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679196133"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-208"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; IO Context
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679196133"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="annot"><span class="hs-comment">-- | create a new context on an handle.</span></span><span>
</span><span id="line-213"></span><span id="local-6989586621679195939"><span id="local-6989586621679195940"><span class="annot"><a href="Network.TLS.Context.html#contextNewOnHandle"><span class="hs-identifier hs-type">contextNewOnHandle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679195939"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.html#TLSParams"><span class="hs-identifier hs-type">TLSParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679195940"><span class="hs-identifier hs-type">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>                   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Handle of the connection.</span></span><span>
</span><span id="line-215"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679195940"><span class="hs-identifier hs-type">params</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Parameters of the context.</span></span><span>
</span><span id="line-216"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679195939"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span></span></span><span>
</span><span id="line-217"></span><span id="contextNewOnHandle"><span class="annot"><span class="annottext">contextNewOnHandle :: forall (m :: * -&gt; *) params.
(MonadIO m, TLSParams params) =&gt;
Handle -&gt; params -&gt; m Context
</span><a href="Network.TLS.Context.html#contextNewOnHandle"><span class="hs-identifier hs-var hs-var">contextNewOnHandle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; params -&gt; m Context
forall (m :: * -&gt; *) backend params.
(MonadIO m, HasBackend backend, TLSParams params) =&gt;
backend -&gt; params -&gt; m Context
</span><a href="Network.TLS.Context.html#contextNew"><span class="hs-identifier hs-var">contextNew</span></a></span><span>
</span><span id="line-218"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">contextNewOnHandle</span><span> </span><span class="hs-pragma">&quot;use contextNew&quot;</span><span> </span><span class="hs-pragma">#-}</span><span class="hs-cpp">

#ifdef INCLUDE_NETWORK
</span><span class="annot"><span class="hs-comment">-- | create a new context on a socket.</span></span><span>
</span><span id="line-222"></span><span id="local-6989586621679195944"><span id="local-6989586621679195945"><span class="annot"><a href="Network.TLS.Context.html#contextNewOnSocket"><span class="hs-identifier hs-type">contextNewOnSocket</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679195944"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Context.html#TLSParams"><span class="hs-identifier hs-type">TLSParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679195945"><span class="hs-identifier hs-type">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>                   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Socket of the connection.</span></span><span>
</span><span id="line-224"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679195945"><span class="hs-identifier hs-type">params</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Parameters of the context.</span></span><span>
</span><span id="line-225"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679195944"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span></span></span><span>
</span><span id="line-226"></span><span id="contextNewOnSocket"><span class="annot"><span class="annottext">contextNewOnSocket :: forall (m :: * -&gt; *) params.
(MonadIO m, TLSParams params) =&gt;
Socket -&gt; params -&gt; m Context
</span><a href="Network.TLS.Context.html#contextNewOnSocket"><span class="hs-identifier hs-var hs-var">contextNewOnSocket</span></a></span></span><span> </span><span id="local-6989586621679196200"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679196200"><span class="hs-identifier hs-var">sock</span></a></span></span><span> </span><span id="local-6989586621679196201"><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679196201"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; params -&gt; m Context
forall (m :: * -&gt; *) backend params.
(MonadIO m, HasBackend backend, TLSParams params) =&gt;
backend -&gt; params -&gt; m Context
</span><a href="Network.TLS.Context.html#contextNew"><span class="hs-identifier hs-var">contextNew</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679196200"><span class="hs-identifier hs-var">sock</span></a></span><span> </span><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679196201"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-227"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">contextNewOnSocket</span><span> </span><span class="hs-pragma">&quot;use contextNew&quot;</span><span> </span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-230"></span><span class="annot"><a href="Network.TLS.Context.html#contextHookSetHandshakeRecv"><span class="hs-identifier hs-type">contextHookSetHandshakeRecv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Struct.html#Handshake"><span class="hs-identifier hs-type">Handshake</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.TLS.Struct.html#Handshake"><span class="hs-identifier hs-type">Handshake</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span id="contextHookSetHandshakeRecv"><span class="annot"><span class="annottext">contextHookSetHandshakeRecv :: Context -&gt; (Handshake -&gt; IO Handshake) -&gt; IO ()
</span><a href="Network.TLS.Context.html#contextHookSetHandshakeRecv"><span class="hs-identifier hs-var hs-var">contextHookSetHandshakeRecv</span></a></span></span><span> </span><span id="local-6989586621679196202"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679196202"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679196203"><span class="annot"><span class="annottext">Handshake -&gt; IO Handshake
</span><a href="#local-6989586621679196203"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-232"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; (Hooks -&gt; Hooks) -&gt; IO ()
</span><a href="Network.TLS.Context.Internal.html#contextModifyHooks"><span class="hs-identifier hs-var">contextModifyHooks</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679196202"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679196204"><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621679196204"><span class="hs-identifier hs-var">hooks</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621679196204"><span class="hs-identifier hs-var">hooks</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Network.TLS.Hooks.html#hookRecvHandshake"><span class="hs-identifier hs-var">hookRecvHandshake</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679196203"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="annot"><a href="Network.TLS.Context.html#contextHookSetHandshake13Recv"><span class="hs-identifier hs-type">contextHookSetHandshake13Recv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.Struct13.html#Handshake13"><span class="hs-identifier hs-type">Handshake13</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.TLS.Struct13.html#Handshake13"><span class="hs-identifier hs-type">Handshake13</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span id="contextHookSetHandshake13Recv"><span class="annot"><span class="annottext">contextHookSetHandshake13Recv :: Context -&gt; (Handshake13 -&gt; IO Handshake13) -&gt; IO ()
</span><a href="Network.TLS.Context.html#contextHookSetHandshake13Recv"><span class="hs-identifier hs-var hs-var">contextHookSetHandshake13Recv</span></a></span></span><span> </span><span id="local-6989586621679196206"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679196206"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679196207"><span class="annot"><span class="annottext">Handshake13 -&gt; IO Handshake13
</span><a href="#local-6989586621679196207"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; (Hooks -&gt; Hooks) -&gt; IO ()
</span><a href="Network.TLS.Context.Internal.html#contextModifyHooks"><span class="hs-identifier hs-var">contextModifyHooks</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679196206"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679196208"><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621679196208"><span class="hs-identifier hs-var">hooks</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621679196208"><span class="hs-identifier hs-var">hooks</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Network.TLS.Hooks.html#hookRecvHandshake13"><span class="hs-identifier hs-var">hookRecvHandshake13</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679196207"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span class="annot"><a href="Network.TLS.Context.html#contextHookSetCertificateRecv"><span class="hs-identifier hs-type">contextHookSetCertificateRecv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">CertificateChain</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span id="contextHookSetCertificateRecv"><span class="annot"><span class="annottext">contextHookSetCertificateRecv :: Context -&gt; (CertificateChain -&gt; IO ()) -&gt; IO ()
</span><a href="Network.TLS.Context.html#contextHookSetCertificateRecv"><span class="hs-identifier hs-var hs-var">contextHookSetCertificateRecv</span></a></span></span><span> </span><span id="local-6989586621679196210"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679196210"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679196211"><span class="annot"><span class="annottext">CertificateChain -&gt; IO ()
</span><a href="#local-6989586621679196211"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-240"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; (Hooks -&gt; Hooks) -&gt; IO ()
</span><a href="Network.TLS.Context.Internal.html#contextModifyHooks"><span class="hs-identifier hs-var">contextModifyHooks</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679196210"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679196212"><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621679196212"><span class="hs-identifier hs-var">hooks</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621679196212"><span class="hs-identifier hs-var">hooks</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Network.TLS.Hooks.html#hookRecvCertificates"><span class="hs-identifier hs-var">hookRecvCertificates</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679196211"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="annot"><a href="Network.TLS.Context.html#contextHookSetLogging"><span class="hs-identifier hs-type">contextHookSetLogging</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.TLS.Hooks.html#Logging"><span class="hs-identifier hs-type">Logging</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span id="contextHookSetLogging"><span class="annot"><span class="annottext">contextHookSetLogging :: Context -&gt; Logging -&gt; IO ()
</span><a href="Network.TLS.Context.html#contextHookSetLogging"><span class="hs-identifier hs-var hs-var">contextHookSetLogging</span></a></span></span><span> </span><span id="local-6989586621679196214"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679196214"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679196215"><span class="annot"><span class="annottext">Logging
</span><a href="#local-6989586621679196215"><span class="hs-identifier hs-var">loggingCallbacks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-244"></span><span>    </span><span class="annot"><span class="annottext">Context -&gt; (Hooks -&gt; Hooks) -&gt; IO ()
</span><a href="Network.TLS.Context.Internal.html#contextModifyHooks"><span class="hs-identifier hs-var">contextModifyHooks</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679196214"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679196216"><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621679196216"><span class="hs-identifier hs-var">hooks</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621679196216"><span class="hs-identifier hs-var">hooks</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Network.TLS.Hooks.html#hookLogging"><span class="hs-identifier hs-var">hookLogging</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679196215"><span class="hs-identifier hs-type">loggingCallbacks</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span class="annot"><span class="hs-comment">-- | Get TLS Finished sent to peer</span></span><span>
</span><span id="line-247"></span><span class="annot"><a href="Network.TLS.Context.html#getFinished"><span class="hs-identifier hs-type">getFinished</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.TLS.Struct.html#FinishedData"><span class="hs-identifier hs-type">FinishedData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span id="getFinished"><span class="annot"><span class="annottext">getFinished :: Context -&gt; IO (Maybe FinishedData)
</span><a href="Network.TLS.Context.html#getFinished"><span class="hs-identifier hs-var hs-var">getFinished</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe FinishedData) -&gt; IO (Maybe FinishedData)
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">(IORef (Maybe FinishedData) -&gt; IO (Maybe FinishedData))
-&gt; (Context -&gt; IORef (Maybe FinishedData))
-&gt; Context
-&gt; IO (Maybe FinishedData)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; IORef (Maybe FinishedData)
</span><a href="Network.TLS.Context.Internal.html#ctxFinished"><span class="hs-identifier hs-var">ctxFinished</span></a></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="annot"><span class="hs-comment">-- | Get TLS Finished received from peer</span></span><span>
</span><span id="line-251"></span><span class="annot"><a href="Network.TLS.Context.html#getPeerFinished"><span class="hs-identifier hs-type">getPeerFinished</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.TLS.Struct.html#FinishedData"><span class="hs-identifier hs-type">FinishedData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span id="getPeerFinished"><span class="annot"><span class="annottext">getPeerFinished :: Context -&gt; IO (Maybe FinishedData)
</span><a href="Network.TLS.Context.html#getPeerFinished"><span class="hs-identifier hs-var hs-var">getPeerFinished</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe FinishedData) -&gt; IO (Maybe FinishedData)
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">(IORef (Maybe FinishedData) -&gt; IO (Maybe FinishedData))
-&gt; (Context -&gt; IORef (Maybe FinishedData))
-&gt; Context
-&gt; IO (Maybe FinishedData)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; IORef (Maybe FinishedData)
</span><a href="Network.TLS.Context.Internal.html#ctxPeerFinished"><span class="hs-identifier hs-var">ctxPeerFinished</span></a></span><span>
</span><span id="line-253"></span></pre></body></html>