<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- |</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- Module      : Network.TLS.Handshake.Certificate</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- License     : BSD-style</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Stability   : experimental</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Portability : unknown</span><span>
</span><span id="line-7"></span><span class="hs-comment">--</span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.TLS.Handshake.Certificate</span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Certificate.html#certificateRejected"><span class="hs-identifier">certificateRejected</span></a></span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Certificate.html#badCertificate"><span class="hs-identifier">badCertificate</span></a></span><span>
</span><span id="line-11"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Certificate.html#rejectOnException"><span class="hs-identifier">rejectOnException</span></a></span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Certificate.html#verifyLeafKeyUsage"><span class="hs-identifier">verifyLeafKeyUsage</span></a></span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.TLS.Handshake.Certificate.html#extractCAname"><span class="hs-identifier">extractCAname</span></a></span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Context.Internal.html"><span class="hs-identifier">Network.TLS.Context.Internal</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.Struct.html"><span class="hs-identifier">Network.TLS.Struct</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.TLS.X509.html"><span class="hs-identifier">Network.TLS.X509</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unless</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State.Strict</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SomeException</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.X509</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ExtKeyUsage</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ExtKeyUsageFlag</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">extensionGet</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-comment">-- on certificate reject, throw an exception with the proper protocol alert error.</span><span>
</span><span id="line-25"></span><span id="local-6989586621679190341"><span id="local-6989586621679190344"><span class="annot"><a href="Network.TLS.Handshake.Certificate.html#certificateRejected"><span class="hs-identifier hs-type">certificateRejected</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679190341"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.TLS.X509.html#CertificateRejectReason"><span class="hs-identifier hs-type">CertificateRejectReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679190341"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190344"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-26"></span><span id="certificateRejected"><span class="annot"><span class="annottext">certificateRejected :: forall (m :: * -&gt; *) a. MonadIO m =&gt; CertificateRejectReason -&gt; m a
</span><a href="Network.TLS.Handshake.Certificate.html#certificateRejected"><span class="hs-identifier hs-var hs-var">certificateRejected</span></a></span></span><span> </span><span class="annot"><span class="annottext">CertificateRejectReason
</span><a href="Network.TLS.X509.html#CertificateRejectRevoked"><span class="hs-identifier hs-var">CertificateRejectRevoked</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><span class="annottext">TLSError -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">(TLSError -&gt; m a) -&gt; TLSError -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool, AlertDescription) -&gt; TLSError
</span><a href="Network.TLS.Struct.html#Error_Protocol"><span class="hs-identifier hs-var">Error_Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;certificate is revoked&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#CertificateRevoked"><span class="hs-identifier hs-var">CertificateRevoked</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="annot"><a href="Network.TLS.Handshake.Certificate.html#certificateRejected"><span class="hs-identifier hs-var">certificateRejected</span></a></span><span> </span><span class="annot"><span class="annottext">CertificateRejectReason
</span><a href="Network.TLS.X509.html#CertificateRejectExpired"><span class="hs-identifier hs-var">CertificateRejectExpired</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><span class="annottext">TLSError -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">(TLSError -&gt; m a) -&gt; TLSError -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool, AlertDescription) -&gt; TLSError
</span><a href="Network.TLS.Struct.html#Error_Protocol"><span class="hs-identifier hs-var">Error_Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;certificate has expired&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#CertificateExpired"><span class="hs-identifier hs-var">CertificateExpired</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="annot"><a href="Network.TLS.Handshake.Certificate.html#certificateRejected"><span class="hs-identifier hs-var">certificateRejected</span></a></span><span> </span><span class="annot"><span class="annottext">CertificateRejectReason
</span><a href="Network.TLS.X509.html#CertificateRejectUnknownCA"><span class="hs-identifier hs-var">CertificateRejectUnknownCA</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><span class="annottext">TLSError -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">(TLSError -&gt; m a) -&gt; TLSError -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool, AlertDescription) -&gt; TLSError
</span><a href="Network.TLS.Struct.html#Error_Protocol"><span class="hs-identifier hs-var">Error_Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;certificate has unknown CA&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#UnknownCa"><span class="hs-identifier hs-var">UnknownCa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="annot"><a href="Network.TLS.Handshake.Certificate.html#certificateRejected"><span class="hs-identifier hs-var">certificateRejected</span></a></span><span> </span><span class="annot"><span class="annottext">CertificateRejectReason
</span><a href="Network.TLS.X509.html#CertificateRejectAbsent"><span class="hs-identifier hs-var">CertificateRejectAbsent</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><span class="annottext">TLSError -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">(TLSError -&gt; m a) -&gt; TLSError -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool, AlertDescription) -&gt; TLSError
</span><a href="Network.TLS.Struct.html#Error_Protocol"><span class="hs-identifier hs-var">Error_Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;certificate is missing&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#CertificateRequired"><span class="hs-identifier hs-var">CertificateRequired</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="annot"><a href="Network.TLS.Handshake.Certificate.html#certificateRejected"><span class="hs-identifier hs-var">certificateRejected</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.TLS.X509.html#CertificateRejectOther"><span class="hs-identifier hs-type">CertificateRejectOther</span></a></span><span> </span><span id="local-6989586621679190409"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679190409"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><span class="annottext">TLSError -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">(TLSError -&gt; m a) -&gt; TLSError -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool, AlertDescription) -&gt; TLSError
</span><a href="Network.TLS.Struct.html#Error_Protocol"><span class="hs-identifier hs-var">Error_Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;certificate rejected: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679190409"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#CertificateUnknown"><span class="hs-identifier hs-var">CertificateUnknown</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span id="local-6989586621679190355"><span id="local-6989586621679190356"><span class="annot"><a href="Network.TLS.Handshake.Certificate.html#badCertificate"><span class="hs-identifier hs-type">badCertificate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679190355"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679190355"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679190356"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-38"></span><span id="badCertificate"><span class="annot"><span class="annottext">badCertificate :: forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; m a
</span><a href="Network.TLS.Handshake.Certificate.html#badCertificate"><span class="hs-identifier hs-var hs-var">badCertificate</span></a></span></span><span> </span><span id="local-6989586621679190413"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679190413"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLSError -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; TLSError -&gt; m a
</span><a href="Network.TLS.Context.Internal.html#throwCore"><span class="hs-identifier hs-var">throwCore</span></a></span><span> </span><span class="annot"><span class="annottext">(TLSError -&gt; m a) -&gt; TLSError -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool, AlertDescription) -&gt; TLSError
</span><a href="Network.TLS.Struct.html#Error_Protocol"><span class="hs-identifier hs-var">Error_Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679190413"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AlertDescription
</span><a href="Network.TLS.Struct.html#BadCertificate"><span class="hs-identifier hs-var">BadCertificate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="annot"><a href="Network.TLS.Handshake.Certificate.html#rejectOnException"><span class="hs-identifier hs-type">rejectOnException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.TLS.X509.html#CertificateUsage"><span class="hs-identifier hs-type">CertificateUsage</span></a></span><span>
</span><span id="line-41"></span><span id="rejectOnException"><span class="annot"><span class="annottext">rejectOnException :: SomeException -&gt; IO CertificateUsage
</span><a href="Network.TLS.Handshake.Certificate.html#rejectOnException"><span class="hs-identifier hs-var hs-var">rejectOnException</span></a></span></span><span> </span><span id="local-6989586621679190415"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679190415"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CertificateUsage -&gt; IO CertificateUsage
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(CertificateUsage -&gt; IO CertificateUsage)
-&gt; CertificateUsage -&gt; IO CertificateUsage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CertificateRejectReason -&gt; CertificateUsage
</span><a href="Network.TLS.X509.html#CertificateUsageReject"><span class="hs-identifier hs-var">CertificateUsageReject</span></a></span><span> </span><span class="annot"><span class="annottext">(CertificateRejectReason -&gt; CertificateUsage)
-&gt; CertificateRejectReason -&gt; CertificateUsage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; CertificateRejectReason
</span><a href="Network.TLS.X509.html#CertificateRejectOther"><span class="hs-identifier hs-var">CertificateRejectOther</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; CertificateRejectReason)
-&gt; String -&gt; CertificateRejectReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679190415"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span id="local-6989586621679190363"><span class="annot"><a href="Network.TLS.Handshake.Certificate.html#verifyLeafKeyUsage"><span class="hs-identifier hs-type">verifyLeafKeyUsage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679190363"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">ExtKeyUsageFlag</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CertificateChain</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679190363"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-44"></span><span id="verifyLeafKeyUsage"><span class="annot"><span class="annottext">verifyLeafKeyUsage :: forall (m :: * -&gt; *).
MonadIO m =&gt;
[ExtKeyUsageFlag] -&gt; CertificateChain -&gt; m ()
</span><a href="Network.TLS.Handshake.Certificate.html#verifyLeafKeyUsage"><span class="hs-identifier hs-var hs-var">verifyLeafKeyUsage</span></a></span></span><span> </span><span class="annot"><span class="annottext">[ExtKeyUsageFlag]
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">CertificateChain</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="annot"><a href="Network.TLS.Handshake.Certificate.html#verifyLeafKeyUsage"><span class="hs-identifier hs-var">verifyLeafKeyUsage</span></a></span><span> </span><span id="local-6989586621679190431"><span class="annot"><span class="annottext">[ExtKeyUsageFlag]
</span><a href="#local-6989586621679190431"><span class="hs-identifier hs-var">validFlags</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">CertificateChain</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679190432"><span class="annot"><span class="annottext">SignedExact Certificate
</span><a href="#local-6989586621679190432"><span class="hs-identifier hs-var">signed</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[SignedExact Certificate]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679190433"><span class="hs-identifier hs-var">verified</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; m a
</span><a href="Network.TLS.Handshake.Certificate.html#badCertificate"><span class="hs-identifier hs-var">badCertificate</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; m ()) -&gt; String -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-47"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;certificate is not allowed for any of &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ExtKeyUsageFlag] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[ExtKeyUsageFlag]
</span><a href="#local-6989586621679190431"><span class="hs-identifier hs-var">validFlags</span></a></span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-49"></span><span>    </span><span id="local-6989586621679190434"><span class="annot"><span class="annottext">cert :: Certificate
</span><a href="#local-6989586621679190434"><span class="hs-identifier hs-var hs-var">cert</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SignedExact Certificate -&gt; Certificate
</span><span class="hs-identifier hs-var">getCertificate</span></span><span> </span><span class="annot"><span class="annottext">SignedExact Certificate
</span><a href="#local-6989586621679190432"><span class="hs-identifier hs-var">signed</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span id="local-6989586621679190433"><span class="annot"><span class="annottext">verified :: Bool
</span><a href="#local-6989586621679190433"><span class="hs-identifier hs-var hs-var">verified</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-51"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Extensions -&gt; Maybe ExtKeyUsage
forall a. Extension a =&gt; Extensions -&gt; Maybe a
</span><span class="hs-identifier hs-var">extensionGet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Certificate -&gt; Extensions
</span><span class="hs-identifier hs-var">certExtensions</span></span><span> </span><span class="annot"><span class="annottext">Certificate
</span><a href="#local-6989586621679190434"><span class="hs-identifier hs-var">cert</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-52"></span><span>            </span><span class="annot"><span class="annottext">Maybe ExtKeyUsage
</span><span class="hs-identifier hs-var">Nothing</span></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-comment">-- unrestricted cert</span><span>
</span><span id="line-53"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ExtKeyUsage</span></span><span> </span><span id="local-6989586621679190445"><span class="annot"><span class="annottext">[ExtKeyUsageFlag]
</span><a href="#local-6989586621679190445"><span class="hs-identifier hs-var">flags</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ExtKeyUsageFlag -&gt; Bool) -&gt; [ExtKeyUsageFlag] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExtKeyUsageFlag -&gt; [ExtKeyUsageFlag] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[ExtKeyUsageFlag]
</span><a href="#local-6989586621679190431"><span class="hs-identifier hs-var">validFlags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ExtKeyUsageFlag]
</span><a href="#local-6989586621679190445"><span class="hs-identifier hs-var">flags</span></a></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="annot"><a href="Network.TLS.Handshake.Certificate.html#extractCAname"><span class="hs-identifier hs-type">extractCAname</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SignedCertificate</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DistinguishedName</span></span><span>
</span><span id="line-56"></span><span id="extractCAname"><span class="annot"><span class="annottext">extractCAname :: SignedExact Certificate -&gt; DistinguishedName
</span><a href="Network.TLS.Handshake.Certificate.html#extractCAname"><span class="hs-identifier hs-var hs-var">extractCAname</span></a></span></span><span> </span><span id="local-6989586621679190449"><span class="annot"><span class="annottext">SignedExact Certificate
</span><a href="#local-6989586621679190449"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Certificate -&gt; DistinguishedName
</span><span class="hs-identifier hs-var">certSubjectDN</span></span><span> </span><span class="annot"><span class="annottext">(Certificate -&gt; DistinguishedName)
-&gt; Certificate -&gt; DistinguishedName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SignedExact Certificate -&gt; Certificate
</span><span class="hs-identifier hs-var">getCertificate</span></span><span> </span><span class="annot"><span class="annottext">SignedExact Certificate
</span><a href="#local-6989586621679190449"><span class="hs-identifier hs-var">cert</span></a></span><span>
</span><span id="line-57"></span></pre></body></html>