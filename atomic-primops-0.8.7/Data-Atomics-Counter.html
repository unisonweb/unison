<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Data.Atomics.Counter</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">atomic-primops-0.8.7: A safe approach to CAS and other atomic ops in Haskell.</span><ul class="links" id="page-menu"><li><a href="src/Data.Atomics.Counter.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Data.Atomics.Counter</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Type of counters of counters and tickets</a></li><li><a href="#g:2">Creating counters</a></li><li><a href="#g:3">Tickets, used for compare-and-swap         </a></li><li><a href="#g:4">Atomic memory operations</a></li><li><a href="#g:5">Non-atomic operations</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Integer counters providing thread-safe, lock-free mutation functions.</p><p>Atomic counters are represented by a single memory location, such that
   built-in processor instructions are sufficient to perform fetch-and-add or
   compare-and-swap.</p><p>Remember, contention on such counters should still be minimized!</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:AtomicCounter">AtomicCounter</a></li><li class="src short"><a href="#v:newCounter">newCounter</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Data-Atomics-Counter.html#t:AtomicCounter" title="Data.Atomics.Counter">AtomicCounter</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:CTicket">CTicket</a> = <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li class="src short"><a href="#v:peekCTicket">peekCTicket</a> :: <a href="Data-Atomics-Counter.html#t:CTicket" title="Data.Atomics.Counter">CTicket</a> -&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li class="src short"><a href="#v:casCounter">casCounter</a> :: <a href="Data-Atomics-Counter.html#t:AtomicCounter" title="Data.Atomics.Counter">AtomicCounter</a> -&gt; <a href="Data-Atomics-Counter.html#t:CTicket" title="Data.Atomics.Counter">CTicket</a> -&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>, <a href="Data-Atomics-Counter.html#t:CTicket" title="Data.Atomics.Counter">CTicket</a>)</li><li class="src short"><a href="#v:incrCounter">incrCounter</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Data-Atomics-Counter.html#t:AtomicCounter" title="Data.Atomics.Counter">AtomicCounter</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li class="src short"><a href="#v:incrCounter_">incrCounter_</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Data-Atomics-Counter.html#t:AtomicCounter" title="Data.Atomics.Counter">AtomicCounter</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:readCounter">readCounter</a> :: <a href="Data-Atomics-Counter.html#t:AtomicCounter" title="Data.Atomics.Counter">AtomicCounter</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li class="src short"><a href="#v:readCounterForCAS">readCounterForCAS</a> :: <a href="Data-Atomics-Counter.html#t:AtomicCounter" title="Data.Atomics.Counter">AtomicCounter</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Data-Atomics-Counter.html#t:CTicket" title="Data.Atomics.Counter">CTicket</a></li><li class="src short"><a href="#v:writeCounter">writeCounter</a> :: <a href="Data-Atomics-Counter.html#t:AtomicCounter" title="Data.Atomics.Counter">AtomicCounter</a> -&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> ()</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Type of counters of counters and tickets</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:AtomicCounter" class="def">AtomicCounter</a> <a href="src/Data.Atomics.Counter.html#AtomicCounter" class="link">Source</a> <a href="#t:AtomicCounter" class="selflink">#</a></p><div class="doc"><p>The type of mutable atomic counters.</p></div></div><a href="#g:2" id="g:2"><h1>Creating counters</h1></a><div class="top"><p class="src"><a id="v:newCounter" class="def">newCounter</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Data-Atomics-Counter.html#t:AtomicCounter" title="Data.Atomics.Counter">AtomicCounter</a> <a href="src/Data.Atomics.Counter.html#newCounter" class="link">Source</a> <a href="#v:newCounter" class="selflink">#</a></p><div class="doc"><p>Create a new counter initialized to the given value.</p></div></div><a href="#g:3" id="g:3"><h1>Tickets, used for compare-and-swap         </h1></a><div class="doc"><p>See the documentation for <a href="Data-Atomics.html">Data.Atomics</a> for more explanation of the
 ticket abstraction.  The same ideas apply here for counters as for
 general mutable locations (IORefs).</p></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:CTicket" class="def">CTicket</a> = <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="src/Data.Atomics.Counter.html#CTicket" class="link">Source</a> <a href="#t:CTicket" class="selflink">#</a></p><div class="doc"><p>You should not depend on this type.  It varies between different implementations
 of atomic counters.</p></div></div><div class="top"><p class="src"><a id="v:peekCTicket" class="def">peekCTicket</a> :: <a href="Data-Atomics-Counter.html#t:CTicket" title="Data.Atomics.Counter">CTicket</a> -&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="src/Data.Atomics.Counter.html#peekCTicket" class="link">Source</a> <a href="#v:peekCTicket" class="selflink">#</a></p><div class="doc"><p>Opaque tickets cannot be constructed, but they can be destructed into values.</p></div></div><a href="#g:4" id="g:4"><h1>Atomic memory operations</h1></a><div class="top"><p class="src"><a id="v:casCounter" class="def">casCounter</a> :: <a href="Data-Atomics-Counter.html#t:AtomicCounter" title="Data.Atomics.Counter">AtomicCounter</a> -&gt; <a href="Data-Atomics-Counter.html#t:CTicket" title="Data.Atomics.Counter">CTicket</a> -&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>, <a href="Data-Atomics-Counter.html#t:CTicket" title="Data.Atomics.Counter">CTicket</a>) <a href="src/Data.Atomics.Counter.html#casCounter" class="link">Source</a> <a href="#v:casCounter" class="selflink">#</a></p><div class="doc"><p>Compare and swap for the counter ADT.  Similar behavior to
 <code><a href="Data-Atomics.html#v:casIORef" title="Data.Atomics">casIORef</a></code>, in particular, in both success and failure cases it
 returns a ticket that you should use for the next attempt.  (That is, in the
 success case, it actually returns the new value that you provided as input, but in
 ticket form.)</p></div></div><div class="top"><p class="src"><a id="v:incrCounter" class="def">incrCounter</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Data-Atomics-Counter.html#t:AtomicCounter" title="Data.Atomics.Counter">AtomicCounter</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="src/Data.Atomics.Counter.html#incrCounter" class="link">Source</a> <a href="#v:incrCounter" class="selflink">#</a></p><div class="doc"><p>Increment the counter by a given amount.  Returns the value AFTER the increment
   (in contrast with the behavior of the underlying instruction on architectures
   like x86.)</p><p>Note that UNLIKE with boxed implementations of counters, where increment is
   based on CAS, this increment is <em>O(1)</em>.  Fetch-and-add does not require a retry
   loop like CAS.</p></div></div><div class="top"><p class="src"><a id="v:incrCounter_" class="def">incrCounter_</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Data-Atomics-Counter.html#t:AtomicCounter" title="Data.Atomics.Counter">AtomicCounter</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Data.Atomics.Counter.html#incrCounter_" class="link">Source</a> <a href="#v:incrCounter_" class="selflink">#</a></p><div class="doc"><p>An alternate version for when you don't care about the old value.</p></div></div><a href="#g:5" id="g:5"><h1>Non-atomic operations</h1></a><div class="top"><p class="src"><a id="v:readCounter" class="def">readCounter</a> :: <a href="Data-Atomics-Counter.html#t:AtomicCounter" title="Data.Atomics.Counter">AtomicCounter</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="src/Data.Atomics.Counter.html#readCounter" class="link">Source</a> <a href="#v:readCounter" class="selflink">#</a></p><div class="doc"><p>Equivalent to <code><a href="Data-Atomics-Counter.html#v:readCounterForCAS" title="Data.Atomics.Counter">readCounterForCAS</a></code> followed by <code><a href="Data-Atomics-Counter.html#v:peekCTicket" title="Data.Atomics.Counter">peekCTicket</a></code>.        </p></div></div><div class="top"><p class="src"><a id="v:readCounterForCAS" class="def">readCounterForCAS</a> :: <a href="Data-Atomics-Counter.html#t:AtomicCounter" title="Data.Atomics.Counter">AtomicCounter</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Data-Atomics-Counter.html#t:CTicket" title="Data.Atomics.Counter">CTicket</a> <a href="src/Data.Atomics.Counter.html#readCounterForCAS" class="link">Source</a> <a href="#v:readCounterForCAS" class="selflink">#</a></p><div class="doc"><p>Just like the <a href="Data-Atomics.html">Data.Atomics</a> CAS interface, this routine returns an opaque
 ticket that can be used in CAS operations.  Except for the difference in return
 type, the semantics of this are the same as <code><a href="Data-Atomics-Counter.html#v:readCounter" title="Data.Atomics.Counter">readCounter</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:writeCounter" class="def">writeCounter</a> :: <a href="Data-Atomics-Counter.html#t:AtomicCounter" title="Data.Atomics.Counter">AtomicCounter</a> -&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Data.Atomics.Counter.html#writeCounter" class="link">Source</a> <a href="#v:writeCounter" class="selflink">#</a></p><div class="doc"><p>Make a non-atomic write to the counter.  No memory-barrier.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>