<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Data.Atomics.Internal</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">atomic-primops-0.8.7: A safe approach to CAS and other atomic ops in Haskell.</span><ul class="links" id="page-menu"><li><a href="src/Data.Atomics.Internal.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Data.Atomics.Internal</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Very unsafe, not to be used</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module provides only the raw primops (and necessary types) for atomic
 operations.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:casIntArray-35-">casIntArray#</a> :: <a href="../base-4.18.2.1/GHC-Exts.html#t:MutableByteArray-35-" title="GHC.Exts">MutableByteArray#</a> d -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:Int-35-" title="GHC.Exts">Int#</a> -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:Int-35-" title="GHC.Exts">Int#</a> -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:Int-35-" title="GHC.Exts">Int#</a> -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:State-35-" title="GHC.Exts">State#</a> d -&gt; (# <a href="../base-4.18.2.1/GHC-Exts.html#t:State-35-" title="GHC.Exts">State#</a> d, <a href="../base-4.18.2.1/GHC-Exts.html#t:Int-35-" title="GHC.Exts">Int#</a> #)</li><li class="src short"><a href="#v:fetchAddIntArray-35-">fetchAddIntArray#</a> :: <a href="../base-4.18.2.1/GHC-Exts.html#t:MutableByteArray-35-" title="GHC.Exts">MutableByteArray#</a> d -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:Int-35-" title="GHC.Exts">Int#</a> -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:Int-35-" title="GHC.Exts">Int#</a> -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:State-35-" title="GHC.Exts">State#</a> d -&gt; (# <a href="../base-4.18.2.1/GHC-Exts.html#t:State-35-" title="GHC.Exts">State#</a> d, <a href="../base-4.18.2.1/GHC-Exts.html#t:Int-35-" title="GHC.Exts">Int#</a> #)</li><li class="src short"><a href="#v:readForCAS-35-">readForCAS#</a> :: <a href="../base-4.18.2.1/GHC-Exts.html#t:MutVar-35-" title="GHC.Exts">MutVar#</a> <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:RealWorld" title="Control.Monad.ST.Safe">RealWorld</a> a -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:State-35-" title="GHC.Exts">State#</a> <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:RealWorld" title="Control.Monad.ST.Safe">RealWorld</a> -&gt; (# <a href="../base-4.18.2.1/GHC-Exts.html#t:State-35-" title="GHC.Exts">State#</a> <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:RealWorld" title="Control.Monad.ST.Safe">RealWorld</a>, <a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a #)</li><li class="src short"><a href="#v:casMutVarTicketed-35-">casMutVarTicketed#</a> :: <a href="../base-4.18.2.1/GHC-Exts.html#t:MutVar-35-" title="GHC.Exts">MutVar#</a> <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:RealWorld" title="Control.Monad.ST.Safe">RealWorld</a> a -&gt; <a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a -&gt; <a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:State-35-" title="GHC.Exts">State#</a> <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:RealWorld" title="Control.Monad.ST.Safe">RealWorld</a> -&gt; (# <a href="../base-4.18.2.1/GHC-Exts.html#t:State-35-" title="GHC.Exts">State#</a> <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:RealWorld" title="Control.Monad.ST.Safe">RealWorld</a>, <a href="../base-4.18.2.1/GHC-Exts.html#t:Int-35-" title="GHC.Exts">Int#</a>, <a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a #)</li><li class="src short"><a href="#v:casArrayTicketed-35-">casArrayTicketed#</a> :: <a href="../base-4.18.2.1/GHC-Exts.html#t:MutableArray-35-" title="GHC.Exts">MutableArray#</a> <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:RealWorld" title="Control.Monad.ST.Safe">RealWorld</a> a -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:Int-35-" title="GHC.Exts">Int#</a> -&gt; <a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a -&gt; <a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:State-35-" title="GHC.Exts">State#</a> <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:RealWorld" title="Control.Monad.ST.Safe">RealWorld</a> -&gt; (# <a href="../base-4.18.2.1/GHC-Exts.html#t:State-35-" title="GHC.Exts">State#</a> <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:RealWorld" title="Control.Monad.ST.Safe">RealWorld</a>, <a href="../base-4.18.2.1/GHC-Exts.html#t:Int-35-" title="GHC.Exts">Int#</a>, <a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a #)</li><li class="src short"><span class="keyword">data</span> <a href="#t:Ticket">Ticket</a> a</li><li class="src short"><a href="#v:ptrEq">ptrEq</a> :: a -&gt; a -&gt; <a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:casIntArray-35-" class="def">casIntArray#</a> :: <a href="../base-4.18.2.1/GHC-Exts.html#t:MutableByteArray-35-" title="GHC.Exts">MutableByteArray#</a> d -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:Int-35-" title="GHC.Exts">Int#</a> -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:Int-35-" title="GHC.Exts">Int#</a> -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:Int-35-" title="GHC.Exts">Int#</a> -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:State-35-" title="GHC.Exts">State#</a> d -&gt; (# <a href="../base-4.18.2.1/GHC-Exts.html#t:State-35-" title="GHC.Exts">State#</a> d, <a href="../base-4.18.2.1/GHC-Exts.html#t:Int-35-" title="GHC.Exts">Int#</a> #) <a href="#v:casIntArray-35-" class="selflink">#</a></p><div class="doc"><p>Given an array, an offset in machine words, the expected old value, and
    the new value, perform an atomic compare and swap i.e. write the new
    value if the current value matches the provided old value. Returns
    the value of the element before the operation. Implies a full memory
    barrier.</p><p><strong><em>Warning:</em></strong> this can fail with an unchecked exception.</p></div></div><div class="top"><p class="src"><a id="v:fetchAddIntArray-35-" class="def">fetchAddIntArray#</a> :: <a href="../base-4.18.2.1/GHC-Exts.html#t:MutableByteArray-35-" title="GHC.Exts">MutableByteArray#</a> d -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:Int-35-" title="GHC.Exts">Int#</a> -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:Int-35-" title="GHC.Exts">Int#</a> -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:State-35-" title="GHC.Exts">State#</a> d -&gt; (# <a href="../base-4.18.2.1/GHC-Exts.html#t:State-35-" title="GHC.Exts">State#</a> d, <a href="../base-4.18.2.1/GHC-Exts.html#t:Int-35-" title="GHC.Exts">Int#</a> #) <a href="#v:fetchAddIntArray-35-" class="selflink">#</a></p><div class="doc"><p>Given an array, and offset in machine words, and a value to add,
    atomically add the value to the element. Returns the value of the
    element before the operation. Implies a full memory barrier.</p><p><strong><em>Warning:</em></strong> this can fail with an unchecked exception.</p></div></div><div class="top"><p class="src"><a id="v:readForCAS-35-" class="def">readForCAS#</a> :: <a href="../base-4.18.2.1/GHC-Exts.html#t:MutVar-35-" title="GHC.Exts">MutVar#</a> <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:RealWorld" title="Control.Monad.ST.Safe">RealWorld</a> a -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:State-35-" title="GHC.Exts">State#</a> <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:RealWorld" title="Control.Monad.ST.Safe">RealWorld</a> -&gt; (# <a href="../base-4.18.2.1/GHC-Exts.html#t:State-35-" title="GHC.Exts">State#</a> <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:RealWorld" title="Control.Monad.ST.Safe">RealWorld</a>, <a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a #) <a href="src/Data.Atomics.Internal.html#readForCAS%23" class="link">Source</a> <a href="#v:readForCAS-35-" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:casMutVarTicketed-35-" class="def">casMutVarTicketed#</a> :: <a href="../base-4.18.2.1/GHC-Exts.html#t:MutVar-35-" title="GHC.Exts">MutVar#</a> <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:RealWorld" title="Control.Monad.ST.Safe">RealWorld</a> a -&gt; <a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a -&gt; <a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:State-35-" title="GHC.Exts">State#</a> <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:RealWorld" title="Control.Monad.ST.Safe">RealWorld</a> -&gt; (# <a href="../base-4.18.2.1/GHC-Exts.html#t:State-35-" title="GHC.Exts">State#</a> <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:RealWorld" title="Control.Monad.ST.Safe">RealWorld</a>, <a href="../base-4.18.2.1/GHC-Exts.html#t:Int-35-" title="GHC.Exts">Int#</a>, <a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a #) <a href="src/Data.Atomics.Internal.html#casMutVarTicketed%23" class="link">Source</a> <a href="#v:casMutVarTicketed-35-" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:casArrayTicketed-35-" class="def">casArrayTicketed#</a> :: <a href="../base-4.18.2.1/GHC-Exts.html#t:MutableArray-35-" title="GHC.Exts">MutableArray#</a> <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:RealWorld" title="Control.Monad.ST.Safe">RealWorld</a> a -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:Int-35-" title="GHC.Exts">Int#</a> -&gt; <a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a -&gt; <a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a -&gt; <a href="../base-4.18.2.1/GHC-Exts.html#t:State-35-" title="GHC.Exts">State#</a> <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:RealWorld" title="Control.Monad.ST.Safe">RealWorld</a> -&gt; (# <a href="../base-4.18.2.1/GHC-Exts.html#t:State-35-" title="GHC.Exts">State#</a> <a href="../base-4.18.2.1/Control-Monad-ST-Safe.html#t:RealWorld" title="Control.Monad.ST.Safe">RealWorld</a>, <a href="../base-4.18.2.1/GHC-Exts.html#t:Int-35-" title="GHC.Exts">Int#</a>, <a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a #) <a href="src/Data.Atomics.Internal.html#casArrayTicketed%23" class="link">Source</a> <a href="#v:casArrayTicketed-35-" class="selflink">#</a></p><div class="doc"><p>Unsafe, machine-level atomic compare and swap on an element within an Array.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Ticket" class="def">Ticket</a> a <a href="src/Data.Atomics.Internal.html#Ticket" class="link">Source</a> <a href="#t:Ticket" class="selflink">#</a></p><div class="doc"><p>When performing compare-and-swaps, the <em>ticket</em> encapsulates proof
 that a thread observed a specific previous value of a mutable
 variable.  It is provided in lieu of the &quot;old&quot; value to
 compare-and-swap.</p><p>Design note: <code><a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a></code>s exist to hide objects from the GHC compiler, which
 can normally perform many optimizations that change pointer equality.  A Ticket,
 on the other hand, is a first-class object that can be handled by the user,
 but will not have its pointer identity changed by compiler optimizations
 (but will of course, change addresses during garbage collection).</p></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:Ticket">Instances</h4><details id="i:Ticket" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Ticket:Show:1"></span> <a href="../base-4.18.2.1/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a)</span> <a href="src/Data.Atomics.Internal.html#line-56" class="link">Source</a> <a href="#t:Ticket" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Ticket:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Data-Atomics-Internal.html">Data.Atomics.Internal</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a -&gt; <a href="../base-4.18.2.1/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a -&gt; <a href="../base-4.18.2.1/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a] -&gt; <a href="../base-4.18.2.1/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Ticket:Eq:2"></span> <a href="../base-4.18.2.1/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a)</span> <a href="src/Data.Atomics.Internal.html#line-63" class="link">Source</a> <a href="#t:Ticket" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Ticket:Eq:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Data-Atomics-Internal.html">Data.Atomics.Internal</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a -&gt; <a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a -&gt; <a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a -&gt; <a href="Data-Atomics-Internal.html#t:Ticket" title="Data.Atomics.Internal">Ticket</a> a -&gt; <a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><a href="#g:1" id="g:1"><h1>Very unsafe, not to be used</h1></a><div class="top"><p class="src"><a id="v:ptrEq" class="def">ptrEq</a> :: a -&gt; a -&gt; <a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="src/Data.Atomics.Internal.html#ptrEq" class="link">Source</a> <a href="#v:ptrEq" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>