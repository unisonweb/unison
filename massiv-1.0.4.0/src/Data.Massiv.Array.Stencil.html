<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Module      : Data.Massiv.Array.Stencil</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Copyright   : (c) Alexey Kuleshevich 2018-2022</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- License     : BSD3</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- Maintainer  : Alexey Kuleshevich &lt;lehins@yandex.ru&gt;</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- Stability   : experimental</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- Portability : non-portable</span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.Massiv.Array.Stencil</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-15"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Stencil</span></span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier">Stencil</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#makeStencil"><span class="hs-identifier">makeStencil</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#getStencilSize"><span class="hs-identifier">getStencilSize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#getStencilCenter"><span class="hs-identifier">getStencilCenter</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Padding</span></span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#Padding"><span class="hs-identifier">Padding</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#noPadding"><span class="hs-identifier">noPadding</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#samePadding"><span class="hs-identifier">samePadding</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Application</span></span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#mapStencil"><span class="hs-identifier">mapStencil</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#applyStencil"><span class="hs-identifier">applyStencil</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Common stencils</span></span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#idStencil"><span class="hs-identifier">idStencil</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#sumStencil"><span class="hs-identifier">sumStencil</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#productStencil"><span class="hs-identifier">productStencil</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#avgStencil"><span class="hs-identifier">avgStencil</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#maxStencil"><span class="hs-identifier">maxStencil</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#minStencil"><span class="hs-identifier">minStencil</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#foldlStencil"><span class="hs-identifier">foldlStencil</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#foldrStencil"><span class="hs-identifier">foldrStencil</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#foldStencil"><span class="hs-identifier">foldStencil</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Profunctor</span></span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#dimapStencil"><span class="hs-identifier">dimapStencil</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#lmapStencil"><span class="hs-identifier">lmapStencil</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#rmapStencil"><span class="hs-identifier">rmapStencil</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Convolution</span></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Convolution.html"><span class="hs-identifier">Data.Massiv.Array.Stencil.Convolution</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Coerce</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Delayed.Windowed.html"><span class="hs-identifier">Data.Massiv.Array.Delayed.Windowed</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.html"><span class="hs-identifier">Data.Massiv.Array.Manifest</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Convolution.html"><span class="hs-identifier">Data.Massiv.Array.Stencil.Convolution</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html"><span class="hs-identifier">Data.Massiv.Array.Stencil.Internal</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Unsafe.html"><span class="hs-identifier">Data.Massiv.Array.Stencil.Unsafe</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html"><span class="hs-identifier">Data.Massiv.Core.Common</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Semigroup</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Exts</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">inline</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">-- | Get the size of the stencil</span><span>
</span><span id="line-61"></span><span class="hs-comment">--</span><span>
</span><span id="line-62"></span><span class="hs-comment">-- @since 0.4.3</span><span>
</span><span id="line-63"></span><span id="local-6989586621679285848"><span id="local-6989586621679285849"><span id="local-6989586621679285850"><span class="annot"><a href="Data.Massiv.Array.Stencil.html#getStencilSize"><span class="hs-identifier hs-type">getStencilSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285848"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285849"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285850"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285848"><span class="hs-identifier hs-type">ix</span></a></span></span></span></span><span>
</span><span id="line-64"></span><span id="getStencilSize"><span class="annot"><span class="annottext">getStencilSize :: forall ix e a. Stencil ix e a -&gt; Sz ix
</span><a href="Data.Massiv.Array.Stencil.html#getStencilSize"><span class="hs-identifier hs-var hs-var">getStencilSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stencil ix e a -&gt; Sz ix
forall ix e a. Stencil ix e a -&gt; Sz ix
</span><a href="Data.Massiv.Array.Stencil.Internal.html#stencilSize"><span class="hs-identifier hs-var">stencilSize</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-comment">-- | Get the index of the stencil's center</span><span>
</span><span id="line-67"></span><span class="hs-comment">--</span><span>
</span><span id="line-68"></span><span class="hs-comment">-- @since 0.4.3</span><span>
</span><span id="line-69"></span><span id="local-6989586621679285856"><span id="local-6989586621679285857"><span id="local-6989586621679285858"><span class="annot"><a href="Data.Massiv.Array.Stencil.html#getStencilCenter"><span class="hs-identifier hs-type">getStencilCenter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285856"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285857"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285858"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679285856"><span class="hs-identifier hs-type">ix</span></a></span></span></span></span><span>
</span><span id="line-70"></span><span id="getStencilCenter"><span class="annot"><span class="annottext">getStencilCenter :: forall ix e a. Stencil ix e a -&gt; ix
</span><a href="Data.Massiv.Array.Stencil.html#getStencilCenter"><span class="hs-identifier hs-var hs-var">getStencilCenter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stencil ix e a -&gt; ix
forall ix e a. Stencil ix e a -&gt; ix
</span><a href="Data.Massiv.Array.Stencil.Internal.html#stencilCenter"><span class="hs-identifier hs-var">stencilCenter</span></a></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-comment">-- | Map a constructed stencil over an array. Resulting array must be</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- `Data.Massiv.Array.compute`d in order to be useful.</span><span>
</span><span id="line-74"></span><span class="hs-comment">--</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- @since 0.1.0</span><span>
</span><span id="line-76"></span><span id="local-6989586621679285862"><span id="local-6989586621679285864"><span id="local-6989586621679285865"><span id="local-6989586621679285868"><span class="annot"><a href="Data.Massiv.Array.Stencil.html#mapStencil"><span class="hs-identifier hs-type">mapStencil</span></a></span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285862"><span class="hs-identifier hs-type">ix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285864"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285865"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.html#Border"><span class="hs-identifier hs-type">Border</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285865"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Border resolution technique</span></span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285862"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285865"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285868"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-81"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Stencil to map over the array</span></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285864"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285862"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285865"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Source array</span></span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="Data.Massiv.Array.Delayed.Windowed.html#DW"><span class="hs-identifier hs-type">DW</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285862"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285868"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-85"></span><span id="mapStencil"><span class="annot"><span class="annottext">mapStencil :: forall ix r e a.
(Index ix, Manifest r e) =&gt;
Border e -&gt; Stencil ix e a -&gt; Array r ix e -&gt; Array DW ix a
</span><a href="Data.Massiv.Array.Stencil.html#mapStencil"><span class="hs-identifier hs-var hs-var">mapStencil</span></a></span></span><span> </span><span id="local-6989586621679286081"><span class="annot"><span class="annottext">Border e
</span><a href="#local-6989586621679286081"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679286082"><span class="annot"><span class="annottext">Stencil ix e a
</span><a href="#local-6989586621679286082"><span class="hs-identifier hs-var">stencil</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Padding ix e -&gt; Stencil ix e a -&gt; Array r ix e -&gt; Array DW ix a
forall ix r e a.
(Index ix, Manifest r e) =&gt;
Padding ix e -&gt; Stencil ix e a -&gt; Array r ix e -&gt; Array DW ix a
</span><a href="Data.Massiv.Array.Stencil.html#applyStencil"><span class="hs-identifier hs-var">applyStencil</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stencil ix e a -&gt; Border e -&gt; Padding ix e
forall ix e a.
Index ix =&gt;
Stencil ix e a -&gt; Border e -&gt; Padding ix e
</span><a href="Data.Massiv.Array.Stencil.html#samePadding"><span class="hs-identifier hs-var">samePadding</span></a></span><span> </span><span class="annot"><span class="annottext">Stencil ix e a
</span><a href="#local-6989586621679286082"><span class="hs-identifier hs-var">stencil</span></a></span><span> </span><span class="annot"><span class="annottext">Border e
</span><a href="#local-6989586621679286081"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Stencil ix e a
</span><a href="#local-6989586621679286082"><span class="hs-identifier hs-var">stencil</span></a></span><span>
</span><span id="line-86"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#mapStencil"><span class="hs-pragma hs-type">mapStencil</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-comment">-- | Padding of the source array before stencil application.</span><span>
</span><span id="line-89"></span><span class="hs-comment">--</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- ==== __Examples__</span><span>
</span><span id="line-91"></span><span class="hs-comment">--</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- In order to see the affect of padding we can simply apply an identity stencil to an</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- array:</span><span>
</span><span id="line-94"></span><span class="hs-comment">--</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.Massiv.Array as A</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- &gt;&gt;&gt; a = computeAs P $ resize' (Sz2 2 3) (Ix1 1 ... 6)</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- &gt;&gt;&gt; applyStencil noPadding idStencil a</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- Array DW Seq (Sz (2 :. 3))</span><span>
</span><span id="line-99"></span><span class="hs-comment">--   [ [ 1, 2, 3 ]</span><span>
</span><span id="line-100"></span><span class="hs-comment">--   , [ 4, 5, 6 ]</span><span>
</span><span id="line-101"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- &gt;&gt;&gt; applyStencil (Padding (Sz2 1 2) (Sz2 3 4) (Fill 0)) idStencil a</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- Array DW Seq (Sz (6 :. 9))</span><span>
</span><span id="line-104"></span><span class="hs-comment">--   [ [ 0, 0, 0, 0, 0, 0, 0, 0, 0 ]</span><span>
</span><span id="line-105"></span><span class="hs-comment">--   , [ 0, 0, 1, 2, 3, 0, 0, 0, 0 ]</span><span>
</span><span id="line-106"></span><span class="hs-comment">--   , [ 0, 0, 4, 5, 6, 0, 0, 0, 0 ]</span><span>
</span><span id="line-107"></span><span class="hs-comment">--   , [ 0, 0, 0, 0, 0, 0, 0, 0, 0 ]</span><span>
</span><span id="line-108"></span><span class="hs-comment">--   , [ 0, 0, 0, 0, 0, 0, 0, 0, 0 ]</span><span>
</span><span id="line-109"></span><span class="hs-comment">--   , [ 0, 0, 0, 0, 0, 0, 0, 0, 0 ]</span><span>
</span><span id="line-110"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-111"></span><span class="hs-comment">--</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- It is also a nice technique to see the border resolution strategy in action:</span><span>
</span><span id="line-113"></span><span class="hs-comment">--</span><span>
</span><span id="line-114"></span><span class="hs-comment">-- &gt;&gt;&gt; applyStencil (Padding (Sz2 2 3) (Sz2 2 3) Wrap) idStencil a</span><span>
</span><span id="line-115"></span><span class="hs-comment">-- Array DW Seq (Sz (6 :. 9))</span><span>
</span><span id="line-116"></span><span class="hs-comment">--   [ [ 1, 2, 3, 1, 2, 3, 1, 2, 3 ]</span><span>
</span><span id="line-117"></span><span class="hs-comment">--   , [ 4, 5, 6, 4, 5, 6, 4, 5, 6 ]</span><span>
</span><span id="line-118"></span><span class="hs-comment">--   , [ 1, 2, 3, 1, 2, 3, 1, 2, 3 ]</span><span>
</span><span id="line-119"></span><span class="hs-comment">--   , [ 4, 5, 6, 4, 5, 6, 4, 5, 6 ]</span><span>
</span><span id="line-120"></span><span class="hs-comment">--   , [ 1, 2, 3, 1, 2, 3, 1, 2, 3 ]</span><span>
</span><span id="line-121"></span><span class="hs-comment">--   , [ 4, 5, 6, 4, 5, 6, 4, 5, 6 ]</span><span>
</span><span id="line-122"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- &gt;&gt;&gt; applyStencil (Padding (Sz2 2 3) (Sz2 2 3) Edge) idStencil a</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- Array DW Seq (Sz (6 :. 9))</span><span>
</span><span id="line-125"></span><span class="hs-comment">--   [ [ 1, 1, 1, 1, 2, 3, 3, 3, 3 ]</span><span>
</span><span id="line-126"></span><span class="hs-comment">--   , [ 1, 1, 1, 1, 2, 3, 3, 3, 3 ]</span><span>
</span><span id="line-127"></span><span class="hs-comment">--   , [ 1, 1, 1, 1, 2, 3, 3, 3, 3 ]</span><span>
</span><span id="line-128"></span><span class="hs-comment">--   , [ 4, 4, 4, 4, 5, 6, 6, 6, 6 ]</span><span>
</span><span id="line-129"></span><span class="hs-comment">--   , [ 4, 4, 4, 4, 5, 6, 6, 6, 6 ]</span><span>
</span><span id="line-130"></span><span class="hs-comment">--   , [ 4, 4, 4, 4, 5, 6, 6, 6, 6 ]</span><span>
</span><span id="line-131"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-132"></span><span class="hs-comment">-- &gt;&gt;&gt; applyStencil (Padding (Sz2 2 3) (Sz2 2 3) Reflect) idStencil a</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- Array DW Seq (Sz (6 :. 9))</span><span>
</span><span id="line-134"></span><span class="hs-comment">--   [ [ 6, 5, 4, 4, 5, 6, 6, 5, 4 ]</span><span>
</span><span id="line-135"></span><span class="hs-comment">--   , [ 3, 2, 1, 1, 2, 3, 3, 2, 1 ]</span><span>
</span><span id="line-136"></span><span class="hs-comment">--   , [ 3, 2, 1, 1, 2, 3, 3, 2, 1 ]</span><span>
</span><span id="line-137"></span><span class="hs-comment">--   , [ 6, 5, 4, 4, 5, 6, 6, 5, 4 ]</span><span>
</span><span id="line-138"></span><span class="hs-comment">--   , [ 6, 5, 4, 4, 5, 6, 6, 5, 4 ]</span><span>
</span><span id="line-139"></span><span class="hs-comment">--   , [ 3, 2, 1, 1, 2, 3, 3, 2, 1 ]</span><span>
</span><span id="line-140"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- &gt;&gt;&gt; applyStencil (Padding (Sz2 2 3) (Sz2 2 3) Continue) idStencil a</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- Array DW Seq (Sz (6 :. 9))</span><span>
</span><span id="line-143"></span><span class="hs-comment">--   [ [ 1, 3, 2, 1, 2, 3, 2, 1, 3 ]</span><span>
</span><span id="line-144"></span><span class="hs-comment">--   , [ 4, 6, 5, 4, 5, 6, 5, 4, 6 ]</span><span>
</span><span id="line-145"></span><span class="hs-comment">--   , [ 1, 3, 2, 1, 2, 3, 2, 1, 3 ]</span><span>
</span><span id="line-146"></span><span class="hs-comment">--   , [ 4, 6, 5, 4, 5, 6, 5, 4, 6 ]</span><span>
</span><span id="line-147"></span><span class="hs-comment">--   , [ 1, 3, 2, 1, 2, 3, 2, 1, 3 ]</span><span>
</span><span id="line-148"></span><span class="hs-comment">--   , [ 4, 6, 5, 4, 5, 6, 5, 4, 6 ]</span><span>
</span><span id="line-149"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-150"></span><span class="hs-comment">--</span><span>
</span><span id="line-151"></span><span class="hs-comment">-- @since 0.4.3</span><span>
</span><span id="line-152"></span><span class="hs-keyword">data</span><span> </span><span id="Padding"><span class="annot"><a href="Data.Massiv.Array.Stencil.html#Padding"><span class="hs-identifier hs-var">Padding</span></a></span></span><span> </span><span id="local-6989586621679285883"><span class="annot"><a href="#local-6989586621679285883"><span class="hs-identifier hs-type">ix</span></a></span></span><span> </span><span id="local-6989586621679285884"><span class="annot"><a href="#local-6989586621679285884"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Padding"><span class="annot"><a href="Data.Massiv.Array.Stencil.html#Padding"><span class="hs-identifier hs-var">Padding</span></a></span></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="paddingFromOrigin"><span class="annot"><span class="annottext">forall ix e. Padding ix e -&gt; Sz ix
</span><a href="Data.Massiv.Array.Stencil.html#paddingFromOrigin"><span class="hs-identifier hs-var hs-var">paddingFromOrigin</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285883"><span class="hs-identifier hs-type">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="paddingFromBottom"><span class="annot"><span class="annottext">forall ix e. Padding ix e -&gt; Sz ix
</span><a href="Data.Massiv.Array.Stencil.html#paddingFromBottom"><span class="hs-identifier hs-var hs-var">paddingFromBottom</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285883"><span class="hs-identifier hs-type">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="paddingWithElement"><span class="annot"><span class="annottext">forall ix e. Padding ix e -&gt; Border e
</span><a href="Data.Massiv.Array.Stencil.html#paddingWithElement"><span class="hs-identifier hs-var hs-var">paddingWithElement</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Index.html#Border"><span class="hs-identifier hs-type">Border</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285884"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Element to do padding with</span></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679286090"><span id="local-6989586621679286097"><span class="annot"><span class="annottext">Padding ix e -&gt; Padding ix e -&gt; Bool
(Padding ix e -&gt; Padding ix e -&gt; Bool)
-&gt; (Padding ix e -&gt; Padding ix e -&gt; Bool) -&gt; Eq (Padding ix e)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall ix e. (Eq ix, Eq e) =&gt; Padding ix e -&gt; Padding ix e -&gt; Bool
$c== :: forall ix e. (Eq ix, Eq e) =&gt; Padding ix e -&gt; Padding ix e -&gt; Bool
== :: Padding ix e -&gt; Padding ix e -&gt; Bool
$c/= :: forall ix e. (Eq ix, Eq e) =&gt; Padding ix e -&gt; Padding ix e -&gt; Bool
/= :: Padding ix e -&gt; Padding ix e -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679286104"><span id="local-6989586621679286113"><span id="local-6989586621679286117"><span class="annot"><span class="annottext">Int -&gt; Padding ix e -&gt; ShowS
[Padding ix e] -&gt; ShowS
Padding ix e -&gt; String
(Int -&gt; Padding ix e -&gt; ShowS)
-&gt; (Padding ix e -&gt; String)
-&gt; ([Padding ix e] -&gt; ShowS)
-&gt; Show (Padding ix e)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall ix e. (Index ix, Show e) =&gt; Int -&gt; Padding ix e -&gt; ShowS
forall ix e. (Index ix, Show e) =&gt; [Padding ix e] -&gt; ShowS
forall ix e. (Index ix, Show e) =&gt; Padding ix e -&gt; String
$cshowsPrec :: forall ix e. (Index ix, Show e) =&gt; Int -&gt; Padding ix e -&gt; ShowS
showsPrec :: Int -&gt; Padding ix e -&gt; ShowS
$cshow :: forall ix e. (Index ix, Show e) =&gt; Padding ix e -&gt; String
show :: Padding ix e -&gt; String
$cshowList :: forall ix e. (Index ix, Show e) =&gt; [Padding ix e] -&gt; ShowS
showList :: [Padding ix e] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-comment">-- | Also known as &quot;valid&quot; padding. When stencil is applied to an array, that array will</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- shrink, unless the stencil is of size 1.</span><span>
</span><span id="line-162"></span><span class="hs-comment">--</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- @since 0.4.3</span><span>
</span><span id="line-164"></span><span id="local-6989586621679285906"><span id="local-6989586621679285907"><span class="annot"><a href="Data.Massiv.Array.Stencil.html#noPadding"><span class="hs-identifier hs-type">noPadding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285906"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#Padding"><span class="hs-identifier hs-type">Padding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285906"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285907"><span class="hs-identifier hs-type">e</span></a></span></span></span><span>
</span><span id="line-165"></span><span id="noPadding"><span class="annot"><span class="annottext">noPadding :: forall ix e. Index ix =&gt; Padding ix e
</span><a href="Data.Massiv.Array.Stencil.html#noPadding"><span class="hs-identifier hs-var hs-var">noPadding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sz ix -&gt; Sz ix -&gt; Border e -&gt; Padding ix e
forall ix e. Sz ix -&gt; Sz ix -&gt; Border e -&gt; Padding ix e
</span><a href="Data.Massiv.Array.Stencil.html#Padding"><span class="hs-identifier hs-var">Padding</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
forall ix. Index ix =&gt; Sz ix
</span><a href="Data.Massiv.Core.Index.Internal.html#zeroSz"><span class="hs-identifier hs-var">zeroSz</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
forall ix. Index ix =&gt; Sz ix
</span><a href="Data.Massiv.Core.Index.Internal.html#zeroSz"><span class="hs-identifier hs-var">zeroSz</span></a></span><span> </span><span class="annot"><span class="annottext">Border e
forall e. Border e
</span><a href="Data.Massiv.Core.Index.html#Edge"><span class="hs-identifier hs-var">Edge</span></a></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-comment">-- | Padding that matches the size of the stencil, which is known as &quot;same&quot; padding,</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- because when a stencil is applied to an array with such matching padding, the resulting</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- array will be of the same size as the source array. This is exactly the behavior of</span><span>
</span><span id="line-170"></span><span class="hs-comment">-- `mapStencil`</span><span>
</span><span id="line-171"></span><span class="hs-comment">--</span><span>
</span><span id="line-172"></span><span class="hs-comment">-- @since 0.4.3</span><span>
</span><span id="line-173"></span><span id="local-6989586621679285880"><span id="local-6989586621679285881"><span id="local-6989586621679285882"><span class="annot"><a href="Data.Massiv.Array.Stencil.html#samePadding"><span class="hs-identifier hs-type">samePadding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285880"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285880"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285881"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285882"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.html#Border"><span class="hs-identifier hs-type">Border</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285881"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#Padding"><span class="hs-identifier hs-type">Padding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285880"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285881"><span class="hs-identifier hs-type">e</span></a></span></span></span></span><span>
</span><span id="line-174"></span><span id="samePadding"><span class="annot"><span class="annottext">samePadding :: forall ix e a.
Index ix =&gt;
Stencil ix e a -&gt; Border e -&gt; Padding ix e
</span><a href="Data.Massiv.Array.Stencil.html#samePadding"><span class="hs-identifier hs-var hs-var">samePadding</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span id="local-6989586621679286137"><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286137"><span class="hs-identifier hs-var">sSz</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679286138"><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286138"><span class="hs-identifier hs-var">sCenter</span></a></span></span><span> </span><span class="annot"><span class="annottext">(ix -&gt; e) -&gt; (ix -&gt; e) -&gt; ix -&gt; a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679286139"><span class="annot"><span class="annottext">Border e
</span><a href="#local-6989586621679286139"><span class="hs-identifier hs-var">border</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-175"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#Padding"><span class="hs-identifier hs-type">Padding</span></a></span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">paddingFromOrigin :: Sz ix
</span><a href="Data.Massiv.Array.Stencil.html#paddingFromOrigin"><span class="hs-identifier hs-var">paddingFromOrigin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ix -&gt; Sz ix
forall ix. Index ix =&gt; ix -&gt; Sz ix
</span><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-var">Sz</span></a></span><span> </span><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286138"><span class="hs-identifier hs-var">sCenter</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">paddingFromBottom :: Sz ix
</span><a href="Data.Massiv.Array.Stencil.html#paddingFromBottom"><span class="hs-identifier hs-var">paddingFromBottom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ix -&gt; Sz ix
forall ix. Index ix =&gt; ix -&gt; Sz ix
</span><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-var">Sz</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int) -&gt; ix -&gt; ix -&gt; ix
forall ix. Index ix =&gt; (Int -&gt; Int -&gt; Int) -&gt; ix -&gt; ix -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#liftIndex2"><span class="hs-identifier hs-var">liftIndex2</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286137"><span class="hs-identifier hs-var">sSz</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; ix -&gt; ix
forall ix. Index ix =&gt; (Int -&gt; Int) -&gt; ix -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#liftIndex"><span class="hs-identifier hs-var">liftIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286138"><span class="hs-identifier hs-var">sCenter</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">paddingWithElement :: Border e
</span><a href="Data.Massiv.Array.Stencil.html#paddingWithElement"><span class="hs-identifier hs-var">paddingWithElement</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Border e
</span><a href="#local-6989586621679286139"><span class="hs-identifier hs-var">border</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-comment">-- | Apply a constructed stencil over an array. Resulting array must be</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- `Data.Massiv.Array.compute`d in order to be useful. Unlike `mapStencil`, the size of</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- the resulting array will not necesserally be the same as the source array, which will</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- depend on the padding.</span><span>
</span><span id="line-185"></span><span class="hs-comment">--</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- @since 0.4.3</span><span>
</span><span id="line-187"></span><span id="local-6989586621679285876"><span id="local-6989586621679285877"><span id="local-6989586621679285878"><span id="local-6989586621679285879"><span class="annot"><a href="Data.Massiv.Array.Stencil.html#applyStencil"><span class="hs-identifier hs-type">applyStencil</span></a></span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285876"><span class="hs-identifier hs-type">ix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285877"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285878"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#Padding"><span class="hs-identifier hs-type">Padding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285876"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285878"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-comment">-- ^ Padding to be applied to the source array. This will dictate the resulting size of</span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-comment">-- the array. No padding will cause it to shrink by the size of the stencil</span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285876"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285878"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285879"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-193"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Stencil to apply to the array</span></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285877"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285876"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285878"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-195"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Source array</span></span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="Data.Massiv.Array.Delayed.Windowed.html#DW"><span class="hs-identifier hs-type">DW</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285876"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285879"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-197"></span><span id="applyStencil"><span class="annot"><span class="annottext">applyStencil :: forall ix r e a.
(Index ix, Manifest r e) =&gt;
Padding ix e -&gt; Stencil ix e a -&gt; Array r ix e -&gt; Array DW ix a
</span><a href="Data.Massiv.Array.Stencil.html#applyStencil"><span class="hs-identifier hs-var hs-var">applyStencil</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#Padding"><span class="hs-identifier hs-type">Padding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span id="local-6989586621679286192"><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286192"><span class="hs-identifier hs-var">po</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span id="local-6989586621679286193"><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286193"><span class="hs-identifier hs-var">pb</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679286194"><span class="annot"><span class="annottext">Border e
</span><a href="#local-6989586621679286194"><span class="hs-identifier hs-var">border</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span id="local-6989586621679286195"><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679286195"><span class="hs-identifier hs-var">sSz</span></a></span></span><span> </span><span id="local-6989586621679286196"><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286196"><span class="hs-identifier hs-var">sCenter</span></a></span></span><span> </span><span id="local-6989586621679286197"><span class="annot"><span class="annottext">(ix -&gt; e) -&gt; (ix -&gt; e) -&gt; ix -&gt; a
</span><a href="#local-6989586621679286197"><span class="hs-identifier hs-var">stencilF</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679286198"><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679286198"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-198"></span><span>  </span><span class="annot"><span class="annottext">Array D ix a -&gt; Window ix a -&gt; Array DW ix a
forall ix e.
Index ix =&gt;
Array D ix e -&gt; Window ix e -&gt; Array DW ix e
</span><a href="Data.Massiv.Array.Delayed.Windowed.html#insertWindow"><span class="hs-identifier hs-var">insertWindow</span></a></span><span> </span><span class="annot"><span class="annottext">Array D ix a
</span><a href="#local-6989586621679286200"><span class="hs-identifier hs-var">warr</span></a></span><span> </span><span class="annot"><span class="annottext">Window ix a
</span><a href="#local-6989586621679286201"><span class="hs-identifier hs-var">window</span></a></span><span>
</span><span id="line-199"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679286202"><span class="annot"><span class="annottext">offset :: ix
</span><a href="#local-6989586621679286202"><span class="hs-identifier hs-var hs-var">offset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int) -&gt; ix -&gt; ix -&gt; ix
forall ix. Index ix =&gt; (Int -&gt; Int -&gt; Int) -&gt; ix -&gt; ix -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#liftIndex2"><span class="hs-identifier hs-var">liftIndex2</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286196"><span class="hs-identifier hs-var">sCenter</span></a></span><span> </span><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286192"><span class="hs-identifier hs-var">po</span></a></span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679286200"><span class="annot"><span class="annottext">warr :: Array D ix a
</span><a href="#local-6989586621679286200"><span class="hs-identifier hs-var hs-var">warr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-202"></span><span>      </span><span class="annot"><span class="annottext">Comp -&gt; Sz ix -&gt; PrefIndex ix a -&gt; Array D ix a
forall ix e. Comp -&gt; Sz ix -&gt; PrefIndex ix e -&gt; Array D ix e
</span><a href="Data.Massiv.Array.Delayed.Pull.html#DArray"><span class="hs-identifier hs-var">DArray</span></a></span><span>
</span><span id="line-203"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array r ix e -&gt; Comp
forall r ix e. Strategy r =&gt; Array r ix e -&gt; Comp
forall ix e. Array r ix e -&gt; Comp
</span><a href="Data.Massiv.Core.Common.html#getComp"><span class="hs-identifier hs-var">getComp</span></a></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679286198"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>        </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679286205"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-205"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ix -&gt; a) -&gt; PrefIndex ix a
forall ix e. (ix -&gt; e) -&gt; PrefIndex ix e
</span><a href="Data.Massiv.Core.Common.html#PrefIndex"><span class="hs-identifier hs-var">PrefIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ix -&gt; e) -&gt; (ix -&gt; e) -&gt; ix -&gt; a
</span><a href="#local-6989586621679286197"><span class="hs-identifier hs-var">stencilF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Border e -&gt; Array r ix e -&gt; ix -&gt; e
forall ix r e.
(Index ix, Manifest r e) =&gt;
Border e -&gt; Array r ix e -&gt; ix -&gt; e
</span><a href="Data.Massiv.Core.Common.html#borderIndex"><span class="hs-identifier hs-var">borderIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Border e
</span><a href="#local-6989586621679286194"><span class="hs-identifier hs-var">border</span></a></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679286198"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Border e -&gt; Array r ix e -&gt; ix -&gt; e
forall ix r e.
(Index ix, Manifest r e) =&gt;
Border e -&gt; Array r ix e -&gt; ix -&gt; e
</span><a href="Data.Massiv.Core.Common.html#borderIndex"><span class="hs-identifier hs-var">borderIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Border e
</span><a href="#local-6989586621679286194"><span class="hs-identifier hs-var">border</span></a></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679286198"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ix -&gt; a) -&gt; (ix -&gt; ix) -&gt; ix -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int) -&gt; ix -&gt; ix -&gt; ix
forall ix. Index ix =&gt; (Int -&gt; Int -&gt; Int) -&gt; ix -&gt; ix -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#liftIndex2"><span class="hs-identifier hs-var">liftIndex2</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span> </span><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286202"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-comment">-- Size by which the resulting array will shrink (not accounting for padding)</span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679286209"><span class="annot"><span class="annottext">shrinkSz :: Sz ix
</span><a href="#local-6989586621679286209"><span class="hs-identifier hs-var hs-var">shrinkSz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ix -&gt; Sz ix
forall ix. Index ix =&gt; ix -&gt; Sz ix
</span><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-var">Sz</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; ix -&gt; ix
forall ix. Index ix =&gt; (Int -&gt; Int) -&gt; ix -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#liftIndex"><span class="hs-identifier hs-var">liftIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">subtract</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sz ix -&gt; ix
forall ix. Sz ix -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#unSz"><span class="hs-identifier hs-var">unSz</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679286195"><span class="hs-identifier hs-var">sSz</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679286205"><span class="annot"><span class="annottext">sz :: Sz ix
</span><a href="#local-6989586621679286205"><span class="hs-identifier hs-var hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int) -&gt; Sz ix -&gt; Sz ix -&gt; Sz ix
forall ix.
Index ix =&gt;
(Int -&gt; Int -&gt; Int) -&gt; Sz ix -&gt; Sz ix -&gt; Sz ix
</span><a href="Data.Massiv.Core.Index.Internal.html#liftSz2"><span class="hs-identifier hs-var">liftSz2</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ix -&gt; Sz ix
forall ix. ix -&gt; Sz ix
</span><a href="Data.Massiv.Core.Index.Internal.html#SafeSz"><span class="hs-identifier hs-var">SafeSz</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int) -&gt; ix -&gt; ix -&gt; ix
forall ix. Index ix =&gt; (Int -&gt; Int -&gt; Int) -&gt; ix -&gt; ix -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#liftIndex2"><span class="hs-identifier hs-var">liftIndex2</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span> </span><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286192"><span class="hs-identifier hs-var">po</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int) -&gt; ix -&gt; ix -&gt; ix
forall ix. Index ix =&gt; (Int -&gt; Int -&gt; Int) -&gt; ix -&gt; ix -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#liftIndex2"><span class="hs-identifier hs-var">liftIndex2</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span> </span><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286193"><span class="hs-identifier hs-var">pb</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sz ix -&gt; ix
forall ix. Sz ix -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#unSz"><span class="hs-identifier hs-var">unSz</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array r ix e -&gt; Sz ix
forall r ix e. Size r =&gt; Array r ix e -&gt; Sz ix
forall ix e. Array r ix e -&gt; Sz ix
</span><a href="Data.Massiv.Core.Common.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679286198"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679286209"><span class="hs-identifier hs-var">shrinkSz</span></a></span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679286215"><span class="annot"><span class="annottext">wsz :: Sz ix
</span><a href="#local-6989586621679286215"><span class="hs-identifier hs-var hs-var">wsz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int) -&gt; Sz ix -&gt; Sz ix -&gt; Sz ix
forall ix.
Index ix =&gt;
(Int -&gt; Int -&gt; Int) -&gt; Sz ix -&gt; Sz ix -&gt; Sz ix
</span><a href="Data.Massiv.Core.Index.Internal.html#liftSz2"><span class="hs-identifier hs-var">liftSz2</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array r ix e -&gt; Sz ix
forall r ix e. Size r =&gt; Array r ix e -&gt; Sz ix
forall ix e. Array r ix e -&gt; Sz ix
</span><a href="Data.Massiv.Core.Common.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679286198"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679286209"><span class="hs-identifier hs-var">shrinkSz</span></a></span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679286201"><span class="annot"><span class="annottext">window :: Window ix a
</span><a href="#local-6989586621679286201"><span class="hs-identifier hs-var hs-var">window</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-211"></span><span>      </span><span class="annot"><a href="Data.Massiv.Array.Delayed.Windowed.html#Window"><span class="hs-identifier hs-type">Window</span></a></span><span>
</span><span id="line-212"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">windowStart :: ix
</span><a href="Data.Massiv.Array.Delayed.Windowed.html#windowStart"><span class="hs-identifier hs-var">windowStart</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286192"><span class="hs-identifier hs-var">po</span></a></span><span>
</span><span id="line-213"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">windowSize :: Sz ix
</span><a href="Data.Massiv.Array.Delayed.Windowed.html#windowSize"><span class="hs-identifier hs-var">windowSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679286215"><span class="hs-identifier hs-var">wsz</span></a></span><span>
</span><span id="line-214"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">windowIndex :: ix -&gt; a
</span><a href="Data.Massiv.Array.Delayed.Windowed.html#windowIndex"><span class="hs-identifier hs-var">windowIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ix -&gt; e) -&gt; (ix -&gt; e) -&gt; ix -&gt; a
</span><a href="#local-6989586621679286197"><span class="hs-identifier hs-var">stencilF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array r ix e -&gt; ix -&gt; e
forall ix. Index ix =&gt; Array r ix e -&gt; ix -&gt; e
forall r e ix. (Source r e, Index ix) =&gt; Array r ix e -&gt; ix -&gt; e
</span><a href="Data.Massiv.Core.Common.html#unsafeIndex"><span class="hs-identifier hs-var">unsafeIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679286198"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array r ix e -&gt; ix -&gt; e
forall ix r e.
(HasCallStack, Index ix, Manifest r e) =&gt;
Array r ix e -&gt; ix -&gt; e
</span><a href="Data.Massiv.Core.Common.html#index%27"><span class="hs-identifier hs-var">index'</span></a></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679286198"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ix -&gt; a) -&gt; (ix -&gt; ix) -&gt; ix -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int) -&gt; ix -&gt; ix -&gt; ix
forall ix. Index ix =&gt; (Int -&gt; Int -&gt; Int) -&gt; ix -&gt; ix -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#liftIndex2"><span class="hs-identifier hs-var">liftIndex2</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span> </span><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286202"><span class="hs-identifier hs-var">offset</span></a></span><span>
</span><span id="line-215"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">windowUnrollIx2 :: Maybe Int
</span><a href="#local-6989586621679286222"><span class="hs-identifier hs-var">windowUnrollIx2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sz Int -&gt; Int
forall ix. Sz ix -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#unSz"><span class="hs-identifier hs-var">unSz</span></a></span><span> </span><span class="annot"><span class="annottext">(Sz Int -&gt; Int)
-&gt; ((Sz Int, Sz (Lower ix)) -&gt; Sz Int)
-&gt; (Sz Int, Sz (Lower ix))
-&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Sz Int, Sz (Lower ix)) -&gt; Sz Int
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Sz Int, Sz (Lower ix)) -&gt; Int)
-&gt; Maybe (Sz Int, Sz (Lower ix)) -&gt; Maybe Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Sz ix -&gt; Dim -&gt; Maybe (Sz Int, Sz (Lower ix))
forall (m :: * -&gt; *) ix.
(MonadThrow m, Index ix) =&gt;
Sz ix -&gt; Dim -&gt; m (Sz Int, Sz (Lower ix))
</span><a href="Data.Massiv.Core.Index.Internal.html#pullOutSzM"><span class="hs-identifier hs-var">pullOutSzM</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679286195"><span class="hs-identifier hs-var">sSz</span></a></span><span> </span><span class="annot"><span class="annottext">Dim
</span><span class="hs-number">2</span></span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-217"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#applyStencil"><span class="hs-pragma hs-type">applyStencil</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-comment">-- | Construct a stencil from a function, which describes how to calculate the</span><span>
</span><span id="line-220"></span><span class="hs-comment">-- value at a point while having access to neighboring elements with a function</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- that accepts idices relative to the center of stencil. Trying to index</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- outside the stencil box will result in a runtime error upon stencil</span><span>
</span><span id="line-223"></span><span class="hs-comment">-- creation.</span><span>
</span><span id="line-224"></span><span class="hs-comment">--</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- /Note/ - Once correctness of stencil is verified then switching to `makeUnsafeStencil`</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- is recommended in order to get the most performance out of the `Stencil`</span><span>
</span><span id="line-227"></span><span class="hs-comment">--</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- ==== __Example__</span><span>
</span><span id="line-229"></span><span class="hs-comment">--</span><span>
</span><span id="line-230"></span><span class="hs-comment">-- Below is an example of creating a `Stencil`, which, when mapped over a</span><span>
</span><span id="line-231"></span><span class="hs-comment">-- 2-dimensional array, will compute an average of all elements in a 3x3 square</span><span>
</span><span id="line-232"></span><span class="hs-comment">-- for each element in that array.</span><span>
</span><span id="line-233"></span><span class="hs-comment">--</span><span>
</span><span id="line-234"></span><span class="hs-comment">-- /Note/ - Make sure to add an @INLINE@ pragma, otherwise performance will be terrible.</span><span>
</span><span id="line-235"></span><span class="hs-comment">--</span><span>
</span><span id="line-236"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-237"></span><span class="hs-comment">-- average3x3Stencil :: Fractional a =&gt; Stencil Ix2 a a</span><span>
</span><span id="line-238"></span><span class="hs-comment">-- average3x3Stencil = makeStencil (Sz (3 :. 3)) (1 :. 1) $ \ get -&gt;</span><span>
</span><span id="line-239"></span><span class="hs-comment">--   (  get (-1 :. -1) + get (-1 :. 0) + get (-1 :. 1) +</span><span>
</span><span id="line-240"></span><span class="hs-comment">--      get ( 0 :. -1) + get ( 0 :. 0) + get ( 0 :. 1) +</span><span>
</span><span id="line-241"></span><span class="hs-comment">--      get ( 1 :. -1) + get ( 1 :. 0) + get ( 1 :. 1)   ) / 9</span><span>
</span><span id="line-242"></span><span class="hs-comment">-- {\-# INLINE average3x3Stencil #-\}</span><span>
</span><span id="line-243"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-244"></span><span class="hs-comment">--</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- @since 0.1.0</span><span>
</span><span id="line-246"></span><span id="local-6989586621679285969"><span id="local-6989586621679285970"><span id="local-6989586621679285971"><span class="annot"><a href="Data.Massiv.Array.Stencil.html#makeStencil"><span class="hs-identifier hs-type">makeStencil</span></a></span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285969"><span class="hs-identifier hs-type">ix</span></a></span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285969"><span class="hs-identifier hs-type">ix</span></a></span><span>
</span><span id="line-249"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Size of the stencil</span></span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679285969"><span class="hs-identifier hs-type">ix</span></a></span><span>
</span><span id="line-251"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Center of the stencil</span></span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679285969"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679285970"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679285971"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-comment">-- ^ Stencil function that receives a &quot;get&quot; function as it's argument that can</span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-comment">-- retrieve values of cells in the source array with respect to the center of</span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-comment">-- the stencil. Stencil function must return a value that will be assigned to</span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-comment">-- the cell in the result array. Offset supplied to the &quot;get&quot; function</span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-comment">-- cannot go outside the boundaries of the stencil, otherwise an error will be</span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-comment">-- raised during stencil creation.</span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285969"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285970"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285971"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-260"></span><span id="makeStencil"><span class="annot"><span class="annottext">makeStencil :: forall ix e a.
Index ix =&gt;
Sz ix -&gt; ix -&gt; ((ix -&gt; e) -&gt; a) -&gt; Stencil ix e a
</span><a href="Data.Massiv.Array.Stencil.html#makeStencil"><span class="hs-identifier hs-var hs-var">makeStencil</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679286230"><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679286230"><span class="hs-identifier hs-var">sSz</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679286231"><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286231"><span class="hs-identifier hs-var">sCenter</span></a></span></span><span> </span><span id="local-6989586621679286232"><span class="annot"><span class="annottext">(ix -&gt; e) -&gt; a
</span><a href="#local-6989586621679286232"><span class="hs-identifier hs-var">relStencil</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sz ix
-&gt; ix -&gt; ((ix -&gt; e) -&gt; (ix -&gt; e) -&gt; ix -&gt; a) -&gt; Stencil ix e a
forall ix e a.
Sz ix
-&gt; ix -&gt; ((ix -&gt; e) -&gt; (ix -&gt; e) -&gt; ix -&gt; a) -&gt; Stencil ix e a
</span><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-var">Stencil</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679286230"><span class="hs-identifier hs-var">sSz</span></a></span><span> </span><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286231"><span class="hs-identifier hs-var">sCenter</span></a></span><span> </span><span class="annot"><span class="annottext">(ix -&gt; e) -&gt; (ix -&gt; e) -&gt; ix -&gt; a
</span><a href="#local-6989586621679286233"><span class="hs-identifier hs-var">stencil</span></a></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-262"></span><span>    </span><span id="local-6989586621679286233"><span class="annot"><span class="annottext">stencil :: (ix -&gt; e) -&gt; (ix -&gt; e) -&gt; ix -&gt; a
</span><a href="#local-6989586621679286233"><span class="hs-identifier hs-var hs-var">stencil</span></a></span></span><span> </span><span class="annot"><span class="annottext">ix -&gt; e
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679286234"><span class="annot"><span class="annottext">ix -&gt; e
</span><a href="#local-6989586621679286234"><span class="hs-identifier hs-var">getVal</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679286235"><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286235"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">inline</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ix -&gt; e) -&gt; a
</span><a href="#local-6989586621679286232"><span class="hs-identifier hs-var">relStencil</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ix -&gt; e
</span><a href="#local-6989586621679286234"><span class="hs-identifier hs-var">getVal</span></a></span><span> </span><span class="annot"><span class="annottext">(ix -&gt; e) -&gt; (ix -&gt; ix) -&gt; ix -&gt; e
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int) -&gt; ix -&gt; ix -&gt; ix
forall ix. Index ix =&gt; (Int -&gt; Int -&gt; Int) -&gt; ix -&gt; ix -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#liftIndex2"><span class="hs-identifier hs-var">liftIndex2</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span> </span><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286235"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679286233"><span class="hs-pragma hs-type">stencil</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-264"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#makeStencil"><span class="hs-pragma hs-type">makeStencil</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="hs-comment">-- | Identity stencil that does not change the elements of the source array.</span><span>
</span><span id="line-267"></span><span class="hs-comment">--</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- @since 0.4.3</span><span>
</span><span id="line-269"></span><span id="local-6989586621679285979"><span id="local-6989586621679285980"><span class="annot"><a href="Data.Massiv.Array.Stencil.html#idStencil"><span class="hs-identifier hs-type">idStencil</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285979"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285979"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285980"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285980"><span class="hs-identifier hs-type">e</span></a></span></span></span><span>
</span><span id="line-270"></span><span id="idStencil"><span class="annot"><span class="annottext">idStencil :: forall ix e. Index ix =&gt; Stencil ix e e
</span><a href="Data.Massiv.Array.Stencil.html#idStencil"><span class="hs-identifier hs-var hs-var">idStencil</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sz ix -&gt; ix -&gt; (ix -&gt; (ix -&gt; e) -&gt; e) -&gt; Stencil ix e e
forall ix e a.
Index ix =&gt;
Sz ix -&gt; ix -&gt; (ix -&gt; (ix -&gt; e) -&gt; a) -&gt; Stencil ix e a
</span><a href="Data.Massiv.Array.Stencil.Unsafe.html#makeUnsafeStencil"><span class="hs-identifier hs-var">makeUnsafeStencil</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
forall ix. Index ix =&gt; Sz ix
</span><a href="Data.Massiv.Core.Index.Internal.html#oneSz"><span class="hs-identifier hs-var">oneSz</span></a></span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#zeroIndex"><span class="hs-identifier hs-var">zeroIndex</span></a></span><span> </span><span class="annot"><span class="annottext">((ix -&gt; (ix -&gt; e) -&gt; e) -&gt; Stencil ix e e)
-&gt; (ix -&gt; (ix -&gt; e) -&gt; e) -&gt; Stencil ix e e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ix
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679286243"><span class="annot"><span class="annottext">ix -&gt; e
</span><a href="#local-6989586621679286243"><span class="hs-identifier hs-var">get</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ix -&gt; e
</span><a href="#local-6989586621679286243"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#zeroIndex"><span class="hs-identifier hs-var">zeroIndex</span></a></span><span>
</span><span id="line-271"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#idStencil"><span class="hs-pragma hs-type">idStencil</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="hs-comment">-- | Stencil that does a left fold in a row-major order. Regardless of the supplied size</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- resulting stencil will be centered at zero, although by using `Padding` it is possible</span><span>
</span><span id="line-275"></span><span class="hs-comment">-- to overcome this limitation.</span><span>
</span><span id="line-276"></span><span class="hs-comment">--</span><span>
</span><span id="line-277"></span><span class="hs-comment">-- ==== __Examples__</span><span>
</span><span id="line-278"></span><span class="hs-comment">--</span><span>
</span><span id="line-279"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.Massiv.Array as A</span><span>
</span><span id="line-280"></span><span class="hs-comment">-- &gt;&gt;&gt; a = computeAs P $ iterateN (Sz2 3 4) (+1) (10 :: Int)</span><span>
</span><span id="line-281"></span><span class="hs-comment">-- &gt;&gt;&gt; a</span><span>
</span><span id="line-282"></span><span class="hs-comment">-- Array P Seq (Sz (3 :. 4))</span><span>
</span><span id="line-283"></span><span class="hs-comment">--   [ [ 11, 12, 13, 14 ]</span><span>
</span><span id="line-284"></span><span class="hs-comment">--   , [ 15, 16, 17, 18 ]</span><span>
</span><span id="line-285"></span><span class="hs-comment">--   , [ 19, 20, 21, 22 ]</span><span>
</span><span id="line-286"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-287"></span><span class="hs-comment">-- &gt;&gt;&gt; applyStencil noPadding (foldlStencil (flip (:)) [] (Sz2 3 2)) a</span><span>
</span><span id="line-288"></span><span class="hs-comment">-- Array DW Seq (Sz (1 :. 3))</span><span>
</span><span id="line-289"></span><span class="hs-comment">--   [ [ [20,19,16,15,12,11], [21,20,17,16,13,12], [22,21,18,17,14,13] ]</span><span>
</span><span id="line-290"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-291"></span><span class="hs-comment">-- &gt;&gt;&gt; applyStencil (Padding (Sz2 1 0) 0 (Fill 10)) (foldlStencil (flip (:)) [] (Sz2 3 2)) a</span><span>
</span><span id="line-292"></span><span class="hs-comment">-- Array DW Seq (Sz (2 :. 3))</span><span>
</span><span id="line-293"></span><span class="hs-comment">--   [ [ [16,15,12,11,10,10], [17,16,13,12,10,10], [18,17,14,13,10,10] ]</span><span>
</span><span id="line-294"></span><span class="hs-comment">--   , [ [20,19,16,15,12,11], [21,20,17,16,13,12], [22,21,18,17,14,13] ]</span><span>
</span><span id="line-295"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-296"></span><span class="hs-comment">--</span><span>
</span><span id="line-297"></span><span class="hs-comment">-- @since 0.4.3</span><span>
</span><span id="line-298"></span><span id="local-6989586621679285990"><span id="local-6989586621679285991"><span id="local-6989586621679285992"><span class="annot"><a href="Data.Massiv.Array.Stencil.html#foldlStencil"><span class="hs-identifier hs-type">foldlStencil</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285990"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679285991"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679285992"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679285991"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679285991"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285990"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285990"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285992"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285991"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-299"></span><span id="foldlStencil"><span class="annot"><span class="annottext">foldlStencil :: forall ix a e.
Index ix =&gt;
(a -&gt; e -&gt; a) -&gt; a -&gt; Sz ix -&gt; Stencil ix e a
</span><a href="Data.Massiv.Array.Stencil.html#foldlStencil"><span class="hs-identifier hs-var hs-var">foldlStencil</span></a></span></span><span> </span><span id="local-6989586621679286251"><span class="annot"><span class="annottext">a -&gt; e -&gt; a
</span><a href="#local-6989586621679286251"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679286252"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679286252"><span class="hs-identifier hs-var">acc0</span></a></span></span><span> </span><span id="local-6989586621679286253"><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679286253"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-300"></span><span>  </span><span class="annot"><span class="annottext">Sz ix -&gt; ix -&gt; (ix -&gt; (ix -&gt; e) -&gt; a) -&gt; Stencil ix e a
forall ix e a.
Index ix =&gt;
Sz ix -&gt; ix -&gt; (ix -&gt; (ix -&gt; e) -&gt; a) -&gt; Stencil ix e a
</span><a href="Data.Massiv.Array.Stencil.Unsafe.html#makeUnsafeStencil"><span class="hs-identifier hs-var">makeUnsafeStencil</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679286253"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#zeroIndex"><span class="hs-identifier hs-var">zeroIndex</span></a></span><span> </span><span class="annot"><span class="annottext">((ix -&gt; (ix -&gt; e) -&gt; a) -&gt; Stencil ix e a)
-&gt; (ix -&gt; (ix -&gt; e) -&gt; a) -&gt; Stencil ix e a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ix
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679286254"><span class="annot"><span class="annottext">ix -&gt; e
</span><a href="#local-6989586621679286254"><span class="hs-identifier hs-var">get</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-301"></span><span>    </span><span class="annot"><span class="annottext">ix -&gt; ix -&gt; ix -&gt; (Int -&gt; Int -&gt; Bool) -&gt; a -&gt; (ix -&gt; a -&gt; a) -&gt; a
forall ix a.
Index ix =&gt;
ix -&gt; ix -&gt; ix -&gt; (Int -&gt; Int -&gt; Bool) -&gt; a -&gt; (ix -&gt; a -&gt; a) -&gt; a
</span><a href="Data.Massiv.Core.Index.html#iter"><span class="hs-identifier hs-var">iter</span></a></span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#zeroIndex"><span class="hs-identifier hs-var">zeroIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sz ix -&gt; ix
forall ix. Sz ix -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#unSz"><span class="hs-identifier hs-var">unSz</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679286253"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#oneIndex"><span class="hs-identifier hs-var">oneIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(&lt;)</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679286252"><span class="hs-identifier hs-var">acc0</span></a></span><span> </span><span class="annot"><span class="annottext">((ix -&gt; a -&gt; a) -&gt; a) -&gt; (ix -&gt; a -&gt; a) -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679286258"><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286258"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; e -&gt; a
</span><a href="#local-6989586621679286251"><span class="hs-operator hs-var">`f`</span></a></span><span> </span><span class="annot"><span class="annottext">ix -&gt; e
</span><a href="#local-6989586621679286254"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286258"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#foldlStencil"><span class="hs-pragma hs-type">foldlStencil</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span class="hs-comment">-- | Stencil that does a right fold in a row-major order. Regardless of the supplied size</span><span>
</span><span id="line-305"></span><span class="hs-comment">-- resulting stencil will be centered at zero, although by using `Padding` it is possible</span><span>
</span><span id="line-306"></span><span class="hs-comment">-- to overcome this limitation.</span><span>
</span><span id="line-307"></span><span class="hs-comment">--</span><span>
</span><span id="line-308"></span><span class="hs-comment">-- ==== __Examples__</span><span>
</span><span id="line-309"></span><span class="hs-comment">--</span><span>
</span><span id="line-310"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.Massiv.Array as A</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- &gt;&gt;&gt; a = computeAs P $ iterateN (Sz2 3 4) (+1) (10 :: Int)</span><span>
</span><span id="line-312"></span><span class="hs-comment">-- &gt;&gt;&gt; a</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- Array P Seq (Sz (3 :. 4))</span><span>
</span><span id="line-314"></span><span class="hs-comment">--   [ [ 11, 12, 13, 14 ]</span><span>
</span><span id="line-315"></span><span class="hs-comment">--   , [ 15, 16, 17, 18 ]</span><span>
</span><span id="line-316"></span><span class="hs-comment">--   , [ 19, 20, 21, 22 ]</span><span>
</span><span id="line-317"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-318"></span><span class="hs-comment">-- &gt;&gt;&gt; applyStencil noPadding (foldrStencil (:) [] (Sz2 2 3)) a</span><span>
</span><span id="line-319"></span><span class="hs-comment">-- Array DW Seq (Sz (2 :. 2))</span><span>
</span><span id="line-320"></span><span class="hs-comment">--   [ [ [11,12,13,15,16,17], [12,13,14,16,17,18] ]</span><span>
</span><span id="line-321"></span><span class="hs-comment">--   , [ [15,16,17,19,20,21], [16,17,18,20,21,22] ]</span><span>
</span><span id="line-322"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-323"></span><span class="hs-comment">--</span><span>
</span><span id="line-324"></span><span class="hs-comment">-- @since 0.4.3</span><span>
</span><span id="line-325"></span><span id="local-6989586621679285999"><span id="local-6989586621679286000"><span id="local-6989586621679286001"><span class="annot"><a href="Data.Massiv.Array.Stencil.html#foldrStencil"><span class="hs-identifier hs-type">foldrStencil</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285999"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679286000"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679286001"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679286001"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679286001"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285999"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679285999"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286000"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286001"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-326"></span><span id="foldrStencil"><span class="annot"><span class="annottext">foldrStencil :: forall ix e a.
Index ix =&gt;
(e -&gt; a -&gt; a) -&gt; a -&gt; Sz ix -&gt; Stencil ix e a
</span><a href="Data.Massiv.Array.Stencil.html#foldrStencil"><span class="hs-identifier hs-var hs-var">foldrStencil</span></a></span></span><span> </span><span id="local-6989586621679286271"><span class="annot"><span class="annottext">e -&gt; a -&gt; a
</span><a href="#local-6989586621679286271"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679286272"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679286272"><span class="hs-identifier hs-var">acc0</span></a></span></span><span> </span><span id="local-6989586621679286273"><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679286273"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-327"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679286274"><span class="annot"><span class="annottext">ixStart :: ix
</span><a href="#local-6989586621679286274"><span class="hs-identifier hs-var hs-var">ixStart</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int) -&gt; ix -&gt; ix -&gt; ix
forall ix. Index ix =&gt; (Int -&gt; Int -&gt; Int) -&gt; ix -&gt; ix -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#liftIndex2"><span class="hs-identifier hs-var">liftIndex2</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sz ix -&gt; ix
forall ix. Sz ix -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#unSz"><span class="hs-identifier hs-var">unSz</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679286273"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#oneIndex"><span class="hs-identifier hs-var">oneIndex</span></a></span><span>
</span><span id="line-328"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Sz ix -&gt; ix -&gt; (ix -&gt; (ix -&gt; e) -&gt; a) -&gt; Stencil ix e a
forall ix e a.
Index ix =&gt;
Sz ix -&gt; ix -&gt; (ix -&gt; (ix -&gt; e) -&gt; a) -&gt; Stencil ix e a
</span><a href="Data.Massiv.Array.Stencil.Unsafe.html#makeUnsafeStencil"><span class="hs-identifier hs-var">makeUnsafeStencil</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679286273"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#zeroIndex"><span class="hs-identifier hs-var">zeroIndex</span></a></span><span> </span><span class="annot"><span class="annottext">((ix -&gt; (ix -&gt; e) -&gt; a) -&gt; Stencil ix e a)
-&gt; (ix -&gt; (ix -&gt; e) -&gt; a) -&gt; Stencil ix e a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ix
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679286275"><span class="annot"><span class="annottext">ix -&gt; e
</span><a href="#local-6989586621679286275"><span class="hs-identifier hs-var">get</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-329"></span><span>        </span><span class="annot"><span class="annottext">ix -&gt; ix -&gt; ix -&gt; (Int -&gt; Int -&gt; Bool) -&gt; a -&gt; (ix -&gt; a -&gt; a) -&gt; a
forall ix a.
Index ix =&gt;
ix -&gt; ix -&gt; ix -&gt; (Int -&gt; Int -&gt; Bool) -&gt; a -&gt; (ix -&gt; a -&gt; a) -&gt; a
</span><a href="Data.Massiv.Core.Index.html#iter"><span class="hs-identifier hs-var">iter</span></a></span><span> </span><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286274"><span class="hs-identifier hs-var">ixStart</span></a></span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#zeroIndex"><span class="hs-identifier hs-var">zeroIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ix
forall ix. Index ix =&gt; Int -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#pureIndex"><span class="hs-identifier hs-var">pureIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(&gt;=)</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679286272"><span class="hs-identifier hs-var">acc0</span></a></span><span> </span><span class="annot"><span class="annottext">((ix -&gt; a -&gt; a) -&gt; a) -&gt; (ix -&gt; a -&gt; a) -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679286277"><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286277"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">e -&gt; a -&gt; a
</span><a href="#local-6989586621679286271"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ix -&gt; e
</span><a href="#local-6989586621679286275"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679286277"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#foldrStencil"><span class="hs-pragma hs-type">foldrStencil</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span class="hs-comment">-- | Create a stencil that will fold all elements in the region monoidally.</span><span>
</span><span id="line-333"></span><span class="hs-comment">--</span><span>
</span><span id="line-334"></span><span class="hs-comment">-- @since 0.4.3</span><span>
</span><span id="line-335"></span><span id="local-6989586621679286005"><span id="local-6989586621679286006"><span class="annot"><a href="Data.Massiv.Array.Stencil.html#foldStencil"><span class="hs-identifier hs-type">foldStencil</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679286005"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286006"><span class="hs-identifier hs-type">ix</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286006"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286006"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286005"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286005"><span class="hs-identifier hs-type">e</span></a></span></span></span><span>
</span><span id="line-336"></span><span id="foldStencil"><span class="annot"><span class="annottext">foldStencil :: forall e ix. (Monoid e, Index ix) =&gt; Sz ix -&gt; Stencil ix e e
</span><a href="Data.Massiv.Array.Stencil.html#foldStencil"><span class="hs-identifier hs-var hs-var">foldStencil</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(e -&gt; e -&gt; e) -&gt; e -&gt; Sz ix -&gt; Stencil ix e e
forall ix a e.
Index ix =&gt;
(a -&gt; e -&gt; a) -&gt; a -&gt; Sz ix -&gt; Stencil ix e a
</span><a href="Data.Massiv.Array.Stencil.html#foldlStencil"><span class="hs-identifier hs-var">foldlStencil</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; e -&gt; e
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">mappend</span></span><span> </span><span class="annot"><span class="annottext">e
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-337"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#foldStencil"><span class="hs-pragma hs-type">foldStencil</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span class="hs-comment">-- | Create a stencil centered at 0 that will extract the maximum value in the region of</span><span>
</span><span id="line-340"></span><span class="hs-comment">-- supplied size.</span><span>
</span><span id="line-341"></span><span class="hs-comment">--</span><span>
</span><span id="line-342"></span><span class="hs-comment">-- ==== __Example__</span><span>
</span><span id="line-343"></span><span class="hs-comment">--</span><span>
</span><span id="line-344"></span><span class="hs-comment">-- Here is a sample implementation of max pooling.</span><span>
</span><span id="line-345"></span><span class="hs-comment">--</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.Massiv.Array as A</span><span>
</span><span id="line-347"></span><span class="hs-comment">-- &gt;&gt;&gt; a &lt;- computeAs P &lt;$&gt; resizeM (Sz2 9 9) (Ix1 10 ..: 91)</span><span>
</span><span id="line-348"></span><span class="hs-comment">-- &gt;&gt;&gt; a</span><span>
</span><span id="line-349"></span><span class="hs-comment">-- Array P Seq (Sz (9 :. 9))</span><span>
</span><span id="line-350"></span><span class="hs-comment">--   [ [ 10, 11, 12, 13, 14, 15, 16, 17, 18 ]</span><span>
</span><span id="line-351"></span><span class="hs-comment">--   , [ 19, 20, 21, 22, 23, 24, 25, 26, 27 ]</span><span>
</span><span id="line-352"></span><span class="hs-comment">--   , [ 28, 29, 30, 31, 32, 33, 34, 35, 36 ]</span><span>
</span><span id="line-353"></span><span class="hs-comment">--   , [ 37, 38, 39, 40, 41, 42, 43, 44, 45 ]</span><span>
</span><span id="line-354"></span><span class="hs-comment">--   , [ 46, 47, 48, 49, 50, 51, 52, 53, 54 ]</span><span>
</span><span id="line-355"></span><span class="hs-comment">--   , [ 55, 56, 57, 58, 59, 60, 61, 62, 63 ]</span><span>
</span><span id="line-356"></span><span class="hs-comment">--   , [ 64, 65, 66, 67, 68, 69, 70, 71, 72 ]</span><span>
</span><span id="line-357"></span><span class="hs-comment">--   , [ 73, 74, 75, 76, 77, 78, 79, 80, 81 ]</span><span>
</span><span id="line-358"></span><span class="hs-comment">--   , [ 82, 83, 84, 85, 86, 87, 88, 89, 90 ]</span><span>
</span><span id="line-359"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-360"></span><span class="hs-comment">-- &gt;&gt;&gt; computeWithStrideAs P (Stride 3) $ mapStencil Edge (maxStencil (Sz 3)) a</span><span>
</span><span id="line-361"></span><span class="hs-comment">-- Array P Seq (Sz (3 :. 3))</span><span>
</span><span id="line-362"></span><span class="hs-comment">--   [ [ 30, 33, 36 ]</span><span>
</span><span id="line-363"></span><span class="hs-comment">--   , [ 57, 60, 63 ]</span><span>
</span><span id="line-364"></span><span class="hs-comment">--   , [ 84, 87, 90 ]</span><span>
</span><span id="line-365"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-366"></span><span class="hs-comment">--</span><span>
</span><span id="line-367"></span><span class="hs-comment">-- @since 0.4.3</span><span>
</span><span id="line-368"></span><span id="local-6989586621679286010"><span id="local-6989586621679286011"><span class="annot"><a href="Data.Massiv.Array.Stencil.html#maxStencil"><span class="hs-identifier hs-type">maxStencil</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bounded</span></span><span> </span><span class="annot"><a href="#local-6989586621679286010"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679286010"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286011"><span class="hs-identifier hs-type">ix</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286011"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286011"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286010"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286010"><span class="hs-identifier hs-type">e</span></a></span></span></span><span>
</span><span id="line-369"></span><span id="maxStencil"><span class="annot"><span class="annottext">maxStencil :: forall e ix.
(Bounded e, Ord e, Index ix) =&gt;
Sz ix -&gt; Stencil ix e e
</span><a href="Data.Massiv.Array.Stencil.html#maxStencil"><span class="hs-identifier hs-var hs-var">maxStencil</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(e -&gt; Max e)
-&gt; (Max e -&gt; e) -&gt; Stencil ix (Max e) (Max e) -&gt; Stencil ix e e
forall c d a b ix.
(c -&gt; d) -&gt; (a -&gt; b) -&gt; Stencil ix d a -&gt; Stencil ix c b
</span><a href="Data.Massiv.Array.Stencil.Internal.html#dimapStencil"><span class="hs-identifier hs-var">dimapStencil</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; Max e
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="annot"><span class="annottext">Max e -&gt; e
forall a. Max a -&gt; a
</span><span class="hs-identifier hs-var">getMax</span></span><span> </span><span class="annot"><span class="annottext">(Stencil ix (Max e) (Max e) -&gt; Stencil ix e e)
-&gt; (Sz ix -&gt; Stencil ix (Max e) (Max e)) -&gt; Sz ix -&gt; Stencil ix e e
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Sz ix -&gt; Stencil ix (Max e) (Max e)
forall e ix. (Monoid e, Index ix) =&gt; Sz ix -&gt; Stencil ix e e
</span><a href="Data.Massiv.Array.Stencil.html#foldStencil"><span class="hs-identifier hs-var">foldStencil</span></a></span><span>
</span><span id="line-370"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#maxStencil"><span class="hs-pragma hs-type">maxStencil</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span class="hs-comment">-- | Create a stencil centered at 0 that will extract the maximum value in the region of</span><span>
</span><span id="line-373"></span><span class="hs-comment">-- supplied size.</span><span>
</span><span id="line-374"></span><span class="hs-comment">--</span><span>
</span><span id="line-375"></span><span class="hs-comment">-- ==== __Example__</span><span>
</span><span id="line-376"></span><span class="hs-comment">--</span><span>
</span><span id="line-377"></span><span class="hs-comment">-- Here is a sample implementation of min pooling.</span><span>
</span><span id="line-378"></span><span class="hs-comment">--</span><span>
</span><span id="line-379"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.Massiv.Array as A</span><span>
</span><span id="line-380"></span><span class="hs-comment">-- &gt;&gt;&gt; a &lt;- computeAs P &lt;$&gt; resizeM (Sz2 9 9) (Ix1 10 ..: 91)</span><span>
</span><span id="line-381"></span><span class="hs-comment">-- &gt;&gt;&gt; a</span><span>
</span><span id="line-382"></span><span class="hs-comment">-- Array P Seq (Sz (9 :. 9))</span><span>
</span><span id="line-383"></span><span class="hs-comment">--   [ [ 10, 11, 12, 13, 14, 15, 16, 17, 18 ]</span><span>
</span><span id="line-384"></span><span class="hs-comment">--   , [ 19, 20, 21, 22, 23, 24, 25, 26, 27 ]</span><span>
</span><span id="line-385"></span><span class="hs-comment">--   , [ 28, 29, 30, 31, 32, 33, 34, 35, 36 ]</span><span>
</span><span id="line-386"></span><span class="hs-comment">--   , [ 37, 38, 39, 40, 41, 42, 43, 44, 45 ]</span><span>
</span><span id="line-387"></span><span class="hs-comment">--   , [ 46, 47, 48, 49, 50, 51, 52, 53, 54 ]</span><span>
</span><span id="line-388"></span><span class="hs-comment">--   , [ 55, 56, 57, 58, 59, 60, 61, 62, 63 ]</span><span>
</span><span id="line-389"></span><span class="hs-comment">--   , [ 64, 65, 66, 67, 68, 69, 70, 71, 72 ]</span><span>
</span><span id="line-390"></span><span class="hs-comment">--   , [ 73, 74, 75, 76, 77, 78, 79, 80, 81 ]</span><span>
</span><span id="line-391"></span><span class="hs-comment">--   , [ 82, 83, 84, 85, 86, 87, 88, 89, 90 ]</span><span>
</span><span id="line-392"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-393"></span><span class="hs-comment">-- &gt;&gt;&gt; computeWithStrideAs P (Stride 3) $ mapStencil Edge (minStencil (Sz 3)) a</span><span>
</span><span id="line-394"></span><span class="hs-comment">-- Array P Seq (Sz (3 :. 3))</span><span>
</span><span id="line-395"></span><span class="hs-comment">--   [ [ 10, 13, 16 ]</span><span>
</span><span id="line-396"></span><span class="hs-comment">--   , [ 37, 40, 43 ]</span><span>
</span><span id="line-397"></span><span class="hs-comment">--   , [ 64, 67, 70 ]</span><span>
</span><span id="line-398"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-399"></span><span class="hs-comment">--</span><span>
</span><span id="line-400"></span><span class="hs-comment">-- @since 0.4.3</span><span>
</span><span id="line-401"></span><span id="local-6989586621679286291"><span id="local-6989586621679286292"><span class="annot"><a href="Data.Massiv.Array.Stencil.html#minStencil"><span class="hs-identifier hs-type">minStencil</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bounded</span></span><span> </span><span class="annot"><a href="#local-6989586621679286291"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679286291"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286292"><span class="hs-identifier hs-type">ix</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286292"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286292"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286291"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286291"><span class="hs-identifier hs-type">e</span></a></span></span></span><span>
</span><span id="line-402"></span><span id="minStencil"><span class="annot"><span class="annottext">minStencil :: forall e ix.
(Bounded e, Ord e, Index ix) =&gt;
Sz ix -&gt; Stencil ix e e
</span><a href="Data.Massiv.Array.Stencil.html#minStencil"><span class="hs-identifier hs-var hs-var">minStencil</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(e -&gt; Min e)
-&gt; (Min e -&gt; e) -&gt; Stencil ix (Min e) (Min e) -&gt; Stencil ix e e
forall c d a b ix.
(c -&gt; d) -&gt; (a -&gt; b) -&gt; Stencil ix d a -&gt; Stencil ix c b
</span><a href="Data.Massiv.Array.Stencil.Internal.html#dimapStencil"><span class="hs-identifier hs-var">dimapStencil</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; Min e
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="annot"><span class="annottext">Min e -&gt; e
forall a. Min a -&gt; a
</span><span class="hs-identifier hs-var">getMin</span></span><span> </span><span class="annot"><span class="annottext">(Stencil ix (Min e) (Min e) -&gt; Stencil ix e e)
-&gt; (Sz ix -&gt; Stencil ix (Min e) (Min e)) -&gt; Sz ix -&gt; Stencil ix e e
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Sz ix -&gt; Stencil ix (Min e) (Min e)
forall e ix. (Monoid e, Index ix) =&gt; Sz ix -&gt; Stencil ix e e
</span><a href="Data.Massiv.Array.Stencil.html#foldStencil"><span class="hs-identifier hs-var">foldStencil</span></a></span><span>
</span><span id="line-403"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#minStencil"><span class="hs-pragma hs-type">minStencil</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span class="hs-comment">-- | Sum all elements in the stencil region</span><span>
</span><span id="line-406"></span><span class="hs-comment">--</span><span>
</span><span id="line-407"></span><span class="hs-comment">-- ==== __Examples__</span><span>
</span><span id="line-408"></span><span class="hs-comment">--</span><span>
</span><span id="line-409"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.Massiv.Array as A</span><span>
</span><span id="line-410"></span><span class="hs-comment">-- &gt;&gt;&gt; a = computeAs P $ iterateN (Sz2 2 5) (* 2) (1 :: Int)</span><span>
</span><span id="line-411"></span><span class="hs-comment">-- &gt;&gt;&gt; a</span><span>
</span><span id="line-412"></span><span class="hs-comment">-- Array P Seq (Sz (2 :. 5))</span><span>
</span><span id="line-413"></span><span class="hs-comment">--   [ [ 2, 4, 8, 16, 32 ]</span><span>
</span><span id="line-414"></span><span class="hs-comment">--   , [ 64, 128, 256, 512, 1024 ]</span><span>
</span><span id="line-415"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-416"></span><span class="hs-comment">-- &gt;&gt;&gt; applyStencil noPadding (sumStencil (Sz2 1 2)) a</span><span>
</span><span id="line-417"></span><span class="hs-comment">-- Array DW Seq (Sz (2 :. 4))</span><span>
</span><span id="line-418"></span><span class="hs-comment">--   [ [ 6, 12, 24, 48 ]</span><span>
</span><span id="line-419"></span><span class="hs-comment">--   , [ 192, 384, 768, 1536 ]</span><span>
</span><span id="line-420"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-421"></span><span class="hs-comment">-- &gt;&gt;&gt; [2 + 4, 4 + 8, 8 + 16, 16 + 32] :: [Int]</span><span>
</span><span id="line-422"></span><span class="hs-comment">-- [6,12,24,48]</span><span>
</span><span id="line-423"></span><span class="hs-comment">--</span><span>
</span><span id="line-424"></span><span class="hs-comment">-- @since 0.4.3</span><span>
</span><span id="line-425"></span><span id="local-6989586621679286030"><span id="local-6989586621679286031"><span class="annot"><a href="Data.Massiv.Array.Stencil.html#sumStencil"><span class="hs-identifier hs-type">sumStencil</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679286030"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286031"><span class="hs-identifier hs-type">ix</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286031"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286031"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286030"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286030"><span class="hs-identifier hs-type">e</span></a></span></span></span><span>
</span><span id="line-426"></span><span id="sumStencil"><span class="annot"><span class="annottext">sumStencil :: forall e ix. (Num e, Index ix) =&gt; Sz ix -&gt; Stencil ix e e
</span><a href="Data.Massiv.Array.Stencil.html#sumStencil"><span class="hs-identifier hs-var hs-var">sumStencil</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(e -&gt; Sum e)
-&gt; (Sum e -&gt; e) -&gt; Stencil ix (Sum e) (Sum e) -&gt; Stencil ix e e
forall c d a b ix.
(c -&gt; d) -&gt; (a -&gt; b) -&gt; Stencil ix d a -&gt; Stencil ix c b
</span><a href="Data.Massiv.Array.Stencil.Internal.html#dimapStencil"><span class="hs-identifier hs-var">dimapStencil</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; Sum e
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="annot"><span class="annottext">Sum e -&gt; e
forall a. Sum a -&gt; a
</span><span class="hs-identifier hs-var">getSum</span></span><span> </span><span class="annot"><span class="annottext">(Stencil ix (Sum e) (Sum e) -&gt; Stencil ix e e)
-&gt; (Sz ix -&gt; Stencil ix (Sum e) (Sum e)) -&gt; Sz ix -&gt; Stencil ix e e
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Sz ix -&gt; Stencil ix (Sum e) (Sum e)
forall e ix. (Monoid e, Index ix) =&gt; Sz ix -&gt; Stencil ix e e
</span><a href="Data.Massiv.Array.Stencil.html#foldStencil"><span class="hs-identifier hs-var">foldStencil</span></a></span><span>
</span><span id="line-427"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#sumStencil"><span class="hs-pragma hs-type">sumStencil</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span class="hs-comment">-- | Multiply all elements in the stencil region</span><span>
</span><span id="line-430"></span><span class="hs-comment">--</span><span>
</span><span id="line-431"></span><span class="hs-comment">-- ==== __Examples__</span><span>
</span><span id="line-432"></span><span class="hs-comment">--</span><span>
</span><span id="line-433"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.Massiv.Array as A</span><span>
</span><span id="line-434"></span><span class="hs-comment">-- &gt;&gt;&gt; a = computeAs P $ iterateN (Sz2 2 2) (+1) (0 :: Int)</span><span>
</span><span id="line-435"></span><span class="hs-comment">-- &gt;&gt;&gt; a</span><span>
</span><span id="line-436"></span><span class="hs-comment">-- Array P Seq (Sz (2 :. 2))</span><span>
</span><span id="line-437"></span><span class="hs-comment">--   [ [ 1, 2 ]</span><span>
</span><span id="line-438"></span><span class="hs-comment">--   , [ 3, 4 ]</span><span>
</span><span id="line-439"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-440"></span><span class="hs-comment">-- &gt;&gt;&gt; applyStencil (Padding 0 2 (Fill 0)) (productStencil 2) a</span><span>
</span><span id="line-441"></span><span class="hs-comment">-- Array DW Seq (Sz (3 :. 3))</span><span>
</span><span id="line-442"></span><span class="hs-comment">--   [ [ 24, 0, 0 ]</span><span>
</span><span id="line-443"></span><span class="hs-comment">--   , [ 0, 0, 0 ]</span><span>
</span><span id="line-444"></span><span class="hs-comment">--   , [ 0, 0, 0 ]</span><span>
</span><span id="line-445"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-446"></span><span class="hs-comment">-- &gt;&gt;&gt; applyStencil (Padding 0 2 Reflect) (productStencil 2) a</span><span>
</span><span id="line-447"></span><span class="hs-comment">-- Array DW Seq (Sz (3 :. 3))</span><span>
</span><span id="line-448"></span><span class="hs-comment">--   [ [ 24, 64, 24 ]</span><span>
</span><span id="line-449"></span><span class="hs-comment">--   , [ 144, 256, 144 ]</span><span>
</span><span id="line-450"></span><span class="hs-comment">--   , [ 24, 64, 24 ]</span><span>
</span><span id="line-451"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-452"></span><span class="hs-comment">--</span><span>
</span><span id="line-453"></span><span class="hs-comment">-- @since 0.4.3</span><span>
</span><span id="line-454"></span><span id="local-6989586621679286308"><span id="local-6989586621679286309"><span class="annot"><a href="Data.Massiv.Array.Stencil.html#productStencil"><span class="hs-identifier hs-type">productStencil</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679286308"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286309"><span class="hs-identifier hs-type">ix</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286309"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286309"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286308"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286308"><span class="hs-identifier hs-type">e</span></a></span></span></span><span>
</span><span id="line-455"></span><span id="productStencil"><span class="annot"><span class="annottext">productStencil :: forall e ix. (Num e, Index ix) =&gt; Sz ix -&gt; Stencil ix e e
</span><a href="Data.Massiv.Array.Stencil.html#productStencil"><span class="hs-identifier hs-var hs-var">productStencil</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(e -&gt; Product e)
-&gt; (Product e -&gt; e)
-&gt; Stencil ix (Product e) (Product e)
-&gt; Stencil ix e e
forall c d a b ix.
(c -&gt; d) -&gt; (a -&gt; b) -&gt; Stencil ix d a -&gt; Stencil ix c b
</span><a href="Data.Massiv.Array.Stencil.Internal.html#dimapStencil"><span class="hs-identifier hs-var">dimapStencil</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; Product e
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="annot"><span class="annottext">Product e -&gt; e
forall a. Product a -&gt; a
</span><span class="hs-identifier hs-var">getProduct</span></span><span> </span><span class="annot"><span class="annottext">(Stencil ix (Product e) (Product e) -&gt; Stencil ix e e)
-&gt; (Sz ix -&gt; Stencil ix (Product e) (Product e))
-&gt; Sz ix
-&gt; Stencil ix e e
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Sz ix -&gt; Stencil ix (Product e) (Product e)
forall e ix. (Monoid e, Index ix) =&gt; Sz ix -&gt; Stencil ix e e
</span><a href="Data.Massiv.Array.Stencil.html#foldStencil"><span class="hs-identifier hs-var">foldStencil</span></a></span><span>
</span><span id="line-456"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#productStencil"><span class="hs-pragma hs-type">productStencil</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span class="hs-comment">-- | Find the average value of all elements in the stencil region</span><span>
</span><span id="line-459"></span><span class="hs-comment">--</span><span>
</span><span id="line-460"></span><span class="hs-comment">-- ==== __Example__</span><span>
</span><span id="line-461"></span><span class="hs-comment">--</span><span>
</span><span id="line-462"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.Massiv.Array as A</span><span>
</span><span id="line-463"></span><span class="hs-comment">-- &gt;&gt;&gt; a = computeAs P $ iterateN (Sz2 3 4) (+1) (10 :: Double)</span><span>
</span><span id="line-464"></span><span class="hs-comment">-- &gt;&gt;&gt; a</span><span>
</span><span id="line-465"></span><span class="hs-comment">-- Array P Seq (Sz (3 :. 4))</span><span>
</span><span id="line-466"></span><span class="hs-comment">--   [ [ 11.0, 12.0, 13.0, 14.0 ]</span><span>
</span><span id="line-467"></span><span class="hs-comment">--   , [ 15.0, 16.0, 17.0, 18.0 ]</span><span>
</span><span id="line-468"></span><span class="hs-comment">--   , [ 19.0, 20.0, 21.0, 22.0 ]</span><span>
</span><span id="line-469"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-470"></span><span class="hs-comment">-- &gt;&gt;&gt; applyStencil noPadding (avgStencil (Sz2 2 3)) a</span><span>
</span><span id="line-471"></span><span class="hs-comment">-- Array DW Seq (Sz (2 :. 2))</span><span>
</span><span id="line-472"></span><span class="hs-comment">--   [ [ 14.0, 15.0 ]</span><span>
</span><span id="line-473"></span><span class="hs-comment">--   , [ 18.0, 19.0 ]</span><span>
</span><span id="line-474"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-475"></span><span class="hs-comment">-- &gt;&gt;&gt; Prelude.sum [11.0, 12.0, 13.0, 15.0, 16.0, 17.0] / 6 :: Double</span><span>
</span><span id="line-476"></span><span class="hs-comment">-- 14.0</span><span>
</span><span id="line-477"></span><span class="hs-comment">--</span><span>
</span><span id="line-478"></span><span class="hs-comment">-- @since 0.4.3</span><span>
</span><span id="line-479"></span><span id="local-6989586621679286042"><span id="local-6989586621679286043"><span class="annot"><a href="Data.Massiv.Array.Stencil.html#avgStencil"><span class="hs-identifier hs-type">avgStencil</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679286042"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286043"><span class="hs-identifier hs-type">ix</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286043"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286043"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286042"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286042"><span class="hs-identifier hs-type">e</span></a></span></span></span><span>
</span><span id="line-480"></span><span id="avgStencil"><span class="annot"><span class="annottext">avgStencil :: forall e ix. (Fractional e, Index ix) =&gt; Sz ix -&gt; Stencil ix e e
</span><a href="Data.Massiv.Array.Stencil.html#avgStencil"><span class="hs-identifier hs-var hs-var">avgStencil</span></a></span></span><span> </span><span id="local-6989586621679286330"><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679286330"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sz ix -&gt; Stencil ix e e
forall e ix. (Num e, Index ix) =&gt; Sz ix -&gt; Stencil ix e e
</span><a href="Data.Massiv.Array.Stencil.html#sumStencil"><span class="hs-identifier hs-var">sumStencil</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679286330"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Stencil ix e e -&gt; Stencil ix e e -&gt; Stencil ix e e
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Stencil ix e e
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sz ix -&gt; Int
forall ix. Index ix =&gt; Sz ix -&gt; Int
</span><a href="Data.Massiv.Core.Index.Internal.html#totalElem"><span class="hs-identifier hs-var">totalElem</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679286330"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html#avgStencil"><span class="hs-pragma hs-type">avgStencil</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-482"></span></pre></body></html>