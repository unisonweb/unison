<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE MagicHash #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE MonoLocalBinds #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- Module      : Data.Massiv.Array.Manifest.Internal</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- Copyright   : (c) Alexey Kuleshevich 2018-2022</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- License     : BSD3</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- Maintainer  : Alexey Kuleshevich &lt;lehins@yandex.ru&gt;</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- Stability   : experimental</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- Portability : non-portable</span><span>
</span><span id="line-19"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.Massiv.Array.Manifest.Internal</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier">Manifest</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier">Array</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Mutable.html#flattenMArray"><span class="hs-identifier">flattenMArray</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#compute"><span class="hs-identifier">compute</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeS"><span class="hs-identifier">computeS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeP"><span class="hs-identifier">computeP</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeIO"><span class="hs-identifier">computeIO</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computePrimM"><span class="hs-identifier">computePrimM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeAs"><span class="hs-identifier">computeAs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeProxy"><span class="hs-identifier">computeProxy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeSource"><span class="hs-identifier">computeSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeWithStride"><span class="hs-identifier">computeWithStride</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeWithStrideAs"><span class="hs-identifier">computeWithStrideAs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#clone"><span class="hs-identifier">clone</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#convert"><span class="hs-identifier">convert</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#convertAs"><span class="hs-identifier">convertAs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#convertProxy"><span class="hs-identifier">convertProxy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#gcastArr"><span class="hs-identifier">gcastArr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#fromRaggedArrayM"><span class="hs-identifier">fromRaggedArrayM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#fromRaggedArray%27"><span class="hs-identifier">fromRaggedArray'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#unsafeLoadIntoS"><span class="hs-identifier">unsafeLoadIntoS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#unsafeLoadIntoM"><span class="hs-identifier">unsafeLoadIntoM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#iterateUntil"><span class="hs-identifier">iterateUntil</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#iterateUntilM"><span class="hs-identifier">iterateUntilM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">try</span></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Primitive</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.ST</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Scheduler</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Delayed.Pull.html"><span class="hs-identifier">Data.Massiv.Array.Delayed.Pull</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Mutable.html"><span class="hs-identifier">Data.Massiv.Array.Mutable</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Mutable.Internal.html"><span class="hs-identifier">Data.Massiv.Array.Mutable.Internal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Array.Mutable.Internal.html#unsafeCreateArray_"><span class="hs-identifier">unsafeCreateArray_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html"><span class="hs-identifier">Data.Massiv.Core.Common</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Massiv.Core.List.html"><span class="hs-identifier">Data.Massiv.Core.List</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Typeable</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Unsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafePerformIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">-- | Ensure that Array is computed, i.e. represented with concrete elements in memory, hence is the</span><span>
</span><span id="line-61"></span><span class="hs-comment">-- `Mutable` type class restriction. Use `setComp` if you'd like to change computation strategy</span><span>
</span><span id="line-62"></span><span class="hs-comment">-- before calling @compute@</span><span>
</span><span id="line-63"></span><span class="hs-comment">--</span><span>
</span><span id="line-64"></span><span class="hs-comment">-- @since 0.1.0</span><span>
</span><span id="line-65"></span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#compute"><span class="hs-identifier hs-type">compute</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679268435"><span class="annot"><a href="#local-6989586621679268435"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679268439"><span class="annot"><a href="#local-6989586621679268439"><span class="hs-identifier hs-type">ix</span></a></span></span><span> </span><span id="local-6989586621679268436"><span class="annot"><a href="#local-6989586621679268436"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621679268438"><span class="annot"><a href="#local-6989586621679268438"><span class="hs-identifier hs-type">r'</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268435"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268436"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Load"><span class="hs-identifier hs-type">Load</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268438"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268439"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268436"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268438"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268439"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268436"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268435"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268439"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268436"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-66"></span><span id="compute"><span class="annot"><span class="annottext">compute :: forall r ix e r'.
(Manifest r e, Load r' ix e) =&gt;
Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#compute"><span class="hs-identifier hs-var hs-var">compute</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679268805"><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679268805"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Array r ix e) -&gt; Array r ix e
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Array r ix e) -&gt; Array r ix e)
-&gt; IO (Array r ix e) -&gt; Array r ix e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Array r' ix e -&gt; IO (Array r ix e)
forall r ix e r' (m :: * -&gt; *).
(Manifest r e, Load r' ix e, MonadIO m) =&gt;
Array r' ix e -&gt; m (Array r ix e)
</span><a href="Data.Massiv.Array.Manifest.Internal.html#computeIO"><span class="hs-identifier hs-var">computeIO</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679268805"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-67"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#compute"><span class="hs-pragma hs-type">compute</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-comment">-- | Compute array sequentially disregarding predefined computation strategy. Very much</span><span>
</span><span id="line-70"></span><span class="hs-comment">-- the same as `computePrimM`, but executed in `ST`, thus pure.</span><span>
</span><span id="line-71"></span><span class="hs-comment">--</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- @since 0.1.0</span><span>
</span><span id="line-73"></span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeS"><span class="hs-identifier hs-type">computeS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679268806"><span class="annot"><a href="#local-6989586621679268806"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679268807"><span class="annot"><a href="#local-6989586621679268807"><span class="hs-identifier hs-type">ix</span></a></span></span><span> </span><span id="local-6989586621679268808"><span class="annot"><a href="#local-6989586621679268808"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621679268809"><span class="annot"><a href="#local-6989586621679268809"><span class="hs-identifier hs-type">r'</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268806"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268808"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Load"><span class="hs-identifier hs-type">Load</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268809"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268807"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268808"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268809"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268807"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268808"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268806"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268807"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268808"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-74"></span><span id="computeS"><span class="annot"><span class="annottext">computeS :: forall r ix e r'.
(Manifest r e, Load r' ix e) =&gt;
Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#computeS"><span class="hs-identifier hs-var hs-var">computeS</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679268812"><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679268812"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall s. ST s (Array r ix e)) -&gt; Array r ix e
forall a. (forall s. ST s a) -&gt; a
</span><span class="hs-identifier hs-var">runST</span></span><span> </span><span class="annot"><span class="annottext">((forall s. ST s (Array r ix e)) -&gt; Array r ix e)
-&gt; (forall s. ST s (Array r ix e)) -&gt; Array r ix e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Array r' ix e -&gt; ST s (Array r ix e)
forall r ix e r' (m :: * -&gt; *).
(Manifest r e, Load r' ix e, PrimMonad m) =&gt;
Array r' ix e -&gt; m (Array r ix e)
</span><a href="Data.Massiv.Array.Manifest.Internal.html#computePrimM"><span class="hs-identifier hs-var">computePrimM</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679268812"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-75"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeS"><span class="hs-pragma hs-type">computeS</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-comment">-- | Compute array in parallel using all cores disregarding predefined computation</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- strategy. Computation stategy of the resulting array will match the source, despite</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- that it is diregarded.</span><span>
</span><span id="line-80"></span><span class="hs-comment">--</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- @since 0.5.4</span><span>
</span><span id="line-82"></span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeP"><span class="hs-identifier hs-type">computeP</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679268818"><span class="annot"><a href="#local-6989586621679268818"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679268819"><span class="annot"><a href="#local-6989586621679268819"><span class="hs-identifier hs-type">ix</span></a></span></span><span> </span><span id="local-6989586621679268820"><span class="annot"><a href="#local-6989586621679268820"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621679268821"><span class="annot"><a href="#local-6989586621679268821"><span class="hs-identifier hs-type">r'</span></a></span></span><span>
</span><span id="line-84"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268818"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268820"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Load"><span class="hs-identifier hs-type">Load</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268821"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268819"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268820"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268821"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268819"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268820"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268818"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268819"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268820"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-87"></span><span id="computeP"><span class="annot"><span class="annottext">computeP :: forall r ix e r'.
(Manifest r e, Load r' ix e) =&gt;
Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#computeP"><span class="hs-identifier hs-var hs-var">computeP</span></a></span></span><span> </span><span id="local-6989586621679268835"><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679268835"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Comp -&gt; Array r ix e -&gt; Array r ix e
forall r ix e. Strategy r =&gt; Comp -&gt; Array r ix e -&gt; Array r ix e
forall ix e. Comp -&gt; Array r ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Core.Common.html#setComp"><span class="hs-identifier hs-var">setComp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array r' ix e -&gt; Comp
forall r ix e. Strategy r =&gt; Array r ix e -&gt; Comp
forall ix e. Array r' ix e -&gt; Comp
</span><a href="Data.Massiv.Core.Common.html#getComp"><span class="hs-identifier hs-var">getComp</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679268835"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Array r ix e -&gt; Array r ix e) -&gt; Array r ix e -&gt; Array r ix e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Array r' ix e -&gt; Array r ix e
forall r ix e r'.
(Manifest r e, Load r' ix e) =&gt;
Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#compute"><span class="hs-identifier hs-var">compute</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Comp -&gt; Array r' ix e -&gt; Array r' ix e
forall r ix e. Strategy r =&gt; Comp -&gt; Array r ix e -&gt; Array r ix e
forall ix e. Comp -&gt; Array r' ix e -&gt; Array r' ix e
</span><a href="Data.Massiv.Core.Common.html#setComp"><span class="hs-identifier hs-var">setComp</span></a></span><span> </span><span class="annot"><span class="annottext">Comp
</span><span class="hs-identifier hs-var">Par</span></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679268835"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeP"><span class="hs-pragma hs-type">computeP</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">-- | Very similar to `compute`, but computes an array inside the `IO` monad. Despite being</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- deterministic and referentially transparent, because this is an `IO` action it</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- can be very useful for enforcing the order of evaluation. Should be a prefered way of</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- computing an array during benchmarking.</span><span>
</span><span id="line-94"></span><span class="hs-comment">--</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- @since 0.4.5</span><span>
</span><span id="line-96"></span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeIO"><span class="hs-identifier hs-type">computeIO</span></a></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679268451"><span class="annot"><a href="#local-6989586621679268451"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679268454"><span class="annot"><a href="#local-6989586621679268454"><span class="hs-identifier hs-type">ix</span></a></span></span><span> </span><span id="local-6989586621679268452"><span class="annot"><a href="#local-6989586621679268452"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621679268453"><span class="annot"><a href="#local-6989586621679268453"><span class="hs-identifier hs-type">r'</span></a></span></span><span> </span><span id="local-6989586621679268455"><span class="annot"><a href="#local-6989586621679268455"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-98"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268451"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268452"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Load"><span class="hs-identifier hs-type">Load</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268453"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268454"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268452"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679268455"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268453"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268454"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268452"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679268455"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268451"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268454"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268452"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span id="computeIO"><span class="annot"><span class="annottext">computeIO :: forall r ix e r' (m :: * -&gt; *).
(Manifest r e, Load r' ix e, MonadIO m) =&gt;
Array r' ix e -&gt; m (Array r ix e)
</span><a href="Data.Massiv.Array.Manifest.Internal.html#computeIO"><span class="hs-identifier hs-var hs-var">computeIO</span></a></span></span><span> </span><span id="local-6989586621679268857"><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679268857"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Array r ix e) -&gt; m (Array r ix e)
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array r' ix e -&gt; IO (MArray RealWorld r ix e)
forall r ix e r' (m :: * -&gt; *).
(Load r' ix e, Manifest r e, MonadIO m) =&gt;
Array r' ix e -&gt; m (MArray RealWorld r ix e)
</span><a href="Data.Massiv.Array.Mutable.html#loadArray"><span class="hs-identifier hs-var">loadArray</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679268857"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="annot"><span class="annottext">IO (MArray RealWorld r ix e)
-&gt; (MArray RealWorld r ix e -&gt; IO (Array r ix e))
-&gt; IO (Array r ix e)
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Comp -&gt; MArray (PrimState IO) r ix e -&gt; IO (Array r ix e)
forall r e ix (m :: * -&gt; *).
(Manifest r e, Index ix, PrimMonad m) =&gt;
Comp -&gt; MArray (PrimState m) r ix e -&gt; m (Array r ix e)
forall ix (m :: * -&gt; *).
(Index ix, PrimMonad m) =&gt;
Comp -&gt; MArray (PrimState m) r ix e -&gt; m (Array r ix e)
</span><a href="Data.Massiv.Core.Common.html#unsafeFreeze"><span class="hs-identifier hs-var">unsafeFreeze</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array r' ix e -&gt; Comp
forall r ix e. Strategy r =&gt; Array r ix e -&gt; Comp
forall ix e. Array r' ix e -&gt; Comp
</span><a href="Data.Massiv.Core.Common.html#getComp"><span class="hs-identifier hs-var">getComp</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679268857"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeIO"><span class="hs-pragma hs-type">computeIO</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-comment">-- | Compute an array in `PrimMonad` sequentially disregarding predefined computation</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- strategy.</span><span>
</span><span id="line-106"></span><span class="hs-comment">--</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- @since 0.4.5</span><span>
</span><span id="line-108"></span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computePrimM"><span class="hs-identifier hs-type">computePrimM</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679268466"><span class="annot"><a href="#local-6989586621679268466"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679268469"><span class="annot"><a href="#local-6989586621679268469"><span class="hs-identifier hs-type">ix</span></a></span></span><span> </span><span id="local-6989586621679268467"><span class="annot"><a href="#local-6989586621679268467"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621679268468"><span class="annot"><a href="#local-6989586621679268468"><span class="hs-identifier hs-type">r'</span></a></span></span><span> </span><span id="local-6989586621679268470"><span class="annot"><a href="#local-6989586621679268470"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-110"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268466"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268467"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Load"><span class="hs-identifier hs-type">Load</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268468"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268469"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268467"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PrimMonad</span></span><span> </span><span class="annot"><a href="#local-6989586621679268470"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268468"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268469"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268467"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679268470"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268466"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268469"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268467"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span id="computePrimM"><span class="annot"><span class="annottext">computePrimM :: forall r ix e r' (m :: * -&gt; *).
(Manifest r e, Load r' ix e, PrimMonad m) =&gt;
Array r' ix e -&gt; m (Array r ix e)
</span><a href="Data.Massiv.Array.Manifest.Internal.html#computePrimM"><span class="hs-identifier hs-var hs-var">computePrimM</span></a></span></span><span> </span><span id="local-6989586621679268877"><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679268877"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array r' ix e -&gt; m (MArray (PrimState m) r ix e)
forall r ix e r' (m :: * -&gt; *).
(Load r' ix e, Manifest r e, PrimMonad m) =&gt;
Array r' ix e -&gt; m (MArray (PrimState m) r ix e)
</span><a href="Data.Massiv.Array.Mutable.html#loadArrayS"><span class="hs-identifier hs-var">loadArrayS</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679268877"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="annot"><span class="annottext">m (MArray (PrimState m) r ix e)
-&gt; (MArray (PrimState m) r ix e -&gt; m (Array r ix e))
-&gt; m (Array r ix e)
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Comp -&gt; MArray (PrimState m) r ix e -&gt; m (Array r ix e)
forall r e ix (m :: * -&gt; *).
(Manifest r e, Index ix, PrimMonad m) =&gt;
Comp -&gt; MArray (PrimState m) r ix e -&gt; m (Array r ix e)
forall ix (m :: * -&gt; *).
(Index ix, PrimMonad m) =&gt;
Comp -&gt; MArray (PrimState m) r ix e -&gt; m (Array r ix e)
</span><a href="Data.Massiv.Core.Common.html#unsafeFreeze"><span class="hs-identifier hs-var">unsafeFreeze</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array r' ix e -&gt; Comp
forall r ix e. Strategy r =&gt; Array r ix e -&gt; Comp
forall ix e. Array r' ix e -&gt; Comp
</span><a href="Data.Massiv.Core.Common.html#getComp"><span class="hs-identifier hs-var">getComp</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679268877"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computePrimM"><span class="hs-pragma hs-type">computePrimM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">-- | Just as `compute`, but let's you supply resulting representation type as an argument.</span><span>
</span><span id="line-117"></span><span class="hs-comment">--</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- ====__Examples__</span><span>
</span><span id="line-119"></span><span class="hs-comment">--</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.Massiv.Array</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- &gt;&gt;&gt; computeAs P $ range Seq (Ix1 0) 10</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- Array P Seq (Sz1 10)</span><span>
</span><span id="line-123"></span><span class="hs-comment">--   [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9 ]</span><span>
</span><span id="line-124"></span><span id="local-6989586621679268524"><span id="local-6989586621679268525"><span id="local-6989586621679268526"><span id="local-6989586621679268527"><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeAs"><span class="hs-identifier hs-type">computeAs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268524"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268525"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Load"><span class="hs-identifier hs-type">Load</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268526"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268527"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268525"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679268524"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268526"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268527"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268525"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268524"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268527"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268525"><span class="hs-identifier hs-type">e</span></a></span></span></span></span></span><span>
</span><span id="line-125"></span><span id="computeAs"><span class="annot"><span class="annottext">computeAs :: forall r e r' ix.
(Manifest r e, Load r' ix e) =&gt;
r -&gt; Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#computeAs"><span class="hs-identifier hs-var hs-var">computeAs</span></a></span></span><span> </span><span class="annot"><span class="annottext">r
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array r' ix e -&gt; Array r ix e
forall r ix e r'.
(Manifest r e, Load r' ix e) =&gt;
Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#compute"><span class="hs-identifier hs-var">compute</span></a></span><span>
</span><span id="line-126"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeAs"><span class="hs-pragma hs-type">computeAs</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-comment">-- | Same as `compute` and `computeAs`, but let's you supply resulting representation type as a proxy</span><span>
</span><span id="line-129"></span><span class="hs-comment">-- argument.</span><span>
</span><span id="line-130"></span><span class="hs-comment">--</span><span>
</span><span id="line-131"></span><span class="hs-comment">-- ==== __Examples__</span><span>
</span><span id="line-132"></span><span class="hs-comment">--</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- Useful only really for cases when representation constructor or @TypeApplications@ extension</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- aren't desireable for some reason:</span><span>
</span><span id="line-135"></span><span class="hs-comment">--</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.Proxy</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.Massiv.Array</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- &gt;&gt;&gt; computeProxy (Proxy :: Proxy P) $ (^ (2 :: Int)) &lt;$&gt; range Seq (Ix1 0) 10</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- Array P Seq (Sz1 10)</span><span>
</span><span id="line-140"></span><span class="hs-comment">--   [ 0, 1, 4, 9, 16, 25, 36, 49, 64, 81 ]</span><span>
</span><span id="line-141"></span><span class="hs-comment">--</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- @since 0.1.1</span><span>
</span><span id="line-143"></span><span id="local-6989586621679268532"><span id="local-6989586621679268533"><span id="local-6989586621679268534"><span id="local-6989586621679268535"><span id="local-6989586621679268536"><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeProxy"><span class="hs-identifier hs-type">computeProxy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268532"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268533"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Load"><span class="hs-identifier hs-type">Load</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268534"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268535"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268533"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679268536"><span class="hs-identifier hs-type">proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268532"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268534"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268535"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268533"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268532"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268535"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268533"><span class="hs-identifier hs-type">e</span></a></span></span></span></span></span></span><span>
</span><span id="line-144"></span><span id="computeProxy"><span class="annot"><span class="annottext">computeProxy :: forall r e r' ix (proxy :: * -&gt; *).
(Manifest r e, Load r' ix e) =&gt;
proxy r -&gt; Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#computeProxy"><span class="hs-identifier hs-var hs-var">computeProxy</span></a></span></span><span> </span><span class="annot"><span class="annottext">proxy r
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array r' ix e -&gt; Array r ix e
forall r ix e r'.
(Manifest r e, Load r' ix e) =&gt;
Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#compute"><span class="hs-identifier hs-var">compute</span></a></span><span>
</span><span id="line-145"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeProxy"><span class="hs-pragma hs-type">computeProxy</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-comment">-- | This is just like `convert`, but restricted to `Source` arrays. Will be a noop if</span><span>
</span><span id="line-148"></span><span class="hs-comment">-- resulting type is the same as the input.</span><span>
</span><span id="line-149"></span><span class="hs-comment">--</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- @since 0.1.0</span><span>
</span><span id="line-151"></span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeSource"><span class="hs-identifier hs-type">computeSource</span></a></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679268542"><span class="annot"><a href="#local-6989586621679268542"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679268545"><span class="annot"><a href="#local-6989586621679268545"><span class="hs-identifier hs-type">ix</span></a></span></span><span> </span><span id="local-6989586621679268543"><span class="annot"><a href="#local-6989586621679268543"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621679268544"><span class="annot"><a href="#local-6989586621679268544"><span class="hs-identifier hs-type">r'</span></a></span></span><span>
</span><span id="line-153"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268542"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268543"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268544"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268543"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268545"><span class="hs-identifier hs-type">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268544"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268545"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268543"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268542"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268545"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268543"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-156"></span><span id="computeSource"><span class="annot"><span class="annottext">computeSource :: forall r ix e r'.
(Manifest r e, Source r' e, Index ix) =&gt;
Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#computeSource"><span class="hs-identifier hs-var hs-var">computeSource</span></a></span></span><span> </span><span id="local-6989586621679268903"><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679268903"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array r ix e
-&gt; ((r' :~: r) -&gt; Array r ix e) -&gt; Maybe (r' :~: r) -&gt; Array r ix e
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array D ix e -&gt; Array r ix e
forall r ix e r'.
(Manifest r e, Load r' ix e) =&gt;
Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#compute"><span class="hs-identifier hs-var">compute</span></a></span><span> </span><span class="annot"><span class="annottext">(Array D ix e -&gt; Array r ix e) -&gt; Array D ix e -&gt; Array r ix e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Array r' ix e -&gt; Array D ix e
forall ix r e.
(Index ix, Source r e) =&gt;
Array r ix e -&gt; Array D ix e
</span><a href="Data.Massiv.Array.Delayed.Pull.html#delay"><span class="hs-identifier hs-var">delay</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679268903"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">r' :~: r
</span><span class="hs-identifier hs-var">Refl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Array r ix e
Array r' ix e
</span><a href="#local-6989586621679268903"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (r' :~: r)
forall {k} (a :: k) (b :: k).
(Typeable a, Typeable b) =&gt;
Maybe (a :~: b)
</span><span class="hs-identifier hs-var">eqT</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679268544"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:~:</span></span><span> </span><span class="annot"><a href="#local-6989586621679268542"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeSource"><span class="hs-pragma hs-type">computeSource</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-comment">-- | /O(n)/ - Make an exact immutable copy of an Array.</span><span>
</span><span id="line-160"></span><span class="hs-comment">--</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- @since 0.1.0</span><span>
</span><span id="line-162"></span><span id="local-6989586621679268562"><span id="local-6989586621679268563"><span id="local-6989586621679268564"><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#clone"><span class="hs-identifier hs-type">clone</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268562"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268563"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268564"><span class="hs-identifier hs-type">ix</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268562"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268564"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268563"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268562"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268564"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268563"><span class="hs-identifier hs-type">e</span></a></span></span></span></span><span>
</span><span id="line-163"></span><span id="clone"><span class="annot"><span class="annottext">clone :: forall r e ix.
(Manifest r e, Index ix) =&gt;
Array r ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#clone"><span class="hs-identifier hs-var hs-var">clone</span></a></span></span><span> </span><span id="local-6989586621679268921"><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679268921"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Array r ix e) -&gt; Array r ix e
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Array r ix e) -&gt; Array r ix e)
-&gt; IO (Array r ix e) -&gt; Array r ix e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Array r ix e -&gt; IO (MArray RealWorld r ix e)
forall r ix e (m :: * -&gt; *).
(Manifest r e, Index ix, MonadIO m) =&gt;
Array r ix e -&gt; m (MArray RealWorld r ix e)
</span><a href="Data.Massiv.Array.Mutable.html#thaw"><span class="hs-identifier hs-var">thaw</span></a></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679268921"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="annot"><span class="annottext">IO (MArray RealWorld r ix e)
-&gt; (MArray RealWorld r ix e -&gt; IO (Array r ix e))
-&gt; IO (Array r ix e)
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Comp -&gt; MArray (PrimState IO) r ix e -&gt; IO (Array r ix e)
forall r e ix (m :: * -&gt; *).
(Manifest r e, Index ix, PrimMonad m) =&gt;
Comp -&gt; MArray (PrimState m) r ix e -&gt; m (Array r ix e)
forall ix (m :: * -&gt; *).
(Index ix, PrimMonad m) =&gt;
Comp -&gt; MArray (PrimState m) r ix e -&gt; m (Array r ix e)
</span><a href="Data.Massiv.Core.Common.html#unsafeFreeze"><span class="hs-identifier hs-var">unsafeFreeze</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array r ix e -&gt; Comp
forall r ix e. Strategy r =&gt; Array r ix e -&gt; Comp
forall ix e. Array r ix e -&gt; Comp
</span><a href="Data.Massiv.Core.Common.html#getComp"><span class="hs-identifier hs-var">getComp</span></a></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679268921"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#clone"><span class="hs-pragma hs-type">clone</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="annot"><span class="hs-comment">-- | /O(1)/ - Cast over Array representation</span></span><span>
</span><span id="line-167"></span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#gcastArr"><span class="hs-identifier hs-type">gcastArr</span></a></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679268572"><span class="annot"><a href="#local-6989586621679268572"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679268574"><span class="annot"><a href="#local-6989586621679268574"><span class="hs-identifier hs-type">ix</span></a></span></span><span> </span><span id="local-6989586621679268575"><span class="annot"><a href="#local-6989586621679268575"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621679268573"><span class="annot"><a href="#local-6989586621679268573"><span class="hs-identifier hs-type">r'</span></a></span></span><span>
</span><span id="line-169"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span> </span><span class="annot"><a href="#local-6989586621679268572"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span> </span><span class="annot"><a href="#local-6989586621679268573"><span class="hs-identifier hs-type">r'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268573"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268574"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268575"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268572"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268574"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268575"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span id="gcastArr"><span class="annot"><span class="annottext">gcastArr :: forall r ix e r'.
(Typeable r, Typeable r') =&gt;
Array r' ix e -&gt; Maybe (Array r ix e)
</span><a href="Data.Massiv.Array.Manifest.Internal.html#gcastArr"><span class="hs-identifier hs-var hs-var">gcastArr</span></a></span></span><span> </span><span id="local-6989586621679268929"><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679268929"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((r :~: r') -&gt; Array r ix e)
-&gt; Maybe (r :~: r') -&gt; Maybe (Array r ix e)
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">r :~: r'
</span><span class="hs-identifier hs-var">Refl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Array r ix e
Array r' ix e
</span><a href="#local-6989586621679268929"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (r :~: r')
forall {k} (a :: k) (b :: k).
(Typeable a, Typeable b) =&gt;
Maybe (a :~: b)
</span><span class="hs-identifier hs-var">eqT</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679268572"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:~:</span></span><span> </span><span class="annot"><a href="#local-6989586621679268573"><span class="hs-identifier hs-type">r'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-comment">-- | /O(n)/ - conversion between array types. A full copy will occur, unless when the source and</span><span>
</span><span id="line-175"></span><span class="hs-comment">-- result arrays are of the same representation, in which case it is an /O(1)/ operation.</span><span>
</span><span id="line-176"></span><span class="hs-comment">--</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- @since 0.1.0</span><span>
</span><span id="line-178"></span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#convert"><span class="hs-identifier hs-type">convert</span></a></span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679268931"><span class="annot"><a href="#local-6989586621679268931"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679268932"><span class="annot"><a href="#local-6989586621679268932"><span class="hs-identifier hs-type">ix</span></a></span></span><span> </span><span id="local-6989586621679268933"><span class="annot"><a href="#local-6989586621679268933"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621679268934"><span class="annot"><a href="#local-6989586621679268934"><span class="hs-identifier hs-type">r'</span></a></span></span><span>
</span><span id="line-180"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268931"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268933"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Load"><span class="hs-identifier hs-type">Load</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268934"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268932"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268933"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268934"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268932"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268933"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-182"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268931"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268932"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268933"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-183"></span><span id="convert"><span class="annot"><span class="annottext">convert :: forall r ix e r'.
(Manifest r e, Load r' ix e) =&gt;
Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#convert"><span class="hs-identifier hs-var hs-var">convert</span></a></span></span><span> </span><span id="local-6989586621679268946"><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679268946"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array r ix e -&gt; Maybe (Array r ix e) -&gt; Array r ix e
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array r' ix e -&gt; Array r ix e
forall r ix e r'.
(Manifest r e, Load r' ix e) =&gt;
Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#compute"><span class="hs-identifier hs-var">compute</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679268946"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array r' ix e -&gt; Maybe (Array r ix e)
forall r ix e r'.
(Typeable r, Typeable r') =&gt;
Array r' ix e -&gt; Maybe (Array r ix e)
</span><a href="Data.Massiv.Array.Manifest.Internal.html#gcastArr"><span class="hs-identifier hs-var">gcastArr</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679268946"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#convert"><span class="hs-pragma hs-type">convert</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-comment">-- | Same as `convert`, but let's you supply resulting representation type as an argument.</span><span>
</span><span id="line-187"></span><span class="hs-comment">--</span><span>
</span><span id="line-188"></span><span class="hs-comment">-- @since 0.1.0</span><span>
</span><span id="line-189"></span><span id="local-6989586621679268947"><span id="local-6989586621679268948"><span id="local-6989586621679268949"><span id="local-6989586621679268950"><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#convertAs"><span class="hs-identifier hs-type">convertAs</span></a></span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268947"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268948"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Load"><span class="hs-identifier hs-type">Load</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268949"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268950"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268948"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679268947"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268949"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268950"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268948"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268947"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268950"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268948"><span class="hs-identifier hs-type">e</span></a></span></span></span></span></span><span>
</span><span id="line-194"></span><span id="convertAs"><span class="annot"><span class="annottext">convertAs :: forall r e r' ix.
(Manifest r e, Load r' ix e) =&gt;
r -&gt; Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#convertAs"><span class="hs-identifier hs-var hs-var">convertAs</span></a></span></span><span> </span><span class="annot"><span class="annottext">r
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array r' ix e -&gt; Array r ix e
forall r ix e r'.
(Manifest r e, Load r' ix e) =&gt;
Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#convert"><span class="hs-identifier hs-var">convert</span></a></span><span>
</span><span id="line-195"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#convertAs"><span class="hs-pragma hs-type">convertAs</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="hs-comment">-- | Same as `convert` and `convertAs`, but let's you supply resulting representation type as a</span><span>
</span><span id="line-198"></span><span class="hs-comment">-- proxy argument.</span><span>
</span><span id="line-199"></span><span class="hs-comment">--</span><span>
</span><span id="line-200"></span><span class="hs-comment">-- @since 0.1.1</span><span>
</span><span id="line-201"></span><span id="local-6989586621679268955"><span id="local-6989586621679268956"><span id="local-6989586621679268957"><span id="local-6989586621679268958"><span id="local-6989586621679268959"><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#convertProxy"><span class="hs-identifier hs-type">convertProxy</span></a></span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268955"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268956"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Load"><span class="hs-identifier hs-type">Load</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268957"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268958"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268956"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679268959"><span class="hs-identifier hs-type">proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268955"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268957"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268958"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268956"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268955"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268958"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268956"><span class="hs-identifier hs-type">e</span></a></span></span></span></span></span></span><span>
</span><span id="line-206"></span><span id="convertProxy"><span class="annot"><span class="annottext">convertProxy :: forall r e r' ix (proxy :: * -&gt; *).
(Manifest r e, Load r' ix e) =&gt;
proxy r -&gt; Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#convertProxy"><span class="hs-identifier hs-var hs-var">convertProxy</span></a></span></span><span> </span><span class="annot"><span class="annottext">proxy r
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array r' ix e -&gt; Array r ix e
forall r ix e r'.
(Manifest r e, Load r' ix e) =&gt;
Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#convert"><span class="hs-identifier hs-var">convert</span></a></span><span>
</span><span id="line-207"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#convertProxy"><span class="hs-pragma hs-type">convertProxy</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="hs-comment">-- | Convert a ragged array into a common array with rectangular shape. Throws `ShapeException`</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- whenever supplied ragged array does not have a rectangular shape.</span><span>
</span><span id="line-211"></span><span class="hs-comment">--</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- @since 0.4.0</span><span>
</span><span id="line-213"></span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#fromRaggedArrayM"><span class="hs-identifier hs-type">fromRaggedArrayM</span></a></span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679268597"><span class="annot"><a href="#local-6989586621679268597"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679268600"><span class="annot"><a href="#local-6989586621679268600"><span class="hs-identifier hs-type">ix</span></a></span></span><span> </span><span id="local-6989586621679268598"><span class="annot"><a href="#local-6989586621679268598"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621679268599"><span class="annot"><a href="#local-6989586621679268599"><span class="hs-identifier hs-type">r'</span></a></span></span><span> </span><span id="local-6989586621679268602"><span class="annot"><a href="#local-6989586621679268602"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-215"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268597"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268598"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Ragged"><span class="hs-identifier hs-type">Ragged</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268599"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268600"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268598"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679268602"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268599"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268600"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268598"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679268602"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268597"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268600"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268598"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span id="fromRaggedArrayM"><span class="annot"><span class="annottext">fromRaggedArrayM :: forall r ix e r' (m :: * -&gt; *).
(Manifest r e, Ragged r' ix e, MonadThrow m) =&gt;
Array r' ix e -&gt; m (Array r ix e)
</span><a href="Data.Massiv.Array.Manifest.Internal.html#fromRaggedArrayM"><span class="hs-identifier hs-var hs-var">fromRaggedArrayM</span></a></span></span><span> </span><span id="local-6989586621679269003"><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679269003"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679269004"><span class="annot"><span class="annottext">sz :: Sz ix
</span><a href="#local-6989586621679269004"><span class="hs-identifier hs-var hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array r' ix e -&gt; Sz ix
forall e. Array r' ix e -&gt; Sz ix
forall r ix e. Shape r ix =&gt; Array r ix e -&gt; Sz ix
</span><a href="Data.Massiv.Core.Common.html#outerSize"><span class="hs-identifier hs-var">outerSize</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679269003"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-220"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(ShapeException -&gt; m (Array r ix e))
-&gt; (Array r ix e -&gt; m (Array r ix e))
-&gt; Either ShapeException (Array r ix e)
-&gt; m (Array r ix e)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679269007"><span class="annot"><span class="annottext">ShapeException
</span><a href="#local-6989586621679269007"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#ShapeException"><span class="hs-identifier hs-type">ShapeException</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShapeException -&gt; m (Array r ix e)
forall e a. (HasCallStack, Exception e) =&gt; e -&gt; m a
forall (m :: * -&gt; *) e a.
(MonadThrow m, HasCallStack, Exception e) =&gt;
e -&gt; m a
</span><span class="hs-identifier hs-var">throwM</span></span><span> </span><span class="annot"><span class="annottext">ShapeException
</span><a href="#local-6989586621679269007"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Array r ix e -&gt; m (Array r ix e)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either ShapeException (Array r ix e) -&gt; m (Array r ix e))
-&gt; Either ShapeException (Array r ix e) -&gt; m (Array r ix e)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-221"></span><span>        </span><span class="annot"><span class="annottext">IO (Either ShapeException (Array r ix e))
-&gt; Either ShapeException (Array r ix e)
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either ShapeException (Array r ix e))
 -&gt; Either ShapeException (Array r ix e))
-&gt; IO (Either ShapeException (Array r ix e))
-&gt; Either ShapeException (Array r ix e)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-222"></span><span>          </span><span id="local-6989586621679269009"><span class="annot"><span class="annottext">MArray RealWorld r ix e
</span><a href="#local-6989586621679269009"><span class="hs-identifier hs-var">marr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Sz ix -&gt; IO (MArray (PrimState IO) r ix e)
forall r e ix (m :: * -&gt; *).
(Manifest r e, Index ix, PrimMonad m) =&gt;
Sz ix -&gt; m (MArray (PrimState m) r ix e)
forall ix (m :: * -&gt; *).
(Index ix, PrimMonad m) =&gt;
Sz ix -&gt; m (MArray (PrimState m) r ix e)
</span><a href="Data.Massiv.Core.Common.html#unsafeNew"><span class="hs-identifier hs-var">unsafeNew</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679269004"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-223"></span><span>          </span><span class="annot"><span class="annottext">(() -&gt; IO (Array r ix e))
-&gt; Either ShapeException ()
-&gt; IO (Either ShapeException (Array r ix e))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b)
-&gt; Either ShapeException a -&gt; f (Either ShapeException b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Comp -&gt; MArray (PrimState IO) r ix e -&gt; IO (Array r ix e)
forall r e ix (m :: * -&gt; *).
(Manifest r e, Index ix, PrimMonad m) =&gt;
Comp -&gt; MArray (PrimState m) r ix e -&gt; m (Array r ix e)
forall ix (m :: * -&gt; *).
(Index ix, PrimMonad m) =&gt;
Comp -&gt; MArray (PrimState m) r ix e -&gt; m (Array r ix e)
</span><a href="Data.Massiv.Core.Common.html#unsafeFreeze"><span class="hs-identifier hs-var">unsafeFreeze</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array r' ix e -&gt; Comp
forall r ix e. Strategy r =&gt; Array r ix e -&gt; Comp
forall ix e. Array r' ix e -&gt; Comp
</span><a href="Data.Massiv.Core.Common.html#getComp"><span class="hs-identifier hs-var">getComp</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679269003"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MArray RealWorld r ix e
MArray (PrimState IO) r ix e
</span><a href="#local-6989586621679269009"><span class="hs-identifier hs-var">marr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>            </span><span class="annot"><span class="annottext">(Either ShapeException ()
 -&gt; IO (Either ShapeException (Array r ix e)))
-&gt; IO (Either ShapeException ())
-&gt; IO (Either ShapeException (Array r ix e))
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO (Either ShapeException ())
forall e a. Exception e =&gt; IO a -&gt; IO (Either e a)
</span><span class="hs-identifier hs-var">try</span></span><span>
</span><span id="line-225"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Comp -&gt; (Scheduler RealWorld () -&gt; IO ()) -&gt; IO ()
</span><a href="Data.Massiv.Core.Loop.html#withMassivScheduler_"><span class="hs-identifier hs-var">withMassivScheduler_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array r' ix e -&gt; Comp
forall r ix e. Strategy r =&gt; Array r ix e -&gt; Comp
forall ix e. Array r' ix e -&gt; Comp
</span><a href="Data.Massiv.Core.Common.html#getComp"><span class="hs-identifier hs-var">getComp</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679269003"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Scheduler RealWorld () -&gt; IO ()) -&gt; IO ())
-&gt; (Scheduler RealWorld () -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679269014"><span class="annot"><span class="annottext">Scheduler RealWorld ()
</span><a href="#local-6989586621679269014"><span class="hs-identifier hs-var">scheduler</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-226"></span><span>                  </span><span class="annot"><span class="annottext">ST RealWorld () -&gt; IO ()
forall a. ST RealWorld a -&gt; IO a
</span><span class="hs-identifier hs-var">stToIO</span></span><span> </span><span class="annot"><span class="annottext">(ST RealWorld () -&gt; IO ()) -&gt; ST RealWorld () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Scheduler RealWorld ()
-&gt; Array r' ix e
-&gt; (Ix1 -&gt; e -&gt; ST RealWorld ())
-&gt; Ix1
-&gt; Ix1
-&gt; Sz ix
-&gt; ST RealWorld ()
forall s.
Scheduler s ()
-&gt; Array r' ix e
-&gt; (Ix1 -&gt; e -&gt; ST s ())
-&gt; Ix1
-&gt; Ix1
-&gt; Sz ix
-&gt; ST s ()
forall r ix e s.
Ragged r ix e =&gt;
Scheduler s ()
-&gt; Array r ix e
-&gt; (Ix1 -&gt; e -&gt; ST s ())
-&gt; Ix1
-&gt; Ix1
-&gt; Sz ix
-&gt; ST s ()
</span><a href="Data.Massiv.Core.Common.html#loadRaggedST"><span class="hs-identifier hs-var">loadRaggedST</span></a></span><span> </span><span class="annot"><span class="annottext">Scheduler RealWorld ()
</span><a href="#local-6989586621679269014"><span class="hs-identifier hs-var">scheduler</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679269003"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MArray (PrimState (ST RealWorld)) r ix e
-&gt; Ix1 -&gt; e -&gt; ST RealWorld ()
forall r e ix (m :: * -&gt; *).
(Manifest r e, Index ix, PrimMonad m) =&gt;
MArray (PrimState m) r ix e -&gt; Ix1 -&gt; e -&gt; m ()
forall ix (m :: * -&gt; *).
(Index ix, PrimMonad m) =&gt;
MArray (PrimState m) r ix e -&gt; Ix1 -&gt; e -&gt; m ()
</span><a href="Data.Massiv.Core.Common.html#unsafeLinearWrite"><span class="hs-identifier hs-var">unsafeLinearWrite</span></a></span><span> </span><span class="annot"><span class="annottext">MArray RealWorld r ix e
MArray (PrimState (ST RealWorld)) r ix e
</span><a href="#local-6989586621679269009"><span class="hs-identifier hs-var">marr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ix1
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sz ix -&gt; Ix1
forall ix. Index ix =&gt; Sz ix -&gt; Ix1
</span><a href="Data.Massiv.Core.Index.Internal.html#totalElem"><span class="hs-identifier hs-var">totalElem</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679269004"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679269004"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-227"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#fromRaggedArrayM"><span class="hs-pragma hs-type">fromRaggedArrayM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="hs-comment">-- | Same as `fromRaggedArrayM`, but will throw an impure exception if its shape is not</span><span>
</span><span id="line-231"></span><span class="hs-comment">-- rectangular.</span><span>
</span><span id="line-232"></span><span class="hs-comment">--</span><span>
</span><span id="line-233"></span><span class="hs-comment">-- @since 0.1.1</span><span>
</span><span id="line-234"></span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#fromRaggedArray%27"><span class="hs-identifier hs-type">fromRaggedArray'</span></a></span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679268644"><span class="annot"><a href="#local-6989586621679268644"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679268647"><span class="annot"><a href="#local-6989586621679268647"><span class="hs-identifier hs-type">ix</span></a></span></span><span> </span><span id="local-6989586621679268645"><span class="annot"><a href="#local-6989586621679268645"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621679268646"><span class="annot"><a href="#local-6989586621679268646"><span class="hs-identifier hs-type">r'</span></a></span></span><span>
</span><span id="line-236"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268644"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268645"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Ragged"><span class="hs-identifier hs-type">Ragged</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268646"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268647"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268645"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268646"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268647"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268645"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268644"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268647"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268645"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-239"></span><span id="fromRaggedArray%27"><span class="annot"><span class="annottext">fromRaggedArray' :: forall r ix e r'.
(HasCallStack, Manifest r e, Ragged r' ix e) =&gt;
Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#fromRaggedArray%27"><span class="hs-identifier hs-var hs-var">fromRaggedArray'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either SomeException (Array r ix e) -&gt; Array r ix e
forall a. HasCallStack =&gt; Either SomeException a -&gt; a
</span><a href="Data.Massiv.Core.Exception.html#throwEither"><span class="hs-identifier hs-var">throwEither</span></a></span><span> </span><span class="annot"><span class="annottext">(Either SomeException (Array r ix e) -&gt; Array r ix e)
-&gt; (Array r' ix e -&gt; Either SomeException (Array r ix e))
-&gt; Array r' ix e
-&gt; Array r ix e
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Array r' ix e -&gt; Either SomeException (Array r ix e)
forall r ix e r' (m :: * -&gt; *).
(Manifest r e, Ragged r' ix e, MonadThrow m) =&gt;
Array r' ix e -&gt; m (Array r ix e)
</span><a href="Data.Massiv.Array.Manifest.Internal.html#fromRaggedArrayM"><span class="hs-identifier hs-var">fromRaggedArrayM</span></a></span><span>
</span><span id="line-240"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#fromRaggedArray%27"><span class="hs-pragma hs-type">fromRaggedArray'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="hs-comment">-- | Same as `compute`, but with `Stride`.</span><span>
</span><span id="line-243"></span><span class="hs-comment">--</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- /O(n div k)/ - Where @n@ is number of elements in the source array and @k@ is number of</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- elements in the stride.</span><span>
</span><span id="line-246"></span><span class="hs-comment">--</span><span>
</span><span id="line-247"></span><span class="hs-comment">-- @since 0.3.0</span><span>
</span><span id="line-248"></span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeWithStride"><span class="hs-identifier hs-type">computeWithStride</span></a></span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679268661"><span class="annot"><a href="#local-6989586621679268661"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679268664"><span class="annot"><a href="#local-6989586621679268664"><span class="hs-identifier hs-type">ix</span></a></span></span><span> </span><span id="local-6989586621679268662"><span class="annot"><a href="#local-6989586621679268662"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621679268663"><span class="annot"><a href="#local-6989586621679268663"><span class="hs-identifier hs-type">r'</span></a></span></span><span>
</span><span id="line-250"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268661"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268662"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#StrideLoad"><span class="hs-identifier hs-type">StrideLoad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268663"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268664"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268662"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Stride.html#Stride"><span class="hs-identifier hs-type">Stride</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268664"><span class="hs-identifier hs-type">ix</span></a></span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268663"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268664"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268662"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268661"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268664"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268662"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-254"></span><span id="computeWithStride"><span class="annot"><span class="annottext">computeWithStride :: forall r ix e r'.
(Manifest r e, StrideLoad r' ix e) =&gt;
Stride ix -&gt; Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#computeWithStride"><span class="hs-identifier hs-var hs-var">computeWithStride</span></a></span></span><span> </span><span id="local-6989586621679269050"><span class="annot"><span class="annottext">Stride ix
</span><a href="#local-6989586621679269050"><span class="hs-identifier hs-var">stride</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679269051"><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679269051"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-255"></span><span>  </span><span class="annot"><span class="annottext">IO (Array r ix e) -&gt; Array r ix e
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Array r ix e) -&gt; Array r ix e)
-&gt; IO (Array r ix e) -&gt; Array r ix e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679269052"><span class="annot"><span class="annottext">sz :: Sz ix
</span><a href="#local-6989586621679269052"><span class="hs-identifier hs-var hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stride ix -&gt; Sz ix -&gt; Sz ix
forall ix. Index ix =&gt; Stride ix -&gt; Sz ix -&gt; Sz ix
</span><a href="Data.Massiv.Core.Index.Stride.html#strideSize"><span class="hs-identifier hs-var">strideSize</span></a></span><span> </span><span class="annot"><span class="annottext">Stride ix
</span><a href="#local-6989586621679269050"><span class="hs-identifier hs-var">stride</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array r' ix e -&gt; Sz ix
forall e. Array r' ix e -&gt; Sz ix
forall r ix e. Shape r ix =&gt; Array r ix e -&gt; Sz ix
</span><a href="Data.Massiv.Core.Common.html#outerSize"><span class="hs-identifier hs-var">outerSize</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679269051"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><span class="annottext">Comp
-&gt; Sz ix
-&gt; (Scheduler RealWorld () -&gt; MArray RealWorld r ix e -&gt; IO ())
-&gt; IO (Array r ix e)
forall r ix e a (m :: * -&gt; *) b.
(Manifest r e, Index ix, MonadUnliftIO m) =&gt;
Comp
-&gt; Sz ix
-&gt; (Scheduler RealWorld a -&gt; MArray RealWorld r ix e -&gt; m b)
-&gt; m (Array r ix e)
</span><a href="Data.Massiv.Array.Mutable.Internal.html#unsafeCreateArray_"><span class="hs-identifier hs-var">unsafeCreateArray_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array r' ix e -&gt; Comp
forall r ix e. Strategy r =&gt; Array r ix e -&gt; Comp
forall ix e. Array r' ix e -&gt; Comp
</span><a href="Data.Massiv.Core.Common.html#getComp"><span class="hs-identifier hs-var">getComp</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679269051"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679269052"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">((Scheduler RealWorld () -&gt; MArray RealWorld r ix e -&gt; IO ())
 -&gt; IO (Array r ix e))
-&gt; (Scheduler RealWorld () -&gt; MArray RealWorld r ix e -&gt; IO ())
-&gt; IO (Array r ix e)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679269054"><span class="annot"><span class="annottext">Scheduler RealWorld ()
</span><a href="#local-6989586621679269054"><span class="hs-identifier hs-var">scheduler</span></a></span></span><span> </span><span id="local-6989586621679269055"><span class="annot"><span class="annottext">MArray RealWorld r ix e
</span><a href="#local-6989586621679269055"><span class="hs-identifier hs-var">marr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-258"></span><span>      </span><span class="annot"><span class="annottext">ST RealWorld () -&gt; IO ()
forall a. ST RealWorld a -&gt; IO a
</span><span class="hs-identifier hs-var">stToIO</span></span><span> </span><span class="annot"><span class="annottext">(ST RealWorld () -&gt; IO ()) -&gt; ST RealWorld () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Scheduler RealWorld ()
-&gt; Stride ix
-&gt; Sz ix
-&gt; Array r' ix e
-&gt; (Ix1 -&gt; e -&gt; ST RealWorld ())
-&gt; ST RealWorld ()
forall s.
Scheduler s ()
-&gt; Stride ix
-&gt; Sz ix
-&gt; Array r' ix e
-&gt; (Ix1 -&gt; e -&gt; ST s ())
-&gt; ST s ()
forall r ix e s.
StrideLoad r ix e =&gt;
Scheduler s ()
-&gt; Stride ix
-&gt; Sz ix
-&gt; Array r ix e
-&gt; (Ix1 -&gt; e -&gt; ST s ())
-&gt; ST s ()
</span><a href="Data.Massiv.Core.Common.html#iterArrayLinearWithStrideST_"><span class="hs-identifier hs-var">iterArrayLinearWithStrideST_</span></a></span><span> </span><span class="annot"><span class="annottext">Scheduler RealWorld ()
</span><a href="#local-6989586621679269054"><span class="hs-identifier hs-var">scheduler</span></a></span><span> </span><span class="annot"><span class="annottext">Stride ix
</span><a href="#local-6989586621679269050"><span class="hs-identifier hs-var">stride</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679269052"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679269051"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MArray (PrimState (ST RealWorld)) r ix e
-&gt; Ix1 -&gt; e -&gt; ST RealWorld ()
forall r e ix (m :: * -&gt; *).
(Manifest r e, Index ix, PrimMonad m) =&gt;
MArray (PrimState m) r ix e -&gt; Ix1 -&gt; e -&gt; m ()
forall ix (m :: * -&gt; *).
(Index ix, PrimMonad m) =&gt;
MArray (PrimState m) r ix e -&gt; Ix1 -&gt; e -&gt; m ()
</span><a href="Data.Massiv.Core.Common.html#unsafeLinearWrite"><span class="hs-identifier hs-var">unsafeLinearWrite</span></a></span><span> </span><span class="annot"><span class="annottext">MArray RealWorld r ix e
MArray (PrimState (ST RealWorld)) r ix e
</span><a href="#local-6989586621679269055"><span class="hs-identifier hs-var">marr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeWithStride"><span class="hs-pragma hs-type">computeWithStride</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="hs-comment">-- | Same as `computeWithStride`, but with ability to specify resulting array representation.</span><span>
</span><span id="line-262"></span><span class="hs-comment">--</span><span>
</span><span id="line-263"></span><span class="hs-comment">-- @since 0.3.0</span><span>
</span><span id="line-264"></span><span id="local-6989586621679268683"><span id="local-6989586621679268684"><span id="local-6989586621679268685"><span id="local-6989586621679268686"><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeWithStrideAs"><span class="hs-identifier hs-type">computeWithStrideAs</span></a></span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268683"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268684"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#StrideLoad"><span class="hs-identifier hs-type">StrideLoad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268685"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268686"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268684"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679268683"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Stride.html#Stride"><span class="hs-identifier hs-type">Stride</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268686"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268685"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268686"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268684"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268683"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268686"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268684"><span class="hs-identifier hs-type">e</span></a></span></span></span></span></span><span>
</span><span id="line-266"></span><span id="computeWithStrideAs"><span class="annot"><span class="annottext">computeWithStrideAs :: forall r e r' ix.
(Manifest r e, StrideLoad r' ix e) =&gt;
r -&gt; Stride ix -&gt; Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#computeWithStrideAs"><span class="hs-identifier hs-var hs-var">computeWithStrideAs</span></a></span></span><span> </span><span class="annot"><span class="annottext">r
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stride ix -&gt; Array r' ix e -&gt; Array r ix e
forall r ix e r'.
(Manifest r e, StrideLoad r' ix e) =&gt;
Stride ix -&gt; Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#computeWithStride"><span class="hs-identifier hs-var">computeWithStride</span></a></span><span>
</span><span id="line-267"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#computeWithStrideAs"><span class="hs-pragma hs-type">computeWithStrideAs</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="hs-comment">-- | Load into a supplied mutable vector sequentially. Returned array is not</span><span>
</span><span id="line-270"></span><span class="hs-comment">-- necesserally the same vector as the one that was supplied. It will be the</span><span>
</span><span id="line-271"></span><span class="hs-comment">-- same only if it had enough space to load all the elements in.</span><span>
</span><span id="line-272"></span><span class="hs-comment">--</span><span>
</span><span id="line-273"></span><span class="hs-comment">-- @since 0.5.7</span><span>
</span><span id="line-274"></span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#unsafeLoadIntoS"><span class="hs-identifier hs-type">unsafeLoadIntoS</span></a></span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679268691"><span class="annot"><a href="#local-6989586621679268691"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679268694"><span class="annot"><a href="#local-6989586621679268694"><span class="hs-identifier hs-type">r'</span></a></span></span><span> </span><span id="local-6989586621679268692"><span class="annot"><a href="#local-6989586621679268692"><span class="hs-identifier hs-type">ix</span></a></span></span><span> </span><span id="local-6989586621679268693"><span class="annot"><a href="#local-6989586621679268693"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621679268696"><span class="annot"><a href="#local-6989586621679268696"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679268695"><span class="annot"><a href="#local-6989586621679268695"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-276"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Load"><span class="hs-identifier hs-type">Load</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268691"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268692"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268693"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268694"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268693"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadPrim</span></span><span> </span><span class="annot"><a href="#local-6989586621679268695"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268696"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#MVector"><span class="hs-identifier hs-type">MVector</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268695"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268694"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268693"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268691"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268692"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268693"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679268696"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#MArray"><span class="hs-identifier hs-type">MArray</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268695"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268694"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268692"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268693"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span id="unsafeLoadIntoS"><span class="annot"><span class="annottext">unsafeLoadIntoS :: forall r r' ix e (m :: * -&gt; *) s.
(Load r ix e, Manifest r' e, MonadPrim s m) =&gt;
MVector s r' e -&gt; Array r ix e -&gt; m (MArray s r' ix e)
</span><a href="Data.Massiv.Array.Manifest.Internal.html#unsafeLoadIntoS"><span class="hs-identifier hs-var hs-var">unsafeLoadIntoS</span></a></span></span><span> </span><span id="local-6989586621679269078"><span class="annot"><span class="annottext">MVector s r' e
</span><a href="#local-6989586621679269078"><span class="hs-identifier hs-var">marr</span></a></span></span><span> </span><span id="local-6989586621679269079"><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269079"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ST (PrimState m) (MArray s r' ix e) -&gt; m (MArray s r' ix e)
forall (m :: * -&gt; *) a. PrimMonad m =&gt; ST (PrimState m) a -&gt; m a
</span><span class="hs-identifier hs-var">stToPrim</span></span><span> </span><span class="annot"><span class="annottext">(ST (PrimState m) (MArray s r' ix e) -&gt; m (MArray s r' ix e))
-&gt; ST (PrimState m) (MArray s r' ix e) -&gt; m (MArray s r' ix e)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MVector s r' e -&gt; Array r ix e -&gt; ST s (MArray s r' ix e)
forall r r' ix e (m :: * -&gt; *) s.
(Load r ix e, Manifest r' e, MonadPrim s m) =&gt;
MVector s r' e -&gt; Array r ix e -&gt; m (MArray s r' ix e)
</span><a href="Data.Massiv.Array.Manifest.Internal.html#unsafeLoadIntoS"><span class="hs-identifier hs-var">unsafeLoadIntoS</span></a></span><span> </span><span class="annot"><span class="annottext">MVector s r' e
</span><a href="#local-6989586621679269078"><span class="hs-identifier hs-var">marr</span></a></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269079"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-281"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#unsafeLoadIntoS"><span class="hs-pragma hs-type">unsafeLoadIntoS</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="hs-comment">-- | Same as `unsafeLoadIntoS`, but respecting computation strategy.</span><span>
</span><span id="line-284"></span><span class="hs-comment">--</span><span>
</span><span id="line-285"></span><span class="hs-comment">-- @since 0.5.7</span><span>
</span><span id="line-286"></span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#unsafeLoadIntoM"><span class="hs-identifier hs-type">unsafeLoadIntoM</span></a></span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679268711"><span class="annot"><a href="#local-6989586621679268711"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679268714"><span class="annot"><a href="#local-6989586621679268714"><span class="hs-identifier hs-type">r'</span></a></span></span><span> </span><span id="local-6989586621679268712"><span class="annot"><a href="#local-6989586621679268712"><span class="hs-identifier hs-type">ix</span></a></span></span><span> </span><span id="local-6989586621679268713"><span class="annot"><a href="#local-6989586621679268713"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621679268715"><span class="annot"><a href="#local-6989586621679268715"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-288"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Load"><span class="hs-identifier hs-type">Load</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268711"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268712"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268713"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268714"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268713"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679268715"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#MVector"><span class="hs-identifier hs-type">MVector</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="annot"><a href="#local-6989586621679268714"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268713"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268711"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268712"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268713"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679268715"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#MArray"><span class="hs-identifier hs-type">MArray</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="annot"><a href="#local-6989586621679268714"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268712"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268713"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span id="unsafeLoadIntoM"><span class="annot"><span class="annottext">unsafeLoadIntoM :: forall r r' ix e (m :: * -&gt; *).
(Load r ix e, Manifest r' e, MonadIO m) =&gt;
MVector RealWorld r' e
-&gt; Array r ix e -&gt; m (MArray RealWorld r' ix e)
</span><a href="Data.Massiv.Array.Manifest.Internal.html#unsafeLoadIntoM"><span class="hs-identifier hs-var hs-var">unsafeLoadIntoM</span></a></span></span><span> </span><span id="local-6989586621679269087"><span class="annot"><span class="annottext">MVector RealWorld r' e
</span><a href="#local-6989586621679269087"><span class="hs-identifier hs-var">marr</span></a></span></span><span> </span><span id="local-6989586621679269088"><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269088"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (MArray RealWorld r' ix e) -&gt; m (MArray RealWorld r' ix e)
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (MArray RealWorld r' ix e) -&gt; m (MArray RealWorld r' ix e))
-&gt; IO (MArray RealWorld r' ix e) -&gt; m (MArray RealWorld r' ix e)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MVector RealWorld r' e
-&gt; Array r ix e -&gt; IO (MArray RealWorld r' ix e)
forall r'.
Manifest r' e =&gt;
MVector RealWorld r' e
-&gt; Array r ix e -&gt; IO (MArray RealWorld r' ix e)
forall r ix e r'.
(Load r ix e, Manifest r' e) =&gt;
MVector RealWorld r' e
-&gt; Array r ix e -&gt; IO (MArray RealWorld r' ix e)
</span><a href="Data.Massiv.Core.Common.html#unsafeLoadIntoIO"><span class="hs-identifier hs-var">unsafeLoadIntoIO</span></a></span><span> </span><span class="annot"><span class="annottext">MVector RealWorld r' e
</span><a href="#local-6989586621679269087"><span class="hs-identifier hs-var">marr</span></a></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269088"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-293"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#unsafeLoadIntoM"><span class="hs-pragma hs-type">unsafeLoadIntoM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-comment">-- | Efficiently iterate a function until a convergence condition is satisfied. If the</span><span>
</span><span id="line-296"></span><span class="hs-comment">-- size of array doesn't change between iterations then no more than two new arrays will be</span><span>
</span><span id="line-297"></span><span class="hs-comment">-- allocated, regardless of the number of iterations. If the size does change from one</span><span>
</span><span id="line-298"></span><span class="hs-comment">-- iteration to another, an attempt will be made to grow/shrink the intermediate mutable</span><span>
</span><span id="line-299"></span><span class="hs-comment">-- array instead of allocating a new one.</span><span>
</span><span id="line-300"></span><span class="hs-comment">--</span><span>
</span><span id="line-301"></span><span class="hs-comment">-- ====__Example__</span><span>
</span><span id="line-302"></span><span class="hs-comment">--</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.Massiv.Array</span><span>
</span><span id="line-304"></span><span class="hs-comment">-- &gt;&gt;&gt; let arr = computeAs P $ makeLoadArrayS (Sz2 8 8) (0 :: Int) $ \ w -&gt; () &lt;$ w (0 :. 0) 1</span><span>
</span><span id="line-305"></span><span class="hs-comment">-- &gt;&gt;&gt; arr</span><span>
</span><span id="line-306"></span><span class="hs-comment">-- Array P Seq (Sz (8 :. 8))</span><span>
</span><span id="line-307"></span><span class="hs-comment">--   [ [ 1, 0, 0, 0, 0, 0, 0, 0 ]</span><span>
</span><span id="line-308"></span><span class="hs-comment">--   , [ 0, 0, 0, 0, 0, 0, 0, 0 ]</span><span>
</span><span id="line-309"></span><span class="hs-comment">--   , [ 0, 0, 0, 0, 0, 0, 0, 0 ]</span><span>
</span><span id="line-310"></span><span class="hs-comment">--   , [ 0, 0, 0, 0, 0, 0, 0, 0 ]</span><span>
</span><span id="line-311"></span><span class="hs-comment">--   , [ 0, 0, 0, 0, 0, 0, 0, 0 ]</span><span>
</span><span id="line-312"></span><span class="hs-comment">--   , [ 0, 0, 0, 0, 0, 0, 0, 0 ]</span><span>
</span><span id="line-313"></span><span class="hs-comment">--   , [ 0, 0, 0, 0, 0, 0, 0, 0 ]</span><span>
</span><span id="line-314"></span><span class="hs-comment">--   , [ 0, 0, 0, 0, 0, 0, 0, 0 ]</span><span>
</span><span id="line-315"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-316"></span><span class="hs-comment">-- &gt;&gt;&gt; let nextPascalRow cur above = if cur == 0 then above else cur</span><span>
</span><span id="line-317"></span><span class="hs-comment">-- &gt;&gt;&gt; let pascal = makeStencil (Sz2 2 2) 1 $ \ get -&gt; nextPascalRow (get (0 :. 0)) (get (-1 :. -1) + get (-1 :. 0))</span><span>
</span><span id="line-318"></span><span class="hs-comment">-- &gt;&gt;&gt; iterateUntil (\_ _ a -&gt; (a ! (7 :. 7)) /= 0) (\ _ -&gt; mapStencil (Fill 0) pascal) arr</span><span>
</span><span id="line-319"></span><span class="hs-comment">-- Array P Seq (Sz (8 :. 8))</span><span>
</span><span id="line-320"></span><span class="hs-comment">--   [ [ 1, 0, 0, 0, 0, 0, 0, 0 ]</span><span>
</span><span id="line-321"></span><span class="hs-comment">--   , [ 1, 1, 0, 0, 0, 0, 0, 0 ]</span><span>
</span><span id="line-322"></span><span class="hs-comment">--   , [ 1, 2, 1, 0, 0, 0, 0, 0 ]</span><span>
</span><span id="line-323"></span><span class="hs-comment">--   , [ 1, 3, 3, 1, 0, 0, 0, 0 ]</span><span>
</span><span id="line-324"></span><span class="hs-comment">--   , [ 1, 4, 6, 4, 1, 0, 0, 0 ]</span><span>
</span><span id="line-325"></span><span class="hs-comment">--   , [ 1, 5, 10, 10, 5, 1, 0, 0 ]</span><span>
</span><span id="line-326"></span><span class="hs-comment">--   , [ 1, 6, 15, 20, 15, 6, 1, 0 ]</span><span>
</span><span id="line-327"></span><span class="hs-comment">--   , [ 1, 7, 21, 35, 35, 21, 7, 1 ]</span><span>
</span><span id="line-328"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-329"></span><span class="hs-comment">--</span><span>
</span><span id="line-330"></span><span class="hs-comment">-- @since 0.3.6</span><span>
</span><span id="line-331"></span><span id="local-6989586621679268722"><span id="local-6989586621679268723"><span id="local-6989586621679268724"><span id="local-6989586621679268725"><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#iterateUntil"><span class="hs-identifier hs-type">iterateUntil</span></a></span><span>
</span><span id="line-332"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Load"><span class="hs-identifier hs-type">Load</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268722"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268723"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268724"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268725"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268724"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268725"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268723"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268724"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268725"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268723"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268724"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268725"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268723"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268724"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-comment">-- ^ Convergence condition. Accepts current iteration counter, array at the previous</span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-comment">-- state and at the current state.</span><span>
</span><span id="line-336"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268725"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268723"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268724"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268722"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268723"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268724"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>  </span><span class="hs-comment">-- ^ A modifying function to apply at each iteration. The size of resulting array may</span><span>
</span><span id="line-338"></span><span>  </span><span class="hs-comment">-- differ if necessary</span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268725"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268723"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268724"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-340"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Initial source array</span></span><span>
</span><span id="line-341"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268725"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268723"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268724"><span class="hs-identifier hs-type">e</span></a></span></span></span></span></span><span>
</span><span id="line-342"></span><span id="iterateUntil"><span class="annot"><span class="annottext">iterateUntil :: forall r' ix e r.
(Load r' ix e, Manifest r e, NFData (Array r ix e)) =&gt;
(Ix1 -&gt; Array r ix e -&gt; Array r ix e -&gt; Bool)
-&gt; (Ix1 -&gt; Array r ix e -&gt; Array r' ix e)
-&gt; Array r ix e
-&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#iterateUntil"><span class="hs-identifier hs-var hs-var">iterateUntil</span></a></span></span><span> </span><span id="local-6989586621679269112"><span class="annot"><span class="annottext">Ix1 -&gt; Array r ix e -&gt; Array r ix e -&gt; Bool
</span><a href="#local-6989586621679269112"><span class="hs-identifier hs-var">convergence</span></a></span></span><span> </span><span id="local-6989586621679269113"><span class="annot"><span class="annottext">Ix1 -&gt; Array r ix e -&gt; Array r' ix e
</span><a href="#local-6989586621679269113"><span class="hs-identifier hs-var">iteration</span></a></span></span><span> </span><span id="local-6989586621679269114"><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269114"><span class="hs-identifier hs-var">initArr0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Array r ix e) -&gt; Array r ix e
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Array r ix e) -&gt; Array r ix e)
-&gt; IO (Array r ix e) -&gt; Array r ix e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679269115"><span class="annot"><span class="annottext">loadArr0 :: Array r' ix e
</span><a href="#local-6989586621679269115"><span class="hs-identifier hs-var hs-var">loadArr0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ix1 -&gt; Array r ix e -&gt; Array r' ix e
</span><a href="#local-6989586621679269113"><span class="hs-identifier hs-var">iteration</span></a></span><span> </span><span class="annot"><span class="annottext">Ix1
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269114"><span class="hs-identifier hs-var">initArr0</span></a></span><span>
</span><span id="line-344"></span><span>  </span><span id="local-6989586621679269116"><span class="annot"><span class="annottext">MVector RealWorld r e
</span><a href="#local-6989586621679269116"><span class="hs-identifier hs-var">initMVec1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Sz Ix1 -&gt; IO (MArray (PrimState IO) r Ix1 e)
forall r e ix (m :: * -&gt; *).
(Manifest r e, Index ix, PrimMonad m) =&gt;
Sz ix -&gt; m (MArray (PrimState m) r ix e)
forall ix (m :: * -&gt; *).
(Index ix, PrimMonad m) =&gt;
Sz ix -&gt; m (MArray (PrimState m) r ix e)
</span><a href="Data.Massiv.Core.Common.html#unsafeNew"><span class="hs-identifier hs-var">unsafeNew</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sz Ix1 -&gt; Maybe (Sz Ix1) -&gt; Sz Ix1
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Sz Ix1
forall ix. Index ix =&gt; Sz ix
</span><a href="Data.Massiv.Core.Index.Internal.html#zeroSz"><span class="hs-identifier hs-var">zeroSz</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array r' ix e -&gt; Maybe (Sz Ix1)
forall e. Array r' ix e -&gt; Maybe (Sz Ix1)
forall r ix e. Shape r ix =&gt; Array r ix e -&gt; Maybe (Sz Ix1)
</span><a href="Data.Massiv.Core.Common.html#maxLinearSize"><span class="hs-identifier hs-var">maxLinearSize</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679269115"><span class="hs-identifier hs-var">loadArr0</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679269119"><span class="annot"><span class="annottext">conv :: Ix1
-&gt; Array r ix e
-&gt; Comp
-&gt; MArray RealWorld r ix e
-&gt; IO (Bool, Array r ix e)
</span><a href="#local-6989586621679269119"><span class="hs-identifier hs-var hs-var">conv</span></a></span></span><span> </span><span id="local-6989586621679269120"><span class="annot"><span class="annottext">Ix1
</span><a href="#local-6989586621679269120"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679269121"><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269121"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span id="local-6989586621679269122"><span class="annot"><span class="annottext">Comp
</span><a href="#local-6989586621679269122"><span class="hs-identifier hs-var">comp</span></a></span></span><span> </span><span id="local-6989586621679269123"><span class="annot"><span class="annottext">MArray RealWorld r ix e
</span><a href="#local-6989586621679269123"><span class="hs-identifier hs-var">marr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-346"></span><span>        </span><span id="local-6989586621679269124"><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269124"><span class="hs-identifier hs-var">arr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Comp -&gt; MArray (PrimState IO) r ix e -&gt; IO (Array r ix e)
forall r e ix (m :: * -&gt; *).
(Manifest r e, Index ix, PrimMonad m) =&gt;
Comp -&gt; MArray (PrimState m) r ix e -&gt; m (Array r ix e)
forall ix (m :: * -&gt; *).
(Index ix, PrimMonad m) =&gt;
Comp -&gt; MArray (PrimState m) r ix e -&gt; m (Array r ix e)
</span><a href="Data.Massiv.Core.Common.html#unsafeFreeze"><span class="hs-identifier hs-var">unsafeFreeze</span></a></span><span> </span><span class="annot"><span class="annottext">Comp
</span><a href="#local-6989586621679269122"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="annot"><span class="annottext">MArray RealWorld r ix e
MArray (PrimState IO) r ix e
</span><a href="#local-6989586621679269123"><span class="hs-identifier hs-var">marr'</span></a></span><span>
</span><span id="line-347"></span><span>        </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269124"><span class="hs-identifier hs-var">arr'</span></a></span><span> </span><span class="annot"><span class="annottext">Array r ix e -&gt; IO (Bool, Array r ix e) -&gt; IO (Bool, Array r ix e)
forall a b. NFData a =&gt; a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`deepseq`</span></span><span> </span><span class="annot"><span class="annottext">(Bool, Array r ix e) -&gt; IO (Bool, Array r ix e)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ix1 -&gt; Array r ix e -&gt; Array r ix e -&gt; Bool
</span><a href="#local-6989586621679269112"><span class="hs-identifier hs-var">convergence</span></a></span><span> </span><span class="annot"><span class="annottext">Ix1
</span><a href="#local-6989586621679269120"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269121"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269124"><span class="hs-identifier hs-var">arr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269124"><span class="hs-identifier hs-var">arr'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>  </span><span class="annot"><span class="annottext">(Ix1
 -&gt; Array r ix e
 -&gt; Comp
 -&gt; MArray RealWorld r ix e
 -&gt; IO (Bool, Array r ix e))
-&gt; (Ix1 -&gt; Array r ix e -&gt; IO (Array r' ix e))
-&gt; Ix1
-&gt; Array r ix e
-&gt; Array r' ix e
-&gt; MVector RealWorld r e
-&gt; IO (Array r ix e)
forall r' ix e r (m :: * -&gt; *).
(Load r' ix e, Manifest r e, MonadIO m) =&gt;
(Ix1
 -&gt; Array r ix e
 -&gt; Comp
 -&gt; MArray RealWorld r ix e
 -&gt; m (Bool, Array r ix e))
-&gt; (Ix1 -&gt; Array r ix e -&gt; m (Array r' ix e))
-&gt; Ix1
-&gt; Array r ix e
-&gt; Array r' ix e
-&gt; MVector RealWorld r e
-&gt; m (Array r ix e)
</span><a href="Data.Massiv.Array.Manifest.Internal.html#iterateLoop"><span class="hs-identifier hs-var">iterateLoop</span></a></span><span> </span><span class="annot"><span class="annottext">Ix1
-&gt; Array r ix e
-&gt; Comp
-&gt; MArray RealWorld r ix e
-&gt; IO (Bool, Array r ix e)
</span><a href="#local-6989586621679269119"><span class="hs-identifier hs-var">conv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679269127"><span class="annot"><span class="annottext">Ix1
</span><a href="#local-6989586621679269127"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Array r' ix e -&gt; IO (Array r' ix e)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Array r' ix e -&gt; IO (Array r' ix e))
-&gt; (Array r ix e -&gt; Array r' ix e)
-&gt; Array r ix e
-&gt; IO (Array r' ix e)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Ix1 -&gt; Array r ix e -&gt; Array r' ix e
</span><a href="#local-6989586621679269113"><span class="hs-identifier hs-var">iteration</span></a></span><span> </span><span class="annot"><span class="annottext">Ix1
</span><a href="#local-6989586621679269127"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ix1
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269114"><span class="hs-identifier hs-var">initArr0</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679269115"><span class="hs-identifier hs-var">loadArr0</span></a></span><span> </span><span class="annot"><span class="annottext">MVector RealWorld r e
</span><a href="#local-6989586621679269116"><span class="hs-identifier hs-var">initMVec1</span></a></span><span>
</span><span id="line-349"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#iterateUntil"><span class="hs-pragma hs-type">iterateUntil</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="hs-comment">-- | Monadic version of `iterateUntil` where at each iteration mutable version</span><span>
</span><span id="line-352"></span><span class="hs-comment">-- of an array is available. However it is less efficient then the pure</span><span>
</span><span id="line-353"></span><span class="hs-comment">-- alternative, because an intermediate array must be copied at each</span><span>
</span><span id="line-354"></span><span class="hs-comment">-- iteration.</span><span>
</span><span id="line-355"></span><span class="hs-comment">--</span><span>
</span><span id="line-356"></span><span class="hs-comment">-- @since 0.3.6</span><span>
</span><span id="line-357"></span><span id="local-6989586621679268740"><span id="local-6989586621679268741"><span id="local-6989586621679268742"><span id="local-6989586621679268743"><span id="local-6989586621679268744"><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#iterateUntilM"><span class="hs-identifier hs-type">iterateUntilM</span></a></span><span>
</span><span id="line-358"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Load"><span class="hs-identifier hs-type">Load</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268740"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268741"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268742"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268743"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268742"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679268744"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268743"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268741"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268742"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#MArray"><span class="hs-identifier hs-type">MArray</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="annot"><a href="#local-6989586621679268743"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268741"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268742"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679268744"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-comment">-- ^ Convergence condition. Accepts current iteration counter, pure array at previous</span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-comment">-- state and a mutable at the current state, therefore after each iteration its contents</span><span>
</span><span id="line-362"></span><span>  </span><span class="hs-comment">-- can be modifed if necessary.</span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268743"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268741"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268742"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679268744"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268740"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268741"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268742"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span>  </span><span class="hs-comment">-- ^ A modifying function to apply at each iteration.  The size of resulting array may</span><span>
</span><span id="line-365"></span><span>  </span><span class="hs-comment">-- differ if necessary.</span><span>
</span><span id="line-366"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268743"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268741"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268742"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-367"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Initial source array</span></span><span>
</span><span id="line-368"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679268744"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268743"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268741"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268742"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-369"></span><span id="iterateUntilM"><span class="annot"><span class="annottext">iterateUntilM :: forall r' ix e r (m :: * -&gt; *).
(Load r' ix e, Manifest r e, MonadIO m) =&gt;
(Ix1 -&gt; Array r ix e -&gt; MArray RealWorld r ix e -&gt; m Bool)
-&gt; (Ix1 -&gt; Array r ix e -&gt; m (Array r' ix e))
-&gt; Array r ix e
-&gt; m (Array r ix e)
</span><a href="Data.Massiv.Array.Manifest.Internal.html#iterateUntilM"><span class="hs-identifier hs-var hs-var">iterateUntilM</span></a></span></span><span> </span><span id="local-6989586621679269154"><span class="annot"><span class="annottext">Ix1 -&gt; Array r ix e -&gt; MArray RealWorld r ix e -&gt; m Bool
</span><a href="#local-6989586621679269154"><span class="hs-identifier hs-var">convergence</span></a></span></span><span> </span><span id="local-6989586621679269155"><span class="annot"><span class="annottext">Ix1 -&gt; Array r ix e -&gt; m (Array r' ix e)
</span><a href="#local-6989586621679269155"><span class="hs-identifier hs-var">iteration</span></a></span></span><span> </span><span id="local-6989586621679269156"><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269156"><span class="hs-identifier hs-var">initArr0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-370"></span><span>  </span><span id="local-6989586621679269157"><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679269157"><span class="hs-identifier hs-var">loadArr0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ix1 -&gt; Array r ix e -&gt; m (Array r' ix e)
</span><a href="#local-6989586621679269155"><span class="hs-identifier hs-var">iteration</span></a></span><span> </span><span class="annot"><span class="annottext">Ix1
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269156"><span class="hs-identifier hs-var">initArr0</span></a></span><span>
</span><span id="line-371"></span><span>  </span><span id="local-6989586621679269158"><span class="annot"><span class="annottext">MVector RealWorld r e
</span><a href="#local-6989586621679269158"><span class="hs-identifier hs-var">initMVec1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVector RealWorld r e) -&gt; m (MVector RealWorld r e)
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (MVector RealWorld r e) -&gt; m (MVector RealWorld r e))
-&gt; IO (MVector RealWorld r e) -&gt; m (MVector RealWorld r e)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Sz Ix1 -&gt; IO (MArray (PrimState IO) r Ix1 e)
forall r e ix (m :: * -&gt; *).
(Manifest r e, Index ix, PrimMonad m) =&gt;
Sz ix -&gt; m (MArray (PrimState m) r ix e)
forall ix (m :: * -&gt; *).
(Index ix, PrimMonad m) =&gt;
Sz ix -&gt; m (MArray (PrimState m) r ix e)
</span><a href="Data.Massiv.Core.Common.html#unsafeNew"><span class="hs-identifier hs-var">unsafeNew</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sz Ix1 -&gt; Maybe (Sz Ix1) -&gt; Sz Ix1
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Sz Ix1
forall ix. Index ix =&gt; Sz ix
</span><a href="Data.Massiv.Core.Index.Internal.html#zeroSz"><span class="hs-identifier hs-var">zeroSz</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array r' ix e -&gt; Maybe (Sz Ix1)
forall e. Array r' ix e -&gt; Maybe (Sz Ix1)
forall r ix e. Shape r ix =&gt; Array r ix e -&gt; Maybe (Sz Ix1)
</span><a href="Data.Massiv.Core.Common.html#maxLinearSize"><span class="hs-identifier hs-var">maxLinearSize</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679269157"><span class="hs-identifier hs-var">loadArr0</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679269159"><span class="annot"><span class="annottext">conv :: Ix1
-&gt; Array r ix e
-&gt; Comp
-&gt; MArray RealWorld r ix e
-&gt; m (Bool, Array r ix e)
</span><a href="#local-6989586621679269159"><span class="hs-identifier hs-var hs-var">conv</span></a></span></span><span> </span><span id="local-6989586621679269160"><span class="annot"><span class="annottext">Ix1
</span><a href="#local-6989586621679269160"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679269161"><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269161"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span id="local-6989586621679269162"><span class="annot"><span class="annottext">Comp
</span><a href="#local-6989586621679269162"><span class="hs-identifier hs-var">comp</span></a></span></span><span> </span><span id="local-6989586621679269163"><span class="annot"><span class="annottext">MArray RealWorld r ix e
</span><a href="#local-6989586621679269163"><span class="hs-identifier hs-var">marr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Array r ix e -&gt; (Bool, Array r ix e))
-&gt; m Bool -&gt; m (Array r ix e -&gt; (Bool, Array r ix e))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Ix1 -&gt; Array r ix e -&gt; MArray RealWorld r ix e -&gt; m Bool
</span><a href="#local-6989586621679269154"><span class="hs-identifier hs-var">convergence</span></a></span><span> </span><span class="annot"><span class="annottext">Ix1
</span><a href="#local-6989586621679269160"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269161"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="annot"><span class="annottext">MArray RealWorld r ix e
</span><a href="#local-6989586621679269163"><span class="hs-identifier hs-var">marr</span></a></span><span> </span><span class="annot"><span class="annottext">m (Array r ix e -&gt; (Bool, Array r ix e))
-&gt; m (Array r ix e) -&gt; m (Bool, Array r ix e)
forall a b. m (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Comp -&gt; MArray RealWorld r ix e -&gt; m (Array r ix e)
forall r ix e (m :: * -&gt; *).
(Manifest r e, Index ix, MonadIO m) =&gt;
Comp -&gt; MArray RealWorld r ix e -&gt; m (Array r ix e)
</span><a href="Data.Massiv.Array.Mutable.html#freeze"><span class="hs-identifier hs-var">freeze</span></a></span><span> </span><span class="annot"><span class="annottext">Comp
</span><a href="#local-6989586621679269162"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="annot"><span class="annottext">MArray RealWorld r ix e
</span><a href="#local-6989586621679269163"><span class="hs-identifier hs-var">marr</span></a></span><span>
</span><span id="line-373"></span><span>  </span><span class="annot"><span class="annottext">(Ix1
 -&gt; Array r ix e
 -&gt; Comp
 -&gt; MArray RealWorld r ix e
 -&gt; m (Bool, Array r ix e))
-&gt; (Ix1 -&gt; Array r ix e -&gt; m (Array r' ix e))
-&gt; Ix1
-&gt; Array r ix e
-&gt; Array r' ix e
-&gt; MVector RealWorld r e
-&gt; m (Array r ix e)
forall r' ix e r (m :: * -&gt; *).
(Load r' ix e, Manifest r e, MonadIO m) =&gt;
(Ix1
 -&gt; Array r ix e
 -&gt; Comp
 -&gt; MArray RealWorld r ix e
 -&gt; m (Bool, Array r ix e))
-&gt; (Ix1 -&gt; Array r ix e -&gt; m (Array r' ix e))
-&gt; Ix1
-&gt; Array r ix e
-&gt; Array r' ix e
-&gt; MVector RealWorld r e
-&gt; m (Array r ix e)
</span><a href="Data.Massiv.Array.Manifest.Internal.html#iterateLoop"><span class="hs-identifier hs-var">iterateLoop</span></a></span><span> </span><span class="annot"><span class="annottext">Ix1
-&gt; Array r ix e
-&gt; Comp
-&gt; MArray RealWorld r ix e
-&gt; m (Bool, Array r ix e)
</span><a href="#local-6989586621679269159"><span class="hs-identifier hs-var">conv</span></a></span><span> </span><span class="annot"><span class="annottext">Ix1 -&gt; Array r ix e -&gt; m (Array r' ix e)
</span><a href="#local-6989586621679269155"><span class="hs-identifier hs-var">iteration</span></a></span><span> </span><span class="annot"><span class="annottext">Ix1
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269156"><span class="hs-identifier hs-var">initArr0</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679269157"><span class="hs-identifier hs-var">loadArr0</span></a></span><span> </span><span class="annot"><span class="annottext">MVector RealWorld r e
</span><a href="#local-6989586621679269158"><span class="hs-identifier hs-var">initMVec1</span></a></span><span>
</span><span id="line-374"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#iterateUntilM"><span class="hs-pragma hs-type">iterateUntilM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span id="local-6989586621679268735"><span id="local-6989586621679268736"><span id="local-6989586621679268737"><span id="local-6989586621679268738"><span id="local-6989586621679268739"><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#iterateLoop"><span class="hs-identifier hs-type">iterateLoop</span></a></span><span>
</span><span id="line-377"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Load"><span class="hs-identifier hs-type">Load</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268735"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268736"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268737"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268738"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268737"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679268739"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268738"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268736"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268737"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Comp</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#MArray"><span class="hs-identifier hs-type">MArray</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="annot"><a href="#local-6989586621679268738"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268736"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268737"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679268739"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268738"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268736"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268737"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268738"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268736"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268737"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679268739"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268735"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268736"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268737"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268738"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268736"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268737"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268735"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268736"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268737"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#MVector"><span class="hs-identifier hs-type">MVector</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="annot"><a href="#local-6989586621679268738"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268737"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-384"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679268739"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268738"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268736"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268737"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-385"></span><span id="iterateLoop"><span class="annot"><span class="annottext">iterateLoop :: forall r' ix e r (m :: * -&gt; *).
(Load r' ix e, Manifest r e, MonadIO m) =&gt;
(Ix1
 -&gt; Array r ix e
 -&gt; Comp
 -&gt; MArray RealWorld r ix e
 -&gt; m (Bool, Array r ix e))
-&gt; (Ix1 -&gt; Array r ix e -&gt; m (Array r' ix e))
-&gt; Ix1
-&gt; Array r ix e
-&gt; Array r' ix e
-&gt; MVector RealWorld r e
-&gt; m (Array r ix e)
</span><a href="Data.Massiv.Array.Manifest.Internal.html#iterateLoop"><span class="hs-identifier hs-var hs-var">iterateLoop</span></a></span></span><span> </span><span id="local-6989586621679269194"><span class="annot"><span class="annottext">Ix1
-&gt; Array r ix e
-&gt; Comp
-&gt; MArray RealWorld r ix e
-&gt; m (Bool, Array r ix e)
</span><a href="#local-6989586621679269194"><span class="hs-identifier hs-var">convergence</span></a></span></span><span> </span><span id="local-6989586621679269195"><span class="annot"><span class="annottext">Ix1 -&gt; Array r ix e -&gt; m (Array r' ix e)
</span><a href="#local-6989586621679269195"><span class="hs-identifier hs-var">iteration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ix1
-&gt; Array r ix e
-&gt; Array r' ix e
-&gt; MVector RealWorld r e
-&gt; m (Array r ix e)
</span><a href="#local-6989586621679269196"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-387"></span><span>    </span><span id="local-6989586621679269196"><span class="annot"><span class="annottext">go :: Ix1
-&gt; Array r ix e
-&gt; Array r' ix e
-&gt; MVector RealWorld r e
-&gt; m (Array r ix e)
</span><a href="#local-6989586621679269196"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679269197"><span class="annot"><span class="annottext">Ix1
</span><a href="#local-6989586621679269197"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679269198"><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269198"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679269199"><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679269199"><span class="hs-identifier hs-var">loadArr</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679269200"><span class="annot"><span class="annottext">MVector RealWorld r e
</span><a href="#local-6989586621679269200"><span class="hs-identifier hs-var">mvec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-388"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679269201"><span class="annot"><span class="annottext">comp :: Comp
</span><a href="#local-6989586621679269201"><span class="hs-identifier hs-var hs-var">comp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array r' ix e -&gt; Comp
forall r ix e. Strategy r =&gt; Array r ix e -&gt; Comp
forall ix e. Array r' ix e -&gt; Comp
</span><a href="Data.Massiv.Core.Common.html#getComp"><span class="hs-identifier hs-var">getComp</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679269199"><span class="hs-identifier hs-var">loadArr</span></a></span><span>
</span><span id="line-389"></span><span>      </span><span id="local-6989586621679269202"><span class="annot"><span class="annottext">MArray RealWorld r ix e
</span><a href="#local-6989586621679269202"><span class="hs-identifier hs-var">marr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVector RealWorld r e
-&gt; Array r' ix e -&gt; m (MArray RealWorld r ix e)
forall r r' ix e (m :: * -&gt; *).
(Load r ix e, Manifest r' e, MonadIO m) =&gt;
MVector RealWorld r' e
-&gt; Array r ix e -&gt; m (MArray RealWorld r' ix e)
</span><a href="Data.Massiv.Array.Manifest.Internal.html#unsafeLoadIntoM"><span class="hs-identifier hs-var">unsafeLoadIntoM</span></a></span><span> </span><span class="annot"><span class="annottext">MVector RealWorld r e
</span><a href="#local-6989586621679269200"><span class="hs-identifier hs-var">mvec</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679269199"><span class="hs-identifier hs-var">loadArr</span></a></span><span>
</span><span id="line-390"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679269203"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679269203"><span class="hs-identifier hs-var">shouldStop</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679269204"><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269204"><span class="hs-identifier hs-var">arr'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ix1
-&gt; Array r ix e
-&gt; Comp
-&gt; MArray RealWorld r ix e
-&gt; m (Bool, Array r ix e)
</span><a href="#local-6989586621679269194"><span class="hs-identifier hs-var">convergence</span></a></span><span> </span><span class="annot"><span class="annottext">Ix1
</span><a href="#local-6989586621679269197"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269198"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="annot"><span class="annottext">Comp
</span><a href="#local-6989586621679269201"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="annot"><span class="annottext">MArray RealWorld r ix e
</span><a href="#local-6989586621679269202"><span class="hs-identifier hs-var">marr'</span></a></span><span>
</span><span id="line-391"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679269203"><span class="hs-identifier hs-var">shouldStop</span></a></span><span>
</span><span id="line-392"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Array r ix e -&gt; m (Array r ix e)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269204"><span class="hs-identifier hs-var">arr'</span></a></span><span>
</span><span id="line-393"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-394"></span><span>          </span><span id="local-6989586621679269205"><span class="annot"><span class="annottext">MArray RealWorld r ix e
</span><a href="#local-6989586621679269205"><span class="hs-identifier hs-var">nextMArr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MArray RealWorld r ix e) -&gt; m (MArray RealWorld r ix e)
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (MArray RealWorld r ix e) -&gt; m (MArray RealWorld r ix e))
-&gt; IO (MArray RealWorld r ix e) -&gt; m (MArray RealWorld r ix e)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Array r ix e -&gt; IO (MArray (PrimState IO) r ix e)
forall r e ix (m :: * -&gt; *).
(Manifest r e, Index ix, PrimMonad m) =&gt;
Array r ix e -&gt; m (MArray (PrimState m) r ix e)
forall ix (m :: * -&gt; *).
(Index ix, PrimMonad m) =&gt;
Array r ix e -&gt; m (MArray (PrimState m) r ix e)
</span><a href="Data.Massiv.Core.Common.html#unsafeThaw"><span class="hs-identifier hs-var">unsafeThaw</span></a></span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269198"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-395"></span><span>          </span><span id="local-6989586621679269207"><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679269207"><span class="hs-identifier hs-var">arr''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ix1 -&gt; Array r ix e -&gt; m (Array r' ix e)
</span><a href="#local-6989586621679269195"><span class="hs-identifier hs-var">iteration</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ix1
</span><a href="#local-6989586621679269197"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Ix1 -&gt; Ix1 -&gt; Ix1
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Ix1
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269204"><span class="hs-identifier hs-var">arr'</span></a></span><span>
</span><span id="line-396"></span><span>          </span><span class="annot"><span class="annottext">Ix1
-&gt; Array r ix e
-&gt; Array r' ix e
-&gt; MVector RealWorld r e
-&gt; m (Array r ix e)
</span><a href="#local-6989586621679269196"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ix1
</span><a href="#local-6989586621679269197"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Ix1 -&gt; Ix1 -&gt; Ix1
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Ix1
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679269204"><span class="hs-identifier hs-var">arr'</span></a></span><span> </span><span class="annot"><span class="annottext">Array r' ix e
</span><a href="#local-6989586621679269207"><span class="hs-identifier hs-var">arr''</span></a></span><span> </span><span class="annot"><span class="annottext">(MVector RealWorld r e -&gt; m (Array r ix e))
-&gt; MVector RealWorld r e -&gt; m (Array r ix e)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MArray RealWorld r ix e -&gt; MVector RealWorld r e
forall r e ix s.
(Manifest r e, Index ix) =&gt;
MArray s r ix e -&gt; MVector s r e
</span><a href="Data.Massiv.Array.Mutable.html#flattenMArray"><span class="hs-identifier hs-var">flattenMArray</span></a></span><span> </span><span class="annot"><span class="annottext">MArray RealWorld r ix e
</span><a href="#local-6989586621679269205"><span class="hs-identifier hs-var">nextMArr</span></a></span><span>
</span><span id="line-397"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html#iterateLoop"><span class="hs-pragma hs-type">iterateLoop</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-398"></span></pre></body></html>