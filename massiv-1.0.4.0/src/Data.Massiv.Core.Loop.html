<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE MonoLocalBinds #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Module      : Data.Massiv.Core.Loop</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Copyright   : (c) Alexey Kuleshevich 2018-2022</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- License     : BSD3</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Maintainer  : Alexey Kuleshevich &lt;lehins@yandex.ru&gt;</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- Stability   : experimental</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- Portability : non-portable</span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.Massiv.Core.Loop</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-14"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#loop"><span class="hs-identifier">loop</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopF"><span class="hs-identifier">loopF</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#nextMaybeF"><span class="hs-identifier">nextMaybeF</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopA"><span class="hs-identifier">loopA</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopA_"><span class="hs-identifier">loopA_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopM"><span class="hs-identifier">loopM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopM_"><span class="hs-identifier">loopM_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#iloopM"><span class="hs-identifier">iloopM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#iloopA_"><span class="hs-identifier">iloopA_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopNextM"><span class="hs-identifier">loopNextM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopNextA_"><span class="hs-identifier">loopNextA_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopDeepM"><span class="hs-identifier">loopDeepM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearly"><span class="hs-identifier">splitLinearly</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearlyM"><span class="hs-identifier">splitLinearlyM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearlyM_"><span class="hs-identifier">splitLinearlyM_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearlyWith_"><span class="hs-identifier">splitLinearlyWith_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearlyWithM_"><span class="hs-identifier">splitLinearlyWithM_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearlyWithStartAtM_"><span class="hs-identifier">splitLinearlyWithStartAtM_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearlyWithStatefulM_"><span class="hs-identifier">splitLinearlyWithStatefulM_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#iterLinearST_"><span class="hs-identifier">iterLinearST_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#iterLinearAccST_"><span class="hs-identifier">iterLinearAccST_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#iterLinearAccST"><span class="hs-identifier">iterLinearAccST</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitNumChunks"><span class="hs-identifier">splitNumChunks</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#stepStartAdjust"><span class="hs-identifier">stepStartAdjust</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Experimental</span></span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitWorkWithFactorST"><span class="hs-identifier">splitWorkWithFactorST</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#scheduleMassivWork"><span class="hs-identifier">scheduleMassivWork</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#withMassivScheduler_"><span class="hs-identifier">withMassivScheduler_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">void</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Unlift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadUnliftIO</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Primitive</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.ST</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ST</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Scheduler</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><span class="hs-identifier">Comp</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><span class="hs-identifier">Scheduler</span></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><span class="hs-identifier">SchedulerWS</span></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><span class="hs-identifier">numWorkers</span></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><span class="hs-identifier">scheduleWork</span></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><span class="hs-identifier">scheduleWorkState_</span></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><span class="hs-identifier">scheduleWork_</span></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><span class="hs-identifier">trivialScheduler_</span></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><span class="hs-identifier">unwrapSchedulerWS</span></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><span class="hs-identifier">withScheduler_</span></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Scheduler.Global</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">globalScheduler</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">withGlobalScheduler_</span></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Coerce</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Functor.Identity</span></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-comment">-- | Efficient loop with an accumulator</span><span>
</span><span id="line-66"></span><span class="hs-comment">--</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- @since 0.1.0</span><span>
</span><span id="line-68"></span><span id="local-6989586621679244301"><span class="annot"><a href="Data.Massiv.Core.Loop.html#loop"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244301"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244301"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244301"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244301"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-69"></span><span id="loop"><span class="annot"><span class="annottext">loop :: forall a.
Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; a -&gt; (Int -&gt; a -&gt; a) -&gt; a
</span><a href="Data.Massiv.Core.Loop.html#loop"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679244546"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244546"><span class="hs-identifier hs-var">initial</span></a></span></span><span> </span><span id="local-6989586621679244547"><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244547"><span class="hs-identifier hs-var">condition</span></a></span></span><span> </span><span id="local-6989586621679244548"><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244548"><span class="hs-identifier hs-var">increment</span></a></span></span><span> </span><span id="local-6989586621679244549"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244549"><span class="hs-identifier hs-var">initAcc</span></a></span></span><span> </span><span id="local-6989586621679244550"><span class="annot"><span class="annottext">Int -&gt; a -&gt; a
</span><a href="#local-6989586621679244550"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><span class="annottext">Identity a -&gt; a
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var">runIdentity</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
-&gt; (Int -&gt; Bool)
-&gt; (Int -&gt; Int)
-&gt; a
-&gt; (Int -&gt; a -&gt; Identity a)
-&gt; Identity a
forall (m :: * -&gt; *) a.
Monad m =&gt;
Int
-&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; a -&gt; (Int -&gt; a -&gt; m a) -&gt; m a
</span><a href="Data.Massiv.Core.Loop.html#loopM"><span class="hs-identifier hs-var">loopM</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244546"><span class="hs-identifier hs-var">initial</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244547"><span class="hs-identifier hs-var">condition</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244548"><span class="hs-identifier hs-var">increment</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244549"><span class="hs-identifier hs-var">initAcc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; a -&gt; a) -&gt; Int -&gt; a -&gt; Identity a
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; a -&gt; a
</span><a href="#local-6989586621679244550"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#loop"><span class="hs-pragma hs-type">loop</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="hs-comment">-- | Efficient monadic loop with an accumulator</span><span>
</span><span id="line-74"></span><span class="hs-comment">--</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- &gt;&gt;&gt; loopM 1 (&lt; 20) (+ 2) [] (\i a -&gt; Just (i:a))</span><span>
</span><span id="line-76"></span><span class="hs-comment">-- Just [19,17,15,13,11,9,7,5,3,1]</span><span>
</span><span id="line-77"></span><span class="hs-comment">--</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- @since 0.1.0</span><span>
</span><span id="line-79"></span><span id="local-6989586621679244308"><span id="local-6989586621679244309"><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopM"><span class="hs-identifier hs-type">loopM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679244308"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244309"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244309"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244308"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244309"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244308"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244309"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-80"></span><span id="loopM"><span class="annot"><span class="annottext">loopM :: forall (m :: * -&gt; *) a.
Monad m =&gt;
Int
-&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; a -&gt; (Int -&gt; a -&gt; m a) -&gt; m a
</span><a href="Data.Massiv.Core.Loop.html#loopM"><span class="hs-identifier hs-var hs-var">loopM</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244557"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244557"><span class="hs-identifier hs-var">initial</span></a></span></span><span> </span><span id="local-6989586621679244558"><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244558"><span class="hs-identifier hs-var">condition</span></a></span></span><span> </span><span id="local-6989586621679244559"><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244559"><span class="hs-identifier hs-var">increment</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244560"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244560"><span class="hs-identifier hs-var">initAcc</span></a></span></span><span> </span><span id="local-6989586621679244561"><span class="annot"><span class="annottext">Int -&gt; a -&gt; m a
</span><a href="#local-6989586621679244561"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-81"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; a -&gt; m a
</span><a href="#local-6989586621679244562"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244557"><span class="hs-identifier hs-var">initial</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244560"><span class="hs-identifier hs-var">initAcc</span></a></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-83"></span><span>    </span><span id="local-6989586621679244562"><span class="annot"><span class="annottext">go :: Int -&gt; a -&gt; m a
</span><a href="#local-6989586621679244562"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244563"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244563"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244564"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244564"><span class="hs-identifier hs-var">acc</span></a></span></span><span>
</span><span id="line-84"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244558"><span class="hs-identifier hs-var">condition</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244563"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; a -&gt; m a
</span><a href="#local-6989586621679244561"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244563"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244564"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; (a -&gt; m a) -&gt; m a
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; a -&gt; m a
</span><a href="#local-6989586621679244562"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244559"><span class="hs-identifier hs-var">increment</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244563"><span class="hs-identifier hs-var">step</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244564"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-86"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopM"><span class="hs-pragma hs-type">loopM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-comment">-- | Efficient monadic loop with an accumulator and extra linear index incremented by 1.</span><span>
</span><span id="line-89"></span><span class="hs-comment">--</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- &gt;&gt;&gt; iloopM 100 1 (&lt; 20) (+ 2) [] (\i ix a -&gt; Just ((i, ix) : a))</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- Just [(109,19),(108,17),(107,15),(106,13),(105,11),(104,9),(103,7),(102,5),(101,3),(100,1)]</span><span>
</span><span id="line-92"></span><span class="hs-comment">--</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- @since 1.0.2</span><span>
</span><span id="line-94"></span><span id="local-6989586621679244317"><span id="local-6989586621679244318"><span class="annot"><a href="Data.Massiv.Core.Loop.html#iloopM"><span class="hs-identifier hs-type">iloopM</span></a></span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679244317"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244318"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244318"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244317"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244318"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244317"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244318"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-96"></span><span id="iloopM"><span class="annot"><span class="annottext">iloopM :: forall (m :: * -&gt; *) a.
Monad m =&gt;
Int
-&gt; Int
-&gt; (Int -&gt; Bool)
-&gt; (Int -&gt; Int)
-&gt; a
-&gt; (Int -&gt; Int -&gt; a -&gt; m a)
-&gt; m a
</span><a href="Data.Massiv.Core.Loop.html#iloopM"><span class="hs-identifier hs-var hs-var">iloopM</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244571"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244571"><span class="hs-identifier hs-var">istart</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244572"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244572"><span class="hs-identifier hs-var">initIx</span></a></span></span><span> </span><span id="local-6989586621679244573"><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244573"><span class="hs-identifier hs-var">condition</span></a></span></span><span> </span><span id="local-6989586621679244574"><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244574"><span class="hs-identifier hs-var">increment</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244575"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244575"><span class="hs-identifier hs-var">initAcc</span></a></span></span><span> </span><span id="local-6989586621679244576"><span class="annot"><span class="annottext">Int -&gt; Int -&gt; a -&gt; m a
</span><a href="#local-6989586621679244576"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; a -&gt; m a
</span><a href="#local-6989586621679244577"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244571"><span class="hs-identifier hs-var">istart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244572"><span class="hs-identifier hs-var">initIx</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244575"><span class="hs-identifier hs-var">initAcc</span></a></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-98"></span><span>    </span><span id="local-6989586621679244577"><span class="annot"><span class="annottext">go :: Int -&gt; Int -&gt; a -&gt; m a
</span><a href="#local-6989586621679244577"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244578"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244578"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244579"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244579"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244580"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244580"><span class="hs-identifier hs-var">acc</span></a></span></span><span>
</span><span id="line-99"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244573"><span class="hs-identifier hs-var">condition</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244579"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; a -&gt; m a
</span><a href="#local-6989586621679244576"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244578"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244579"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244580"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; (a -&gt; m a) -&gt; m a
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; a -&gt; m a
</span><a href="#local-6989586621679244577"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244578"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244574"><span class="hs-identifier hs-var">increment</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244579"><span class="hs-identifier hs-var">step</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244580"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-101"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#iloopM"><span class="hs-pragma hs-type">iloopM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-comment">-- | Efficient monadic loop. Result of each iteration is discarded.</span><span>
</span><span id="line-104"></span><span class="hs-comment">--</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- @since 0.1.0</span><span>
</span><span id="line-106"></span><span id="local-6989586621679244322"><span id="local-6989586621679244323"><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopM_"><span class="hs-identifier hs-type">loopM_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679244322"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244322"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244323"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244322"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-107"></span><span id="loopM_"><span class="annot"><span class="annottext">loopM_ :: forall (m :: * -&gt; *) a.
Monad m =&gt;
Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; m a) -&gt; m ()
</span><a href="Data.Massiv.Core.Loop.html#loopM_"><span class="hs-identifier hs-var hs-var">loopM_</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244586"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244586"><span class="hs-identifier hs-var">initial</span></a></span></span><span> </span><span id="local-6989586621679244587"><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244587"><span class="hs-identifier hs-var">condition</span></a></span></span><span> </span><span id="local-6989586621679244588"><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244588"><span class="hs-identifier hs-var">increment</span></a></span></span><span> </span><span id="local-6989586621679244589"><span class="annot"><span class="annottext">Int -&gt; m a
</span><a href="#local-6989586621679244589"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m ()
</span><a href="#local-6989586621679244590"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244586"><span class="hs-identifier hs-var">initial</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-109"></span><span>    </span><span id="local-6989586621679244590"><span class="annot"><span class="annottext">go :: Int -&gt; m ()
</span><a href="#local-6989586621679244590"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244591"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244591"><span class="hs-identifier hs-var">step</span></a></span></span><span>
</span><span id="line-110"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244587"><span class="hs-identifier hs-var">condition</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244591"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m a
</span><a href="#local-6989586621679244589"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244591"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; m () -&gt; m ()
forall a b. m a -&gt; m b -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; m ()
</span><a href="#local-6989586621679244590"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244588"><span class="hs-identifier hs-var">increment</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244591"><span class="hs-identifier hs-var">step</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- loopF initial condition increment (pure ()) (\i ma -&gt; f i &gt;&gt; ma)</span><span>
</span><span id="line-113"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopM_"><span class="hs-pragma hs-type">loopM_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-114"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">loopM_</span><span> </span><span class="hs-pragma">&quot;In favor of `loopA_`&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">-- | Efficient monadic loop with extra linear index incremented by 1.</span><span>
</span><span id="line-117"></span><span class="hs-comment">--</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- &gt;&gt;&gt; iloopA_ 100 1 (&lt; 10) (+ 2) (\i ix -&gt; print (i, ix))</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- (100,1)</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- (101,3)</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- (102,5)</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- (103,7)</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- (104,9)</span><span>
</span><span id="line-124"></span><span class="hs-comment">--</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- @since 1.0.2</span><span>
</span><span id="line-126"></span><span id="local-6989586621679244328"><span id="local-6989586621679244329"><span class="annot"><a href="Data.Massiv.Core.Loop.html#iloopA_"><span class="hs-identifier hs-type">iloopA_</span></a></span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621679244328"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244328"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244329"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244328"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-128"></span><span id="iloopA_"><span class="annot"><span class="annottext">iloopA_ :: forall (f :: * -&gt; *) a.
Applicative f =&gt;
Int
-&gt; Int
-&gt; (Int -&gt; Bool)
-&gt; (Int -&gt; Int)
-&gt; (Int -&gt; Int -&gt; f a)
-&gt; f ()
</span><a href="Data.Massiv.Core.Loop.html#iloopA_"><span class="hs-identifier hs-var hs-var">iloopA_</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244597"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244597"><span class="hs-identifier hs-var">istart</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244598"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244598"><span class="hs-identifier hs-var">initIx</span></a></span></span><span> </span><span id="local-6989586621679244599"><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244599"><span class="hs-identifier hs-var">condition</span></a></span></span><span> </span><span id="local-6989586621679244600"><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244600"><span class="hs-identifier hs-var">increment</span></a></span></span><span> </span><span id="local-6989586621679244601"><span class="annot"><span class="annottext">Int -&gt; Int -&gt; f a
</span><a href="#local-6989586621679244601"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; f ()
</span><a href="#local-6989586621679244602"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244597"><span class="hs-identifier hs-var">istart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244598"><span class="hs-identifier hs-var">initIx</span></a></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-130"></span><span>    </span><span id="local-6989586621679244602"><span class="annot"><span class="annottext">go :: Int -&gt; Int -&gt; f ()
</span><a href="#local-6989586621679244602"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244603"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244603"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244604"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244604"><span class="hs-identifier hs-var">step</span></a></span></span><span>
</span><span id="line-131"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244599"><span class="hs-identifier hs-var">condition</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244604"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; f a
</span><a href="#local-6989586621679244601"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244603"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244604"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">f a -&gt; f () -&gt; f ()
forall a b. f a -&gt; f b -&gt; f b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; f ()
</span><a href="#local-6989586621679244602"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244603"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244600"><span class="hs-identifier hs-var">increment</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244604"><span class="hs-identifier hs-var">step</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; f ()
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#iloopA_"><span class="hs-pragma hs-type">iloopA_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-comment">-- | Similar to `loopM_` except the action accepts not only the value for current step,</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- but also for the next one as well.</span><span>
</span><span id="line-137"></span><span class="hs-comment">--</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- @since 1.0.2</span><span>
</span><span id="line-139"></span><span id="local-6989586621679244334"><span id="local-6989586621679244335"><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopNextA_"><span class="hs-identifier hs-type">loopNextA_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621679244334"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244334"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244335"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244334"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-140"></span><span id="loopNextA_"><span class="annot"><span class="annottext">loopNextA_ :: forall (f :: * -&gt; *) a.
Applicative f =&gt;
Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; Int -&gt; f a) -&gt; f ()
</span><a href="Data.Massiv.Core.Loop.html#loopNextA_"><span class="hs-identifier hs-var hs-var">loopNextA_</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244608"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244608"><span class="hs-identifier hs-var">initial</span></a></span></span><span> </span><span id="local-6989586621679244609"><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244609"><span class="hs-identifier hs-var">condition</span></a></span></span><span> </span><span id="local-6989586621679244610"><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244610"><span class="hs-identifier hs-var">increment</span></a></span></span><span> </span><span id="local-6989586621679244611"><span class="annot"><span class="annottext">Int -&gt; Int -&gt; f a
</span><a href="#local-6989586621679244611"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; f ()
</span><a href="#local-6989586621679244612"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244608"><span class="hs-identifier hs-var">initial</span></a></span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-142"></span><span>    </span><span id="local-6989586621679244612"><span class="annot"><span class="annottext">go :: Int -&gt; f ()
</span><a href="#local-6989586621679244612"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244613"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244613"><span class="hs-identifier hs-var">step</span></a></span></span><span>
</span><span id="line-143"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244609"><span class="hs-identifier hs-var">condition</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244613"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-144"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244614"><span class="annot"><span class="annottext">next :: Int
</span><a href="#local-6989586621679244614"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244610"><span class="hs-identifier hs-var">increment</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244613"><span class="hs-identifier hs-var">step</span></a></span><span>
</span><span id="line-145"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; f a
</span><a href="#local-6989586621679244611"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244613"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244614"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">f a -&gt; f () -&gt; f ()
forall a b. f a -&gt; f b -&gt; f b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; f ()
</span><a href="#local-6989586621679244612"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244614"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-146"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; f ()
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopNextA_"><span class="hs-pragma hs-type">loopNextA_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="hs-comment">-- | Similar to `loopM_` except the action accepts not only the value for current step,</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- but also for the next one as well.</span><span>
</span><span id="line-151"></span><span class="hs-comment">--</span><span>
</span><span id="line-152"></span><span class="hs-comment">-- @since 1.0.2</span><span>
</span><span id="line-153"></span><span id="local-6989586621679244338"><span id="local-6989586621679244339"><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopNextM"><span class="hs-identifier hs-type">loopNextM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679244338"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244339"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244339"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244338"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244339"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244338"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244339"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-154"></span><span id="loopNextM"><span class="annot"><span class="annottext">loopNextM :: forall (m :: * -&gt; *) a.
Monad m =&gt;
Int
-&gt; (Int -&gt; Bool)
-&gt; (Int -&gt; Int)
-&gt; a
-&gt; (Int -&gt; Int -&gt; a -&gt; m a)
-&gt; m a
</span><a href="Data.Massiv.Core.Loop.html#loopNextM"><span class="hs-identifier hs-var hs-var">loopNextM</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244619"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244619"><span class="hs-identifier hs-var">initial</span></a></span></span><span> </span><span id="local-6989586621679244620"><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244620"><span class="hs-identifier hs-var">condition</span></a></span></span><span> </span><span id="local-6989586621679244621"><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244621"><span class="hs-identifier hs-var">increment</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244622"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244622"><span class="hs-identifier hs-var">initAcc</span></a></span></span><span> </span><span id="local-6989586621679244623"><span class="annot"><span class="annottext">Int -&gt; Int -&gt; a -&gt; m a
</span><a href="#local-6989586621679244623"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; a -&gt; m a
</span><a href="#local-6989586621679244624"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244619"><span class="hs-identifier hs-var">initial</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244622"><span class="hs-identifier hs-var">initAcc</span></a></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-156"></span><span>    </span><span id="local-6989586621679244624"><span class="annot"><span class="annottext">go :: Int -&gt; a -&gt; m a
</span><a href="#local-6989586621679244624"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244625"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244625"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244626"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244626"><span class="hs-identifier hs-var">acc</span></a></span></span><span>
</span><span id="line-157"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244620"><span class="hs-identifier hs-var">condition</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244625"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-158"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244627"><span class="annot"><span class="annottext">next :: Int
</span><a href="#local-6989586621679244627"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244621"><span class="hs-identifier hs-var">increment</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244625"><span class="hs-identifier hs-var">step</span></a></span><span>
</span><span id="line-159"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; a -&gt; m a
</span><a href="#local-6989586621679244623"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244625"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244627"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244626"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; (a -&gt; m a) -&gt; m a
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; a -&gt; m a
</span><a href="#local-6989586621679244624"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244627"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-160"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244626"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-161"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopNextM"><span class="hs-pragma hs-type">loopNextM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-comment">-- | Efficient Applicative loop. Result of each iteration is discarded.</span><span>
</span><span id="line-164"></span><span class="hs-comment">--</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- &gt; loopA_ initial cond incr f === loopA initial cond incr (pure ()) (\i -&gt; id &lt;$ f i)</span><span>
</span><span id="line-166"></span><span class="hs-comment">--</span><span>
</span><span id="line-167"></span><span class="hs-comment">-- @since 1.0.2</span><span>
</span><span id="line-168"></span><span id="local-6989586621679244342"><span id="local-6989586621679244343"><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopA_"><span class="hs-identifier hs-type">loopA_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621679244342"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244342"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244343"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244342"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-169"></span><span id="loopA_"><span class="annot"><span class="annottext">loopA_ :: forall (f :: * -&gt; *) a.
Applicative f =&gt;
Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; f a) -&gt; f ()
</span><a href="Data.Massiv.Core.Loop.html#loopA_"><span class="hs-identifier hs-var hs-var">loopA_</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244631"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244631"><span class="hs-identifier hs-var">initial</span></a></span></span><span> </span><span id="local-6989586621679244632"><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244632"><span class="hs-identifier hs-var">condition</span></a></span></span><span> </span><span id="local-6989586621679244633"><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244633"><span class="hs-identifier hs-var">increment</span></a></span></span><span> </span><span id="local-6989586621679244634"><span class="annot"><span class="annottext">Int -&gt; f a
</span><a href="#local-6989586621679244634"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-170"></span><span>  </span><span class="annot"><span class="annottext">Int
-&gt; (Int -&gt; Bool)
-&gt; (Int -&gt; Int)
-&gt; f ()
-&gt; (Int -&gt; f () -&gt; f ())
-&gt; f ()
forall (f :: * -&gt; *) a.
Int
-&gt; (Int -&gt; Bool)
-&gt; (Int -&gt; Int)
-&gt; f a
-&gt; (Int -&gt; f a -&gt; f a)
-&gt; f a
</span><a href="Data.Massiv.Core.Loop.html#loopF"><span class="hs-identifier hs-var">loopF</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244631"><span class="hs-identifier hs-var">initial</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244632"><span class="hs-identifier hs-var">condition</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244633"><span class="hs-identifier hs-var">increment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; f ()
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679244635"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244635"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679244636"><span class="annot"><span class="annottext">f ()
</span><a href="#local-6989586621679244636"><span class="hs-identifier hs-var">ma</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; f a
</span><a href="#local-6989586621679244634"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244635"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">f a -&gt; f () -&gt; f ()
forall a b. f a -&gt; f b -&gt; f b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">f ()
</span><a href="#local-6989586621679244636"><span class="hs-identifier hs-var">ma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopA_"><span class="hs-pragma hs-type">loopA_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-comment">-- | Applicative loop. Use monadic `loopM` when possible, since it will be more efficient.</span><span>
</span><span id="line-174"></span><span class="hs-comment">--</span><span>
</span><span id="line-175"></span><span class="hs-comment">-- @since 0.3.0</span><span>
</span><span id="line-176"></span><span id="local-6989586621679244348"><span id="local-6989586621679244349"><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopA"><span class="hs-identifier hs-type">loopA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621679244348"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244348"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244349"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244348"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679244349"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244349"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244348"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244349"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-177"></span><span id="loopA"><span class="annot"><span class="annottext">loopA :: forall (f :: * -&gt; *) b.
Applicative f =&gt;
Int
-&gt; (Int -&gt; Bool)
-&gt; (Int -&gt; Int)
-&gt; f b
-&gt; (Int -&gt; f (b -&gt; b))
-&gt; f b
</span><a href="Data.Massiv.Core.Loop.html#loopA"><span class="hs-identifier hs-var hs-var">loopA</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244639"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244639"><span class="hs-identifier hs-var">initial</span></a></span></span><span> </span><span id="local-6989586621679244640"><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244640"><span class="hs-identifier hs-var">condition</span></a></span></span><span> </span><span id="local-6989586621679244641"><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244641"><span class="hs-identifier hs-var">increment</span></a></span></span><span> </span><span id="local-6989586621679244642"><span class="annot"><span class="annottext">f b
</span><a href="#local-6989586621679244642"><span class="hs-identifier hs-var">lastAction</span></a></span></span><span> </span><span id="local-6989586621679244643"><span class="annot"><span class="annottext">Int -&gt; f (b -&gt; b)
</span><a href="#local-6989586621679244643"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-178"></span><span>  </span><span class="annot"><span class="annottext">Int
-&gt; (Int -&gt; Bool)
-&gt; (Int -&gt; Int)
-&gt; f b
-&gt; (Int -&gt; f b -&gt; f b)
-&gt; f b
forall (f :: * -&gt; *) a.
Int
-&gt; (Int -&gt; Bool)
-&gt; (Int -&gt; Int)
-&gt; f a
-&gt; (Int -&gt; f a -&gt; f a)
-&gt; f a
</span><a href="Data.Massiv.Core.Loop.html#loopF"><span class="hs-identifier hs-var">loopF</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244639"><span class="hs-identifier hs-var">initial</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244640"><span class="hs-identifier hs-var">condition</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244641"><span class="hs-identifier hs-var">increment</span></a></span><span> </span><span class="annot"><span class="annottext">f b
</span><a href="#local-6989586621679244642"><span class="hs-identifier hs-var">lastAction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679244644"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244644"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679244645"><span class="annot"><span class="annottext">f b
</span><a href="#local-6989586621679244645"><span class="hs-identifier hs-var">ma</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; f (b -&gt; b)
</span><a href="#local-6989586621679244643"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244644"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">f (b -&gt; b) -&gt; f b -&gt; f b
forall a b. f (a -&gt; b) -&gt; f a -&gt; f b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">f b
</span><a href="#local-6989586621679244645"><span class="hs-identifier hs-var">ma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopA"><span class="hs-pragma hs-type">loopA</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span id="local-6989586621679244346"><span id="local-6989586621679244347"><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopF"><span class="hs-identifier hs-type">loopF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244346"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244347"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244346"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244347"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244346"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244347"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244346"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244347"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-182"></span><span id="loopF"><span class="annot"><span class="annottext">loopF :: forall (f :: * -&gt; *) a.
Int
-&gt; (Int -&gt; Bool)
-&gt; (Int -&gt; Int)
-&gt; f a
-&gt; (Int -&gt; f a -&gt; f a)
-&gt; f a
</span><a href="Data.Massiv.Core.Loop.html#loopF"><span class="hs-identifier hs-var hs-var">loopF</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244646"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244646"><span class="hs-identifier hs-var">initial</span></a></span></span><span> </span><span id="local-6989586621679244647"><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244647"><span class="hs-identifier hs-var">condition</span></a></span></span><span> </span><span id="local-6989586621679244648"><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244648"><span class="hs-identifier hs-var">increment</span></a></span></span><span> </span><span id="local-6989586621679244649"><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679244649"><span class="hs-identifier hs-var">lastAction</span></a></span></span><span> </span><span id="local-6989586621679244650"><span class="annot"><span class="annottext">Int -&gt; f a -&gt; f a
</span><a href="#local-6989586621679244650"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; f a
</span><a href="#local-6989586621679244651"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244646"><span class="hs-identifier hs-var">initial</span></a></span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-184"></span><span>    </span><span id="local-6989586621679244651"><span class="annot"><span class="annottext">go :: Int -&gt; f a
</span><a href="#local-6989586621679244651"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244652"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244652"><span class="hs-identifier hs-var">step</span></a></span></span><span>
</span><span id="line-185"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244647"><span class="hs-identifier hs-var">condition</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244652"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; f a -&gt; f a
</span><a href="#local-6989586621679244650"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244652"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; f a
</span><a href="#local-6989586621679244651"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244648"><span class="hs-identifier hs-var">increment</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244652"><span class="hs-identifier hs-var">step</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679244649"><span class="hs-identifier hs-var">lastAction</span></a></span><span>
</span><span id="line-187"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopF"><span class="hs-pragma hs-type">loopF</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span id="local-6989586621679244356"><span id="local-6989586621679244357"><span class="annot"><a href="Data.Massiv.Core.Loop.html#nextMaybeF"><span class="hs-identifier hs-type">nextMaybeF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244356"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244357"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244356"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244357"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-190"></span><span id="nextMaybeF"><span class="annot"><span class="annottext">nextMaybeF :: forall (f :: * -&gt; *) a.
Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Maybe Int -&gt; f a) -&gt; f a
</span><a href="Data.Massiv.Core.Loop.html#nextMaybeF"><span class="hs-identifier hs-var hs-var">nextMaybeF</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244653"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244653"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span id="local-6989586621679244654"><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244654"><span class="hs-identifier hs-var">condition</span></a></span></span><span> </span><span id="local-6989586621679244655"><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244655"><span class="hs-identifier hs-var">increment</span></a></span></span><span> </span><span id="local-6989586621679244656"><span class="annot"><span class="annottext">Maybe Int -&gt; f a
</span><a href="#local-6989586621679244656"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244657"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679244657"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244655"><span class="hs-identifier hs-var">increment</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244653"><span class="hs-identifier hs-var">cur</span></a></span><span>
</span><span id="line-192"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; f a
</span><a href="#local-6989586621679244656"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; f a) -&gt; Maybe Int -&gt; f a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244654"><span class="hs-identifier hs-var">condition</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244657"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244657"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-193"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#nextMaybeF"><span class="hs-pragma hs-type">nextMaybeF</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="hs-comment">-- | Similar to `loopM`, but way less efficient monadic loop with an accumulator that reverses</span><span>
</span><span id="line-196"></span><span class="hs-comment">-- the direction of action application. eg:</span><span>
</span><span id="line-197"></span><span class="hs-comment">--</span><span>
</span><span id="line-198"></span><span class="hs-comment">-- &gt;&gt;&gt; loopDeepM 1 (&lt; 20) (+ 2) [] (\i a -&gt; Just (i:a))</span><span>
</span><span id="line-199"></span><span class="hs-comment">-- Just [1,3,5,7,9,11,13,15,17,19]</span><span>
</span><span id="line-200"></span><span class="hs-comment">--</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- Equivalent to:</span><span>
</span><span id="line-202"></span><span class="hs-comment">--</span><span>
</span><span id="line-203"></span><span class="hs-comment">-- &gt;&gt;&gt; loopM 19 (&gt;= 1) (subtract 2) [] (\i a -&gt; Just (i:a))</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- Just [1,3,5,7,9,11,13,15,17,19]</span><span>
</span><span id="line-205"></span><span class="hs-comment">--</span><span>
</span><span id="line-206"></span><span class="hs-comment">-- @since 0.1.0</span><span>
</span><span id="line-207"></span><span id="local-6989586621679244659"><span id="local-6989586621679244660"><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopDeepM"><span class="hs-identifier hs-type">loopDeepM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679244659"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244660"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244660"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244659"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244660"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244659"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244660"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-208"></span><span id="loopDeepM"><span class="annot"><span class="annottext">loopDeepM :: forall (m :: * -&gt; *) a.
Monad m =&gt;
Int
-&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; a -&gt; (Int -&gt; a -&gt; m a) -&gt; m a
</span><a href="Data.Massiv.Core.Loop.html#loopDeepM"><span class="hs-identifier hs-var hs-var">loopDeepM</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244665"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244665"><span class="hs-identifier hs-var">initial</span></a></span></span><span> </span><span id="local-6989586621679244666"><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244666"><span class="hs-identifier hs-var">condition</span></a></span></span><span> </span><span id="local-6989586621679244667"><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244667"><span class="hs-identifier hs-var">increment</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244668"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244668"><span class="hs-identifier hs-var">initAcc</span></a></span></span><span> </span><span id="local-6989586621679244669"><span class="annot"><span class="annottext">Int -&gt; a -&gt; m a
</span><a href="#local-6989586621679244669"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-209"></span><span>  </span><span class="annot"><span class="annottext">Int
-&gt; (Int -&gt; Bool)
-&gt; (Int -&gt; Int)
-&gt; m a
-&gt; (Int -&gt; m a -&gt; m a)
-&gt; m a
forall (f :: * -&gt; *) a.
Int
-&gt; (Int -&gt; Bool)
-&gt; (Int -&gt; Int)
-&gt; f a
-&gt; (Int -&gt; f a -&gt; f a)
-&gt; f a
</span><a href="Data.Massiv.Core.Loop.html#loopF"><span class="hs-identifier hs-var">loopF</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244665"><span class="hs-identifier hs-var">initial</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679244666"><span class="hs-identifier hs-var">condition</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679244667"><span class="hs-identifier hs-var">increment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; m a
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244668"><span class="hs-identifier hs-var">initAcc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679244670"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244670"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679244671"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679244671"><span class="hs-identifier hs-var">ma</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679244671"><span class="hs-identifier hs-var">ma</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; (a -&gt; m a) -&gt; m a
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; a -&gt; m a
</span><a href="#local-6989586621679244669"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244670"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#loopDeepM"><span class="hs-pragma hs-type">loopDeepM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-comment">-- | Divide length in chunks and apply a function to the computed results</span><span>
</span><span id="line-213"></span><span class="hs-comment">--</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- @since 0.2.1</span><span>
</span><span id="line-215"></span><span id="local-6989586621679244365"><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearly"><span class="hs-identifier hs-type">splitLinearly</span></a></span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-217"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Number of chunks</span></span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-219"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Total length</span></span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244365"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Function that accepts a chunk length and slack start index</span></span><span>
</span><span id="line-222"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244365"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-223"></span><span id="splitLinearly"><span class="annot"><span class="annottext">splitLinearly :: forall a. Int -&gt; Int -&gt; (Int -&gt; Int -&gt; a) -&gt; a
</span><a href="Data.Massiv.Core.Loop.html#splitLinearly"><span class="hs-identifier hs-var hs-var">splitLinearly</span></a></span></span><span> </span><span id="local-6989586621679244674"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244674"><span class="hs-identifier hs-var">numChunks</span></a></span></span><span> </span><span id="local-6989586621679244675"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244675"><span class="hs-identifier hs-var">totalLength</span></a></span></span><span> </span><span id="local-6989586621679244676"><span class="annot"><span class="annottext">Int -&gt; Int -&gt; a
</span><a href="#local-6989586621679244676"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; a
</span><a href="#local-6989586621679244676"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244677"><span class="hs-identifier hs-var">chunkLength</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244678"><span class="hs-identifier hs-var">slackStart</span></a></span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679244677"><span class="annot"><span class="annottext">chunkLength :: Int
</span><a href="#local-6989586621679244677"><span class="hs-identifier hs-var hs-var">chunkLength</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244675"><span class="hs-identifier hs-var">totalLength</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`quot`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244674"><span class="hs-identifier hs-var">numChunks</span></a></span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679244678"><span class="annot"><span class="annottext">slackStart :: Int
</span><a href="#local-6989586621679244678"><span class="hs-identifier hs-var hs-var">slackStart</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244677"><span class="hs-identifier hs-var">chunkLength</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244674"><span class="hs-identifier hs-var">numChunks</span></a></span><span>
</span><span id="line-227"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearly"><span class="hs-pragma hs-type">splitLinearly</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="hs-comment">-- | Iterator that expects an action that accepts starting linear index as well as the ending</span><span>
</span><span id="line-230"></span><span class="hs-comment">--</span><span>
</span><span id="line-231"></span><span class="hs-comment">-- @since 0.5.7</span><span>
</span><span id="line-232"></span><span id="local-6989586621679244368"><span id="local-6989586621679244369"><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearlyM_"><span class="hs-identifier hs-type">splitLinearlyM_</span></a></span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadPrimBase</span></span><span> </span><span class="annot"><a href="#local-6989586621679244368"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244369"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Scheduler</span></span><span> </span><span class="annot"><a href="#local-6989586621679244368"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244369"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244369"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-234"></span><span id="splitLinearlyM_"><span class="annot"><span class="annottext">splitLinearlyM_ :: forall s (m :: * -&gt; *).
MonadPrimBase s m =&gt;
Scheduler s () -&gt; Int -&gt; (Int -&gt; Int -&gt; m ()) -&gt; m ()
</span><a href="Data.Massiv.Core.Loop.html#splitLinearlyM_"><span class="hs-identifier hs-var hs-var">splitLinearlyM_</span></a></span></span><span> </span><span id="local-6989586621679244697"><span class="annot"><span class="annottext">Scheduler s ()
</span><a href="#local-6989586621679244697"><span class="hs-identifier hs-var">scheduler</span></a></span></span><span> </span><span id="local-6989586621679244698"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244698"><span class="hs-identifier hs-var">totalLength</span></a></span></span><span> </span><span id="local-6989586621679244699"><span class="annot"><span class="annottext">Int -&gt; Int -&gt; m ()
</span><a href="#local-6989586621679244699"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-235"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; (Int -&gt; Int -&gt; m ()) -&gt; m ()
forall a. Int -&gt; Int -&gt; (Int -&gt; Int -&gt; a) -&gt; a
</span><a href="Data.Massiv.Core.Loop.html#splitLinearly"><span class="hs-identifier hs-var">splitLinearly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scheduler s () -&gt; Int
forall s a. Scheduler s a -&gt; Int
</span><span class="hs-identifier hs-var">numWorkers</span></span><span> </span><span class="annot"><span class="annottext">Scheduler s ()
</span><a href="#local-6989586621679244697"><span class="hs-identifier hs-var">scheduler</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244698"><span class="hs-identifier hs-var">totalLength</span></a></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; Int -&gt; m ()) -&gt; m ()) -&gt; (Int -&gt; Int -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679244700"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244700"><span class="hs-identifier hs-var">chunkLength</span></a></span></span><span> </span><span id="local-6989586621679244701"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244701"><span class="hs-identifier hs-var">slackStart</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><span class="annottext">Int
-&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; Int -&gt; m ()) -&gt; m ()
forall (f :: * -&gt; *) a.
Applicative f =&gt;
Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; Int -&gt; f a) -&gt; f ()
</span><a href="Data.Massiv.Core.Loop.html#loopNextA_"><span class="hs-identifier hs-var">loopNextA_</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244701"><span class="hs-identifier hs-var">slackStart</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244700"><span class="hs-identifier hs-var">chunkLength</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; Int -&gt; m ()) -&gt; m ()) -&gt; (Int -&gt; Int -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679244703"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244703"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621679244704"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244704"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-237"></span><span>      </span><span class="annot"><span class="annottext">Scheduler s () -&gt; m () -&gt; m ()
forall s (m :: * -&gt; *).
MonadPrimBase s m =&gt;
Scheduler s () -&gt; m () -&gt; m ()
</span><span class="hs-identifier hs-var">scheduleWork_</span></span><span> </span><span class="annot"><span class="annottext">Scheduler s ()
</span><a href="#local-6989586621679244697"><span class="hs-identifier hs-var">scheduler</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; m ()
</span><a href="#local-6989586621679244699"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244703"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244704"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244701"><span class="hs-identifier hs-var">slackStart</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244698"><span class="hs-identifier hs-var">totalLength</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-239"></span><span>      </span><span class="annot"><span class="annottext">Scheduler s () -&gt; m () -&gt; m ()
forall s (m :: * -&gt; *).
MonadPrimBase s m =&gt;
Scheduler s () -&gt; m () -&gt; m ()
</span><span class="hs-identifier hs-var">scheduleWork_</span></span><span> </span><span class="annot"><span class="annottext">Scheduler s ()
</span><a href="#local-6989586621679244697"><span class="hs-identifier hs-var">scheduler</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-240"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; m ()
</span><a href="#local-6989586621679244699"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244701"><span class="hs-identifier hs-var">slackStart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244698"><span class="hs-identifier hs-var">totalLength</span></a></span><span>
</span><span id="line-241"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearlyM_"><span class="hs-pragma hs-type">splitLinearlyM_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="hs-comment">-- | Iterator that expects an action that accepts starting linear index as well as the ending</span><span>
</span><span id="line-244"></span><span class="hs-comment">--</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- @since 1.0.2</span><span>
</span><span id="line-246"></span><span id="local-6989586621679244386"><span id="local-6989586621679244387"><span id="local-6989586621679244388"><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearlyM"><span class="hs-identifier hs-type">splitLinearlyM</span></a></span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadPrimBase</span></span><span> </span><span class="annot"><a href="#local-6989586621679244386"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244387"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Scheduler</span></span><span> </span><span class="annot"><a href="#local-6989586621679244386"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244388"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244387"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244388"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244387"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-248"></span><span id="splitLinearlyM"><span class="annot"><span class="annottext">splitLinearlyM :: forall s (m :: * -&gt; *) a.
MonadPrimBase s m =&gt;
Scheduler s a -&gt; Int -&gt; (Int -&gt; Int -&gt; m a) -&gt; m ()
</span><a href="Data.Massiv.Core.Loop.html#splitLinearlyM"><span class="hs-identifier hs-var hs-var">splitLinearlyM</span></a></span></span><span> </span><span id="local-6989586621679244718"><span class="annot"><span class="annottext">Scheduler s a
</span><a href="#local-6989586621679244718"><span class="hs-identifier hs-var">scheduler</span></a></span></span><span> </span><span id="local-6989586621679244719"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244719"><span class="hs-identifier hs-var">totalLength</span></a></span></span><span> </span><span id="local-6989586621679244720"><span class="annot"><span class="annottext">Int -&gt; Int -&gt; m a
</span><a href="#local-6989586621679244720"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-249"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; (Int -&gt; Int -&gt; m ()) -&gt; m ()
forall a. Int -&gt; Int -&gt; (Int -&gt; Int -&gt; a) -&gt; a
</span><a href="Data.Massiv.Core.Loop.html#splitLinearly"><span class="hs-identifier hs-var">splitLinearly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scheduler s a -&gt; Int
forall s a. Scheduler s a -&gt; Int
</span><span class="hs-identifier hs-var">numWorkers</span></span><span> </span><span class="annot"><span class="annottext">Scheduler s a
</span><a href="#local-6989586621679244718"><span class="hs-identifier hs-var">scheduler</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244719"><span class="hs-identifier hs-var">totalLength</span></a></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; Int -&gt; m ()) -&gt; m ()) -&gt; (Int -&gt; Int -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679244721"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244721"><span class="hs-identifier hs-var">chunkLength</span></a></span></span><span> </span><span id="local-6989586621679244722"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244722"><span class="hs-identifier hs-var">slackStart</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-250"></span><span>    </span><span class="annot"><span class="annottext">Int
-&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; Int -&gt; m ()) -&gt; m ()
forall (f :: * -&gt; *) a.
Applicative f =&gt;
Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; Int -&gt; f a) -&gt; f ()
</span><a href="Data.Massiv.Core.Loop.html#loopNextA_"><span class="hs-identifier hs-var">loopNextA_</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244722"><span class="hs-identifier hs-var">slackStart</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244721"><span class="hs-identifier hs-var">chunkLength</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; Int -&gt; m ()) -&gt; m ()) -&gt; (Int -&gt; Int -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679244723"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244723"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621679244724"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244724"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-251"></span><span>      </span><span class="annot"><span class="annottext">Scheduler s a -&gt; m a -&gt; m ()
forall s (m :: * -&gt; *) a.
MonadPrimBase s m =&gt;
Scheduler s a -&gt; m a -&gt; m ()
</span><span class="hs-identifier hs-var">scheduleWork</span></span><span> </span><span class="annot"><span class="annottext">Scheduler s a
</span><a href="#local-6989586621679244718"><span class="hs-identifier hs-var">scheduler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; m a
</span><a href="#local-6989586621679244720"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244723"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244724"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244722"><span class="hs-identifier hs-var">slackStart</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244719"><span class="hs-identifier hs-var">totalLength</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-253"></span><span>      </span><span class="annot"><span class="annottext">Scheduler s a -&gt; m a -&gt; m ()
forall s (m :: * -&gt; *) a.
MonadPrimBase s m =&gt;
Scheduler s a -&gt; m a -&gt; m ()
</span><span class="hs-identifier hs-var">scheduleWork</span></span><span> </span><span class="annot"><span class="annottext">Scheduler s a
</span><a href="#local-6989586621679244718"><span class="hs-identifier hs-var">scheduler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; m a
</span><a href="#local-6989586621679244720"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244722"><span class="hs-identifier hs-var">slackStart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244719"><span class="hs-identifier hs-var">totalLength</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearlyM"><span class="hs-pragma hs-type">splitLinearlyM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="hs-comment">-- | Iterator that can be used to split computation amongst different workers. For monadic</span><span>
</span><span id="line-257"></span><span class="hs-comment">-- generator see `splitLinearlyWithM_`.</span><span>
</span><span id="line-258"></span><span class="hs-comment">--</span><span>
</span><span id="line-259"></span><span class="hs-comment">-- @since 0.2.1</span><span>
</span><span id="line-260"></span><span id="local-6989586621679244395"><span id="local-6989586621679244396"><span id="local-6989586621679244397"><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearlyWith_"><span class="hs-identifier hs-type">splitLinearlyWith_</span></a></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadPrimBase</span></span><span> </span><span class="annot"><a href="#local-6989586621679244395"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244396"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Scheduler</span></span><span> </span><span class="annot"><a href="#local-6989586621679244395"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244397"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244397"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244396"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244396"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-262"></span><span id="splitLinearlyWith_"><span class="annot"><span class="annottext">splitLinearlyWith_ :: forall s (m :: * -&gt; *) b.
MonadPrimBase s m =&gt;
Scheduler s () -&gt; Int -&gt; (Int -&gt; b) -&gt; (Int -&gt; b -&gt; m ()) -&gt; m ()
</span><a href="Data.Massiv.Core.Loop.html#splitLinearlyWith_"><span class="hs-identifier hs-var hs-var">splitLinearlyWith_</span></a></span></span><span> </span><span id="local-6989586621679244732"><span class="annot"><span class="annottext">Scheduler s ()
</span><a href="#local-6989586621679244732"><span class="hs-identifier hs-var">scheduler</span></a></span></span><span> </span><span id="local-6989586621679244733"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244733"><span class="hs-identifier hs-var">totalLength</span></a></span></span><span> </span><span id="local-6989586621679244734"><span class="annot"><span class="annottext">Int -&gt; b
</span><a href="#local-6989586621679244734"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-263"></span><span>  </span><span class="annot"><span class="annottext">Scheduler s () -&gt; Int -&gt; (Int -&gt; m b) -&gt; (Int -&gt; b -&gt; m ()) -&gt; m ()
forall s (m :: * -&gt; *) b c.
MonadPrimBase s m =&gt;
Scheduler s () -&gt; Int -&gt; (Int -&gt; m b) -&gt; (Int -&gt; b -&gt; m c) -&gt; m ()
</span><a href="Data.Massiv.Core.Loop.html#splitLinearlyWithM_"><span class="hs-identifier hs-var">splitLinearlyWithM_</span></a></span><span> </span><span class="annot"><span class="annottext">Scheduler s ()
</span><a href="#local-6989586621679244732"><span class="hs-identifier hs-var">scheduler</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244733"><span class="hs-identifier hs-var">totalLength</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; m b
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(b -&gt; m b) -&gt; (Int -&gt; b) -&gt; Int -&gt; m b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; b
</span><a href="#local-6989586621679244734"><span class="hs-identifier hs-var">index</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearlyWith_"><span class="hs-pragma hs-type">splitLinearlyWith_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="hs-comment">-- | Iterator that can be used to split computation jobs</span><span>
</span><span id="line-267"></span><span class="hs-comment">--</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- @since 0.2.6</span><span>
</span><span id="line-269"></span><span id="local-6989586621679244401"><span id="local-6989586621679244402"><span id="local-6989586621679244403"><span id="local-6989586621679244404"><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearlyWithM_"><span class="hs-identifier hs-type">splitLinearlyWithM_</span></a></span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadPrimBase</span></span><span> </span><span class="annot"><a href="#local-6989586621679244401"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244402"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Scheduler</span></span><span> </span><span class="annot"><a href="#local-6989586621679244401"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244402"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244403"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244403"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244402"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244404"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244402"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-271"></span><span id="splitLinearlyWithM_"><span class="annot"><span class="annottext">splitLinearlyWithM_ :: forall s (m :: * -&gt; *) b c.
MonadPrimBase s m =&gt;
Scheduler s () -&gt; Int -&gt; (Int -&gt; m b) -&gt; (Int -&gt; b -&gt; m c) -&gt; m ()
</span><a href="Data.Massiv.Core.Loop.html#splitLinearlyWithM_"><span class="hs-identifier hs-var hs-var">splitLinearlyWithM_</span></a></span></span><span> </span><span id="local-6989586621679244746"><span class="annot"><span class="annottext">Scheduler s ()
</span><a href="#local-6989586621679244746"><span class="hs-identifier hs-var">scheduler</span></a></span></span><span> </span><span id="local-6989586621679244747"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244747"><span class="hs-identifier hs-var">totalLength</span></a></span></span><span> </span><span id="local-6989586621679244748"><span class="annot"><span class="annottext">Int -&gt; m b
</span><a href="#local-6989586621679244748"><span class="hs-identifier hs-var">make</span></a></span></span><span> </span><span id="local-6989586621679244749"><span class="annot"><span class="annottext">Int -&gt; b -&gt; m c
</span><a href="#local-6989586621679244749"><span class="hs-identifier hs-var">write</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-272"></span><span>  </span><span class="annot"><span class="annottext">Scheduler s () -&gt; Int -&gt; (Int -&gt; Int -&gt; m ()) -&gt; m ()
forall s (m :: * -&gt; *).
MonadPrimBase s m =&gt;
Scheduler s () -&gt; Int -&gt; (Int -&gt; Int -&gt; m ()) -&gt; m ()
</span><a href="Data.Massiv.Core.Loop.html#splitLinearlyM_"><span class="hs-identifier hs-var">splitLinearlyM_</span></a></span><span> </span><span class="annot"><span class="annottext">Scheduler s ()
</span><a href="#local-6989586621679244746"><span class="hs-identifier hs-var">scheduler</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244747"><span class="hs-identifier hs-var">totalLength</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; m ()
</span><a href="#local-6989586621679244750"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-273"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-274"></span><span>    </span><span id="local-6989586621679244750"><span class="annot"><span class="annottext">go :: Int -&gt; Int -&gt; m ()
</span><a href="#local-6989586621679244750"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679244751"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244751"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621679244752"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244752"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; m c) -&gt; m ()
forall (m :: * -&gt; *) a.
Monad m =&gt;
Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; m a) -&gt; m ()
</span><a href="Data.Massiv.Core.Loop.html#loopM_"><span class="hs-identifier hs-var">loopM_</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244751"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244752"><span class="hs-identifier hs-var">end</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; m c) -&gt; m ()) -&gt; (Int -&gt; m c) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679244753"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244753"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m b
</span><a href="#local-6989586621679244748"><span class="hs-identifier hs-var">make</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244753"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">m b -&gt; (b -&gt; m c) -&gt; m c
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; b -&gt; m c
</span><a href="#local-6989586621679244749"><span class="hs-identifier hs-var">write</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244753"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679244750"><span class="hs-pragma hs-type">go</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-276"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearlyWithM_"><span class="hs-pragma hs-type">splitLinearlyWithM_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="hs-comment">-- | Iterator that can be used to split computation jobs</span><span>
</span><span id="line-279"></span><span class="hs-comment">--</span><span>
</span><span id="line-280"></span><span class="hs-comment">-- @since 0.3.0</span><span>
</span><span id="line-281"></span><span id="local-6989586621679244412"><span id="local-6989586621679244413"><span id="local-6989586621679244414"><span id="local-6989586621679244415"><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearlyWithStartAtM_"><span class="hs-identifier hs-type">splitLinearlyWithStartAtM_</span></a></span><span>
</span><span id="line-282"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadPrimBase</span></span><span> </span><span class="annot"><a href="#local-6989586621679244412"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244413"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Scheduler</span></span><span> </span><span class="annot"><a href="#local-6989586621679244412"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244413"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244414"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244414"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244413"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244415"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244413"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-283"></span><span id="splitLinearlyWithStartAtM_"><span class="annot"><span class="annottext">splitLinearlyWithStartAtM_ :: forall s (m :: * -&gt; *) b c.
MonadPrimBase s m =&gt;
Scheduler s ()
-&gt; Int -&gt; Int -&gt; (Int -&gt; m b) -&gt; (Int -&gt; b -&gt; m c) -&gt; m ()
</span><a href="Data.Massiv.Core.Loop.html#splitLinearlyWithStartAtM_"><span class="hs-identifier hs-var hs-var">splitLinearlyWithStartAtM_</span></a></span></span><span> </span><span id="local-6989586621679244781"><span class="annot"><span class="annottext">Scheduler s ()
</span><a href="#local-6989586621679244781"><span class="hs-identifier hs-var">scheduler</span></a></span></span><span> </span><span id="local-6989586621679244782"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244782"><span class="hs-identifier hs-var">startAt</span></a></span></span><span> </span><span id="local-6989586621679244783"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244783"><span class="hs-identifier hs-var">totalLength</span></a></span></span><span> </span><span id="local-6989586621679244784"><span class="annot"><span class="annottext">Int -&gt; m b
</span><a href="#local-6989586621679244784"><span class="hs-identifier hs-var">make</span></a></span></span><span> </span><span id="local-6989586621679244785"><span class="annot"><span class="annottext">Int -&gt; b -&gt; m c
</span><a href="#local-6989586621679244785"><span class="hs-identifier hs-var">write</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-284"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; (Int -&gt; Int -&gt; m ()) -&gt; m ()
forall a. Int -&gt; Int -&gt; (Int -&gt; Int -&gt; a) -&gt; a
</span><a href="Data.Massiv.Core.Loop.html#splitLinearly"><span class="hs-identifier hs-var">splitLinearly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scheduler s () -&gt; Int
forall s a. Scheduler s a -&gt; Int
</span><span class="hs-identifier hs-var">numWorkers</span></span><span> </span><span class="annot"><span class="annottext">Scheduler s ()
</span><a href="#local-6989586621679244781"><span class="hs-identifier hs-var">scheduler</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244783"><span class="hs-identifier hs-var">totalLength</span></a></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; Int -&gt; m ()) -&gt; m ()) -&gt; (Int -&gt; Int -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679244786"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244786"><span class="hs-identifier hs-var">chunkLength</span></a></span></span><span> </span><span id="local-6989586621679244787"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244787"><span class="hs-identifier hs-var">slackStart</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-285"></span><span>    </span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) a.
Monad m =&gt;
Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; m a) -&gt; m ()
</span><a href="Data.Massiv.Core.Loop.html#loopM_"><span class="hs-identifier hs-var">loopM_</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244782"><span class="hs-identifier hs-var">startAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244787"><span class="hs-identifier hs-var">slackStart</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244782"><span class="hs-identifier hs-var">startAt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244786"><span class="hs-identifier hs-var">chunkLength</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; m ()) -&gt; m ()) -&gt; (Int -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244788"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244788"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-286"></span><span>      </span><span class="annot"><span class="annottext">Scheduler s () -&gt; m () -&gt; m ()
forall s (m :: * -&gt; *).
MonadPrimBase s m =&gt;
Scheduler s () -&gt; m () -&gt; m ()
</span><span class="hs-identifier hs-var">scheduleWork_</span></span><span> </span><span class="annot"><span class="annottext">Scheduler s ()
</span><a href="#local-6989586621679244781"><span class="hs-identifier hs-var">scheduler</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-287"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; m c) -&gt; m ()
forall (m :: * -&gt; *) a.
Monad m =&gt;
Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; m a) -&gt; m ()
</span><a href="Data.Massiv.Core.Loop.html#loopM_"><span class="hs-identifier hs-var">loopM_</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244788"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244788"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244786"><span class="hs-identifier hs-var">chunkLength</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; m c) -&gt; m ()) -&gt; (Int -&gt; m c) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-288"></span><span>          </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244789"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244789"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m b
</span><a href="#local-6989586621679244784"><span class="hs-identifier hs-var">make</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244789"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">m b -&gt; (b -&gt; m c) -&gt; m c
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; b -&gt; m c
</span><a href="#local-6989586621679244785"><span class="hs-identifier hs-var">write</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244789"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-289"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244787"><span class="hs-identifier hs-var">slackStart</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244783"><span class="hs-identifier hs-var">totalLength</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-290"></span><span>      </span><span class="annot"><span class="annottext">Scheduler s () -&gt; m () -&gt; m ()
forall s (m :: * -&gt; *).
MonadPrimBase s m =&gt;
Scheduler s () -&gt; m () -&gt; m ()
</span><span class="hs-identifier hs-var">scheduleWork_</span></span><span> </span><span class="annot"><span class="annottext">Scheduler s ()
</span><a href="#local-6989586621679244781"><span class="hs-identifier hs-var">scheduler</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-291"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; m c) -&gt; m ()
forall (m :: * -&gt; *) a.
Monad m =&gt;
Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; m a) -&gt; m ()
</span><a href="Data.Massiv.Core.Loop.html#loopM_"><span class="hs-identifier hs-var">loopM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244787"><span class="hs-identifier hs-var">slackStart</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244782"><span class="hs-identifier hs-var">startAt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244783"><span class="hs-identifier hs-var">totalLength</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244782"><span class="hs-identifier hs-var">startAt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; m c) -&gt; m ()) -&gt; (Int -&gt; m c) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-292"></span><span>          </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244790"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244790"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m b
</span><a href="#local-6989586621679244784"><span class="hs-identifier hs-var">make</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244790"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">m b -&gt; (b -&gt; m c) -&gt; m c
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; b -&gt; m c
</span><a href="#local-6989586621679244785"><span class="hs-identifier hs-var">write</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244790"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-293"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearlyWithStartAtM_"><span class="hs-pragma hs-type">splitLinearlyWithStartAtM_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-comment">-- | Iterator that can be used to split computation jobs, while using a stateful scheduler.</span><span>
</span><span id="line-296"></span><span class="hs-comment">--</span><span>
</span><span id="line-297"></span><span class="hs-comment">-- @since 0.3.4</span><span>
</span><span id="line-298"></span><span id="local-6989586621679244420"><span id="local-6989586621679244421"><span id="local-6989586621679244423"><span id="local-6989586621679244424"><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearlyWithStatefulM_"><span class="hs-identifier hs-type">splitLinearlyWithStatefulM_</span></a></span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679244420"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-300"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SchedulerWS</span></span><span> </span><span class="annot"><a href="#local-6989586621679244421"><span class="hs-identifier hs-type">ws</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-302"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Total linear length</span></span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244421"><span class="hs-identifier hs-type">ws</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244420"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244423"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Element producing action</span></span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244423"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244420"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244424"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Element storing action</span></span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244420"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-308"></span><span id="splitLinearlyWithStatefulM_"><span class="annot"><span class="annottext">splitLinearlyWithStatefulM_ :: forall (m :: * -&gt; *) ws b c.
MonadUnliftIO m =&gt;
SchedulerWS ws ()
-&gt; Int -&gt; (Int -&gt; ws -&gt; m b) -&gt; (Int -&gt; b -&gt; m c) -&gt; m ()
</span><a href="Data.Massiv.Core.Loop.html#splitLinearlyWithStatefulM_"><span class="hs-identifier hs-var hs-var">splitLinearlyWithStatefulM_</span></a></span></span><span> </span><span id="local-6989586621679244824"><span class="annot"><span class="annottext">SchedulerWS ws ()
</span><a href="#local-6989586621679244824"><span class="hs-identifier hs-var">schedulerWS</span></a></span></span><span> </span><span id="local-6989586621679244825"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244825"><span class="hs-identifier hs-var">totalLength</span></a></span></span><span> </span><span id="local-6989586621679244826"><span class="annot"><span class="annottext">Int -&gt; ws -&gt; m b
</span><a href="#local-6989586621679244826"><span class="hs-identifier hs-var">make</span></a></span></span><span> </span><span id="local-6989586621679244827"><span class="annot"><span class="annottext">Int -&gt; b -&gt; m c
</span><a href="#local-6989586621679244827"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-309"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679244828"><span class="annot"><span class="annottext">nWorkers :: Int
</span><a href="#local-6989586621679244828"><span class="hs-identifier hs-var hs-var">nWorkers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scheduler RealWorld () -&gt; Int
forall s a. Scheduler s a -&gt; Int
</span><span class="hs-identifier hs-var">numWorkers</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchedulerWS ws () -&gt; Scheduler RealWorld ()
forall ws a. SchedulerWS ws a -&gt; Scheduler RealWorld a
</span><span class="hs-identifier hs-var">unwrapSchedulerWS</span></span><span> </span><span class="annot"><span class="annottext">SchedulerWS ws ()
</span><a href="#local-6989586621679244824"><span class="hs-identifier hs-var">schedulerWS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">((forall a. m a -&gt; IO a) -&gt; IO ()) -&gt; m ()
forall b. ((forall a. m a -&gt; IO a) -&gt; IO b) -&gt; m b
forall (m :: * -&gt; *) b.
MonadUnliftIO m =&gt;
((forall a. m a -&gt; IO a) -&gt; IO b) -&gt; m b
</span><span class="hs-identifier hs-var">withRunInIO</span></span><span> </span><span class="annot"><span class="annottext">(((forall a. m a -&gt; IO a) -&gt; IO ()) -&gt; m ())
-&gt; ((forall a. m a -&gt; IO a) -&gt; IO ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679244830"><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621679244830"><span class="hs-identifier hs-var">run</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-311"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; (Int -&gt; Int -&gt; IO ()) -&gt; IO ()
forall a. Int -&gt; Int -&gt; (Int -&gt; Int -&gt; a) -&gt; a
</span><a href="Data.Massiv.Core.Loop.html#splitLinearly"><span class="hs-identifier hs-var">splitLinearly</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244828"><span class="hs-identifier hs-var">nWorkers</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244825"><span class="hs-identifier hs-var">totalLength</span></a></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; Int -&gt; IO ()) -&gt; IO ()) -&gt; (Int -&gt; Int -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679244831"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244831"><span class="hs-identifier hs-var">chunkLength</span></a></span></span><span> </span><span id="local-6989586621679244832"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244832"><span class="hs-identifier hs-var">slackStart</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-312"></span><span>          </span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a.
Monad m =&gt;
Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; m a) -&gt; m ()
</span><a href="Data.Massiv.Core.Loop.html#loopM_"><span class="hs-identifier hs-var">loopM_</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244832"><span class="hs-identifier hs-var">slackStart</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244831"><span class="hs-identifier hs-var">chunkLength</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; IO ()) -&gt; IO ()) -&gt; (Int -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244833"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244833"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-313"></span><span>            </span><span class="annot"><span class="annottext">SchedulerWS ws () -&gt; (ws -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) ws.
MonadPrimBase RealWorld m =&gt;
SchedulerWS ws () -&gt; (ws -&gt; m ()) -&gt; m ()
</span><span class="hs-identifier hs-var">scheduleWorkState_</span></span><span> </span><span class="annot"><span class="annottext">SchedulerWS ws ()
</span><a href="#local-6989586621679244824"><span class="hs-identifier hs-var">schedulerWS</span></a></span><span> </span><span class="annot"><span class="annottext">((ws -&gt; IO ()) -&gt; IO ()) -&gt; (ws -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679244834"><span class="annot"><span class="annottext">ws
</span><a href="#local-6989586621679244834"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-314"></span><span>              </span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; IO c) -&gt; IO ()
forall (m :: * -&gt; *) a.
Monad m =&gt;
Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; m a) -&gt; m ()
</span><a href="Data.Massiv.Core.Loop.html#loopM_"><span class="hs-identifier hs-var">loopM_</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244833"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244833"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244831"><span class="hs-identifier hs-var">chunkLength</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; IO c) -&gt; IO ()) -&gt; (Int -&gt; IO c) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244835"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244835"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-315"></span><span>                </span><span class="annot"><span class="annottext">m c -&gt; IO c
forall a. m a -&gt; IO a
</span><a href="#local-6989586621679244830"><span class="hs-identifier hs-var">run</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ws -&gt; m b
</span><a href="#local-6989586621679244826"><span class="hs-identifier hs-var">make</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244835"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ws
</span><a href="#local-6989586621679244834"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">m b -&gt; (b -&gt; m c) -&gt; m c
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; b -&gt; m c
</span><a href="#local-6989586621679244827"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244835"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>          </span><span class="annot"><span class="annottext">SchedulerWS ws () -&gt; (ws -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) ws.
MonadPrimBase RealWorld m =&gt;
SchedulerWS ws () -&gt; (ws -&gt; m ()) -&gt; m ()
</span><span class="hs-identifier hs-var">scheduleWorkState_</span></span><span> </span><span class="annot"><span class="annottext">SchedulerWS ws ()
</span><a href="#local-6989586621679244824"><span class="hs-identifier hs-var">schedulerWS</span></a></span><span> </span><span class="annot"><span class="annottext">((ws -&gt; IO ()) -&gt; IO ()) -&gt; (ws -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679244836"><span class="annot"><span class="annottext">ws
</span><a href="#local-6989586621679244836"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-317"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; IO c) -&gt; IO ()
forall (m :: * -&gt; *) a.
Monad m =&gt;
Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; m a) -&gt; m ()
</span><a href="Data.Massiv.Core.Loop.html#loopM_"><span class="hs-identifier hs-var">loopM_</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244832"><span class="hs-identifier hs-var">slackStart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244825"><span class="hs-identifier hs-var">totalLength</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; IO c) -&gt; IO ()) -&gt; (Int -&gt; IO c) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244837"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244837"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-318"></span><span>              </span><span class="annot"><span class="annottext">m c -&gt; IO c
forall a. m a -&gt; IO a
</span><a href="#local-6989586621679244830"><span class="hs-identifier hs-var">run</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ws -&gt; m b
</span><a href="#local-6989586621679244826"><span class="hs-identifier hs-var">make</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244837"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ws
</span><a href="#local-6989586621679244836"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">m b -&gt; (b -&gt; m c) -&gt; m c
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; b -&gt; m c
</span><a href="#local-6989586621679244827"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244837"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitLinearlyWithStatefulM_"><span class="hs-pragma hs-type">splitLinearlyWithStatefulM_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="hs-comment">-- | This is a major helper function for fair splitting and parallelization of</span><span>
</span><span id="line-322"></span><span class="hs-comment">-- work with ability to use some arbitrary accumulator and splittable seed</span><span>
</span><span id="line-323"></span><span class="hs-comment">--</span><span>
</span><span id="line-324"></span><span class="hs-comment">-- @since 1.0.2</span><span>
</span><span id="line-325"></span><span id="local-6989586621679244444"><span id="local-6989586621679244445"><span id="local-6989586621679244446"><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitWorkWithFactorST"><span class="hs-identifier hs-type">splitWorkWithFactorST</span></a></span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-327"></span><span>  </span><span class="hs-comment">-- ^ Multiplying factor to be applied to number of workers for number</span><span>
</span><span id="line-328"></span><span>  </span><span class="hs-comment">-- of jobs to schedule. Higher the factor, more jobs will be</span><span>
</span><span id="line-329"></span><span>  </span><span class="hs-comment">-- scheduled. Only positive values are valid.</span><span>
</span><span id="line-330"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Scheduler</span></span><span> </span><span class="annot"><a href="#local-6989586621679244444"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244445"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-331"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-332"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Starting index</span></span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-334"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Stepping value. Can be negative, but must not be zero.</span></span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-336"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Total number of steps to be taken</span></span><span>
</span><span id="line-337"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244446"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-338"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Initial value for an accumulator</span></span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679244446"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679244444"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679244446"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679244446"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ An action to split accumulator for multiple threads</span></span><span>
</span><span id="line-341"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244446"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679244444"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244445"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>  </span><span class="hs-comment">-- ^ A job to be scheduled. Accepts:</span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-344"></span><span>  </span><span class="hs-comment">-- * Chunk index start</span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-comment">-- * Chunk length</span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-comment">-- * Chunk start index adjusted for supplied start and stepping value</span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-comment">-- * Chunk stop index adjusted for supplied start and stepping value</span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679244444"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244446"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-349"></span><span id="splitWorkWithFactorST"><span class="annot"><span class="annottext">splitWorkWithFactorST :: forall s a b.
Int
-&gt; Scheduler s a
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; b
-&gt; (b -&gt; ST s (b, b))
-&gt; (Int -&gt; Int -&gt; Int -&gt; Int -&gt; b -&gt; ST s a)
-&gt; ST s b
</span><a href="Data.Massiv.Core.Loop.html#splitWorkWithFactorST"><span class="hs-identifier hs-var hs-var">splitWorkWithFactorST</span></a></span></span><span> </span><span id="local-6989586621679244865"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244865"><span class="hs-identifier hs-var">fact</span></a></span></span><span> </span><span id="local-6989586621679244866"><span class="annot"><span class="annottext">Scheduler s a
</span><a href="#local-6989586621679244866"><span class="hs-identifier hs-var">scheduler</span></a></span></span><span> </span><span id="local-6989586621679244867"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244867"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621679244868"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244868"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span id="local-6989586621679244869"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244869"><span class="hs-identifier hs-var">totalLength</span></a></span></span><span> </span><span id="local-6989586621679244870"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679244870"><span class="hs-identifier hs-var">initAcc</span></a></span></span><span> </span><span id="local-6989586621679244871"><span class="annot"><span class="annottext">b -&gt; ST s (b, b)
</span><a href="#local-6989586621679244871"><span class="hs-identifier hs-var">splitAcc</span></a></span></span><span> </span><span id="local-6989586621679244872"><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; Int -&gt; b -&gt; ST s a
</span><a href="#local-6989586621679244872"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-350"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span id="local-6989586621679244873"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244873"><span class="hs-identifier hs-var">chunkLength</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679244874"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244874"><span class="hs-identifier hs-var">slackStart</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; (Int, Int)
</span><a href="Data.Massiv.Core.Loop.html#splitNumChunks"><span class="hs-identifier hs-var">splitNumChunks</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244865"><span class="hs-identifier hs-var">fact</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scheduler s a -&gt; Int
forall s a. Scheduler s a -&gt; Int
</span><span class="hs-identifier hs-var">numWorkers</span></span><span> </span><span class="annot"><span class="annottext">Scheduler s a
</span><a href="#local-6989586621679244866"><span class="hs-identifier hs-var">scheduler</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244869"><span class="hs-identifier hs-var">totalLength</span></a></span><span>
</span><span id="line-351"></span><span>  </span><span id="local-6989586621679244875"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679244875"><span class="hs-identifier hs-var">slackAcc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-352"></span><span>    </span><span class="annot"><span class="annottext">Int
-&gt; (Int -&gt; Bool)
-&gt; (Int -&gt; Int)
-&gt; b
-&gt; (Int -&gt; b -&gt; ST s b)
-&gt; ST s b
forall (m :: * -&gt; *) a.
Monad m =&gt;
Int
-&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; a -&gt; (Int -&gt; a -&gt; m a) -&gt; m a
</span><a href="Data.Massiv.Core.Loop.html#loopM"><span class="hs-identifier hs-var">loopM</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244874"><span class="hs-identifier hs-var">slackStart</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244873"><span class="hs-identifier hs-var">chunkLength</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679244870"><span class="hs-identifier hs-var">initAcc</span></a></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; b -&gt; ST s b) -&gt; ST s b) -&gt; (Int -&gt; b -&gt; ST s b) -&gt; ST s b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244876"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244876"><span class="hs-identifier hs-var">chunkStart</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244877"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679244877"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-353"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679244878"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679244878"><span class="hs-identifier hs-var">accCur</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679244879"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679244879"><span class="hs-identifier hs-var">accNext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">b -&gt; ST s (b, b)
</span><a href="#local-6989586621679244871"><span class="hs-identifier hs-var">splitAcc</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679244877"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-354"></span><span>      </span><span class="annot"><span class="annottext">Scheduler (PrimState (ST s)) a -&gt; ST s a -&gt; ST s ()
forall (m :: * -&gt; *) a.
PrimBase m =&gt;
Scheduler (PrimState m) a -&gt; m a -&gt; m ()
</span><a href="Data.Massiv.Core.Loop.html#scheduleMassivWork"><span class="hs-identifier hs-var">scheduleMassivWork</span></a></span><span> </span><span class="annot"><span class="annottext">Scheduler s a
Scheduler (PrimState (ST s)) a
</span><a href="#local-6989586621679244866"><span class="hs-identifier hs-var">scheduler</span></a></span><span> </span><span class="annot"><span class="annottext">(ST s a -&gt; ST s ()) -&gt; ST s a -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-355"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244880"><span class="annot"><span class="annottext">chunkStartAdj :: Int
</span><a href="#local-6989586621679244880"><span class="hs-identifier hs-var hs-var">chunkStartAdj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244867"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244876"><span class="hs-identifier hs-var">chunkStart</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244868"><span class="hs-identifier hs-var">step</span></a></span><span>
</span><span id="line-356"></span><span>            </span><span class="hs-glyph">!</span><span id="local-6989586621679244881"><span class="annot"><span class="annottext">chunkStopAdj :: Int
</span><a href="#local-6989586621679244881"><span class="hs-identifier hs-var hs-var">chunkStopAdj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244880"><span class="hs-identifier hs-var">chunkStartAdj</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244873"><span class="hs-identifier hs-var">chunkLength</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244868"><span class="hs-identifier hs-var">step</span></a></span><span>
</span><span id="line-357"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; Int -&gt; b -&gt; ST s a
</span><a href="#local-6989586621679244872"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244876"><span class="hs-identifier hs-var">chunkStart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244873"><span class="hs-identifier hs-var">chunkLength</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244880"><span class="hs-identifier hs-var">chunkStartAdj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244881"><span class="hs-identifier hs-var">chunkStopAdj</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679244878"><span class="hs-identifier hs-var">accCur</span></a></span><span>
</span><span id="line-358"></span><span>      </span><span class="annot"><span class="annottext">b -&gt; ST s b
forall a. a -&gt; ST s a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679244879"><span class="hs-identifier hs-var">accNext</span></a></span><span>
</span><span id="line-359"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244882"><span class="annot"><span class="annottext">slackLength :: Int
</span><a href="#local-6989586621679244882"><span class="hs-identifier hs-var hs-var">slackLength</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244869"><span class="hs-identifier hs-var">totalLength</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244874"><span class="hs-identifier hs-var">slackStart</span></a></span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244882"><span class="hs-identifier hs-var">slackLength</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-362"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679244884"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679244884"><span class="hs-identifier hs-var">curAcc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679244885"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679244885"><span class="hs-identifier hs-var">nextAcc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">b -&gt; ST s (b, b)
</span><a href="#local-6989586621679244871"><span class="hs-identifier hs-var">splitAcc</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679244875"><span class="hs-identifier hs-var">slackAcc</span></a></span><span>
</span><span id="line-363"></span><span>      </span><span class="annot"><span class="annottext">Scheduler (PrimState (ST s)) a -&gt; ST s a -&gt; ST s ()
forall (m :: * -&gt; *) a.
PrimBase m =&gt;
Scheduler (PrimState m) a -&gt; m a -&gt; m ()
</span><a href="Data.Massiv.Core.Loop.html#scheduleMassivWork"><span class="hs-identifier hs-var">scheduleMassivWork</span></a></span><span> </span><span class="annot"><span class="annottext">Scheduler s a
Scheduler (PrimState (ST s)) a
</span><a href="#local-6989586621679244866"><span class="hs-identifier hs-var">scheduler</span></a></span><span> </span><span class="annot"><span class="annottext">(ST s a -&gt; ST s ()) -&gt; ST s a -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-364"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679244886"><span class="annot"><span class="annottext">slackStartAdj :: Int
</span><a href="#local-6989586621679244886"><span class="hs-identifier hs-var hs-var">slackStartAdj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244867"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244874"><span class="hs-identifier hs-var">slackStart</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244868"><span class="hs-identifier hs-var">step</span></a></span><span>
</span><span id="line-365"></span><span>            </span><span class="hs-glyph">!</span><span id="local-6989586621679244887"><span class="annot"><span class="annottext">slackStopAdj :: Int
</span><a href="#local-6989586621679244887"><span class="hs-identifier hs-var hs-var">slackStopAdj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244886"><span class="hs-identifier hs-var">slackStartAdj</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244882"><span class="hs-identifier hs-var">slackLength</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244868"><span class="hs-identifier hs-var">step</span></a></span><span>
</span><span id="line-366"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; Int -&gt; b -&gt; ST s a
</span><a href="#local-6989586621679244872"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244874"><span class="hs-identifier hs-var">slackStart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244882"><span class="hs-identifier hs-var">slackLength</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244886"><span class="hs-identifier hs-var">slackStartAdj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244887"><span class="hs-identifier hs-var">slackStopAdj</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679244884"><span class="hs-identifier hs-var">curAcc</span></a></span><span>
</span><span id="line-367"></span><span>      </span><span class="annot"><span class="annottext">b -&gt; ST s b
forall a. a -&gt; ST s a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679244885"><span class="hs-identifier hs-var">nextAcc</span></a></span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">b -&gt; ST s b
forall a. a -&gt; ST s a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679244875"><span class="hs-identifier hs-var">slackAcc</span></a></span><span>
</span><span id="line-369"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitWorkWithFactorST"><span class="hs-pragma hs-type">splitWorkWithFactorST</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span class="hs-comment">-- | Linear iterator that supports multiplying factor</span><span>
</span><span id="line-372"></span><span class="hs-comment">--</span><span>
</span><span id="line-373"></span><span class="hs-comment">-- @since 1.0.2</span><span>
</span><span id="line-374"></span><span id="local-6989586621679244456"><span id="local-6989586621679244457"><span class="annot"><a href="Data.Massiv.Core.Loop.html#iterLinearST_"><span class="hs-identifier hs-type">iterLinearST_</span></a></span><span>
</span><span id="line-375"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-376"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Scheduler</span></span><span> </span><span class="annot"><a href="#local-6989586621679244456"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-379"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679244456"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244457"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679244456"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-382"></span><span id="iterLinearST_"><span class="annot"><span class="annottext">iterLinearST_ :: forall s a.
Int
-&gt; Scheduler s ()
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; (Int -&gt; ST s a)
-&gt; ST s ()
</span><a href="Data.Massiv.Core.Loop.html#iterLinearST_"><span class="hs-identifier hs-var hs-var">iterLinearST_</span></a></span></span><span> </span><span id="local-6989586621679244894"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244894"><span class="hs-identifier hs-var">fact</span></a></span></span><span> </span><span id="local-6989586621679244895"><span class="annot"><span class="annottext">Scheduler s ()
</span><a href="#local-6989586621679244895"><span class="hs-identifier hs-var">scheduler</span></a></span></span><span> </span><span id="local-6989586621679244896"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244896"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621679244897"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244897"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span id="local-6989586621679244898"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244898"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679244899"><span class="annot"><span class="annottext">Int -&gt; ST s a
</span><a href="#local-6989586621679244899"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679244900"><span class="annot"><span class="annottext">totalLength :: Int
</span><a href="#local-6989586621679244900"><span class="hs-identifier hs-var hs-var">totalLength</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244898"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244896"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`quot`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244897"><span class="hs-identifier hs-var">step</span></a></span><span>
</span><span id="line-384"></span><span>  </span><span class="annot"><span class="annottext">Int
-&gt; Scheduler s ()
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; ()
-&gt; (() -&gt; ST s ((), ()))
-&gt; (Int -&gt; Int -&gt; Int -&gt; Int -&gt; () -&gt; ST s ())
-&gt; ST s ()
forall s a b.
Int
-&gt; Scheduler s a
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; b
-&gt; (b -&gt; ST s (b, b))
-&gt; (Int -&gt; Int -&gt; Int -&gt; Int -&gt; b -&gt; ST s a)
-&gt; ST s b
</span><a href="Data.Massiv.Core.Loop.html#splitWorkWithFactorST"><span class="hs-identifier hs-var">splitWorkWithFactorST</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244894"><span class="hs-identifier hs-var">fact</span></a></span><span> </span><span class="annot"><span class="annottext">Scheduler s ()
</span><a href="#local-6989586621679244895"><span class="hs-identifier hs-var">scheduler</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244896"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244897"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244900"><span class="hs-identifier hs-var">totalLength</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((), ()) -&gt; ST s ((), ())
forall a. a -&gt; ST s a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; Int -&gt; Int -&gt; Int -&gt; () -&gt; ST s ()) -&gt; ST s ())
-&gt; (Int -&gt; Int -&gt; Int -&gt; Int -&gt; () -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-385"></span><span>    </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679244901"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244901"><span class="hs-identifier hs-var">chunkStartAdj</span></a></span></span><span> </span><span id="local-6989586621679244902"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244902"><span class="hs-identifier hs-var">chunkStopAdj</span></a></span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-386"></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; ST s a) -&gt; ST s ()
forall (f :: * -&gt; *) a.
Applicative f =&gt;
Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; (Int -&gt; f a) -&gt; f ()
</span><a href="Data.Massiv.Core.Loop.html#loopA_"><span class="hs-identifier hs-var">loopA_</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244901"><span class="hs-identifier hs-var">chunkStartAdj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244902"><span class="hs-identifier hs-var">chunkStopAdj</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244897"><span class="hs-identifier hs-var">step</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s a
</span><a href="#local-6989586621679244899"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-387"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#iterLinearST_"><span class="hs-pragma hs-type">iterLinearST_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span class="hs-comment">-- | Linear iterator that supports multiplying factor and accumulator, but the results are discarded.</span><span>
</span><span id="line-390"></span><span class="hs-comment">--</span><span>
</span><span id="line-391"></span><span class="hs-comment">-- @since 1.0.2</span><span>
</span><span id="line-392"></span><span id="local-6989586621679244460"><span id="local-6989586621679244461"><span class="annot"><a href="Data.Massiv.Core.Loop.html#iterLinearAccST_"><span class="hs-identifier hs-type">iterLinearAccST_</span></a></span><span>
</span><span id="line-393"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-394"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Scheduler</span></span><span> </span><span class="annot"><a href="#local-6989586621679244460"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-396"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-397"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-398"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244461"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-399"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679244461"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679244460"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679244461"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679244461"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244461"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679244460"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244461"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679244460"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-402"></span><span id="iterLinearAccST_"><span class="annot"><span class="annottext">iterLinearAccST_ :: forall s a.
Int
-&gt; Scheduler s ()
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; a
-&gt; (a -&gt; ST s (a, a))
-&gt; (Int -&gt; a -&gt; ST s a)
-&gt; ST s ()
</span><a href="Data.Massiv.Core.Loop.html#iterLinearAccST_"><span class="hs-identifier hs-var hs-var">iterLinearAccST_</span></a></span></span><span> </span><span id="local-6989586621679244911"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244911"><span class="hs-identifier hs-var">fact</span></a></span></span><span> </span><span id="local-6989586621679244912"><span class="annot"><span class="annottext">Scheduler s ()
</span><a href="#local-6989586621679244912"><span class="hs-identifier hs-var">scheduler</span></a></span></span><span> </span><span id="local-6989586621679244913"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244913"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621679244914"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244914"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span id="local-6989586621679244915"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244915"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679244916"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244916"><span class="hs-identifier hs-var">initAcc</span></a></span></span><span> </span><span id="local-6989586621679244917"><span class="annot"><span class="annottext">a -&gt; ST s (a, a)
</span><a href="#local-6989586621679244917"><span class="hs-identifier hs-var">splitAcc</span></a></span></span><span> </span><span id="local-6989586621679244918"><span class="annot"><span class="annottext">Int -&gt; a -&gt; ST s a
</span><a href="#local-6989586621679244918"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-403"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679244919"><span class="annot"><span class="annottext">totalLength :: Int
</span><a href="#local-6989586621679244919"><span class="hs-identifier hs-var hs-var">totalLength</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244915"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244913"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`quot`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244914"><span class="hs-identifier hs-var">step</span></a></span><span>
</span><span id="line-404"></span><span>  </span><span class="annot"><span class="annottext">ST s a -&gt; ST s ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(ST s a -&gt; ST s ()) -&gt; ST s a -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-405"></span><span>    </span><span class="annot"><span class="annottext">Int
-&gt; Scheduler s ()
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; a
-&gt; (a -&gt; ST s (a, a))
-&gt; (Int -&gt; Int -&gt; Int -&gt; Int -&gt; a -&gt; ST s ())
-&gt; ST s a
forall s a b.
Int
-&gt; Scheduler s a
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; b
-&gt; (b -&gt; ST s (b, b))
-&gt; (Int -&gt; Int -&gt; Int -&gt; Int -&gt; b -&gt; ST s a)
-&gt; ST s b
</span><a href="Data.Massiv.Core.Loop.html#splitWorkWithFactorST"><span class="hs-identifier hs-var">splitWorkWithFactorST</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244911"><span class="hs-identifier hs-var">fact</span></a></span><span> </span><span class="annot"><span class="annottext">Scheduler s ()
</span><a href="#local-6989586621679244912"><span class="hs-identifier hs-var">scheduler</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244913"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244914"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244919"><span class="hs-identifier hs-var">totalLength</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244916"><span class="hs-identifier hs-var">initAcc</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; ST s (a, a)
</span><a href="#local-6989586621679244917"><span class="hs-identifier hs-var">splitAcc</span></a></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; Int -&gt; Int -&gt; Int -&gt; a -&gt; ST s ()) -&gt; ST s a)
-&gt; (Int -&gt; Int -&gt; Int -&gt; Int -&gt; a -&gt; ST s ()) -&gt; ST s a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-406"></span><span>      </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679244920"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244920"><span class="hs-identifier hs-var">chunkStartAdj</span></a></span></span><span> </span><span id="local-6989586621679244921"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244921"><span class="hs-identifier hs-var">chunkStopAdj</span></a></span></span><span> </span><span id="local-6989586621679244922"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244922"><span class="hs-identifier hs-var">accCur</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-407"></span><span>        </span><span class="annot"><span class="annottext">ST s a -&gt; ST s ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(ST s a -&gt; ST s ()) -&gt; ST s a -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; (Int -&gt; Bool)
-&gt; (Int -&gt; Int)
-&gt; a
-&gt; (Int -&gt; a -&gt; ST s a)
-&gt; ST s a
forall (m :: * -&gt; *) a.
Monad m =&gt;
Int
-&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; a -&gt; (Int -&gt; a -&gt; m a) -&gt; m a
</span><a href="Data.Massiv.Core.Loop.html#loopM"><span class="hs-identifier hs-var">loopM</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244920"><span class="hs-identifier hs-var">chunkStartAdj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244921"><span class="hs-identifier hs-var">chunkStopAdj</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244914"><span class="hs-identifier hs-var">step</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244922"><span class="hs-identifier hs-var">accCur</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; a -&gt; ST s a
</span><a href="#local-6989586621679244918"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-408"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#iterLinearAccST_"><span class="hs-pragma hs-type">iterLinearAccST_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span class="hs-comment">-- | Linear iterator that supports multiplying factor and accumulator. Results</span><span>
</span><span id="line-411"></span><span class="hs-comment">-- of actions are stored in the scheduler.</span><span>
</span><span id="line-412"></span><span class="hs-comment">--</span><span>
</span><span id="line-413"></span><span class="hs-comment">-- @since 1.0.2</span><span>
</span><span id="line-414"></span><span id="local-6989586621679244467"><span id="local-6989586621679244468"><span class="annot"><a href="Data.Massiv.Core.Loop.html#iterLinearAccST"><span class="hs-identifier hs-type">iterLinearAccST</span></a></span><span>
</span><span id="line-415"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-416"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Scheduler</span></span><span> </span><span class="annot"><a href="#local-6989586621679244467"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244468"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-418"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-419"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Step. Must be non-zero</span></span><span>
</span><span id="line-420"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244468"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-422"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679244468"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679244467"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679244468"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679244468"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244468"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679244467"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244468"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679244467"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244468"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-425"></span><span id="iterLinearAccST"><span class="annot"><span class="annottext">iterLinearAccST :: forall s a.
Int
-&gt; Scheduler s a
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; a
-&gt; (a -&gt; ST s (a, a))
-&gt; (Int -&gt; a -&gt; ST s a)
-&gt; ST s a
</span><a href="Data.Massiv.Core.Loop.html#iterLinearAccST"><span class="hs-identifier hs-var hs-var">iterLinearAccST</span></a></span></span><span> </span><span id="local-6989586621679244928"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244928"><span class="hs-identifier hs-var">fact</span></a></span></span><span> </span><span id="local-6989586621679244929"><span class="annot"><span class="annottext">Scheduler s a
</span><a href="#local-6989586621679244929"><span class="hs-identifier hs-var">scheduler</span></a></span></span><span> </span><span id="local-6989586621679244930"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244930"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621679244931"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244931"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span id="local-6989586621679244932"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244932"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679244933"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244933"><span class="hs-identifier hs-var">initAcc</span></a></span></span><span> </span><span id="local-6989586621679244934"><span class="annot"><span class="annottext">a -&gt; ST s (a, a)
</span><a href="#local-6989586621679244934"><span class="hs-identifier hs-var">splitAcc</span></a></span></span><span> </span><span id="local-6989586621679244935"><span class="annot"><span class="annottext">Int -&gt; a -&gt; ST s a
</span><a href="#local-6989586621679244935"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679244936"><span class="annot"><span class="annottext">totalLength :: Int
</span><a href="#local-6989586621679244936"><span class="hs-identifier hs-var hs-var">totalLength</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244932"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244930"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`quot`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244931"><span class="hs-identifier hs-var">step</span></a></span><span>
</span><span id="line-427"></span><span>  </span><span class="annot"><span class="annottext">Int
-&gt; Scheduler s a
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; a
-&gt; (a -&gt; ST s (a, a))
-&gt; (Int -&gt; Int -&gt; Int -&gt; Int -&gt; a -&gt; ST s a)
-&gt; ST s a
forall s a b.
Int
-&gt; Scheduler s a
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; b
-&gt; (b -&gt; ST s (b, b))
-&gt; (Int -&gt; Int -&gt; Int -&gt; Int -&gt; b -&gt; ST s a)
-&gt; ST s b
</span><a href="Data.Massiv.Core.Loop.html#splitWorkWithFactorST"><span class="hs-identifier hs-var">splitWorkWithFactorST</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244928"><span class="hs-identifier hs-var">fact</span></a></span><span> </span><span class="annot"><span class="annottext">Scheduler s a
</span><a href="#local-6989586621679244929"><span class="hs-identifier hs-var">scheduler</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244930"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244931"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244936"><span class="hs-identifier hs-var">totalLength</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244933"><span class="hs-identifier hs-var">initAcc</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; ST s (a, a)
</span><a href="#local-6989586621679244934"><span class="hs-identifier hs-var">splitAcc</span></a></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; Int -&gt; Int -&gt; Int -&gt; a -&gt; ST s a) -&gt; ST s a)
-&gt; (Int -&gt; Int -&gt; Int -&gt; Int -&gt; a -&gt; ST s a) -&gt; ST s a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-428"></span><span>    </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679244937"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244937"><span class="hs-identifier hs-var">chunkStartAdj</span></a></span></span><span> </span><span id="local-6989586621679244938"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244938"><span class="hs-identifier hs-var">chunkStopAdj</span></a></span></span><span> </span><span id="local-6989586621679244939"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244939"><span class="hs-identifier hs-var">accCur</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-429"></span><span>      </span><span class="annot"><span class="annottext">Int
-&gt; (Int -&gt; Bool)
-&gt; (Int -&gt; Int)
-&gt; a
-&gt; (Int -&gt; a -&gt; ST s a)
-&gt; ST s a
forall (m :: * -&gt; *) a.
Monad m =&gt;
Int
-&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; a -&gt; (Int -&gt; a -&gt; m a) -&gt; m a
</span><a href="Data.Massiv.Core.Loop.html#loopM"><span class="hs-identifier hs-var">loopM</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244937"><span class="hs-identifier hs-var">chunkStartAdj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244938"><span class="hs-identifier hs-var">chunkStopAdj</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244931"><span class="hs-identifier hs-var">step</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679244939"><span class="hs-identifier hs-var">accCur</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; a -&gt; ST s a
</span><a href="#local-6989586621679244935"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-430"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#iterLinearAccST"><span class="hs-pragma hs-type">iterLinearAccST</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span class="annot"><span class="hs-comment">-- | Helper for figuring out the chunk length and slack start</span></span><span>
</span><span id="line-433"></span><span class="annot"><a href="Data.Massiv.Core.Loop.html#splitNumChunks"><span class="hs-identifier hs-type">splitNumChunks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span id="splitNumChunks"><span class="annot"><span class="annottext">splitNumChunks :: Int -&gt; Int -&gt; Int -&gt; (Int, Int)
</span><a href="Data.Massiv.Core.Loop.html#splitNumChunks"><span class="hs-identifier hs-var hs-var">splitNumChunks</span></a></span></span><span> </span><span id="local-6989586621679244940"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244940"><span class="hs-identifier hs-var">fact</span></a></span></span><span> </span><span id="local-6989586621679244941"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244941"><span class="hs-identifier hs-var">nw</span></a></span></span><span> </span><span id="local-6989586621679244942"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244942"><span class="hs-identifier hs-var">totalLength</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679244943"><span class="annot"><span class="annottext">maxNumChunks :: Int
</span><a href="#local-6989586621679244943"><span class="hs-identifier hs-var hs-var">maxNumChunks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244941"><span class="hs-identifier hs-var">nw</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244940"><span class="hs-identifier hs-var">fact</span></a></span><span>
</span><span id="line-436"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621679244945"><span class="annot"><span class="annottext">numChunks :: Int
</span><a href="#local-6989586621679244945"><span class="hs-identifier hs-var hs-var">numChunks</span></a></span></span><span>
</span><span id="line-437"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244941"><span class="hs-identifier hs-var">nw</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244942"><span class="hs-identifier hs-var">totalLength</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-comment">-- Optimize for Seq and avoid `quot` by 0.</span><span>
</span><span id="line-438"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244942"><span class="hs-identifier hs-var">totalLength</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244941"><span class="hs-identifier hs-var">nw</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244942"><span class="hs-identifier hs-var">totalLength</span></a></span><span>
</span><span id="line-439"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244942"><span class="hs-identifier hs-var">totalLength</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244943"><span class="hs-identifier hs-var">maxNumChunks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244943"><span class="hs-identifier hs-var">maxNumChunks</span></a></span><span>
</span><span id="line-440"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244941"><span class="hs-identifier hs-var">nw</span></a></span><span>
</span><span id="line-441"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621679244948"><span class="annot"><span class="annottext">chunkLength :: Int
</span><a href="#local-6989586621679244948"><span class="hs-identifier hs-var hs-var">chunkLength</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244942"><span class="hs-identifier hs-var">totalLength</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`quot`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244945"><span class="hs-identifier hs-var">numChunks</span></a></span><span>
</span><span id="line-442"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621679244949"><span class="annot"><span class="annottext">slackStart :: Int
</span><a href="#local-6989586621679244949"><span class="hs-identifier hs-var hs-var">slackStart</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244948"><span class="hs-identifier hs-var">chunkLength</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244945"><span class="hs-identifier hs-var">numChunks</span></a></span><span>
</span><span id="line-443"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244948"><span class="hs-identifier hs-var">chunkLength</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244949"><span class="hs-identifier hs-var">slackStart</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>
</span><span id="line-445"></span><span class="annot"><span class="hs-comment">-- | Helper for adjusting stride of a chunk</span></span><span>
</span><span id="line-446"></span><span class="annot"><a href="Data.Massiv.Core.Loop.html#stepStartAdjust"><span class="hs-identifier hs-type">stepStartAdjust</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-447"></span><span id="stepStartAdjust"><span class="annot"><span class="annottext">stepStartAdjust :: Int -&gt; Int -&gt; Int
</span><a href="Data.Massiv.Core.Loop.html#stepStartAdjust"><span class="hs-identifier hs-var hs-var">stepStartAdjust</span></a></span></span><span> </span><span id="local-6989586621679244950"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244950"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span id="local-6989586621679244951"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244951"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244951"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244950"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244951"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244950"><span class="hs-identifier hs-var">step</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679244950"><span class="hs-identifier hs-var">step</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#stepStartAdjust"><span class="hs-pragma hs-type">stepStartAdjust</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span class="hs-comment">-- | Internal version of a `scheduleWork` that will be replaced by</span><span>
</span><span id="line-451"></span><span class="hs-comment">-- `scheduleWork_` by the compiler whenever action produces `()`</span><span>
</span><span id="line-452"></span><span id="local-6989586621679244454"><span id="local-6989586621679244455"><span class="annot"><a href="Data.Massiv.Core.Loop.html#scheduleMassivWork"><span class="hs-identifier hs-type">scheduleMassivWork</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PrimBase</span></span><span> </span><span class="annot"><a href="#local-6989586621679244454"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Scheduler</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PrimState</span></span><span> </span><span class="annot"><a href="#local-6989586621679244454"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679244455"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244454"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244455"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679244454"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-453"></span><span id="scheduleMassivWork"><span class="annot"><span class="annottext">scheduleMassivWork :: forall (m :: * -&gt; *) a.
PrimBase m =&gt;
Scheduler (PrimState m) a -&gt; m a -&gt; m ()
</span><a href="Data.Massiv.Core.Loop.html#scheduleMassivWork"><span class="hs-identifier hs-var hs-var">scheduleMassivWork</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scheduler (PrimState m) a -&gt; m a -&gt; m ()
forall s (m :: * -&gt; *) a.
MonadPrimBase s m =&gt;
Scheduler s a -&gt; m a -&gt; m ()
</span><span class="hs-identifier hs-var">scheduleWork</span></span><span>
</span><span id="line-454"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">0</span><span class="hs-pragma">]</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#scheduleMassivWork"><span class="hs-pragma hs-type">scheduleMassivWork</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span class="hs-pragma">{-# RULES</span><span>
</span><span id="line-457"></span><span id="local-6989586621679244958"><span class="annot"><span class="hs-pragma">&quot;scheduleWork/scheduleWork_/ST&quot;</span></span><span> </span><span class="hs-pragma">forall</span><span> </span><span class="hs-pragma">(</span><span id="local-6989586621679244959"><span class="annot"><a href="#local-6989586621679244959"><span class="hs-pragma hs-var">scheduler</span></a></span></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Scheduler</span></span><span> </span><span class="annot"><a href="#local-6989586621679244958"><span class="hs-pragma hs-type">s</span></a></span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">(</span><span id="local-6989586621679244960"><span class="annot"><a href="#local-6989586621679244960"><span class="hs-pragma hs-var">action</span></a></span></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679244958"><span class="hs-pragma hs-type">s</span></a></span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#scheduleMassivWork"><span class="hs-pragma hs-type">scheduleMassivWork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244959"><span class="hs-pragma hs-type">scheduler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244960"><span class="hs-pragma hs-type">action</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><span class="hs-pragma hs-type">scheduleWork_</span></span><span> </span><span class="annot"><a href="#local-6989586621679244959"><span class="hs-pragma hs-type">scheduler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244960"><span class="hs-pragma hs-type">action</span></a></span></span><span>
</span><span id="line-458"></span><span class="annot"><span class="hs-pragma">&quot;scheduleWork/scheduleWork_/IO&quot;</span></span><span> </span><span class="hs-pragma">forall</span><span> </span><span class="hs-pragma">(</span><span id="local-6989586621679244961"><span class="annot"><a href="#local-6989586621679244961"><span class="hs-pragma hs-var">scheduler</span></a></span></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Scheduler</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">RealWorld</span></span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">(</span><span id="local-6989586621679244962"><span class="annot"><a href="#local-6989586621679244962"><span class="hs-pragma hs-var">action</span></a></span></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">IO</span></span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#scheduleMassivWork"><span class="hs-pragma hs-type">scheduleMassivWork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244961"><span class="hs-pragma hs-type">scheduler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244962"><span class="hs-pragma hs-type">action</span></a></span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><span class="hs-pragma hs-type">scheduleWork_</span></span><span> </span><span class="annot"><a href="#local-6989586621679244961"><span class="hs-pragma hs-type">scheduler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679244962"><span class="hs-pragma hs-type">action</span></a></span><span>
</span><span id="line-459"></span><span>  </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span class="hs-comment">-- | Selects an optimal scheduler for the supplied strategy, but it works only in `IO`</span><span>
</span><span id="line-462"></span><span class="hs-comment">--</span><span>
</span><span id="line-463"></span><span class="hs-comment">-- @since 1.0.0</span><span>
</span><span id="line-464"></span><span class="annot"><a href="Data.Massiv.Core.Loop.html#withMassivScheduler_"><span class="hs-identifier hs-type">withMassivScheduler_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Comp</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Scheduler</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span id="withMassivScheduler_"><span class="annot"><span class="annottext">withMassivScheduler_ :: Comp -&gt; (Scheduler RealWorld () -&gt; IO ()) -&gt; IO ()
</span><a href="Data.Massiv.Core.Loop.html#withMassivScheduler_"><span class="hs-identifier hs-var hs-var">withMassivScheduler_</span></a></span></span><span> </span><span id="local-6989586621679244963"><span class="annot"><span class="annottext">Comp
</span><a href="#local-6989586621679244963"><span class="hs-identifier hs-var">comp</span></a></span></span><span> </span><span id="local-6989586621679244964"><span class="annot"><span class="annottext">Scheduler RealWorld () -&gt; IO ()
</span><a href="#local-6989586621679244964"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-466"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Comp
</span><a href="#local-6989586621679244963"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-467"></span><span>    </span><span class="annot"><span class="annottext">Comp
</span><span class="hs-identifier hs-var">Par</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GlobalScheduler -&gt; (Scheduler RealWorld () -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a.
MonadUnliftIO m =&gt;
GlobalScheduler -&gt; (Scheduler RealWorld () -&gt; m a) -&gt; m ()
</span><span class="hs-identifier hs-var">withGlobalScheduler_</span></span><span> </span><span class="annot"><span class="annottext">GlobalScheduler
</span><span class="hs-identifier hs-var">globalScheduler</span></span><span> </span><span class="annot"><span class="annottext">Scheduler RealWorld () -&gt; IO ()
</span><a href="#local-6989586621679244964"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-468"></span><span>    </span><span class="annot"><span class="annottext">Comp
</span><span class="hs-identifier hs-var">Seq</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Scheduler RealWorld () -&gt; IO ()
</span><a href="#local-6989586621679244964"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Scheduler RealWorld ()
forall s. Scheduler s ()
</span><span class="hs-identifier hs-var">trivialScheduler_</span></span><span>
</span><span id="line-469"></span><span>    </span><span class="annot"><span class="annottext">Comp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Comp -&gt; (Scheduler RealWorld () -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a b.
MonadUnliftIO m =&gt;
Comp -&gt; (Scheduler RealWorld a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">withScheduler_</span></span><span> </span><span class="annot"><span class="annottext">Comp
</span><a href="#local-6989586621679244963"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="annot"><span class="annottext">Scheduler RealWorld () -&gt; IO ()
</span><a href="#local-6989586621679244964"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-470"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Loop.html#withMassivScheduler_"><span class="hs-pragma hs-type">withMassivScheduler_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-471"></span></pre></body></html>