<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Module      : Data.Massiv.Array.Numeric.Integral</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Copyright   : (c) Alexey Kuleshevich 2018-2022</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- License     : BSD3</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Maintainer  : Alexey Kuleshevich &lt;lehins@yandex.ru&gt;</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Stability   : experimental</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Portability : non-portable</span><span>
</span><span id="line-11"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.Massiv.Array.Numeric.Integral</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-12"></span><span>  </span><span class="annot"><span class="hs-comment">-- $integral_intro</span></span><span>
</span><span id="line-13"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#midpointRule"><span class="hs-identifier">midpointRule</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#midpointStencil"><span class="hs-identifier">midpointStencil</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Trapezoid Rule</span></span><span>
</span><span id="line-17"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#trapezoidRule"><span class="hs-identifier">trapezoidRule</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#trapezoidStencil"><span class="hs-identifier">trapezoidStencil</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Simpson's Rule</span></span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#simpsonsRule"><span class="hs-identifier">simpsonsRule</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#simpsonsStencil"><span class="hs-identifier">simpsonsStencil</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><span class="hs-comment">-- * General Integral approximation</span></span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#integrateWith"><span class="hs-identifier">integrateWith</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#integralApprox"><span class="hs-identifier">integralApprox</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><span class="hs-comment">-- * From functions</span></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Sampled at the edge</span></span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#fromFunction"><span class="hs-identifier">fromFunction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Sampled at the midpoint</span></span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#fromFunctionMidpoint"><span class="hs-identifier">fromFunctionMidpoint</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Coerce</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Delayed.Pull.html"><span class="hs-identifier">Data.Massiv.Array.Delayed.Pull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Array.Delayed.Pull.html#D"><span class="hs-identifier">D</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Delayed.Windowed.html"><span class="hs-identifier">Data.Massiv.Array.Delayed.Windowed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Array.Delayed.Windowed.html#DW"><span class="hs-identifier">DW</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Manifest.Internal.html"><span class="hs-identifier">Data.Massiv.Array.Manifest.Internal</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Ops.Construct.html"><span class="hs-identifier">Data.Massiv.Array.Ops.Construct</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Array.Ops.Construct.html#rangeInclusive"><span class="hs-identifier">rangeInclusive</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Ops.Transform.html"><span class="hs-identifier">Data.Massiv.Array.Ops.Transform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Array.Ops.Transform.html#extract%27"><span class="hs-identifier">extract'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.html"><span class="hs-identifier">Data.Massiv.Array.Stencil</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Unsafe.html"><span class="hs-identifier">Data.Massiv.Array.Unsafe</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html"><span class="hs-identifier">Data.Massiv.Core.Common</span></a></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-48"></span><span class="hs-comment">--</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- __Midpoint Rule__</span><span>
</span><span id="line-50"></span><span class="hs-comment">--</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- \[</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- \int_{{\,a}}^{{\,b}}{{f\left( x \right)\,dx}} \approx \Delta x \cdot \,f\left( {x_1 + \frac{\Delta x}{2}} \right) + \Delta x \cdot \,f\left( {x_2 + \frac{\Delta x}{2}} \right) +  \cdots  + \Delta x \cdot \,f\left( {x_n + \frac{\Delta x}{2}} \right)</span><span>
</span><span id="line-53"></span><span class="hs-comment">-- \]</span><span>
</span><span id="line-54"></span><span id="local-6989586621679292902"><span id="local-6989586621679292903"><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#midpointStencil"><span class="hs-identifier hs-type">midpointStencil</span></a></span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679292902"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292903"><span class="hs-identifier hs-type">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679292902"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @&#916;x@ - distance between sample points</span></span><span>
</span><span id="line-58"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Dimension along which to integrate</span></span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @n@ - number of sample points.</span></span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292903"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292902"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292902"><span class="hs-identifier hs-type">e</span></a></span></span></span><span>
</span><span id="line-63"></span><span id="midpointStencil"><span class="annot"><span class="annottext">midpointStencil :: forall e ix.
(Fractional e, Index ix) =&gt;
e -&gt; Dim -&gt; Int -&gt; Stencil ix e e
</span><a href="Data.Massiv.Array.Numeric.Integral.html#midpointStencil"><span class="hs-identifier hs-var hs-var">midpointStencil</span></a></span></span><span> </span><span id="local-6989586621679293069"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293069"><span class="hs-identifier hs-var">dx</span></a></span></span><span> </span><span id="local-6989586621679293070"><span class="annot"><span class="annottext">Dim
</span><a href="#local-6989586621679293070"><span class="hs-identifier hs-var">dim</span></a></span></span><span> </span><span id="local-6989586621679293071"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293071"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><span class="annottext">Sz ix -&gt; ix -&gt; (ix -&gt; (ix -&gt; e) -&gt; e) -&gt; Stencil ix e e
forall ix e a.
Index ix =&gt;
Sz ix -&gt; ix -&gt; (ix -&gt; (ix -&gt; e) -&gt; a) -&gt; Stencil ix e a
</span><a href="Data.Massiv.Array.Stencil.Unsafe.html#makeUnsafeStencil"><span class="hs-identifier hs-var">makeUnsafeStencil</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ix -&gt; Sz ix
forall ix. Index ix =&gt; ix -&gt; Sz ix
</span><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-var">Sz</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ix -&gt; Dim -&gt; Int -&gt; ix
forall ix. (HasCallStack, Index ix) =&gt; ix -&gt; Dim -&gt; Int -&gt; ix
</span><a href="Data.Massiv.Core.Index.html#setDim%27"><span class="hs-identifier hs-var">setDim'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ix
forall ix. Index ix =&gt; Int -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#pureIndex"><span class="hs-identifier hs-var">pureIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Dim
</span><a href="#local-6989586621679293070"><span class="hs-identifier hs-var">dim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293071"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#zeroIndex"><span class="hs-identifier hs-var">zeroIndex</span></a></span><span> </span><span class="annot"><span class="annottext">((ix -&gt; (ix -&gt; e) -&gt; e) -&gt; Stencil ix e e)
-&gt; (ix -&gt; (ix -&gt; e) -&gt; e) -&gt; Stencil ix e e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ix
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679293077"><span class="annot"><span class="annottext">ix -&gt; e
</span><a href="#local-6989586621679293077"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293069"><span class="hs-identifier hs-var">dx</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; e -&gt; e
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; e -&gt; (Int -&gt; e -&gt; e) -&gt; e
forall a.
Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; a -&gt; (Int -&gt; a -&gt; a) -&gt; a
</span><a href="Data.Massiv.Core.Loop.html#loop"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293071"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679293082"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293082"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e -&gt; e -&gt; e
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">ix -&gt; e
</span><a href="#local-6989586621679293077"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ix -&gt; Dim -&gt; Int -&gt; ix
forall ix. (HasCallStack, Index ix) =&gt; ix -&gt; Dim -&gt; Int -&gt; ix
</span><a href="Data.Massiv.Core.Index.html#setDim%27"><span class="hs-identifier hs-var">setDim'</span></a></span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#zeroIndex"><span class="hs-identifier hs-var">zeroIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Dim
</span><a href="#local-6989586621679293070"><span class="hs-identifier hs-var">dim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293082"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#midpointStencil"><span class="hs-pragma hs-type">midpointStencil</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-69"></span><span class="hs-comment">--</span><span>
</span><span id="line-70"></span><span class="hs-comment">-- __Trapezoid Rule__</span><span>
</span><span id="line-71"></span><span class="hs-comment">--</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- \[</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- \int_{{\,a}}^{{\,b}}{{f\left( x \right)\,dx}} \approx \frac{{\Delta x}}{2}\cdot\left( {f\left( {{x_0}} \right) + f\left( {{x_1}} \right)} \right) + \frac{{\Delta x}}{2}\cdot\left( {f\left( {{x_1}} \right) + f\left( {{x_2}} \right)} \right) +  \cdots  + \frac{{\Delta x}}{2}\cdot\left( {f\left( {{x_{n - 1}}} \right) + f\left( {{x_n}} \right)} \right)</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- \]</span><span>
</span><span id="line-75"></span><span id="local-6989586621679293083"><span id="local-6989586621679293084"><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#trapezoidStencil"><span class="hs-identifier hs-type">trapezoidStencil</span></a></span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679293083"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293084"><span class="hs-identifier hs-type">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293083"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @&#916;x@ - distance between sample points</span></span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Dimension along which to integrate</span></span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-82"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @n@ - number of sample points.</span></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293084"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293083"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293083"><span class="hs-identifier hs-type">e</span></a></span></span></span><span>
</span><span id="line-84"></span><span id="trapezoidStencil"><span class="annot"><span class="annottext">trapezoidStencil :: forall e ix.
(Fractional e, Index ix) =&gt;
e -&gt; Dim -&gt; Int -&gt; Stencil ix e e
</span><a href="Data.Massiv.Array.Numeric.Integral.html#trapezoidStencil"><span class="hs-identifier hs-var hs-var">trapezoidStencil</span></a></span></span><span> </span><span id="local-6989586621679293116"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293116"><span class="hs-identifier hs-var">dx</span></a></span></span><span> </span><span id="local-6989586621679293117"><span class="annot"><span class="annottext">Dim
</span><a href="#local-6989586621679293117"><span class="hs-identifier hs-var">dim</span></a></span></span><span> </span><span id="local-6989586621679293118"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293118"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><span class="annottext">Sz ix -&gt; ix -&gt; (ix -&gt; (ix -&gt; e) -&gt; e) -&gt; Stencil ix e e
forall ix e a.
Index ix =&gt;
Sz ix -&gt; ix -&gt; (ix -&gt; (ix -&gt; e) -&gt; a) -&gt; Stencil ix e a
</span><a href="Data.Massiv.Array.Stencil.Unsafe.html#makeUnsafeStencil"><span class="hs-identifier hs-var">makeUnsafeStencil</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ix -&gt; Sz ix
forall ix. Index ix =&gt; ix -&gt; Sz ix
</span><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-var">Sz</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ix -&gt; Dim -&gt; Int -&gt; ix
forall ix. (HasCallStack, Index ix) =&gt; ix -&gt; Dim -&gt; Int -&gt; ix
</span><a href="Data.Massiv.Core.Index.html#setDim%27"><span class="hs-identifier hs-var">setDim'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ix
forall ix. Index ix =&gt; Int -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#pureIndex"><span class="hs-identifier hs-var">pureIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Dim
</span><a href="#local-6989586621679293117"><span class="hs-identifier hs-var">dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293118"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#zeroIndex"><span class="hs-identifier hs-var">zeroIndex</span></a></span><span> </span><span class="annot"><span class="annottext">((ix -&gt; (ix -&gt; e) -&gt; e) -&gt; Stencil ix e e)
-&gt; (ix -&gt; (ix -&gt; e) -&gt; e) -&gt; Stencil ix e e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ix
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679293119"><span class="annot"><span class="annottext">ix -&gt; e
</span><a href="#local-6989586621679293119"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293116"><span class="hs-identifier hs-var">dx</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; e -&gt; e
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>      </span><span class="annot"><span class="annottext">e -&gt; e -&gt; e
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; e -&gt; (Int -&gt; e -&gt; e) -&gt; e
forall a.
Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; a -&gt; (Int -&gt; a -&gt; a) -&gt; a
</span><a href="Data.Massiv.Core.Loop.html#loop"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293118"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ix -&gt; e
</span><a href="#local-6989586621679293119"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#zeroIndex"><span class="hs-identifier hs-var">zeroIndex</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679293121"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293121"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e -&gt; e -&gt; e
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">e -&gt; e -&gt; e
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">ix -&gt; e
</span><a href="#local-6989586621679293119"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ix -&gt; Dim -&gt; Int -&gt; ix
forall ix. (HasCallStack, Index ix) =&gt; ix -&gt; Dim -&gt; Int -&gt; ix
</span><a href="Data.Massiv.Core.Index.html#setDim%27"><span class="hs-identifier hs-var">setDim'</span></a></span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#zeroIndex"><span class="hs-identifier hs-var">zeroIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Dim
</span><a href="#local-6989586621679293117"><span class="hs-identifier hs-var">dim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293121"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>            </span><span class="annot"><span class="annottext">e -&gt; e -&gt; e
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">ix -&gt; e
</span><a href="#local-6989586621679293119"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ix -&gt; Dim -&gt; Int -&gt; ix
forall ix. (HasCallStack, Index ix) =&gt; ix -&gt; Dim -&gt; Int -&gt; ix
</span><a href="Data.Massiv.Core.Index.html#setDim%27"><span class="hs-identifier hs-var">setDim'</span></a></span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#zeroIndex"><span class="hs-identifier hs-var">zeroIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Dim
</span><a href="#local-6989586621679293117"><span class="hs-identifier hs-var">dim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293118"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#trapezoidStencil"><span class="hs-pragma hs-type">trapezoidStencil</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-93"></span><span class="hs-comment">--</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- __Simpson's Rule__</span><span>
</span><span id="line-95"></span><span class="hs-comment">--</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- \[</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- \int_{{\,a}}^{{\,b}}{{f\left( x \right)\,dx}} \approx \frac{{\Delta x}}{3}\cdot\left( {f\left( {{x_0}} \right) + 4\cdot f\left( {{x_1}} \right) + f\left( {{x_2}} \right)} \right) + \frac{{\Delta x}}{3}\cdot\left( {f\left( {{x_2}} \right) + 4\cdot f\left( {{x_3}} \right) + f\left( {{x_4}} \right)} \right) +  \cdots  + \frac{{\Delta x}}{3}\cdot\left( {f\left( {{x_{n - 2}}} \right) + 4\cdot f\left( {{x_{n - 1}}} \right) + f\left( {{x_n}} \right)} \right)</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- \]</span><span>
</span><span id="line-99"></span><span id="local-6989586621679293122"><span id="local-6989586621679293123"><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#simpsonsStencil"><span class="hs-identifier hs-type">simpsonsStencil</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679293122"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293123"><span class="hs-identifier hs-type">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293122"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @&#916;x@ - distance between sample points</span></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Dimension along which to integrate</span></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @n@ - Number of sample points. This value should be even, otherwise error.</span></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293123"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293122"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293122"><span class="hs-identifier hs-type">e</span></a></span></span></span><span>
</span><span id="line-108"></span><span id="simpsonsStencil"><span class="annot"><span class="annottext">simpsonsStencil :: forall e ix.
(Fractional e, Index ix) =&gt;
e -&gt; Dim -&gt; Int -&gt; Stencil ix e e
</span><a href="Data.Massiv.Array.Numeric.Integral.html#simpsonsStencil"><span class="hs-identifier hs-var hs-var">simpsonsStencil</span></a></span></span><span> </span><span id="local-6989586621679293172"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293172"><span class="hs-identifier hs-var">dx</span></a></span></span><span> </span><span id="local-6989586621679293173"><span class="annot"><span class="annottext">Dim
</span><a href="#local-6989586621679293173"><span class="hs-identifier hs-var">dim</span></a></span></span><span> </span><span id="local-6989586621679293174"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293174"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
forall a. Integral a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">odd</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293174"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-110"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Stencil ix e e
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Stencil ix e e) -&gt; [Char] -&gt; Stencil ix e e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-111"></span><span>        </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Number of sample points for Simpson's rule stencil should be even, but received: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293174"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><span class="annottext">Sz ix -&gt; ix -&gt; (ix -&gt; (ix -&gt; e) -&gt; e) -&gt; Stencil ix e e
forall ix e a.
Index ix =&gt;
Sz ix -&gt; ix -&gt; (ix -&gt; (ix -&gt; e) -&gt; a) -&gt; Stencil ix e a
</span><a href="Data.Massiv.Array.Stencil.Unsafe.html#makeUnsafeStencil"><span class="hs-identifier hs-var">makeUnsafeStencil</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ix -&gt; Sz ix
forall ix. Index ix =&gt; ix -&gt; Sz ix
</span><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-var">Sz</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ix -&gt; Dim -&gt; Int -&gt; ix
forall ix. (HasCallStack, Index ix) =&gt; ix -&gt; Dim -&gt; Int -&gt; ix
</span><a href="Data.Massiv.Core.Index.html#setDim%27"><span class="hs-identifier hs-var">setDim'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ix
forall ix. Index ix =&gt; Int -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#pureIndex"><span class="hs-identifier hs-var">pureIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Dim
</span><a href="#local-6989586621679293173"><span class="hs-identifier hs-var">dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293174"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#zeroIndex"><span class="hs-identifier hs-var">zeroIndex</span></a></span><span> </span><span class="annot"><span class="annottext">((ix -&gt; (ix -&gt; e) -&gt; e) -&gt; Stencil ix e e)
-&gt; (ix -&gt; (ix -&gt; e) -&gt; e) -&gt; Stencil ix e e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ix
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679293178"><span class="annot"><span class="annottext">ix -&gt; e
</span><a href="#local-6989586621679293178"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-114"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679293179"><span class="annot"><span class="annottext">simAcc :: Int -&gt; (e, e) -&gt; (e, e)
</span><a href="#local-6989586621679293179"><span class="hs-identifier hs-var hs-var">simAcc</span></a></span></span><span> </span><span id="local-6989586621679293180"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293180"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679293181"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293181"><span class="hs-identifier hs-var">prev</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679293182"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293182"><span class="hs-identifier hs-var">acc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-115"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679293201"><span class="annot"><span class="annottext">fx3 :: e
</span><a href="#local-6989586621679293201"><span class="hs-identifier hs-var hs-var">fx3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ix -&gt; e
</span><a href="#local-6989586621679293178"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ix -&gt; Dim -&gt; Int -&gt; ix
forall ix. (HasCallStack, Index ix) =&gt; ix -&gt; Dim -&gt; Int -&gt; ix
</span><a href="Data.Massiv.Core.Index.html#setDim%27"><span class="hs-identifier hs-var">setDim'</span></a></span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#zeroIndex"><span class="hs-identifier hs-var">zeroIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Dim
</span><a href="#local-6989586621679293173"><span class="hs-identifier hs-var">dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293180"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>                  </span><span class="hs-glyph">!</span><span id="local-6989586621679293225"><span class="annot"><span class="annottext">newAcc :: e
</span><a href="#local-6989586621679293225"><span class="hs-identifier hs-var hs-var">newAcc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293182"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; e -&gt; e
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293181"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; e -&gt; e
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">e -&gt; e -&gt; e
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">ix -&gt; e
</span><a href="#local-6989586621679293178"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ix -&gt; Dim -&gt; Int -&gt; ix
forall ix. (HasCallStack, Index ix) =&gt; ix -&gt; Dim -&gt; Int -&gt; ix
</span><a href="Data.Massiv.Core.Index.html#setDim%27"><span class="hs-identifier hs-var">setDim'</span></a></span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#zeroIndex"><span class="hs-identifier hs-var">zeroIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Dim
</span><a href="#local-6989586621679293173"><span class="hs-identifier hs-var">dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293180"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">e -&gt; e -&gt; e
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293201"><span class="hs-identifier hs-var">fx3</span></a></span><span>
</span><span id="line-117"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293201"><span class="hs-identifier hs-var">fx3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293225"><span class="hs-identifier hs-var">newAcc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293172"><span class="hs-identifier hs-var">dx</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; e -&gt; e
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">e -&gt; e -&gt; e
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">(e, e) -&gt; e
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
-&gt; (Int -&gt; Bool)
-&gt; (Int -&gt; Int)
-&gt; (e, e)
-&gt; (Int -&gt; (e, e) -&gt; (e, e))
-&gt; (e, e)
forall a.
Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; a -&gt; (Int -&gt; a -&gt; a) -&gt; a
</span><a href="Data.Massiv.Core.Loop.html#loop"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293174"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; (e, e) -&gt; (e, e)
</span><a href="#local-6989586621679293179"><span class="hs-identifier hs-var">simAcc</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ix -&gt; e
</span><a href="#local-6989586621679293178"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#zeroIndex"><span class="hs-identifier hs-var">zeroIndex</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (e, e) -&gt; (e, e)
</span><a href="#local-6989586621679293179"><span class="hs-identifier hs-var">simAcc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#simpsonsStencil"><span class="hs-pragma hs-type">simpsonsStencil</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="annot"><span class="hs-comment">-- | Integrate with a stencil along a particular dimension.</span></span><span>
</span><span id="line-122"></span><span id="local-6989586621679292939"><span id="local-6989586621679292941"><span id="local-6989586621679292943"><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#integrateWith"><span class="hs-identifier hs-type">integrateWith</span></a></span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679292939"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#StrideLoad"><span class="hs-identifier hs-type">StrideLoad</span></a></span><span> </span><span class="annot"><a href="Data.Massiv.Array.Delayed.Windowed.html#DW"><span class="hs-identifier hs-type">DW</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292941"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292939"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292943"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292939"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292941"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292939"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292939"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Dimension along which integration should be estimated.</span></span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @n@ - Number of samples</span></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292943"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292941"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292939"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292943"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292941"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292939"><span class="hs-identifier hs-type">e</span></a></span></span></span></span><span>
</span><span id="line-131"></span><span id="integrateWith"><span class="annot"><span class="annottext">integrateWith :: forall e ix r.
(Fractional e, StrideLoad DW ix e, Manifest r e) =&gt;
(Dim -&gt; Int -&gt; Stencil ix e e)
-&gt; Dim -&gt; Int -&gt; Array r ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Numeric.Integral.html#integrateWith"><span class="hs-identifier hs-var hs-var">integrateWith</span></a></span></span><span> </span><span id="local-6989586621679293253"><span class="annot"><span class="annottext">Dim -&gt; Int -&gt; Stencil ix e e
</span><a href="#local-6989586621679293253"><span class="hs-identifier hs-var">stencil</span></a></span></span><span> </span><span id="local-6989586621679293254"><span class="annot"><span class="annottext">Dim
</span><a href="#local-6989586621679293254"><span class="hs-identifier hs-var">dim</span></a></span></span><span> </span><span id="local-6989586621679293255"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293255"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679293256"><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679293256"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><span class="annottext">Stride ix -&gt; Array DW ix e -&gt; Array r ix e
forall r ix e r'.
(Manifest r e, StrideLoad r' ix e) =&gt;
Stride ix -&gt; Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#computeWithStride"><span class="hs-identifier hs-var">computeWithStride</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ix -&gt; Stride ix
forall ix. Index ix =&gt; ix -&gt; Stride ix
</span><a href="Data.Massiv.Core.Index.Stride.html#Stride"><span class="hs-identifier hs-var">Stride</span></a></span><span> </span><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679293259"><span class="hs-identifier hs-var">nsz</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Array DW ix e -&gt; Array r ix e) -&gt; Array DW ix e -&gt; Array r ix e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Border e -&gt; Stencil ix e e -&gt; Array r ix e -&gt; Array DW ix e
forall ix r e a.
(Index ix, Manifest r e) =&gt;
Border e -&gt; Stencil ix e a -&gt; Array r ix e -&gt; Array DW ix a
</span><a href="Data.Massiv.Array.Stencil.html#mapStencil"><span class="hs-identifier hs-var">mapStencil</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e -&gt; Border e
forall e. e -&gt; Border e
</span><a href="Data.Massiv.Core.Index.html#Fill"><span class="hs-identifier hs-var">Fill</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dim -&gt; Int -&gt; Stencil ix e e
</span><a href="#local-6989586621679293253"><span class="hs-identifier hs-var">stencil</span></a></span><span> </span><span class="annot"><span class="annottext">Dim
</span><a href="#local-6989586621679293254"><span class="hs-identifier hs-var">dim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293255"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679293256"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679293259"><span class="annot"><span class="annottext">nsz :: ix
</span><a href="#local-6989586621679293259"><span class="hs-identifier hs-var hs-var">nsz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ix -&gt; Dim -&gt; Int -&gt; ix
forall ix. (HasCallStack, Index ix) =&gt; ix -&gt; Dim -&gt; Int -&gt; ix
</span><a href="Data.Massiv.Core.Index.html#setDim%27"><span class="hs-identifier hs-var">setDim'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ix
forall ix. Index ix =&gt; Int -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#pureIndex"><span class="hs-identifier hs-var">pureIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Dim
</span><a href="#local-6989586621679293254"><span class="hs-identifier hs-var">dim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293255"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-135"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#integrateWith"><span class="hs-pragma hs-type">integrateWith</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="annot"><span class="hs-comment">-- | Compute an approximation of integral using a supplied rule in a form of `Stencil`.</span></span><span>
</span><span id="line-138"></span><span id="local-6989586621679292971"><span id="local-6989586621679292972"><span id="local-6989586621679292973"><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#integralApprox"><span class="hs-identifier hs-type">integralApprox</span></a></span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679292971"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#StrideLoad"><span class="hs-identifier hs-type">StrideLoad</span></a></span><span> </span><span class="annot"><a href="Data.Massiv.Array.Delayed.Windowed.html#DW"><span class="hs-identifier hs-type">DW</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292972"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292971"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292973"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292971"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679292971"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Stencil.Internal.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292972"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292971"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292971"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Integration Stencil</span></span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679292971"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-143"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @d@ - Length of interval per cell</span></span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292972"><span class="hs-identifier hs-type">ix</span></a></span><span>
</span><span id="line-145"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @sz@ - Result size of the matrix</span></span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @n@ - Number of samples</span></span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292973"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292972"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292971"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-149"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Array with values of @f(x,y,..)@ that will be used as source for integration.</span></span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="Data.Massiv.Array.Delayed.Pull.html#D"><span class="hs-identifier hs-type">D</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292972"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292971"><span class="hs-identifier hs-type">e</span></a></span></span></span></span><span>
</span><span id="line-151"></span><span id="integralApprox"><span class="annot"><span class="annottext">integralApprox :: forall e ix r.
(Fractional e, StrideLoad DW ix e, Manifest r e) =&gt;
(e -&gt; Dim -&gt; Int -&gt; Stencil ix e e)
-&gt; e -&gt; Sz ix -&gt; Int -&gt; Array r ix e -&gt; Array D ix e
</span><a href="Data.Massiv.Array.Numeric.Integral.html#integralApprox"><span class="hs-identifier hs-var hs-var">integralApprox</span></a></span></span><span> </span><span id="local-6989586621679293308"><span class="annot"><span class="annottext">e -&gt; Dim -&gt; Int -&gt; Stencil ix e e
</span><a href="#local-6989586621679293308"><span class="hs-identifier hs-var">stencil</span></a></span></span><span> </span><span id="local-6989586621679293309"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293309"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621679293310"><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679293310"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621679293311"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293311"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679293312"><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679293312"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-152"></span><span>  </span><span class="annot"><span class="annottext">ix -&gt; Sz ix -&gt; Array r ix e -&gt; Array D ix e
forall r ix e.
(HasCallStack, Index ix, Source r e) =&gt;
ix -&gt; Sz ix -&gt; Array r ix e -&gt; Array D ix e
</span><a href="Data.Massiv.Array.Ops.Transform.html#extract%27"><span class="hs-identifier hs-var">extract'</span></a></span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#zeroIndex"><span class="hs-identifier hs-var">zeroIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679293310"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">(Array r ix e -&gt; Array D ix e) -&gt; Array r ix e -&gt; Array D ix e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; (Int -&gt; Bool)
-&gt; (Int -&gt; Int)
-&gt; Array r ix e
-&gt; (Int -&gt; Array r ix e -&gt; Array r ix e)
-&gt; Array r ix e
forall a.
Int -&gt; (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; a -&gt; (Int -&gt; a -&gt; a) -&gt; a
</span><a href="Data.Massiv.Core.Loop.html#loop"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Dim -&gt; Int
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sz ix -&gt; Dim
forall ix (proxy :: * -&gt; *). Index ix =&gt; proxy ix -&gt; Dim
forall (proxy :: * -&gt; *). proxy ix -&gt; Dim
</span><a href="Data.Massiv.Core.Index.Internal.html#dimensions"><span class="hs-identifier hs-var">dimensions</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679293310"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Array r ix e
</span><a href="#local-6989586621679293312"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Array r ix e -&gt; Array r ix e
forall {r}. Manifest r e =&gt; Int -&gt; Array r ix e -&gt; Array r ix e
</span><a href="#local-6989586621679293315"><span class="hs-identifier hs-var">integrateAlong</span></a></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679293320"><span class="annot"><span class="annottext">dx :: e
</span><a href="#local-6989586621679293320"><span class="hs-identifier hs-var hs-var">dx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293309"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; e -&gt; e
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; e
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293311"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span id="local-6989586621679293315"><span class="annot"><span class="annottext">integrateAlong :: Int -&gt; Array r ix e -&gt; Array r ix e
</span><a href="#local-6989586621679293315"><span class="hs-identifier hs-var hs-var">integrateAlong</span></a></span></span><span> </span><span id="local-6989586621679293356"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293356"><span class="hs-identifier hs-var">dim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Dim -&gt; Int -&gt; Stencil ix e e)
-&gt; Dim -&gt; Int -&gt; Array r ix e -&gt; Array r ix e
forall e ix r.
(Fractional e, StrideLoad DW ix e, Manifest r e) =&gt;
(Dim -&gt; Int -&gt; Stencil ix e e)
-&gt; Dim -&gt; Int -&gt; Array r ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Numeric.Integral.html#integrateWith"><span class="hs-identifier hs-var">integrateWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e -&gt; Dim -&gt; Int -&gt; Stencil ix e e
</span><a href="#local-6989586621679293308"><span class="hs-identifier hs-var">stencil</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293320"><span class="hs-identifier hs-var">dx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Dim
</span><a href="Data.Massiv.Core.Index.Internal.html#Dim"><span class="hs-identifier hs-var">Dim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293356"><span class="hs-identifier hs-var">dim</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293311"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679293315"><span class="hs-pragma hs-type">integrateAlong</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-157"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#integralApprox"><span class="hs-pragma hs-type">integralApprox</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="annot"><span class="hs-comment">-- | Use midpoint rule to approximate an integral.</span></span><span>
</span><span id="line-160"></span><span id="local-6989586621679292997"><span id="local-6989586621679292998"><span id="local-6989586621679292999"><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#midpointRule"><span class="hs-identifier hs-type">midpointRule</span></a></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679292997"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#StrideLoad"><span class="hs-identifier hs-type">StrideLoad</span></a></span><span> </span><span class="annot"><a href="Data.Massiv.Array.Delayed.Windowed.html#DW"><span class="hs-identifier hs-type">DW</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292998"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292997"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292999"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292997"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Comp</span></span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Computation strategy.</span></span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679292999"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Intermediate array representation.</span></span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679292997"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679292998"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679292997"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @f(x,y,...)@ - Function to integrate</span></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679292997"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-169"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @a@ - Starting value point.</span></span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679292997"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-171"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @d@ - Distance per matrix cell.</span></span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292998"><span class="hs-identifier hs-type">ix</span></a></span><span>
</span><span id="line-173"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @sz@ - Result matrix size.</span></span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-175"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @n@ - Number of sample points per cell in each direction.</span></span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="Data.Massiv.Array.Delayed.Pull.html#D"><span class="hs-identifier hs-type">D</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292998"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292997"><span class="hs-identifier hs-type">e</span></a></span></span></span></span><span>
</span><span id="line-177"></span><span id="midpointRule"><span class="annot"><span class="annottext">midpointRule :: forall e ix r.
(Fractional e, StrideLoad DW ix e, Manifest r e) =&gt;
Comp
-&gt; r
-&gt; ((Int -&gt; e) -&gt; ix -&gt; e)
-&gt; e
-&gt; e
-&gt; Sz ix
-&gt; Int
-&gt; Array D ix e
</span><a href="Data.Massiv.Array.Numeric.Integral.html#midpointRule"><span class="hs-identifier hs-var hs-var">midpointRule</span></a></span></span><span> </span><span id="local-6989586621679293374"><span class="annot"><span class="annottext">Comp
</span><a href="#local-6989586621679293374"><span class="hs-identifier hs-var">comp</span></a></span></span><span> </span><span id="local-6989586621679293375"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679293375"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679293376"><span class="annot"><span class="annottext">(Int -&gt; e) -&gt; ix -&gt; e
</span><a href="#local-6989586621679293376"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679293377"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293377"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679293378"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293378"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621679293379"><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679293379"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621679293380"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293380"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-178"></span><span>  </span><span class="annot"><span class="annottext">(e -&gt; Dim -&gt; Int -&gt; Stencil ix e e)
-&gt; e -&gt; Sz ix -&gt; Int -&gt; Array r ix e -&gt; Array D ix e
forall e ix r.
(Fractional e, StrideLoad DW ix e, Manifest r e) =&gt;
(e -&gt; Dim -&gt; Int -&gt; Stencil ix e e)
-&gt; e -&gt; Sz ix -&gt; Int -&gt; Array r ix e -&gt; Array D ix e
</span><a href="Data.Massiv.Array.Numeric.Integral.html#integralApprox"><span class="hs-identifier hs-var">integralApprox</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; Dim -&gt; Int -&gt; Stencil ix e e
forall e ix.
(Fractional e, Index ix) =&gt;
e -&gt; Dim -&gt; Int -&gt; Stencil ix e e
</span><a href="Data.Massiv.Array.Numeric.Integral.html#midpointStencil"><span class="hs-identifier hs-var">midpointStencil</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293378"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679293379"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293380"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(Array r ix e -&gt; Array D ix e) -&gt; Array r ix e -&gt; Array D ix e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">r -&gt; Array D ix e -&gt; Array r ix e
forall r e r' ix.
(Manifest r e, Load r' ix e) =&gt;
r -&gt; Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#computeAs"><span class="hs-identifier hs-var">computeAs</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679293375"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(Array D ix e -&gt; Array r ix e) -&gt; Array D ix e -&gt; Array r ix e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Comp
-&gt; ((Int -&gt; e) -&gt; ix -&gt; e)
-&gt; e
-&gt; e
-&gt; Sz ix
-&gt; Int
-&gt; Array D ix e
forall ix a e.
(Index ix, Fractional a) =&gt;
Comp
-&gt; ((Int -&gt; a) -&gt; ix -&gt; e)
-&gt; a
-&gt; a
-&gt; Sz ix
-&gt; Int
-&gt; Array D ix e
</span><a href="Data.Massiv.Array.Numeric.Integral.html#fromFunctionMidpoint"><span class="hs-identifier hs-var">fromFunctionMidpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Comp
</span><a href="#local-6989586621679293374"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; e) -&gt; ix -&gt; e
</span><a href="#local-6989586621679293376"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293377"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293378"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679293379"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293380"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-179"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#midpointRule"><span class="hs-pragma hs-type">midpointRule</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="annot"><span class="hs-comment">-- | Use trapezoid rule to approximate an integral.</span></span><span>
</span><span id="line-182"></span><span id="local-6989586621679293382"><span id="local-6989586621679293383"><span id="local-6989586621679293384"><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#trapezoidRule"><span class="hs-identifier hs-type">trapezoidRule</span></a></span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679293382"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#StrideLoad"><span class="hs-identifier hs-type">StrideLoad</span></a></span><span> </span><span class="annot"><a href="Data.Massiv.Array.Delayed.Windowed.html#DW"><span class="hs-identifier hs-type">DW</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293383"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293382"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293384"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293382"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Comp</span></span><span>
</span><span id="line-185"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Computation strategy</span></span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293384"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Intermediate array representation</span></span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293382"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293383"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293382"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @f(x,y,...)@ - function to integrate</span></span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293382"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-191"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @a@ - Starting value point.</span></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293382"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-193"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @d@ - Distance per matrix cell.</span></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293383"><span class="hs-identifier hs-type">ix</span></a></span><span>
</span><span id="line-195"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @sz@ - Result matrix size.</span></span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @n@ - Number of sample points per cell in each direction.</span></span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="Data.Massiv.Array.Delayed.Pull.html#D"><span class="hs-identifier hs-type">D</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293383"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293382"><span class="hs-identifier hs-type">e</span></a></span></span></span></span><span>
</span><span id="line-199"></span><span id="trapezoidRule"><span class="annot"><span class="annottext">trapezoidRule :: forall e ix r.
(Fractional e, StrideLoad DW ix e, Manifest r e) =&gt;
Comp
-&gt; r
-&gt; ((Int -&gt; e) -&gt; ix -&gt; e)
-&gt; e
-&gt; e
-&gt; Sz ix
-&gt; Int
-&gt; Array D ix e
</span><a href="Data.Massiv.Array.Numeric.Integral.html#trapezoidRule"><span class="hs-identifier hs-var hs-var">trapezoidRule</span></a></span></span><span> </span><span id="local-6989586621679293400"><span class="annot"><span class="annottext">Comp
</span><a href="#local-6989586621679293400"><span class="hs-identifier hs-var">comp</span></a></span></span><span> </span><span id="local-6989586621679293401"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679293401"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679293402"><span class="annot"><span class="annottext">(Int -&gt; e) -&gt; ix -&gt; e
</span><a href="#local-6989586621679293402"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679293403"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293403"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679293404"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293404"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621679293405"><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679293405"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621679293406"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293406"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-200"></span><span>  </span><span class="annot"><span class="annottext">(e -&gt; Dim -&gt; Int -&gt; Stencil ix e e)
-&gt; e -&gt; Sz ix -&gt; Int -&gt; Array r ix e -&gt; Array D ix e
forall e ix r.
(Fractional e, StrideLoad DW ix e, Manifest r e) =&gt;
(e -&gt; Dim -&gt; Int -&gt; Stencil ix e e)
-&gt; e -&gt; Sz ix -&gt; Int -&gt; Array r ix e -&gt; Array D ix e
</span><a href="Data.Massiv.Array.Numeric.Integral.html#integralApprox"><span class="hs-identifier hs-var">integralApprox</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; Dim -&gt; Int -&gt; Stencil ix e e
forall e ix.
(Fractional e, Index ix) =&gt;
e -&gt; Dim -&gt; Int -&gt; Stencil ix e e
</span><a href="Data.Massiv.Array.Numeric.Integral.html#trapezoidStencil"><span class="hs-identifier hs-var">trapezoidStencil</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293404"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679293405"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293406"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(Array r ix e -&gt; Array D ix e) -&gt; Array r ix e -&gt; Array D ix e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">r -&gt; Array D ix e -&gt; Array r ix e
forall r e r' ix.
(Manifest r e, Load r' ix e) =&gt;
r -&gt; Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#computeAs"><span class="hs-identifier hs-var">computeAs</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679293401"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(Array D ix e -&gt; Array r ix e) -&gt; Array D ix e -&gt; Array r ix e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Comp
-&gt; ((Int -&gt; e) -&gt; ix -&gt; e)
-&gt; e
-&gt; e
-&gt; Sz ix
-&gt; Int
-&gt; Array D ix e
forall ix a e.
(Index ix, Fractional a) =&gt;
Comp
-&gt; ((Int -&gt; a) -&gt; ix -&gt; e)
-&gt; a
-&gt; a
-&gt; Sz ix
-&gt; Int
-&gt; Array D ix e
</span><a href="Data.Massiv.Array.Numeric.Integral.html#fromFunction"><span class="hs-identifier hs-var">fromFunction</span></a></span><span> </span><span class="annot"><span class="annottext">Comp
</span><a href="#local-6989586621679293400"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; e) -&gt; ix -&gt; e
</span><a href="#local-6989586621679293402"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293403"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293404"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679293405"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293406"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-201"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#trapezoidRule"><span class="hs-pragma hs-type">trapezoidRule</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="annot"><span class="hs-comment">-- | Use Simpson's rule to approximate an integral.</span></span><span>
</span><span id="line-204"></span><span id="local-6989586621679293407"><span id="local-6989586621679293408"><span id="local-6989586621679293409"><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#simpsonsRule"><span class="hs-identifier hs-type">simpsonsRule</span></a></span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679293407"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#StrideLoad"><span class="hs-identifier hs-type">StrideLoad</span></a></span><span> </span><span class="annot"><a href="Data.Massiv.Array.Delayed.Windowed.html#DW"><span class="hs-identifier hs-type">DW</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293408"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293407"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293409"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293407"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Comp</span></span><span>
</span><span id="line-207"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Computation strategy</span></span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293409"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-209"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Intermediate array representation</span></span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293407"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293408"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293407"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @f(x,y,...)@ - Function to integrate</span></span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293407"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-213"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @a@ - Starting value point.</span></span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293407"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-215"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @d@ - Distance per matrix cell.</span></span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293408"><span class="hs-identifier hs-type">ix</span></a></span><span>
</span><span id="line-217"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @sz@ - Result matrix size.</span></span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-comment">-- ^ @n@ - Number of sample points per cell in each direction. This value must be even,</span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-comment">-- otherwise error.</span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="Data.Massiv.Array.Delayed.Pull.html#D"><span class="hs-identifier hs-type">D</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293408"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293407"><span class="hs-identifier hs-type">e</span></a></span></span></span></span><span>
</span><span id="line-222"></span><span id="simpsonsRule"><span class="annot"><span class="annottext">simpsonsRule :: forall e ix r.
(Fractional e, StrideLoad DW ix e, Manifest r e) =&gt;
Comp
-&gt; r
-&gt; ((Int -&gt; e) -&gt; ix -&gt; e)
-&gt; e
-&gt; e
-&gt; Sz ix
-&gt; Int
-&gt; Array D ix e
</span><a href="Data.Massiv.Array.Numeric.Integral.html#simpsonsRule"><span class="hs-identifier hs-var hs-var">simpsonsRule</span></a></span></span><span> </span><span id="local-6989586621679293425"><span class="annot"><span class="annottext">Comp
</span><a href="#local-6989586621679293425"><span class="hs-identifier hs-var">comp</span></a></span></span><span> </span><span id="local-6989586621679293426"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679293426"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679293427"><span class="annot"><span class="annottext">(Int -&gt; e) -&gt; ix -&gt; e
</span><a href="#local-6989586621679293427"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679293428"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293428"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679293429"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293429"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621679293430"><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679293430"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621679293431"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293431"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-223"></span><span>  </span><span class="annot"><span class="annottext">(e -&gt; Dim -&gt; Int -&gt; Stencil ix e e)
-&gt; e -&gt; Sz ix -&gt; Int -&gt; Array r ix e -&gt; Array D ix e
forall e ix r.
(Fractional e, StrideLoad DW ix e, Manifest r e) =&gt;
(e -&gt; Dim -&gt; Int -&gt; Stencil ix e e)
-&gt; e -&gt; Sz ix -&gt; Int -&gt; Array r ix e -&gt; Array D ix e
</span><a href="Data.Massiv.Array.Numeric.Integral.html#integralApprox"><span class="hs-identifier hs-var">integralApprox</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; Dim -&gt; Int -&gt; Stencil ix e e
forall e ix.
(Fractional e, Index ix) =&gt;
e -&gt; Dim -&gt; Int -&gt; Stencil ix e e
</span><a href="Data.Massiv.Array.Numeric.Integral.html#simpsonsStencil"><span class="hs-identifier hs-var">simpsonsStencil</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293429"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679293430"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293431"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(Array r ix e -&gt; Array D ix e) -&gt; Array r ix e -&gt; Array D ix e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">r -&gt; Array D ix e -&gt; Array r ix e
forall r e r' ix.
(Manifest r e, Load r' ix e) =&gt;
r -&gt; Array r' ix e -&gt; Array r ix e
</span><a href="Data.Massiv.Array.Manifest.Internal.html#computeAs"><span class="hs-identifier hs-var">computeAs</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679293426"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(Array D ix e -&gt; Array r ix e) -&gt; Array D ix e -&gt; Array r ix e
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Comp
-&gt; ((Int -&gt; e) -&gt; ix -&gt; e)
-&gt; e
-&gt; e
-&gt; Sz ix
-&gt; Int
-&gt; Array D ix e
forall ix a e.
(Index ix, Fractional a) =&gt;
Comp
-&gt; ((Int -&gt; a) -&gt; ix -&gt; e)
-&gt; a
-&gt; a
-&gt; Sz ix
-&gt; Int
-&gt; Array D ix e
</span><a href="Data.Massiv.Array.Numeric.Integral.html#fromFunction"><span class="hs-identifier hs-var">fromFunction</span></a></span><span> </span><span class="annot"><span class="annottext">Comp
</span><a href="#local-6989586621679293425"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; e) -&gt; ix -&gt; e
</span><a href="#local-6989586621679293427"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293428"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679293429"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Sz ix
</span><a href="#local-6989586621679293430"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293431"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-224"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#simpsonsRule"><span class="hs-pragma hs-type">simpsonsRule</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="hs-comment">-- | Create an array from a function with sample points at the edges</span><span>
</span><span id="line-227"></span><span class="hs-comment">--</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- &gt;&gt;&gt; fromFunction Seq (\ scale (i :. j) -&gt; scale i + scale j :: Double) (-2) 1 (Sz 4) 2</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- Array D Seq (Sz (9 :. 9))</span><span>
</span><span id="line-230"></span><span class="hs-comment">--   [ [ -4.0, -3.5, -3.0, -2.5, -2.0, -1.5, -1.0, -0.5, 0.0 ]</span><span>
</span><span id="line-231"></span><span class="hs-comment">--   , [ -3.5, -3.0, -2.5, -2.0, -1.5, -1.0, -0.5, 0.0, 0.5 ]</span><span>
</span><span id="line-232"></span><span class="hs-comment">--   , [ -3.0, -2.5, -2.0, -1.5, -1.0, -0.5, 0.0, 0.5, 1.0 ]</span><span>
</span><span id="line-233"></span><span class="hs-comment">--   , [ -2.5, -2.0, -1.5, -1.0, -0.5, 0.0, 0.5, 1.0, 1.5 ]</span><span>
</span><span id="line-234"></span><span class="hs-comment">--   , [ -2.0, -1.5, -1.0, -0.5, 0.0, 0.5, 1.0, 1.5, 2.0 ]</span><span>
</span><span id="line-235"></span><span class="hs-comment">--   , [ -1.5, -1.0, -0.5, 0.0, 0.5, 1.0, 1.5, 2.0, 2.5 ]</span><span>
</span><span id="line-236"></span><span class="hs-comment">--   , [ -1.0, -0.5, 0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0 ]</span><span>
</span><span id="line-237"></span><span class="hs-comment">--   , [ -0.5, 0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0, 3.5 ]</span><span>
</span><span id="line-238"></span><span class="hs-comment">--   , [ 0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0 ]</span><span>
</span><span id="line-239"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-240"></span><span id="local-6989586621679293432"><span id="local-6989586621679293433"><span id="local-6989586621679293434"><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#fromFunction"><span class="hs-identifier hs-type">fromFunction</span></a></span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293432"><span class="hs-identifier hs-type">ix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679293433"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Comp</span></span><span>
</span><span id="line-243"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Computation strategy</span></span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293433"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293432"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293434"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-comment">-- ^ A function that will produce elements of scaled up array. First argument is a scaling</span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-comment">-- function that should be applied to individual indicies.</span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293433"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-248"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @a@ - Starting point</span></span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293433"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-250"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @d@ - Distance per cell</span></span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293432"><span class="hs-identifier hs-type">ix</span></a></span><span>
</span><span id="line-252"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @sz@ - Size of the desired array</span></span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-254"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ @n@ - Scaling factor, i.e. number of sample points per cell.</span></span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="Data.Massiv.Array.Delayed.Pull.html#D"><span class="hs-identifier hs-type">D</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293432"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293434"><span class="hs-identifier hs-type">e</span></a></span></span></span></span><span>
</span><span id="line-256"></span><span id="fromFunction"><span class="annot"><span class="annottext">fromFunction :: forall ix a e.
(Index ix, Fractional a) =&gt;
Comp
-&gt; ((Int -&gt; a) -&gt; ix -&gt; e)
-&gt; a
-&gt; a
-&gt; Sz ix
-&gt; Int
-&gt; Array D ix e
</span><a href="Data.Massiv.Array.Numeric.Integral.html#fromFunction"><span class="hs-identifier hs-var hs-var">fromFunction</span></a></span></span><span> </span><span id="local-6989586621679293446"><span class="annot"><span class="annottext">Comp
</span><a href="#local-6989586621679293446"><span class="hs-identifier hs-var">comp</span></a></span></span><span> </span><span id="local-6989586621679293447"><span class="annot"><span class="annottext">(Int -&gt; a) -&gt; ix -&gt; e
</span><a href="#local-6989586621679293447"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679293448"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679293448"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679293449"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679293449"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span id="local-6989586621679293450"><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679293450"><span class="hs-identifier hs-var">sz</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679293451"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293451"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-257"></span><span>  </span><span class="annot"><span class="annottext">(Int -&gt; a) -&gt; ix -&gt; e
</span><a href="#local-6989586621679293447"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; a
forall {a}. Integral a =&gt; a -&gt; a
</span><a href="#local-6989586621679293452"><span class="hs-identifier hs-var">scale</span></a></span><span> </span><span class="annot"><span class="annottext">(ix -&gt; e) -&gt; Array D ix ix -&gt; Array D ix e
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Comp -&gt; ix -&gt; ix -&gt; Array D ix ix
forall ix. Index ix =&gt; Comp -&gt; ix -&gt; ix -&gt; Array D ix ix
</span><a href="Data.Massiv.Array.Ops.Construct.html#rangeInclusive"><span class="hs-identifier hs-var">rangeInclusive</span></a></span><span> </span><span class="annot"><span class="annottext">Comp
</span><a href="#local-6989586621679293446"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#zeroIndex"><span class="hs-identifier hs-var">zeroIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; ix -&gt; ix
forall ix. Index ix =&gt; (Int -&gt; Int) -&gt; ix -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#liftIndex"><span class="hs-identifier hs-var">liftIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293451"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679293450"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-259"></span><span>    </span><span id="local-6989586621679293457"><span class="annot"><span class="annottext">nFrac :: a
</span><a href="#local-6989586621679293457"><span class="hs-identifier hs-var hs-var">nFrac</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; a
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293451"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-260"></span><span>    </span><span id="local-6989586621679293452"><span class="annot"><span class="annottext">scale :: a -&gt; a
</span><a href="#local-6989586621679293452"><span class="hs-identifier hs-var hs-var">scale</span></a></span></span><span> </span><span id="local-6989586621679293480"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679293480"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679293448"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679293449"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679293480"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679293457"><span class="hs-identifier hs-var">nFrac</span></a></span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679293452"><span class="hs-pragma hs-type">scale</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-262"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#fromFunction"><span class="hs-pragma hs-type">fromFunction</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-comment">-- | Similar to `fromFunction`, but will create an array from a function with sample points in the</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- middle of cells.</span><span>
</span><span id="line-266"></span><span class="hs-comment">--</span><span>
</span><span id="line-267"></span><span class="hs-comment">-- &gt;&gt;&gt; fromFunctionMidpoint Seq (\ scale (i :. j) -&gt; scale i + scale j :: Double) (-2) 1 (Sz 4) 2</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- Array D Seq (Sz (8 :. 8))</span><span>
</span><span id="line-269"></span><span class="hs-comment">--   [ [ -3.5, -3.0, -2.5, -2.0, -1.5, -1.0, -0.5, 0.0 ]</span><span>
</span><span id="line-270"></span><span class="hs-comment">--   , [ -3.0, -2.5, -2.0, -1.5, -1.0, -0.5, 0.0, 0.5 ]</span><span>
</span><span id="line-271"></span><span class="hs-comment">--   , [ -2.5, -2.0, -1.5, -1.0, -0.5, 0.0, 0.5, 1.0 ]</span><span>
</span><span id="line-272"></span><span class="hs-comment">--   , [ -2.0, -1.5, -1.0, -0.5, 0.0, 0.5, 1.0, 1.5 ]</span><span>
</span><span id="line-273"></span><span class="hs-comment">--   , [ -1.5, -1.0, -0.5, 0.0, 0.5, 1.0, 1.5, 2.0 ]</span><span>
</span><span id="line-274"></span><span class="hs-comment">--   , [ -1.0, -0.5, 0.0, 0.5, 1.0, 1.5, 2.0, 2.5 ]</span><span>
</span><span id="line-275"></span><span class="hs-comment">--   , [ -0.5, 0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0 ]</span><span>
</span><span id="line-276"></span><span class="hs-comment">--   , [ 0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0, 3.5 ]</span><span>
</span><span id="line-277"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-278"></span><span id="local-6989586621679293010"><span id="local-6989586621679293011"><span id="local-6989586621679293012"><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#fromFunctionMidpoint"><span class="hs-identifier hs-type">fromFunctionMidpoint</span></a></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293010"><span class="hs-identifier hs-type">ix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679293011"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Comp</span></span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293011"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293010"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293012"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293011"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-283"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679293011"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293010"><span class="hs-identifier hs-type">ix</span></a></span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Massiv.Core.Common.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="Data.Massiv.Array.Delayed.Pull.html#D"><span class="hs-identifier hs-type">D</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293010"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679293012"><span class="hs-identifier hs-type">e</span></a></span></span></span></span><span>
</span><span id="line-287"></span><span id="fromFunctionMidpoint"><span class="annot"><span class="annottext">fromFunctionMidpoint :: forall ix a e.
(Index ix, Fractional a) =&gt;
Comp
-&gt; ((Int -&gt; a) -&gt; ix -&gt; e)
-&gt; a
-&gt; a
-&gt; Sz ix
-&gt; Int
-&gt; Array D ix e
</span><a href="Data.Massiv.Array.Numeric.Integral.html#fromFunctionMidpoint"><span class="hs-identifier hs-var hs-var">fromFunctionMidpoint</span></a></span></span><span> </span><span id="local-6989586621679293493"><span class="annot"><span class="annottext">Comp
</span><a href="#local-6989586621679293493"><span class="hs-identifier hs-var">comp</span></a></span></span><span> </span><span id="local-6989586621679293494"><span class="annot"><span class="annottext">(Int -&gt; a) -&gt; ix -&gt; e
</span><a href="#local-6989586621679293494"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679293495"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679293495"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679293496"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679293496"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Massiv.Core.Index.Internal.html#Sz"><span class="hs-identifier hs-type">Sz</span></a></span><span> </span><span id="local-6989586621679293497"><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679293497"><span class="hs-identifier hs-var">sz</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679293498"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293498"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-288"></span><span>  </span><span class="annot"><span class="annottext">(Int -&gt; a) -&gt; ix -&gt; e
</span><a href="#local-6989586621679293494"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; a
forall {a}. Integral a =&gt; a -&gt; a
</span><a href="#local-6989586621679293499"><span class="hs-identifier hs-var">scale</span></a></span><span> </span><span class="annot"><span class="annottext">(ix -&gt; e) -&gt; Array D ix ix -&gt; Array D ix e
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Comp -&gt; ix -&gt; ix -&gt; Array D ix ix
forall ix. Index ix =&gt; Comp -&gt; ix -&gt; ix -&gt; Array D ix ix
</span><a href="Data.Massiv.Array.Ops.Construct.html#rangeInclusive"><span class="hs-identifier hs-var">rangeInclusive</span></a></span><span> </span><span class="annot"><span class="annottext">Comp
</span><a href="#local-6989586621679293493"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="annot"><span class="annottext">ix
forall ix. Index ix =&gt; ix
</span><a href="Data.Massiv.Core.Index.html#zeroIndex"><span class="hs-identifier hs-var">zeroIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; ix -&gt; ix
forall ix. Index ix =&gt; (Int -&gt; Int) -&gt; ix -&gt; ix
</span><a href="Data.Massiv.Core.Index.Internal.html#liftIndex"><span class="hs-identifier hs-var">liftIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679293500"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293500"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293498"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293500"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ix
</span><a href="#local-6989586621679293497"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-290"></span><span>    </span><span id="local-6989586621679293503"><span class="annot"><span class="annottext">nFrac :: a
</span><a href="#local-6989586621679293503"><span class="hs-identifier hs-var hs-var">nFrac</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; a
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679293498"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-291"></span><span>    </span><span id="local-6989586621679293508"><span class="annot"><span class="annottext">dx2 :: a
</span><a href="#local-6989586621679293508"><span class="hs-identifier hs-var hs-var">dx2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679293496"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679293503"><span class="hs-identifier hs-var">nFrac</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">2</span></span><span>
</span><span id="line-292"></span><span>    </span><span id="local-6989586621679293499"><span class="annot"><span class="annottext">scale :: a -&gt; a
</span><a href="#local-6989586621679293499"><span class="hs-identifier hs-var hs-var">scale</span></a></span></span><span> </span><span id="local-6989586621679293527"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679293527"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679293508"><span class="hs-identifier hs-var">dx2</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679293495"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679293496"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679293527"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679293503"><span class="hs-identifier hs-var">nFrac</span></a></span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679293499"><span class="hs-pragma hs-type">scale</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-294"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Massiv.Array.Numeric.Integral.html#fromFunctionMidpoint"><span class="hs-pragma hs-type">fromFunctionMidpoint</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="hs-comment">-- $integral_intro</span><span>
</span><span id="line-297"></span><span class="hs-comment">--</span><span>
</span><span id="line-298"></span><span class="hs-comment">-- Inspiration for the code in this module was taken from [Paul Dawkins Online</span><span>
</span><span id="line-299"></span><span class="hs-comment">-- Notes](http://tutorial.math.lamar.edu). In particular the page on [Integral</span><span>
</span><span id="line-300"></span><span class="hs-comment">-- Approximation](http://tutorial.math.lamar.edu/Classes/CalcII/ApproximatingDefIntegrals.aspx),</span><span>
</span><span id="line-301"></span><span class="hs-comment">-- so if you need to brush up on some theory it is a great place to start.</span><span>
</span><span id="line-302"></span><span class="hs-comment">--</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- Implementation-wise, integral approximation here relies heavily on stencils</span><span>
</span><span id="line-304"></span><span class="hs-comment">-- with stride, because such computation is fast and is automatically</span><span>
</span><span id="line-305"></span><span class="hs-comment">-- parallelizable.</span><span>
</span><span id="line-306"></span><span class="hs-comment">--</span><span>
</span><span id="line-307"></span><span class="hs-comment">-- Here are some examples of where this can be useful:</span><span>
</span><span id="line-308"></span><span class="hs-comment">--</span><span>
</span><span id="line-309"></span><span class="hs-comment">-- === Integral of a function on a region</span><span>
</span><span id="line-310"></span><span class="hs-comment">--</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- Say we have a gaussian @f(x) = e^(x^2)@ on interval @[0, 2]@ (as in Paul's tutorial above). For</span><span>
</span><span id="line-312"></span><span class="hs-comment">-- this we define a function @f@, an array with equally spaced (/dx/) sample input values and apply</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- the function to that array, which will give us an array of @n + 1@ sample points, or looking from</span><span>
</span><span id="line-314"></span><span class="hs-comment">-- a different angle @n@ intervals.</span><span>
</span><span id="line-315"></span><span class="hs-comment">--</span><span>
</span><span id="line-316"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.Massiv.Array</span><span>
</span><span id="line-317"></span><span class="hs-comment">-- &gt;&gt;&gt; f x = exp ( x ^ (2 :: Int) ) :: Float</span><span>
</span><span id="line-318"></span><span class="hs-comment">-- &gt;&gt;&gt; fromFunction Seq (\ scale x -&gt; f (scale x)) 0 2 (Sz1 1) 4</span><span>
</span><span id="line-319"></span><span class="hs-comment">-- Array D Seq (Sz1 5)</span><span>
</span><span id="line-320"></span><span class="hs-comment">--   [ 1.0, 1.2840254, 2.7182817, 9.487736, 54.59815 ]</span><span>
</span><span id="line-321"></span><span class="hs-comment">--</span><span>
</span><span id="line-322"></span><span class="hs-comment">-- Once we have that array of sample points ready, we could use `integralApprox` and one of the</span><span>
</span><span id="line-323"></span><span class="hs-comment">-- stencils to compute an integral, but there are already functions that will do both steps for you:</span><span>
</span><span id="line-324"></span><span class="hs-comment">--</span><span>
</span><span id="line-325"></span><span class="hs-comment">-- &gt;&gt;&gt; simpsonsRule Seq U (\ scale x -&gt; f (scale x)) 0 2 (Sz1 1) 4</span><span>
</span><span id="line-326"></span><span class="hs-comment">-- Array D Seq (Sz1 1)</span><span>
</span><span id="line-327"></span><span class="hs-comment">--   [ 17.353626 ]</span><span>
</span><span id="line-328"></span><span class="hs-comment">--</span><span>
</span><span id="line-329"></span><span class="hs-comment">-- @scale@ is the function that will change an array index into equally spaced and</span><span>
</span><span id="line-330"></span><span class="hs-comment">-- appropriately shifted values of @x, y, ...@ before they can get applied to @f(x, y, ...)@</span><span>
</span><span id="line-331"></span><span class="hs-comment">--</span><span>
</span><span id="line-332"></span><span class="hs-comment">-- === Accurate values of a function</span><span>
</span><span id="line-333"></span><span class="hs-comment">--</span><span>
</span><span id="line-334"></span><span class="hs-comment">-- Another very useful place where integral approximation can be used is when a more accurate</span><span>
</span><span id="line-335"></span><span class="hs-comment">-- representation of a non-linear function is desired. Consider the same gaussian function applied</span><span>
</span><span id="line-336"></span><span class="hs-comment">-- to equally spaced values, with zero being in the middle of the vector:</span><span>
</span><span id="line-337"></span><span class="hs-comment">--</span><span>
</span><span id="line-338"></span><span class="hs-comment">-- &gt;&gt;&gt; xArr = makeArrayR D Seq (Sz1 4) $ \ i -&gt; fromIntegral i - 1.5 :: Float</span><span>
</span><span id="line-339"></span><span class="hs-comment">-- &gt;&gt;&gt; xArr</span><span>
</span><span id="line-340"></span><span class="hs-comment">-- Array D Seq (Sz1 4)</span><span>
</span><span id="line-341"></span><span class="hs-comment">--   [ -1.5, -0.5, 0.5, 1.5 ]</span><span>
</span><span id="line-342"></span><span class="hs-comment">-- &gt;&gt;&gt; fmap f xArr</span><span>
</span><span id="line-343"></span><span class="hs-comment">-- Array D Seq (Sz1 4)</span><span>
</span><span id="line-344"></span><span class="hs-comment">--   [ 9.487736, 1.2840254, 1.2840254, 9.487736 ]</span><span>
</span><span id="line-345"></span><span class="hs-comment">--</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- The problem with above example is that computed values do not accurately represent the total</span><span>
</span><span id="line-347"></span><span class="hs-comment">-- value contained within each vector cell. For that reason if your were to later use it for example</span><span>
</span><span id="line-348"></span><span class="hs-comment">-- as convolution stencil, approximation would be very poor. The way to solve it is to approximate</span><span>
</span><span id="line-349"></span><span class="hs-comment">-- an integral across each cell of vector by drastically blowing up the @xArr@ and then reducing it</span><span>
</span><span id="line-350"></span><span class="hs-comment">-- to a smaller array by using one of the approximation rules:</span><span>
</span><span id="line-351"></span><span class="hs-comment">--</span><span>
</span><span id="line-352"></span><span class="hs-comment">-- &gt;&gt;&gt; startValue = -2 :: Float</span><span>
</span><span id="line-353"></span><span class="hs-comment">-- &gt;&gt;&gt; distPerCell = 1 :: Float</span><span>
</span><span id="line-354"></span><span class="hs-comment">-- &gt;&gt;&gt; desiredSize = Sz1 4 :: Sz1</span><span>
</span><span id="line-355"></span><span class="hs-comment">-- &gt;&gt;&gt; numSamples = 4 :: Int</span><span>
</span><span id="line-356"></span><span class="hs-comment">-- &gt;&gt;&gt; xArrX4 = fromFunction Seq ($) startValue distPerCell desiredSize numSamples</span><span>
</span><span id="line-357"></span><span class="hs-comment">-- &gt;&gt;&gt; xArrX4</span><span>
</span><span id="line-358"></span><span class="hs-comment">-- Array D Seq (Sz1 17)</span><span>
</span><span id="line-359"></span><span class="hs-comment">--   [ -2.0, -1.75, -1.5, -1.25, -1.0, -0.75, -0.5, -0.25, 0.0, 0.25, 0.5, 0.75, 1.0, 1.25, 1.5, 1.75, 2.0 ]</span><span>
</span><span id="line-360"></span><span class="hs-comment">-- &gt;&gt;&gt; yArrX4 = computeAs U $ fmap f xArrX4</span><span>
</span><span id="line-361"></span><span class="hs-comment">-- &gt;&gt;&gt; integralApprox trapezoidStencil distPerCell desiredSize numSamples yArrX4</span><span>
</span><span id="line-362"></span><span class="hs-comment">-- Array D Seq (Sz1 4)</span><span>
</span><span id="line-363"></span><span class="hs-comment">--   [ 16.074406, 1.4906789, 1.4906789, 16.074408 ]</span><span>
</span><span id="line-364"></span><span class="hs-comment">--</span><span>
</span><span id="line-365"></span><span class="hs-comment">-- We can clearly see the difference is huge, but it doesn't mean it is much better than our</span><span>
</span><span id="line-366"></span><span class="hs-comment">-- previous estimate. In order to get more accurate results we can use a better Simpson's rule for</span><span>
</span><span id="line-367"></span><span class="hs-comment">-- approximation and many more sample points. There is no need to create individual arrays @xArrX4@</span><span>
</span><span id="line-368"></span><span class="hs-comment">-- and @yArrX4@, there are functions like `simpsonsRule` that will take care of it for us:</span><span>
</span><span id="line-369"></span><span class="hs-comment">--</span><span>
</span><span id="line-370"></span><span class="hs-comment">-- &gt;&gt;&gt; simpsonsRule Seq U (\ scale i -&gt; f (scale i)) startValue distPerCell desiredSize 128</span><span>
</span><span id="line-371"></span><span class="hs-comment">-- Array D Seq (Sz1 4)</span><span>
</span><span id="line-372"></span><span class="hs-comment">--   [ 14.989977, 1.4626511, 1.4626517, 14.989977 ]</span><span>
</span><span id="line-373"></span></pre></body></html>