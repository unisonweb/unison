<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LINE 1 &quot;System/Console/Haskeline/Backend/Posix.hsc&quot; #-}</span><span>
</span><span id="line-1"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System.Console.Haskeline.Backend.Posix</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-2"></span><span>                        </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#withPosixGetEvent"><span class="hs-identifier">withPosixGetEvent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-3"></span><span>                        </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#posixLayouts"><span class="hs-identifier">posixLayouts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-4"></span><span>                        </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#tryGetLayouts"><span class="hs-identifier">tryGetLayouts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-5"></span><span>                        </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#PosixT"><span class="hs-identifier">PosixT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>                        </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#Handles"><span class="hs-identifier">Handles</span></a></span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>                        </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#ehIn"><span class="hs-identifier">ehIn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>                        </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#ehOut"><span class="hs-identifier">ehOut</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>                        </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#mapLines"><span class="hs-identifier">mapLines</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>                        </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#stdinTTYHandles"><span class="hs-identifier">stdinTTYHandles</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>                        </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#ttyHandles"><span class="hs-identifier">ttyHandles</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>                        </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#posixRunTerm"><span class="hs-identifier">posixRunTerm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>                        </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#fileRunTerm"><span class="hs-identifier">fileRunTerm</span></a></span><span>
</span><span id="line-14"></span><span>                 </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.C.Types</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Posix.Terminal</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Interrupt</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">throwTo</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Catch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadMask</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">handle</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">finally</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">throwTo</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">catMaybes</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Posix.Signals.Exts</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Posix.Types</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Fd</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Environment</span></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Monads.html"><span class="hs-identifier">System.Console.Haskeline.Monads</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Key.html"><span class="hs-identifier">System.Console.Haskeline.Key</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html"><span class="hs-identifier">System.Console.Haskeline.Term</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Term</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Prefs.html"><span class="hs-identifier">System.Console.Haskeline.Prefs</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.Encoder.html"><span class="hs-identifier">System.Console.Haskeline.Backend.Posix.Encoder</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.IO.FD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fdFD</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Typeable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">cast</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Error</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.IO.Exception</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.IO.Handle.Types</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getState</span></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.IO.Handle.Internals</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Posix.Internals</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">FD</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-pragma">{-# LINE 50 &quot;System/Console/Haskeline/Backend/Posix.hsc&quot; #-}</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-comment">-----------------------------------------------</span><span>
</span><span id="line-53"></span><span class="hs-comment">-- Input/output handles</span><span>
</span><span id="line-54"></span><span class="hs-keyword">data</span><span> </span><span id="Handles"><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#Handles"><span class="hs-identifier hs-var">Handles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Handles"><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#Handles"><span class="hs-identifier hs-var">Handles</span></a></span></span><span> </span><span class="hs-special">{</span><span id="hIn"><span class="annot"><span class="annottext">Handles -&gt; ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.html#hIn"><span class="hs-identifier hs-var hs-var">hIn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="hOut"><span class="annot"><span class="annottext">Handles -&gt; ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.html#hOut"><span class="hs-identifier hs-var hs-var">hOut</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.Encoder.html#ExternalHandle"><span class="hs-identifier hs-type">ExternalHandle</span></a></span><span>
</span><span id="line-55"></span><span>                        </span><span class="hs-special">,</span><span> </span><span id="closeHandles"><span class="annot"><span class="annottext">Handles -&gt; IO ()
</span><a href="System.Console.Haskeline.Backend.Posix.html#closeHandles"><span class="hs-identifier hs-var hs-var">closeHandles</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#ehIn"><span class="hs-identifier hs-type">ehIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#ehOut"><span class="hs-identifier hs-type">ehOut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#Handles"><span class="hs-identifier hs-type">Handles</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span>
</span><span id="line-58"></span><span id="ehIn"><span class="annot"><span class="annottext">ehIn :: Handles -&gt; Handle
</span><a href="System.Console.Haskeline.Backend.Posix.html#ehIn"><span class="hs-identifier hs-var hs-var">ehIn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExternalHandle -&gt; Handle
</span><a href="System.Console.Haskeline.Backend.Posix.Encoder.html#eH"><span class="hs-identifier hs-var">eH</span></a></span><span> </span><span class="annot"><span class="annottext">(ExternalHandle -&gt; Handle)
-&gt; (Handles -&gt; ExternalHandle) -&gt; Handles -&gt; Handle
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Handles -&gt; ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.html#hIn"><span class="hs-identifier hs-var">hIn</span></a></span><span>
</span><span id="line-59"></span><span id="ehOut"><span class="annot"><span class="annottext">ehOut :: Handles -&gt; Handle
</span><a href="System.Console.Haskeline.Backend.Posix.html#ehOut"><span class="hs-identifier hs-var hs-var">ehOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExternalHandle -&gt; Handle
</span><a href="System.Console.Haskeline.Backend.Posix.Encoder.html#eH"><span class="hs-identifier hs-var">eH</span></a></span><span> </span><span class="annot"><span class="annottext">(ExternalHandle -&gt; Handle)
-&gt; (Handles -&gt; ExternalHandle) -&gt; Handles -&gt; Handle
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Handles -&gt; ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.html#hOut"><span class="hs-identifier hs-var">hOut</span></a></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-comment">-------------------</span><span>
</span><span id="line-62"></span><span class="hs-comment">-- Window size</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span id="ioctl"><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#ioctl"><span class="hs-identifier hs-var">ioctl</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679096408"><span class="annot"><span class="hs-identifier hs-type">FD</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CULong</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="#local-6989586621679096408"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#posixLayouts"><span class="hs-identifier hs-type">posixLayouts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#Handles"><span class="hs-identifier hs-type">Handles</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#Layout"><span class="hs-identifier hs-type">Layout</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-67"></span><span id="posixLayouts"><span class="annot"><span class="annottext">posixLayouts :: Handles -&gt; [IO (Maybe Layout)]
</span><a href="System.Console.Haskeline.Backend.Posix.html#posixLayouts"><span class="hs-identifier hs-var hs-var">posixLayouts</span></a></span></span><span> </span><span id="local-6989586621679096723"><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679096723"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Handle -&gt; IO (Maybe Layout)
</span><a href="System.Console.Haskeline.Backend.Posix.html#ioctlLayout"><span class="hs-identifier hs-var">ioctlLayout</span></a></span><span> </span><span class="annot"><span class="annottext">(Handle -&gt; IO (Maybe Layout)) -&gt; Handle -&gt; IO (Maybe Layout)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handles -&gt; Handle
</span><a href="System.Console.Haskeline.Backend.Posix.html#ehOut"><span class="hs-identifier hs-var">ehOut</span></a></span><span> </span><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679096723"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IO (Maybe Layout)
</span><a href="System.Console.Haskeline.Backend.Posix.html#envLayout"><span class="hs-identifier hs-var">envLayout</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#ioctlLayout"><span class="hs-identifier hs-type">ioctlLayout</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#Layout"><span class="hs-identifier hs-type">Layout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span id="ioctlLayout"><span class="annot"><span class="annottext">ioctlLayout :: Handle -&gt; IO (Maybe Layout)
</span><a href="System.Console.Haskeline.Backend.Posix.html#ioctlLayout"><span class="hs-identifier hs-var hs-var">ioctlLayout</span></a></span></span><span> </span><span id="local-6989586621679096726"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679096726"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Ptr Any -&gt; IO (Maybe Layout)) -&gt; IO (Maybe Layout)
forall a b. Int -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">allocaBytes</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Ptr Any -&gt; IO (Maybe Layout)) -&gt; IO (Maybe Layout))
-&gt; (Ptr Any -&gt; IO (Maybe Layout)) -&gt; IO (Maybe Layout)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679096728"><span class="annot"><span class="annottext">Ptr Any
</span><a href="#local-6989586621679096728"><span class="hs-identifier hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-71"></span><span class="hs-pragma">{-# LINE 71 &quot;System/Console/Haskeline/Backend/Posix.hsc&quot; #-}</span><span>
</span><span id="line-71"></span><span>                </span><span id="local-6989586621679096729"><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679096729"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO CInt
</span><a href="System.Console.Haskeline.Backend.Posix.html#unsafeHandleToFD"><span class="hs-identifier hs-var">unsafeHandleToFD</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679096726"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-72"></span><span>                </span><span id="local-6989586621679096731"><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679096731"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; CULong -&gt; Ptr Any -&gt; IO CInt
forall a. CInt -&gt; CULong -&gt; Ptr a -&gt; IO CInt
</span><a href="System.Console.Haskeline.Backend.Posix.html#ioctl"><span class="hs-identifier hs-var">ioctl</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679096729"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CULong
</span><span class="hs-number">21523</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ptr Any
</span><a href="#local-6989586621679096728"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-73"></span><span class="hs-pragma">{-# LINE 73 &quot;System/Console/Haskeline/Backend/Posix.hsc&quot; #-}</span><span>
</span><span id="line-73"></span><span>                </span><span id="local-6989586621679096732"><span class="annot"><span class="annottext">CUShort
</span><a href="#local-6989586621679096732"><span class="hs-identifier hs-var">rows</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CUShort</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679096733"><span class="annot"><span class="annottext">Ptr Any
</span><a href="#local-6989586621679096733"><span class="hs-identifier hs-var">hsc_ptr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ptr Any -&gt; Int -&gt; IO CUShort
forall b. Ptr b -&gt; Int -&gt; IO CUShort
forall a b. Storable a =&gt; Ptr b -&gt; Int -&gt; IO a
</span><span class="hs-identifier hs-var">peekByteOff</span></span><span> </span><span class="annot"><span class="annottext">Ptr Any
</span><a href="#local-6989586621679096733"><span class="hs-identifier hs-var">hsc_ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ptr Any
</span><a href="#local-6989586621679096728"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-74"></span><span class="hs-pragma">{-# LINE 74 &quot;System/Console/Haskeline/Backend/Posix.hsc&quot; #-}</span><span>
</span><span id="line-74"></span><span>                </span><span id="local-6989586621679096735"><span class="annot"><span class="annottext">CUShort
</span><a href="#local-6989586621679096735"><span class="hs-identifier hs-var">cols</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CUShort</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679096736"><span class="annot"><span class="annottext">Ptr Any
</span><a href="#local-6989586621679096736"><span class="hs-identifier hs-var">hsc_ptr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ptr Any -&gt; Int -&gt; IO CUShort
forall b. Ptr b -&gt; Int -&gt; IO CUShort
forall a b. Storable a =&gt; Ptr b -&gt; Int -&gt; IO a
</span><span class="hs-identifier hs-var">peekByteOff</span></span><span> </span><span class="annot"><span class="annottext">Ptr Any
</span><a href="#local-6989586621679096736"><span class="hs-identifier hs-var">hsc_ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ptr Any
</span><a href="#local-6989586621679096728"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-75"></span><span class="hs-pragma">{-# LINE 75 &quot;System/Console/Haskeline/Backend/Posix.hsc&quot; #-}</span><span>
</span><span id="line-75"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679096731"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="annot"><span class="annottext">CInt -&gt; CInt -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><span class="hs-number">0</span></span><span>
</span><span id="line-76"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe Layout -&gt; IO (Maybe Layout)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Layout -&gt; IO (Maybe Layout))
-&gt; Maybe Layout -&gt; IO (Maybe Layout)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Layout -&gt; Maybe Layout
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#Layout"><span class="hs-identifier hs-type">Layout</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">height :: Int
</span><a href="System.Console.Haskeline.Term.html#height"><span class="hs-identifier hs-var">height</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">CUShort -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span> </span><span class="annot"><span class="annottext">CUShort
</span><a href="#local-6989586621679096732"><span class="hs-identifier hs-var">rows</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">width :: Int
</span><a href="System.Console.Haskeline.Term.html#width"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">CUShort -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span> </span><span class="annot"><span class="annottext">CUShort
</span><a href="#local-6989586621679096735"><span class="hs-identifier hs-var">cols</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-77"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe Layout -&gt; IO (Maybe Layout)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Layout
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#unsafeHandleToFD"><span class="hs-identifier hs-type">unsafeHandleToFD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FD</span></span><span>
</span><span id="line-80"></span><span id="unsafeHandleToFD"><span class="annot"><span class="annottext">unsafeHandleToFD :: Handle -&gt; IO CInt
</span><a href="System.Console.Haskeline.Backend.Posix.html#unsafeHandleToFD"><span class="hs-identifier hs-var hs-var">unsafeHandleToFD</span></a></span></span><span> </span><span id="local-6989586621679096741"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679096741"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-81"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Handle -&gt; (Handle__ -&gt; IO CInt) -&gt; IO CInt
forall a. String -&gt; Handle -&gt; (Handle__ -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">withHandle_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unsafeHandleToFd&quot;</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679096741"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">((Handle__ -&gt; IO CInt) -&gt; IO CInt)
-&gt; (Handle__ -&gt; IO CInt) -&gt; IO CInt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="hs-identifier hs-type">Handle__</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">haDevice :: ()
</span><span class="hs-identifier hs-var">haDevice</span></span><span class="hs-glyph">=</span><span id="local-6989586621679096752"><span class="annot"><span class="annottext">dev
</span><a href="#local-6989586621679096752"><span class="hs-identifier hs-var">dev</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">dev -&gt; Maybe FD
forall a b. (Typeable a, Typeable b) =&gt; a -&gt; Maybe b
</span><span class="hs-identifier hs-var">cast</span></span><span> </span><span class="annot"><span class="annottext">dev
</span><a href="#local-6989586621679096752"><span class="hs-identifier hs-var">dev</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><span class="annottext">Maybe FD
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IOException -&gt; IO CInt
forall a. IOException -&gt; IO a
</span><span class="hs-identifier hs-var">ioError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOException -&gt; String -&gt; IOException
</span><span class="hs-identifier hs-var">ioeSetErrorString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOErrorType
-&gt; String -&gt; Maybe Handle -&gt; Maybe String -&gt; IOException
</span><span class="hs-identifier hs-var">mkIOError</span></span><span> </span><span class="annot"><span class="annottext">IOErrorType
</span><span class="hs-identifier hs-var">IllegalOperation</span></span><span>
</span><span id="line-84"></span><span>                                           </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unsafeHandleToFd&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handle -&gt; Maybe Handle
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679096741"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>                        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;handle is not a file descriptor&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679096757"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679096757"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; IO CInt
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><span class="hs-identifier hs-var">fdFD</span></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679096757"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#envLayout"><span class="hs-identifier hs-type">envLayout</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#Layout"><span class="hs-identifier hs-type">Layout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span id="envLayout"><span class="annot"><span class="annottext">envLayout :: IO (Maybe Layout)
</span><a href="System.Console.Haskeline.Backend.Posix.html#envLayout"><span class="hs-identifier hs-var hs-var">envLayout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IOException -&gt; IO (Maybe Layout))
-&gt; IO (Maybe Layout) -&gt; IO (Maybe Layout)
forall (m :: * -&gt; *) e a.
(HasCallStack, MonadCatch m, Exception e) =&gt;
(e -&gt; m a) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">handle</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOException
</span><span class="hs-identifier">_</span></span><span class="hs-glyph">::</span><span class="annot"><span class="hs-identifier hs-type">IOException</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Layout -&gt; IO (Maybe Layout)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Layout
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO (Maybe Layout) -&gt; IO (Maybe Layout))
-&gt; IO (Maybe Layout) -&gt; IO (Maybe Layout)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-comment">-- note the handle catches both undefined envs and bad reads</span><span>
</span><span id="line-91"></span><span>    </span><span id="local-6989586621679096758"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096758"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><span class="hs-identifier hs-var">getEnv</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ROWS&quot;</span></span><span>
</span><span id="line-92"></span><span>    </span><span id="local-6989586621679096760"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096760"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><span class="hs-identifier hs-var">getEnv</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;COLUMNS&quot;</span></span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><span class="annottext">Maybe Layout -&gt; IO (Maybe Layout)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Layout -&gt; IO (Maybe Layout))
-&gt; Maybe Layout -&gt; IO (Maybe Layout)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Layout -&gt; Maybe Layout
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Layout -&gt; Maybe Layout) -&gt; Layout -&gt; Maybe Layout
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#Layout"><span class="hs-identifier hs-type">Layout</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">height :: Int
</span><a href="System.Console.Haskeline.Term.html#height"><span class="hs-identifier hs-var">height</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">String -&gt; Int
forall a. Read a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">read</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096758"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">width :: Int
</span><a href="System.Console.Haskeline.Term.html#width"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">String -&gt; Int
forall a. Read a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">read</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096760"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#tryGetLayouts"><span class="hs-identifier hs-type">tryGetLayouts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#Layout"><span class="hs-identifier hs-type">Layout</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#Layout"><span class="hs-identifier hs-type">Layout</span></a></span><span>
</span><span id="line-96"></span><span id="tryGetLayouts"><span class="annot"><span class="annottext">tryGetLayouts :: [IO (Maybe Layout)] -&gt; IO Layout
</span><a href="System.Console.Haskeline.Backend.Posix.html#tryGetLayouts"><span class="hs-identifier hs-var hs-var">tryGetLayouts</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Layout -&gt; IO Layout
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#Layout"><span class="hs-identifier hs-type">Layout</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">height :: Int
</span><a href="System.Console.Haskeline.Term.html#height"><span class="hs-identifier hs-var">height</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">24</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">width :: Int
</span><a href="System.Console.Haskeline.Term.html#width"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">80</span></span><span class="hs-special">}</span><span>
</span><span id="line-97"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#tryGetLayouts"><span class="hs-identifier hs-var">tryGetLayouts</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679096762"><span class="annot"><span class="annottext">IO (Maybe Layout)
</span><a href="#local-6989586621679096762"><span class="hs-identifier hs-var">f</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679096763"><span class="annot"><span class="annottext">[IO (Maybe Layout)]
</span><a href="#local-6989586621679096763"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-98"></span><span>    </span><span id="local-6989586621679096764"><span class="annot"><span class="annottext">Maybe Layout
</span><a href="#local-6989586621679096764"><span class="hs-identifier hs-var">ml</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe Layout)
</span><a href="#local-6989586621679096762"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Layout
</span><a href="#local-6989586621679096764"><span class="hs-identifier hs-var">ml</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-100"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679096765"><span class="annot"><span class="annottext">Layout
</span><a href="#local-6989586621679096765"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Layout -&gt; Int
</span><a href="System.Console.Haskeline.Term.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Layout
</span><a href="#local-6989586621679096765"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Layout -&gt; Int
</span><a href="System.Console.Haskeline.Term.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Layout
</span><a href="#local-6989586621679096765"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Layout -&gt; IO Layout
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Layout
</span><a href="#local-6989586621679096765"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-101"></span><span>        </span><span class="annot"><span class="annottext">Maybe Layout
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[IO (Maybe Layout)] -&gt; IO Layout
</span><a href="System.Console.Haskeline.Backend.Posix.html#tryGetLayouts"><span class="hs-identifier hs-var">tryGetLayouts</span></a></span><span> </span><span class="annot"><span class="annottext">[IO (Maybe Layout)]
</span><a href="#local-6989586621679096763"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-comment">--------------------</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- Key sequences</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span id="local-6989586621679096431"><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#getKeySequences"><span class="hs-identifier hs-type">getKeySequences</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679096431"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Monads.html#MonadReader"><span class="hs-identifier hs-type">MonadReader</span></a></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Prefs.html#Prefs"><span class="hs-identifier hs-type">Prefs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096431"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span class="annot"><a href="System.Console.Haskeline.Key.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679096431"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#TreeMap"><span class="hs-identifier hs-type">TreeMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Key.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-109"></span><span id="getKeySequences"><span class="annot"><span class="annottext">getKeySequences :: forall (m :: * -&gt; *).
(MonadIO m, MonadReader Prefs m) =&gt;
Handle -&gt; [(String, Key)] -&gt; m (TreeMap Char Key)
</span><a href="System.Console.Haskeline.Backend.Posix.html#getKeySequences"><span class="hs-identifier hs-var hs-var">getKeySequences</span></a></span></span><span> </span><span id="local-6989586621679096782"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679096782"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679096783"><span class="annot"><span class="annottext">[(String, Key)]
</span><a href="#local-6989586621679096783"><span class="hs-identifier hs-var">tinfos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621679096784"><span class="annot"><span class="annottext">[(String, Key)]
</span><a href="#local-6989586621679096784"><span class="hs-identifier hs-var">sttys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [(String, Key)] -&gt; m [(String, Key)]
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [(String, Key)] -&gt; m [(String, Key)])
-&gt; IO [(String, Key)] -&gt; m [(String, Key)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO [(String, Key)]
</span><a href="System.Console.Haskeline.Backend.Posix.html#sttyKeys"><span class="hs-identifier hs-var">sttyKeys</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679096782"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span id="local-6989586621679096787"><span class="annot"><span class="annottext">[(String, Key)]
</span><a href="#local-6989586621679096787"><span class="hs-identifier hs-var">customKeySeqs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m [(String, Key)]
</span><a href="#local-6989586621679096788"><span class="hs-identifier hs-var">getCustomKeySeqs</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-comment">-- note ++ acts as a union; so the below favors sttys over tinfos</span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><span class="annottext">TreeMap Char Key -&gt; m (TreeMap Char Key)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(TreeMap Char Key -&gt; m (TreeMap Char Key))
-&gt; TreeMap Char Key -&gt; m (TreeMap Char Key)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(String, Key)] -&gt; TreeMap Char Key
forall a b. Ord a =&gt; [([a], b)] -&gt; TreeMap a b
</span><a href="System.Console.Haskeline.Backend.Posix.html#listToTree"><span class="hs-identifier hs-var">listToTree</span></a></span><span>
</span><span id="line-114"></span><span>        </span><span class="annot"><span class="annottext">([(String, Key)] -&gt; TreeMap Char Key)
-&gt; [(String, Key)] -&gt; TreeMap Char Key
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(String, Key)]
</span><a href="System.Console.Haskeline.Backend.Posix.html#ansiKeys"><span class="hs-identifier hs-var">ansiKeys</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, Key)] -&gt; [(String, Key)] -&gt; [(String, Key)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(String, Key)]
</span><a href="#local-6989586621679096783"><span class="hs-identifier hs-var">tinfos</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, Key)] -&gt; [(String, Key)] -&gt; [(String, Key)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(String, Key)]
</span><a href="#local-6989586621679096784"><span class="hs-identifier hs-var">sttys</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, Key)] -&gt; [(String, Key)] -&gt; [(String, Key)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(String, Key)]
</span><a href="#local-6989586621679096787"><span class="hs-identifier hs-var">customKeySeqs</span></a></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-116"></span><span>    </span><span id="local-6989586621679096788"><span class="annot"><span class="annottext">getCustomKeySeqs :: m [(String, Key)]
</span><a href="#local-6989586621679096788"><span class="hs-identifier hs-var hs-var">getCustomKeySeqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-117"></span><span>        </span><span id="local-6989586621679096809"><span class="annot"><span class="annottext">[(Maybe String, String, Key)]
</span><a href="#local-6989586621679096809"><span class="hs-identifier hs-var">kseqs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Prefs -&gt; [(Maybe String, String, Key)])
-&gt; m [(Maybe String, String, Key)]
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><a href="System.Console.Haskeline.Monads.html#asks"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">Prefs -&gt; [(Maybe String, String, Key)]
</span><a href="System.Console.Haskeline.Prefs.html#customKeySequences"><span class="hs-identifier hs-var">customKeySequences</span></a></span><span>
</span><span id="line-118"></span><span>        </span><span id="local-6989586621679096812"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096812"><span class="hs-identifier hs-var">termName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String -&gt; m String
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO String -&gt; m String) -&gt; IO String -&gt; m String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(IOException -&gt; IO String) -&gt; IO String -&gt; IO String
forall (m :: * -&gt; *) e a.
(HasCallStack, MonadCatch m, Exception e) =&gt;
(e -&gt; m a) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">handle</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOException
</span><span class="hs-identifier">_</span></span><span class="hs-glyph">::</span><span class="annot"><span class="hs-identifier hs-type">IOException</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; IO String
</span><span class="hs-identifier hs-var">getEnv</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TERM&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679096817"><span class="annot"><span class="annottext">isThisTerm :: Maybe String -&gt; Bool
</span><a href="#local-6989586621679096817"><span class="hs-identifier hs-var hs-var">isThisTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (String -&gt; Bool) -&gt; Maybe String -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096812"><span class="hs-identifier hs-var">termName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>        </span><span class="annot"><span class="annottext">[(String, Key)] -&gt; m [(String, Key)]
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([(String, Key)] -&gt; m [(String, Key)])
-&gt; [(String, Key)] -&gt; m [(String, Key)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Maybe String, String, Key) -&gt; (String, Key))
-&gt; [(Maybe String, String, Key)] -&gt; [(String, Key)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679096819"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096819"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679096820"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679096820"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096819"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679096820"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>            </span><span class="annot"><span class="annottext">([(Maybe String, String, Key)] -&gt; [(String, Key)])
-&gt; [(Maybe String, String, Key)] -&gt; [(String, Key)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Maybe String, String, Key) -&gt; Bool)
-&gt; [(Maybe String, String, Key)] -&gt; [(Maybe String, String, Key)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679096821"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679096821"><span class="hs-identifier hs-var">kseqs'</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Key
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; Bool
</span><a href="#local-6989586621679096817"><span class="hs-identifier hs-var">isThisTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679096821"><span class="hs-identifier hs-var">kseqs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>            </span><span class="annot"><span class="annottext">([(Maybe String, String, Key)] -&gt; [(Maybe String, String, Key)])
-&gt; [(Maybe String, String, Key)] -&gt; [(Maybe String, String, Key)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Maybe String, String, Key)]
</span><a href="#local-6989586621679096809"><span class="hs-identifier hs-var">kseqs</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#ansiKeys"><span class="hs-identifier hs-type">ansiKeys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Key.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-126"></span><span id="ansiKeys"><span class="annot"><span class="annottext">ansiKeys :: [(String, Key)]
</span><a href="System.Console.Haskeline.Backend.Posix.html#ansiKeys"><span class="hs-identifier hs-var hs-var">ansiKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\ESC[D&quot;</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">BaseKey -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#simpleKey"><span class="hs-identifier hs-var">simpleKey</span></a></span><span> </span><span class="annot"><span class="annottext">BaseKey
</span><a href="System.Console.Haskeline.Key.html#LeftKey"><span class="hs-identifier hs-var">LeftKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>            </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\ESC[C&quot;</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">BaseKey -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#simpleKey"><span class="hs-identifier hs-var">simpleKey</span></a></span><span> </span><span class="annot"><span class="annottext">BaseKey
</span><a href="System.Console.Haskeline.Key.html#RightKey"><span class="hs-identifier hs-var">RightKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>            </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\ESC[A&quot;</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">BaseKey -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#simpleKey"><span class="hs-identifier hs-var">simpleKey</span></a></span><span> </span><span class="annot"><span class="annottext">BaseKey
</span><a href="System.Console.Haskeline.Key.html#UpKey"><span class="hs-identifier hs-var">UpKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>            </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\ESC[B&quot;</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">BaseKey -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#simpleKey"><span class="hs-identifier hs-var">simpleKey</span></a></span><span> </span><span class="annot"><span class="annottext">BaseKey
</span><a href="System.Console.Haskeline.Key.html#DownKey"><span class="hs-identifier hs-var">DownKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>            </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\b&quot;</span></span><span class="hs-special">,</span><span>      </span><span class="annot"><span class="annottext">BaseKey -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#simpleKey"><span class="hs-identifier hs-var">simpleKey</span></a></span><span> </span><span class="annot"><span class="annottext">BaseKey
</span><a href="System.Console.Haskeline.Key.html#Backspace"><span class="hs-identifier hs-var">Backspace</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>            </span><span class="hs-comment">-- ctrl-left/right aren't a standard</span><span>
</span><span id="line-132"></span><span>            </span><span class="hs-comment">-- part of terminfo, but enough people have complained</span><span>
</span><span id="line-133"></span><span>            </span><span class="hs-comment">-- that I've decided to hard-code them in.</span><span>
</span><span id="line-134"></span><span>            </span><span class="hs-comment">-- (Note they will be overridden by terminfo or .haskeline.)</span><span>
</span><span id="line-135"></span><span>            </span><span class="hs-comment">-- These appear to be the most common bindings:</span><span>
</span><span id="line-136"></span><span>            </span><span class="hs-comment">-- xterm:</span><span>
</span><span id="line-137"></span><span>            </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\ESC[1;5D&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#ctrlKey"><span class="hs-identifier hs-var">ctrlKey</span></a></span><span> </span><span class="annot"><span class="annottext">(Key -&gt; Key) -&gt; Key -&gt; Key
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BaseKey -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#simpleKey"><span class="hs-identifier hs-var">simpleKey</span></a></span><span> </span><span class="annot"><span class="annottext">BaseKey
</span><a href="System.Console.Haskeline.Key.html#LeftKey"><span class="hs-identifier hs-var">LeftKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>            </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\ESC[1;5C&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#ctrlKey"><span class="hs-identifier hs-var">ctrlKey</span></a></span><span> </span><span class="annot"><span class="annottext">(Key -&gt; Key) -&gt; Key -&gt; Key
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BaseKey -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#simpleKey"><span class="hs-identifier hs-var">simpleKey</span></a></span><span> </span><span class="annot"><span class="annottext">BaseKey
</span><a href="System.Console.Haskeline.Key.html#RightKey"><span class="hs-identifier hs-var">RightKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>            </span><span class="hs-comment">-- Terminal.app:</span><span>
</span><span id="line-140"></span><span>            </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\ESC[5D&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#ctrlKey"><span class="hs-identifier hs-var">ctrlKey</span></a></span><span> </span><span class="annot"><span class="annottext">(Key -&gt; Key) -&gt; Key -&gt; Key
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BaseKey -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#simpleKey"><span class="hs-identifier hs-var">simpleKey</span></a></span><span> </span><span class="annot"><span class="annottext">BaseKey
</span><a href="System.Console.Haskeline.Key.html#LeftKey"><span class="hs-identifier hs-var">LeftKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>            </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\ESC[5C&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#ctrlKey"><span class="hs-identifier hs-var">ctrlKey</span></a></span><span> </span><span class="annot"><span class="annottext">(Key -&gt; Key) -&gt; Key -&gt; Key
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BaseKey -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#simpleKey"><span class="hs-identifier hs-var">simpleKey</span></a></span><span> </span><span class="annot"><span class="annottext">BaseKey
</span><a href="System.Console.Haskeline.Key.html#RightKey"><span class="hs-identifier hs-var">RightKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>            </span><span class="hs-comment">-- rxvt: (Note: these will be superceded by e.g. xterm-color,</span><span>
</span><span id="line-143"></span><span>            </span><span class="hs-comment">-- which uses them as regular arrow keys.)</span><span>
</span><span id="line-144"></span><span>            </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\ESC[OD&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#ctrlKey"><span class="hs-identifier hs-var">ctrlKey</span></a></span><span> </span><span class="annot"><span class="annottext">(Key -&gt; Key) -&gt; Key -&gt; Key
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BaseKey -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#simpleKey"><span class="hs-identifier hs-var">simpleKey</span></a></span><span> </span><span class="annot"><span class="annottext">BaseKey
</span><a href="System.Console.Haskeline.Key.html#LeftKey"><span class="hs-identifier hs-var">LeftKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>            </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\ESC[OC&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#ctrlKey"><span class="hs-identifier hs-var">ctrlKey</span></a></span><span> </span><span class="annot"><span class="annottext">(Key -&gt; Key) -&gt; Key -&gt; Key
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BaseKey -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#simpleKey"><span class="hs-identifier hs-var">simpleKey</span></a></span><span> </span><span class="annot"><span class="annottext">BaseKey
</span><a href="System.Console.Haskeline.Key.html#RightKey"><span class="hs-identifier hs-var">RightKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#sttyKeys"><span class="hs-identifier hs-type">sttyKeys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Key.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-150"></span><span id="sttyKeys"><span class="annot"><span class="annottext">sttyKeys :: Handle -&gt; IO [(String, Key)]
</span><a href="System.Console.Haskeline.Backend.Posix.html#sttyKeys"><span class="hs-identifier hs-var hs-var">sttyKeys</span></a></span></span><span> </span><span id="local-6989586621679096829"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679096829"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-151"></span><span>    </span><span id="local-6989586621679096830"><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679096830"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO CInt
</span><a href="System.Console.Haskeline.Backend.Posix.html#unsafeHandleToFD"><span class="hs-identifier hs-var">unsafeHandleToFD</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679096829"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span id="local-6989586621679096831"><span class="annot"><span class="annottext">TerminalAttributes
</span><a href="#local-6989586621679096831"><span class="hs-identifier hs-var">attrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Fd -&gt; IO TerminalAttributes
</span><span class="hs-identifier hs-var">getTerminalAttributes</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; Fd
</span><span class="hs-identifier hs-var">Fd</span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679096830"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679096837"><span class="annot"><span class="annottext">getStty :: (ControlCharacter, b) -&gt; Maybe (String, b)
</span><a href="#local-6989586621679096837"><span class="hs-identifier hs-var hs-var">getStty</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679096838"><span class="annot"><span class="annottext">ControlCharacter
</span><a href="#local-6989586621679096838"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679096839"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679096839"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span id="local-6989586621679096840"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679096840"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TerminalAttributes -&gt; ControlCharacter -&gt; Maybe Char
</span><span class="hs-identifier hs-var">controlChar</span></span><span> </span><span class="annot"><span class="annottext">TerminalAttributes
</span><a href="#local-6989586621679096831"><span class="hs-identifier hs-var">attrs</span></a></span><span> </span><span class="annot"><span class="annottext">ControlCharacter
</span><a href="#local-6989586621679096838"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(String, b) -&gt; Maybe (String, b)
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679096840"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679096839"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-154"></span><span>    </span><span class="annot"><span class="annottext">[(String, Key)] -&gt; IO [(String, Key)]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([(String, Key)] -&gt; IO [(String, Key)])
-&gt; [(String, Key)] -&gt; IO [(String, Key)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Maybe (String, Key)] -&gt; [(String, Key)]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe (String, Key)] -&gt; [(String, Key)])
-&gt; [Maybe (String, Key)] -&gt; [(String, Key)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((ControlCharacter, Key) -&gt; Maybe (String, Key))
-&gt; [(ControlCharacter, Key)] -&gt; [Maybe (String, Key)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(ControlCharacter, Key) -&gt; Maybe (String, Key)
forall {b}. (ControlCharacter, b) -&gt; Maybe (String, b)
</span><a href="#local-6989586621679096837"><span class="hs-identifier hs-var">getStty</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ControlCharacter
</span><span class="hs-identifier hs-var">Erase</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">BaseKey -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#simpleKey"><span class="hs-identifier hs-var">simpleKey</span></a></span><span> </span><span class="annot"><span class="annottext">BaseKey
</span><a href="System.Console.Haskeline.Key.html#Backspace"><span class="hs-identifier hs-var">Backspace</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ControlCharacter
</span><span class="hs-identifier hs-var">Kill</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">BaseKey -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#simpleKey"><span class="hs-identifier hs-var">simpleKey</span></a></span><span> </span><span class="annot"><span class="annottext">BaseKey
</span><a href="System.Console.Haskeline.Key.html#KillLine"><span class="hs-identifier hs-var">KillLine</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-keyword">newtype</span><span> </span><span id="TreeMap"><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#TreeMap"><span class="hs-identifier hs-var">TreeMap</span></a></span></span><span> </span><span id="local-6989586621679096475"><span class="annot"><a href="#local-6989586621679096475"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679096476"><span class="annot"><a href="#local-6989586621679096476"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TreeMap"><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#TreeMap"><span class="hs-identifier hs-var">TreeMap</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679096475"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679096476"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#TreeMap"><span class="hs-identifier hs-type">TreeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096475"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096476"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>                        </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679096849"><span id="local-6989586621679096855"><span id="local-6989586621679096859"><span class="annot"><span class="annottext">Int -&gt; TreeMap a b -&gt; ShowS
[TreeMap a b] -&gt; ShowS
TreeMap a b -&gt; String
(Int -&gt; TreeMap a b -&gt; ShowS)
-&gt; (TreeMap a b -&gt; String)
-&gt; ([TreeMap a b] -&gt; ShowS)
-&gt; Show (TreeMap a b)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall a b. (Show a, Show b) =&gt; Int -&gt; TreeMap a b -&gt; ShowS
forall a b. (Show a, Show b) =&gt; [TreeMap a b] -&gt; ShowS
forall a b. (Show a, Show b) =&gt; TreeMap a b -&gt; String
$cshowsPrec :: forall a b. (Show a, Show b) =&gt; Int -&gt; TreeMap a b -&gt; ShowS
showsPrec :: Int -&gt; TreeMap a b -&gt; ShowS
$cshow :: forall a b. (Show a, Show b) =&gt; TreeMap a b -&gt; String
show :: TreeMap a b -&gt; String
$cshowList :: forall a b. (Show a, Show b) =&gt; [TreeMap a b] -&gt; ShowS
showList :: [TreeMap a b] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span id="local-6989586621679096471"><span id="local-6989586621679096472"><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#emptyTreeMap"><span class="hs-identifier hs-type">emptyTreeMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#TreeMap"><span class="hs-identifier hs-type">TreeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096471"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096472"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-160"></span><span id="emptyTreeMap"><span class="annot"><span class="annottext">emptyTreeMap :: forall a b. TreeMap a b
</span><a href="System.Console.Haskeline.Backend.Posix.html#emptyTreeMap"><span class="hs-identifier hs-var hs-var">emptyTreeMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map a (Maybe b, TreeMap a b) -&gt; TreeMap a b
forall a b. Map a (Maybe b, TreeMap a b) -&gt; TreeMap a b
</span><a href="System.Console.Haskeline.Backend.Posix.html#TreeMap"><span class="hs-identifier hs-var">TreeMap</span></a></span><span> </span><span class="annot"><span class="annottext">Map a (Maybe b, TreeMap a b)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span id="local-6989586621679096479"><span id="local-6989586621679096480"><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#insertIntoTree"><span class="hs-identifier hs-type">insertIntoTree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679096479"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679096479"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679096480"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#TreeMap"><span class="hs-identifier hs-type">TreeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096479"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096480"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#TreeMap"><span class="hs-identifier hs-type">TreeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096479"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096480"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-163"></span><span id="insertIntoTree"><span class="annot"><span class="annottext">insertIntoTree :: forall a b. Ord a =&gt; ([a], b) -&gt; TreeMap a b -&gt; TreeMap a b
</span><a href="System.Console.Haskeline.Backend.Posix.html#insertIntoTree"><span class="hs-identifier hs-var hs-var">insertIntoTree</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TreeMap a b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TreeMap a b
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Can't insert empty list into a treemap!&quot;</span></span><span>
</span><span id="line-164"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#insertIntoTree"><span class="hs-identifier hs-var">insertIntoTree</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679096876"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679096876"><span class="hs-identifier hs-var">c</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679096877"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679096877"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679096878"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679096878"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#TreeMap"><span class="hs-identifier hs-type">TreeMap</span></a></span><span> </span><span id="local-6989586621679096879"><span class="annot"><span class="annottext">Map a (Maybe b, TreeMap a b)
</span><a href="#local-6989586621679096879"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map a (Maybe b, TreeMap a b) -&gt; TreeMap a b
forall a b. Map a (Maybe b, TreeMap a b) -&gt; TreeMap a b
</span><a href="System.Console.Haskeline.Backend.Posix.html#TreeMap"><span class="hs-identifier hs-var">TreeMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Maybe (Maybe b, TreeMap a b) -&gt; Maybe (Maybe b, TreeMap a b))
-&gt; a
-&gt; Map a (Maybe b, TreeMap a b)
-&gt; Map a (Maybe b, TreeMap a b)
forall k a.
Ord k =&gt;
(Maybe a -&gt; Maybe a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.alter</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Maybe b, TreeMap a b) -&gt; Maybe (Maybe b, TreeMap a b)
</span><a href="#local-6989586621679096881"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679096876"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Map a (Maybe b, TreeMap a b)
</span><a href="#local-6989586621679096879"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-166"></span><span>        </span><span id="local-6989586621679096884"><span class="annot"><span class="annottext">alterSubtree :: TreeMap a b -&gt; TreeMap a b
</span><a href="#local-6989586621679096884"><span class="hs-identifier hs-var hs-var">alterSubtree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([a], b) -&gt; TreeMap a b -&gt; TreeMap a b
forall a b. Ord a =&gt; ([a], b) -&gt; TreeMap a b -&gt; TreeMap a b
</span><a href="System.Console.Haskeline.Backend.Posix.html#insertIntoTree"><span class="hs-identifier hs-var">insertIntoTree</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679096877"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679096878"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>        </span><span id="local-6989586621679096881"><span class="annot"><span class="annottext">f :: Maybe (Maybe b, TreeMap a b) -&gt; Maybe (Maybe b, TreeMap a b)
</span><a href="#local-6989586621679096881"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (Maybe b, TreeMap a b)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe b, TreeMap a b) -&gt; Maybe (Maybe b, TreeMap a b)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">((Maybe b, TreeMap a b) -&gt; Maybe (Maybe b, TreeMap a b))
-&gt; (Maybe b, TreeMap a b) -&gt; Maybe (Maybe b, TreeMap a b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679096877"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-168"></span><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; Maybe b
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679096878"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TreeMap a b
forall a b. TreeMap a b
</span><a href="System.Console.Haskeline.Backend.Posix.html#emptyTreeMap"><span class="hs-identifier hs-var">emptyTreeMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe b
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TreeMap a b -&gt; TreeMap a b
</span><a href="#local-6989586621679096884"><span class="hs-identifier hs-var">alterSubtree</span></a></span><span> </span><span class="annot"><span class="annottext">TreeMap a b
forall a b. TreeMap a b
</span><a href="System.Console.Haskeline.Backend.Posix.html#emptyTreeMap"><span class="hs-identifier hs-var">emptyTreeMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>        </span><span class="annot"><a href="#local-6989586621679096881"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679096888"><span class="annot"><span class="annottext">Maybe b
</span><a href="#local-6989586621679096888"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679096889"><span class="annot"><span class="annottext">TreeMap a b
</span><a href="#local-6989586621679096889"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe b, TreeMap a b) -&gt; Maybe (Maybe b, TreeMap a b)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">((Maybe b, TreeMap a b) -&gt; Maybe (Maybe b, TreeMap a b))
-&gt; (Maybe b, TreeMap a b) -&gt; Maybe (Maybe b, TreeMap a b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679096877"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-171"></span><span>                                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; Maybe b
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679096878"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TreeMap a b
</span><a href="#local-6989586621679096889"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>                                    </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe b
</span><a href="#local-6989586621679096888"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TreeMap a b -&gt; TreeMap a b
</span><a href="#local-6989586621679096884"><span class="hs-identifier hs-var">alterSubtree</span></a></span><span> </span><span class="annot"><span class="annottext">TreeMap a b
</span><a href="#local-6989586621679096889"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span id="local-6989586621679096440"><span id="local-6989586621679096441"><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#listToTree"><span class="hs-identifier hs-type">listToTree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679096440"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679096440"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679096441"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#TreeMap"><span class="hs-identifier hs-type">TreeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096440"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096441"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-175"></span><span id="listToTree"><span class="annot"><span class="annottext">listToTree :: forall a b. Ord a =&gt; [([a], b)] -&gt; TreeMap a b
</span><a href="System.Console.Haskeline.Backend.Posix.html#listToTree"><span class="hs-identifier hs-var hs-var">listToTree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TreeMap a b -&gt; ([a], b) -&gt; TreeMap a b)
-&gt; TreeMap a b -&gt; [([a], b)] -&gt; TreeMap a b
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(([a], b) -&gt; TreeMap a b -&gt; TreeMap a b)
-&gt; TreeMap a b -&gt; ([a], b) -&gt; TreeMap a b
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">([a], b) -&gt; TreeMap a b -&gt; TreeMap a b
forall a b. Ord a =&gt; ([a], b) -&gt; TreeMap a b -&gt; TreeMap a b
</span><a href="System.Console.Haskeline.Backend.Posix.html#insertIntoTree"><span class="hs-identifier hs-var">insertIntoTree</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TreeMap a b
forall a b. TreeMap a b
</span><a href="System.Console.Haskeline.Backend.Posix.html#emptyTreeMap"><span class="hs-identifier hs-var">emptyTreeMap</span></a></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-comment">-- for debugging '</span><span>
</span><span id="line-178"></span><span id="local-6989586621679096496"><span id="local-6989586621679096497"><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#mapLines"><span class="hs-identifier hs-type">mapLines</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679096496"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679096497"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#TreeMap"><span class="hs-identifier hs-type">TreeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096496"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096497"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-179"></span><span id="mapLines"><span class="annot"><span class="annottext">mapLines :: forall a b. (Show a, Show b) =&gt; TreeMap a b -&gt; [String]
</span><a href="System.Console.Haskeline.Backend.Posix.html#mapLines"><span class="hs-identifier hs-var hs-var">mapLines</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#TreeMap"><span class="hs-identifier hs-type">TreeMap</span></a></span><span> </span><span id="local-6989586621679096899"><span class="annot"><span class="annottext">Map a (Maybe b, TreeMap a b)
</span><a href="#local-6989586621679096899"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-180"></span><span>    </span><span id="local-6989586621679096904"><span class="annot"><span class="annottext">m2 :: Map a [String]
</span><a href="#local-6989586621679096904"><span class="hs-identifier hs-var hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Maybe b, TreeMap a b) -&gt; [String])
-&gt; Map a (Maybe b, TreeMap a b) -&gt; Map a [String]
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679096906"><span class="annot"><span class="annottext">Maybe b
</span><a href="#local-6989586621679096906"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679096907"><span class="annot"><span class="annottext">TreeMap a b
</span><a href="#local-6989586621679096907"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe b -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Maybe b
</span><a href="#local-6989586621679096906"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">TreeMap a b -&gt; [String]
forall a b. (Show a, Show b) =&gt; TreeMap a b -&gt; [String]
</span><a href="System.Console.Haskeline.Backend.Posix.html#mapLines"><span class="hs-identifier hs-var">mapLines</span></a></span><span> </span><span class="annot"><span class="annottext">TreeMap a b
</span><a href="#local-6989586621679096907"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map a (Maybe b, TreeMap a b)
</span><a href="#local-6989586621679096899"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">((a, [String]) -&gt; [String]) -&gt; [(a, [String])] -&gt; [String]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679096910"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679096910"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679096911"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679096911"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679096910"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span class="annot"><span class="annottext">Char -&gt; ShowS
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679096911"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(a, [String])] -&gt; [String]) -&gt; [(a, [String])] -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map a [String] -&gt; [(a, [String])]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map a [String]
</span><a href="#local-6989586621679096904"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#lexKeys"><span class="hs-identifier hs-type">lexKeys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#TreeMap"><span class="hs-identifier hs-type">TreeMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Key.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="System.Console.Haskeline.Key.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-184"></span><span id="lexKeys"><span class="annot"><span class="annottext">lexKeys :: TreeMap Char Key -&gt; String -&gt; [Key]
</span><a href="System.Console.Haskeline.Backend.Posix.html#lexKeys"><span class="hs-identifier hs-var hs-var">lexKeys</span></a></span></span><span> </span><span class="annot"><span class="annottext">TreeMap Char Key
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-185"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#lexKeys"><span class="hs-identifier hs-var">lexKeys</span></a></span><span> </span><span id="local-6989586621679096914"><span class="annot"><span class="annottext">TreeMap Char Key
</span><a href="#local-6989586621679096914"><span class="hs-identifier hs-var">baseMap</span></a></span></span><span> </span><span id="local-6989586621679096915"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096915"><span class="hs-identifier hs-var">cs</span></a></span></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679096916"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679096916"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679096917"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096917"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TreeMap Char Key -&gt; String -&gt; Maybe (Key, String)
</span><a href="System.Console.Haskeline.Backend.Posix.html#lookupChars"><span class="hs-identifier hs-var">lookupChars</span></a></span><span> </span><span class="annot"><span class="annottext">TreeMap Char Key
</span><a href="#local-6989586621679096914"><span class="hs-identifier hs-var">baseMap</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096915"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-187"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679096916"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Key -&gt; [Key] -&gt; [Key]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">TreeMap Char Key -&gt; String -&gt; [Key]
</span><a href="System.Console.Haskeline.Backend.Posix.html#lexKeys"><span class="hs-identifier hs-var">lexKeys</span></a></span><span> </span><span class="annot"><span class="annottext">TreeMap Char Key
</span><a href="#local-6989586621679096914"><span class="hs-identifier hs-var">baseMap</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096917"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-188"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#lexKeys"><span class="hs-identifier hs-var">lexKeys</span></a></span><span> </span><span id="local-6989586621679096919"><span class="annot"><span class="annottext">TreeMap Char Key
</span><a href="#local-6989586621679096919"><span class="hs-identifier hs-var">baseMap</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\ESC'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679096920"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096920"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- TODO: what's the right thing ' to do here?</span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679096921"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679096921"><span class="hs-identifier hs-var">k</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679096922"><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679096922"><span class="hs-identifier hs-var">ks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TreeMap Char Key -&gt; String -&gt; [Key]
</span><a href="System.Console.Haskeline.Backend.Posix.html#lexKeys"><span class="hs-identifier hs-var">lexKeys</span></a></span><span> </span><span class="annot"><span class="annottext">TreeMap Char Key
</span><a href="#local-6989586621679096919"><span class="hs-identifier hs-var">baseMap</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096920"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-191"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Key -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#metaKey"><span class="hs-identifier hs-var">metaKey</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679096921"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Key -&gt; [Key] -&gt; [Key]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Key]
</span><a href="#local-6989586621679096922"><span class="hs-identifier hs-var">ks</span></a></span><span>
</span><span id="line-192"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#lexKeys"><span class="hs-identifier hs-var">lexKeys</span></a></span><span> </span><span id="local-6989586621679096924"><span class="annot"><span class="annottext">TreeMap Char Key
</span><a href="#local-6989586621679096924"><span class="hs-identifier hs-var">baseMap</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679096925"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679096925"><span class="hs-identifier hs-var">c</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679096926"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096926"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Key
</span><a href="System.Console.Haskeline.Key.html#simpleChar"><span class="hs-identifier hs-var">simpleChar</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679096925"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Key -&gt; [Key] -&gt; [Key]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">TreeMap Char Key -&gt; String -&gt; [Key]
</span><a href="System.Console.Haskeline.Backend.Posix.html#lexKeys"><span class="hs-identifier hs-var">lexKeys</span></a></span><span> </span><span class="annot"><span class="annottext">TreeMap Char Key
</span><a href="#local-6989586621679096924"><span class="hs-identifier hs-var">baseMap</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096926"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#lookupChars"><span class="hs-identifier hs-type">lookupChars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#TreeMap"><span class="hs-identifier hs-type">TreeMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Key.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Console.Haskeline.Key.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span id="lookupChars"><span class="annot"><span class="annottext">lookupChars :: TreeMap Char Key -&gt; String -&gt; Maybe (Key, String)
</span><a href="System.Console.Haskeline.Backend.Posix.html#lookupChars"><span class="hs-identifier hs-var hs-var">lookupChars</span></a></span></span><span> </span><span class="annot"><span class="annottext">TreeMap Char Key
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Key, String)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-196"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#lookupChars"><span class="hs-identifier hs-var">lookupChars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#TreeMap"><span class="hs-identifier hs-type">TreeMap</span></a></span><span> </span><span id="local-6989586621679096928"><span class="annot"><span class="annottext">Map Char (Maybe Key, TreeMap Char Key)
</span><a href="#local-6989586621679096928"><span class="hs-identifier hs-var">tm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679096929"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679096929"><span class="hs-identifier hs-var">c</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679096930"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096930"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Char
-&gt; Map Char (Maybe Key, TreeMap Char Key)
-&gt; Maybe (Maybe Key, TreeMap Char Key)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679096929"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Map Char (Maybe Key, TreeMap Char Key)
</span><a href="#local-6989586621679096928"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Maybe Key, TreeMap Char Key)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Key, String)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Key
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span id="local-6989586621679096932"><span class="annot"><span class="annottext">TreeMap Char Key
</span><a href="#local-6989586621679096932"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TreeMap Char Key -&gt; String -&gt; Maybe (Key, String)
</span><a href="System.Console.Haskeline.Backend.Posix.html#lookupChars"><span class="hs-identifier hs-var">lookupChars</span></a></span><span> </span><span class="annot"><span class="annottext">TreeMap Char Key
</span><a href="#local-6989586621679096932"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096930"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679096933"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679096933"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679096934"><span class="annot"><span class="annottext">t :: TreeMap Char Key
</span><a href="#local-6989586621679096934"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#TreeMap"><span class="hs-identifier hs-type">TreeMap</span></a></span><span> </span><span id="local-6989586621679096935"><span class="annot"><span class="annottext">Map Char (Maybe Key, TreeMap Char Key)
</span><a href="#local-6989586621679096935"><span class="hs-identifier hs-var">tm2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096930"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Char (Maybe Key, TreeMap Char Key) -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.null</span></span><span> </span><span class="annot"><span class="annottext">Map Char (Maybe Key, TreeMap Char Key)
</span><a href="#local-6989586621679096935"><span class="hs-identifier hs-var">tm2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ?? lookup d tm2?</span><span>
</span><span id="line-201"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TreeMap Char Key -&gt; String -&gt; Maybe (Key, String)
</span><a href="System.Console.Haskeline.Backend.Posix.html#lookupChars"><span class="hs-identifier hs-var">lookupChars</span></a></span><span> </span><span class="annot"><span class="annottext">TreeMap Char Key
</span><a href="#local-6989586621679096934"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096930"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-202"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Key, String) -&gt; Maybe (Key, String)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679096933"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679096930"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="hs-comment">-----------------------------</span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span id="local-6989586621679096512"><span id="local-6989586621679096515"><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#withPosixGetEvent"><span class="hs-identifier hs-type">withPosixGetEvent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679096512"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679096512"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Monads.html#MonadReader"><span class="hs-identifier hs-type">MonadReader</span></a></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Prefs.html#Prefs"><span class="hs-identifier hs-type">Prefs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096512"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TChan</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#Handles"><span class="hs-identifier hs-type">Handles</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span class="annot"><a href="System.Console.Haskeline.Key.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-208"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679096512"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679096512"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096515"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679096512"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096515"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-209"></span><span id="withPosixGetEvent"><span class="annot"><span class="annottext">withPosixGetEvent :: forall (m :: * -&gt; *) a.
(MonadIO m, MonadMask m, MonadReader Prefs m) =&gt;
TChan Event
-&gt; Handles -&gt; [(String, Key)] -&gt; (m Event -&gt; m a) -&gt; m a
</span><a href="System.Console.Haskeline.Backend.Posix.html#withPosixGetEvent"><span class="hs-identifier hs-var hs-var">withPosixGetEvent</span></a></span></span><span> </span><span id="local-6989586621679096950"><span class="annot"><span class="annottext">TChan Event
</span><a href="#local-6989586621679096950"><span class="hs-identifier hs-var">eventChan</span></a></span></span><span> </span><span id="local-6989586621679096951"><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679096951"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679096952"><span class="annot"><span class="annottext">[(String, Key)]
</span><a href="#local-6989586621679096952"><span class="hs-identifier hs-var">termKeys</span></a></span></span><span> </span><span id="local-6989586621679096953"><span class="annot"><span class="annottext">m Event -&gt; m a
</span><a href="#local-6989586621679096953"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handles -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
(MonadIO m, MonadMask m) =&gt;
Handles -&gt; m a -&gt; m a
</span><a href="System.Console.Haskeline.Backend.Posix.html#wrapTerminalOps"><span class="hs-identifier hs-var">wrapTerminalOps</span></a></span><span> </span><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679096951"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; m a) -&gt; m a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-210"></span><span>    </span><span id="local-6989586621679096955"><span class="annot"><span class="annottext">TreeMap Char Key
</span><a href="#local-6989586621679096955"><span class="hs-identifier hs-var">baseMap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; [(String, Key)] -&gt; m (TreeMap Char Key)
forall (m :: * -&gt; *).
(MonadIO m, MonadReader Prefs m) =&gt;
Handle -&gt; [(String, Key)] -&gt; m (TreeMap Char Key)
</span><a href="System.Console.Haskeline.Backend.Posix.html#getKeySequences"><span class="hs-identifier hs-var">getKeySequences</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handles -&gt; Handle
</span><a href="System.Console.Haskeline.Backend.Posix.html#ehIn"><span class="hs-identifier hs-var">ehIn</span></a></span><span> </span><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679096951"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, Key)]
</span><a href="#local-6989586621679096952"><span class="hs-identifier hs-var">termKeys</span></a></span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><span class="annottext">TChan Event -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
(MonadIO m, MonadMask m) =&gt;
TChan Event -&gt; m a -&gt; m a
</span><a href="System.Console.Haskeline.Backend.Posix.html#withWindowHandler"><span class="hs-identifier hs-var">withWindowHandler</span></a></span><span> </span><span class="annot"><span class="annottext">TChan Event
</span><a href="#local-6989586621679096950"><span class="hs-identifier hs-var">eventChan</span></a></span><span>
</span><span id="line-212"></span><span>        </span><span class="annot"><span class="annottext">(m a -&gt; m a) -&gt; m a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">m Event -&gt; m a
</span><a href="#local-6989586621679096953"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(m Event -&gt; m a) -&gt; m Event -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO Event -&gt; m Event
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Event -&gt; m Event) -&gt; IO Event -&gt; m Event
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; TreeMap Char Key -&gt; TChan Event -&gt; IO Event
</span><a href="System.Console.Haskeline.Backend.Posix.html#getEvent"><span class="hs-identifier hs-var">getEvent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handles -&gt; Handle
</span><a href="System.Console.Haskeline.Backend.Posix.html#ehIn"><span class="hs-identifier hs-var">ehIn</span></a></span><span> </span><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679096951"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TreeMap Char Key
</span><a href="#local-6989586621679096955"><span class="hs-identifier hs-var">baseMap</span></a></span><span> </span><span class="annot"><span class="annottext">TChan Event
</span><a href="#local-6989586621679096950"><span class="hs-identifier hs-var">eventChan</span></a></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span id="local-6989586621679096520"><span id="local-6989586621679096521"><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#withWindowHandler"><span class="hs-identifier hs-type">withWindowHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679096520"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679096520"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TChan</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679096520"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096521"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679096520"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096521"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-215"></span><span id="withWindowHandler"><span class="annot"><span class="annottext">withWindowHandler :: forall (m :: * -&gt; *) a.
(MonadIO m, MonadMask m) =&gt;
TChan Event -&gt; m a -&gt; m a
</span><a href="System.Console.Haskeline.Backend.Posix.html#withWindowHandler"><span class="hs-identifier hs-var hs-var">withWindowHandler</span></a></span></span><span> </span><span id="local-6989586621679096962"><span class="annot"><span class="annottext">TChan Event
</span><a href="#local-6989586621679096962"><span class="hs-identifier hs-var">eventChan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; Handler -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
(MonadIO m, MonadMask m) =&gt;
CInt -&gt; Handler -&gt; m a -&gt; m a
</span><a href="System.Console.Haskeline.Backend.Posix.html#withHandler"><span class="hs-identifier hs-var">withHandler</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><span class="hs-identifier hs-var">windowChange</span></span><span> </span><span class="annot"><span class="annottext">(Handler -&gt; m a -&gt; m a) -&gt; Handler -&gt; m a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-216"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; Handler
</span><span class="hs-identifier hs-var">Catch</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Handler) -&gt; IO () -&gt; Handler
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TChan Event -&gt; Event -&gt; STM ()
forall a. TChan a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTChan</span></span><span> </span><span class="annot"><span class="annottext">TChan Event
</span><a href="#local-6989586621679096962"><span class="hs-identifier hs-var">eventChan</span></a></span><span> </span><span class="annot"><span class="annottext">Event
</span><a href="System.Console.Haskeline.Term.html#WindowResize"><span class="hs-identifier hs-var">WindowResize</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span id="local-6989586621679096530"><span id="local-6989586621679096531"><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#withSigIntHandler"><span class="hs-identifier hs-type">withSigIntHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679096530"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679096530"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679096530"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096531"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679096530"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096531"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-219"></span><span id="withSigIntHandler"><span class="annot"><span class="annottext">withSigIntHandler :: forall (m :: * -&gt; *) a. (MonadIO m, MonadMask m) =&gt; m a -&gt; m a
</span><a href="System.Console.Haskeline.Backend.Posix.html#withSigIntHandler"><span class="hs-identifier hs-var hs-var">withSigIntHandler</span></a></span></span><span> </span><span id="local-6989586621679096979"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679096979"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-220"></span><span>    </span><span id="local-6989586621679096980"><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621679096980"><span class="hs-identifier hs-var">tid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ThreadId -&gt; m ThreadId
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO ThreadId
</span><span class="hs-identifier hs-var">myThreadId</span></span><span>
</span><span id="line-221"></span><span>    </span><span class="annot"><span class="annottext">CInt -&gt; Handler -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
(MonadIO m, MonadMask m) =&gt;
CInt -&gt; Handler -&gt; m a -&gt; m a
</span><a href="System.Console.Haskeline.Backend.Posix.html#withHandler"><span class="hs-identifier hs-var">withHandler</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><span class="hs-identifier hs-var">keyboardSignal</span></span><span>
</span><span id="line-222"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; Handler
</span><span class="hs-identifier hs-var">Catch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThreadId -&gt; Interrupt -&gt; IO ()
forall e. Exception e =&gt; ThreadId -&gt; e -&gt; IO ()
</span><span class="hs-identifier hs-var">throwTo</span></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621679096980"><span class="hs-identifier hs-var">tid</span></a></span><span> </span><span class="annot"><span class="annottext">Interrupt
</span><a href="System.Console.Haskeline.Term.html#Interrupt"><span class="hs-identifier hs-var">Interrupt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>            </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679096979"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span id="local-6989586621679096525"><span id="local-6989586621679096526"><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#withHandler"><span class="hs-identifier hs-type">withHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679096525"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679096525"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Signal</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679096525"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096526"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679096525"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096526"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-226"></span><span id="withHandler"><span class="annot"><span class="annottext">withHandler :: forall (m :: * -&gt; *) a.
(MonadIO m, MonadMask m) =&gt;
CInt -&gt; Handler -&gt; m a -&gt; m a
</span><a href="System.Console.Haskeline.Backend.Posix.html#withHandler"><span class="hs-identifier hs-var hs-var">withHandler</span></a></span></span><span> </span><span id="local-6989586621679096994"><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679096994"><span class="hs-identifier hs-var">signal</span></a></span></span><span> </span><span id="local-6989586621679096995"><span class="annot"><span class="annottext">Handler
</span><a href="#local-6989586621679096995"><span class="hs-identifier hs-var">handler</span></a></span></span><span> </span><span id="local-6989586621679096996"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679096996"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-227"></span><span>    </span><span id="local-6989586621679096997"><span class="annot"><span class="annottext">Handler
</span><a href="#local-6989586621679096997"><span class="hs-identifier hs-var">old_handler</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Handler -&gt; m Handler
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Handler -&gt; m Handler) -&gt; IO Handler -&gt; m Handler
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CInt -&gt; Handler -&gt; Maybe SignalSet -&gt; IO Handler
</span><span class="hs-identifier hs-var">installHandler</span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679096994"><span class="hs-identifier hs-var">signal</span></a></span><span> </span><span class="annot"><span class="annottext">Handler
</span><a href="#local-6989586621679096995"><span class="hs-identifier hs-var">handler</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SignalSet
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-228"></span><span>    </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679096996"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; m Handler -&gt; m a
forall (m :: * -&gt; *) a b.
(HasCallStack, MonadMask m) =&gt;
m a -&gt; m b -&gt; m a
</span><span class="hs-operator hs-var">`finally`</span></span><span> </span><span class="annot"><span class="annottext">IO Handler -&gt; m Handler
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; Handler -&gt; Maybe SignalSet -&gt; IO Handler
</span><span class="hs-identifier hs-var">installHandler</span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679096994"><span class="hs-identifier hs-var">signal</span></a></span><span> </span><span class="annot"><span class="annottext">Handler
</span><a href="#local-6989586621679096997"><span class="hs-identifier hs-var">old_handler</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SignalSet
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#getEvent"><span class="hs-identifier hs-type">getEvent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#TreeMap"><span class="hs-identifier hs-type">TreeMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Key.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TChan</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span>
</span><span id="line-231"></span><span id="getEvent"><span class="annot"><span class="annottext">getEvent :: Handle -&gt; TreeMap Char Key -&gt; TChan Event -&gt; IO Event
</span><a href="System.Console.Haskeline.Backend.Posix.html#getEvent"><span class="hs-identifier hs-var hs-var">getEvent</span></a></span></span><span> </span><span id="local-6989586621679096999"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679096999"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679097000"><span class="annot"><span class="annottext">TreeMap Char Key
</span><a href="#local-6989586621679097000"><span class="hs-identifier hs-var">baseMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO [Event] -&gt; TChan Event -&gt; IO Event
</span><a href="System.Console.Haskeline.Term.html#keyEventLoop"><span class="hs-identifier hs-var">keyEventLoop</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [Event] -&gt; TChan Event -&gt; IO Event)
-&gt; IO [Event] -&gt; TChan Event -&gt; IO Event
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-232"></span><span>        </span><span id="local-6989586621679097002"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679097002"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO String
</span><a href="System.Console.Haskeline.Backend.Posix.html#getBlockOfChars"><span class="hs-identifier hs-var">getBlockOfChars</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679096999"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-233"></span><span>        </span><span class="annot"><span class="annottext">[Event] -&gt; IO [Event]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Key] -&gt; Event
</span><a href="System.Console.Haskeline.Term.html#KeyInput"><span class="hs-identifier hs-var">KeyInput</span></a></span><span> </span><span class="annot"><span class="annottext">([Key] -&gt; Event) -&gt; [Key] -&gt; Event
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TreeMap Char Key -&gt; String -&gt; [Key]
</span><a href="System.Console.Haskeline.Backend.Posix.html#lexKeys"><span class="hs-identifier hs-var">lexKeys</span></a></span><span> </span><span class="annot"><span class="annottext">TreeMap Char Key
</span><a href="#local-6989586621679097000"><span class="hs-identifier hs-var">baseMap</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679097002"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="hs-comment">-- Read at least one character of input, and more if immediately</span><span>
</span><span id="line-236"></span><span class="hs-comment">-- available.  In particular the characters making up a control sequence</span><span>
</span><span id="line-237"></span><span class="hs-comment">-- will all be available at once, so they can be processed together</span><span>
</span><span id="line-238"></span><span class="hs-comment">-- (with Posix.lexKeys).</span><span>
</span><span id="line-239"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#getBlockOfChars"><span class="hs-identifier hs-type">getBlockOfChars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-240"></span><span id="getBlockOfChars"><span class="annot"><span class="annottext">getBlockOfChars :: Handle -&gt; IO String
</span><a href="System.Console.Haskeline.Backend.Posix.html#getBlockOfChars"><span class="hs-identifier hs-var hs-var">getBlockOfChars</span></a></span></span><span> </span><span id="local-6989586621679097005"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679097005"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-241"></span><span>    </span><span id="local-6989586621679097006"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679097006"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO Char
</span><span class="hs-identifier hs-var">hGetChar</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679097005"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><a href="#local-6989586621679097008"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679097006"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-244"></span><span>    </span><span id="local-6989586621679097008"><span class="annot"><span class="annottext">loop :: String -&gt; IO String
</span><a href="#local-6989586621679097008"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679097012"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679097012"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-245"></span><span>        </span><span id="local-6989586621679097013"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679097013"><span class="hs-identifier hs-var">isReady</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO Bool
</span><span class="hs-identifier hs-var">hReady</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679097005"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-246"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679097013"><span class="hs-identifier hs-var">isReady</span></a></span><span>
</span><span id="line-247"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO String) -&gt; String -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShowS
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679097012"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-248"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-249"></span><span>                    </span><span id="local-6989586621679097016"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679097016"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO Char
</span><span class="hs-identifier hs-var">hGetChar</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679097005"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-250"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><a href="#local-6989586621679097008"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679097016"><span class="hs-identifier hs-var">c</span></a></span><span class="annot"><span class="annottext">Char -&gt; ShowS
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679097012"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#stdinTTYHandles"><span class="hs-identifier hs-type">stdinTTYHandles</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#ttyHandles"><span class="hs-identifier hs-type">ttyHandles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#Handles"><span class="hs-identifier hs-type">Handles</span></a></span><span>
</span><span id="line-253"></span><span id="stdinTTYHandles"><span class="annot"><span class="annottext">stdinTTYHandles :: MaybeT IO Handles
</span><a href="System.Console.Haskeline.Backend.Posix.html#stdinTTYHandles"><span class="hs-identifier hs-var hs-var">stdinTTYHandles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-254"></span><span>    </span><span id="local-6989586621679097017"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679097017"><span class="hs-identifier hs-var">isInTerm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; MaybeT IO Bool
forall a. IO a -&gt; MaybeT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; MaybeT IO Bool) -&gt; IO Bool -&gt; MaybeT IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO Bool
</span><span class="hs-identifier hs-var">hIsTerminalDevice</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stdin</span></span><span>
</span><span id="line-255"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; MaybeT IO ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679097017"><span class="hs-identifier hs-var">isInTerm</span></a></span><span>
</span><span id="line-256"></span><span>    </span><span id="local-6989586621679097020"><span class="annot"><span class="annottext">ExternalHandle
</span><a href="#local-6989586621679097020"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOMode -&gt; MaybeT IO ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.html#openTerm"><span class="hs-identifier hs-var">openTerm</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><span class="hs-identifier hs-var">WriteMode</span></span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-comment">-- Don't close stdin, since a different part of the program may use it later.</span><span>
</span><span id="line-258"></span><span>    </span><span class="annot"><span class="annottext">Handles -&gt; MaybeT IO Handles
forall a. a -&gt; MaybeT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#Handles"><span class="hs-identifier hs-type">Handles</span></a></span><span>
</span><span id="line-259"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hIn :: ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.html#hIn"><span class="hs-identifier hs-var">hIn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.Encoder.html#externalHandle"><span class="hs-identifier hs-var">externalHandle</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stdin</span></span><span>
</span><span id="line-260"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hOut :: ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.html#hOut"><span class="hs-identifier hs-var">hOut</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExternalHandle
</span><a href="#local-6989586621679097020"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-261"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">closeHandles :: IO ()
</span><a href="System.Console.Haskeline.Backend.Posix.html#closeHandles"><span class="hs-identifier hs-var">closeHandles</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">hClose</span></span><span> </span><span class="annot"><span class="annottext">(Handle -&gt; IO ()) -&gt; Handle -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExternalHandle -&gt; Handle
</span><a href="System.Console.Haskeline.Backend.Posix.Encoder.html#eH"><span class="hs-identifier hs-var">eH</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalHandle
</span><a href="#local-6989586621679097020"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-262"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span id="ttyHandles"><span class="annot"><span class="annottext">ttyHandles :: MaybeT IO Handles
</span><a href="System.Console.Haskeline.Backend.Posix.html#ttyHandles"><span class="hs-identifier hs-var hs-var">ttyHandles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-comment">-- Open the input and output as two separate Handles, since they need</span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-comment">-- different buffering.</span><span>
</span><span id="line-267"></span><span>    </span><span id="local-6989586621679097025"><span class="annot"><span class="annottext">ExternalHandle
</span><a href="#local-6989586621679097025"><span class="hs-identifier hs-var">h_in</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOMode -&gt; MaybeT IO ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.html#openTerm"><span class="hs-identifier hs-var">openTerm</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><span class="hs-identifier hs-var">ReadMode</span></span><span>
</span><span id="line-268"></span><span>    </span><span id="local-6989586621679097027"><span class="annot"><span class="annottext">ExternalHandle
</span><a href="#local-6989586621679097027"><span class="hs-identifier hs-var">h_out</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOMode -&gt; MaybeT IO ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.html#openTerm"><span class="hs-identifier hs-var">openTerm</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><span class="hs-identifier hs-var">WriteMode</span></span><span>
</span><span id="line-269"></span><span>    </span><span class="annot"><span class="annottext">Handles -&gt; MaybeT IO Handles
forall a. a -&gt; MaybeT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#Handles"><span class="hs-identifier hs-type">Handles</span></a></span><span>
</span><span id="line-270"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hIn :: ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.html#hIn"><span class="hs-identifier hs-var">hIn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExternalHandle
</span><a href="#local-6989586621679097025"><span class="hs-identifier hs-var">h_in</span></a></span><span>
</span><span id="line-271"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hOut :: ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.html#hOut"><span class="hs-identifier hs-var">hOut</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExternalHandle
</span><a href="#local-6989586621679097027"><span class="hs-identifier hs-var">h_out</span></a></span><span>
</span><span id="line-272"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">closeHandles :: IO ()
</span><a href="System.Console.Haskeline.Backend.Posix.html#closeHandles"><span class="hs-identifier hs-var">closeHandles</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">hClose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExternalHandle -&gt; Handle
</span><a href="System.Console.Haskeline.Backend.Posix.Encoder.html#eH"><span class="hs-identifier hs-var">eH</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalHandle
</span><a href="#local-6989586621679097025"><span class="hs-identifier hs-var">h_in</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">hClose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExternalHandle -&gt; Handle
</span><a href="System.Console.Haskeline.Backend.Posix.Encoder.html#eH"><span class="hs-identifier hs-var">eH</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalHandle
</span><a href="#local-6989586621679097027"><span class="hs-identifier hs-var">h_out</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#openTerm"><span class="hs-identifier hs-type">openTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IOMode</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.Encoder.html#ExternalHandle"><span class="hs-identifier hs-type">ExternalHandle</span></a></span><span>
</span><span id="line-276"></span><span id="openTerm"><span class="annot"><span class="annottext">openTerm :: IOMode -&gt; MaybeT IO ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.html#openTerm"><span class="hs-identifier hs-var hs-var">openTerm</span></a></span></span><span> </span><span id="local-6989586621679097028"><span class="annot"><span class="annottext">IOMode
</span><a href="#local-6989586621679097028"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IOException -&gt; MaybeT IO ExternalHandle)
-&gt; MaybeT IO ExternalHandle -&gt; MaybeT IO ExternalHandle
forall (m :: * -&gt; *) e a.
(HasCallStack, MonadCatch m, Exception e) =&gt;
(e -&gt; m a) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">handle</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOException
</span><span class="hs-identifier">_</span></span><span class="hs-glyph">::</span><span class="annot"><span class="hs-identifier hs-type">IOException</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT IO ExternalHandle
forall a. MaybeT IO a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>            </span><span class="annot"><span class="annottext">(MaybeT IO ExternalHandle -&gt; MaybeT IO ExternalHandle)
-&gt; MaybeT IO ExternalHandle -&gt; MaybeT IO ExternalHandle
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO ExternalHandle -&gt; MaybeT IO ExternalHandle
forall a. IO a -&gt; MaybeT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO ExternalHandle -&gt; MaybeT IO ExternalHandle)
-&gt; IO ExternalHandle -&gt; MaybeT IO ExternalHandle
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IOMode -&gt; IO ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.Encoder.html#openInCodingMode"><span class="hs-identifier hs-var">openInCodingMode</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/dev/tty&quot;</span></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><a href="#local-6989586621679097028"><span class="hs-identifier hs-var">mode</span></a></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#posixRunTerm"><span class="hs-identifier hs-type">posixRunTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-281"></span><span>    </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#Handles"><span class="hs-identifier hs-type">Handles</span></a></span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#Layout"><span class="hs-identifier hs-type">Layout</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span class="annot"><a href="System.Console.Haskeline.Key.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679097031"><span class="annot"><a href="#local-6989586621679097031"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679097032"><span class="annot"><a href="#local-6989586621679097032"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679097031"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679097031"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679097031"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679097032"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679097031"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679097032"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679096550"><span class="annot"><a href="#local-6989586621679096550"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679096550"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#CommandMonad"><span class="hs-identifier hs-type">CommandMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096550"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#EvalTerm"><span class="hs-identifier hs-type">EvalTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#PosixT"><span class="hs-identifier hs-type">PosixT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096550"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#RunTerm"><span class="hs-identifier hs-type">RunTerm</span></a></span><span>
</span><span id="line-287"></span><span id="posixRunTerm"><span class="annot"><span class="annottext">posixRunTerm :: Handles
-&gt; [IO (Maybe Layout)]
-&gt; [(String, Key)]
-&gt; (forall (m :: * -&gt; *) a. (MonadIO m, MonadMask m) =&gt; m a -&gt; m a)
-&gt; (forall (m :: * -&gt; *).
    (MonadMask m, CommandMonad m) =&gt;
    EvalTerm (PosixT m))
-&gt; IO RunTerm
</span><a href="System.Console.Haskeline.Backend.Posix.html#posixRunTerm"><span class="hs-identifier hs-var hs-var">posixRunTerm</span></a></span></span><span> </span><span id="local-6989586621679097033"><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679097033"><span class="hs-identifier hs-var">hs</span></a></span></span><span> </span><span id="local-6989586621679097034"><span class="annot"><span class="annottext">[IO (Maybe Layout)]
</span><a href="#local-6989586621679097034"><span class="hs-identifier hs-var">layoutGetters</span></a></span></span><span> </span><span id="local-6989586621679097035"><span class="annot"><span class="annottext">[(String, Key)]
</span><a href="#local-6989586621679097035"><span class="hs-identifier hs-var">keys</span></a></span></span><span> </span><span id="local-6989586621679097036"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. (MonadIO m, MonadMask m) =&gt; m a -&gt; m a
</span><a href="#local-6989586621679097036"><span class="hs-identifier hs-var">wrapGetEvent</span></a></span></span><span> </span><span id="local-6989586621679097037"><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(MonadMask m, CommandMonad m) =&gt;
EvalTerm (PosixT m)
</span><a href="#local-6989586621679097037"><span class="hs-identifier hs-var">evalBackend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-288"></span><span>    </span><span id="local-6989586621679097038"><span class="annot"><span class="annottext">TChan Event
</span><a href="#local-6989586621679097038"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (TChan Event)
forall a. IO (TChan a)
</span><span class="hs-identifier hs-var">newTChanIO</span></span><span>
</span><span id="line-289"></span><span>    </span><span id="local-6989586621679097040"><span class="annot"><span class="annottext">RunTerm
</span><a href="#local-6989586621679097040"><span class="hs-identifier hs-var">fileRT</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Handles -&gt; IO RunTerm
</span><a href="System.Console.Haskeline.Backend.Posix.html#posixFileRunTerm"><span class="hs-identifier hs-var">posixFileRunTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679097033"><span class="hs-identifier hs-var">hs</span></a></span><span>
</span><span id="line-290"></span><span>    </span><span class="annot"><span class="annottext">RunTerm -&gt; IO RunTerm
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">RunTerm
</span><a href="#local-6989586621679097040"><span class="hs-identifier hs-var">fileRT</span></a></span><span>
</span><span id="line-291"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#termOps"><span class="hs-identifier hs-var">termOps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#TermOps"><span class="hs-identifier hs-type">TermOps</span></a></span><span>
</span><span id="line-292"></span><span>                            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#getLayout"><span class="hs-identifier hs-var">getLayout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#tryGetLayouts"><span class="hs-identifier hs-type">tryGetLayouts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679097034"><span class="hs-identifier hs-type">layoutGetters</span></a></span><span>
</span><span id="line-293"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#withGetEvent"><span class="hs-identifier hs-var">withGetEvent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679097036"><span class="hs-identifier hs-type">wrapGetEvent</span></a></span><span>
</span><span id="line-294"></span><span>                                            </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#withPosixGetEvent"><span class="hs-identifier hs-type">withPosixGetEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679097038"><span class="hs-identifier hs-type">ch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679097033"><span class="hs-identifier hs-type">hs</span></a></span><span>
</span><span id="line-295"></span><span>                                                </span><span class="annot"><a href="#local-6989586621679097035"><span class="hs-identifier hs-type">keys</span></a></span><span>
</span><span id="line-296"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#saveUnusedKeys"><span class="hs-identifier hs-var">saveUnusedKeys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#saveKeys"><span class="hs-identifier hs-type">saveKeys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679097038"><span class="hs-identifier hs-type">ch</span></a></span><span>
</span><span id="line-297"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#evalTerm"><span class="hs-identifier hs-var">evalTerm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#mapEvalTerm"><span class="hs-identifier hs-type">mapEvalTerm</span></a></span><span>
</span><span id="line-298"></span><span>                                            </span><span class="hs-special">(</span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#runPosixT"><span class="hs-identifier hs-type">runPosixT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679097033"><span class="hs-identifier hs-type">hs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><a href="#local-6989586621679097037"><span class="hs-identifier hs-type">evalBackend</span></a></span><span>
</span><span id="line-299"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#externalPrint"><span class="hs-identifier hs-var">externalPrint</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">atomically</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">writeTChan</span></span><span> </span><span class="annot"><a href="#local-6989586621679097038"><span class="hs-identifier hs-type">ch</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#ExternalPrint"><span class="hs-identifier hs-type">ExternalPrint</span></a></span><span>
</span><span id="line-300"></span><span>                            </span><span class="hs-special">}</span><span>
</span><span id="line-301"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#closeTerm"><span class="hs-identifier hs-var">closeTerm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-302"></span><span>                    </span><span class="annot"><a href="System.Console.Haskeline.Term.html#flushEventQueue"><span class="hs-identifier hs-type">flushEventQueue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Console.Haskeline.Term.html#putStrOut"><span class="hs-identifier hs-var">putStrOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679097040"><span class="hs-identifier hs-type">fileRT</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679097038"><span class="hs-identifier hs-type">ch</span></a></span><span>
</span><span id="line-303"></span><span>                    </span><span class="annot"><a href="System.Console.Haskeline.Term.html#closeTerm"><span class="hs-identifier hs-var">closeTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679097040"><span class="hs-identifier hs-type">fileRT</span></a></span><span>
</span><span id="line-304"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="hs-keyword">type</span><span> </span><span id="PosixT"><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#PosixT"><span class="hs-identifier hs-var">PosixT</span></a></span></span><span> </span><span id="local-6989586621679097079"><span class="annot"><a href="#local-6989586621679097079"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#Handles"><span class="hs-identifier hs-type">Handles</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679097079"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span id="local-6989586621679096575"><span id="local-6989586621679096576"><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#runPosixT"><span class="hs-identifier hs-type">runPosixT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#Handles"><span class="hs-identifier hs-type">Handles</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#PosixT"><span class="hs-identifier hs-type">PosixT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096575"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096576"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679096575"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096576"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-309"></span><span id="runPosixT"><span class="annot"><span class="annottext">runPosixT :: forall (m :: * -&gt; *) a. Handles -&gt; PosixT m a -&gt; m a
</span><a href="System.Console.Haskeline.Backend.Posix.html#runPosixT"><span class="hs-identifier hs-var hs-var">runPosixT</span></a></span></span><span> </span><span id="local-6989586621679097080"><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679097080"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handles -&gt; ReaderT Handles m a -&gt; m a
forall r (m :: * -&gt; *) a. r -&gt; ReaderT r m a -&gt; m a
</span><a href="System.Console.Haskeline.Monads.html#runReaderT%27"><span class="hs-identifier hs-var">runReaderT'</span></a></span><span> </span><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679097080"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#fileRunTerm"><span class="hs-identifier hs-type">fileRunTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#RunTerm"><span class="hs-identifier hs-type">RunTerm</span></a></span><span>
</span><span id="line-312"></span><span id="fileRunTerm"><span class="annot"><span class="annottext">fileRunTerm :: Handle -&gt; IO RunTerm
</span><a href="System.Console.Haskeline.Backend.Posix.html#fileRunTerm"><span class="hs-identifier hs-var hs-var">fileRunTerm</span></a></span></span><span> </span><span id="local-6989586621679097082"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679097082"><span class="hs-identifier hs-var">h_in</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handles -&gt; IO RunTerm
</span><a href="System.Console.Haskeline.Backend.Posix.html#posixFileRunTerm"><span class="hs-identifier hs-var">posixFileRunTerm</span></a></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#Handles"><span class="hs-identifier hs-type">Handles</span></a></span><span>
</span><span id="line-313"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hIn :: ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.html#hIn"><span class="hs-identifier hs-var">hIn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.Encoder.html#externalHandle"><span class="hs-identifier hs-var">externalHandle</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679097082"><span class="hs-identifier hs-var">h_in</span></a></span><span>
</span><span id="line-314"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hOut :: ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.html#hOut"><span class="hs-identifier hs-var">hOut</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.Encoder.html#externalHandle"><span class="hs-identifier hs-var">externalHandle</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stdout</span></span><span>
</span><span id="line-315"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">closeHandles :: IO ()
</span><a href="System.Console.Haskeline.Backend.Posix.html#closeHandles"><span class="hs-identifier hs-var">closeHandles</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#posixFileRunTerm"><span class="hs-identifier hs-type">posixFileRunTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#Handles"><span class="hs-identifier hs-type">Handles</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#RunTerm"><span class="hs-identifier hs-type">RunTerm</span></a></span><span>
</span><span id="line-319"></span><span id="posixFileRunTerm"><span class="annot"><span class="annottext">posixFileRunTerm :: Handles -&gt; IO RunTerm
</span><a href="System.Console.Haskeline.Backend.Posix.html#posixFileRunTerm"><span class="hs-identifier hs-var hs-var">posixFileRunTerm</span></a></span></span><span> </span><span id="local-6989586621679097084"><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679097084"><span class="hs-identifier hs-var">hs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-320"></span><span>    </span><span class="annot"><span class="annottext">RunTerm -&gt; IO RunTerm
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#RunTerm"><span class="hs-identifier hs-type">RunTerm</span></a></span><span>
</span><span id="line-321"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">putStrOut :: String -&gt; IO ()
</span><a href="System.Console.Haskeline.Term.html#putStrOut"><span class="hs-identifier hs-var">putStrOut</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679097086"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679097086"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExternalHandle -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a.
(MonadIO m, MonadMask m) =&gt;
ExternalHandle -&gt; m a -&gt; m a
</span><a href="System.Console.Haskeline.Backend.Posix.Encoder.html#withCodingMode"><span class="hs-identifier hs-var">withCodingMode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handles -&gt; ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.html#hOut"><span class="hs-identifier hs-var">hOut</span></a></span><span> </span><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679097084"><span class="hs-identifier hs-var">hs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-322"></span><span>                                        </span><span class="annot"><span class="annottext">Handle -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">hPutStr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handles -&gt; Handle
</span><a href="System.Console.Haskeline.Backend.Posix.html#ehOut"><span class="hs-identifier hs-var">ehOut</span></a></span><span> </span><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679097084"><span class="hs-identifier hs-var">hs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679097086"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-323"></span><span>                                        </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">hFlush</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handles -&gt; Handle
</span><a href="System.Console.Haskeline.Backend.Posix.html#ehOut"><span class="hs-identifier hs-var">ehOut</span></a></span><span> </span><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679097084"><span class="hs-identifier hs-var">hs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">closeTerm :: IO ()
</span><a href="System.Console.Haskeline.Term.html#closeTerm"><span class="hs-identifier hs-var">closeTerm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handles -&gt; IO ()
</span><a href="System.Console.Haskeline.Backend.Posix.html#closeHandles"><span class="hs-identifier hs-var">closeHandles</span></a></span><span> </span><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679097084"><span class="hs-identifier hs-var">hs</span></a></span><span>
</span><span id="line-325"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wrapInterrupt :: forall a (m :: * -&gt; *). (MonadIO m, MonadMask m) =&gt; m a -&gt; m a
</span><a href="System.Console.Haskeline.Term.html#wrapInterrupt"><span class="hs-identifier hs-var">wrapInterrupt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; m a
forall a (m :: * -&gt; *). (MonadIO m, MonadMask m) =&gt; m a -&gt; m a
forall (m :: * -&gt; *) a. (MonadIO m, MonadMask m) =&gt; m a -&gt; m a
</span><a href="System.Console.Haskeline.Backend.Posix.html#withSigIntHandler"><span class="hs-identifier hs-var">withSigIntHandler</span></a></span><span>
</span><span id="line-326"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">termOps :: Either TermOps FileOps
</span><a href="System.Console.Haskeline.Term.html#termOps"><span class="hs-identifier hs-var">termOps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679097095"><span class="annot"><span class="annottext">h_in :: Handle
</span><a href="#local-6989586621679097095"><span class="hs-identifier hs-var hs-var">h_in</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handles -&gt; Handle
</span><a href="System.Console.Haskeline.Backend.Posix.html#ehIn"><span class="hs-identifier hs-var">ehIn</span></a></span><span> </span><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679097084"><span class="hs-identifier hs-var">hs</span></a></span><span>
</span><span id="line-327"></span><span>                            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">FileOps -&gt; Either TermOps FileOps
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><a href="System.Console.Haskeline.Term.html#FileOps"><span class="hs-identifier hs-type">FileOps</span></a></span><span>
</span><span id="line-328"></span><span>                          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">withoutInputEcho :: forall (m :: * -&gt; *) a. (MonadIO m, MonadMask m) =&gt; m a -&gt; m a
</span><a href="System.Console.Haskeline.Term.html#withoutInputEcho"><span class="hs-identifier hs-var">withoutInputEcho</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; (Bool -&gt; IO ()) -&gt; Bool -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a b.
(MonadMask m, MonadIO m) =&gt;
IO a -&gt; (a -&gt; IO ()) -&gt; a -&gt; m b -&gt; m b
</span><a href="System.Console.Haskeline.Term.html#bracketSet"><span class="hs-identifier hs-var">bracketSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handle -&gt; IO Bool
</span><span class="hs-identifier hs-var">hGetEcho</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679097095"><span class="hs-identifier hs-var">h_in</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>                                                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handle -&gt; Bool -&gt; IO ()
</span><span class="hs-identifier hs-var">hSetEcho</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679097095"><span class="hs-identifier hs-var">h_in</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>                                                          </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-331"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wrapFileInput :: forall a. IO a -&gt; IO a
</span><a href="System.Console.Haskeline.Term.html#wrapFileInput"><span class="hs-identifier hs-var">wrapFileInput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExternalHandle -&gt; IO a -&gt; IO a
forall (m :: * -&gt; *) a.
(MonadIO m, MonadMask m) =&gt;
ExternalHandle -&gt; m a -&gt; m a
</span><a href="System.Console.Haskeline.Backend.Posix.Encoder.html#withCodingMode"><span class="hs-identifier hs-var">withCodingMode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handles -&gt; ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.html#hIn"><span class="hs-identifier hs-var">hIn</span></a></span><span> </span><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679097084"><span class="hs-identifier hs-var">hs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">getLocaleChar :: MaybeT IO Char
</span><a href="System.Console.Haskeline.Term.html#getLocaleChar"><span class="hs-identifier hs-var">getLocaleChar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Handle -&gt; IO Char) -&gt; Handle -&gt; MaybeT IO Char
forall a. (Handle -&gt; IO a) -&gt; Handle -&gt; MaybeT IO a
</span><a href="System.Console.Haskeline.Term.html#guardedEOF"><span class="hs-identifier hs-var">guardedEOF</span></a></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO Char
</span><span class="hs-identifier hs-var">hGetChar</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679097095"><span class="hs-identifier hs-var">h_in</span></a></span><span>
</span><span id="line-333"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">maybeReadNewline :: IO ()
</span><a href="System.Console.Haskeline.Term.html#maybeReadNewline"><span class="hs-identifier hs-var">maybeReadNewline</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><a href="System.Console.Haskeline.Term.html#hMaybeReadNewline"><span class="hs-identifier hs-var">hMaybeReadNewline</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679097095"><span class="hs-identifier hs-var">h_in</span></a></span><span>
</span><span id="line-334"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">getLocaleLine :: MaybeT IO String
</span><a href="System.Console.Haskeline.Term.html#getLocaleLine"><span class="hs-identifier hs-var">getLocaleLine</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Handle -&gt; IO String) -&gt; Handle -&gt; MaybeT IO String
forall a. (Handle -&gt; IO a) -&gt; Handle -&gt; MaybeT IO a
</span><a href="System.Console.Haskeline.Term.html#guardedEOF"><span class="hs-identifier hs-var">guardedEOF</span></a></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO String
</span><span class="hs-identifier hs-var">hGetLine</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679097095"><span class="hs-identifier hs-var">h_in</span></a></span><span>
</span><span id="line-335"></span><span>                          </span><span class="hs-special">}</span><span>
</span><span id="line-336"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span class="hs-comment">-- NOTE: If we set stdout to NoBuffering, there can be a flicker effect when many</span><span>
</span><span id="line-339"></span><span class="hs-comment">-- characters are printed at once.  We'll keep it buffered here, and let the Draw</span><span>
</span><span id="line-340"></span><span class="hs-comment">-- monad manually flush outputs that don't print a newline.</span><span>
</span><span id="line-341"></span><span id="local-6989586621679096518"><span id="local-6989586621679096519"><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#wrapTerminalOps"><span class="hs-identifier hs-type">wrapTerminalOps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679096518"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679096518"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="System.Console.Haskeline.Backend.Posix.html#Handles"><span class="hs-identifier hs-type">Handles</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679096518"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096519"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679096518"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679096519"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-342"></span><span id="wrapTerminalOps"><span class="annot"><span class="annottext">wrapTerminalOps :: forall (m :: * -&gt; *) a.
(MonadIO m, MonadMask m) =&gt;
Handles -&gt; m a -&gt; m a
</span><a href="System.Console.Haskeline.Backend.Posix.html#wrapTerminalOps"><span class="hs-identifier hs-var hs-var">wrapTerminalOps</span></a></span></span><span> </span><span id="local-6989586621679097126"><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679097126"><span class="hs-identifier hs-var">hs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-343"></span><span>    </span><span class="annot"><span class="annottext">IO BufferMode -&gt; (BufferMode -&gt; IO ()) -&gt; BufferMode -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a b.
(MonadMask m, MonadIO m) =&gt;
IO a -&gt; (a -&gt; IO ()) -&gt; a -&gt; m b -&gt; m b
</span><a href="System.Console.Haskeline.Term.html#bracketSet"><span class="hs-identifier hs-var">bracketSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handle -&gt; IO BufferMode
</span><span class="hs-identifier hs-var">hGetBuffering</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679097128"><span class="hs-identifier hs-var">h_in</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handle -&gt; BufferMode -&gt; IO ()
</span><span class="hs-identifier hs-var">hSetBuffering</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679097128"><span class="hs-identifier hs-var">h_in</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BufferMode
</span><span class="hs-identifier hs-var">NoBuffering</span></span><span>
</span><span id="line-344"></span><span>    </span><span class="hs-comment">-- TODO: block buffering?  Certain \r and \n's are causing flicker...</span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-comment">-- - moving to the right</span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-comment">-- - breaking line after offset widechar?</span><span>
</span><span id="line-347"></span><span>    </span><span class="annot"><span class="annottext">(m a -&gt; m a) -&gt; (m a -&gt; m a) -&gt; m a -&gt; m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO BufferMode -&gt; (BufferMode -&gt; IO ()) -&gt; BufferMode -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a b.
(MonadMask m, MonadIO m) =&gt;
IO a -&gt; (a -&gt; IO ()) -&gt; a -&gt; m b -&gt; m b
</span><a href="System.Console.Haskeline.Term.html#bracketSet"><span class="hs-identifier hs-var">bracketSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handle -&gt; IO BufferMode
</span><span class="hs-identifier hs-var">hGetBuffering</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679097131"><span class="hs-identifier hs-var">h_out</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handle -&gt; BufferMode -&gt; IO ()
</span><span class="hs-identifier hs-var">hSetBuffering</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679097131"><span class="hs-identifier hs-var">h_out</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BufferMode
</span><span class="hs-identifier hs-var">LineBuffering</span></span><span>
</span><span id="line-348"></span><span>    </span><span class="annot"><span class="annottext">(m a -&gt; m a) -&gt; (m a -&gt; m a) -&gt; m a -&gt; m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; (Bool -&gt; IO ()) -&gt; Bool -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a b.
(MonadMask m, MonadIO m) =&gt;
IO a -&gt; (a -&gt; IO ()) -&gt; a -&gt; m b -&gt; m b
</span><a href="System.Console.Haskeline.Term.html#bracketSet"><span class="hs-identifier hs-var">bracketSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handle -&gt; IO Bool
</span><span class="hs-identifier hs-var">hGetEcho</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679097128"><span class="hs-identifier hs-var">h_in</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handle -&gt; Bool -&gt; IO ()
</span><span class="hs-identifier hs-var">hSetEcho</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679097128"><span class="hs-identifier hs-var">h_in</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-349"></span><span>    </span><span class="annot"><span class="annottext">(m a -&gt; m a) -&gt; (m a -&gt; m a) -&gt; m a -&gt; m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ExternalHandle -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
(MonadIO m, MonadMask m) =&gt;
ExternalHandle -&gt; m a -&gt; m a
</span><a href="System.Console.Haskeline.Backend.Posix.Encoder.html#withCodingMode"><span class="hs-identifier hs-var">withCodingMode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handles -&gt; ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.html#hIn"><span class="hs-identifier hs-var">hIn</span></a></span><span> </span><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679097126"><span class="hs-identifier hs-var">hs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>    </span><span class="annot"><span class="annottext">(m a -&gt; m a) -&gt; (m a -&gt; m a) -&gt; m a -&gt; m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ExternalHandle -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
(MonadIO m, MonadMask m) =&gt;
ExternalHandle -&gt; m a -&gt; m a
</span><a href="System.Console.Haskeline.Backend.Posix.Encoder.html#withCodingMode"><span class="hs-identifier hs-var">withCodingMode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handles -&gt; ExternalHandle
</span><a href="System.Console.Haskeline.Backend.Posix.html#hOut"><span class="hs-identifier hs-var">hOut</span></a></span><span> </span><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679097126"><span class="hs-identifier hs-var">hs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-352"></span><span>    </span><span id="local-6989586621679097128"><span class="annot"><span class="annottext">h_in :: Handle
</span><a href="#local-6989586621679097128"><span class="hs-identifier hs-var hs-var">h_in</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handles -&gt; Handle
</span><a href="System.Console.Haskeline.Backend.Posix.html#ehIn"><span class="hs-identifier hs-var">ehIn</span></a></span><span> </span><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679097126"><span class="hs-identifier hs-var">hs</span></a></span><span>
</span><span id="line-353"></span><span>    </span><span id="local-6989586621679097131"><span class="annot"><span class="annottext">h_out :: Handle
</span><a href="#local-6989586621679097131"><span class="hs-identifier hs-var hs-var">h_out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handles -&gt; Handle
</span><a href="System.Console.Haskeline.Backend.Posix.html#ehOut"><span class="hs-identifier hs-var">ehOut</span></a></span><span> </span><span class="annot"><span class="annottext">Handles
</span><a href="#local-6989586621679097126"><span class="hs-identifier hs-var">hs</span></a></span><span>
</span><span id="line-354"></span></pre></body></html>