<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Foreign.ForeignPtr.Safe.Compat</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">base-compat-0.13.1: A compatibility layer for base</span><ul class="links" id="page-menu"><li><a href="src/Foreign.ForeignPtr.Safe.Compat.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Trustworthy</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Foreign.ForeignPtr.Safe.Compat</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Finalised data pointers</a><ul><li><a href="#g:2">Basic operations</a></li><li><a href="#g:3">Low-level operations</a></li><li><a href="#g:4">Allocating managed memory</a></li></ul></li></ul></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:ForeignPtr">ForeignPtr</a> a</li><li class="src short"><span class="keyword">type</span> <a href="#t:FinalizerPtr">FinalizerPtr</a> a = <a href="../base-4.18.2.1/Foreign-Ptr.html#t:FunPtr" title="Foreign.Ptr">FunPtr</a> (<a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> ())</li><li class="src short"><span class="keyword">type</span> <a href="#t:FinalizerEnvPtr">FinalizerEnvPtr</a> env a = <a href="../base-4.18.2.1/Foreign-Ptr.html#t:FunPtr" title="Foreign.Ptr">FunPtr</a> (<a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> env -&gt; <a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> ())</li><li class="src short"><a href="#v:newForeignPtr">newForeignPtr</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:FinalizerPtr" title="Foreign.ForeignPtr.Safe.Compat">FinalizerPtr</a> a -&gt; <a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a)</li><li class="src short"><a href="#v:newForeignPtr_">newForeignPtr_</a> :: <a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a)</li><li class="src short"><a href="#v:addForeignPtrFinalizer">addForeignPtrFinalizer</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:FinalizerPtr" title="Foreign.ForeignPtr.Safe.Compat">FinalizerPtr</a> a -&gt; <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:newForeignPtrEnv">newForeignPtrEnv</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:FinalizerEnvPtr" title="Foreign.ForeignPtr.Safe.Compat">FinalizerEnvPtr</a> env a -&gt; <a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> env -&gt; <a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a)</li><li class="src short"><a href="#v:addForeignPtrFinalizerEnv">addForeignPtrFinalizerEnv</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:FinalizerEnvPtr" title="Foreign.ForeignPtr.Safe.Compat">FinalizerEnvPtr</a> env a -&gt; <a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> env -&gt; <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:withForeignPtr">withForeignPtr</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; (<a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> b) -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> b</li><li class="src short"><a href="#v:finalizeForeignPtr">finalizeForeignPtr</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:touchForeignPtr">touchForeignPtr</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:castForeignPtr">castForeignPtr</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> b</li><li class="src short"><a href="#v:mallocForeignPtr">mallocForeignPtr</a> :: <a href="../base-4.18.2.1/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a)</li><li class="src short"><a href="#v:mallocForeignPtrBytes">mallocForeignPtrBytes</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a)</li><li class="src short"><a href="#v:mallocForeignPtrArray">mallocForeignPtrArray</a> :: <a href="../base-4.18.2.1/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a)</li><li class="src short"><a href="#v:mallocForeignPtrArray0">mallocForeignPtrArray0</a> :: <a href="../base-4.18.2.1/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a)</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Finalised data pointers</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:ForeignPtr" class="def">ForeignPtr</a> a <a href="#t:ForeignPtr" class="selflink">#</a></p><div class="doc"><p>The type <code><a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a></code> represents references to objects that are
 maintained in a foreign language, i.e., that are not part of the
 data structures usually managed by the Haskell storage manager.
 The essential difference between <code><a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a></code>s and vanilla memory
 references of type <code>Ptr a</code> is that the former may be associated
 with <em>finalizers</em>. A finalizer is a routine that is invoked when
 the Haskell storage manager detects that - within the Haskell heap
 and stack - there are no more references left that are pointing to
 the <code><a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a></code>.  Typically, the finalizer will, then, invoke
 routines in the foreign language that free the resources bound by
 the foreign object.</p><p>The <code><a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a></code> is parameterised in the same way as <code><a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a></code>.  The
 type argument of <code><a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a></code> should normally be an instance of
 class <code><a href="../base-4.18.2.1/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a></code>.</p></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:ForeignPtr">Instances</h4><details id="i:ForeignPtr" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ForeignPtr:Show:1"></span> <a href="../base-4.18.2.1/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a)</span></td><td class="doc"><p><em>Since: base-2.1</em></p></td></tr><tr><td colspan="2"><details id="i:id:ForeignPtr:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="../base-4.18.2.1/GHC-ForeignPtr.html">GHC.ForeignPtr</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="../base-4.18.2.1/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="Data-String-Compat.html#t:String" title="Data.String.Compat">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a] -&gt; <a href="../base-4.18.2.1/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ForeignPtr:Eq:2"></span> <a href="../base-4.18.2.1/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a)</span></td><td class="doc"><p><em>Since: base-2.1</em></p></td></tr><tr><td colspan="2"><details id="i:id:ForeignPtr:Eq:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="../base-4.18.2.1/GHC-ForeignPtr.html">GHC.ForeignPtr</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ForeignPtr:Ord:3"></span> <a href="../base-4.18.2.1/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> (<a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a)</span></td><td class="doc"><p><em>Since: base-2.1</em></p></td></tr><tr><td colspan="2"><details id="i:id:ForeignPtr:Ord:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="../base-4.18.2.1/GHC-ForeignPtr.html">GHC.ForeignPtr</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:compare">compare</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="../base-4.18.2.1/Data-Ord.html#t:Ordering" title="Data.Ord">Ordering</a> <a href="#v:compare" class="selflink">#</a></p><p class="src"><a href="#v:-60-">(&lt;)</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-60-" class="selflink">#</a></p><p class="src"><a href="#v:-60--61-">(&lt;=)</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-60--61-" class="selflink">#</a></p><p class="src"><a href="#v:-62-">(&gt;)</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-62-" class="selflink">#</a></p><p class="src"><a href="#v:-62--61-">(&gt;=)</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="../base-4.18.2.1/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-62--61-" class="selflink">#</a></p><p class="src"><a href="#v:max">max</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a <a href="#v:max" class="selflink">#</a></p><p class="src"><a href="#v:min">min</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a <a href="#v:min" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:FinalizerPtr" class="def">FinalizerPtr</a> a = <a href="../base-4.18.2.1/Foreign-Ptr.html#t:FunPtr" title="Foreign.Ptr">FunPtr</a> (<a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> ()) <a href="#t:FinalizerPtr" class="selflink">#</a></p><div class="doc"><p>A finalizer is represented as a pointer to a foreign function that, at
 finalisation time, gets as an argument a plain pointer variant of the
 foreign pointer that the finalizer is associated with.</p><p>Note that the foreign function <em>must</em> use the <code>ccall</code> calling convention.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:FinalizerEnvPtr" class="def">FinalizerEnvPtr</a> env a = <a href="../base-4.18.2.1/Foreign-Ptr.html#t:FunPtr" title="Foreign.Ptr">FunPtr</a> (<a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> env -&gt; <a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> ()) <a href="#t:FinalizerEnvPtr" class="selflink">#</a></p></div><a href="#g:2" id="g:2"><h2>Basic operations</h2></a><div class="top"><p class="src"><a id="v:newForeignPtr" class="def">newForeignPtr</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:FinalizerPtr" title="Foreign.ForeignPtr.Safe.Compat">FinalizerPtr</a> a -&gt; <a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a) <a href="#v:newForeignPtr" class="selflink">#</a></p><div class="doc"><p>Turns a plain memory reference into a foreign pointer, and
 associates a finalizer with the reference.  The finalizer will be
 executed after the last reference to the foreign object is dropped.
 There is no guarantee of promptness, however the finalizer will be
 executed before the program exits.</p></div></div><div class="top"><p class="src"><a id="v:newForeignPtr_" class="def">newForeignPtr_</a> :: <a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a) <a href="#v:newForeignPtr_" class="selflink">#</a></p><div class="doc"><p>Turns a plain memory reference into a foreign pointer that may be
 associated with finalizers by using <code><a href="Foreign-ForeignPtr-Safe-Compat.html#v:addForeignPtrFinalizer" title="Foreign.ForeignPtr.Safe.Compat">addForeignPtrFinalizer</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:addForeignPtrFinalizer" class="def">addForeignPtrFinalizer</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:FinalizerPtr" title="Foreign.ForeignPtr.Safe.Compat">FinalizerPtr</a> a -&gt; <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="#v:addForeignPtrFinalizer" class="selflink">#</a></p><div class="doc"><p>This function adds a finalizer to the given foreign object.  The
 finalizer will run <em>before</em> all other finalizers for the same
 object which have already been registered.</p></div></div><div class="top"><p class="src"><a id="v:newForeignPtrEnv" class="def">newForeignPtrEnv</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:FinalizerEnvPtr" title="Foreign.ForeignPtr.Safe.Compat">FinalizerEnvPtr</a> env a -&gt; <a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> env -&gt; <a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a) <a href="#v:newForeignPtrEnv" class="selflink">#</a></p><div class="doc"><p>This variant of <code><a href="Foreign-ForeignPtr-Safe-Compat.html#v:newForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">newForeignPtr</a></code> adds a finalizer that expects an
 environment in addition to the finalized pointer.  The environment
 that will be passed to the finalizer is fixed by the second argument to
 <code><a href="Foreign-ForeignPtr-Safe-Compat.html#v:newForeignPtrEnv" title="Foreign.ForeignPtr.Safe.Compat">newForeignPtrEnv</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:addForeignPtrFinalizerEnv" class="def">addForeignPtrFinalizerEnv</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:FinalizerEnvPtr" title="Foreign.ForeignPtr.Safe.Compat">FinalizerEnvPtr</a> env a -&gt; <a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> env -&gt; <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="#v:addForeignPtrFinalizerEnv" class="selflink">#</a></p><div class="doc"><p>Like <code><a href="Foreign-ForeignPtr-Safe-Compat.html#v:addForeignPtrFinalizer" title="Foreign.ForeignPtr.Safe.Compat">addForeignPtrFinalizer</a></code> but the finalizer is passed an additional
 environment parameter.</p></div></div><div class="top"><p class="src"><a id="v:withForeignPtr" class="def">withForeignPtr</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; (<a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> b) -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> b <a href="#v:withForeignPtr" class="selflink">#</a></p><div class="doc"><p>This is a way to look at the pointer living inside a
 foreign object.  This function takes a function which is
 applied to that pointer. The resulting <code><a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a></code> action is then
 executed. The foreign object is kept alive at least during
 the whole action, even if it is not used directly
 inside. Note that it is not safe to return the pointer from
 the action and use it after the action completes. All uses
 of the pointer should be inside the
 <code><a href="Foreign-ForeignPtr-Safe-Compat.html#v:withForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">withForeignPtr</a></code> bracket.  The reason for
 this unsafeness is the same as for
 <code><a href="Foreign-ForeignPtr-Unsafe-Compat.html#v:unsafeForeignPtrToPtr" title="Foreign.ForeignPtr.Unsafe.Compat">unsafeForeignPtrToPtr</a></code> below: the finalizer
 may run earlier than expected, because the compiler can only
 track usage of the <code><a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a></code> object, not
 a <code><a href="../base-4.18.2.1/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a></code> object made from it.</p><p>This function is normally used for marshalling data to
 or from the object pointed to by the
 <code><a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a></code>, using the operations from the
 <code><a href="../base-4.18.2.1/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a></code> class.</p></div></div><div class="top"><p class="src"><a id="v:finalizeForeignPtr" class="def">finalizeForeignPtr</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="#v:finalizeForeignPtr" class="selflink">#</a></p><div class="doc"><p>Causes the finalizers associated with a foreign pointer to be run
 immediately. The foreign pointer must not be used again after this
 function is called. If the foreign pointer does not support finalizers,
 this is a no-op.</p></div></div><a href="#g:3" id="g:3"><h2>Low-level operations</h2></a><div class="top"><p class="src"><a id="v:touchForeignPtr" class="def">touchForeignPtr</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="#v:touchForeignPtr" class="selflink">#</a></p><div class="doc"><p>This function ensures that the foreign object in
 question is alive at the given place in the sequence of IO
 actions. However, this comes with a significant caveat: the contract above
 does not hold if GHC can demonstrate that the code preceding
 <code>touchForeignPtr</code> diverges (e.g. by looping infinitely or throwing an
 exception). For this reason, you are strongly advised to use instead
 <code><a href="Foreign-ForeignPtr-Safe-Compat.html#v:withForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">withForeignPtr</a></code> where possible.</p><p>Also, note that this function should not be used to express dependencies
 between finalizers on <code><a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a></code>s.  For example, if the finalizer for a
 <code><a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a></code> <code>F1</code> calls <code><a href="Foreign-ForeignPtr-Safe-Compat.html#v:touchForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">touchForeignPtr</a></code> on a second <code><a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a></code> <code>F2</code>,
 then the only guarantee is that the finalizer for <code>F2</code> is never started
 before the finalizer for <code>F1</code>.  They might be started together if for
 example both <code>F1</code> and <code>F2</code> are otherwise unreachable, and in that case the
 scheduler might end up running the finalizer for <code>F2</code> first.</p><p>In general, it is not recommended to use finalizers on separate
 objects with ordering constraints between them.  To express the
 ordering robustly requires explicit synchronisation using <code>MVar</code>s
 between the finalizers, but even then the runtime sometimes runs
 multiple finalizers sequentially in a single thread (for
 performance reasons), so synchronisation between finalizers could
 result in artificial deadlock.  Another alternative is to use
 explicit reference counting.</p></div></div><div class="top"><p class="src"><a id="v:castForeignPtr" class="def">castForeignPtr</a> :: <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a -&gt; <a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> b <a href="#v:castForeignPtr" class="selflink">#</a></p><div class="doc"><p>This function casts a <code><a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a></code>
 parameterised by one type into another type.</p></div></div><a href="#g:4" id="g:4"><h2>Allocating managed memory</h2></a><div class="top"><p class="src"><a id="v:mallocForeignPtr" class="def">mallocForeignPtr</a> :: <a href="../base-4.18.2.1/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a) <a href="#v:mallocForeignPtr" class="selflink">#</a></p><div class="doc"><p>Allocate some memory and return a <code><a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a></code> to it.  The memory
 will be released automatically when the <code><a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a></code> is discarded.</p><p><code><a href="Foreign-ForeignPtr-Safe-Compat.html#v:mallocForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">mallocForeignPtr</a></code> is equivalent to</p><pre>   do { p &lt;- malloc; newForeignPtr finalizerFree p }</pre><p>although it may be implemented differently internally: you may not
 assume that the memory returned by <code><a href="Foreign-ForeignPtr-Safe-Compat.html#v:mallocForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">mallocForeignPtr</a></code> has been
 allocated with <code><a href="../base-4.18.2.1/Foreign-Marshal-Alloc.html#v:malloc" title="Foreign.Marshal.Alloc">malloc</a></code>.</p><p>GHC notes: <code><a href="Foreign-ForeignPtr-Safe-Compat.html#v:mallocForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">mallocForeignPtr</a></code> has a heavily optimised
 implementation in GHC.  It uses pinned memory in the garbage
 collected heap, so the <code><a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a></code> does not require a finalizer to
 free the memory.  Use of <code><a href="Foreign-ForeignPtr-Safe-Compat.html#v:mallocForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">mallocForeignPtr</a></code> and associated
 functions is strongly recommended in preference to
 <code><a href="../base-4.18.2.1/Foreign-ForeignPtr.html#v:newForeignPtr" title="Foreign.ForeignPtr">newForeignPtr</a></code> with a finalizer.</p></div></div><div class="top"><p class="src"><a id="v:mallocForeignPtrBytes" class="def">mallocForeignPtrBytes</a> :: <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a) <a href="#v:mallocForeignPtrBytes" class="selflink">#</a></p><div class="doc"><p>This function is similar to <code><a href="Foreign-ForeignPtr-Safe-Compat.html#v:mallocForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">mallocForeignPtr</a></code>, except that the
 size of the memory required is given explicitly as a number of bytes.</p></div></div><div class="top"><p class="src"><a id="v:mallocForeignPtrArray" class="def">mallocForeignPtrArray</a> :: <a href="../base-4.18.2.1/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a) <a href="#v:mallocForeignPtrArray" class="selflink">#</a></p><div class="doc"><p>This function is similar to <code><a href="../base-4.18.2.1/Foreign-Marshal-Array.html#v:mallocArray" title="Foreign.Marshal.Array">mallocArray</a></code>,
 but yields a memory area that has a finalizer attached that releases
 the memory area.  As with <code><a href="Foreign-ForeignPtr-Safe-Compat.html#v:mallocForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">mallocForeignPtr</a></code>, it is not guaranteed that
 the block of memory was allocated by <code><a href="../base-4.18.2.1/Foreign-Marshal-Alloc.html#v:malloc" title="Foreign.Marshal.Alloc">malloc</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:mallocForeignPtrArray0" class="def">mallocForeignPtrArray0</a> :: <a href="../base-4.18.2.1/Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="../base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.2.1/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Foreign-ForeignPtr-Safe-Compat.html#t:ForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">ForeignPtr</a> a) <a href="#v:mallocForeignPtrArray0" class="selflink">#</a></p><div class="doc"><p>This function is similar to <code><a href="../base-4.18.2.1/Foreign-Marshal-Array.html#v:mallocArray0" title="Foreign.Marshal.Array">mallocArray0</a></code>,
 but yields a memory area that has a finalizer attached that releases
 the memory area.  As with <code><a href="Foreign-ForeignPtr-Safe-Compat.html#v:mallocForeignPtr" title="Foreign.ForeignPtr.Safe.Compat">mallocForeignPtr</a></code>, it is not guaranteed that
 the block of memory was allocated by <code><a href="../base-4.18.2.1/Foreign-Marshal-Alloc.html#v:malloc" title="Foreign.Marshal.Alloc">malloc</a></code>.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>