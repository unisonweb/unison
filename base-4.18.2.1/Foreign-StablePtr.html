<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Foreign.StablePtr</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">base-4.18.2.1: Core data structures and operations</span><ul class="links" id="page-menu"><li><a href="src/Foreign.StablePtr.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(c) The University of Glasgow 2001</td></tr><tr><th>License</th><td>BSD-style (see the file libraries/base/LICENSE)</td></tr><tr><th>Maintainer</th><td>ffi@haskell.org</td></tr><tr><th>Stability</th><td>provisional</td></tr><tr><th>Portability</th><td>portable</td></tr><tr><th>Safe Haskell</th><td>Trustworthy</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Foreign.StablePtr</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Stable references to Haskell values</a><ul><li><a href="#g:2">The C-side interface</a></li></ul></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module is part of the Foreign Function Interface (FFI) and will usually
 be imported via the module <a href="Foreign.html">Foreign</a>.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:StablePtr">StablePtr</a> a</li><li class="src short"><a href="#v:newStablePtr">newStablePtr</a> :: a -&gt; <a href="System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a)</li><li class="src short"><a href="#v:deRefStablePtr">deRefStablePtr</a> :: <a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a -&gt; <a href="System-IO.html#t:IO" title="System.IO">IO</a> a</li><li class="src short"><a href="#v:freeStablePtr">freeStablePtr</a> :: <a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a -&gt; <a href="System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:castStablePtrToPtr">castStablePtrToPtr</a> :: <a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a -&gt; <a href="Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> ()</li><li class="src short"><a href="#v:castPtrToStablePtr">castPtrToStablePtr</a> :: <a href="Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> () -&gt; <a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Stable references to Haskell values</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:StablePtr" class="def">StablePtr</a> a <a href="src/GHC.Stable.html#StablePtr" class="link">Source</a> <a href="#t:StablePtr" class="selflink">#</a></p><div class="doc"><p>A <em>stable pointer</em> is a reference to a Haskell expression that is
guaranteed not to be affected by garbage collection, i.e., it will neither be
deallocated nor will the value of the stable pointer itself change during
garbage collection (ordinary references may be relocated during garbage
collection).  Consequently, stable pointers can be passed to foreign code,
which can treat it as an opaque reference to a Haskell value.</p><p>The <code>StablePtr</code> 0 is reserved for representing NULL in foreign code.</p><p>A value of type <code>StablePtr a</code> is a stable pointer to a Haskell
expression of type <code>a</code>.</p></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:StablePtr">Instances</h4><details id="i:StablePtr" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:StablePtr:Storable:1"></span> <a href="Foreign-Storable.html#t:Storable" title="Foreign.Storable">Storable</a> (<a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a)</span> <a href="src/Foreign.Storable.html#line-198" class="link">Source</a> <a href="#t:Storable" class="selflink">#</a></td><td class="doc"><p><em>Since: base-2.1</em></p></td></tr><tr><td colspan="2"><details id="i:id:StablePtr:Storable:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Foreign-Storable.html">Foreign.Storable</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:sizeOf">sizeOf</a> :: <a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a -&gt; <a href="Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="src/Foreign.Storable.html#sizeOf" class="link">Source</a> <a href="#v:sizeOf" class="selflink">#</a></p><p class="src"><a href="#v:alignment">alignment</a> :: <a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a -&gt; <a href="Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="src/Foreign.Storable.html#alignment" class="link">Source</a> <a href="#v:alignment" class="selflink">#</a></p><p class="src"><a href="#v:peekElemOff">peekElemOff</a> :: <a href="Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> (<a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a) -&gt; <a href="Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a) <a href="src/Foreign.Storable.html#peekElemOff" class="link">Source</a> <a href="#v:peekElemOff" class="selflink">#</a></p><p class="src"><a href="#v:pokeElemOff">pokeElemOff</a> :: <a href="Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> (<a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a) -&gt; <a href="Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a -&gt; <a href="System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Foreign.Storable.html#pokeElemOff" class="link">Source</a> <a href="#v:pokeElemOff" class="selflink">#</a></p><p class="src"><a href="#v:peekByteOff">peekByteOff</a> :: <a href="Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> b -&gt; <a href="Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a) <a href="src/Foreign.Storable.html#peekByteOff" class="link">Source</a> <a href="#v:peekByteOff" class="selflink">#</a></p><p class="src"><a href="#v:pokeByteOff">pokeByteOff</a> :: <a href="Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> b -&gt; <a href="Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a -&gt; <a href="System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Foreign.Storable.html#pokeByteOff" class="link">Source</a> <a href="#v:pokeByteOff" class="selflink">#</a></p><p class="src"><a href="#v:peek">peek</a> :: <a href="Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> (<a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a) -&gt; <a href="System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a) <a href="src/Foreign.Storable.html#peek" class="link">Source</a> <a href="#v:peek" class="selflink">#</a></p><p class="src"><a href="#v:poke">poke</a> :: <a href="Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> (<a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a) -&gt; <a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a -&gt; <a href="System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Foreign.Storable.html#poke" class="link">Source</a> <a href="#v:poke" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:StablePtr:Eq:2"></span> <a href="Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a)</span> <a href="src/GHC.Stable.html#line-109" class="link">Source</a> <a href="#t:StablePtr" class="selflink">#</a></td><td class="doc"><p><em>Since: base-2.1</em></p></td></tr><tr><td colspan="2"><details id="i:id:StablePtr:Eq:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="GHC-Stable.html">GHC.Stable</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a -&gt; <a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a -&gt; <a href="Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="../ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D" class="link">Source</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a -&gt; <a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a -&gt; <a href="Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="../ghc-prim-0.10.0/src/GHC.Classes.html#%2F%3D" class="link">Source</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:newStablePtr" class="def">newStablePtr</a> :: a -&gt; <a href="System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a) <a href="src/GHC.Stable.html#newStablePtr" class="link">Source</a> <a href="#v:newStablePtr" class="selflink">#</a></p><div class="doc"><p>Create a stable pointer referring to the given Haskell value.</p></div></div><div class="top"><p class="src"><a id="v:deRefStablePtr" class="def">deRefStablePtr</a> :: <a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a -&gt; <a href="System-IO.html#t:IO" title="System.IO">IO</a> a <a href="src/GHC.Stable.html#deRefStablePtr" class="link">Source</a> <a href="#v:deRefStablePtr" class="selflink">#</a></p><div class="doc"><p>Obtain the Haskell value referenced by a stable pointer, i.e., the
 same value that was passed to the corresponding call to
 <code><a href="Foreign-StablePtr.html#v:newStablePtr" title="Foreign.StablePtr">newStablePtr</a></code>.  If the argument to <code><a href="Foreign-StablePtr.html#v:deRefStablePtr" title="Foreign.StablePtr">deRefStablePtr</a></code> has
 already been freed using <code><a href="Foreign-StablePtr.html#v:freeStablePtr" title="Foreign.StablePtr">freeStablePtr</a></code>, the behaviour of
 <code><a href="Foreign-StablePtr.html#v:deRefStablePtr" title="Foreign.StablePtr">deRefStablePtr</a></code> is undefined.</p></div></div><div class="top"><p class="src"><a id="v:freeStablePtr" class="def">freeStablePtr</a> :: <a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a -&gt; <a href="System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/GHC.Stable.html#freeStablePtr" class="link">Source</a> <a href="#v:freeStablePtr" class="selflink">#</a></p><div class="doc"><p>Dissolve the association between the stable pointer and the Haskell
 value. Afterwards, if the stable pointer is passed to
 <code><a href="Foreign-StablePtr.html#v:deRefStablePtr" title="Foreign.StablePtr">deRefStablePtr</a></code> or <code><a href="Foreign-StablePtr.html#v:freeStablePtr" title="Foreign.StablePtr">freeStablePtr</a></code>, the behaviour is
 undefined.  However, the stable pointer may still be passed to
 <code><a href="Foreign-StablePtr.html#v:castStablePtrToPtr" title="Foreign.StablePtr">castStablePtrToPtr</a></code>, but the <code><code><a href="Foreign-Ptr.html#v:Ptr" title="Foreign.Ptr">Ptr</a></code> ()</code> value returned
 by <code><a href="Foreign-StablePtr.html#v:castStablePtrToPtr" title="Foreign.StablePtr">castStablePtrToPtr</a></code>, in this case, is undefined (in particular,
 it may be <code><a href="Foreign-Ptr.html#v:nullPtr" title="Foreign.Ptr">nullPtr</a></code>).  Nevertheless, the call
 to <code><a href="Foreign-StablePtr.html#v:castStablePtrToPtr" title="Foreign.StablePtr">castStablePtrToPtr</a></code> is guaranteed not to diverge.</p></div></div><div class="top"><p class="src"><a id="v:castStablePtrToPtr" class="def">castStablePtrToPtr</a> :: <a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a -&gt; <a href="Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> () <a href="src/GHC.Stable.html#castStablePtrToPtr" class="link">Source</a> <a href="#v:castStablePtrToPtr" class="selflink">#</a></p><div class="doc"><p>Coerce a stable pointer to an address. No guarantees are made about
 the resulting value, except that the original stable pointer can be
 recovered by <code><a href="Foreign-StablePtr.html#v:castPtrToStablePtr" title="Foreign.StablePtr">castPtrToStablePtr</a></code>.  In particular, the address might not
 refer to an accessible memory location and any attempt to pass it to
 the member functions of the class <code><a href="Foreign-Storable.html#v:Storable" title="Foreign.Storable">Storable</a></code> leads to
 undefined behaviour.</p></div></div><div class="top"><p class="src"><a id="v:castPtrToStablePtr" class="def">castPtrToStablePtr</a> :: <a href="Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> () -&gt; <a href="Foreign-StablePtr.html#t:StablePtr" title="Foreign.StablePtr">StablePtr</a> a <a href="src/GHC.Stable.html#castPtrToStablePtr" class="link">Source</a> <a href="#v:castPtrToStablePtr" class="selflink">#</a></p><div class="doc"><p>The inverse of <code><a href="Foreign-StablePtr.html#v:castStablePtrToPtr" title="Foreign.StablePtr">castStablePtrToPtr</a></code>, i.e., we have the identity</p><pre>sp == castPtrToStablePtr (castStablePtrToPtr sp)</pre><p>for any stable pointer <code>sp</code> on which <code><a href="Foreign-StablePtr.html#v:freeStablePtr" title="Foreign.StablePtr">freeStablePtr</a></code> has
 not been executed yet.  Moreover, <code><a href="Foreign-StablePtr.html#v:castPtrToStablePtr" title="Foreign.StablePtr">castPtrToStablePtr</a></code> may
 only be applied to pointers that have been produced by
 <code><a href="Foreign-StablePtr.html#v:castStablePtrToPtr" title="Foreign.StablePtr">castStablePtrToPtr</a></code>.</p></div></div><a href="#g:2" id="g:2"><h2>The C-side interface</h2></a><div class="doc"><p>The following definition is available to C programs inter-operating with
 Haskell code when including the header <code>HsFFI.h</code>.</p><pre>typedef void *HsStablePtr;  /* C representation of a StablePtr */</pre><p>Note that no assumptions may be made about the values representing stable
 pointers.  In fact, they need not even be valid memory addresses.  The only
 guarantee provided is that if they are passed back to Haskell land, the
 function <code><a href="Foreign-StablePtr.html#v:deRefStablePtr" title="Foreign.StablePtr">deRefStablePtr</a></code> will be able to reconstruct the
 Haskell value referred to by the stable pointer.</p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>