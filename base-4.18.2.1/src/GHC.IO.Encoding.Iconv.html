<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE Trustworthy #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE CPP
           , NoImplicitPrelude
           , NondecreasingIndentation
  #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# OPTIONS_HADDOCK not-home #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Module      :  GHC.IO.Encoding.Iconv</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- Copyright   :  (c) The University of Glasgow, 2008-2009</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- License     :  see libraries/base/LICENSE</span><span>
</span><span id="line-13"></span><span class="hs-comment">--</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- Maintainer  :  libraries@haskell.org</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- Stability   :  internal</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- Portability :  non-portable</span><span>
</span><span id="line-17"></span><span class="hs-comment">--</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- This module provides text encoding/decoding using iconv</span><span>
</span><span id="line-19"></span><span class="hs-comment">--</span><span>
</span><span id="line-20"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.IO.Encoding.Iconv</span><span> </span><span class="hs-special">(</span><span class="hs-cpp">
#if !defined(mingw32_HOST_OS)
</span><span>   </span><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#iconvEncoding"><span class="hs-identifier">iconvEncoding</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#mkIconvEncoding"><span class="hs-identifier">mkIconvEncoding</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>   </span><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#localeEncodingName"><span class="hs-identifier">localeEncodingName</span></a></span><span class="hs-cpp">
#endif
</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">

#include &quot;MachDeps.h&quot;
</span><span class="hs-cpp">#include &quot;HsBaseConfig.h&quot;
</span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Base</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- For build ordering</span><span class="hs-cpp">
#else
</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Foreign.html"><span class="hs-identifier">Foreign</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Foreign.C.html"><span class="hs-identifier">Foreign.C</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Foreign.C.String.html#charIsRepresentable"><span class="hs-identifier">charIsRepresentable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Base.html"><span class="hs-identifier">GHC.Base</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Foreign.html"><span class="hs-identifier">GHC.Foreign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Foreign.html#charIsRepresentable"><span class="hs-identifier">charIsRepresentable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.IO.Buffer.html"><span class="hs-identifier">GHC.IO.Buffer</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.IO.Encoding.Failure.html"><span class="hs-identifier">GHC.IO.Encoding.Failure</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.IO.Encoding.Types.html"><span class="hs-identifier">GHC.IO.Encoding.Types</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.List.html"><span class="hs-identifier">GHC.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.List.html#span"><span class="hs-identifier">span</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Num.html"><span class="hs-identifier">GHC.Num</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Show.html"><span class="hs-identifier">GHC.Show</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Real.html"><span class="hs-identifier">GHC.Real</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="System.IO.Unsafe.html"><span class="hs-identifier">System.IO.Unsafe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.IO.Unsafe.html#unsafePerformIO"><span class="hs-identifier">unsafePerformIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="System.Posix.Internals.html"><span class="hs-identifier">System.Posix.Internals</span></a></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#c_DEBUG_DUMP"><span class="hs-identifier hs-type">c_DEBUG_DUMP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#Bool/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-52"></span><span id="c_DEBUG_DUMP"><span class="annot"><span class="annottext">c_DEBUG_DUMP :: Bool
</span><a href="GHC.IO.Encoding.Iconv.html#c_DEBUG_DUMP"><span class="hs-identifier hs-var hs-var">c_DEBUG_DUMP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#False/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#iconv_trace"><span class="hs-identifier hs-type">iconv_trace</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#IO/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span id="iconv_trace"><span class="annot"><span class="annottext">iconv_trace :: String -&gt; IO ()
</span><a href="GHC.IO.Encoding.Iconv.html#iconv_trace"><span class="hs-identifier hs-var hs-var">iconv_trace</span></a></span></span><span> </span><span id="local-6989586621679666155"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679666155"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-56"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.IO.Encoding.Iconv.html#c_DEBUG_DUMP"><span class="hs-identifier hs-var">c_DEBUG_DUMP</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="System.Posix.Internals.html#puts"><span class="hs-identifier hs-var">puts</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679666155"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-57"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-60"></span><span class="hs-comment">-- iconv encoders/decoders</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#localeEncodingName"><span class="hs-pragma hs-type">localeEncodingName</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-63"></span><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#localeEncodingName"><span class="hs-identifier hs-type">localeEncodingName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-64"></span><span id="localeEncodingName"><span class="annot"><span class="annottext">localeEncodingName :: String
</span><a href="GHC.IO.Encoding.Iconv.html#localeEncodingName"><span class="hs-identifier hs-var hs-var">localeEncodingName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO String -&gt; String
forall a. IO a -&gt; a
</span><a href="GHC.IO.Unsafe.html#unsafePerformIO"><span class="hs-identifier hs-var">unsafePerformIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO String -&gt; String) -&gt; IO String -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-65"></span><span>   </span><span class="hs-comment">-- Use locale_charset() or nl_langinfo(CODESET) to get the encoding</span><span>
</span><span id="line-66"></span><span>   </span><span class="hs-comment">-- if we have either of them.</span><span>
</span><span id="line-67"></span><span>   </span><span id="local-6989586621679666157"><span class="annot"><span class="annottext">CString
</span><a href="#local-6989586621679666157"><span class="hs-identifier hs-var">cstr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO CString
</span><a href="GHC.IO.Encoding.Iconv.html#c_localeEncoding"><span class="hs-identifier hs-var">c_localeEncoding</span></a></span><span>
</span><span id="line-68"></span><span>   </span><span class="annot"><span class="annottext">CString -&gt; IO String
</span><a href="Foreign.C.String.html#peekCAString"><span class="hs-identifier hs-var">peekCAString</span></a></span><span> </span><span class="annot"><span class="annottext">CString
</span><a href="#local-6989586621679666157"><span class="hs-identifier hs-var">cstr</span></a></span><span> </span><span class="hs-comment">-- Assume charset names are ASCII</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">-- We hope iconv_t is a storable type.  It should be, since it has at least the</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- value -1, which is a possible return value from iconv_open.</span><span>
</span><span id="line-72"></span><span class="hs-keyword">type</span><span> </span><span id="IConv"><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#IConv"><span class="hs-identifier hs-var">IConv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Foreign.C.Types.html#CLong"><span class="hs-identifier hs-type">CLong</span></a></span><span> </span><span class="hs-comment">-- ToDo: (#type iconv_t)</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">unsafe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;hs_iconv_open&quot;</span></span><span>
</span><span id="line-75"></span><span>    </span><span id="hs_iconv_open"><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#hs_iconv_open"><span class="hs-identifier hs-var">hs_iconv_open</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Foreign.html#CString"><span class="hs-identifier hs-type">CString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Foreign.html#CString"><span class="hs-identifier hs-type">CString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#IO/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#IConv"><span class="hs-identifier hs-type">IConv</span></a></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">unsafe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;hs_iconv_close&quot;</span></span><span>
</span><span id="line-78"></span><span>    </span><span id="hs_iconv_close"><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#hs_iconv_close"><span class="hs-identifier hs-var">hs_iconv_close</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#IConv"><span class="hs-identifier hs-type">IConv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#IO/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Foreign.C.Types.html#CInt"><span class="hs-identifier hs-type">CInt</span></a></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">unsafe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;hs_iconv&quot;</span></span><span>
</span><span id="line-81"></span><span>    </span><span id="hs_iconv"><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#hs_iconv"><span class="hs-identifier hs-var">hs_iconv</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#IConv"><span class="hs-identifier hs-type">IConv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span class="annot"><a href="GHC.Foreign.html#CString"><span class="hs-identifier hs-type">CString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span class="annot"><a href="Foreign.C.Types.html#CSize"><span class="hs-identifier hs-type">CSize</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span class="annot"><a href="GHC.Foreign.html#CString"><span class="hs-identifier hs-type">CString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span class="annot"><a href="Foreign.C.Types.html#CSize"><span class="hs-identifier hs-type">CSize</span></a></span><span>
</span><span id="line-82"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#IO/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Foreign.C.Types.html#CSize"><span class="hs-identifier hs-type">CSize</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">unsafe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;localeEncoding&quot;</span></span><span>
</span><span id="line-85"></span><span>    </span><span id="c_localeEncoding"><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#c_localeEncoding"><span class="hs-identifier hs-var">c_localeEncoding</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#IO/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="GHC.Foreign.html#CString"><span class="hs-identifier hs-type">CString</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#haskellChar"><span class="hs-identifier hs-type">haskellChar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-cpp">
#if defined(WORDS_BIGENDIAN)
</span><span class="hs-identifier">haskellChar</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">charSize</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;UTF-16BE&quot;</span><span>
</span><span id="line-90"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;UTF-32BE&quot;</span><span class="hs-cpp">
#else
</span><span id="haskellChar"><span class="annot"><span class="annottext">haskellChar :: String
</span><a href="GHC.IO.Encoding.Iconv.html#haskellChar"><span class="hs-identifier hs-var hs-var">haskellChar</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.IO.Buffer.html#charSize"><span class="hs-identifier hs-var">charSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UTF-16LE&quot;</span></span><span>
</span><span id="line-93"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UTF-32LE&quot;</span></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-96"></span><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#char_shift"><span class="hs-identifier hs-type">char_shift</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#Int/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-97"></span><span id="char_shift"><span class="annot"><span class="annottext">char_shift :: Int
</span><a href="GHC.IO.Encoding.Iconv.html#char_shift"><span class="hs-identifier hs-var hs-var">char_shift</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.IO.Buffer.html#charSize"><span class="hs-identifier hs-var">charSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-98"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#iconvEncoding"><span class="hs-identifier hs-type">iconvEncoding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#IO/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.IO.Encoding.Types.html#TextEncoding"><span class="hs-identifier hs-type">TextEncoding</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span id="iconvEncoding"><span class="annot"><span class="annottext">iconvEncoding :: String -&gt; IO (Maybe TextEncoding)
</span><a href="GHC.IO.Encoding.Iconv.html#iconvEncoding"><span class="hs-identifier hs-var hs-var">iconvEncoding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CodingFailureMode -&gt; String -&gt; IO (Maybe TextEncoding)
</span><a href="GHC.IO.Encoding.Iconv.html#mkIconvEncoding"><span class="hs-identifier hs-var">mkIconvEncoding</span></a></span><span> </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="GHC.IO.Encoding.Failure.html#ErrorOnCodingFailure"><span class="hs-identifier hs-var">ErrorOnCodingFailure</span></a></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-comment">-- | Construct an iconv-based 'TextEncoding' for the given character set and</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- 'CodingFailureMode'.</span><span>
</span><span id="line-105"></span><span class="hs-comment">--</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- As iconv is missing in some minimal environments (e.g. #10298), this</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- checks to ensure that iconv is working properly before returning the</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- encoding, returning 'Nothing' if not.</span><span>
</span><span id="line-109"></span><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#mkIconvEncoding"><span class="hs-identifier hs-type">mkIconvEncoding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.IO.Encoding.Failure.html#CodingFailureMode"><span class="hs-identifier hs-type">CodingFailureMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#IO/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.IO.Encoding.Types.html#TextEncoding"><span class="hs-identifier hs-type">TextEncoding</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span id="mkIconvEncoding"><span class="annot"><span class="annottext">mkIconvEncoding :: CodingFailureMode -&gt; String -&gt; IO (Maybe TextEncoding)
</span><a href="GHC.IO.Encoding.Iconv.html#mkIconvEncoding"><span class="hs-identifier hs-var hs-var">mkIconvEncoding</span></a></span></span><span> </span><span id="local-6989586621679666169"><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="#local-6989586621679666169"><span class="hs-identifier hs-var">cfm</span></a></span></span><span> </span><span id="local-6989586621679666170"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679666170"><span class="hs-identifier hs-var">charset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679666171"><span class="annot"><span class="annottext">enc :: TextEncoding
</span><a href="#local-6989586621679666171"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.IO.Encoding.Types.html#TextEncoding"><span class="hs-identifier hs-type">TextEncoding</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-112"></span><span>                  </span><span class="annot"><span class="annottext">textEncodingName :: String
</span><a href="GHC.IO.Encoding.Types.html#textEncodingName"><span class="hs-identifier hs-var">textEncodingName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679666170"><span class="hs-identifier hs-var">charset</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-113"></span><span>                  </span><span class="annot"><span class="annottext">mkTextDecoder :: IO (TextDecoder ())
</span><a href="GHC.IO.Encoding.Types.html#mkTextDecoder"><span class="hs-identifier hs-var">mkTextDecoder</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; String
-&gt; (Buffer Word8
    -&gt; Buffer CharBufElem -&gt; IO (Buffer Word8, Buffer CharBufElem))
-&gt; (IConv
    -&gt; Buffer Word8
    -&gt; Buffer CharBufElem
    -&gt; IO (CodingProgress, Buffer Word8, Buffer CharBufElem))
-&gt; IO (TextDecoder ())
forall a b.
String
-&gt; String
-&gt; (Buffer a -&gt; Buffer b -&gt; IO (Buffer a, Buffer b))
-&gt; (IConv
    -&gt; Buffer a -&gt; Buffer b -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; IO (BufferCodec a b ())
</span><a href="GHC.IO.Encoding.Iconv.html#newIConv"><span class="hs-identifier hs-var">newIConv</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679666175"><span class="hs-identifier hs-var">raw_charset</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="GHC.IO.Encoding.Iconv.html#haskellChar"><span class="hs-identifier hs-var">haskellChar</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679666176"><span class="hs-identifier hs-var">suffix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>                                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodingFailureMode
-&gt; Buffer Word8
-&gt; Buffer CharBufElem
-&gt; IO (Buffer Word8, Buffer CharBufElem)
</span><a href="GHC.IO.Encoding.Failure.html#recoverDecode"><span class="hs-identifier hs-var">recoverDecode</span></a></span><span> </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="#local-6989586621679666169"><span class="hs-identifier hs-var">cfm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IConv
-&gt; Buffer Word8
-&gt; Buffer CharBufElem
-&gt; IO (CodingProgress, Buffer Word8, Buffer CharBufElem)
</span><a href="GHC.IO.Encoding.Iconv.html#iconvDecode"><span class="hs-identifier hs-var">iconvDecode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-115"></span><span>                  </span><span class="annot"><span class="annottext">mkTextEncoder :: IO (TextEncoder ())
</span><a href="GHC.IO.Encoding.Types.html#mkTextEncoder"><span class="hs-identifier hs-var">mkTextEncoder</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; String
-&gt; (Buffer CharBufElem
    -&gt; Buffer Word8 -&gt; IO (Buffer CharBufElem, Buffer Word8))
-&gt; (IConv
    -&gt; Buffer CharBufElem
    -&gt; Buffer Word8
    -&gt; IO (CodingProgress, Buffer CharBufElem, Buffer Word8))
-&gt; IO (TextEncoder ())
forall a b.
String
-&gt; String
-&gt; (Buffer a -&gt; Buffer b -&gt; IO (Buffer a, Buffer b))
-&gt; (IConv
    -&gt; Buffer a -&gt; Buffer b -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; IO (BufferCodec a b ())
</span><a href="GHC.IO.Encoding.Iconv.html#newIConv"><span class="hs-identifier hs-var">newIConv</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="GHC.IO.Encoding.Iconv.html#haskellChar"><span class="hs-identifier hs-var">haskellChar</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679666170"><span class="hs-identifier hs-var">charset</span></a></span><span>
</span><span id="line-116"></span><span>                                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodingFailureMode
-&gt; Buffer CharBufElem
-&gt; Buffer Word8
-&gt; IO (Buffer CharBufElem, Buffer Word8)
</span><a href="GHC.IO.Encoding.Failure.html#recoverEncode"><span class="hs-identifier hs-var">recoverEncode</span></a></span><span> </span><span class="annot"><span class="annottext">CodingFailureMode
</span><a href="#local-6989586621679666169"><span class="hs-identifier hs-var">cfm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IConv
-&gt; Buffer CharBufElem
-&gt; Buffer Word8
-&gt; IO (CodingProgress, Buffer CharBufElem, Buffer Word8)
</span><a href="GHC.IO.Encoding.Iconv.html#iconvEncode"><span class="hs-identifier hs-var">iconvEncode</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-117"></span><span>    </span><span id="local-6989586621679666182"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679666182"><span class="hs-identifier hs-var">good</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TextEncoding -&gt; CharBufElem -&gt; IO Bool
</span><a href="GHC.Foreign.html#charIsRepresentable"><span class="hs-identifier hs-var">charIsRepresentable</span></a></span><span> </span><span class="annot"><span class="annottext">TextEncoding
</span><a href="#local-6989586621679666171"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="annot"><span class="annottext">CharBufElem
</span><span class="hs-char">'a'</span></span><span>
</span><span id="line-118"></span><span>    </span><span class="annot"><span class="annottext">Maybe TextEncoding -&gt; IO (Maybe TextEncoding)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe TextEncoding -&gt; IO (Maybe TextEncoding))
-&gt; Maybe TextEncoding -&gt; IO (Maybe TextEncoding)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679666182"><span class="hs-identifier hs-var">good</span></a></span><span>
</span><span id="line-119"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TextEncoding -&gt; Maybe TextEncoding
forall a. a -&gt; Maybe a
</span><a href="GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TextEncoding
</span><a href="#local-6989586621679666171"><span class="hs-identifier hs-var">enc</span></a></span><span>
</span><span id="line-120"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe TextEncoding
forall a. Maybe a
</span><a href="GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-comment">-- An annoying feature of GNU iconv is that the //PREFIXES only take</span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-comment">-- effect when they appear on the tocode parameter to iconv_open:</span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679666175"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679666175"><span class="hs-identifier hs-var">raw_charset</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679666176"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679666176"><span class="hs-identifier hs-var">suffix</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CharBufElem -&gt; Bool) -&gt; String -&gt; (String, String)
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="GHC.List.html#span"><span class="hs-identifier hs-var">span</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CharBufElem -&gt; CharBufElem -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%2F%3D/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">CharBufElem
</span><span class="hs-char">'/'</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679666170"><span class="hs-identifier hs-var">charset</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span id="local-6989586621679666092"><span id="local-6989586621679666093"><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#newIConv"><span class="hs-identifier hs-type">newIConv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-127"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.IO.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679666092"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.IO.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679666093"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#IO/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.IO.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679666092"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.IO.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679666093"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#IConv"><span class="hs-identifier hs-type">IConv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.IO.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679666092"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.IO.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679666093"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#IO/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.IO.Encoding.Types.html#CodingProgress"><span class="hs-identifier hs-type">CodingProgress</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.IO.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679666092"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.IO.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679666093"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#IO/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.IO.Encoding.Types.html#BufferCodec"><span class="hs-identifier hs-type">BufferCodec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679666092"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679666093"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-130"></span><span id="newIConv"><span class="annot"><span class="annottext">newIConv :: forall a b.
String
-&gt; String
-&gt; (Buffer a -&gt; Buffer b -&gt; IO (Buffer a, Buffer b))
-&gt; (IConv
    -&gt; Buffer a -&gt; Buffer b -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; IO (BufferCodec a b ())
</span><a href="GHC.IO.Encoding.Iconv.html#newIConv"><span class="hs-identifier hs-var hs-var">newIConv</span></a></span></span><span> </span><span id="local-6989586621679666194"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679666194"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span id="local-6989586621679666195"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679666195"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span id="local-6989586621679666196"><span class="annot"><span class="annottext">Buffer a -&gt; Buffer b -&gt; IO (Buffer a, Buffer b)
</span><a href="#local-6989586621679666196"><span class="hs-identifier hs-var">rec</span></a></span></span><span> </span><span id="local-6989586621679666197"><span class="annot"><span class="annottext">IConv
-&gt; Buffer a -&gt; Buffer b -&gt; IO (CodingProgress, Buffer a, Buffer b)
</span><a href="#local-6989586621679666197"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-comment">-- Assume charset names are ASCII</span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><span class="annottext">String
-&gt; (CString -&gt; IO (BufferCodec a b ())) -&gt; IO (BufferCodec a b ())
forall a. String -&gt; (CString -&gt; IO a) -&gt; IO a
</span><a href="Foreign.C.String.html#withCAString"><span class="hs-identifier hs-var">withCAString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679666194"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">((CString -&gt; IO (BufferCodec a b ())) -&gt; IO (BufferCodec a b ()))
-&gt; (CString -&gt; IO (BufferCodec a b ())) -&gt; IO (BufferCodec a b ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679666199"><span class="annot"><span class="annottext">CString
</span><a href="#local-6989586621679666199"><span class="hs-identifier hs-var">from_str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><span class="annottext">String
-&gt; (CString -&gt; IO (BufferCodec a b ())) -&gt; IO (BufferCodec a b ())
forall a. String -&gt; (CString -&gt; IO a) -&gt; IO a
</span><a href="Foreign.C.String.html#withCAString"><span class="hs-identifier hs-var">withCAString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679666195"><span class="hs-identifier hs-var">to</span></a></span><span>   </span><span class="annot"><span class="annottext">((CString -&gt; IO (BufferCodec a b ())) -&gt; IO (BufferCodec a b ()))
-&gt; (CString -&gt; IO (BufferCodec a b ())) -&gt; IO (BufferCodec a b ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679666200"><span class="annot"><span class="annottext">CString
</span><a href="#local-6989586621679666200"><span class="hs-identifier hs-var">to_str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621679666201"><span class="annot"><span class="annottext">IConv
</span><a href="#local-6989586621679666201"><span class="hs-identifier hs-var">iconvt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO IConv -&gt; IO IConv
forall a. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO a
</span><a href="Foreign.C.Error.html#throwErrnoIfMinus1"><span class="hs-identifier hs-var">throwErrnoIfMinus1</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkTextEncoding&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO IConv -&gt; IO IConv) -&gt; IO IConv -&gt; IO IConv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CString -&gt; CString -&gt; IO IConv
</span><a href="GHC.IO.Encoding.Iconv.html#hs_iconv_open"><span class="hs-identifier hs-var">hs_iconv_open</span></a></span><span> </span><span class="annot"><span class="annottext">CString
</span><a href="#local-6989586621679666200"><span class="hs-identifier hs-var">to_str</span></a></span><span> </span><span class="annot"><span class="annottext">CString
</span><a href="#local-6989586621679666199"><span class="hs-identifier hs-var">from_str</span></a></span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679666207"><span class="annot"><span class="annottext">iclose :: IO ()
</span><a href="#local-6989586621679666207"><span class="hs-identifier hs-var hs-var">iclose</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO CInt -&gt; IO ()
forall a. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO ()
</span><a href="Foreign.C.Error.html#throwErrnoIfMinus1_"><span class="hs-identifier hs-var">throwErrnoIfMinus1_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Iconv.close&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO CInt -&gt; IO ()) -&gt; IO CInt -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IConv -&gt; IO CInt
</span><a href="GHC.IO.Encoding.Iconv.html#hs_iconv_close"><span class="hs-identifier hs-var">hs_iconv_close</span></a></span><span> </span><span class="annot"><span class="annottext">IConv
</span><a href="#local-6989586621679666201"><span class="hs-identifier hs-var">iconvt</span></a></span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><span class="annottext">BufferCodec a b () -&gt; IO (BufferCodec a b ())
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><a href="GHC.IO.Encoding.Types.html#BufferCodec"><span class="hs-identifier hs-type">BufferCodec</span></a></span><span class="hs-special">{</span><span>
</span><span id="line-137"></span><span>                </span><span class="annot"><span class="annottext">encode :: Buffer a -&gt; Buffer b -&gt; IO (CodingProgress, Buffer a, Buffer b)
</span><a href="GHC.IO.Encoding.Types.html#encode"><span class="hs-identifier hs-var">encode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IConv
-&gt; Buffer a -&gt; Buffer b -&gt; IO (CodingProgress, Buffer a, Buffer b)
</span><a href="#local-6989586621679666197"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">IConv
</span><a href="#local-6989586621679666201"><span class="hs-identifier hs-var">iconvt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-138"></span><span>                </span><span class="annot"><span class="annottext">recover :: Buffer a -&gt; Buffer b -&gt; IO (Buffer a, Buffer b)
</span><a href="GHC.IO.Encoding.Types.html#recover"><span class="hs-identifier hs-var">recover</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Buffer a -&gt; Buffer b -&gt; IO (Buffer a, Buffer b)
</span><a href="#local-6989586621679666196"><span class="hs-identifier hs-var">rec</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-139"></span><span>                </span><span class="annot"><span class="annottext">close :: IO ()
</span><a href="GHC.IO.Encoding.Types.html#close"><span class="hs-identifier hs-var">close</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679666207"><span class="hs-identifier hs-var">iclose</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-140"></span><span>                </span><span class="hs-comment">-- iconv doesn't supply a way to save/restore the state</span><span>
</span><span id="line-141"></span><span>                </span><span class="annot"><span class="annottext">getState :: IO ()
</span><a href="GHC.IO.Encoding.Types.html#getState"><span class="hs-identifier hs-var">getState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-142"></span><span>                </span><span class="annot"><span class="annottext">setState :: () -&gt; IO ()
</span><a href="GHC.IO.Encoding.Types.html#setState"><span class="hs-identifier hs-var">setState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; () -&gt; IO ()
forall a b. a -&gt; b -&gt; a
</span><a href="GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; () -&gt; IO ()) -&gt; IO () -&gt; () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#iconvDecode"><span class="hs-identifier hs-type">iconvDecode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#IConv"><span class="hs-identifier hs-type">IConv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.IO.Encoding.Types.html#DecodeBuffer"><span class="hs-identifier hs-type">DecodeBuffer</span></a></span><span>
</span><span id="line-146"></span><span id="iconvDecode"><span class="annot"><span class="annottext">iconvDecode :: IConv
-&gt; Buffer Word8
-&gt; Buffer CharBufElem
-&gt; IO (CodingProgress, Buffer Word8, Buffer CharBufElem)
</span><a href="GHC.IO.Encoding.Iconv.html#iconvDecode"><span class="hs-identifier hs-var hs-var">iconvDecode</span></a></span></span><span> </span><span id="local-6989586621679666217"><span class="annot"><span class="annottext">IConv
</span><a href="#local-6989586621679666217"><span class="hs-identifier hs-var">iconv_t</span></a></span></span><span> </span><span id="local-6989586621679666218"><span class="annot"><span class="annottext">Buffer Word8
</span><a href="#local-6989586621679666218"><span class="hs-identifier hs-var">ibuf</span></a></span></span><span> </span><span id="local-6989586621679666219"><span class="annot"><span class="annottext">Buffer CharBufElem
</span><a href="#local-6989586621679666219"><span class="hs-identifier hs-var">obuf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IConv
-&gt; Buffer Word8
-&gt; Int
-&gt; Buffer CharBufElem
-&gt; Int
-&gt; IO (CodingProgress, Buffer Word8, Buffer CharBufElem)
forall a b.
IConv
-&gt; Buffer a
-&gt; Int
-&gt; Buffer b
-&gt; Int
-&gt; IO (CodingProgress, Buffer a, Buffer b)
</span><a href="GHC.IO.Encoding.Iconv.html#iconvRecode"><span class="hs-identifier hs-var">iconvRecode</span></a></span><span> </span><span class="annot"><span class="annottext">IConv
</span><a href="#local-6989586621679666217"><span class="hs-identifier hs-var">iconv_t</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer Word8
</span><a href="#local-6989586621679666218"><span class="hs-identifier hs-var">ibuf</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Buffer CharBufElem
</span><a href="#local-6989586621679666219"><span class="hs-identifier hs-var">obuf</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.IO.Encoding.Iconv.html#char_shift"><span class="hs-identifier hs-var">char_shift</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#iconvEncode"><span class="hs-identifier hs-type">iconvEncode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#IConv"><span class="hs-identifier hs-type">IConv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.IO.Encoding.Types.html#EncodeBuffer"><span class="hs-identifier hs-type">EncodeBuffer</span></a></span><span>
</span><span id="line-149"></span><span id="iconvEncode"><span class="annot"><span class="annottext">iconvEncode :: IConv
-&gt; Buffer CharBufElem
-&gt; Buffer Word8
-&gt; IO (CodingProgress, Buffer CharBufElem, Buffer Word8)
</span><a href="GHC.IO.Encoding.Iconv.html#iconvEncode"><span class="hs-identifier hs-var hs-var">iconvEncode</span></a></span></span><span> </span><span id="local-6989586621679666222"><span class="annot"><span class="annottext">IConv
</span><a href="#local-6989586621679666222"><span class="hs-identifier hs-var">iconv_t</span></a></span></span><span> </span><span id="local-6989586621679666223"><span class="annot"><span class="annottext">Buffer CharBufElem
</span><a href="#local-6989586621679666223"><span class="hs-identifier hs-var">ibuf</span></a></span></span><span> </span><span id="local-6989586621679666224"><span class="annot"><span class="annottext">Buffer Word8
</span><a href="#local-6989586621679666224"><span class="hs-identifier hs-var">obuf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IConv
-&gt; Buffer CharBufElem
-&gt; Int
-&gt; Buffer Word8
-&gt; Int
-&gt; IO (CodingProgress, Buffer CharBufElem, Buffer Word8)
forall a b.
IConv
-&gt; Buffer a
-&gt; Int
-&gt; Buffer b
-&gt; Int
-&gt; IO (CodingProgress, Buffer a, Buffer b)
</span><a href="GHC.IO.Encoding.Iconv.html#iconvRecode"><span class="hs-identifier hs-var">iconvRecode</span></a></span><span> </span><span class="annot"><span class="annottext">IConv
</span><a href="#local-6989586621679666222"><span class="hs-identifier hs-var">iconv_t</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer CharBufElem
</span><a href="#local-6989586621679666223"><span class="hs-identifier hs-var">ibuf</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.IO.Encoding.Iconv.html#char_shift"><span class="hs-identifier hs-var">char_shift</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer Word8
</span><a href="#local-6989586621679666224"><span class="hs-identifier hs-var">obuf</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span id="local-6989586621679666106"><span id="local-6989586621679666107"><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#iconvRecode"><span class="hs-identifier hs-type">iconvRecode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.IO.Encoding.Iconv.html#IConv"><span class="hs-identifier hs-type">IConv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.IO.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679666106"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#Int/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.IO.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679666107"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#Int/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-152"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.10.0/src/GHC.Types.html#IO/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.IO.Encoding.Types.html#CodingProgress"><span class="hs-identifier hs-type">CodingProgress</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.IO.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679666106"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.IO.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679666107"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-153"></span><span id="iconvRecode"><span class="annot"><span class="annottext">iconvRecode :: forall a b.
IConv
-&gt; Buffer a
-&gt; Int
-&gt; Buffer b
-&gt; Int
-&gt; IO (CodingProgress, Buffer a, Buffer b)
</span><a href="GHC.IO.Encoding.Iconv.html#iconvRecode"><span class="hs-identifier hs-var hs-var">iconvRecode</span></a></span></span><span> </span><span id="local-6989586621679666283"><span class="annot"><span class="annottext">IConv
</span><a href="#local-6989586621679666283"><span class="hs-identifier hs-var">iconv_t</span></a></span></span><span>
</span><span id="line-154"></span><span>  </span><span id="local-6989586621679666284"><span class="annot"><span class="annottext">input :: Buffer a
</span><a href="#local-6989586621679666284"><span class="hs-identifier hs-var">input</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.IO.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span class="hs-special">{</span><span>  </span><span class="annot"><span class="annottext">bufRaw :: forall e. Buffer e -&gt; RawBuffer e
</span><a href="GHC.IO.Buffer.html#bufRaw"><span class="hs-identifier hs-var">bufRaw</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679666287"><span class="annot"><span class="annottext">RawBuffer a
</span><a href="#local-6989586621679666287"><span class="hs-identifier hs-var">iraw</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bufL :: forall e. Buffer e -&gt; Int
</span><a href="GHC.IO.Buffer.html#bufL"><span class="hs-identifier hs-var">bufL</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679666289"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679666289"><span class="hs-identifier hs-var">ir</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bufR :: forall e. Buffer e -&gt; Int
</span><a href="GHC.IO.Buffer.html#bufR"><span class="hs-identifier hs-var">bufR</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679666291"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679666291"><span class="hs-identifier hs-var">iw</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bufSize :: forall e. Buffer e -&gt; Int
</span><a href="GHC.IO.Buffer.html#bufSize"><span class="hs-identifier hs-var">bufSize</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-special">}</span><span>  </span><span id="local-6989586621679666293"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679666293"><span class="hs-identifier hs-var">iscale</span></a></span></span><span>
</span><span id="line-155"></span><span>  </span><span id="local-6989586621679666294"><span class="annot"><span class="annottext">output :: Buffer b
</span><a href="#local-6989586621679666294"><span class="hs-identifier hs-var">output</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.IO.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">bufRaw :: forall e. Buffer e -&gt; RawBuffer e
</span><a href="GHC.IO.Buffer.html#bufRaw"><span class="hs-identifier hs-var">bufRaw</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679666295"><span class="annot"><span class="annottext">RawBuffer b
</span><a href="#local-6989586621679666295"><span class="hs-identifier hs-var">oraw</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bufL :: forall e. Buffer e -&gt; Int
</span><a href="GHC.IO.Buffer.html#bufL"><span class="hs-identifier hs-var">bufL</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">bufR :: forall e. Buffer e -&gt; Int
</span><a href="GHC.IO.Buffer.html#bufR"><span class="hs-identifier hs-var">bufR</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679666296"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679666296"><span class="hs-identifier hs-var">ow</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bufSize :: forall e. Buffer e -&gt; Int
</span><a href="GHC.IO.Buffer.html#bufSize"><span class="hs-identifier hs-var">bufSize</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679666297"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679666297"><span class="hs-identifier hs-var">os</span></a></span></span><span> </span><span class="hs-special">}</span><span>  </span><span id="local-6989586621679666298"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679666298"><span class="hs-identifier hs-var">oscale</span></a></span></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="GHC.IO.Encoding.Iconv.html#iconv_trace"><span class="hs-identifier hs-var">iconv_trace</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;haskellChar=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="GHC.IO.Encoding.Iconv.html#haskellChar"><span class="hs-identifier hs-var">haskellChar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="GHC.IO.Encoding.Iconv.html#iconv_trace"><span class="hs-identifier hs-var">iconv_trace</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;iconvRecode before, input=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Buffer a -&gt; String
forall a. Buffer a -&gt; String
</span><a href="GHC.IO.Buffer.html#summaryBuffer"><span class="hs-identifier hs-var">summaryBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer a
</span><a href="#local-6989586621679666284"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="GHC.IO.Encoding.Iconv.html#iconv_trace"><span class="hs-identifier hs-var">iconv_trace</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;iconvRecode before, output=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Buffer b -&gt; String
forall a. Buffer a -&gt; String
</span><a href="GHC.IO.Buffer.html#summaryBuffer"><span class="hs-identifier hs-var">summaryBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer b
</span><a href="#local-6989586621679666294"><span class="hs-identifier hs-var">output</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><span class="annottext">RawBuffer a
-&gt; (Ptr a -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; IO (CodingProgress, Buffer a, Buffer b)
forall e a. RawBuffer e -&gt; (Ptr e -&gt; IO a) -&gt; IO a
</span><a href="GHC.IO.Buffer.html#withRawBuffer"><span class="hs-identifier hs-var">withRawBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">RawBuffer a
</span><a href="#local-6989586621679666287"><span class="hs-identifier hs-var">iraw</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr a -&gt; IO (CodingProgress, Buffer a, Buffer b))
 -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; (Ptr a -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; IO (CodingProgress, Buffer a, Buffer b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679666302"><span class="annot"><span class="annottext">Ptr a
</span><a href="#local-6989586621679666302"><span class="hs-identifier hs-var">piraw</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><span class="annottext">RawBuffer b
-&gt; (Ptr b -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; IO (CodingProgress, Buffer a, Buffer b)
forall e a. RawBuffer e -&gt; (Ptr e -&gt; IO a) -&gt; IO a
</span><a href="GHC.IO.Buffer.html#withRawBuffer"><span class="hs-identifier hs-var">withRawBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">RawBuffer b
</span><a href="#local-6989586621679666295"><span class="hs-identifier hs-var">oraw</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr b -&gt; IO (CodingProgress, Buffer a, Buffer b))
 -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; (Ptr b -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; IO (CodingProgress, Buffer a, Buffer b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679666303"><span class="annot"><span class="annottext">Ptr b
</span><a href="#local-6989586621679666303"><span class="hs-identifier hs-var">poraw</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><span class="annottext">CString
-&gt; (Ptr CString -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; IO (CodingProgress, Buffer a, Buffer b)
forall a b. Storable a =&gt; a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><a href="Foreign.Marshal.Utils.html#with"><span class="hs-identifier hs-var">with</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr a
</span><a href="#local-6989586621679666302"><span class="hs-identifier hs-var">piraw</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr a -&gt; Int -&gt; CString
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><a href="GHC.Ptr.html#plusPtr"><span class="hs-operator hs-var">`plusPtr`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679666289"><span class="hs-identifier hs-var">ir</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Bits.html#shiftL"><span class="hs-operator hs-var">`shiftL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679666293"><span class="hs-identifier hs-var">iscale</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Ptr CString -&gt; IO (CodingProgress, Buffer a, Buffer b))
 -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; (Ptr CString -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; IO (CodingProgress, Buffer a, Buffer b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679666307"><span class="annot"><span class="annottext">Ptr CString
</span><a href="#local-6989586621679666307"><span class="hs-identifier hs-var">p_inbuf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><span class="annottext">CString
-&gt; (Ptr CString -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; IO (CodingProgress, Buffer a, Buffer b)
forall a b. Storable a =&gt; a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><a href="Foreign.Marshal.Utils.html#with"><span class="hs-identifier hs-var">with</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr b
</span><a href="#local-6989586621679666303"><span class="hs-identifier hs-var">poraw</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr b -&gt; Int -&gt; CString
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><a href="GHC.Ptr.html#plusPtr"><span class="hs-operator hs-var">`plusPtr`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679666296"><span class="hs-identifier hs-var">ow</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Bits.html#shiftL"><span class="hs-operator hs-var">`shiftL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679666298"><span class="hs-identifier hs-var">oscale</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Ptr CString -&gt; IO (CodingProgress, Buffer a, Buffer b))
 -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; (Ptr CString -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; IO (CodingProgress, Buffer a, Buffer b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679666308"><span class="annot"><span class="annottext">Ptr CString
</span><a href="#local-6989586621679666308"><span class="hs-identifier hs-var">p_outbuf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><span class="annottext">CSize
-&gt; (Ptr CSize -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; IO (CodingProgress, Buffer a, Buffer b)
forall a b. Storable a =&gt; a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><a href="Foreign.Marshal.Utils.html#with"><span class="hs-identifier hs-var">with</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; CSize
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679666291"><span class="hs-identifier hs-var">iw</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679666289"><span class="hs-identifier hs-var">ir</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Bits.html#shiftL"><span class="hs-operator hs-var">`shiftL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679666293"><span class="hs-identifier hs-var">iscale</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Ptr CSize -&gt; IO (CodingProgress, Buffer a, Buffer b))
 -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; (Ptr CSize -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; IO (CodingProgress, Buffer a, Buffer b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679666309"><span class="annot"><span class="annottext">Ptr CSize
</span><a href="#local-6989586621679666309"><span class="hs-identifier hs-var">p_inleft</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><span class="annottext">CSize
-&gt; (Ptr CSize -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; IO (CodingProgress, Buffer a, Buffer b)
forall a b. Storable a =&gt; a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><a href="Foreign.Marshal.Utils.html#with"><span class="hs-identifier hs-var">with</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; CSize
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679666297"><span class="hs-identifier hs-var">os</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679666296"><span class="hs-identifier hs-var">ow</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Bits.html#shiftL"><span class="hs-operator hs-var">`shiftL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679666298"><span class="hs-identifier hs-var">oscale</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Ptr CSize -&gt; IO (CodingProgress, Buffer a, Buffer b))
 -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; (Ptr CSize -&gt; IO (CodingProgress, Buffer a, Buffer b))
-&gt; IO (CodingProgress, Buffer a, Buffer b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679666310"><span class="annot"><span class="annottext">Ptr CSize
</span><a href="#local-6989586621679666310"><span class="hs-identifier hs-var">p_outleft</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-166"></span><span>      </span><span id="local-6989586621679666311"><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679666311"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IConv
-&gt; Ptr CString -&gt; Ptr CSize -&gt; Ptr CString -&gt; Ptr CSize -&gt; IO CSize
</span><a href="GHC.IO.Encoding.Iconv.html#hs_iconv"><span class="hs-identifier hs-var">hs_iconv</span></a></span><span> </span><span class="annot"><span class="annottext">IConv
</span><a href="#local-6989586621679666283"><span class="hs-identifier hs-var">iconv_t</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CString
</span><a href="#local-6989586621679666307"><span class="hs-identifier hs-var">p_inbuf</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CSize
</span><a href="#local-6989586621679666309"><span class="hs-identifier hs-var">p_inleft</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CString
</span><a href="#local-6989586621679666308"><span class="hs-identifier hs-var">p_outbuf</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CSize
</span><a href="#local-6989586621679666310"><span class="hs-identifier hs-var">p_outleft</span></a></span><span>
</span><span id="line-167"></span><span>      </span><span id="local-6989586621679666312"><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679666312"><span class="hs-identifier hs-var">new_inleft</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr CSize -&gt; IO CSize
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><a href="Foreign.Storable.html#peek"><span class="hs-identifier hs-var">peek</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CSize
</span><a href="#local-6989586621679666309"><span class="hs-identifier hs-var">p_inleft</span></a></span><span>
</span><span id="line-168"></span><span>      </span><span id="local-6989586621679666314"><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679666314"><span class="hs-identifier hs-var">new_outleft</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr CSize -&gt; IO CSize
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><a href="Foreign.Storable.html#peek"><span class="hs-identifier hs-var">peek</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CSize
</span><a href="#local-6989586621679666310"><span class="hs-identifier hs-var">p_outleft</span></a></span><span>
</span><span id="line-169"></span><span>      </span><span class="hs-keyword">let</span><span>
</span><span id="line-170"></span><span>          </span><span id="local-6989586621679666320"><span class="annot"><span class="annottext">new_inleft' :: Int
</span><a href="#local-6989586621679666320"><span class="hs-identifier hs-var hs-var">new_inleft'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CSize -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679666312"><span class="hs-identifier hs-var">new_inleft</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Bits.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679666293"><span class="hs-identifier hs-var">iscale</span></a></span><span>
</span><span id="line-171"></span><span>          </span><span id="local-6989586621679666326"><span class="annot"><span class="annottext">new_outleft' :: Int
</span><a href="#local-6989586621679666326"><span class="hs-identifier hs-var hs-var">new_outleft'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CSize -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679666314"><span class="hs-identifier hs-var">new_outleft</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Bits.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679666298"><span class="hs-identifier hs-var">oscale</span></a></span><span>
</span><span id="line-172"></span><span>          </span><span id="local-6989586621679666330"><span class="annot"><span class="annottext">new_input :: Buffer a
</span><a href="#local-6989586621679666330"><span class="hs-identifier hs-var hs-var">new_input</span></a></span></span><span>
</span><span id="line-173"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679666312"><span class="hs-identifier hs-var">new_inleft</span></a></span><span> </span><span class="annot"><span class="annottext">CSize -&gt; CSize -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">CSize
</span><span class="hs-number">0</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Buffer a
</span><a href="#local-6989586621679666284"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.IO.Buffer.html#bufL"><span class="hs-identifier hs-var">bufL</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.IO.Buffer.html#bufR"><span class="hs-identifier hs-var">bufR</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-174"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Buffer a
</span><a href="#local-6989586621679666284"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.IO.Buffer.html#bufL"><span class="hs-identifier hs-var">bufL</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679666291"><span class="hs-identifier hs-type">iw</span></a></span><span> </span><span class="annot"><a href="GHC.Num.html#-"><span class="hs-glyph hs-type">-</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679666320"><span class="hs-identifier hs-type">new_inleft'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-175"></span><span>          </span><span id="local-6989586621679666332"><span class="annot"><span class="annottext">new_output :: Buffer b
</span><a href="#local-6989586621679666332"><span class="hs-identifier hs-var hs-var">new_output</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Buffer b
</span><a href="#local-6989586621679666294"><span class="hs-identifier hs-var">output</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.IO.Buffer.html#bufR"><span class="hs-identifier hs-var">bufR</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679666297"><span class="hs-identifier hs-type">os</span></a></span><span> </span><span class="annot"><a href="GHC.Num.html#-"><span class="hs-glyph hs-type">-</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679666326"><span class="hs-identifier hs-type">new_outleft'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-176"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="GHC.IO.Encoding.Iconv.html#iconv_trace"><span class="hs-identifier hs-var">iconv_trace</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;iconv res=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">CSize -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679666311"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="GHC.IO.Encoding.Iconv.html#iconv_trace"><span class="hs-identifier hs-var">iconv_trace</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;iconvRecode after,  input=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Buffer a -&gt; String
forall a. Buffer a -&gt; String
</span><a href="GHC.IO.Buffer.html#summaryBuffer"><span class="hs-identifier hs-var">summaryBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer a
</span><a href="#local-6989586621679666330"><span class="hs-identifier hs-var">new_input</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="GHC.IO.Encoding.Iconv.html#iconv_trace"><span class="hs-identifier hs-var">iconv_trace</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;iconvRecode after,  output=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Buffer b -&gt; String
forall a. Buffer a -&gt; String
</span><a href="GHC.IO.Buffer.html#summaryBuffer"><span class="hs-identifier hs-var">summaryBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer b
</span><a href="#local-6989586621679666332"><span class="hs-identifier hs-var">new_output</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679666311"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">CSize -&gt; CSize -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%2F%3D/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">CSize
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-comment">-- all input translated</span><span>
</span><span id="line-181"></span><span>           </span><span class="annot"><span class="annottext">(CodingProgress, Buffer a, Buffer b)
-&gt; IO (CodingProgress, Buffer a, Buffer b)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodingProgress
</span><a href="GHC.IO.Encoding.Types.html#InputUnderflow"><span class="hs-identifier hs-var">InputUnderflow</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Buffer a
</span><a href="#local-6989586621679666330"><span class="hs-identifier hs-var">new_input</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Buffer b
</span><a href="#local-6989586621679666332"><span class="hs-identifier hs-var">new_output</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-183"></span><span>      </span><span id="local-6989586621679666334"><span class="annot"><span class="annottext">Errno
</span><a href="#local-6989586621679666334"><span class="hs-identifier hs-var">errno</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Errno
</span><a href="Foreign.C.Error.html#getErrno"><span class="hs-identifier hs-var">getErrno</span></a></span><span>
</span><span id="line-184"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Errno
</span><a href="#local-6989586621679666334"><span class="hs-identifier hs-var">errno</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-185"></span><span>        </span><span id="local-6989586621679666336"><span class="annot"><span class="annottext">Errno
</span><a href="#local-6989586621679666336"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Errno
</span><a href="#local-6989586621679666336"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Errno -&gt; Errno -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Errno
</span><a href="Foreign.C.Error.html#e2BIG"><span class="hs-identifier hs-var">e2BIG</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(CodingProgress, Buffer a, Buffer b)
-&gt; IO (CodingProgress, Buffer a, Buffer b)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodingProgress
</span><a href="GHC.IO.Encoding.Types.html#OutputUnderflow"><span class="hs-identifier hs-var">OutputUnderflow</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Buffer a
</span><a href="#local-6989586621679666330"><span class="hs-identifier hs-var">new_input</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Buffer b
</span><a href="#local-6989586621679666332"><span class="hs-identifier hs-var">new_output</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Errno
</span><a href="#local-6989586621679666336"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Errno -&gt; Errno -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Errno
</span><a href="Foreign.C.Error.html#eINVAL"><span class="hs-identifier hs-var">eINVAL</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(CodingProgress, Buffer a, Buffer b)
-&gt; IO (CodingProgress, Buffer a, Buffer b)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodingProgress
</span><a href="GHC.IO.Encoding.Types.html#InputUnderflow"><span class="hs-identifier hs-var">InputUnderflow</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Buffer a
</span><a href="#local-6989586621679666330"><span class="hs-identifier hs-var">new_input</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Buffer b
</span><a href="#local-6989586621679666332"><span class="hs-identifier hs-var">new_output</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>           </span><span class="hs-comment">-- Sometimes iconv reports EILSEQ for a</span><span>
</span><span id="line-188"></span><span>           </span><span class="hs-comment">-- character in the input even when there is no room</span><span>
</span><span id="line-189"></span><span>           </span><span class="hs-comment">-- in the output; in this case we might be about to</span><span>
</span><span id="line-190"></span><span>           </span><span class="hs-comment">-- change the encoding anyway, so the following bytes</span><span>
</span><span id="line-191"></span><span>           </span><span class="hs-comment">-- could very well be in a different encoding.</span><span>
</span><span id="line-192"></span><span>           </span><span class="hs-comment">--</span><span>
</span><span id="line-193"></span><span>           </span><span class="hs-comment">-- Because we can only say InvalidSequence if there is at least</span><span>
</span><span id="line-194"></span><span>           </span><span class="hs-comment">-- one element left in the output, we have to special case this.</span><span>
</span><span id="line-195"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Errno
</span><a href="#local-6989586621679666336"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Errno -&gt; Errno -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Errno
</span><a href="Foreign.C.Error.html#eILSEQ"><span class="hs-identifier hs-var">eILSEQ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(CodingProgress, Buffer a, Buffer b)
-&gt; IO (CodingProgress, Buffer a, Buffer b)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679666326"><span class="hs-identifier hs-var">new_outleft'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">CodingProgress
</span><a href="GHC.IO.Encoding.Types.html#OutputUnderflow"><span class="hs-identifier hs-var">OutputUnderflow</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">CodingProgress
</span><a href="GHC.IO.Encoding.Types.html#InvalidSequence"><span class="hs-identifier hs-var">InvalidSequence</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Buffer a
</span><a href="#local-6989586621679666330"><span class="hs-identifier hs-var">new_input</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Buffer b
</span><a href="#local-6989586621679666332"><span class="hs-identifier hs-var">new_output</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-197"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="GHC.IO.Encoding.Iconv.html#iconv_trace"><span class="hs-identifier hs-var">iconv_trace</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;iconv returned error: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">IOError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Errno -&gt; Maybe Handle -&gt; Maybe String -&gt; IOError
</span><a href="Foreign.C.Error.html#errnoToIOError"><span class="hs-identifier hs-var">errnoToIOError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;iconv&quot;</span></span><span> </span><span class="annot"><span class="annottext">Errno
</span><a href="#local-6989586621679666336"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Handle
forall a. Maybe a
</span><a href="GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><a href="GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; IO (CodingProgress, Buffer a, Buffer b)
forall a. String -&gt; IO a
</span><a href="Foreign.C.Error.html#throwErrno"><span class="hs-identifier hs-var">throwErrno</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;iconvRecoder&quot;</span></span><span class="hs-cpp">

#endif /* !mingw32_HOST_OS */
</span><span>
</span><span id="line-202"></span></pre></body></html>