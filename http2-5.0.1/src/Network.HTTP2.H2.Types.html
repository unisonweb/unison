<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.HTTP2.H2.Types</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Builder</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Builder</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IORef</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Typeable</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Control</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Types</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">H</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Socket</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Stream</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Unsafe</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">System.TimeManager</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UnliftIO.Concurrent</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UnliftIO.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SomeException</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UnliftIO.STM</span></span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Imports.html"><span class="hs-identifier">Imports</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HPACK.html"><span class="hs-identifier">Network.HPACK</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.html"><span class="hs-identifier">Network.HTTP2.Frame</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.File.html"><span class="hs-identifier">Network.HTTP2.H2.File</span></a></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="annot"><span class="hs-comment">-- | &quot;http&quot; or &quot;https&quot;.</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">type</span><span> </span><span id="Scheme"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Scheme"><span class="hs-identifier hs-var">Scheme</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="annot"><span class="hs-comment">-- | Authority.</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">type</span><span> </span><span id="Authority"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Authority"><span class="hs-identifier hs-var">Authority</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="annot"><span class="hs-comment">-- | Path.</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">type</span><span> </span><span id="Path"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Path"><span class="hs-identifier hs-var">Path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-keyword">type</span><span> </span><span id="InpBody"><span class="annot"><a href="Network.HTTP2.H2.Types.html#InpBody"><span class="hs-identifier hs-var">InpBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">data</span><span> </span><span id="OutBody"><span class="annot"><a href="Network.HTTP2.H2.Types.html#OutBody"><span class="hs-identifier hs-var">OutBody</span></a></span></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="OutBodyNone"><span class="annot"><a href="Network.HTTP2.H2.Types.html#OutBodyNone"><span class="hs-identifier hs-var">OutBodyNone</span></a></span></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | Streaming body takes a write action and a flush action.</span></span><span>
</span><span id="line-43"></span><span>      </span><span id="OutBodyStreaming"><span class="annot"><a href="Network.HTTP2.H2.Types.html#OutBodyStreaming"><span class="hs-identifier hs-var">OutBodyStreaming</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Builder</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Like 'OutBodyStreaming', but with a callback to unmask expections</span><span>
</span><span id="line-45"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-46"></span><span>      </span><span class="hs-comment">-- This is used in the client: we spawn the new thread for the request body</span><span>
</span><span id="line-47"></span><span>      </span><span class="hs-comment">-- with exceptions masked, and provide the body of 'OutBodyStreamingUnmask'</span><span>
</span><span id="line-48"></span><span>      </span><span class="hs-comment">-- with a callback to unmask them again (typically after installing an exception</span><span>
</span><span id="line-49"></span><span>      </span><span class="hs-comment">-- handler).</span><span>
</span><span id="line-50"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-51"></span><span>      </span><span class="hs-comment">-- We do /NOT/ support this in the server, as here the scope of the thread</span><span>
</span><span id="line-52"></span><span>      </span><span class="hs-comment">-- that is spawned for the server is the entire handler, not just the response</span><span>
</span><span id="line-53"></span><span>      </span><span class="hs-comment">-- streaming body.</span><span>
</span><span id="line-54"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-55"></span><span>      </span><span class="hs-comment">-- TODO: The analogous change for the server-side would be to provide a similar</span><span>
</span><span id="line-56"></span><span>      </span><span class="hs-comment">-- @unmask@ callback as the first argument in the 'Server' type alias.</span><span>
</span><span id="line-57"></span><span>      </span><span id="OutBodyStreamingUnmask"><span class="annot"><a href="Network.HTTP2.H2.Types.html#OutBodyStreamingUnmask"><span class="hs-identifier hs-var">OutBodyStreamingUnmask</span></a></span></span><span>
</span><span id="line-58"></span><span>        </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679115930"><span class="annot"><a href="#local-6989586621679115930"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679115930"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679115930"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Builder</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="OutBodyBuilder"><span class="annot"><a href="Network.HTTP2.H2.Types.html#OutBodyBuilder"><span class="hs-identifier hs-var">OutBodyBuilder</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Builder</span></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="OutBodyFile"><span class="annot"><a href="Network.HTTP2.H2.Types.html#OutBodyFile"><span class="hs-identifier hs-var">OutBodyFile</span></a></span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#FileSpec"><span class="hs-identifier hs-type">FileSpec</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="annot"><span class="hs-comment">-- | Input object</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">data</span><span> </span><span id="InpObj"><span class="annot"><a href="Network.HTTP2.H2.Types.html#InpObj"><span class="hs-identifier hs-var">InpObj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="InpObj"><span class="annot"><a href="Network.HTTP2.H2.Types.html#InpObj"><span class="hs-identifier hs-var">InpObj</span></a></span></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="inpObjHeaders"><span class="annot"><span class="annottext">InpObj -&gt; HeaderTable
</span><a href="Network.HTTP2.H2.Types.html#inpObjHeaders"><span class="hs-identifier hs-var hs-var">inpObjHeaders</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HPACK.HeaderBlock.Decode.html#HeaderTable"><span class="hs-identifier hs-type">HeaderTable</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Accessor for headers.</span></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="inpObjBodySize"><span class="annot"><span class="annottext">InpObj -&gt; Maybe SettingsValue
</span><a href="Network.HTTP2.H2.Types.html#inpObjBodySize"><span class="hs-identifier hs-var hs-var">inpObjBodySize</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Accessor for body length specified in content-length:.</span></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="inpObjBody"><span class="annot"><span class="annottext">InpObj -&gt; InpBody
</span><a href="Network.HTTP2.H2.Types.html#inpObjBody"><span class="hs-identifier hs-var hs-var">inpObjBody</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#InpBody"><span class="hs-identifier hs-type">InpBody</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Accessor for body.</span></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="inpObjTrailers"><span class="annot"><span class="annottext">InpObj -&gt; IORef (Maybe HeaderTable)
</span><a href="Network.HTTP2.H2.Types.html#inpObjTrailers"><span class="hs-identifier hs-var hs-var">inpObjTrailers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.HPACK.HeaderBlock.Decode.html#HeaderTable"><span class="hs-identifier hs-type">HeaderTable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Accessor for trailers.</span></span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679115939"><span id="local-6989586621679115944"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#InpObj"><span class="hs-identifier hs-type">InpObj</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-75"></span><span>    </span><span id="local-6989586621679115955"><span class="annot"><span class="annottext">show :: InpObj -&gt; String
</span><a href="#local-6989586621679115955"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.H2.Types.html#InpObj"><span class="hs-identifier hs-type">InpObj</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115957"><span class="annot"><span class="annottext">TokenHeaderList
</span><a href="#local-6989586621679115957"><span class="hs-identifier hs-var">thl</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ValueTable
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe SettingsValue
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679115958"><span class="annot"><span class="annottext">InpBody
</span><a href="#local-6989586621679115958"><span class="hs-identifier hs-var">_body</span></a></span></span><span> </span><span id="local-6989586621679115959"><span class="annot"><span class="annottext">IORef (Maybe HeaderTable)
</span><a href="#local-6989586621679115959"><span class="hs-identifier hs-var">_tref</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenHeaderList -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TokenHeaderList
</span><a href="#local-6989586621679115957"><span class="hs-identifier hs-var">thl</span></a></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="annot"><span class="hs-comment">-- | Output object</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">data</span><span> </span><span id="OutObj"><span class="annot"><a href="Network.HTTP2.H2.Types.html#OutObj"><span class="hs-identifier hs-var">OutObj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="OutObj"><span class="annot"><a href="Network.HTTP2.H2.Types.html#OutObj"><span class="hs-identifier hs-var">OutObj</span></a></span></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="outObjHeaders"><span class="annot"><span class="annottext">OutObj -&gt; [Header]
</span><a href="Network.HTTP2.H2.Types.html#outObjHeaders"><span class="hs-identifier hs-var hs-var">outObjHeaders</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">H.Header</span></span><span class="hs-special">]</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Accessor for header.</span></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="outObjBody"><span class="annot"><span class="annottext">OutObj -&gt; OutBody
</span><a href="Network.HTTP2.H2.Types.html#outObjBody"><span class="hs-identifier hs-var hs-var">outObjBody</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#OutBody"><span class="hs-identifier hs-type">OutBody</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Accessor for outObj body.</span></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="outObjTrailers"><span class="annot"><span class="annottext">OutObj -&gt; TrailersMaker
</span><a href="Network.HTTP2.H2.Types.html#outObjTrailers"><span class="hs-identifier hs-var hs-var">outObjTrailers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#TrailersMaker"><span class="hs-identifier hs-type">TrailersMaker</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Accessor for trailers maker.</span></span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679115965"><span id="local-6989586621679115970"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#OutObj"><span class="hs-identifier hs-type">OutObj</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-88"></span><span>    </span><span id="local-6989586621679115978"><span class="annot"><span class="annottext">show :: OutObj -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.H2.Types.html#OutObj"><span class="hs-identifier hs-type">OutObj</span></a></span><span> </span><span id="local-6989586621679115979"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621679115979"><span class="hs-identifier hs-var">hdr</span></a></span></span><span> </span><span class="annot"><span class="annottext">OutBody
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TrailersMaker
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621679115979"><span class="hs-identifier hs-var">hdr</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">-- | Trailers maker. A chunks of the response body is passed</span><span>
</span><span id="line-91"></span><span class="hs-comment">--   with 'Just'. The maker should update internal state</span><span>
</span><span id="line-92"></span><span class="hs-comment">--   with the 'ByteString' and return the next trailers maker.</span><span>
</span><span id="line-93"></span><span class="hs-comment">--   When response body reaches its end,</span><span>
</span><span id="line-94"></span><span class="hs-comment">--   'Nothing' is passed and the maker should generate</span><span>
</span><span id="line-95"></span><span class="hs-comment">--   trailers. An example:</span><span>
</span><span id="line-96"></span><span class="hs-comment">--</span><span>
</span><span id="line-97"></span><span class="hs-comment">--   &gt; {-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-98"></span><span class="hs-comment">--   &gt; import Data.ByteString (ByteString)</span><span>
</span><span id="line-99"></span><span class="hs-comment">--   &gt; import qualified Data.ByteString.Char8 as C8</span><span>
</span><span id="line-100"></span><span class="hs-comment">--   &gt; import Crypto.Hash (Context, SHA1) -- cryptonite</span><span>
</span><span id="line-101"></span><span class="hs-comment">--   &gt; import qualified Crypto.Hash as CH</span><span>
</span><span id="line-102"></span><span class="hs-comment">--   &gt;</span><span>
</span><span id="line-103"></span><span class="hs-comment">--   &gt; -- Strictness is important for Context.</span><span>
</span><span id="line-104"></span><span class="hs-comment">--   &gt; trailersMaker :: Context SHA1 -&gt; Maybe ByteString -&gt; IO NextTrailersMaker</span><span>
</span><span id="line-105"></span><span class="hs-comment">--   &gt; trailersMaker ctx Nothing = return $ Trailers [(&quot;X-SHA1&quot;, sha1)]</span><span>
</span><span id="line-106"></span><span class="hs-comment">--   &gt;   where</span><span>
</span><span id="line-107"></span><span class="hs-comment">--   &gt;     !sha1 = C8.pack $ show $ CH.hashFinalize ctx</span><span>
</span><span id="line-108"></span><span class="hs-comment">--   &gt; trailersMaker ctx (Just bs) = return $ NextTrailersMaker $ trailersMaker ctx'</span><span>
</span><span id="line-109"></span><span class="hs-comment">--   &gt;   where</span><span>
</span><span id="line-110"></span><span class="hs-comment">--   &gt;     !ctx' = CH.hashUpdate ctx bs</span><span>
</span><span id="line-111"></span><span class="hs-comment">--</span><span>
</span><span id="line-112"></span><span class="hs-comment">--   Usage example:</span><span>
</span><span id="line-113"></span><span class="hs-comment">--</span><span>
</span><span id="line-114"></span><span class="hs-comment">--   &gt; let h2rsp = responseFile ...</span><span>
</span><span id="line-115"></span><span class="hs-comment">--   &gt;     maker = trailersMaker (CH.hashInit :: Context SHA1)</span><span>
</span><span id="line-116"></span><span class="hs-comment">--   &gt;     h2rsp' = setResponseTrailersMaker h2rsp maker</span><span>
</span><span id="line-117"></span><span class="hs-keyword">type</span><span> </span><span id="TrailersMaker"><span class="annot"><a href="Network.HTTP2.H2.Types.html#TrailersMaker"><span class="hs-identifier hs-var">TrailersMaker</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#NextTrailersMaker"><span class="hs-identifier hs-type">NextTrailersMaker</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="annot"><span class="hs-comment">-- | TrailersMake to create no trailers.</span></span><span>
</span><span id="line-120"></span><span class="annot"><a href="Network.HTTP2.H2.Types.html#defaultTrailersMaker"><span class="hs-identifier hs-type">defaultTrailersMaker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#TrailersMaker"><span class="hs-identifier hs-type">TrailersMaker</span></a></span><span>
</span><span id="line-121"></span><span id="defaultTrailersMaker"><span class="annot"><span class="annottext">defaultTrailersMaker :: TrailersMaker
</span><a href="Network.HTTP2.H2.Types.html#defaultTrailersMaker"><span class="hs-identifier hs-var hs-var">defaultTrailersMaker</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe HeaderValue
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NextTrailersMaker -&gt; IO NextTrailersMaker
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(NextTrailersMaker -&gt; IO NextTrailersMaker)
-&gt; NextTrailersMaker -&gt; IO NextTrailersMaker
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; NextTrailersMaker
</span><a href="Network.HTTP2.H2.Types.html#Trailers"><span class="hs-identifier hs-var">Trailers</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-122"></span><span class="annot"><a href="Network.HTTP2.H2.Types.html#defaultTrailersMaker"><span class="hs-identifier hs-var">defaultTrailersMaker</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HeaderValue
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NextTrailersMaker -&gt; IO NextTrailersMaker
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(NextTrailersMaker -&gt; IO NextTrailersMaker)
-&gt; NextTrailersMaker -&gt; IO NextTrailersMaker
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TrailersMaker -&gt; NextTrailersMaker
</span><a href="Network.HTTP2.H2.Types.html#NextTrailersMaker"><span class="hs-identifier hs-var">NextTrailersMaker</span></a></span><span> </span><span class="annot"><span class="annottext">TrailersMaker
</span><a href="Network.HTTP2.H2.Types.html#defaultTrailersMaker"><span class="hs-identifier hs-var">defaultTrailersMaker</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="annot"><span class="hs-comment">-- | Either the next trailers maker or final trailers.</span></span><span>
</span><span id="line-125"></span><span class="hs-keyword">data</span><span> </span><span id="NextTrailersMaker"><span class="annot"><a href="Network.HTTP2.H2.Types.html#NextTrailersMaker"><span class="hs-identifier hs-var">NextTrailersMaker</span></a></span></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="NextTrailersMaker"><span class="annot"><a href="Network.HTTP2.H2.Types.html#NextTrailersMaker"><span class="hs-identifier hs-var">NextTrailersMaker</span></a></span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#TrailersMaker"><span class="hs-identifier hs-type">TrailersMaker</span></a></span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Trailers"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Trailers"><span class="hs-identifier hs-var">Trailers</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">H.Header</span></span><span class="hs-special">]</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="annot"><span class="hs-comment">-- | File specification.</span></span><span>
</span><span id="line-132"></span><span class="hs-keyword">data</span><span> </span><span id="FileSpec"><span class="annot"><a href="Network.HTTP2.H2.Types.html#FileSpec"><span class="hs-identifier hs-var">FileSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FileSpec"><span class="annot"><a href="Network.HTTP2.H2.Types.html#FileSpec"><span class="hs-identifier hs-var">FileSpec</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.File.html#FileOffset"><span class="hs-identifier hs-type">FileOffset</span></a></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.File.html#ByteCount"><span class="hs-identifier hs-type">ByteCount</span></a></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115987"><span id="local-6989586621679115995"><span class="annot"><span class="annottext">FileSpec -&gt; FileSpec -&gt; Bool
(FileSpec -&gt; FileSpec -&gt; Bool)
-&gt; (FileSpec -&gt; FileSpec -&gt; Bool) -&gt; Eq FileSpec
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: FileSpec -&gt; FileSpec -&gt; Bool
== :: FileSpec -&gt; FileSpec -&gt; Bool
$c/= :: FileSpec -&gt; FileSpec -&gt; Bool
/= :: FileSpec -&gt; FileSpec -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679116001"><span id="local-6989586621679116009"><span id="local-6989586621679116013"><span class="annot"><span class="annottext">SettingsValue -&gt; FileSpec -&gt; ShowS
[FileSpec] -&gt; ShowS
FileSpec -&gt; String
(SettingsValue -&gt; FileSpec -&gt; ShowS)
-&gt; (FileSpec -&gt; String) -&gt; ([FileSpec] -&gt; ShowS) -&gt; Show FileSpec
forall a.
(SettingsValue -&gt; a -&gt; ShowS)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: SettingsValue -&gt; FileSpec -&gt; ShowS
showsPrec :: SettingsValue -&gt; FileSpec -&gt; ShowS
$cshow :: FileSpec -&gt; String
show :: FileSpec -&gt; String
$cshowList :: [FileSpec] -&gt; ShowS
showList :: [FileSpec] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-comment">{-

== Stream state

The stream state is stored in the 'streamState' field (an @IORef@) of a
'Stream'. The main place where the stream state is updated is in
'controlOrStream', which does something like this:

&gt; state0 &lt;- readStreamState strm
&gt; state1 &lt;- stream .. state0 ..
&gt; processState .. state1 ..

where 'processState' updates the @IORef@, based on 'state1' (the state computed
by 'stream') and the /current/ state of the stream; for simplicity, we will
assume here that this must equal 'state0' (it might not, if a concurrent thread
changed the stream state).

The diagram below summarizes the stream state transitions on the client side,
omitting error cases (which result in exceptions being thrown). Each transition
is labelled with the relevant case in either the function 'stream' or the
function 'processState'.

&gt;                        [Open JustOpened]
&gt;                               |
&gt;                               |
&gt;                            HEADERS
&gt;                               |
&gt;                               | (stream1)
&gt;                               |
&gt;                          END_HEADERS?
&gt;                               |
&gt;                        ______/ \______
&gt;                       /   yes   no    \
&gt;                      |                |
&gt;                      |         [Open Continued] &lt;--\
&gt;                      |                |            |
&gt;                      |           CONTINUATION      |
&gt;                      |                |            |
&gt;                      |                | (stream5)  |
&gt;                      |                |            |
&gt;                      |           END_HEADERS?      |
&gt;                      |                |            |
&gt;                      v           yes / \ no        |
&gt;                 END_STREAM? &lt;-------/   \-----------/
&gt;                      |                   (process3)
&gt;                      |
&gt;            _________/ \_________
&gt;           /      yes   no       \
&gt;           |                     |
&gt;      [Open NoBody]        [Open HasBody]
&gt;           |                     |
&gt;           | (process1)          | (process2)
&gt;           |                     |
&gt;  [HalfClosedRemote] &lt;--\   [Open Body] &lt;----------------------\
&gt;           |             |        |                             |
&gt;           |             |        +---------------\             |
&gt;       RST_STREAM        |        |               |             |
&gt;           |             |     HEADERS           DATA           |
&gt;           | (stream6)   |        |               |             |
&gt;           |             |        | (stream2)     | (stream4)   |
&gt;           | (process5)  |        |               |             |
&gt;           |             |   END_STREAM?      END_STREAM?       |
&gt;        [Closed]         |        |               |             |
&gt;                         |        | yes      yes / \ no         |
&gt;                         \--------+-------------/   \-----------/
&gt;                          (process4)                 (process6)

Notes:

- The 'HalfClosedLocal' state is not used on the client side.
- Indeed, unless an exception is thrown, even the 'Closed' stream state is not
  used in the client; when the @IORef@ is collected, it is typically in
  'HalfClosedRemote' state.

-}</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-keyword">data</span><span> </span><span id="OpenState"><span class="annot"><a href="Network.HTTP2.H2.Types.html#OpenState"><span class="hs-identifier hs-var">OpenState</span></a></span></span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="JustOpened"><span class="annot"><a href="Network.HTTP2.H2.Types.html#JustOpened"><span class="hs-identifier hs-var">JustOpened</span></a></span></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Continued"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Continued"><span class="hs-identifier hs-var">Continued</span></a></span></span><span>
</span><span id="line-215"></span><span>        </span><span class="hs-special">[</span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#HeaderBlockFragment"><span class="hs-identifier hs-type">HeaderBlockFragment</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-216"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-comment">-- Total size</span><span>
</span><span id="line-217"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-comment">-- The number of continuation frames</span><span>
</span><span id="line-218"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- End of stream</span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="NoBody"><span class="annot"><a href="Network.HTTP2.H2.Types.html#NoBody"><span class="hs-identifier hs-var">NoBody</span></a></span></span><span> </span><span class="annot"><a href="Network.HPACK.HeaderBlock.Decode.html#HeaderTable"><span class="hs-identifier hs-type">HeaderTable</span></a></span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="HasBody"><span class="annot"><a href="Network.HTTP2.H2.Types.html#HasBody"><span class="hs-identifier hs-var">HasBody</span></a></span></span><span> </span><span class="annot"><a href="Network.HPACK.HeaderBlock.Decode.html#HeaderTable"><span class="hs-identifier hs-type">HeaderTable</span></a></span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Body"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Body"><span class="hs-identifier hs-var">Body</span></a></span></span><span>
</span><span id="line-222"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TQueue</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- received Content-Length</span><span>
</span><span id="line-224"></span><span>        </span><span class="hs-comment">-- compared the body length for error checking</span><span>
</span><span id="line-225"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- actual body length</span><span>
</span><span id="line-226"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.HPACK.HeaderBlock.Decode.html#HeaderTable"><span class="hs-identifier hs-type">HeaderTable</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- trailers</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="hs-keyword">data</span><span> </span><span id="ClosedCode"><span class="annot"><a href="Network.HTTP2.H2.Types.html#ClosedCode"><span class="hs-identifier hs-var">ClosedCode</span></a></span></span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="Finished"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Finished"><span class="hs-identifier hs-var">Finished</span></a></span></span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Killed"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Killed"><span class="hs-identifier hs-var">Killed</span></a></span></span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Reset"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Reset"><span class="hs-identifier hs-var">Reset</span></a></span></span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#ErrorCode"><span class="hs-identifier hs-type">ErrorCode</span></a></span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ResetByMe"><span class="annot"><a href="Network.HTTP2.H2.Types.html#ResetByMe"><span class="hs-identifier hs-var">ResetByMe</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679116028"><span id="local-6989586621679116036"><span id="local-6989586621679116040"><span class="annot"><span class="annottext">SettingsValue -&gt; ClosedCode -&gt; ShowS
[ClosedCode] -&gt; ShowS
ClosedCode -&gt; String
(SettingsValue -&gt; ClosedCode -&gt; ShowS)
-&gt; (ClosedCode -&gt; String)
-&gt; ([ClosedCode] -&gt; ShowS)
-&gt; Show ClosedCode
forall a.
(SettingsValue -&gt; a -&gt; ShowS)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: SettingsValue -&gt; ClosedCode -&gt; ShowS
showsPrec :: SettingsValue -&gt; ClosedCode -&gt; ShowS
$cshow :: ClosedCode -&gt; String
show :: ClosedCode -&gt; String
$cshowList :: [ClosedCode] -&gt; ShowS
showList :: [ClosedCode] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="annot"><a href="Network.HTTP2.H2.Types.html#closedCodeToError"><span class="hs-identifier hs-type">closedCodeToError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#StreamId"><span class="hs-identifier hs-type">StreamId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#ClosedCode"><span class="hs-identifier hs-type">ClosedCode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#HTTP2Error"><span class="hs-identifier hs-type">HTTP2Error</span></a></span><span>
</span><span id="line-236"></span><span id="closedCodeToError"><span class="annot"><span class="annottext">closedCodeToError :: SettingsValue -&gt; ClosedCode -&gt; HTTP2Error
</span><a href="Network.HTTP2.H2.Types.html#closedCodeToError"><span class="hs-identifier hs-var hs-var">closedCodeToError</span></a></span></span><span> </span><span id="local-6989586621679116044"><span class="annot"><span class="annottext">SettingsValue
</span><a href="#local-6989586621679116044"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span id="local-6989586621679116045"><span class="annot"><span class="annottext">ClosedCode
</span><a href="#local-6989586621679116045"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ClosedCode
</span><a href="#local-6989586621679116045"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-238"></span><span>        </span><span class="annot"><span class="annottext">ClosedCode
</span><a href="Network.HTTP2.H2.Types.html#Finished"><span class="hs-identifier hs-var">Finished</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HTTP2Error
</span><a href="Network.HTTP2.H2.Types.html#ConnectionIsClosed"><span class="hs-identifier hs-var">ConnectionIsClosed</span></a></span><span>
</span><span id="line-239"></span><span>        </span><span class="annot"><span class="annottext">ClosedCode
</span><a href="Network.HTTP2.H2.Types.html#Killed"><span class="hs-identifier hs-var">Killed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HTTP2Error
</span><a href="Network.HTTP2.H2.Types.html#ConnectionIsTimeout"><span class="hs-identifier hs-var">ConnectionIsTimeout</span></a></span><span>
</span><span id="line-240"></span><span>        </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Reset"><span class="hs-identifier hs-type">Reset</span></a></span><span> </span><span id="local-6989586621679116048"><span class="annot"><span class="annottext">ErrorCode
</span><a href="#local-6989586621679116048"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrorCode -&gt; SettingsValue -&gt; ReasonPhrase -&gt; HTTP2Error
</span><a href="Network.HTTP2.H2.Types.html#ConnectionErrorIsReceived"><span class="hs-identifier hs-var">ConnectionErrorIsReceived</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="#local-6989586621679116048"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">SettingsValue
</span><a href="#local-6989586621679116044"><span class="hs-identifier hs-var">sid</span></a></span><span> </span><span class="annot"><span class="annottext">ReasonPhrase
</span><span class="hs-string">&quot;Connection was reset&quot;</span></span><span>
</span><span id="line-241"></span><span>        </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#ResetByMe"><span class="hs-identifier hs-type">ResetByMe</span></a></span><span> </span><span id="local-6989586621679116050"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679116050"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; HTTP2Error
</span><a href="Network.HTTP2.H2.Types.html#BadThingHappen"><span class="hs-identifier hs-var">BadThingHappen</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679116050"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="hs-keyword">data</span><span> </span><span id="StreamState"><span class="annot"><a href="Network.HTTP2.H2.Types.html#StreamState"><span class="hs-identifier hs-var">StreamState</span></a></span></span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="Idle"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Idle"><span class="hs-identifier hs-var">Idle</span></a></span></span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Open"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Open"><span class="hs-identifier hs-var">Open</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#ClosedCode"><span class="hs-identifier hs-type">ClosedCode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#OpenState"><span class="hs-identifier hs-type">OpenState</span></a></span><span> </span><span class="hs-comment">-- HalfClosedLocal if Just</span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="HalfClosedRemote"><span class="annot"><a href="Network.HTTP2.H2.Types.html#HalfClosedRemote"><span class="hs-identifier hs-var">HalfClosedRemote</span></a></span></span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Closed"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Closed"><span class="hs-identifier hs-var">Closed</span></a></span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#ClosedCode"><span class="hs-identifier hs-type">ClosedCode</span></a></span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Reserved"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Reserved"><span class="hs-identifier hs-var">Reserved</span></a></span></span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679116058"><span id="local-6989586621679116063"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#StreamState"><span class="hs-identifier hs-type">StreamState</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-253"></span><span>    </span><span id="local-6989586621679116071"><span class="annot"><span class="annottext">show :: StreamState -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span class="annot"><span class="annottext">StreamState
</span><a href="Network.HTTP2.H2.Types.html#Idle"><span class="hs-identifier hs-var">Idle</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Idle&quot;</span></span><span>
</span><span id="line-254"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ClosedCode
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">OpenState
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Open&quot;</span></span><span>
</span><span id="line-255"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679116072"><span class="annot"><span class="annottext">ClosedCode
</span><a href="#local-6989586621679116072"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OpenState
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HalfClosedLocal: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ClosedCode -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ClosedCode
</span><a href="#local-6989586621679116072"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">StreamState
</span><a href="Network.HTTP2.H2.Types.html#HalfClosedRemote"><span class="hs-identifier hs-var">HalfClosedRemote</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HalfClosedRemote&quot;</span></span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Closed"><span class="hs-identifier hs-type">Closed</span></a></span><span> </span><span id="local-6989586621679116073"><span class="annot"><span class="annottext">ClosedCode
</span><a href="#local-6989586621679116073"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Closed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ClosedCode -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ClosedCode
</span><a href="#local-6989586621679116073"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-258"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">StreamState
</span><a href="Network.HTTP2.H2.Types.html#Reserved"><span class="hs-identifier hs-var">Reserved</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Reserved&quot;</span></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="hs-keyword">data</span><span> </span><span id="Stream"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-var">Stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Stream"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-var">Stream</span></a></span></span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="streamNumber"><span class="annot"><span class="annottext">Stream -&gt; SettingsValue
</span><a href="Network.HTTP2.H2.Types.html#streamNumber"><span class="hs-identifier hs-var hs-var">streamNumber</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#StreamId"><span class="hs-identifier hs-type">StreamId</span></a></span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="streamState"><span class="annot"><span class="annottext">Stream -&gt; IORef StreamState
</span><a href="Network.HTTP2.H2.Types.html#streamState"><span class="hs-identifier hs-var hs-var">streamState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#StreamState"><span class="hs-identifier hs-type">StreamState</span></a></span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="streamInput"><span class="annot"><span class="annottext">Stream -&gt; MVar (Either SomeException InpObj)
</span><a href="Network.HTTP2.H2.Types.html#streamInput"><span class="hs-identifier hs-var hs-var">streamInput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#InpObj"><span class="hs-identifier hs-type">InpObj</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Client only</span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="streamTxFlow"><span class="annot"><span class="annottext">Stream -&gt; TVar TxFlow
</span><a href="Network.HTTP2.H2.Types.html#streamTxFlow"><span class="hs-identifier hs-var hs-var">streamTxFlow</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxFlow</span></span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="streamRxFlow"><span class="annot"><span class="annottext">Stream -&gt; IORef RxFlow
</span><a href="Network.HTTP2.H2.Types.html#streamRxFlow"><span class="hs-identifier hs-var hs-var">streamRxFlow</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RxFlow</span></span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679116081"><span id="local-6989586621679116086"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-271"></span><span>    </span><span id="local-6989586621679116095"><span class="annot"><span class="annottext">show :: Stream -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span class="hs-special">{</span><span id="local-6989586621679116096"><span id="local-6989586621679116097"><span id="local-6989586621679116098"><span id="local-6989586621679116099"><span id="local-6989586621679116100"><span class="annot"><span class="annottext">SettingsValue
MVar (Either SomeException InpObj)
TVar TxFlow
IORef RxFlow
IORef StreamState
streamNumber :: Stream -&gt; SettingsValue
streamState :: Stream -&gt; IORef StreamState
streamInput :: Stream -&gt; MVar (Either SomeException InpObj)
streamTxFlow :: Stream -&gt; TVar TxFlow
streamRxFlow :: Stream -&gt; IORef RxFlow
streamNumber :: SettingsValue
streamState :: IORef StreamState
streamInput :: MVar (Either SomeException InpObj)
streamTxFlow :: TVar TxFlow
streamRxFlow :: IORef RxFlow
</span><a href="Network.HTTP2.H2.Types.html#streamNumber"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-272"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Stream{id=&quot;</span></span><span>
</span><span id="line-273"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">SettingsValue -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">SettingsValue
</span><a href="#local-6989586621679116096"><span class="hs-identifier hs-var">streamNumber</span></a></span><span>
</span><span id="line-274"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,state=&quot;</span></span><span>
</span><span id="line-275"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">StreamState -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO StreamState -&gt; StreamState
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IORef StreamState -&gt; IO StreamState
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef StreamState
</span><a href="#local-6989586621679116097"><span class="hs-identifier hs-var">streamState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;}&quot;</span></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span class="hs-keyword">data</span><span> </span><span id="Input"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Input"><span class="hs-identifier hs-var">Input</span></a></span></span><span> </span><span id="local-6989586621679116104"><span class="annot"><a href="#local-6989586621679116104"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Input"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Input"><span class="hs-identifier hs-var">Input</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679116104"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#InpObj"><span class="hs-identifier hs-type">InpObj</span></a></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="hs-keyword">data</span><span> </span><span id="Output"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Output"><span class="hs-identifier hs-var">Output</span></a></span></span><span> </span><span id="local-6989586621679115881"><span class="annot"><a href="#local-6989586621679115881"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Output"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Output"><span class="hs-identifier hs-var">Output</span></a></span></span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="outputStream"><span class="annot"><span class="annottext">forall a. Output a -&gt; a
</span><a href="Network.HTTP2.H2.Types.html#outputStream"><span class="hs-identifier hs-var hs-var">outputStream</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679115881"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="outputObject"><span class="annot"><span class="annottext">forall a. Output a -&gt; OutObj
</span><a href="Network.HTTP2.H2.Types.html#outputObject"><span class="hs-identifier hs-var hs-var">outputObject</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#OutObj"><span class="hs-identifier hs-type">OutObj</span></a></span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="outputType"><span class="annot"><span class="annottext">forall a. Output a -&gt; OutputType
</span><a href="Network.HTTP2.H2.Types.html#outputType"><span class="hs-identifier hs-var hs-var">outputType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#OutputType"><span class="hs-identifier hs-type">OutputType</span></a></span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="outputStrmQ"><span class="annot"><span class="annottext">forall a. Output a -&gt; Maybe (TBQueue StreamingChunk)
</span><a href="Network.HTTP2.H2.Types.html#outputStrmQ"><span class="hs-identifier hs-var hs-var">outputStrmQ</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TBQueue</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#StreamingChunk"><span class="hs-identifier hs-type">StreamingChunk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="outputSentinel"><span class="annot"><span class="annottext">forall a. Output a -&gt; IO ()
</span><a href="Network.HTTP2.H2.Types.html#outputSentinel"><span class="hs-identifier hs-var hs-var">outputSentinel</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span class="hs-keyword">data</span><span> </span><span id="OutputType"><span class="annot"><a href="Network.HTTP2.H2.Types.html#OutputType"><span class="hs-identifier hs-var">OutputType</span></a></span></span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="OObj"><span class="annot"><a href="Network.HTTP2.H2.Types.html#OObj"><span class="hs-identifier hs-var">OObj</span></a></span></span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="OWait"><span class="annot"><a href="Network.HTTP2.H2.Types.html#OWait"><span class="hs-identifier hs-var">OWait</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="OPush"><span class="annot"><a href="Network.HTTP2.H2.Types.html#OPush"><span class="hs-identifier hs-var">OPush</span></a></span></span><span> </span><span class="annot"><a href="Network.HPACK.Types.html#TokenHeaderList"><span class="hs-identifier hs-type">TokenHeaderList</span></a></span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#StreamId"><span class="hs-identifier hs-type">StreamId</span></a></span><span> </span><span class="hs-comment">-- associated stream id from client</span><span>
</span><span id="line-294"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ONext"><span class="annot"><a href="Network.HTTP2.H2.Types.html#ONext"><span class="hs-identifier hs-var">ONext</span></a></span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#DynaNext"><span class="hs-identifier hs-type">DynaNext</span></a></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#TrailersMaker"><span class="hs-identifier hs-type">TrailersMaker</span></a></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span class="hs-keyword">type</span><span> </span><span id="DynaNext"><span class="annot"><a href="Network.HTTP2.H2.Types.html#DynaNext"><span class="hs-identifier hs-var">DynaNext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Buffer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BufferSize</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WindowSize</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Next"><span class="hs-identifier hs-type">Next</span></a></span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="hs-keyword">type</span><span> </span><span id="BytesFilled"><span class="annot"><a href="Network.HTTP2.H2.Types.html#BytesFilled"><span class="hs-identifier hs-var">BytesFilled</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="hs-keyword">data</span><span> </span><span id="Next"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Next"><span class="hs-identifier hs-var">Next</span></a></span></span><span>
</span><span id="line-303"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="Next"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Next"><span class="hs-identifier hs-var">Next</span></a></span></span><span>
</span><span id="line-304"></span><span>        </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#BytesFilled"><span class="hs-identifier hs-type">BytesFilled</span></a></span><span> </span><span class="hs-comment">-- payload length</span><span>
</span><span id="line-305"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- require flushing</span><span>
</span><span id="line-306"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#DynaNext"><span class="hs-identifier hs-type">DynaNext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span class="hs-keyword">data</span><span> </span><span id="Control"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Control"><span class="hs-identifier hs-var">Control</span></a></span></span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="CFinish"><span class="annot"><a href="Network.HTTP2.H2.Types.html#CFinish"><span class="hs-identifier hs-var">CFinish</span></a></span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#HTTP2Error"><span class="hs-identifier hs-type">HTTP2Error</span></a></span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="CFrames"><span class="annot"><a href="Network.HTTP2.H2.Types.html#CFrames"><span class="hs-identifier hs-var">CFrames</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#SettingsList"><span class="hs-identifier hs-type">SettingsList</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">]</span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="CGoaway"><span class="annot"><a href="Network.HTTP2.H2.Types.html#CGoaway"><span class="hs-identifier hs-var">CGoaway</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MVar</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span class="hs-keyword">data</span><span> </span><span id="StreamingChunk"><span class="annot"><a href="Network.HTTP2.H2.Types.html#StreamingChunk"><span class="hs-identifier hs-var">StreamingChunk</span></a></span></span><span>
</span><span id="line-318"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="StreamingFinished"><span class="annot"><a href="Network.HTTP2.H2.Types.html#StreamingFinished"><span class="hs-identifier hs-var">StreamingFinished</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="StreamingFlush"><span class="annot"><a href="Network.HTTP2.H2.Types.html#StreamingFlush"><span class="hs-identifier hs-var">StreamingFlush</span></a></span></span><span>
</span><span id="line-320"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="StreamingBuilder"><span class="annot"><a href="Network.HTTP2.H2.Types.html#StreamingBuilder"><span class="hs-identifier hs-var">StreamingBuilder</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Builder</span></span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span class="hs-keyword">type</span><span> </span><span id="ReasonPhrase"><span class="annot"><a href="Network.HTTP2.H2.Types.html#ReasonPhrase"><span class="hs-identifier hs-var">ReasonPhrase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortByteString</span></span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span class="hs-comment">-- | The connection error or the stream error.</span><span>
</span><span id="line-327"></span><span class="hs-comment">--   Stream errors are treated as connection errors since</span><span>
</span><span id="line-328"></span><span class="hs-comment">--   there are no good recovery ways.</span><span>
</span><span id="line-329"></span><span class="hs-comment">--   `ErrorCode` in connection errors should be the highest stream identifier</span><span>
</span><span id="line-330"></span><span class="hs-comment">--   but in this implementation it identifies the stream that</span><span>
</span><span id="line-331"></span><span class="hs-comment">--   caused this error.</span><span>
</span><span id="line-332"></span><span class="hs-keyword">data</span><span> </span><span id="HTTP2Error"><span class="annot"><a href="Network.HTTP2.H2.Types.html#HTTP2Error"><span class="hs-identifier hs-var">HTTP2Error</span></a></span></span><span>
</span><span id="line-333"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="ConnectionIsClosed"><span class="annot"><a href="Network.HTTP2.H2.Types.html#ConnectionIsClosed"><span class="hs-identifier hs-var">ConnectionIsClosed</span></a></span></span><span> </span><span class="hs-comment">-- NoError</span><span>
</span><span id="line-334"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ConnectionIsTimeout"><span class="annot"><a href="Network.HTTP2.H2.Types.html#ConnectionIsTimeout"><span class="hs-identifier hs-var">ConnectionIsTimeout</span></a></span></span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ConnectionErrorIsReceived"><span class="annot"><a href="Network.HTTP2.H2.Types.html#ConnectionErrorIsReceived"><span class="hs-identifier hs-var">ConnectionErrorIsReceived</span></a></span></span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#ErrorCode"><span class="hs-identifier hs-type">ErrorCode</span></a></span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#StreamId"><span class="hs-identifier hs-type">StreamId</span></a></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#ReasonPhrase"><span class="hs-identifier hs-type">ReasonPhrase</span></a></span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ConnectionErrorIsSent"><span class="annot"><a href="Network.HTTP2.H2.Types.html#ConnectionErrorIsSent"><span class="hs-identifier hs-var">ConnectionErrorIsSent</span></a></span></span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#ErrorCode"><span class="hs-identifier hs-type">ErrorCode</span></a></span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#StreamId"><span class="hs-identifier hs-type">StreamId</span></a></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#ReasonPhrase"><span class="hs-identifier hs-type">ReasonPhrase</span></a></span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="StreamErrorIsReceived"><span class="annot"><a href="Network.HTTP2.H2.Types.html#StreamErrorIsReceived"><span class="hs-identifier hs-var">StreamErrorIsReceived</span></a></span></span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#ErrorCode"><span class="hs-identifier hs-type">ErrorCode</span></a></span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#StreamId"><span class="hs-identifier hs-type">StreamId</span></a></span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="StreamErrorIsSent"><span class="annot"><a href="Network.HTTP2.H2.Types.html#StreamErrorIsSent"><span class="hs-identifier hs-var">StreamErrorIsSent</span></a></span></span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#ErrorCode"><span class="hs-identifier hs-type">ErrorCode</span></a></span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#StreamId"><span class="hs-identifier hs-type">StreamId</span></a></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#ReasonPhrase"><span class="hs-identifier hs-type">ReasonPhrase</span></a></span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="BadThingHappen"><span class="annot"><a href="Network.HTTP2.H2.Types.html#BadThingHappen"><span class="hs-identifier hs-var">BadThingHappen</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">E.SomeException</span></span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="GoAwayIsSent"><span class="annot"><a href="Network.HTTP2.H2.Types.html#GoAwayIsSent"><span class="hs-identifier hs-var">GoAwayIsSent</span></a></span></span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679116136"><span id="local-6989586621679116156"><span id="local-6989586621679116160"><span class="annot"><span class="annottext">SettingsValue -&gt; HTTP2Error -&gt; ShowS
[HTTP2Error] -&gt; ShowS
HTTP2Error -&gt; String
(SettingsValue -&gt; HTTP2Error -&gt; ShowS)
-&gt; (HTTP2Error -&gt; String)
-&gt; ([HTTP2Error] -&gt; ShowS)
-&gt; Show HTTP2Error
forall a.
(SettingsValue -&gt; a -&gt; ShowS)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: SettingsValue -&gt; HTTP2Error -&gt; ShowS
showsPrec :: SettingsValue -&gt; HTTP2Error -&gt; ShowS
$cshow :: HTTP2Error -&gt; String
show :: HTTP2Error -&gt; String
$cshowList :: [HTTP2Error] -&gt; ShowS
showList :: [HTTP2Error] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679116167"><span id="local-6989586621679116171"><span id="local-6989586621679116174"><span class="annot"><span class="hs-identifier hs-type">E.Exception</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#HTTP2Error"><span class="hs-identifier hs-type">HTTP2Error</span></a></span></span></span></span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span class="hs-comment">-- | Checking 'SettingsList' and reporting an error if any.</span><span>
</span><span id="line-348"></span><span class="hs-comment">--</span><span>
</span><span id="line-349"></span><span class="hs-comment">-- &gt;&gt;&gt; checkSettingsList [(SettingsEnablePush,2)]</span><span>
</span><span id="line-350"></span><span class="hs-comment">-- Just (ConnectionErrorIsSent ProtocolError 0 &quot;enable push must be 0 or 1&quot;)</span><span>
</span><span id="line-351"></span><span class="annot"><a href="Network.HTTP2.H2.Types.html#checkSettingsList"><span class="hs-identifier hs-type">checkSettingsList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#SettingsList"><span class="hs-identifier hs-type">SettingsList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#HTTP2Error"><span class="hs-identifier hs-type">HTTP2Error</span></a></span><span>
</span><span id="line-352"></span><span id="checkSettingsList"><span class="annot"><span class="annottext">checkSettingsList :: SettingsList -&gt; Maybe HTTP2Error
</span><a href="Network.HTTP2.H2.Types.html#checkSettingsList"><span class="hs-identifier hs-var hs-var">checkSettingsList</span></a></span></span><span> </span><span id="local-6989586621679116178"><span class="annot"><span class="annottext">SettingsList
</span><a href="#local-6989586621679116178"><span class="hs-identifier hs-var">settings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">((SettingsKey, SettingsValue) -&gt; Maybe HTTP2Error)
-&gt; SettingsList -&gt; [HTTP2Error]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">(SettingsKey, SettingsValue) -&gt; Maybe HTTP2Error
</span><a href="Network.HTTP2.H2.Types.html#checkSettingsValue"><span class="hs-identifier hs-var">checkSettingsValue</span></a></span><span> </span><span class="annot"><span class="annottext">SettingsList
</span><a href="#local-6989586621679116178"><span class="hs-identifier hs-var">settings</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-353"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe HTTP2Error
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679116181"><span class="annot"><span class="annottext">HTTP2Error
</span><a href="#local-6989586621679116181"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[HTTP2Error]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HTTP2Error -&gt; Maybe HTTP2Error
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">HTTP2Error
</span><a href="#local-6989586621679116181"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span class="annot"><a href="Network.HTTP2.H2.Types.html#checkSettingsValue"><span class="hs-identifier hs-type">checkSettingsValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#SettingsKey"><span class="hs-identifier hs-type">SettingsKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#SettingsValue"><span class="hs-identifier hs-type">SettingsValue</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#HTTP2Error"><span class="hs-identifier hs-type">HTTP2Error</span></a></span><span>
</span><span id="line-357"></span><span id="checkSettingsValue"><span class="annot"><span class="annottext">checkSettingsValue :: (SettingsKey, SettingsValue) -&gt; Maybe HTTP2Error
</span><a href="Network.HTTP2.H2.Types.html#checkSettingsValue"><span class="hs-identifier hs-var hs-var">checkSettingsValue</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SettingsKey
</span><a href="Network.HTTP2.Frame.Types.html#SettingsEnablePush"><span class="hs-identifier hs-var">SettingsEnablePush</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679116183"><span class="annot"><span class="annottext">SettingsValue
</span><a href="#local-6989586621679116183"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SettingsValue
</span><a href="#local-6989586621679116183"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SettingsValue -&gt; SettingsValue -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">SettingsValue
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">SettingsValue
</span><a href="#local-6989586621679116183"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SettingsValue -&gt; SettingsValue -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">SettingsValue
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-359"></span><span>        </span><span class="annot"><span class="annottext">HTTP2Error -&gt; Maybe HTTP2Error
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(HTTP2Error -&gt; Maybe HTTP2Error) -&gt; HTTP2Error -&gt; Maybe HTTP2Error
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorCode -&gt; SettingsValue -&gt; ReasonPhrase -&gt; HTTP2Error
</span><a href="Network.HTTP2.H2.Types.html#ConnectionErrorIsSent"><span class="hs-identifier hs-var">ConnectionErrorIsSent</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="Network.HTTP2.Frame.Types.html#ProtocolError"><span class="hs-identifier hs-var">ProtocolError</span></a></span><span> </span><span class="annot"><span class="annottext">SettingsValue
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">ReasonPhrase
</span><span class="hs-string">&quot;enable push must be 0 or 1&quot;</span></span><span>
</span><span id="line-360"></span><span class="annot"><a href="Network.HTTP2.H2.Types.html#checkSettingsValue"><span class="hs-identifier hs-var">checkSettingsValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SettingsKey
</span><a href="Network.HTTP2.Frame.Types.html#SettingsInitialWindowSize"><span class="hs-identifier hs-var">SettingsInitialWindowSize</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679116188"><span class="annot"><span class="annottext">SettingsValue
</span><a href="#local-6989586621679116188"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SettingsValue
</span><a href="#local-6989586621679116188"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SettingsValue -&gt; SettingsValue -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">SettingsValue
</span><a href="Network.HTTP2.Frame.Types.html#maxWindowSize"><span class="hs-identifier hs-var">maxWindowSize</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-362"></span><span>        </span><span class="annot"><span class="annottext">HTTP2Error -&gt; Maybe HTTP2Error
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(HTTP2Error -&gt; Maybe HTTP2Error) -&gt; HTTP2Error -&gt; Maybe HTTP2Error
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-363"></span><span>            </span><span class="annot"><span class="annottext">ErrorCode -&gt; SettingsValue -&gt; ReasonPhrase -&gt; HTTP2Error
</span><a href="Network.HTTP2.H2.Types.html#ConnectionErrorIsSent"><span class="hs-identifier hs-var">ConnectionErrorIsSent</span></a></span><span>
</span><span id="line-364"></span><span>                </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="Network.HTTP2.Frame.Types.html#FlowControlError"><span class="hs-identifier hs-var">FlowControlError</span></a></span><span>
</span><span id="line-365"></span><span>                </span><span class="annot"><span class="annottext">SettingsValue
</span><span class="hs-number">0</span></span><span>
</span><span id="line-366"></span><span>                </span><span class="annot"><span class="annottext">ReasonPhrase
</span><span class="hs-string">&quot;Window size must be less than or equal to 65535&quot;</span></span><span>
</span><span id="line-367"></span><span class="annot"><a href="Network.HTTP2.H2.Types.html#checkSettingsValue"><span class="hs-identifier hs-var">checkSettingsValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SettingsKey
</span><a href="Network.HTTP2.Frame.Types.html#SettingsMaxFrameSize"><span class="hs-identifier hs-var">SettingsMaxFrameSize</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679116193"><span class="annot"><span class="annottext">SettingsValue
</span><a href="#local-6989586621679116193"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SettingsValue
</span><a href="#local-6989586621679116193"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SettingsValue -&gt; SettingsValue -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">SettingsValue
</span><a href="Network.HTTP2.Frame.Types.html#defaultPayloadLength"><span class="hs-identifier hs-var">defaultPayloadLength</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">SettingsValue
</span><a href="#local-6989586621679116193"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SettingsValue -&gt; SettingsValue -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">SettingsValue
</span><a href="Network.HTTP2.Frame.Types.html#maxPayloadLength"><span class="hs-identifier hs-var">maxPayloadLength</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-369"></span><span>        </span><span class="annot"><span class="annottext">HTTP2Error -&gt; Maybe HTTP2Error
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(HTTP2Error -&gt; Maybe HTTP2Error) -&gt; HTTP2Error -&gt; Maybe HTTP2Error
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-370"></span><span>            </span><span class="annot"><span class="annottext">ErrorCode -&gt; SettingsValue -&gt; ReasonPhrase -&gt; HTTP2Error
</span><a href="Network.HTTP2.H2.Types.html#ConnectionErrorIsSent"><span class="hs-identifier hs-var">ConnectionErrorIsSent</span></a></span><span>
</span><span id="line-371"></span><span>                </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="Network.HTTP2.Frame.Types.html#ProtocolError"><span class="hs-identifier hs-var">ProtocolError</span></a></span><span>
</span><span id="line-372"></span><span>                </span><span class="annot"><span class="annottext">SettingsValue
</span><span class="hs-number">0</span></span><span>
</span><span id="line-373"></span><span>                </span><span class="annot"><span class="annottext">ReasonPhrase
</span><span class="hs-string">&quot;Max frame size must be in between 16384 and 16777215&quot;</span></span><span>
</span><span id="line-374"></span><span class="annot"><a href="Network.HTTP2.H2.Types.html#checkSettingsValue"><span class="hs-identifier hs-var">checkSettingsValue</span></a></span><span> </span><span class="annot"><span class="annottext">(SettingsKey, SettingsValue)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe HTTP2Error
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span class="annot"><span class="hs-comment">-- | HTTP/2 configuration.</span></span><span>
</span><span id="line-379"></span><span class="hs-keyword">data</span><span> </span><span id="Config"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Config"><span class="hs-identifier hs-var">Config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Config"><span class="annot"><a href="Network.HTTP2.H2.Types.html#Config"><span class="hs-identifier hs-var">Config</span></a></span></span><span>
</span><span id="line-380"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="confWriteBuffer"><span class="annot"><span class="annottext">Config -&gt; Buffer
</span><a href="Network.HTTP2.H2.Types.html#confWriteBuffer"><span class="hs-identifier hs-var hs-var">confWriteBuffer</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Buffer</span></span><span>
</span><span id="line-381"></span><span>    </span><span class="hs-comment">-- ^ This is used only by frameSender.</span><span>
</span><span id="line-382"></span><span>    </span><span class="hs-comment">-- This MUST be freed after frameSender is terminated.</span><span>
</span><span id="line-383"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="confBufferSize"><span class="annot"><span class="annottext">Config -&gt; SettingsValue
</span><a href="Network.HTTP2.H2.Types.html#confBufferSize"><span class="hs-identifier hs-var hs-var">confBufferSize</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BufferSize</span></span><span>
</span><span id="line-384"></span><span>    </span><span class="hs-comment">-- ^ The size of the write buffer.</span><span>
</span><span id="line-385"></span><span>    </span><span class="hs-comment">--   We assume that the read buffer is the same size.</span><span>
</span><span id="line-386"></span><span>    </span><span class="hs-comment">--   So, this value is announced via SETTINGS_MAX_FRAME_SIZE</span><span>
</span><span id="line-387"></span><span>    </span><span class="hs-comment">--   to the peer.</span><span>
</span><span id="line-388"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="confSendAll"><span class="annot"><span class="annottext">Config -&gt; HeaderValue -&gt; IO ()
</span><a href="Network.HTTP2.H2.Types.html#confSendAll"><span class="hs-identifier hs-var hs-var">confSendAll</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="confReadN"><span class="annot"><span class="annottext">Config -&gt; SettingsValue -&gt; InpBody
</span><a href="Network.HTTP2.H2.Types.html#confReadN"><span class="hs-identifier hs-var hs-var">confReadN</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-390"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="confPositionReadMaker"><span class="annot"><span class="annottext">Config -&gt; PositionReadMaker
</span><a href="Network.HTTP2.H2.Types.html#confPositionReadMaker"><span class="hs-identifier hs-var hs-var">confPositionReadMaker</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.File.html#PositionReadMaker"><span class="hs-identifier hs-type">PositionReadMaker</span></a></span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="confTimeoutManager"><span class="annot"><span class="annottext">Config -&gt; Manager
</span><a href="Network.HTTP2.H2.Types.html#confTimeoutManager"><span class="hs-identifier hs-var hs-var">confTimeoutManager</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Manager</span></span><span>
</span><span id="line-392"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="confMySockAddr"><span class="annot"><span class="annottext">Config -&gt; SockAddr
</span><a href="Network.HTTP2.H2.Types.html#confMySockAddr"><span class="hs-identifier hs-var hs-var">confMySockAddr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SockAddr</span></span><span>
</span><span id="line-393"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ This is copied into 'Aux', if exist, on server.</span></span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="confPeerSockAddr"><span class="annot"><span class="annottext">Config -&gt; SockAddr
</span><a href="Network.HTTP2.H2.Types.html#confPeerSockAddr"><span class="hs-identifier hs-var hs-var">confPeerSockAddr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SockAddr</span></span><span>
</span><span id="line-395"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ This is copied into 'Aux', if exist, on server.</span></span><span>
</span><span id="line-396"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-397"></span></pre></body></html>