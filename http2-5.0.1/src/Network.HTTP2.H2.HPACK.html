<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.HTTP2.H2.HPACK</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-5"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#hpackEncodeHeader"><span class="hs-identifier">hpackEncodeHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#hpackEncodeHeaderLoop"><span class="hs-identifier">hpackEncodeHeaderLoop</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#hpackDecodeHeader"><span class="hs-identifier">hpackDecodeHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#hpackDecodeTrailer"><span class="hs-identifier">hpackDecodeTrailer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#just"><span class="hs-identifier">just</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#fixHeaders"><span class="hs-identifier">fixHeaders</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.ByteOrder</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Types</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">H</span></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Imports.html"><span class="hs-identifier">Imports</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HPACK.html"><span class="hs-identifier">Network.HPACK</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HPACK.Token.html"><span class="hs-identifier">Network.HPACK.Token</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.html"><span class="hs-identifier">Network.HTTP2.Frame</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Context.html"><span class="hs-identifier">Network.HTTP2.H2.Context</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html"><span class="hs-identifier">Network.HTTP2.H2.Types</span></a></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-comment">-- $setup</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- &gt;&gt;&gt; :set -XOverloadedStrings</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#fixHeaders"><span class="hs-identifier hs-type">fixHeaders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">H.ResponseHeaders</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">H.ResponseHeaders</span></span><span>
</span><span id="line-30"></span><span id="fixHeaders"><span class="annot"><span class="annottext">fixHeaders :: ResponseHeaders -&gt; ResponseHeaders
</span><a href="Network.HTTP2.H2.HPACK.html#fixHeaders"><span class="hs-identifier hs-var hs-var">fixHeaders</span></a></span></span><span> </span><span id="local-6989586621679117277"><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679117277"><span class="hs-identifier hs-var">hdr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResponseHeaders -&gt; ResponseHeaders
</span><a href="Network.HTTP2.H2.HPACK.html#deleteUnnecessaryHeaders"><span class="hs-identifier hs-var">deleteUnnecessaryHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679117277"><span class="hs-identifier hs-var">hdr</span></a></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#deleteUnnecessaryHeaders"><span class="hs-identifier hs-type">deleteUnnecessaryHeaders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">H.ResponseHeaders</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">H.ResponseHeaders</span></span><span>
</span><span id="line-33"></span><span id="deleteUnnecessaryHeaders"><span class="annot"><span class="annottext">deleteUnnecessaryHeaders :: ResponseHeaders -&gt; ResponseHeaders
</span><a href="Network.HTTP2.H2.HPACK.html#deleteUnnecessaryHeaders"><span class="hs-identifier hs-var hs-var">deleteUnnecessaryHeaders</span></a></span></span><span> </span><span id="local-6989586621679117279"><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679117279"><span class="hs-identifier hs-var">hdr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Header -&gt; Bool) -&gt; ResponseHeaders -&gt; ResponseHeaders
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">Header -&gt; Bool
forall {b}. (HeaderName, b) -&gt; Bool
</span><a href="#local-6989586621679117280"><span class="hs-identifier hs-var">del</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679117279"><span class="hs-identifier hs-var">hdr</span></a></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-35"></span><span>    </span><span id="local-6989586621679117280"><span class="annot"><span class="annottext">del :: (HeaderName, b) -&gt; Bool
</span><a href="#local-6989586621679117280"><span class="hs-identifier hs-var hs-var">del</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679117286"><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621679117286"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621679117286"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderName -&gt; [HeaderName] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`notElem`</span></span><span> </span><span class="annot"><span class="annottext">[HeaderName]
</span><a href="Network.HTTP2.H2.HPACK.html#headersToBeRemoved"><span class="hs-identifier hs-var">headersToBeRemoved</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#headersToBeRemoved"><span class="hs-identifier hs-type">headersToBeRemoved</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">H.HeaderName</span></span><span class="hs-special">]</span><span>
</span><span id="line-38"></span><span id="headersToBeRemoved"><span class="annot"><span class="annottext">headersToBeRemoved :: [HeaderName]
</span><a href="Network.HTTP2.H2.HPACK.html#headersToBeRemoved"><span class="hs-identifier hs-var hs-var">headersToBeRemoved</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-identifier hs-var">H.hConnection</span></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Transfer-Encoding&quot;</span></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-comment">-- Keep-Alive</span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-comment">-- Proxy-Connection</span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-comment">-- Upgrade</span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#strategy"><span class="hs-identifier hs-type">strategy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HPACK.Types.html#EncodeStrategy"><span class="hs-identifier hs-type">EncodeStrategy</span></a></span><span>
</span><span id="line-49"></span><span id="strategy"><span class="annot"><span class="annottext">strategy :: EncodeStrategy
</span><a href="Network.HTTP2.H2.HPACK.html#strategy"><span class="hs-identifier hs-var hs-var">strategy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.HPACK.Types.html#EncodeStrategy"><span class="hs-identifier hs-type">EncodeStrategy</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">compressionAlgo :: CompressionAlgo
</span><a href="Network.HPACK.Types.html#compressionAlgo"><span class="hs-identifier hs-var">compressionAlgo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompressionAlgo
</span><a href="Network.HPACK.Types.html#Linear"><span class="hs-identifier hs-var">Linear</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">useHuffman :: Bool
</span><a href="Network.HPACK.Types.html#useHuffman"><span class="hs-identifier hs-var">useHuffman</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">}</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-comment">-- Set-Cookie: contains only one cookie value.</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- So, we don't need to split it.</span><span>
</span><span id="line-53"></span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#hpackEncodeHeader"><span class="hs-identifier hs-type">hpackEncodeHeader</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Buffer</span></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BufferSize</span></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HPACK.Types.html#TokenHeaderList"><span class="hs-identifier hs-type">TokenHeaderList</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HPACK.Types.html#TokenHeaderList"><span class="hs-identifier hs-type">TokenHeaderList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span id="hpackEncodeHeader"><span class="annot"><span class="annottext">hpackEncodeHeader :: Context
-&gt; Buffer
-&gt; BufferSize
-&gt; TokenHeaderList
-&gt; IO (TokenHeaderList, BufferSize)
</span><a href="Network.HTTP2.H2.HPACK.html#hpackEncodeHeader"><span class="hs-identifier hs-var hs-var">hpackEncodeHeader</span></a></span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span class="hs-special">{</span><span id="local-6989586621679117296"><span id="local-6989586621679117297"><span id="local-6989586621679117298"><span id="local-6989586621679117299"><span id="local-6989586621679117300"><span id="local-6989586621679117301"><span id="local-6989586621679117302"><span id="local-6989586621679117303"><span id="local-6989586621679117304"><span id="local-6989586621679117305"><span id="local-6989586621679117306"><span id="local-6989586621679117307"><span id="local-6989586621679117308"><span id="local-6989586621679117309"><span id="local-6989586621679117310"><span id="local-6989586621679117311"><span id="local-6989586621679117312"><span id="local-6989586621679117313"><span id="local-6989586621679117314"><span id="local-6989586621679117315"><span id="local-6989586621679117316"><span id="local-6989586621679117317"><span id="local-6989586621679117318"><span id="local-6989586621679117319"><span class="annot"><span class="annottext">TVar BufferSize
TVar TxFlow
TVar EvenStreamTable
TVar OddStreamTable
IORef Bool
IORef BufferSize
IORef (Maybe BufferSize)
IORef RxFlow
IORef Settings
SockAddr
Rate
TQueue Control
TQueue (Output Stream)
DynamicTable
Settings
RoleInfo
Role
role :: Role
roleInfo :: RoleInfo
mySettings :: Settings
myFirstSettings :: IORef Bool
peerSettings :: IORef Settings
oddStreamTable :: TVar OddStreamTable
evenStreamTable :: TVar EvenStreamTable
continued :: IORef (Maybe BufferSize)
myStreamId :: TVar BufferSize
peerStreamId :: IORef BufferSize
outputBufferLimit :: IORef BufferSize
outputQ :: TQueue (Output Stream)
outputQStreamID :: TVar BufferSize
controlQ :: TQueue Control
encodeDynamicTable :: DynamicTable
decodeDynamicTable :: DynamicTable
txFlow :: TVar TxFlow
rxFlow :: IORef RxFlow
pingRate :: Rate
settingsRate :: Rate
emptyFrameRate :: Rate
rstRate :: Rate
mySockAddr :: SockAddr
peerSockAddr :: SockAddr
role :: Context -&gt; Role
roleInfo :: Context -&gt; RoleInfo
mySettings :: Context -&gt; Settings
myFirstSettings :: Context -&gt; IORef Bool
peerSettings :: Context -&gt; IORef Settings
oddStreamTable :: Context -&gt; TVar OddStreamTable
evenStreamTable :: Context -&gt; TVar EvenStreamTable
continued :: Context -&gt; IORef (Maybe BufferSize)
myStreamId :: Context -&gt; TVar BufferSize
peerStreamId :: Context -&gt; IORef BufferSize
outputBufferLimit :: Context -&gt; IORef BufferSize
outputQ :: Context -&gt; TQueue (Output Stream)
outputQStreamID :: Context -&gt; TVar BufferSize
controlQ :: Context -&gt; TQueue Control
encodeDynamicTable :: Context -&gt; DynamicTable
decodeDynamicTable :: Context -&gt; DynamicTable
txFlow :: Context -&gt; TVar TxFlow
rxFlow :: Context -&gt; IORef RxFlow
pingRate :: Context -&gt; Rate
settingsRate :: Context -&gt; Rate
emptyFrameRate :: Context -&gt; Rate
rstRate :: Context -&gt; Rate
mySockAddr :: Context -&gt; SockAddr
peerSockAddr :: Context -&gt; SockAddr
</span><a href="#local-6989586621679117296"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679117344"><span class="annot"><span class="annottext">Buffer
</span><a href="#local-6989586621679117344"><span class="hs-identifier hs-var">buf</span></a></span></span><span> </span><span id="local-6989586621679117345"><span class="annot"><span class="annottext">BufferSize
</span><a href="#local-6989586621679117345"><span class="hs-identifier hs-var">siz</span></a></span></span><span> </span><span id="local-6989586621679117346"><span class="annot"><span class="annottext">TokenHeaderList
</span><a href="#local-6989586621679117346"><span class="hs-identifier hs-var">ths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><span class="annottext">Buffer
-&gt; BufferSize
-&gt; EncodeStrategy
-&gt; Bool
-&gt; DynamicTable
-&gt; TokenHeaderList
-&gt; IO (TokenHeaderList, BufferSize)
</span><a href="Network.HPACK.HeaderBlock.Encode.html#encodeTokenHeader"><span class="hs-identifier hs-var">encodeTokenHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer
</span><a href="#local-6989586621679117344"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="annot"><span class="annottext">BufferSize
</span><a href="#local-6989586621679117345"><span class="hs-identifier hs-var">siz</span></a></span><span> </span><span class="annot"><span class="annottext">EncodeStrategy
</span><a href="Network.HTTP2.H2.HPACK.html#strategy"><span class="hs-identifier hs-var">strategy</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">DynamicTable
</span><a href="#local-6989586621679117310"><span class="hs-identifier hs-var">encodeDynamicTable</span></a></span><span> </span><span class="annot"><span class="annottext">TokenHeaderList
</span><a href="#local-6989586621679117346"><span class="hs-identifier hs-var">ths</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#hpackEncodeHeaderLoop"><span class="hs-identifier hs-type">hpackEncodeHeaderLoop</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Buffer</span></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BufferSize</span></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HPACK.Types.html#TokenHeaderList"><span class="hs-identifier hs-type">TokenHeaderList</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HPACK.Types.html#TokenHeaderList"><span class="hs-identifier hs-type">TokenHeaderList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span id="hpackEncodeHeaderLoop"><span class="annot"><span class="annottext">hpackEncodeHeaderLoop :: Context
-&gt; Buffer
-&gt; BufferSize
-&gt; TokenHeaderList
-&gt; IO (TokenHeaderList, BufferSize)
</span><a href="Network.HTTP2.H2.HPACK.html#hpackEncodeHeaderLoop"><span class="hs-identifier hs-var hs-var">hpackEncodeHeaderLoop</span></a></span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span class="hs-special">{</span><span id="local-6989586621679117348"><span id="local-6989586621679117349"><span id="local-6989586621679117350"><span id="local-6989586621679117351"><span id="local-6989586621679117352"><span id="local-6989586621679117353"><span id="local-6989586621679117354"><span id="local-6989586621679117355"><span id="local-6989586621679117356"><span id="local-6989586621679117357"><span id="local-6989586621679117358"><span id="local-6989586621679117359"><span id="local-6989586621679117360"><span id="local-6989586621679117361"><span id="local-6989586621679117362"><span id="local-6989586621679117363"><span id="local-6989586621679117364"><span id="local-6989586621679117365"><span id="local-6989586621679117366"><span id="local-6989586621679117367"><span id="local-6989586621679117368"><span id="local-6989586621679117369"><span id="local-6989586621679117370"><span id="local-6989586621679117371"><span class="annot"><span class="annottext">TVar BufferSize
TVar TxFlow
TVar EvenStreamTable
TVar OddStreamTable
IORef Bool
IORef BufferSize
IORef (Maybe BufferSize)
IORef RxFlow
IORef Settings
SockAddr
Rate
TQueue Control
TQueue (Output Stream)
DynamicTable
Settings
RoleInfo
Role
role :: Context -&gt; Role
roleInfo :: Context -&gt; RoleInfo
mySettings :: Context -&gt; Settings
myFirstSettings :: Context -&gt; IORef Bool
peerSettings :: Context -&gt; IORef Settings
oddStreamTable :: Context -&gt; TVar OddStreamTable
evenStreamTable :: Context -&gt; TVar EvenStreamTable
continued :: Context -&gt; IORef (Maybe BufferSize)
myStreamId :: Context -&gt; TVar BufferSize
peerStreamId :: Context -&gt; IORef BufferSize
outputBufferLimit :: Context -&gt; IORef BufferSize
outputQ :: Context -&gt; TQueue (Output Stream)
outputQStreamID :: Context -&gt; TVar BufferSize
controlQ :: Context -&gt; TQueue Control
encodeDynamicTable :: Context -&gt; DynamicTable
decodeDynamicTable :: Context -&gt; DynamicTable
txFlow :: Context -&gt; TVar TxFlow
rxFlow :: Context -&gt; IORef RxFlow
pingRate :: Context -&gt; Rate
settingsRate :: Context -&gt; Rate
emptyFrameRate :: Context -&gt; Rate
rstRate :: Context -&gt; Rate
mySockAddr :: Context -&gt; SockAddr
peerSockAddr :: Context -&gt; SockAddr
role :: Role
roleInfo :: RoleInfo
mySettings :: Settings
myFirstSettings :: IORef Bool
peerSettings :: IORef Settings
oddStreamTable :: TVar OddStreamTable
evenStreamTable :: TVar EvenStreamTable
continued :: IORef (Maybe BufferSize)
myStreamId :: TVar BufferSize
peerStreamId :: IORef BufferSize
outputBufferLimit :: IORef BufferSize
outputQ :: TQueue (Output Stream)
outputQStreamID :: TVar BufferSize
controlQ :: TQueue Control
encodeDynamicTable :: DynamicTable
decodeDynamicTable :: DynamicTable
txFlow :: TVar TxFlow
rxFlow :: IORef RxFlow
pingRate :: Rate
settingsRate :: Rate
emptyFrameRate :: Rate
rstRate :: Rate
mySockAddr :: SockAddr
peerSockAddr :: SockAddr
</span><a href="Network.HTTP2.H2.Context.html#role"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679117372"><span class="annot"><span class="annottext">Buffer
</span><a href="#local-6989586621679117372"><span class="hs-identifier hs-var">buf</span></a></span></span><span> </span><span id="local-6989586621679117373"><span class="annot"><span class="annottext">BufferSize
</span><a href="#local-6989586621679117373"><span class="hs-identifier hs-var">siz</span></a></span></span><span> </span><span id="local-6989586621679117374"><span class="annot"><span class="annottext">TokenHeaderList
</span><a href="#local-6989586621679117374"><span class="hs-identifier hs-var">hs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><span class="annottext">Buffer
-&gt; BufferSize
-&gt; EncodeStrategy
-&gt; Bool
-&gt; DynamicTable
-&gt; TokenHeaderList
-&gt; IO (TokenHeaderList, BufferSize)
</span><a href="Network.HPACK.HeaderBlock.Encode.html#encodeTokenHeader"><span class="hs-identifier hs-var">encodeTokenHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer
</span><a href="#local-6989586621679117372"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="annot"><span class="annottext">BufferSize
</span><a href="#local-6989586621679117373"><span class="hs-identifier hs-var">siz</span></a></span><span> </span><span class="annot"><span class="annottext">EncodeStrategy
</span><a href="Network.HTTP2.H2.HPACK.html#strategy"><span class="hs-identifier hs-var">strategy</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">DynamicTable
</span><a href="#local-6989586621679117362"><span class="hs-identifier hs-var">encodeDynamicTable</span></a></span><span> </span><span class="annot"><span class="annottext">TokenHeaderList
</span><a href="#local-6989586621679117374"><span class="hs-identifier hs-var">hs</span></a></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#hpackDecodeHeader"><span class="hs-identifier hs-type">hpackDecodeHeader</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#HeaderBlockFragment"><span class="hs-identifier hs-type">HeaderBlockFragment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#StreamId"><span class="hs-identifier hs-type">StreamId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.HPACK.HeaderBlock.Decode.html#HeaderTable"><span class="hs-identifier hs-type">HeaderTable</span></a></span><span>
</span><span id="line-75"></span><span id="hpackDecodeHeader"><span class="annot"><span class="annottext">hpackDecodeHeader :: ByteString -&gt; BufferSize -&gt; Context -&gt; IO HeaderTable
</span><a href="Network.HTTP2.H2.HPACK.html#hpackDecodeHeader"><span class="hs-identifier hs-var hs-var">hpackDecodeHeader</span></a></span></span><span> </span><span id="local-6989586621679117377"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679117377"><span class="hs-identifier hs-var">hdrblk</span></a></span></span><span> </span><span id="local-6989586621679117378"><span class="annot"><span class="annottext">BufferSize
</span><a href="#local-6989586621679117378"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span id="local-6989586621679117379"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679117379"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-76"></span><span>    </span><span id="local-6989586621679117380"><span class="annot"><span class="annottext">tbl :: HeaderTable
</span><a href="#local-6989586621679117380"><span class="hs-identifier hs-var">tbl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenHeaderList
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679117381"><span class="annot"><span class="annottext">ValueTable
</span><a href="#local-6989586621679117381"><span class="hs-identifier hs-var">vt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; BufferSize -&gt; Context -&gt; IO HeaderTable
</span><a href="Network.HTTP2.H2.HPACK.html#hpackDecodeTrailer"><span class="hs-identifier hs-var">hpackDecodeTrailer</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679117377"><span class="hs-identifier hs-var">hdrblk</span></a></span><span> </span><span class="annot"><span class="annottext">BufferSize
</span><a href="#local-6989586621679117378"><span class="hs-identifier hs-var">sid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679117379"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Context -&gt; Bool
</span><a href="Network.HTTP2.H2.Context.html#isClient"><span class="hs-identifier hs-var">isClient</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679117379"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">ValueTable -&gt; Bool
</span><a href="Network.HTTP2.H2.HPACK.html#checkRequestHeader"><span class="hs-identifier hs-var">checkRequestHeader</span></a></span><span> </span><span class="annot"><span class="annottext">ValueTable
</span><a href="#local-6989586621679117381"><span class="hs-identifier hs-var">vt</span></a></span><span>
</span><span id="line-78"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HeaderTable -&gt; IO HeaderTable
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HeaderTable
</span><a href="#local-6989586621679117380"><span class="hs-identifier hs-var">tbl</span></a></span><span>
</span><span id="line-79"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HTTP2Error -&gt; IO HeaderTable
forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">E.throwIO</span></span><span> </span><span class="annot"><span class="annottext">(HTTP2Error -&gt; IO HeaderTable) -&gt; HTTP2Error -&gt; IO HeaderTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorCode -&gt; BufferSize -&gt; ReasonPhrase -&gt; HTTP2Error
</span><a href="Network.HTTP2.H2.Types.html#StreamErrorIsSent"><span class="hs-identifier hs-var">StreamErrorIsSent</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="Network.HTTP2.Frame.Types.html#ProtocolError"><span class="hs-identifier hs-var">ProtocolError</span></a></span><span> </span><span class="annot"><span class="annottext">BufferSize
</span><a href="#local-6989586621679117378"><span class="hs-identifier hs-var">sid</span></a></span><span> </span><span class="annot"><span class="annottext">ReasonPhrase
</span><span class="hs-string">&quot;illegal header&quot;</span></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#hpackDecodeTrailer"><span class="hs-identifier hs-type">hpackDecodeTrailer</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#HeaderBlockFragment"><span class="hs-identifier hs-type">HeaderBlockFragment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#StreamId"><span class="hs-identifier hs-type">StreamId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.HPACK.HeaderBlock.Decode.html#HeaderTable"><span class="hs-identifier hs-type">HeaderTable</span></a></span><span>
</span><span id="line-83"></span><span id="hpackDecodeTrailer"><span class="annot"><span class="annottext">hpackDecodeTrailer :: ByteString -&gt; BufferSize -&gt; Context -&gt; IO HeaderTable
</span><a href="Network.HTTP2.H2.HPACK.html#hpackDecodeTrailer"><span class="hs-identifier hs-var hs-var">hpackDecodeTrailer</span></a></span></span><span> </span><span id="local-6989586621679117388"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679117388"><span class="hs-identifier hs-var">hdrblk</span></a></span></span><span> </span><span id="local-6989586621679117389"><span class="annot"><span class="annottext">BufferSize
</span><a href="#local-6989586621679117389"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span class="hs-special">{</span><span id="local-6989586621679117390"><span id="local-6989586621679117391"><span id="local-6989586621679117392"><span id="local-6989586621679117393"><span id="local-6989586621679117394"><span id="local-6989586621679117395"><span id="local-6989586621679117396"><span id="local-6989586621679117397"><span id="local-6989586621679117398"><span id="local-6989586621679117399"><span id="local-6989586621679117400"><span id="local-6989586621679117401"><span id="local-6989586621679117402"><span id="local-6989586621679117403"><span id="local-6989586621679117404"><span id="local-6989586621679117405"><span id="local-6989586621679117406"><span id="local-6989586621679117407"><span id="local-6989586621679117408"><span id="local-6989586621679117409"><span id="local-6989586621679117410"><span id="local-6989586621679117411"><span id="local-6989586621679117412"><span id="local-6989586621679117413"><span class="annot"><span class="annottext">TVar BufferSize
TVar TxFlow
TVar EvenStreamTable
TVar OddStreamTable
IORef Bool
IORef BufferSize
IORef (Maybe BufferSize)
IORef RxFlow
IORef Settings
SockAddr
Rate
TQueue Control
TQueue (Output Stream)
DynamicTable
Settings
RoleInfo
Role
role :: Context -&gt; Role
roleInfo :: Context -&gt; RoleInfo
mySettings :: Context -&gt; Settings
myFirstSettings :: Context -&gt; IORef Bool
peerSettings :: Context -&gt; IORef Settings
oddStreamTable :: Context -&gt; TVar OddStreamTable
evenStreamTable :: Context -&gt; TVar EvenStreamTable
continued :: Context -&gt; IORef (Maybe BufferSize)
myStreamId :: Context -&gt; TVar BufferSize
peerStreamId :: Context -&gt; IORef BufferSize
outputBufferLimit :: Context -&gt; IORef BufferSize
outputQ :: Context -&gt; TQueue (Output Stream)
outputQStreamID :: Context -&gt; TVar BufferSize
controlQ :: Context -&gt; TQueue Control
encodeDynamicTable :: Context -&gt; DynamicTable
decodeDynamicTable :: Context -&gt; DynamicTable
txFlow :: Context -&gt; TVar TxFlow
rxFlow :: Context -&gt; IORef RxFlow
pingRate :: Context -&gt; Rate
settingsRate :: Context -&gt; Rate
emptyFrameRate :: Context -&gt; Rate
rstRate :: Context -&gt; Rate
mySockAddr :: Context -&gt; SockAddr
peerSockAddr :: Context -&gt; SockAddr
role :: Role
roleInfo :: RoleInfo
mySettings :: Settings
myFirstSettings :: IORef Bool
peerSettings :: IORef Settings
oddStreamTable :: TVar OddStreamTable
evenStreamTable :: TVar EvenStreamTable
continued :: IORef (Maybe BufferSize)
myStreamId :: TVar BufferSize
peerStreamId :: IORef BufferSize
outputBufferLimit :: IORef BufferSize
outputQ :: TQueue (Output Stream)
outputQStreamID :: TVar BufferSize
controlQ :: TQueue Control
encodeDynamicTable :: DynamicTable
decodeDynamicTable :: DynamicTable
txFlow :: TVar TxFlow
rxFlow :: IORef RxFlow
pingRate :: Rate
settingsRate :: Rate
emptyFrameRate :: Rate
rstRate :: Rate
mySockAddr :: SockAddr
peerSockAddr :: SockAddr
</span><a href="Network.HTTP2.H2.Context.html#role"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynamicTable -&gt; ByteString -&gt; IO HeaderTable
</span><a href="Network.HPACK.HeaderBlock.Decode.html#decodeTokenHeader"><span class="hs-identifier hs-var">decodeTokenHeader</span></a></span><span> </span><span class="annot"><span class="annottext">DynamicTable
</span><a href="#local-6989586621679117405"><span class="hs-identifier hs-var">decodeDynamicTable</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679117388"><span class="hs-identifier hs-var">hdrblk</span></a></span><span> </span><span class="annot"><span class="annottext">IO HeaderTable -&gt; (DecodeError -&gt; IO HeaderTable) -&gt; IO HeaderTable
forall e a. Exception e =&gt; IO a -&gt; (e -&gt; IO a) -&gt; IO a
</span><span class="hs-operator hs-var">`E.catch`</span></span><span> </span><span class="annot"><span class="annottext">DecodeError -&gt; IO HeaderTable
forall {a}. DecodeError -&gt; IO a
</span><a href="#local-6989586621679117416"><span class="hs-identifier hs-var">handl</span></a></span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-85"></span><span>    </span><span id="local-6989586621679117416"><span class="annot"><span class="annottext">handl :: DecodeError -&gt; IO a
</span><a href="#local-6989586621679117416"><span class="hs-identifier hs-var hs-var">handl</span></a></span></span><span> </span><span class="annot"><span class="annottext">DecodeError
</span><a href="Network.HPACK.Types.html#IllegalHeaderName"><span class="hs-identifier hs-var">IllegalHeaderName</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-86"></span><span>        </span><span class="annot"><span class="annottext">HTTP2Error -&gt; IO a
forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">E.throwIO</span></span><span> </span><span class="annot"><span class="annottext">(HTTP2Error -&gt; IO a) -&gt; HTTP2Error -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorCode -&gt; BufferSize -&gt; ReasonPhrase -&gt; HTTP2Error
</span><a href="Network.HTTP2.H2.Types.html#StreamErrorIsSent"><span class="hs-identifier hs-var">StreamErrorIsSent</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="Network.HTTP2.Frame.Types.html#ProtocolError"><span class="hs-identifier hs-var">ProtocolError</span></a></span><span> </span><span class="annot"><span class="annottext">BufferSize
</span><a href="#local-6989586621679117389"><span class="hs-identifier hs-var">sid</span></a></span><span> </span><span class="annot"><span class="annottext">ReasonPhrase
</span><span class="hs-string">&quot;illegal trailer&quot;</span></span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><a href="#local-6989586621679117416"><span class="hs-identifier hs-var">handl</span></a></span><span> </span><span id="local-6989586621679117421"><span class="annot"><span class="annottext">DecodeError
</span><a href="#local-6989586621679117421"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-88"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117425"><span class="annot"><span class="annottext">msg :: ReasonPhrase
</span><a href="#local-6989586621679117425"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ReasonPhrase
forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ReasonPhrase) -&gt; String -&gt; ReasonPhrase
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DecodeError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">DecodeError
</span><a href="#local-6989586621679117421"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-89"></span><span>        </span><span class="annot"><span class="annottext">HTTP2Error -&gt; IO a
forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">E.throwIO</span></span><span> </span><span class="annot"><span class="annottext">(HTTP2Error -&gt; IO a) -&gt; HTTP2Error -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorCode -&gt; BufferSize -&gt; ReasonPhrase -&gt; HTTP2Error
</span><a href="Network.HTTP2.H2.Types.html#StreamErrorIsSent"><span class="hs-identifier hs-var">StreamErrorIsSent</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="Network.HTTP2.Frame.Types.html#CompressionError"><span class="hs-identifier hs-var">CompressionError</span></a></span><span> </span><span class="annot"><span class="annottext">BufferSize
</span><a href="#local-6989586621679117389"><span class="hs-identifier hs-var">sid</span></a></span><span> </span><span class="annot"><span class="annottext">ReasonPhrase
</span><a href="#local-6989586621679117425"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#checkRequestHeader"><span class="hs-pragma hs-type">checkRequestHeader</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-92"></span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#checkRequestHeader"><span class="hs-identifier hs-type">checkRequestHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HPACK.HeaderBlock.Decode.html#ValueTable"><span class="hs-identifier hs-type">ValueTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-93"></span><span id="checkRequestHeader"><span class="annot"><span class="annottext">checkRequestHeader :: ValueTable -&gt; Bool
</span><a href="Network.HTTP2.H2.HPACK.html#checkRequestHeader"><span class="hs-identifier hs-var hs-var">checkRequestHeader</span></a></span></span><span> </span><span id="local-6989586621679117428"><span class="annot"><span class="annottext">ValueTable
</span><a href="#local-6989586621679117428"><span class="hs-identifier hs-var">reqvt</span></a></span></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; (ByteString -&gt; Bool) -&gt; Bool
forall a. Maybe a -&gt; (a -&gt; Bool) -&gt; Bool
</span><a href="Network.HTTP2.H2.HPACK.html#just"><span class="hs-identifier hs-var">just</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679117429"><span class="hs-identifier hs-var">mMethod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;CONNECT&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679117431"><span class="hs-identifier hs-var">mPath</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679117433"><span class="hs-identifier hs-var">mScheme</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679117435"><span class="hs-identifier hs-var">mStatus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679117429"><span class="hs-identifier hs-var">mMethod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679117433"><span class="hs-identifier hs-var">mScheme</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679117431"><span class="hs-identifier hs-var">mPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679117431"><span class="hs-identifier hs-var">mPath</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; Maybe ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679117436"><span class="hs-identifier hs-var">mConnection</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; (ByteString -&gt; Bool) -&gt; Bool
forall a. Maybe a -&gt; (a -&gt; Bool) -&gt; Bool
</span><a href="Network.HTTP2.H2.HPACK.html#just"><span class="hs-identifier hs-var">just</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679117437"><span class="hs-identifier hs-var">mTE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;trailers&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; Maybe ByteString -&gt; Bool
</span><a href="Network.HTTP2.H2.HPACK.html#checkAuth"><span class="hs-identifier hs-var">checkAuth</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679117440"><span class="hs-identifier hs-var">mAuthority</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679117441"><span class="hs-identifier hs-var">mHost</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-104"></span><span>    </span><span id="local-6989586621679117435"><span class="annot"><span class="annottext">mStatus :: Maybe ByteString
</span><a href="#local-6989586621679117435"><span class="hs-identifier hs-var hs-var">mStatus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; ValueTable -&gt; Maybe ByteString
</span><a href="Network.HPACK.HeaderBlock.Decode.html#getHeaderValue"><span class="hs-identifier hs-var">getHeaderValue</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="Network.HPACK.Token.html#tokenStatus"><span class="hs-identifier hs-var">tokenStatus</span></a></span><span> </span><span class="annot"><span class="annottext">ValueTable
</span><a href="#local-6989586621679117428"><span class="hs-identifier hs-var">reqvt</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span id="local-6989586621679117433"><span class="annot"><span class="annottext">mScheme :: Maybe ByteString
</span><a href="#local-6989586621679117433"><span class="hs-identifier hs-var hs-var">mScheme</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; ValueTable -&gt; Maybe ByteString
</span><a href="Network.HPACK.HeaderBlock.Decode.html#getHeaderValue"><span class="hs-identifier hs-var">getHeaderValue</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="Network.HPACK.Token.html#tokenScheme"><span class="hs-identifier hs-var">tokenScheme</span></a></span><span> </span><span class="annot"><span class="annottext">ValueTable
</span><a href="#local-6989586621679117428"><span class="hs-identifier hs-var">reqvt</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span id="local-6989586621679117431"><span class="annot"><span class="annottext">mPath :: Maybe ByteString
</span><a href="#local-6989586621679117431"><span class="hs-identifier hs-var hs-var">mPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; ValueTable -&gt; Maybe ByteString
</span><a href="Network.HPACK.HeaderBlock.Decode.html#getHeaderValue"><span class="hs-identifier hs-var">getHeaderValue</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="Network.HPACK.Token.html#tokenPath"><span class="hs-identifier hs-var">tokenPath</span></a></span><span> </span><span class="annot"><span class="annottext">ValueTable
</span><a href="#local-6989586621679117428"><span class="hs-identifier hs-var">reqvt</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span id="local-6989586621679117429"><span class="annot"><span class="annottext">mMethod :: Maybe ByteString
</span><a href="#local-6989586621679117429"><span class="hs-identifier hs-var hs-var">mMethod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; ValueTable -&gt; Maybe ByteString
</span><a href="Network.HPACK.HeaderBlock.Decode.html#getHeaderValue"><span class="hs-identifier hs-var">getHeaderValue</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="Network.HPACK.Token.html#tokenMethod"><span class="hs-identifier hs-var">tokenMethod</span></a></span><span> </span><span class="annot"><span class="annottext">ValueTable
</span><a href="#local-6989586621679117428"><span class="hs-identifier hs-var">reqvt</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span id="local-6989586621679117436"><span class="annot"><span class="annottext">mConnection :: Maybe ByteString
</span><a href="#local-6989586621679117436"><span class="hs-identifier hs-var hs-var">mConnection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; ValueTable -&gt; Maybe ByteString
</span><a href="Network.HPACK.HeaderBlock.Decode.html#getHeaderValue"><span class="hs-identifier hs-var">getHeaderValue</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="Network.HPACK.Token.html#tokenConnection"><span class="hs-identifier hs-var">tokenConnection</span></a></span><span> </span><span class="annot"><span class="annottext">ValueTable
</span><a href="#local-6989586621679117428"><span class="hs-identifier hs-var">reqvt</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span id="local-6989586621679117437"><span class="annot"><span class="annottext">mTE :: Maybe ByteString
</span><a href="#local-6989586621679117437"><span class="hs-identifier hs-var hs-var">mTE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; ValueTable -&gt; Maybe ByteString
</span><a href="Network.HPACK.HeaderBlock.Decode.html#getHeaderValue"><span class="hs-identifier hs-var">getHeaderValue</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="Network.HPACK.Token.html#tokenTE"><span class="hs-identifier hs-var">tokenTE</span></a></span><span> </span><span class="annot"><span class="annottext">ValueTable
</span><a href="#local-6989586621679117428"><span class="hs-identifier hs-var">reqvt</span></a></span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621679117440"><span class="annot"><span class="annottext">mAuthority :: Maybe ByteString
</span><a href="#local-6989586621679117440"><span class="hs-identifier hs-var hs-var">mAuthority</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; ValueTable -&gt; Maybe ByteString
</span><a href="Network.HPACK.HeaderBlock.Decode.html#getHeaderValue"><span class="hs-identifier hs-var">getHeaderValue</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="Network.HPACK.Token.html#tokenAuthority"><span class="hs-identifier hs-var">tokenAuthority</span></a></span><span> </span><span class="annot"><span class="annottext">ValueTable
</span><a href="#local-6989586621679117428"><span class="hs-identifier hs-var">reqvt</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span id="local-6989586621679117441"><span class="annot"><span class="annottext">mHost :: Maybe ByteString
</span><a href="#local-6989586621679117441"><span class="hs-identifier hs-var hs-var">mHost</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; ValueTable -&gt; Maybe ByteString
</span><a href="Network.HPACK.HeaderBlock.Decode.html#getHeaderValue"><span class="hs-identifier hs-var">getHeaderValue</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="Network.HPACK.Token.html#tokenHost"><span class="hs-identifier hs-var">tokenHost</span></a></span><span> </span><span class="annot"><span class="annottext">ValueTable
</span><a href="#local-6989586621679117428"><span class="hs-identifier hs-var">reqvt</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#checkAuth"><span class="hs-identifier hs-type">checkAuth</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-114"></span><span id="checkAuth"><span class="annot"><span class="annottext">checkAuth :: Maybe ByteString -&gt; Maybe ByteString -&gt; Bool
</span><a href="Network.HTTP2.H2.HPACK.html#checkAuth"><span class="hs-identifier hs-var hs-var">checkAuth</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-115"></span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#checkAuth"><span class="hs-identifier hs-var">checkAuth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679117451"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679117451"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679117452"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679117452"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679117451"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679117452"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-116"></span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#checkAuth"><span class="hs-identifier hs-var">checkAuth</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#just"><span class="hs-pragma hs-type">just</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-119"></span><span id="local-6989586621679117242"><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#just"><span class="hs-identifier hs-type">just</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679117242"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679117242"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-120"></span><span id="just"><span class="annot"><span class="annottext">just :: forall a. Maybe a -&gt; (a -&gt; Bool) -&gt; Bool
</span><a href="Network.HTTP2.H2.HPACK.html#just"><span class="hs-identifier hs-var hs-var">just</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-121"></span><span class="annot"><a href="Network.HTTP2.H2.HPACK.html#just"><span class="hs-identifier hs-var">just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679117453"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679117453"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679117454"><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679117454"><span class="hs-identifier hs-var">p</span></a></span></span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679117454"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679117453"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-124"></span></pre></body></html>