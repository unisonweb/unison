<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.HTTP2.H2.StreamTable</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-4"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Types</span></span><span>
</span><span id="line-5"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier">OddStreamTable</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#emptyOddStreamTable"><span class="hs-identifier">emptyOddStreamTable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier">EvenStreamTable</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#emptyEvenStreamTable"><span class="hs-identifier">emptyEvenStreamTable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Odd</span></span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#insertOdd"><span class="hs-identifier">insertOdd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#insertOdd%27"><span class="hs-identifier">insertOdd'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#deleteOdd"><span class="hs-identifier">deleteOdd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#lookupOdd"><span class="hs-identifier">lookupOdd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#getOddConcurrency"><span class="hs-identifier">getOddConcurrency</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#getOddStreams"><span class="hs-identifier">getOddStreams</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#clearOddStreamTable"><span class="hs-identifier">clearOddStreamTable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#waitIncOdd"><span class="hs-identifier">waitIncOdd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Even</span></span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#insertEven"><span class="hs-identifier">insertEven</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#insertEven%27"><span class="hs-identifier">insertEven'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#deleteEven"><span class="hs-identifier">deleteEven</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#lookupEven"><span class="hs-identifier">lookupEven</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#getEvenConcurrency"><span class="hs-identifier">getEvenConcurrency</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#clearEvenStreamTable"><span class="hs-identifier">clearEvenStreamTable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#waitIncEven"><span class="hs-identifier">waitIncEven</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#insertEvenCache"><span class="hs-identifier">insertEvenCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#deleteEvenCache"><span class="hs-identifier">deleteEvenCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#lookupEvenCache"><span class="hs-identifier">lookupEvenCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#getEvenStreams"><span class="hs-identifier">getEvenStreams</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IntMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IntMap</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Control</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">LRUCache</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Network.Control</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LRUCache</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Method</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Imports.html"><span class="hs-identifier">Imports</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html"><span class="hs-identifier">Network.HTTP2.H2.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">data</span><span> </span><span id="OddStreamTable"><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-var">OddStreamTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="OddStreamTable"><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-var">OddStreamTable</span></a></span></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="oddConc"><span class="annot"><span class="annottext">OddStreamTable -&gt; Int
</span><a href="Network.HTTP2.H2.StreamTable.html#oddConc"><span class="hs-identifier hs-var hs-var">oddConc</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="oddTable"><span class="annot"><span class="annottext">OddStreamTable -&gt; IntMap Stream
</span><a href="Network.HTTP2.H2.StreamTable.html#oddTable"><span class="hs-identifier hs-var hs-var">oddTable</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#emptyOddStreamTable"><span class="hs-identifier hs-type">emptyOddStreamTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-type">OddStreamTable</span></a></span><span>
</span><span id="line-54"></span><span id="emptyOddStreamTable"><span class="annot"><span class="annottext">emptyOddStreamTable :: OddStreamTable
</span><a href="Network.HTTP2.H2.StreamTable.html#emptyOddStreamTable"><span class="hs-identifier hs-var hs-var">emptyOddStreamTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntMap Stream -&gt; OddStreamTable
</span><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-var">OddStreamTable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
forall a. IntMap a
</span><span class="hs-identifier hs-var">IntMap.empty</span></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">data</span><span> </span><span id="EvenStreamTable"><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-var">EvenStreamTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="EvenStreamTable"><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-var">EvenStreamTable</span></a></span></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="evenConc"><span class="annot"><span class="annottext">EvenStreamTable -&gt; Int
</span><a href="Network.HTTP2.H2.StreamTable.html#evenConc"><span class="hs-identifier hs-var hs-var">evenConc</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="evenTable"><span class="annot"><span class="annottext">EvenStreamTable -&gt; IntMap Stream
</span><a href="Network.HTTP2.H2.StreamTable.html#evenTable"><span class="hs-identifier hs-var hs-var">evenTable</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Cache must contain Stream instead of StreamId because</span><span>
</span><span id="line-60"></span><span>      </span><span class="hs-comment">-- a Stream is deleted when end-of-stream is received.</span><span>
</span><span id="line-61"></span><span>      </span><span class="hs-comment">-- After that, cache is looked up.</span><span>
</span><span id="line-62"></span><span>      </span><span id="evenCache"><span class="annot"><span class="annottext">EvenStreamTable -&gt; LRUCache (Method, Method) Stream
</span><a href="Network.HTTP2.H2.StreamTable.html#evenCache"><span class="hs-identifier hs-var hs-var">evenCache</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LRUCache</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#emptyEvenStreamTable"><span class="hs-identifier hs-type">emptyEvenStreamTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-type">EvenStreamTable</span></a></span><span>
</span><span id="line-66"></span><span id="emptyEvenStreamTable"><span class="annot"><span class="annottext">emptyEvenStreamTable :: Int -&gt; EvenStreamTable
</span><a href="Network.HTTP2.H2.StreamTable.html#emptyEvenStreamTable"><span class="hs-identifier hs-var hs-var">emptyEvenStreamTable</span></a></span></span><span> </span><span id="local-6989586621679116329"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116329"><span class="hs-identifier hs-var">lim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; IntMap Stream
-&gt; LRUCache (Method, Method) Stream
-&gt; EvenStreamTable
</span><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-var">EvenStreamTable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
forall a. IntMap a
</span><span class="hs-identifier hs-var">IntMap.empty</span></span><span> </span><span class="annot"><span class="annottext">(LRUCache (Method, Method) Stream -&gt; EvenStreamTable)
-&gt; LRUCache (Method, Method) Stream -&gt; EvenStreamTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; LRUCache (Method, Method) Stream
forall k v. Int -&gt; LRUCache k v
</span><span class="hs-identifier hs-var">LRUCache.empty</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116329"><span class="hs-identifier hs-var">lim</span></a></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#insertOdd"><span class="hs-identifier hs-type">insertOdd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-type">OddStreamTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap.Key</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span id="insertOdd"><span class="annot"><span class="annottext">insertOdd :: TVar OddStreamTable -&gt; Int -&gt; Stream -&gt; IO ()
</span><a href="Network.HTTP2.H2.StreamTable.html#insertOdd"><span class="hs-identifier hs-var hs-var">insertOdd</span></a></span></span><span> </span><span id="local-6989586621679116332"><span class="annot"><span class="annottext">TVar OddStreamTable
</span><a href="#local-6989586621679116332"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621679116333"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116333"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679116334"><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679116334"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TVar OddStreamTable -&gt; (OddStreamTable -&gt; OddStreamTable) -&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><span class="hs-identifier hs-var">modifyTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar OddStreamTable
</span><a href="#local-6989586621679116332"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">((OddStreamTable -&gt; OddStreamTable) -&gt; STM ())
-&gt; (OddStreamTable -&gt; OddStreamTable) -&gt; STM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-type">OddStreamTable</span></a></span><span class="hs-special">{</span><span id="local-6989586621679116337"><span id="local-6989586621679116338"><span class="annot"><span class="annottext">Int
IntMap Stream
oddConc :: OddStreamTable -&gt; Int
oddTable :: OddStreamTable -&gt; IntMap Stream
oddConc :: Int
oddTable :: IntMap Stream
</span><a href="Network.HTTP2.H2.StreamTable.html#oddConc"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679116342"><span class="annot"><span class="annottext">oddConc' :: Int
</span><a href="#local-6989586621679116342"><span class="hs-identifier hs-var hs-var">oddConc'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116337"><span class="hs-identifier hs-var">oddConc</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-73"></span><span>        </span><span id="local-6989586621679116344"><span class="annot"><span class="annottext">oddTable' :: IntMap Stream
</span><a href="#local-6989586621679116344"><span class="hs-identifier hs-var hs-var">oddTable'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Stream -&gt; IntMap Stream -&gt; IntMap Stream
forall a. Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IntMap.insert</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116333"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679116334"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116338"><span class="hs-identifier hs-var">oddTable</span></a></span><span>
</span><span id="line-74"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntMap Stream -&gt; OddStreamTable
</span><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-var">OddStreamTable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116342"><span class="hs-identifier hs-var">oddConc'</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116344"><span class="hs-identifier hs-var">oddTable'</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#insertOdd%27"><span class="hs-identifier hs-type">insertOdd'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-type">OddStreamTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap.Key</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span id="insertOdd%27"><span class="annot"><span class="annottext">insertOdd' :: TVar OddStreamTable -&gt; Int -&gt; Stream -&gt; IO ()
</span><a href="Network.HTTP2.H2.StreamTable.html#insertOdd%27"><span class="hs-identifier hs-var hs-var">insertOdd'</span></a></span></span><span> </span><span id="local-6989586621679116346"><span class="annot"><span class="annottext">TVar OddStreamTable
</span><a href="#local-6989586621679116346"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621679116347"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116347"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679116348"><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679116348"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TVar OddStreamTable -&gt; (OddStreamTable -&gt; OddStreamTable) -&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><span class="hs-identifier hs-var">modifyTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar OddStreamTable
</span><a href="#local-6989586621679116346"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">((OddStreamTable -&gt; OddStreamTable) -&gt; STM ())
-&gt; (OddStreamTable -&gt; OddStreamTable) -&gt; STM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-type">OddStreamTable</span></a></span><span class="hs-special">{</span><span id="local-6989586621679116349"><span id="local-6989586621679116350"><span class="annot"><span class="annottext">Int
IntMap Stream
oddConc :: OddStreamTable -&gt; Int
oddTable :: OddStreamTable -&gt; IntMap Stream
oddConc :: Int
oddTable :: IntMap Stream
</span><a href="Network.HTTP2.H2.StreamTable.html#oddConc"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679116351"><span class="annot"><span class="annottext">oddTable' :: IntMap Stream
</span><a href="#local-6989586621679116351"><span class="hs-identifier hs-var hs-var">oddTable'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Stream -&gt; IntMap Stream -&gt; IntMap Stream
forall a. Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IntMap.insert</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116347"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679116348"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116350"><span class="hs-identifier hs-var">oddTable</span></a></span><span>
</span><span id="line-79"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntMap Stream -&gt; OddStreamTable
</span><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-var">OddStreamTable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116349"><span class="hs-identifier hs-var">oddConc</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116351"><span class="hs-identifier hs-var">oddTable'</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#deleteOdd"><span class="hs-identifier hs-type">deleteOdd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-type">OddStreamTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap.Key</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span id="deleteOdd"><span class="annot"><span class="annottext">deleteOdd :: TVar OddStreamTable -&gt; Int -&gt; SomeException -&gt; IO ()
</span><a href="Network.HTTP2.H2.StreamTable.html#deleteOdd"><span class="hs-identifier hs-var hs-var">deleteOdd</span></a></span></span><span> </span><span id="local-6989586621679116352"><span class="annot"><span class="annottext">TVar OddStreamTable
</span><a href="#local-6989586621679116352"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621679116353"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116353"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679116354"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679116354"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-83"></span><span>    </span><span id="local-6989586621679116355"><span class="annot"><span class="annottext">Maybe Stream
</span><a href="#local-6989586621679116355"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STM (Maybe Stream) -&gt; IO (Maybe Stream)
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">STM (Maybe Stream)
</span><a href="#local-6989586621679116356"><span class="hs-identifier hs-var">deleteStream</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Stream
</span><a href="#local-6989586621679116355"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-85"></span><span>        </span><span class="annot"><span class="annottext">Maybe Stream
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Stream was already removed</span><span>
</span><span id="line-86"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679116357"><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679116357"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; IO ())
-&gt; (Either SomeException InpObj -&gt; IO Bool)
-&gt; Either SomeException InpObj
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MVar (Either SomeException InpObj)
-&gt; Either SomeException InpObj -&gt; IO Bool
forall a. MVar a -&gt; a -&gt; IO Bool
</span><span class="hs-identifier hs-var">tryPutMVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream -&gt; MVar (Either SomeException InpObj)
</span><a href="Network.HTTP2.H2.Types.html#streamInput"><span class="hs-identifier hs-var">streamInput</span></a></span><span> </span><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679116357"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either SomeException InpObj -&gt; IO ())
-&gt; Either SomeException InpObj -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Either SomeException InpObj
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679116354"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><a href="#local-6989586621679116356"><span class="hs-identifier hs-type">deleteStream</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>    </span><span id="local-6989586621679116356"><span class="annot"><span class="annottext">deleteStream :: STM (Maybe Stream)
</span><a href="#local-6989586621679116356"><span class="hs-identifier hs-var hs-var">deleteStream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-90"></span><span>        </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-type">OddStreamTable</span></a></span><span class="hs-special">{</span><span id="local-6989586621679116362"><span id="local-6989586621679116363"><span class="annot"><span class="annottext">Int
IntMap Stream
oddConc :: OddStreamTable -&gt; Int
oddTable :: OddStreamTable -&gt; IntMap Stream
oddConc :: Int
oddTable :: IntMap Stream
</span><a href="Network.HTTP2.H2.StreamTable.html#oddConc"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TVar OddStreamTable -&gt; STM OddStreamTable
forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar OddStreamTable
</span><a href="#local-6989586621679116352"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-91"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679116367"><span class="annot"><span class="annottext">oddConc' :: Int
</span><a href="#local-6989586621679116367"><span class="hs-identifier hs-var hs-var">oddConc'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116362"><span class="hs-identifier hs-var">oddConc</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-92"></span><span>            </span><span id="local-6989586621679116368"><span class="annot"><span class="annottext">oddTable' :: IntMap Stream
</span><a href="#local-6989586621679116368"><span class="hs-identifier hs-var hs-var">oddTable'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntMap Stream -&gt; IntMap Stream
forall a. Int -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IntMap.delete</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116353"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116363"><span class="hs-identifier hs-var">oddTable</span></a></span><span>
</span><span id="line-93"></span><span>        </span><span class="annot"><span class="annottext">TVar OddStreamTable -&gt; OddStreamTable -&gt; STM ()
forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar OddStreamTable
</span><a href="#local-6989586621679116352"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">(OddStreamTable -&gt; STM ()) -&gt; OddStreamTable -&gt; STM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntMap Stream -&gt; OddStreamTable
</span><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-var">OddStreamTable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116367"><span class="hs-identifier hs-var">oddConc'</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116368"><span class="hs-identifier hs-var">oddTable'</span></a></span><span>
</span><span id="line-94"></span><span>        </span><span class="annot"><span class="annottext">Maybe Stream -&gt; STM (Maybe Stream)
forall a. a -&gt; STM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Stream -&gt; STM (Maybe Stream))
-&gt; Maybe Stream -&gt; STM (Maybe Stream)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntMap Stream -&gt; Maybe Stream
forall a. Int -&gt; IntMap a -&gt; Maybe a
</span><span class="hs-identifier hs-var">IntMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116353"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116363"><span class="hs-identifier hs-var">oddTable</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#lookupOdd"><span class="hs-identifier hs-type">lookupOdd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-type">OddStreamTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap.Key</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span id="lookupOdd"><span class="annot"><span class="annottext">lookupOdd :: TVar OddStreamTable -&gt; Int -&gt; IO (Maybe Stream)
</span><a href="Network.HTTP2.H2.StreamTable.html#lookupOdd"><span class="hs-identifier hs-var hs-var">lookupOdd</span></a></span></span><span> </span><span id="local-6989586621679116372"><span class="annot"><span class="annottext">TVar OddStreamTable
</span><a href="#local-6989586621679116372"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621679116373"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116373"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntMap Stream -&gt; Maybe Stream
forall a. Int -&gt; IntMap a -&gt; Maybe a
</span><span class="hs-identifier hs-var">IntMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116373"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">(IntMap Stream -&gt; Maybe Stream)
-&gt; (OddStreamTable -&gt; IntMap Stream)
-&gt; OddStreamTable
-&gt; Maybe Stream
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OddStreamTable -&gt; IntMap Stream
</span><a href="Network.HTTP2.H2.StreamTable.html#oddTable"><span class="hs-identifier hs-var">oddTable</span></a></span><span> </span><span class="annot"><span class="annottext">(OddStreamTable -&gt; Maybe Stream)
-&gt; IO OddStreamTable -&gt; IO (Maybe Stream)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TVar OddStreamTable -&gt; IO OddStreamTable
forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar OddStreamTable
</span><a href="#local-6989586621679116372"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#getOddConcurrency"><span class="hs-identifier hs-type">getOddConcurrency</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-type">OddStreamTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-100"></span><span id="getOddConcurrency"><span class="annot"><span class="annottext">getOddConcurrency :: TVar OddStreamTable -&gt; IO Int
</span><a href="Network.HTTP2.H2.StreamTable.html#getOddConcurrency"><span class="hs-identifier hs-var hs-var">getOddConcurrency</span></a></span></span><span> </span><span id="local-6989586621679116376"><span class="annot"><span class="annottext">TVar OddStreamTable
</span><a href="#local-6989586621679116376"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OddStreamTable -&gt; Int
</span><a href="Network.HTTP2.H2.StreamTable.html#oddConc"><span class="hs-identifier hs-var">oddConc</span></a></span><span> </span><span class="annot"><span class="annottext">(OddStreamTable -&gt; Int) -&gt; IO OddStreamTable -&gt; IO Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TVar OddStreamTable -&gt; IO OddStreamTable
forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar OddStreamTable
</span><a href="#local-6989586621679116376"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#getOddStreams"><span class="hs-identifier hs-type">getOddStreams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-type">OddStreamTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IntMap</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span id="getOddStreams"><span class="annot"><span class="annottext">getOddStreams :: TVar OddStreamTable -&gt; IO (IntMap Stream)
</span><a href="Network.HTTP2.H2.StreamTable.html#getOddStreams"><span class="hs-identifier hs-var hs-var">getOddStreams</span></a></span></span><span> </span><span id="local-6989586621679116377"><span class="annot"><span class="annottext">TVar OddStreamTable
</span><a href="#local-6989586621679116377"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OddStreamTable -&gt; IntMap Stream
</span><a href="Network.HTTP2.H2.StreamTable.html#oddTable"><span class="hs-identifier hs-var">oddTable</span></a></span><span> </span><span class="annot"><span class="annottext">(OddStreamTable -&gt; IntMap Stream)
-&gt; IO OddStreamTable -&gt; IO (IntMap Stream)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TVar OddStreamTable -&gt; IO OddStreamTable
forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar OddStreamTable
</span><a href="#local-6989586621679116377"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#clearOddStreamTable"><span class="hs-identifier hs-type">clearOddStreamTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-type">OddStreamTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IntMap</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span id="clearOddStreamTable"><span class="annot"><span class="annottext">clearOddStreamTable :: TVar OddStreamTable -&gt; IO (IntMap Stream)
</span><a href="Network.HTTP2.H2.StreamTable.html#clearOddStreamTable"><span class="hs-identifier hs-var hs-var">clearOddStreamTable</span></a></span></span><span> </span><span id="local-6989586621679116378"><span class="annot"><span class="annottext">TVar OddStreamTable
</span><a href="#local-6989586621679116378"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM (IntMap Stream) -&gt; IO (IntMap Stream)
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM (IntMap Stream) -&gt; IO (IntMap Stream))
-&gt; STM (IntMap Stream) -&gt; IO (IntMap Stream)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-type">OddStreamTable</span></a></span><span class="hs-special">{</span><span id="local-6989586621679116379"><span id="local-6989586621679116380"><span class="annot"><span class="annottext">Int
IntMap Stream
oddConc :: OddStreamTable -&gt; Int
oddTable :: OddStreamTable -&gt; IntMap Stream
oddConc :: Int
oddTable :: IntMap Stream
</span><a href="Network.HTTP2.H2.StreamTable.html#oddConc"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TVar OddStreamTable -&gt; STM OddStreamTable
forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar OddStreamTable
</span><a href="#local-6989586621679116378"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><span class="annottext">TVar OddStreamTable -&gt; OddStreamTable -&gt; STM ()
forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar OddStreamTable
</span><a href="#local-6989586621679116378"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">OddStreamTable
</span><a href="Network.HTTP2.H2.StreamTable.html#emptyOddStreamTable"><span class="hs-identifier hs-var">emptyOddStreamTable</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><span class="annottext">IntMap Stream -&gt; STM (IntMap Stream)
forall a. a -&gt; STM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116380"><span class="hs-identifier hs-var">oddTable</span></a></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#waitIncOdd"><span class="hs-identifier hs-type">waitIncOdd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-type">OddStreamTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span id="waitIncOdd"><span class="annot"><span class="annottext">waitIncOdd :: TVar OddStreamTable -&gt; Int -&gt; STM ()
</span><a href="Network.HTTP2.H2.StreamTable.html#waitIncOdd"><span class="hs-identifier hs-var hs-var">waitIncOdd</span></a></span></span><span> </span><span id="local-6989586621679116381"><span class="annot"><span class="annottext">TVar OddStreamTable
</span><a href="#local-6989586621679116381"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621679116382"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116382"><span class="hs-identifier hs-var">maxConc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-type">OddStreamTable</span></a></span><span class="hs-special">{</span><span id="local-6989586621679116383"><span id="local-6989586621679116384"><span class="annot"><span class="annottext">Int
IntMap Stream
oddConc :: OddStreamTable -&gt; Int
oddTable :: OddStreamTable -&gt; IntMap Stream
oddConc :: Int
oddTable :: IntMap Stream
</span><a href="Network.HTTP2.H2.StreamTable.html#oddConc"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TVar OddStreamTable -&gt; STM OddStreamTable
forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar OddStreamTable
</span><a href="#local-6989586621679116381"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; STM ()
</span><span class="hs-identifier hs-var">check</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116383"><span class="hs-identifier hs-var">oddConc</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116382"><span class="hs-identifier hs-var">maxConc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679116389"><span class="annot"><span class="annottext">oddConc' :: Int
</span><a href="#local-6989586621679116389"><span class="hs-identifier hs-var hs-var">oddConc'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116383"><span class="hs-identifier hs-var">oddConc</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><span class="annottext">TVar OddStreamTable -&gt; OddStreamTable -&gt; STM ()
forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar OddStreamTable
</span><a href="#local-6989586621679116381"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">(OddStreamTable -&gt; STM ()) -&gt; OddStreamTable -&gt; STM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntMap Stream -&gt; OddStreamTable
</span><a href="Network.HTTP2.H2.StreamTable.html#OddStreamTable"><span class="hs-identifier hs-var">OddStreamTable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116389"><span class="hs-identifier hs-var">oddConc'</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116384"><span class="hs-identifier hs-var">oddTable</span></a></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#insertEven"><span class="hs-identifier hs-type">insertEven</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-type">EvenStreamTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap.Key</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span id="insertEven"><span class="annot"><span class="annottext">insertEven :: TVar EvenStreamTable -&gt; Int -&gt; Stream -&gt; IO ()
</span><a href="Network.HTTP2.H2.StreamTable.html#insertEven"><span class="hs-identifier hs-var hs-var">insertEven</span></a></span></span><span> </span><span id="local-6989586621679116390"><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116390"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621679116391"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116391"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679116392"><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679116392"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable
-&gt; (EvenStreamTable -&gt; EvenStreamTable) -&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><span class="hs-identifier hs-var">modifyTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116390"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">((EvenStreamTable -&gt; EvenStreamTable) -&gt; STM ())
-&gt; (EvenStreamTable -&gt; EvenStreamTable) -&gt; STM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-type">EvenStreamTable</span></a></span><span class="hs-special">{</span><span id="local-6989586621679116393"><span id="local-6989586621679116394"><span id="local-6989586621679116395"><span class="annot"><span class="annottext">Int
IntMap Stream
LRUCache (Method, Method) Stream
evenConc :: EvenStreamTable -&gt; Int
evenTable :: EvenStreamTable -&gt; IntMap Stream
evenCache :: EvenStreamTable -&gt; LRUCache (Method, Method) Stream
evenConc :: Int
evenTable :: IntMap Stream
evenCache :: LRUCache (Method, Method) Stream
</span><a href="Network.HTTP2.H2.StreamTable.html#evenConc"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679116398"><span class="annot"><span class="annottext">evenConc' :: Int
</span><a href="#local-6989586621679116398"><span class="hs-identifier hs-var hs-var">evenConc'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116393"><span class="hs-identifier hs-var">evenConc</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-123"></span><span>        </span><span id="local-6989586621679116399"><span class="annot"><span class="annottext">evenTable' :: IntMap Stream
</span><a href="#local-6989586621679116399"><span class="hs-identifier hs-var hs-var">evenTable'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Stream -&gt; IntMap Stream -&gt; IntMap Stream
forall a. Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IntMap.insert</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116391"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679116392"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116394"><span class="hs-identifier hs-var">evenTable</span></a></span><span>
</span><span id="line-124"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; IntMap Stream
-&gt; LRUCache (Method, Method) Stream
-&gt; EvenStreamTable
</span><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-var">EvenStreamTable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116398"><span class="hs-identifier hs-var">evenConc'</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116399"><span class="hs-identifier hs-var">evenTable'</span></a></span><span> </span><span class="annot"><span class="annottext">LRUCache (Method, Method) Stream
</span><a href="#local-6989586621679116395"><span class="hs-identifier hs-var">evenCache</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#insertEven%27"><span class="hs-identifier hs-type">insertEven'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-type">EvenStreamTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap.Key</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span id="insertEven%27"><span class="annot"><span class="annottext">insertEven' :: TVar EvenStreamTable -&gt; Int -&gt; Stream -&gt; IO ()
</span><a href="Network.HTTP2.H2.StreamTable.html#insertEven%27"><span class="hs-identifier hs-var hs-var">insertEven'</span></a></span></span><span> </span><span id="local-6989586621679116400"><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116400"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621679116401"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116401"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679116402"><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679116402"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable
-&gt; (EvenStreamTable -&gt; EvenStreamTable) -&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><span class="hs-identifier hs-var">modifyTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116400"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">((EvenStreamTable -&gt; EvenStreamTable) -&gt; STM ())
-&gt; (EvenStreamTable -&gt; EvenStreamTable) -&gt; STM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-type">EvenStreamTable</span></a></span><span class="hs-special">{</span><span id="local-6989586621679116403"><span id="local-6989586621679116404"><span id="local-6989586621679116405"><span class="annot"><span class="annottext">Int
IntMap Stream
LRUCache (Method, Method) Stream
evenConc :: EvenStreamTable -&gt; Int
evenTable :: EvenStreamTable -&gt; IntMap Stream
evenCache :: EvenStreamTable -&gt; LRUCache (Method, Method) Stream
evenConc :: Int
evenTable :: IntMap Stream
evenCache :: LRUCache (Method, Method) Stream
</span><a href="Network.HTTP2.H2.StreamTable.html#evenConc"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679116406"><span class="annot"><span class="annottext">evenTable' :: IntMap Stream
</span><a href="#local-6989586621679116406"><span class="hs-identifier hs-var hs-var">evenTable'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Stream -&gt; IntMap Stream -&gt; IntMap Stream
forall a. Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IntMap.insert</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116401"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679116402"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116404"><span class="hs-identifier hs-var">evenTable</span></a></span><span>
</span><span id="line-129"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; IntMap Stream
-&gt; LRUCache (Method, Method) Stream
-&gt; EvenStreamTable
</span><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-var">EvenStreamTable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116403"><span class="hs-identifier hs-var">evenConc</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116406"><span class="hs-identifier hs-var">evenTable'</span></a></span><span> </span><span class="annot"><span class="annottext">LRUCache (Method, Method) Stream
</span><a href="#local-6989586621679116405"><span class="hs-identifier hs-var">evenCache</span></a></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#deleteEven"><span class="hs-identifier hs-type">deleteEven</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-type">EvenStreamTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap.Key</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span id="deleteEven"><span class="annot"><span class="annottext">deleteEven :: TVar EvenStreamTable -&gt; Int -&gt; SomeException -&gt; IO ()
</span><a href="Network.HTTP2.H2.StreamTable.html#deleteEven"><span class="hs-identifier hs-var hs-var">deleteEven</span></a></span></span><span> </span><span id="local-6989586621679116407"><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116407"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621679116408"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116408"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679116409"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679116409"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-133"></span><span>    </span><span id="local-6989586621679116410"><span class="annot"><span class="annottext">Maybe Stream
</span><a href="#local-6989586621679116410"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STM (Maybe Stream) -&gt; IO (Maybe Stream)
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">STM (Maybe Stream)
</span><a href="#local-6989586621679116411"><span class="hs-identifier hs-var">deleteStream</span></a></span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Stream
</span><a href="#local-6989586621679116410"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-135"></span><span>        </span><span class="annot"><span class="annottext">Maybe Stream
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Stream was already removed</span><span>
</span><span id="line-136"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679116412"><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679116412"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; IO ())
-&gt; (Either SomeException InpObj -&gt; IO Bool)
-&gt; Either SomeException InpObj
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MVar (Either SomeException InpObj)
-&gt; Either SomeException InpObj -&gt; IO Bool
forall a. MVar a -&gt; a -&gt; IO Bool
</span><span class="hs-identifier hs-var">tryPutMVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream -&gt; MVar (Either SomeException InpObj)
</span><a href="Network.HTTP2.H2.Types.html#streamInput"><span class="hs-identifier hs-var">streamInput</span></a></span><span> </span><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679116412"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either SomeException InpObj -&gt; IO ())
-&gt; Either SomeException InpObj -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Either SomeException InpObj
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679116409"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><a href="#local-6989586621679116411"><span class="hs-identifier hs-type">deleteStream</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>    </span><span id="local-6989586621679116411"><span class="annot"><span class="annottext">deleteStream :: STM (Maybe Stream)
</span><a href="#local-6989586621679116411"><span class="hs-identifier hs-var hs-var">deleteStream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-140"></span><span>        </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-type">EvenStreamTable</span></a></span><span class="hs-special">{</span><span id="local-6989586621679116413"><span id="local-6989586621679116414"><span id="local-6989586621679116415"><span class="annot"><span class="annottext">Int
IntMap Stream
LRUCache (Method, Method) Stream
evenConc :: EvenStreamTable -&gt; Int
evenTable :: EvenStreamTable -&gt; IntMap Stream
evenCache :: EvenStreamTable -&gt; LRUCache (Method, Method) Stream
evenConc :: Int
evenTable :: IntMap Stream
evenCache :: LRUCache (Method, Method) Stream
</span><a href="Network.HTTP2.H2.StreamTable.html#evenConc"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable -&gt; STM EvenStreamTable
forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116407"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-141"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679116418"><span class="annot"><span class="annottext">evenConc' :: Int
</span><a href="#local-6989586621679116418"><span class="hs-identifier hs-var hs-var">evenConc'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116413"><span class="hs-identifier hs-var">evenConc</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-142"></span><span>            </span><span id="local-6989586621679116419"><span class="annot"><span class="annottext">evenTable' :: IntMap Stream
</span><a href="#local-6989586621679116419"><span class="hs-identifier hs-var hs-var">evenTable'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntMap Stream -&gt; IntMap Stream
forall a. Int -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IntMap.delete</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116408"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116414"><span class="hs-identifier hs-var">evenTable</span></a></span><span>
</span><span id="line-143"></span><span>        </span><span class="annot"><span class="annottext">TVar EvenStreamTable -&gt; EvenStreamTable -&gt; STM ()
forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116407"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">(EvenStreamTable -&gt; STM ()) -&gt; EvenStreamTable -&gt; STM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; IntMap Stream
-&gt; LRUCache (Method, Method) Stream
-&gt; EvenStreamTable
</span><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-var">EvenStreamTable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116418"><span class="hs-identifier hs-var">evenConc'</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116419"><span class="hs-identifier hs-var">evenTable'</span></a></span><span> </span><span class="annot"><span class="annottext">LRUCache (Method, Method) Stream
</span><a href="#local-6989586621679116415"><span class="hs-identifier hs-var">evenCache</span></a></span><span>
</span><span id="line-144"></span><span>        </span><span class="annot"><span class="annottext">Maybe Stream -&gt; STM (Maybe Stream)
forall a. a -&gt; STM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Stream -&gt; STM (Maybe Stream))
-&gt; Maybe Stream -&gt; STM (Maybe Stream)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntMap Stream -&gt; Maybe Stream
forall a. Int -&gt; IntMap a -&gt; Maybe a
</span><span class="hs-identifier hs-var">IntMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116408"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116414"><span class="hs-identifier hs-var">evenTable</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#lookupEven"><span class="hs-identifier hs-type">lookupEven</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-type">EvenStreamTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap.Key</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span id="lookupEven"><span class="annot"><span class="annottext">lookupEven :: TVar EvenStreamTable -&gt; Int -&gt; IO (Maybe Stream)
</span><a href="Network.HTTP2.H2.StreamTable.html#lookupEven"><span class="hs-identifier hs-var hs-var">lookupEven</span></a></span></span><span> </span><span id="local-6989586621679116420"><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116420"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621679116421"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116421"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntMap Stream -&gt; Maybe Stream
forall a. Int -&gt; IntMap a -&gt; Maybe a
</span><span class="hs-identifier hs-var">IntMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116421"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">(IntMap Stream -&gt; Maybe Stream)
-&gt; (EvenStreamTable -&gt; IntMap Stream)
-&gt; EvenStreamTable
-&gt; Maybe Stream
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EvenStreamTable -&gt; IntMap Stream
</span><a href="Network.HTTP2.H2.StreamTable.html#evenTable"><span class="hs-identifier hs-var">evenTable</span></a></span><span> </span><span class="annot"><span class="annottext">(EvenStreamTable -&gt; Maybe Stream)
-&gt; IO EvenStreamTable -&gt; IO (Maybe Stream)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable -&gt; IO EvenStreamTable
forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116420"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#getEvenConcurrency"><span class="hs-identifier hs-type">getEvenConcurrency</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-type">EvenStreamTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-150"></span><span id="getEvenConcurrency"><span class="annot"><span class="annottext">getEvenConcurrency :: TVar EvenStreamTable -&gt; IO Int
</span><a href="Network.HTTP2.H2.StreamTable.html#getEvenConcurrency"><span class="hs-identifier hs-var hs-var">getEvenConcurrency</span></a></span></span><span> </span><span id="local-6989586621679116422"><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116422"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvenStreamTable -&gt; Int
</span><a href="Network.HTTP2.H2.StreamTable.html#evenConc"><span class="hs-identifier hs-var">evenConc</span></a></span><span> </span><span class="annot"><span class="annottext">(EvenStreamTable -&gt; Int) -&gt; IO EvenStreamTable -&gt; IO Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable -&gt; IO EvenStreamTable
forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116422"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#clearEvenStreamTable"><span class="hs-identifier hs-type">clearEvenStreamTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-type">EvenStreamTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IntMap</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span id="clearEvenStreamTable"><span class="annot"><span class="annottext">clearEvenStreamTable :: TVar EvenStreamTable -&gt; IO (IntMap Stream)
</span><a href="Network.HTTP2.H2.StreamTable.html#clearEvenStreamTable"><span class="hs-identifier hs-var hs-var">clearEvenStreamTable</span></a></span></span><span> </span><span id="local-6989586621679116423"><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116423"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM (IntMap Stream) -&gt; IO (IntMap Stream)
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM (IntMap Stream) -&gt; IO (IntMap Stream))
-&gt; STM (IntMap Stream) -&gt; IO (IntMap Stream)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-154"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-type">EvenStreamTable</span></a></span><span class="hs-special">{</span><span id="local-6989586621679116424"><span id="local-6989586621679116425"><span id="local-6989586621679116426"><span class="annot"><span class="annottext">Int
IntMap Stream
LRUCache (Method, Method) Stream
evenConc :: EvenStreamTable -&gt; Int
evenTable :: EvenStreamTable -&gt; IntMap Stream
evenCache :: EvenStreamTable -&gt; LRUCache (Method, Method) Stream
evenConc :: Int
evenTable :: IntMap Stream
evenCache :: LRUCache (Method, Method) Stream
</span><a href="Network.HTTP2.H2.StreamTable.html#evenConc"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable -&gt; STM EvenStreamTable
forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116423"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><span class="annottext">TVar EvenStreamTable -&gt; EvenStreamTable -&gt; STM ()
forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116423"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">(EvenStreamTable -&gt; STM ()) -&gt; EvenStreamTable -&gt; STM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; EvenStreamTable
</span><a href="Network.HTTP2.H2.StreamTable.html#emptyEvenStreamTable"><span class="hs-identifier hs-var">emptyEvenStreamTable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><span class="annottext">IntMap Stream -&gt; STM (IntMap Stream)
forall a. a -&gt; STM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116425"><span class="hs-identifier hs-var">evenTable</span></a></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#waitIncEven"><span class="hs-identifier hs-type">waitIncEven</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-type">EvenStreamTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span id="waitIncEven"><span class="annot"><span class="annottext">waitIncEven :: TVar EvenStreamTable -&gt; Int -&gt; STM ()
</span><a href="Network.HTTP2.H2.StreamTable.html#waitIncEven"><span class="hs-identifier hs-var hs-var">waitIncEven</span></a></span></span><span> </span><span id="local-6989586621679116427"><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116427"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621679116428"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116428"><span class="hs-identifier hs-var">maxConc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-type">EvenStreamTable</span></a></span><span class="hs-special">{</span><span id="local-6989586621679116429"><span id="local-6989586621679116430"><span id="local-6989586621679116431"><span class="annot"><span class="annottext">Int
IntMap Stream
LRUCache (Method, Method) Stream
evenConc :: EvenStreamTable -&gt; Int
evenTable :: EvenStreamTable -&gt; IntMap Stream
evenCache :: EvenStreamTable -&gt; LRUCache (Method, Method) Stream
evenConc :: Int
evenTable :: IntMap Stream
evenCache :: LRUCache (Method, Method) Stream
</span><a href="Network.HTTP2.H2.StreamTable.html#evenConc"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable -&gt; STM EvenStreamTable
forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116427"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; STM ()
</span><span class="hs-identifier hs-var">check</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116429"><span class="hs-identifier hs-var">evenConc</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116428"><span class="hs-identifier hs-var">maxConc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679116434"><span class="annot"><span class="annottext">evenConc' :: Int
</span><a href="#local-6989586621679116434"><span class="hs-identifier hs-var hs-var">evenConc'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116429"><span class="hs-identifier hs-var">evenConc</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><span class="annottext">TVar EvenStreamTable -&gt; EvenStreamTable -&gt; STM ()
forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116427"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">(EvenStreamTable -&gt; STM ()) -&gt; EvenStreamTable -&gt; STM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; IntMap Stream
-&gt; LRUCache (Method, Method) Stream
-&gt; EvenStreamTable
</span><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-var">EvenStreamTable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116434"><span class="hs-identifier hs-var">evenConc'</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116430"><span class="hs-identifier hs-var">evenTable</span></a></span><span> </span><span class="annot"><span class="annottext">LRUCache (Method, Method) Stream
</span><a href="#local-6989586621679116431"><span class="hs-identifier hs-var">evenCache</span></a></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#insertEvenCache"><span class="hs-identifier hs-type">insertEvenCache</span></a></span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-type">EvenStreamTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span id="insertEvenCache"><span class="annot"><span class="annottext">insertEvenCache :: TVar EvenStreamTable -&gt; Method -&gt; Method -&gt; Stream -&gt; IO ()
</span><a href="Network.HTTP2.H2.StreamTable.html#insertEvenCache"><span class="hs-identifier hs-var hs-var">insertEvenCache</span></a></span></span><span> </span><span id="local-6989586621679116435"><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116435"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621679116436"><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679116436"><span class="hs-identifier hs-var">method</span></a></span></span><span> </span><span id="local-6989586621679116437"><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679116437"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621679116438"><span class="annot"><span class="annottext">strm :: Stream
</span><a href="#local-6989586621679116438"><span class="hs-identifier hs-var">strm</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span class="hs-special">{</span><span id="local-6989586621679116440"><span id="local-6989586621679116441"><span id="local-6989586621679116442"><span id="local-6989586621679116443"><span id="local-6989586621679116444"><span class="annot"><span class="annottext">Int
MVar (Either SomeException InpObj)
TVar TxFlow
IORef RxFlow
IORef StreamState
streamInput :: Stream -&gt; MVar (Either SomeException InpObj)
streamNumber :: Int
streamState :: IORef StreamState
streamInput :: MVar (Either SomeException InpObj)
streamTxFlow :: TVar TxFlow
streamRxFlow :: IORef RxFlow
streamNumber :: Stream -&gt; Int
streamState :: Stream -&gt; IORef StreamState
streamTxFlow :: Stream -&gt; TVar TxFlow
streamRxFlow :: Stream -&gt; IORef RxFlow
</span><a href="Network.HTTP2.H2.Types.html#streamInput"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable
-&gt; (EvenStreamTable -&gt; EvenStreamTable) -&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><span class="hs-identifier hs-var">modifyTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116435"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">((EvenStreamTable -&gt; EvenStreamTable) -&gt; STM ())
-&gt; (EvenStreamTable -&gt; EvenStreamTable) -&gt; STM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-type">EvenStreamTable</span></a></span><span class="hs-special">{</span><span id="local-6989586621679116449"><span id="local-6989586621679116450"><span id="local-6989586621679116451"><span class="annot"><span class="annottext">Int
IntMap Stream
LRUCache (Method, Method) Stream
evenConc :: EvenStreamTable -&gt; Int
evenTable :: EvenStreamTable -&gt; IntMap Stream
evenCache :: EvenStreamTable -&gt; LRUCache (Method, Method) Stream
evenConc :: Int
evenTable :: IntMap Stream
evenCache :: LRUCache (Method, Method) Stream
</span><a href="Network.HTTP2.H2.StreamTable.html#evenConc"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679116454"><span class="annot"><span class="annottext">evenConc' :: Int
</span><a href="#local-6989586621679116454"><span class="hs-identifier hs-var hs-var">evenConc'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116449"><span class="hs-identifier hs-var">evenConc</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-169"></span><span>        </span><span id="local-6989586621679116455"><span class="annot"><span class="annottext">evenTable' :: IntMap Stream
</span><a href="#local-6989586621679116455"><span class="hs-identifier hs-var hs-var">evenTable'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Stream -&gt; IntMap Stream -&gt; IntMap Stream
forall a. Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IntMap.insert</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116440"><span class="hs-identifier hs-var">streamNumber</span></a></span><span> </span><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679116438"><span class="hs-identifier hs-var">strm</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116450"><span class="hs-identifier hs-var">evenTable</span></a></span><span>
</span><span id="line-170"></span><span>        </span><span id="local-6989586621679116459"><span class="annot"><span class="annottext">evenCache' :: LRUCache (Method, Method) Stream
</span><a href="#local-6989586621679116459"><span class="hs-identifier hs-var hs-var">evenCache'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Method, Method)
-&gt; Stream
-&gt; LRUCache (Method, Method) Stream
-&gt; LRUCache (Method, Method) Stream
forall k v. Ord k =&gt; k -&gt; v -&gt; LRUCache k v -&gt; LRUCache k v
</span><span class="hs-identifier hs-var">LRUCache.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679116436"><span class="hs-identifier hs-var">method</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679116437"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679116438"><span class="hs-identifier hs-var">strm</span></a></span><span> </span><span class="annot"><span class="annottext">LRUCache (Method, Method) Stream
</span><a href="#local-6989586621679116451"><span class="hs-identifier hs-var">evenCache</span></a></span><span>
</span><span id="line-171"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; IntMap Stream
-&gt; LRUCache (Method, Method) Stream
-&gt; EvenStreamTable
</span><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-var">EvenStreamTable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116454"><span class="hs-identifier hs-var">evenConc'</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116455"><span class="hs-identifier hs-var">evenTable'</span></a></span><span> </span><span class="annot"><span class="annottext">LRUCache (Method, Method) Stream
</span><a href="#local-6989586621679116459"><span class="hs-identifier hs-var">evenCache'</span></a></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#deleteEvenCache"><span class="hs-identifier hs-type">deleteEvenCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-type">EvenStreamTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span id="deleteEvenCache"><span class="annot"><span class="annottext">deleteEvenCache :: TVar EvenStreamTable -&gt; Method -&gt; Method -&gt; IO ()
</span><a href="Network.HTTP2.H2.StreamTable.html#deleteEvenCache"><span class="hs-identifier hs-var hs-var">deleteEvenCache</span></a></span></span><span> </span><span id="local-6989586621679116461"><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116461"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621679116462"><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679116462"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679116463"><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679116463"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable
-&gt; (EvenStreamTable -&gt; EvenStreamTable) -&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><span class="hs-identifier hs-var">modifyTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116461"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">((EvenStreamTable -&gt; EvenStreamTable) -&gt; STM ())
-&gt; (EvenStreamTable -&gt; EvenStreamTable) -&gt; STM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-type">EvenStreamTable</span></a></span><span class="hs-special">{</span><span id="local-6989586621679116464"><span id="local-6989586621679116465"><span id="local-6989586621679116466"><span class="annot"><span class="annottext">Int
IntMap Stream
LRUCache (Method, Method) Stream
evenConc :: EvenStreamTable -&gt; Int
evenTable :: EvenStreamTable -&gt; IntMap Stream
evenCache :: EvenStreamTable -&gt; LRUCache (Method, Method) Stream
evenConc :: Int
evenTable :: IntMap Stream
evenCache :: LRUCache (Method, Method) Stream
</span><a href="Network.HTTP2.H2.StreamTable.html#evenConc"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679116470"><span class="annot"><span class="annottext">evenCache' :: LRUCache (Method, Method) Stream
</span><a href="#local-6989586621679116470"><span class="hs-identifier hs-var hs-var">evenCache'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Method, Method)
-&gt; LRUCache (Method, Method) Stream
-&gt; LRUCache (Method, Method) Stream
forall k v. Ord k =&gt; k -&gt; LRUCache k v -&gt; LRUCache k v
</span><span class="hs-identifier hs-var">LRUCache.delete</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679116462"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679116463"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LRUCache (Method, Method) Stream
</span><a href="#local-6989586621679116466"><span class="hs-identifier hs-var">evenCache</span></a></span><span>
</span><span id="line-176"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; IntMap Stream
-&gt; LRUCache (Method, Method) Stream
-&gt; EvenStreamTable
</span><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-var">EvenStreamTable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679116464"><span class="hs-identifier hs-var">evenConc</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Stream
</span><a href="#local-6989586621679116465"><span class="hs-identifier hs-var">evenTable</span></a></span><span> </span><span class="annot"><span class="annottext">LRUCache (Method, Method) Stream
</span><a href="#local-6989586621679116470"><span class="hs-identifier hs-var">evenCache'</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#lookupEvenCache"><span class="hs-identifier hs-type">lookupEvenCache</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-type">EvenStreamTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span id="lookupEvenCache"><span class="annot"><span class="annottext">lookupEvenCache :: TVar EvenStreamTable -&gt; Method -&gt; Method -&gt; IO (Maybe Stream)
</span><a href="Network.HTTP2.H2.StreamTable.html#lookupEvenCache"><span class="hs-identifier hs-var hs-var">lookupEvenCache</span></a></span></span><span> </span><span id="local-6989586621679116472"><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116472"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621679116473"><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679116473"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679116474"><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679116474"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Method, Method)
-&gt; LRUCache (Method, Method) Stream -&gt; Maybe Stream
forall k v. Ord k =&gt; k -&gt; LRUCache k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">LRUCache.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679116473"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679116474"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LRUCache (Method, Method) Stream -&gt; Maybe Stream)
-&gt; (EvenStreamTable -&gt; LRUCache (Method, Method) Stream)
-&gt; EvenStreamTable
-&gt; Maybe Stream
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EvenStreamTable -&gt; LRUCache (Method, Method) Stream
</span><a href="Network.HTTP2.H2.StreamTable.html#evenCache"><span class="hs-identifier hs-var">evenCache</span></a></span><span> </span><span class="annot"><span class="annottext">(EvenStreamTable -&gt; Maybe Stream)
-&gt; IO EvenStreamTable -&gt; IO (Maybe Stream)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable -&gt; IO EvenStreamTable
forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116472"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#getEvenStreams"><span class="hs-identifier hs-type">getEvenStreams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.StreamTable.html#EvenStreamTable"><span class="hs-identifier hs-type">EvenStreamTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IntMap</span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span id="getEvenStreams"><span class="annot"><span class="annottext">getEvenStreams :: TVar EvenStreamTable -&gt; IO (IntMap Stream)
</span><a href="Network.HTTP2.H2.StreamTable.html#getEvenStreams"><span class="hs-identifier hs-var hs-var">getEvenStreams</span></a></span></span><span> </span><span id="local-6989586621679116476"><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116476"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvenStreamTable -&gt; IntMap Stream
</span><a href="Network.HTTP2.H2.StreamTable.html#evenTable"><span class="hs-identifier hs-var">evenTable</span></a></span><span> </span><span class="annot"><span class="annottext">(EvenStreamTable -&gt; IntMap Stream)
-&gt; IO EvenStreamTable -&gt; IO (IntMap Stream)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable -&gt; IO EvenStreamTable
forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar EvenStreamTable
</span><a href="#local-6989586621679116476"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-184"></span></pre></body></html>