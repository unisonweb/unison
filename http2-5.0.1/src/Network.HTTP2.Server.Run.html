<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.HTTP2.Server.Run</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Imports.html"><span class="hs-identifier">Imports</span></a></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Control</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">defaultMaxData</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Socket</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SockAddr</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UnliftIO.Async</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">concurrently_</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.html"><span class="hs-identifier">Network.HTTP2.Frame</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.html"><span class="hs-identifier">Network.HTTP2.H2</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html"><span class="hs-identifier">Network.HTTP2.Server.Types</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Worker.html"><span class="hs-identifier">Network.HTTP2.Server.Worker</span></a></span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="annot"><span class="hs-comment">-- | Server configuration</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">data</span><span> </span><span id="ServerConfig"><span class="annot"><a href="Network.HTTP2.Server.Run.html#ServerConfig"><span class="hs-identifier hs-var">ServerConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ServerConfig"><span class="annot"><a href="Network.HTTP2.Server.Run.html#ServerConfig"><span class="hs-identifier hs-var">ServerConfig</span></a></span></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="numberOfWorkers"><span class="annot"><span class="annottext">ServerConfig -&gt; Int
</span><a href="Network.HTTP2.Server.Run.html#numberOfWorkers"><span class="hs-identifier hs-var hs-var">numberOfWorkers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ The number of workers</span></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="connectionWindowSize"><span class="annot"><span class="annottext">ServerConfig -&gt; Int
</span><a href="Network.HTTP2.Server.Run.html#connectionWindowSize"><span class="hs-identifier hs-var hs-var">connectionWindowSize</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WindowSize</span></span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ The window size of incoming streams</span></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="settings"><span class="annot"><span class="annottext">ServerConfig -&gt; Settings
</span><a href="Network.HTTP2.Server.Run.html#settings"><span class="hs-identifier hs-var hs-var">settings</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Settings.html#Settings"><span class="hs-identifier hs-type">Settings</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Settings</span></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679121786"><span id="local-6989586621679121793"><span class="annot"><span class="annottext">ServerConfig -&gt; ServerConfig -&gt; Bool
(ServerConfig -&gt; ServerConfig -&gt; Bool)
-&gt; (ServerConfig -&gt; ServerConfig -&gt; Bool) -&gt; Eq ServerConfig
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: ServerConfig -&gt; ServerConfig -&gt; Bool
== :: ServerConfig -&gt; ServerConfig -&gt; Bool
$c/= :: ServerConfig -&gt; ServerConfig -&gt; Bool
/= :: ServerConfig -&gt; ServerConfig -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679121798"><span id="local-6989586621679121807"><span id="local-6989586621679121811"><span class="annot"><span class="annottext">Int -&gt; ServerConfig -&gt; ShowS
[ServerConfig] -&gt; ShowS
ServerConfig -&gt; String
(Int -&gt; ServerConfig -&gt; ShowS)
-&gt; (ServerConfig -&gt; String)
-&gt; ([ServerConfig] -&gt; ShowS)
-&gt; Show ServerConfig
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; ServerConfig -&gt; ShowS
showsPrec :: Int -&gt; ServerConfig -&gt; ShowS
$cshow :: ServerConfig -&gt; String
show :: ServerConfig -&gt; String
$cshowList :: [ServerConfig] -&gt; ShowS
showList :: [ServerConfig] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-comment">-- | The default server config.</span><span>
</span><span id="line-31"></span><span class="hs-comment">--</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- &gt;&gt;&gt; defaultServerConfig</span><span>
</span><span id="line-33"></span><span class="hs-comment">-- ServerConfig {numberOfWorkers = 8, connectionWindowSize = 1048576, settings = Settings {headerTableSize = 4096, enablePush = True, maxConcurrentStreams = Just 64, initialWindowSize = 262144, maxFrameSize = 16384, maxHeaderListSize = Nothing}}</span><span>
</span><span id="line-34"></span><span class="annot"><a href="Network.HTTP2.Server.Run.html#defaultServerConfig"><span class="hs-identifier hs-type">defaultServerConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Run.html#ServerConfig"><span class="hs-identifier hs-type">ServerConfig</span></a></span><span>
</span><span id="line-35"></span><span id="defaultServerConfig"><span class="annot"><span class="annottext">defaultServerConfig :: ServerConfig
</span><a href="Network.HTTP2.Server.Run.html#defaultServerConfig"><span class="hs-identifier hs-var hs-var">defaultServerConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="Network.HTTP2.Server.Run.html#ServerConfig"><span class="hs-identifier hs-type">ServerConfig</span></a></span><span>
</span><span id="line-37"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">numberOfWorkers :: Int
</span><a href="Network.HTTP2.Server.Run.html#numberOfWorkers"><span class="hs-identifier hs-var">numberOfWorkers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span>
</span><span id="line-38"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connectionWindowSize :: Int
</span><a href="Network.HTTP2.Server.Run.html#connectionWindowSize"><span class="hs-identifier hs-var">connectionWindowSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier hs-var">defaultMaxData</span></span><span>
</span><span id="line-39"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">settings :: Settings
</span><a href="Network.HTTP2.Server.Run.html#settings"><span class="hs-identifier hs-var">settings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="Network.HTTP2.H2.Settings.html#defaultSettings"><span class="hs-identifier hs-var">defaultSettings</span></a></span><span>
</span><span id="line-40"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="annot"><span class="hs-comment">-- | Running HTTP/2 server.</span></span><span>
</span><span id="line-45"></span><span class="annot"><a href="Network.HTTP2.Server.Run.html#run"><span class="hs-identifier hs-type">run</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Run.html#ServerConfig"><span class="hs-identifier hs-type">ServerConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Server"><span class="hs-identifier hs-type">Server</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span id="run"><span class="annot"><span class="annottext">run :: ServerConfig -&gt; Config -&gt; Server -&gt; IO ()
</span><a href="Network.HTTP2.Server.Run.html#run"><span class="hs-identifier hs-var hs-var">run</span></a></span></span><span> </span><span id="local-6989586621679121817"><span class="annot"><span class="annottext">sconf :: ServerConfig
</span><a href="#local-6989586621679121817"><span class="hs-identifier hs-var">sconf</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.HTTP2.Server.Run.html#ServerConfig"><span class="hs-identifier hs-type">ServerConfig</span></a></span><span class="hs-special">{</span><span id="local-6989586621679121818"><span class="annot"><span class="annottext">Int
numberOfWorkers :: ServerConfig -&gt; Int
numberOfWorkers :: Int
</span><a href="Network.HTTP2.Server.Run.html#numberOfWorkers"><span class="hs-identifier hs-var hs-var">numberOfWorkers</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679121819"><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679121819"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span id="local-6989586621679121820"><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621679121820"><span class="hs-identifier hs-var">server</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-47"></span><span>    </span><span id="local-6989586621679121821"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679121821"><span class="hs-identifier hs-var">ok</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Config -&gt; IO Bool
</span><a href="Network.HTTP2.Server.Run.html#checkPreface"><span class="hs-identifier hs-var">checkPreface</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679121819"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679121821"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-49"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679121824"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679121824"><span class="hs-identifier hs-var">ctx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679121825"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679121825"><span class="hs-identifier hs-var">mgr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ServerConfig -&gt; Config -&gt; IO (Context, Manager)
</span><a href="Network.HTTP2.Server.Run.html#setup"><span class="hs-identifier hs-var">setup</span></a></span><span> </span><span class="annot"><span class="annottext">ServerConfig
</span><a href="#local-6989586621679121817"><span class="hs-identifier hs-var">sconf</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679121819"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-50"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679121827"><span class="annot"><span class="annottext">wc :: WorkerConf Stream
</span><a href="#local-6989586621679121827"><span class="hs-identifier hs-var hs-var">wc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; WorkerConf Stream
</span><a href="Network.HTTP2.Server.Worker.html#fromContext"><span class="hs-identifier hs-var">fromContext</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679121824"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-51"></span><span>        </span><span class="annot"><span class="annottext">Manager -&gt; IO () -&gt; IO ()
</span><a href="Network.HTTP2.H2.Manager.html#setAction"><span class="hs-identifier hs-var">setAction</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679121825"><span class="hs-identifier hs-var">mgr</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WorkerConf Stream -&gt; Manager -&gt; Server -&gt; IO ()
forall a. WorkerConf a -&gt; Manager -&gt; Server -&gt; IO ()
</span><a href="Network.HTTP2.Server.Worker.html#worker"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerConf Stream
</span><a href="#local-6989586621679121827"><span class="hs-identifier hs-var">wc</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679121825"><span class="hs-identifier hs-var">mgr</span></a></span><span> </span><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621679121820"><span class="hs-identifier hs-var">server</span></a></span><span>
</span><span id="line-52"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a. Applicative m =&gt; Int -&gt; m a -&gt; m ()
</span><span class="hs-identifier hs-var">replicateM_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679121818"><span class="hs-identifier hs-var">numberOfWorkers</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Manager -&gt; IO ()
</span><a href="Network.HTTP2.H2.Manager.html#spawnAction"><span class="hs-identifier hs-var">spawnAction</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679121825"><span class="hs-identifier hs-var">mgr</span></a></span><span>
</span><span id="line-53"></span><span>        </span><span class="annot"><span class="annottext">Config -&gt; Context -&gt; Manager -&gt; IO ()
</span><a href="Network.HTTP2.Server.Run.html#runH2"><span class="hs-identifier hs-var">runH2</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679121819"><span class="hs-identifier hs-var">conf</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679121824"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679121825"><span class="hs-identifier hs-var">mgr</span></a></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">data</span><span> </span><span id="ServerIO"><span class="annot"><a href="Network.HTTP2.Server.Run.html#ServerIO"><span class="hs-identifier hs-var">ServerIO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ServerIO"><span class="annot"><a href="Network.HTTP2.Server.Run.html#ServerIO"><span class="hs-identifier hs-var">ServerIO</span></a></span></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="sioMySockAddr"><span class="annot"><span class="annottext">ServerIO -&gt; SockAddr
</span><a href="Network.HTTP2.Server.Run.html#sioMySockAddr"><span class="hs-identifier hs-var hs-var">sioMySockAddr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SockAddr</span></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="sioPeerSockAddr"><span class="annot"><span class="annottext">ServerIO -&gt; SockAddr
</span><a href="Network.HTTP2.Server.Run.html#sioPeerSockAddr"><span class="hs-identifier hs-var hs-var">sioPeerSockAddr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SockAddr</span></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="sioReadRequest"><span class="annot"><span class="annottext">ServerIO -&gt; IO (Int, Stream, Request)
</span><a href="Network.HTTP2.Server.Run.html#sioReadRequest"><span class="hs-identifier hs-var hs-var">sioReadRequest</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#StreamId"><span class="hs-identifier hs-type">StreamId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="sioWriteResponse"><span class="annot"><span class="annottext">ServerIO -&gt; Stream -&gt; Response -&gt; IO ()
</span><a href="Network.HTTP2.Server.Run.html#sioWriteResponse"><span class="hs-identifier hs-var hs-var">sioWriteResponse</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="sioWriteBytes"><span class="annot"><span class="annottext">ServerIO -&gt; ByteString -&gt; IO ()
</span><a href="Network.HTTP2.Server.Run.html#sioWriteBytes"><span class="hs-identifier hs-var hs-var">sioWriteBytes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-comment">-- | Launching a receiver and a sender without workers.</span><span>
</span><span id="line-66"></span><span class="hs-comment">-- Any frames can be sent with `sioWriteBytes`.</span><span>
</span><span id="line-67"></span><span class="annot"><a href="Network.HTTP2.Server.Run.html#runIO"><span class="hs-identifier hs-type">runIO</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Run.html#ServerConfig"><span class="hs-identifier hs-type">ServerConfig</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.Server.Run.html#ServerIO"><span class="hs-identifier hs-type">ServerIO</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span id="runIO"><span class="annot"><span class="annottext">runIO :: ServerConfig -&gt; Config -&gt; (ServerIO -&gt; IO (IO ())) -&gt; IO ()
</span><a href="Network.HTTP2.Server.Run.html#runIO"><span class="hs-identifier hs-var hs-var">runIO</span></a></span></span><span> </span><span id="local-6989586621679121842"><span class="annot"><span class="annottext">ServerConfig
</span><a href="#local-6989586621679121842"><span class="hs-identifier hs-var">sconf</span></a></span></span><span> </span><span id="local-6989586621679121843"><span class="annot"><span class="annottext">conf :: Config
</span><a href="#local-6989586621679121843"><span class="hs-identifier hs-var">conf</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span class="hs-special">{</span><span id="local-6989586621679121845"><span id="local-6989586621679121846"><span id="local-6989586621679121847"><span id="local-6989586621679121848"><span id="local-6989586621679121849"><span id="local-6989586621679121850"><span id="local-6989586621679121851"><span id="local-6989586621679121852"><span class="annot"><span class="annottext">Int
Buffer
Manager
SockAddr
Int -&gt; IO ByteString
PositionReadMaker
ByteString -&gt; IO ()
confWriteBuffer :: Buffer
confBufferSize :: Int
confSendAll :: ByteString -&gt; IO ()
confReadN :: Int -&gt; IO ByteString
confPositionReadMaker :: PositionReadMaker
confTimeoutManager :: Manager
confMySockAddr :: SockAddr
confPeerSockAddr :: SockAddr
confWriteBuffer :: Config -&gt; Buffer
confBufferSize :: Config -&gt; Int
confSendAll :: Config -&gt; ByteString -&gt; IO ()
confReadN :: Config -&gt; Int -&gt; IO ByteString
confPositionReadMaker :: Config -&gt; PositionReadMaker
confTimeoutManager :: Config -&gt; Manager
confMySockAddr :: Config -&gt; SockAddr
confPeerSockAddr :: Config -&gt; SockAddr
</span><a href="#local-6989586621679121845"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679121861"><span class="annot"><span class="annottext">ServerIO -&gt; IO (IO ())
</span><a href="#local-6989586621679121861"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-73"></span><span>    </span><span id="local-6989586621679121862"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679121862"><span class="hs-identifier hs-var">ok</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Config -&gt; IO Bool
</span><a href="Network.HTTP2.Server.Run.html#checkPreface"><span class="hs-identifier hs-var">checkPreface</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679121843"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679121862"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-75"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679121863"><span class="annot"><span class="annottext">ctx :: Context
</span><a href="#local-6989586621679121863"><span class="hs-identifier hs-var">ctx</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.HTTP2.H2.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span class="hs-special">{</span><span id="local-6989586621679121865"><span id="local-6989586621679121866"><span id="local-6989586621679121867"><span id="local-6989586621679121868"><span id="local-6989586621679121869"><span id="local-6989586621679121870"><span id="local-6989586621679121871"><span id="local-6989586621679121872"><span id="local-6989586621679121873"><span id="local-6989586621679121874"><span id="local-6989586621679121875"><span id="local-6989586621679121876"><span id="local-6989586621679121877"><span id="local-6989586621679121878"><span id="local-6989586621679121879"><span id="local-6989586621679121880"><span id="local-6989586621679121881"><span id="local-6989586621679121882"><span id="local-6989586621679121883"><span id="local-6989586621679121884"><span id="local-6989586621679121885"><span id="local-6989586621679121886"><span id="local-6989586621679121887"><span id="local-6989586621679121888"><span class="annot"><span class="annottext">TVar Int
TVar TxFlow
TVar EvenStreamTable
TVar OddStreamTable
IORef Bool
IORef Int
IORef (Maybe Int)
IORef RxFlow
IORef Settings
SockAddr
Rate
TQueue Control
TQueue (Output Stream)
DynamicTable
Settings
RoleInfo
Role
role :: Role
roleInfo :: RoleInfo
mySettings :: Settings
myFirstSettings :: IORef Bool
peerSettings :: IORef Settings
oddStreamTable :: TVar OddStreamTable
evenStreamTable :: TVar EvenStreamTable
continued :: IORef (Maybe Int)
myStreamId :: TVar Int
peerStreamId :: IORef Int
outputBufferLimit :: IORef Int
outputQ :: TQueue (Output Stream)
outputQStreamID :: TVar Int
controlQ :: TQueue Control
encodeDynamicTable :: DynamicTable
decodeDynamicTable :: DynamicTable
txFlow :: TVar TxFlow
rxFlow :: IORef RxFlow
pingRate :: Rate
settingsRate :: Rate
emptyFrameRate :: Rate
rstRate :: Rate
mySockAddr :: SockAddr
peerSockAddr :: SockAddr
role :: Context -&gt; Role
roleInfo :: Context -&gt; RoleInfo
mySettings :: Context -&gt; Settings
myFirstSettings :: Context -&gt; IORef Bool
peerSettings :: Context -&gt; IORef Settings
oddStreamTable :: Context -&gt; TVar OddStreamTable
evenStreamTable :: Context -&gt; TVar EvenStreamTable
continued :: Context -&gt; IORef (Maybe Int)
myStreamId :: Context -&gt; TVar Int
peerStreamId :: Context -&gt; IORef Int
outputBufferLimit :: Context -&gt; IORef Int
outputQ :: Context -&gt; TQueue (Output Stream)
outputQStreamID :: Context -&gt; TVar Int
controlQ :: Context -&gt; TQueue Control
encodeDynamicTable :: Context -&gt; DynamicTable
decodeDynamicTable :: Context -&gt; DynamicTable
txFlow :: Context -&gt; TVar TxFlow
rxFlow :: Context -&gt; IORef RxFlow
pingRate :: Context -&gt; Rate
settingsRate :: Context -&gt; Rate
emptyFrameRate :: Context -&gt; Rate
rstRate :: Context -&gt; Rate
mySockAddr :: Context -&gt; SockAddr
peerSockAddr :: Context -&gt; SockAddr
</span><a href="#local-6989586621679121865"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679121913"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679121913"><span class="hs-identifier hs-var">mgr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ServerConfig -&gt; Config -&gt; IO (Context, Manager)
</span><a href="Network.HTTP2.Server.Run.html#setup"><span class="hs-identifier hs-var">setup</span></a></span><span> </span><span class="annot"><span class="annottext">ServerConfig
</span><a href="#local-6989586621679121842"><span class="hs-identifier hs-var">sconf</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679121843"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-76"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Context.html#ServerInfo"><span class="hs-identifier hs-type">ServerInfo</span></a></span><span class="hs-special">{</span><span id="local-6989586621679121915"><span class="annot"><span class="annottext">TQueue (Input Stream)
inputQ :: TQueue (Input Stream)
inputQ :: ServerInfo -&gt; TQueue (Input Stream)
</span><a href="#local-6989586621679121915"><span class="hs-glyph hs-var hs-var">..</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RoleInfo -&gt; ServerInfo
</span><a href="Network.HTTP2.H2.Context.html#toServerInfo"><span class="hs-identifier hs-var">toServerInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RoleInfo
</span><a href="#local-6989586621679121866"><span class="hs-identifier hs-var">roleInfo</span></a></span><span>
</span><span id="line-77"></span><span>            </span><span id="local-6989586621679121920"><span class="annot"><span class="annottext">get :: IO (Int, Stream, Request)
</span><a href="#local-6989586621679121920"><span class="hs-identifier hs-var hs-var">get</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-78"></span><span>                </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span id="local-6989586621679121922"><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679121922"><span class="hs-identifier hs-var">strm</span></a></span></span><span> </span><span id="local-6989586621679121923"><span class="annot"><span class="annottext">InpObj
</span><a href="#local-6989586621679121923"><span class="hs-identifier hs-var">inObj</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STM (Input Stream) -&gt; IO (Input Stream)
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM (Input Stream) -&gt; IO (Input Stream))
-&gt; STM (Input Stream) -&gt; IO (Input Stream)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TQueue (Input Stream) -&gt; STM (Input Stream)
forall a. TQueue a -&gt; STM a
</span><span class="hs-identifier hs-var">readTQueue</span></span><span> </span><span class="annot"><span class="annottext">TQueue (Input Stream)
</span><a href="#local-6989586621679121915"><span class="hs-identifier hs-var">inputQ</span></a></span><span>
</span><span id="line-79"></span><span>                </span><span class="annot"><span class="annottext">(Int, Stream, Request) -&gt; IO (Int, Stream, Request)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream -&gt; Int
</span><a href="Network.HTTP2.H2.Types.html#streamNumber"><span class="hs-identifier hs-var">streamNumber</span></a></span><span> </span><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679121922"><span class="hs-identifier hs-var">strm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679121922"><span class="hs-identifier hs-var">strm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InpObj -&gt; Request
</span><a href="Network.HTTP2.Server.Types.html#Request"><span class="hs-identifier hs-var">Request</span></a></span><span> </span><span class="annot"><span class="annottext">InpObj
</span><a href="#local-6989586621679121923"><span class="hs-identifier hs-var">inObj</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>            </span><span id="local-6989586621679121928"><span class="annot"><span class="annottext">putR :: Stream -&gt; Response -&gt; IO ()
</span><a href="#local-6989586621679121928"><span class="hs-identifier hs-var hs-var">putR</span></a></span></span><span> </span><span id="local-6989586621679121929"><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679121929"><span class="hs-identifier hs-var">strm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span id="local-6989586621679121931"><span class="annot"><span class="annottext">OutObj
</span><a href="#local-6989586621679121931"><span class="hs-identifier hs-var">outObj</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-81"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679121933"><span class="annot"><span class="annottext">out :: Output Stream
</span><a href="#local-6989586621679121933"><span class="hs-identifier hs-var hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream
-&gt; OutObj
-&gt; OutputType
-&gt; Maybe (TBQueue StreamingChunk)
-&gt; IO ()
-&gt; Output Stream
forall a.
a
-&gt; OutObj
-&gt; OutputType
-&gt; Maybe (TBQueue StreamingChunk)
-&gt; IO ()
-&gt; Output a
</span><a href="Network.HTTP2.H2.Types.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span> </span><span class="annot"><span class="annottext">Stream
</span><a href="#local-6989586621679121929"><span class="hs-identifier hs-var">strm</span></a></span><span> </span><span class="annot"><span class="annottext">OutObj
</span><a href="#local-6989586621679121931"><span class="hs-identifier hs-var">outObj</span></a></span><span> </span><span class="annot"><span class="annottext">OutputType
</span><a href="Network.HTTP2.H2.Types.html#OObj"><span class="hs-identifier hs-var">OObj</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TBQueue StreamingChunk)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>                </span><span class="annot"><span class="annottext">TQueue (Output Stream) -&gt; Output Stream -&gt; IO ()
</span><a href="Network.HTTP2.H2.Queue.html#enqueueOutput"><span class="hs-identifier hs-var">enqueueOutput</span></a></span><span> </span><span class="annot"><span class="annottext">TQueue (Output Stream)
</span><a href="#local-6989586621679121876"><span class="hs-identifier hs-var">outputQ</span></a></span><span> </span><span class="annot"><span class="annottext">Output Stream
</span><a href="#local-6989586621679121933"><span class="hs-identifier hs-var">out</span></a></span><span>
</span><span id="line-83"></span><span>            </span><span id="local-6989586621679121937"><span class="annot"><span class="annottext">putB :: ByteString -&gt; IO ()
</span><a href="#local-6989586621679121937"><span class="hs-identifier hs-var hs-var">putB</span></a></span></span><span> </span><span id="local-6989586621679121938"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679121938"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TQueue Control -&gt; Control -&gt; IO ()
</span><a href="Network.HTTP2.H2.Queue.html#enqueueControl"><span class="hs-identifier hs-var">enqueueControl</span></a></span><span> </span><span class="annot"><span class="annottext">TQueue Control
</span><a href="#local-6989586621679121878"><span class="hs-identifier hs-var">controlQ</span></a></span><span> </span><span class="annot"><span class="annottext">(Control -&gt; IO ()) -&gt; Control -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe SettingsList -&gt; [ByteString] -&gt; Control
</span><a href="Network.HTTP2.H2.Types.html#CFrames"><span class="hs-identifier hs-var">CFrames</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SettingsList
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679121938"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-84"></span><span>        </span><span id="local-6989586621679121941"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679121941"><span class="hs-identifier hs-var">io</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ServerIO -&gt; IO (IO ())
</span><a href="#local-6989586621679121861"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerIO -&gt; IO (IO ())) -&gt; ServerIO -&gt; IO (IO ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SockAddr
-&gt; SockAddr
-&gt; IO (Int, Stream, Request)
-&gt; (Stream -&gt; Response -&gt; IO ())
-&gt; (ByteString -&gt; IO ())
-&gt; ServerIO
</span><a href="Network.HTTP2.Server.Run.html#ServerIO"><span class="hs-identifier hs-var">ServerIO</span></a></span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679121851"><span class="hs-identifier hs-var">confMySockAddr</span></a></span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679121852"><span class="hs-identifier hs-var">confPeerSockAddr</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Int, Stream, Request)
</span><a href="#local-6989586621679121920"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">Stream -&gt; Response -&gt; IO ()
</span><a href="#local-6989586621679121928"><span class="hs-identifier hs-var">putR</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ()
</span><a href="#local-6989586621679121937"><span class="hs-identifier hs-var">putB</span></a></span><span>
</span><span id="line-85"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. MonadUnliftIO m =&gt; m a -&gt; m b -&gt; m ()
</span><span class="hs-identifier hs-var">concurrently_</span></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679121941"><span class="hs-identifier hs-var">io</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Config -&gt; Context -&gt; Manager -&gt; IO ()
</span><a href="Network.HTTP2.Server.Run.html#runH2"><span class="hs-identifier hs-var">runH2</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679121843"><span class="hs-identifier hs-var">conf</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679121863"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679121913"><span class="hs-identifier hs-var">mgr</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="annot"><a href="Network.HTTP2.Server.Run.html#checkPreface"><span class="hs-identifier hs-type">checkPreface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-88"></span><span id="checkPreface"><span class="annot"><span class="annottext">checkPreface :: Config -&gt; IO Bool
</span><a href="Network.HTTP2.Server.Run.html#checkPreface"><span class="hs-identifier hs-var hs-var">checkPreface</span></a></span></span><span> </span><span id="local-6989586621679121942"><span class="annot"><span class="annottext">conf :: Config
</span><a href="#local-6989586621679121942"><span class="hs-identifier hs-var">conf</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span class="hs-special">{</span><span id="local-6989586621679121943"><span id="local-6989586621679121944"><span id="local-6989586621679121945"><span id="local-6989586621679121946"><span id="local-6989586621679121947"><span id="local-6989586621679121948"><span id="local-6989586621679121949"><span id="local-6989586621679121950"><span class="annot"><span class="annottext">Int
Buffer
Manager
SockAddr
Int -&gt; IO ByteString
PositionReadMaker
ByteString -&gt; IO ()
confWriteBuffer :: Config -&gt; Buffer
confBufferSize :: Config -&gt; Int
confSendAll :: Config -&gt; ByteString -&gt; IO ()
confReadN :: Config -&gt; Int -&gt; IO ByteString
confPositionReadMaker :: Config -&gt; PositionReadMaker
confTimeoutManager :: Config -&gt; Manager
confMySockAddr :: Config -&gt; SockAddr
confPeerSockAddr :: Config -&gt; SockAddr
confWriteBuffer :: Buffer
confBufferSize :: Int
confSendAll :: ByteString -&gt; IO ()
confReadN :: Int -&gt; IO ByteString
confPositionReadMaker :: PositionReadMaker
confTimeoutManager :: Manager
confMySockAddr :: SockAddr
confPeerSockAddr :: SockAddr
</span><a href="Network.HTTP2.H2.Types.html#confWriteBuffer"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-89"></span><span>    </span><span id="local-6989586621679121951"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679121951"><span class="hs-identifier hs-var">preface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ByteString
</span><a href="#local-6989586621679121946"><span class="hs-identifier hs-var">confReadN</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Network.HTTP2.Frame.html#connectionPrefaceLength"><span class="hs-identifier hs-var">connectionPrefaceLength</span></a></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="Network.HTTP2.Frame.html#connectionPreface"><span class="hs-identifier hs-var">connectionPreface</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679121951"><span class="hs-identifier hs-var">preface</span></a></span><span>
</span><span id="line-91"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-92"></span><span>            </span><span class="annot"><span class="annottext">Config -&gt; ErrorCode -&gt; ByteString -&gt; IO ()
</span><a href="Network.HTTP2.Server.Run.html#goaway"><span class="hs-identifier hs-var">goaway</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679121942"><span class="hs-identifier hs-var">conf</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="Network.HTTP2.Frame.Types.html#ProtocolError"><span class="hs-identifier hs-var">ProtocolError</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;Preface mismatch&quot;</span></span><span>
</span><span id="line-93"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-94"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="annot"><a href="Network.HTTP2.Server.Run.html#setup"><span class="hs-identifier hs-type">setup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Run.html#ServerConfig"><span class="hs-identifier hs-type">ServerConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.H2.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Manager.html#Manager"><span class="hs-identifier hs-type">Manager</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span id="setup"><span class="annot"><span class="annottext">setup :: ServerConfig -&gt; Config -&gt; IO (Context, Manager)
</span><a href="Network.HTTP2.Server.Run.html#setup"><span class="hs-identifier hs-var hs-var">setup</span></a></span></span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Run.html#ServerConfig"><span class="hs-identifier hs-type">ServerConfig</span></a></span><span class="hs-special">{</span><span id="local-6989586621679121957"><span id="local-6989586621679121958"><span id="local-6989586621679121959"><span class="annot"><span class="annottext">Int
Settings
numberOfWorkers :: ServerConfig -&gt; Int
connectionWindowSize :: ServerConfig -&gt; Int
settings :: ServerConfig -&gt; Settings
numberOfWorkers :: Int
connectionWindowSize :: Int
settings :: Settings
</span><a href="Network.HTTP2.Server.Run.html#numberOfWorkers"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679121960"><span class="annot"><span class="annottext">conf :: Config
</span><a href="#local-6989586621679121960"><span class="hs-identifier hs-var">conf</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span class="hs-special">{</span><span id="local-6989586621679121961"><span id="local-6989586621679121962"><span id="local-6989586621679121963"><span id="local-6989586621679121964"><span id="local-6989586621679121965"><span id="local-6989586621679121966"><span id="local-6989586621679121967"><span id="local-6989586621679121968"><span class="annot"><span class="annottext">Int
Buffer
Manager
SockAddr
Int -&gt; IO ByteString
PositionReadMaker
ByteString -&gt; IO ()
confWriteBuffer :: Config -&gt; Buffer
confBufferSize :: Config -&gt; Int
confSendAll :: Config -&gt; ByteString -&gt; IO ()
confReadN :: Config -&gt; Int -&gt; IO ByteString
confPositionReadMaker :: Config -&gt; PositionReadMaker
confTimeoutManager :: Config -&gt; Manager
confMySockAddr :: Config -&gt; SockAddr
confPeerSockAddr :: Config -&gt; SockAddr
confWriteBuffer :: Buffer
confBufferSize :: Int
confSendAll :: ByteString -&gt; IO ()
confReadN :: Int -&gt; IO ByteString
confPositionReadMaker :: PositionReadMaker
confTimeoutManager :: Manager
confMySockAddr :: SockAddr
confPeerSockAddr :: SockAddr
</span><a href="Network.HTTP2.H2.Types.html#confWriteBuffer"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-98"></span><span>    </span><span id="local-6989586621679121969"><span class="annot"><span class="annottext">RoleInfo
</span><a href="#local-6989586621679121969"><span class="hs-identifier hs-var">serverInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO RoleInfo
</span><a href="Network.HTTP2.H2.Context.html#newServerInfo"><span class="hs-identifier hs-var">newServerInfo</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span id="local-6989586621679121971"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679121971"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-100"></span><span>        </span><span class="annot"><span class="annottext">RoleInfo -&gt; Config -&gt; Int -&gt; Int -&gt; Settings -&gt; IO Context
</span><a href="Network.HTTP2.H2.Context.html#newContext"><span class="hs-identifier hs-var">newContext</span></a></span><span>
</span><span id="line-101"></span><span>            </span><span class="annot"><span class="annottext">RoleInfo
</span><a href="#local-6989586621679121969"><span class="hs-identifier hs-var">serverInfo</span></a></span><span>
</span><span id="line-102"></span><span>            </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679121960"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-103"></span><span>            </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-104"></span><span>            </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679121958"><span class="hs-identifier hs-var">connectionWindowSize</span></a></span><span>
</span><span id="line-105"></span><span>            </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679121959"><span class="hs-identifier hs-var">settings</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-comment">-- Workers, worker manager and timer manager</span><span>
</span><span id="line-107"></span><span>    </span><span id="local-6989586621679121973"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679121973"><span class="hs-identifier hs-var">mgr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Manager -&gt; IO Manager
</span><a href="Network.HTTP2.H2.Manager.html#start"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679121966"><span class="hs-identifier hs-var">confTimeoutManager</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><span class="annottext">(Context, Manager) -&gt; IO (Context, Manager)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679121971"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679121973"><span class="hs-identifier hs-var">mgr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="annot"><a href="Network.HTTP2.Server.Run.html#runH2"><span class="hs-identifier hs-type">runH2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Manager.html#Manager"><span class="hs-identifier hs-type">Manager</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span id="runH2"><span class="annot"><span class="annottext">runH2 :: Config -&gt; Context -&gt; Manager -&gt; IO ()
</span><a href="Network.HTTP2.Server.Run.html#runH2"><span class="hs-identifier hs-var hs-var">runH2</span></a></span></span><span> </span><span id="local-6989586621679121975"><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679121975"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span id="local-6989586621679121976"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679121976"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621679121977"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679121977"><span class="hs-identifier hs-var">mgr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679121978"><span class="annot"><span class="annottext">runReceiver :: IO ()
</span><a href="#local-6989586621679121978"><span class="hs-identifier hs-var hs-var">runReceiver</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; Config -&gt; IO ()
</span><a href="Network.HTTP2.H2.Receiver.html#frameReceiver"><span class="hs-identifier hs-var">frameReceiver</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679121976"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679121975"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-113"></span><span>        </span><span id="local-6989586621679121980"><span class="annot"><span class="annottext">runSender :: IO ()
</span><a href="#local-6989586621679121980"><span class="hs-identifier hs-var hs-var">runSender</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; Config -&gt; Manager -&gt; IO ()
</span><a href="Network.HTTP2.H2.Sender.html#frameSender"><span class="hs-identifier hs-var">frameSender</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679121976"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679121975"><span class="hs-identifier hs-var">conf</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679121977"><span class="hs-identifier hs-var">mgr</span></a></span><span>
</span><span id="line-114"></span><span>        </span><span id="local-6989586621679121983"><span class="annot"><span class="annottext">runBackgroundThreads :: IO ()
</span><a href="#local-6989586621679121983"><span class="hs-identifier hs-var hs-var">runBackgroundThreads</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. MonadUnliftIO m =&gt; m a -&gt; m b -&gt; m ()
</span><span class="hs-identifier hs-var">concurrently_</span></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679121978"><span class="hs-identifier hs-var">runReceiver</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679121980"><span class="hs-identifier hs-var">runSender</span></a></span><span>
</span><span id="line-115"></span><span>    </span><span class="annot"><span class="annottext">Manager -&gt; IO () -&gt; (Either SomeException () -&gt; IO ()) -&gt; IO ()
forall a b.
Manager -&gt; IO a -&gt; (Either SomeException a -&gt; IO b) -&gt; IO b
</span><a href="Network.HTTP2.H2.Manager.html#stopAfter"><span class="hs-identifier hs-var">stopAfter</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679121977"><span class="hs-identifier hs-var">mgr</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679121983"><span class="hs-identifier hs-var">runBackgroundThreads</span></a></span><span> </span><span class="annot"><span class="annottext">((Either SomeException () -&gt; IO ()) -&gt; IO ())
-&gt; (Either SomeException () -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679121985"><span class="annot"><span class="annottext">Either SomeException ()
</span><a href="#local-6989586621679121985"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-116"></span><span>        </span><span class="annot"><span class="annottext">TVar OddStreamTable
-&gt; TVar EvenStreamTable -&gt; Maybe SomeException -&gt; IO ()
</span><a href="Network.HTTP2.H2.Stream.html#closeAllStreams"><span class="hs-identifier hs-var">closeAllStreams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; TVar OddStreamTable
</span><a href="Network.HTTP2.H2.Context.html#oddStreamTable"><span class="hs-identifier hs-var">oddStreamTable</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679121976"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; TVar EvenStreamTable
</span><a href="Network.HTTP2.H2.Context.html#evenStreamTable"><span class="hs-identifier hs-var">evenStreamTable</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679121976"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe SomeException -&gt; IO ()) -&gt; Maybe SomeException -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-117"></span><span>            </span><span class="annot"><span class="annottext">(SomeException -&gt; Maybe SomeException)
-&gt; (() -&gt; Maybe SomeException)
-&gt; Either SomeException ()
-&gt; Maybe SomeException
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe SomeException
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe SomeException -&gt; () -&gt; Maybe SomeException
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Maybe SomeException
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either SomeException ()
</span><a href="#local-6989586621679121985"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-118"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either SomeException ()
</span><a href="#local-6989586621679121985"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-119"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679121989"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679121989"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-120"></span><span>                </span><span class="annot"><span class="annottext">SomeException -&gt; IO ()
forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679121989"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-121"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679121991"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621679121991"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-122"></span><span>                </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621679121991"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">-- connClose must not be called here since Run:fork calls it</span><span>
</span><span id="line-125"></span><span class="annot"><a href="Network.HTTP2.Server.Run.html#goaway"><span class="hs-identifier hs-type">goaway</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#ErrorCode"><span class="hs-identifier hs-type">ErrorCode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span id="goaway"><span class="annot"><span class="annottext">goaway :: Config -&gt; ErrorCode -&gt; ByteString -&gt; IO ()
</span><a href="Network.HTTP2.Server.Run.html#goaway"><span class="hs-identifier hs-var hs-var">goaway</span></a></span></span><span> </span><span class="annot"><a href="Network.HTTP2.H2.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span class="hs-special">{</span><span id="local-6989586621679121992"><span id="local-6989586621679121993"><span id="local-6989586621679121994"><span id="local-6989586621679121995"><span id="local-6989586621679121996"><span id="local-6989586621679121997"><span id="local-6989586621679121998"><span id="local-6989586621679121999"><span class="annot"><span class="annottext">Int
Buffer
Manager
SockAddr
Int -&gt; IO ByteString
PositionReadMaker
ByteString -&gt; IO ()
confWriteBuffer :: Config -&gt; Buffer
confBufferSize :: Config -&gt; Int
confSendAll :: Config -&gt; ByteString -&gt; IO ()
confReadN :: Config -&gt; Int -&gt; IO ByteString
confPositionReadMaker :: Config -&gt; PositionReadMaker
confTimeoutManager :: Config -&gt; Manager
confMySockAddr :: Config -&gt; SockAddr
confPeerSockAddr :: Config -&gt; SockAddr
confWriteBuffer :: Buffer
confBufferSize :: Int
confSendAll :: ByteString -&gt; IO ()
confReadN :: Int -&gt; IO ByteString
confPositionReadMaker :: PositionReadMaker
confTimeoutManager :: Manager
confMySockAddr :: SockAddr
confPeerSockAddr :: SockAddr
</span><a href="Network.HTTP2.H2.Types.html#confWriteBuffer"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679122000"><span class="annot"><span class="annottext">ErrorCode
</span><a href="#local-6989586621679122000"><span class="hs-identifier hs-var">etype</span></a></span></span><span> </span><span id="local-6989586621679122001"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679122001"><span class="hs-identifier hs-var">debugmsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ()
</span><a href="#local-6989586621679121994"><span class="hs-identifier hs-var">confSendAll</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679122002"><span class="hs-identifier hs-var">bytestream</span></a></span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-128"></span><span>    </span><span id="local-6989586621679122002"><span class="annot"><span class="annottext">bytestream :: ByteString
</span><a href="#local-6989586621679122002"><span class="hs-identifier hs-var hs-var">bytestream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ErrorCode -&gt; ByteString -&gt; ByteString
</span><a href="Network.HTTP2.H2.EncodeFrame.html#goawayFrame"><span class="hs-identifier hs-var">goawayFrame</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="#local-6989586621679122000"><span class="hs-identifier hs-var">etype</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679122001"><span class="hs-identifier hs-var">debugmsg</span></a></span><span>
</span><span id="line-129"></span></pre></body></html>