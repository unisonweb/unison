<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.LSP.Logging</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Logging.html#logToShowMessage"><span class="hs-identifier">logToShowMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.LSP.Logging.html#logToLogMessage"><span class="hs-identifier">logToLogMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.LSP.Logging.html#defaultClientLogger"><span class="hs-identifier">defaultClientLogger</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Colog.Core</span></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Message</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Types</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html"><span class="hs-identifier">Language.LSP.Server.Core</span></a></span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="annot"><a href="Language.LSP.Logging.html#logSeverityToMessageType"><span class="hs-identifier hs-type">logSeverityToMessageType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Severity</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MessageType</span></span><span>
</span><span id="line-12"></span><span id="logSeverityToMessageType"><span class="annot"><span class="annottext">logSeverityToMessageType :: Severity -&gt; MessageType
</span><a href="Language.LSP.Logging.html#logSeverityToMessageType"><span class="hs-identifier hs-var hs-var">logSeverityToMessageType</span></a></span></span><span> </span><span id="local-6989586621679191376"><span class="annot"><span class="annottext">Severity
</span><a href="#local-6989586621679191376"><span class="hs-identifier hs-var">sev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="#local-6989586621679191376"><span class="hs-identifier hs-var">sev</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-13"></span><span>  </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Error</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MessageType
</span><span class="hs-identifier hs-var">MessageType_Error</span></span><span>
</span><span id="line-14"></span><span>  </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Warning</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MessageType
</span><span class="hs-identifier hs-var">MessageType_Warning</span></span><span>
</span><span id="line-15"></span><span>  </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Info</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MessageType
</span><span class="hs-identifier hs-var">MessageType_Info</span></span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Debug</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MessageType
</span><span class="hs-identifier hs-var">MessageType_Log</span></span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="annot"><span class="hs-comment">-- | Logs messages to the client via @window/logMessage@.</span></span><span>
</span><span id="line-19"></span><span id="local-6989586621679191321"><span id="local-6989586621679191322"><span class="annot"><a href="Language.LSP.Logging.html#logToLogMessage"><span class="hs-identifier hs-type">logToLogMessage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191321"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191322"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogAction</span></span><span> </span><span class="annot"><a href="#local-6989586621679191322"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithSeverity</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-20"></span><span id="logToLogMessage"><span class="annot"><span class="annottext">logToLogMessage :: forall c (m :: * -&gt; *).
MonadLsp c m =&gt;
LogAction m (WithSeverity Text)
</span><a href="Language.LSP.Logging.html#logToLogMessage"><span class="hs-identifier hs-var hs-var">logToLogMessage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WithSeverity Text -&gt; m ()) -&gt; LogAction m (WithSeverity Text)
forall (m :: * -&gt; *) msg. (msg -&gt; m ()) -&gt; LogAction m msg
</span><span class="hs-identifier hs-var">LogAction</span></span><span> </span><span class="annot"><span class="annottext">((WithSeverity Text -&gt; m ()) -&gt; LogAction m (WithSeverity Text))
-&gt; (WithSeverity Text -&gt; m ()) -&gt; LogAction m (WithSeverity Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithSeverity</span></span><span> </span><span id="local-6989586621679191393"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679191393"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679191394"><span class="annot"><span class="annottext">Severity
</span><a href="#local-6989586621679191394"><span class="hs-identifier hs-var">sev</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><span class="annottext">FromServerMessage -&gt; m ()
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
FromServerMessage -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-identifier hs-var">sendToClient</span></a></span><span> </span><span class="annot"><span class="annottext">(FromServerMessage -&gt; m ()) -&gt; FromServerMessage -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><span class="annottext">TNotificationMessage @'ServerToClient 'Method_WindowLogMessage
-&gt; FromServerMessage
forall (m :: Method 'ServerToClient 'Notification).
((TMessage @'ServerToClient @'Notification m :: *)
 ~ (TNotificationMessage @'ServerToClient m :: *)) =&gt;
TNotificationMessage @'ServerToClient m -&gt; FromServerMessage
</span><span class="hs-identifier hs-var">fromServerNot</span></span><span> </span><span class="annot"><span class="annottext">(TNotificationMessage @'ServerToClient 'Method_WindowLogMessage
 -&gt; FromServerMessage)
-&gt; TNotificationMessage @'ServerToClient 'Method_WindowLogMessage
-&gt; FromServerMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-23"></span><span>      </span><span class="annot"><span class="annottext">Text
-&gt; SMethod @'ServerToClient @'Notification 'Method_WindowLogMessage
-&gt; MessageParams
     @'ServerToClient @'Notification 'Method_WindowLogMessage
-&gt; TNotificationMessage @'ServerToClient 'Method_WindowLogMessage
forall (f :: MessageDirection) (m :: Method f 'Notification).
Text
-&gt; SMethod @f @'Notification m
-&gt; MessageParams @f @'Notification m
-&gt; TNotificationMessage @f m
</span><span class="hs-identifier hs-var">TNotificationMessage</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;2.0&quot;</span></span><span> </span><span class="annot"><span class="annottext">SMethod @'ServerToClient @'Notification 'Method_WindowLogMessage
</span><span class="hs-identifier hs-var">SMethod_WindowLogMessage</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MessageType -&gt; Text -&gt; LogMessageParams
</span><span class="hs-identifier hs-var">LogMessageParams</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Severity -&gt; MessageType
</span><a href="Language.LSP.Logging.html#logSeverityToMessageType"><span class="hs-identifier hs-var">logSeverityToMessageType</span></a></span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="#local-6989586621679191394"><span class="hs-identifier hs-var">sev</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679191393"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="annot"><span class="hs-comment">-- | Logs messages to the client via @window/showMessage@.</span></span><span>
</span><span id="line-26"></span><span id="local-6989586621679191400"><span id="local-6989586621679191401"><span class="annot"><a href="Language.LSP.Logging.html#logToShowMessage"><span class="hs-identifier hs-type">logToShowMessage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191400"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191401"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogAction</span></span><span> </span><span class="annot"><a href="#local-6989586621679191401"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithSeverity</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-27"></span><span id="logToShowMessage"><span class="annot"><span class="annottext">logToShowMessage :: forall c (m :: * -&gt; *).
MonadLsp c m =&gt;
LogAction m (WithSeverity Text)
</span><a href="Language.LSP.Logging.html#logToShowMessage"><span class="hs-identifier hs-var hs-var">logToShowMessage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WithSeverity Text -&gt; m ()) -&gt; LogAction m (WithSeverity Text)
forall (m :: * -&gt; *) msg. (msg -&gt; m ()) -&gt; LogAction m msg
</span><span class="hs-identifier hs-var">LogAction</span></span><span> </span><span class="annot"><span class="annottext">((WithSeverity Text -&gt; m ()) -&gt; LogAction m (WithSeverity Text))
-&gt; (WithSeverity Text -&gt; m ()) -&gt; LogAction m (WithSeverity Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithSeverity</span></span><span> </span><span id="local-6989586621679191407"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679191407"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679191408"><span class="annot"><span class="annottext">Severity
</span><a href="#local-6989586621679191408"><span class="hs-identifier hs-var">sev</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><span class="annottext">FromServerMessage -&gt; m ()
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
FromServerMessage -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-identifier hs-var">sendToClient</span></a></span><span> </span><span class="annot"><span class="annottext">(FromServerMessage -&gt; m ()) -&gt; FromServerMessage -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><span class="annottext">TNotificationMessage @'ServerToClient 'Method_WindowShowMessage
-&gt; FromServerMessage
forall (m :: Method 'ServerToClient 'Notification).
((TMessage @'ServerToClient @'Notification m :: *)
 ~ (TNotificationMessage @'ServerToClient m :: *)) =&gt;
TNotificationMessage @'ServerToClient m -&gt; FromServerMessage
</span><span class="hs-identifier hs-var">fromServerNot</span></span><span> </span><span class="annot"><span class="annottext">(TNotificationMessage @'ServerToClient 'Method_WindowShowMessage
 -&gt; FromServerMessage)
-&gt; TNotificationMessage @'ServerToClient 'Method_WindowShowMessage
-&gt; FromServerMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-30"></span><span>      </span><span class="annot"><span class="annottext">Text
-&gt; SMethod
     @'ServerToClient @'Notification 'Method_WindowShowMessage
-&gt; MessageParams
     @'ServerToClient @'Notification 'Method_WindowShowMessage
-&gt; TNotificationMessage @'ServerToClient 'Method_WindowShowMessage
forall (f :: MessageDirection) (m :: Method f 'Notification).
Text
-&gt; SMethod @f @'Notification m
-&gt; MessageParams @f @'Notification m
-&gt; TNotificationMessage @f m
</span><span class="hs-identifier hs-var">TNotificationMessage</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;2.0&quot;</span></span><span> </span><span class="annot"><span class="annottext">SMethod @'ServerToClient @'Notification 'Method_WindowShowMessage
</span><span class="hs-identifier hs-var">SMethod_WindowShowMessage</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MessageType -&gt; Text -&gt; ShowMessageParams
</span><span class="hs-identifier hs-var">ShowMessageParams</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Severity -&gt; MessageType
</span><a href="Language.LSP.Logging.html#logSeverityToMessageType"><span class="hs-identifier hs-var">logSeverityToMessageType</span></a></span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="#local-6989586621679191408"><span class="hs-identifier hs-var">sev</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679191407"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="annot"><span class="hs-comment">{- | A 'sensible' log action for logging messages to the client:

    * Shows 'Error' logs to the user via @window/showMessage@
    * Logs 'Info' and above logs in the client via @window/logMessage@

 If you want finer control (e.g. the ability to log 'Debug' logs based on a flag, or similar),
 then do not use this and write your own based on 'logToShowMessage' and 'logToLogMessage'.
-}</span></span><span>
</span><span id="line-40"></span><span id="local-6989586621679191411"><span id="local-6989586621679191412"><span class="annot"><a href="Language.LSP.Logging.html#defaultClientLogger"><span class="hs-identifier hs-type">defaultClientLogger</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191411"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679191412"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogAction</span></span><span> </span><span class="annot"><a href="#local-6989586621679191412"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithSeverity</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-41"></span><span id="defaultClientLogger"><span class="annot"><span class="annottext">defaultClientLogger :: forall c (m :: * -&gt; *).
MonadLsp c m =&gt;
LogAction m (WithSeverity Text)
</span><a href="Language.LSP.Logging.html#defaultClientLogger"><span class="hs-identifier hs-var hs-var">defaultClientLogger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><span class="annottext">Severity
-&gt; (WithSeverity Text -&gt; Severity)
-&gt; LogAction m (WithSeverity Text)
-&gt; LogAction m (WithSeverity Text)
forall (m :: * -&gt; *) a.
Applicative m =&gt;
Severity -&gt; (a -&gt; Severity) -&gt; LogAction m a -&gt; LogAction m a
</span><span class="hs-identifier hs-var">filterBySeverity</span></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Error</span></span><span> </span><span class="annot"><span class="annottext">WithSeverity Text -&gt; Severity
forall msg. WithSeverity msg -&gt; Severity
</span><span class="hs-identifier hs-var">getSeverity</span></span><span> </span><span class="annot"><span class="annottext">LogAction m (WithSeverity Text)
forall c (m :: * -&gt; *).
MonadLsp c m =&gt;
LogAction m (WithSeverity Text)
</span><a href="Language.LSP.Logging.html#logToShowMessage"><span class="hs-identifier hs-var">logToShowMessage</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><span class="annottext">LogAction m (WithSeverity Text)
-&gt; LogAction m (WithSeverity Text)
-&gt; LogAction m (WithSeverity Text)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Severity
-&gt; (WithSeverity Text -&gt; Severity)
-&gt; LogAction m (WithSeverity Text)
-&gt; LogAction m (WithSeverity Text)
forall (m :: * -&gt; *) a.
Applicative m =&gt;
Severity -&gt; (a -&gt; Severity) -&gt; LogAction m a -&gt; LogAction m a
</span><span class="hs-identifier hs-var">filterBySeverity</span></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Info</span></span><span> </span><span class="annot"><span class="annottext">WithSeverity Text -&gt; Severity
forall msg. WithSeverity msg -&gt; Severity
</span><span class="hs-identifier hs-var">getSeverity</span></span><span> </span><span class="annot"><span class="annottext">LogAction m (WithSeverity Text)
forall c (m :: * -&gt; *).
MonadLsp c m =&gt;
LogAction m (WithSeverity Text)
</span><a href="Language.LSP.Logging.html#logToLogMessage"><span class="hs-identifier hs-var">logToLogMessage</span></a></span><span>
</span><span id="line-44"></span></pre></body></html>