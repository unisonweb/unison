<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE CPP          #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE MagicHash    #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes   #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="annot"><span class="hs-comment">{-| An implementation of linear hash tables. (See
&lt;http://en.wikipedia.org/wiki/Linear_hashing&gt;). Use this hash table if you...

  * don't care that inserts and lookups are slower than the other hash table
    implementations in this collection (this one is slightly faster than
    @Data.HashTable@ from the base library in most cases)

  * have a soft real-time or interactive application for which the risk of
    introducing a long pause on insert while all of the keys are rehashed is
    unacceptable.


/Details:/

Linear hashing allows for the expansion of the hash table one slot at a time,
by moving a \&quot;split\&quot; pointer across an array of pointers to buckets. The
number of buckets is always a power of two, and the bucket to look in is
defined as:

@
bucket(level,key) = hash(key) mod (2^level)
@

The \&quot;split pointer\&quot; controls the expansion of the hash table. If the hash
table is at level @k@ (i.e. @2^k@ buckets have been allocated), we first
calculate @b=bucket(level-1,key)@. If @b &lt; splitptr@, the destination bucket is
calculated as @b'=bucket(level,key)@, otherwise the original value @b@ is used.

The split pointer is incremented once an insert causes some bucket to become
fuller than some predetermined threshold; the bucket at the split pointer
(*not* the bucket which triggered the split!) is then rehashed, and half of its
keys can be expected to be rehashed into the upper half of the table.

When the split pointer reaches the middle of the bucket array, the size of the
bucket array is doubled, the level increases, and the split pointer is reset to
zero.

Linear hashing, although not quite as fast for inserts or lookups as the
implementation of linear probing included in this package, is well suited for
interactive applications because it has much better worst case behaviour on
inserts. Other hash table implementations can suffer from long pauses, because
it is occasionally necessary to rehash all of the keys when the table grows.
Linear hashing, on the other hand, only ever rehashes a bounded (effectively
constant) number of keys when an insert forces a bucket split.

/Space overhead: experimental results/

In randomized testing (see @test\/compute-overhead\/ComputeOverhead.hs@ in the
source distribution), mean overhead is approximately 1.51 machine words per
key-value mapping with a very low standard deviation of about 0.06 words, 1.60
words per mapping at the 95th percentile.

/Unsafe tricks/

Then the @unsafe-tricks@ flag is on when this package is built (and it is on by
default), we use some unsafe tricks (namely 'unsafeCoerce#' and
'reallyUnsafePtrEquality#') to save indirections in this table. These
techniques rely on assumptions about the behaviour of the GHC runtime system
and, although they've been tested and should be safe under normal conditions,
are slightly dangerous. Caveat emptor. In particular, these techniques are
incompatible with HPC code coverage reports.


References:

  * W. Litwin. Linear hashing: a new tool for file and table addressing. In
    /Proc. 6th International Conference on Very Large Data Bases, Volume 6/,
    pp. 212-223, 1980.

  * P-A. Larson. Dynamic hash tables. /Communications of the ACM/ 31:
    446-457, 1988.
-}</span></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.HashTable.ST.Linear</span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier">HashTable</span></a></span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#new"><span class="hs-identifier">new</span></a></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#newSized"><span class="hs-identifier">newSized</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#delete"><span class="hs-identifier">delete</span></a></span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#lookup"><span class="hs-identifier">lookup</span></a></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#insert"><span class="hs-identifier">insert</span></a></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#mutate"><span class="hs-identifier">mutate</span></a></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#mutateST"><span class="hs-identifier">mutateST</span></a></span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#mapM_"><span class="hs-identifier">mapM_</span></a></span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#foldM"><span class="hs-identifier">foldM</span></a></span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#computeOverhead"><span class="hs-identifier">computeOverhead</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span class="hs-cpp">
#if !MIN_VERSION_base(4,8,0)
</span><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Applicative</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Word</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>                         </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapM_</span></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.ST</span></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Bits</span></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Hashable</span></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.STRef</span></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span>                               </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lookup</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapM_</span></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.HashTable.Class.html"><span class="hs-identifier">Data.HashTable.Class</span></a></span><span>                  </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.HashTable.Internal.Array.html"><span class="hs-identifier">Data.HashTable.Internal.Array</span></a></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.HashTable.Internal.Linear.Bucket.html"><span class="hs-identifier">Data.HashTable.Internal.Linear.Bucket</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.Internal.Linear.Bucket.html#Bucket"><span class="hs-identifier">Bucket</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.HashTable.Internal.Linear.Bucket.html"><span class="hs-identifier">Data.HashTable.Internal.Linear.Bucket</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Bucket</span></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.HashTable.Internal.Utils.html"><span class="hs-identifier">Data.HashTable.Internal.Utils</span></a></span><span class="hs-cpp">

#ifdef DEBUG
</span><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">System.IO</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-117"></span><span class="annot"><span class="hs-comment">-- | A linear hash table.</span></span><span>
</span><span id="line-118"></span><span class="hs-keyword">newtype</span><span> </span><span id="HashTable"><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a></span></span><span> </span><span id="local-6989586621679086992"><span class="annot"><a href="#local-6989586621679086992"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679086993"><span class="annot"><a href="#local-6989586621679086993"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621679086994"><span class="annot"><a href="#local-6989586621679086994"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HT"><span class="annot"><a href="Data.HashTable.ST.Linear.html#HT"><span class="hs-identifier hs-var">HT</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STRef</span></span><span> </span><span class="annot"><a href="#local-6989586621679086992"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086992"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086993"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086994"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-keyword">data</span><span> </span><span id="HashTable_"><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable_"><span class="hs-identifier hs-var">HashTable_</span></a></span></span><span> </span><span id="local-6989586621679086708"><span class="annot"><a href="#local-6989586621679086708"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679086709"><span class="annot"><a href="#local-6989586621679086709"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621679086710"><span class="annot"><a href="#local-6989586621679086710"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HashTable"><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a></span></span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="_level"><span class="annot"><span class="annottext">forall s k v. HashTable_ s k v -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#_level"><span class="hs-identifier hs-var hs-var">_level</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_splitptr"><span class="annot"><span class="annottext">forall s k v. HashTable_ s k v -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#_splitptr"><span class="hs-identifier hs-var hs-var">_splitptr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_buckets"><span class="annot"><span class="annottext">forall s k v. HashTable_ s k v -&gt; MutableArray s (Bucket s k v)
</span><a href="Data.HashTable.ST.Linear.html#_buckets"><span class="hs-identifier hs-var hs-var">_buckets</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MutableArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679086708"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.Internal.Linear.Bucket.html#Bucket"><span class="hs-identifier hs-type">Bucket</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086708"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086709"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086710"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-128"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Data.HashTable.Class.html#HashTable"><span class="hs-identifier hs-type">C.HashTable</span></a></span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-129"></span><span>    </span><span id="local-6989586621679087089"><span class="annot"><span class="annottext">new :: forall s k v. ST s (HashTable s k v)
</span><a href="#local-6989586621679087089"><span class="hs-identifier hs-var hs-var hs-var hs-var">new</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ST s (HashTable s k v)
forall s k v. ST s (HashTable s k v)
</span><a href="Data.HashTable.ST.Linear.html#new"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-130"></span><span>    </span><span id="local-6989586621679087091"><span class="annot"><span class="annottext">newSized :: forall s k v. Int -&gt; ST s (HashTable s k v)
</span><a href="#local-6989586621679087091"><span class="hs-identifier hs-var hs-var hs-var hs-var">newSized</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (HashTable s k v)
forall s k v. Int -&gt; ST s (HashTable s k v)
</span><a href="Data.HashTable.ST.Linear.html#newSized"><span class="hs-identifier hs-var">newSized</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span id="local-6989586621679087097"><span class="annot"><span class="annottext">insert :: forall k s v.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; v -&gt; ST s ()
</span><a href="#local-6989586621679087097"><span class="hs-identifier hs-var hs-var hs-var hs-var">insert</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; k -&gt; v -&gt; ST s ()
forall k s v.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; v -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#insert"><span class="hs-identifier hs-var">insert</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span id="local-6989586621679087103"><span class="annot"><span class="annottext">delete :: forall k s v. (Eq k, Hashable k) =&gt; HashTable s k v -&gt; k -&gt; ST s ()
</span><a href="#local-6989586621679087103"><span class="hs-identifier hs-var hs-var hs-var hs-var">delete</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; k -&gt; ST s ()
forall k s v. (Hashable k, Eq k) =&gt; HashTable s k v -&gt; k -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#delete"><span class="hs-identifier hs-var">delete</span></a></span><span>
</span><span id="line-133"></span><span>    </span><span id="local-6989586621679087109"><span class="annot"><span class="annottext">lookup :: forall k s v.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; ST s (Maybe v)
</span><a href="#local-6989586621679087109"><span class="hs-identifier hs-var hs-var hs-var hs-var">lookup</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; k -&gt; ST s (Maybe v)
forall k s v.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; ST s (Maybe v)
</span><a href="Data.HashTable.ST.Linear.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621679087111"><span class="annot"><span class="annottext">foldM :: forall a k v s.
(a -&gt; (k, v) -&gt; ST s a) -&gt; a -&gt; HashTable s k v -&gt; ST s a
</span><a href="#local-6989586621679087111"><span class="hs-identifier hs-var hs-var hs-var hs-var">foldM</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; (k, v) -&gt; ST s a) -&gt; a -&gt; HashTable s k v -&gt; ST s a
forall a k v s.
(a -&gt; (k, v) -&gt; ST s a) -&gt; a -&gt; HashTable s k v -&gt; ST s a
</span><a href="Data.HashTable.ST.Linear.html#foldM"><span class="hs-identifier hs-var">foldM</span></a></span><span>
</span><span id="line-135"></span><span>    </span><span id="local-6989586621679087113"><span class="annot"><span class="annottext">mapM_ :: forall k v s b. ((k, v) -&gt; ST s b) -&gt; HashTable s k v -&gt; ST s ()
</span><a href="#local-6989586621679087113"><span class="hs-identifier hs-var hs-var hs-var hs-var">mapM_</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((k, v) -&gt; ST s b) -&gt; HashTable s k v -&gt; ST s ()
forall k v s b. ((k, v) -&gt; ST s b) -&gt; HashTable s k v -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span>
</span><span id="line-136"></span><span>    </span><span id="local-6989586621679087119"><span class="annot"><span class="annottext">lookupIndex :: forall k s v.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; ST s (Maybe Word)
</span><a href="#local-6989586621679087119"><span class="hs-identifier hs-var hs-var hs-var hs-var">lookupIndex</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; k -&gt; ST s (Maybe Word)
forall k s v.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; ST s (Maybe Word)
</span><a href="Data.HashTable.ST.Linear.html#lookupIndex"><span class="hs-identifier hs-var">lookupIndex</span></a></span><span>
</span><span id="line-137"></span><span>    </span><span id="local-6989586621679087122"><span class="annot"><span class="annottext">nextByIndex :: forall s k v. HashTable s k v -&gt; Word -&gt; ST s (Maybe (Word, k, v))
</span><a href="#local-6989586621679087122"><span class="hs-identifier hs-var hs-var hs-var hs-var">nextByIndex</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; Word -&gt; ST s (Maybe (Word, k, v))
forall s k v. HashTable s k v -&gt; Word -&gt; ST s (Maybe (Word, k, v))
</span><a href="Data.HashTable.ST.Linear.html#nextByIndex"><span class="hs-identifier hs-var">nextByIndex</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span id="local-6989586621679087125"><span class="annot"><span class="annottext">computeOverhead :: forall s k v. HashTable s k v -&gt; ST s Double
</span><a href="#local-6989586621679087125"><span class="hs-identifier hs-var hs-var hs-var hs-var">computeOverhead</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; ST s Double
forall s k v. HashTable s k v -&gt; ST s Double
</span><a href="Data.HashTable.ST.Linear.html#computeOverhead"><span class="hs-identifier hs-var">computeOverhead</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span id="local-6989586621679087131"><span class="annot"><span class="annottext">mutate :: forall k s v a.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; (Maybe v -&gt; (Maybe v, a)) -&gt; ST s a
</span><a href="#local-6989586621679087131"><span class="hs-identifier hs-var hs-var hs-var hs-var">mutate</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; k -&gt; (Maybe v -&gt; (Maybe v, a)) -&gt; ST s a
forall k s v a.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; (Maybe v -&gt; (Maybe v, a)) -&gt; ST s a
</span><a href="Data.HashTable.ST.Linear.html#mutate"><span class="hs-identifier hs-var">mutate</span></a></span><span>
</span><span id="line-140"></span><span>    </span><span id="local-6989586621679087137"><span class="annot"><span class="annottext">mutateST :: forall k s v a.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; (Maybe v -&gt; ST s (Maybe v, a)) -&gt; ST s a
</span><a href="#local-6989586621679087137"><span class="hs-identifier hs-var hs-var hs-var hs-var">mutateST</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; k -&gt; (Maybe v -&gt; ST s (Maybe v, a)) -&gt; ST s a
forall k s v a.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; (Maybe v -&gt; ST s (Maybe v, a)) -&gt; ST s a
</span><a href="Data.HashTable.ST.Linear.html#mutateST"><span class="hs-identifier hs-var">mutateST</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-144"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679086816"><span id="local-6989586621679086817"><span id="local-6989586621679086818"><span id="local-6989586621679087140"><span id="local-6989586621679087145"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086816"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086817"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086818"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-145"></span><span>    </span><span id="local-6989586621679087148"><span class="annot"><span class="annottext">show :: HashTable s k v -&gt; String
</span><a href="#local-6989586621679087148"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;HashTable&gt;&quot;</span></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-149"></span><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- &quot;Data.HashTable.Class#v:new&quot;.</span><span>
</span><span id="line-151"></span><span id="local-6989586621679087150"><span id="local-6989586621679087151"><span id="local-6989586621679087152"><span class="annot"><a href="Data.HashTable.ST.Linear.html#new"><span class="hs-identifier hs-type">new</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679087150"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087150"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087151"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087152"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-152"></span><span id="new"><span class="annot"><span class="annottext">new :: forall s k v. ST s (HashTable s k v)
</span><a href="Data.HashTable.ST.Linear.html#new"><span class="hs-identifier hs-var hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-153"></span><span>    </span><span id="local-6989586621679087155"><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087155"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (MutableArray s (Bucket s k v))
forall s k v. Int -&gt; ST s (MutableArray s (Bucket s k v))
</span><a href="Data.HashTable.Internal.Linear.Bucket.html#newBucketArray"><span class="hs-identifier hs-var">Bucket.newBucketArray</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-154"></span><span>    </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (HashTable s k v)
forall s k v. HashTable_ s k v -&gt; ST s (HashTable s k v)
</span><a href="Data.HashTable.ST.Linear.html#newRef"><span class="hs-identifier hs-var">newRef</span></a></span><span> </span><span class="annot"><span class="annottext">(HashTable_ s k v -&gt; ST s (HashTable s k v))
-&gt; HashTable_ s k v -&gt; ST s (HashTable s k v)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; MutableArray s (Bucket s k v) -&gt; HashTable_ s k v
forall s k v.
Int -&gt; Int -&gt; MutableArray s (Bucket s k v) -&gt; HashTable_ s k v
</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087155"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-158"></span><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><span id="line-159"></span><span class="hs-comment">-- &quot;Data.HashTable.Class#v:newSized&quot;.</span><span>
</span><span id="line-160"></span><span id="local-6989586621679087158"><span id="local-6989586621679087159"><span id="local-6989586621679087160"><span class="annot"><a href="Data.HashTable.ST.Linear.html#newSized"><span class="hs-identifier hs-type">newSized</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679087158"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087158"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087159"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087160"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-161"></span><span id="newSized"><span class="annot"><span class="annottext">newSized :: forall s k v. Int -&gt; ST s (HashTable s k v)
</span><a href="Data.HashTable.ST.Linear.html#newSized"><span class="hs-identifier hs-var hs-var">newSized</span></a></span></span><span> </span><span id="local-6989586621679087162"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087162"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-162"></span><span>    </span><span id="local-6989586621679087163"><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087163"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (MutableArray s (Bucket s k v))
forall s k v. Int -&gt; ST s (MutableArray s (Bucket s k v))
</span><a href="Data.HashTable.Internal.Linear.Bucket.html#newBucketArray"><span class="hs-identifier hs-var">Bucket.newBucketArray</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087164"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (HashTable s k v)
forall s k v. HashTable_ s k v -&gt; ST s (HashTable s k v)
</span><a href="Data.HashTable.ST.Linear.html#newRef"><span class="hs-identifier hs-var">newRef</span></a></span><span> </span><span class="annot"><span class="annottext">(HashTable_ s k v -&gt; ST s (HashTable s k v))
-&gt; HashTable_ s k v -&gt; ST s (HashTable s k v)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; MutableArray s (Bucket s k v) -&gt; HashTable_ s k v
forall s k v.
Int -&gt; Int -&gt; MutableArray s (Bucket s k v) -&gt; HashTable_ s k v
</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087165"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087163"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-166"></span><span>    </span><span id="local-6989586621679087186"><span class="annot"><span class="annottext">k :: Word
</span><a href="#local-6989586621679087186"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Word
forall b. Integral b =&gt; Double -&gt; b
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">ceiling</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087162"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="Data.HashTable.ST.Linear.html#fillFactor"><span class="hs-identifier hs-var">fillFactor</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Data.HashTable.ST.Linear.html#bucketSplitSize"><span class="hs-identifier hs-var">bucketSplitSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621679087165"><span class="annot"><span class="annottext">lvl :: Int
</span><a href="#local-6989586621679087165"><span class="hs-identifier hs-var hs-var">lvl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int
</span><a href="Data.HashTable.Internal.Utils.html#log2"><span class="hs-identifier hs-var">log2</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679087186"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>    </span><span id="local-6989586621679087164"><span class="annot"><span class="annottext">sz :: Int
</span><a href="#local-6989586621679087164"><span class="hs-identifier hs-var hs-var">sz</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087165"><span class="hs-identifier hs-var">lvl</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><span id="line-174"></span><span class="hs-comment">-- &quot;Data.HashTable.Class#v:delete&quot;.</span><span>
</span><span id="line-175"></span><span id="local-6989586621679086780"><span id="local-6989586621679086781"><span id="local-6989586621679086782"><span class="annot"><a href="Data.HashTable.ST.Linear.html#delete"><span class="hs-identifier hs-type">delete</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679086780"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679086780"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-176"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086781"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086780"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086782"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679086780"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-178"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679086781"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-179"></span><span id="delete"><span class="annot"><span class="annottext">delete :: forall k s v. (Hashable k, Eq k) =&gt; HashTable s k v -&gt; k -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#delete"><span class="hs-identifier hs-var hs-var">delete</span></a></span></span><span> </span><span id="local-6989586621679087203"><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087203"><span class="hs-identifier hs-var">htRef</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087204"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087204"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; ST s (HashTable_ s k v)
forall s k v. HashTable s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier hs-var">readRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087203"><span class="hs-identifier hs-var">htRef</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (HashTable_ s k v) -&gt; (HashTable_ s k v -&gt; ST s ()) -&gt; ST s ()
forall a b. ST s a -&gt; (a -&gt; ST s b) -&gt; ST s b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s ()
forall {s} {k} {v}. HashTable_ s k v -&gt; ST s ()
</span><a href="#local-6989586621679087206"><span class="hs-identifier hs-var">work</span></a></span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621679087206"><span class="annot"><span class="annottext">work :: HashTable_ s k v -&gt; ST s ()
</span><a href="#local-6989586621679087206"><span class="hs-identifier hs-var hs-var">work</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span id="local-6989586621679087213"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087213"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span id="local-6989586621679087214"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087214"><span class="hs-identifier hs-var">splitptr</span></a></span></span><span> </span><span id="local-6989586621679087215"><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087215"><span class="hs-identifier hs-var">buckets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-182"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087218"><span class="annot"><span class="annottext">h0 :: Int
</span><a href="#local-6989586621679087218"><span class="hs-identifier hs-var hs-var">h0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; k -&gt; Int
forall k. Hashable k =&gt; Int -&gt; Int -&gt; k -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#hashKey"><span class="hs-identifier hs-var">hashKey</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087213"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087214"><span class="hs-identifier hs-var">splitptr</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087204"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-183"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;delete: size=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087213"><span class="hs-identifier hs-var">lvl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, h0=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087218"><span class="hs-identifier hs-var">h0</span></a></span><span>
</span><span id="line-184"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;splitptr: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087214"><span class="hs-identifier hs-var">splitptr</span></a></span><span>
</span><span id="line-185"></span><span>        </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v) -&gt; Int -&gt; k -&gt; ST s ()
forall k s v.
Eq k =&gt;
MutableArray s (Bucket s k v) -&gt; Int -&gt; k -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#delete%27"><span class="hs-identifier hs-var">delete'</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087215"><span class="hs-identifier hs-var">buckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087218"><span class="hs-identifier hs-var">h0</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087204"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-186"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#delete"><span class="hs-pragma hs-type">delete</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- &quot;Data.HashTable.Class#v:lookup&quot;.</span><span>
</span><span id="line-192"></span><span id="local-6989586621679087222"><span id="local-6989586621679087223"><span id="local-6989586621679087224"><span class="annot"><a href="Data.HashTable.ST.Linear.html#lookup"><span class="hs-identifier hs-type">lookup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679087222"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679087222"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087223"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087222"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087224"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679087222"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679087223"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679087224"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-193"></span><span id="lookup"><span class="annot"><span class="annottext">lookup :: forall k s v.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; ST s (Maybe v)
</span><a href="Data.HashTable.ST.Linear.html#lookup"><span class="hs-identifier hs-var hs-var">lookup</span></a></span></span><span> </span><span id="local-6989586621679087228"><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087228"><span class="hs-identifier hs-var">htRef</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087229"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087229"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; ST s (HashTable_ s k v)
forall s k v. HashTable s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier hs-var">readRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087228"><span class="hs-identifier hs-var">htRef</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (HashTable_ s k v)
-&gt; (HashTable_ s k v -&gt; ST s (Maybe v)) -&gt; ST s (Maybe v)
forall a b. ST s a -&gt; (a -&gt; ST s b) -&gt; ST s b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (Maybe v)
forall {s} {k} {v} {v}. HashTable_ s k v -&gt; ST s (Maybe v)
</span><a href="#local-6989586621679087230"><span class="hs-identifier hs-var">work</span></a></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-195"></span><span>    </span><span id="local-6989586621679087230"><span class="annot"><span class="annottext">work :: HashTable_ s k v -&gt; ST s (Maybe v)
</span><a href="#local-6989586621679087230"><span class="hs-identifier hs-var hs-var">work</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span id="local-6989586621679087233"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087233"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span id="local-6989586621679087234"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087234"><span class="hs-identifier hs-var">splitptr</span></a></span></span><span> </span><span id="local-6989586621679087235"><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087235"><span class="hs-identifier hs-var">buckets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679087238"><span class="annot"><span class="annottext">h0 :: Int
</span><a href="#local-6989586621679087238"><span class="hs-identifier hs-var hs-var">h0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; k -&gt; Int
forall k. Hashable k =&gt; Int -&gt; Int -&gt; k -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#hashKey"><span class="hs-identifier hs-var">hashKey</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087233"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087234"><span class="hs-identifier hs-var">splitptr</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087229"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-197"></span><span>        </span><span id="local-6989586621679087239"><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087239"><span class="hs-identifier hs-var">bucket</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v) -&gt; Int -&gt; ST s (Bucket s k v)
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087235"><span class="hs-identifier hs-var">buckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087238"><span class="hs-identifier hs-var">h0</span></a></span><span>
</span><span id="line-198"></span><span>        </span><span class="annot"><span class="annottext">Bucket s k v -&gt; k -&gt; ST s (Maybe v)
forall k s v. Eq k =&gt; Bucket s k v -&gt; k -&gt; ST s (Maybe v)
</span><a href="Data.HashTable.Internal.Linear.Bucket.html#lookup"><span class="hs-identifier hs-var">Bucket.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087239"><span class="hs-identifier hs-var">bucket</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087229"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-199"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#lookup"><span class="hs-pragma hs-type">lookup</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-203"></span><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- &quot;Data.HashTable.Class#v:insert&quot;.</span><span>
</span><span id="line-205"></span><span id="local-6989586621679087242"><span id="local-6989586621679087243"><span id="local-6989586621679087244"><span class="annot"><a href="Data.HashTable.ST.Linear.html#insert"><span class="hs-identifier hs-type">insert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679087242"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679087242"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-206"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087243"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087242"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087244"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679087242"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-208"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679087244"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-209"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679087243"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-210"></span><span id="insert"><span class="annot"><span class="annottext">insert :: forall k s v.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; v -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#insert"><span class="hs-identifier hs-var hs-var">insert</span></a></span></span><span> </span><span id="local-6989586621679087250"><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087250"><span class="hs-identifier hs-var">htRef</span></a></span></span><span> </span><span id="local-6989586621679087251"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087251"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679087252"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679087252"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-211"></span><span>    </span><span id="local-6989586621679087253"><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679087253"><span class="hs-identifier hs-var">ht'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; ST s (HashTable_ s k v)
forall s k v. HashTable s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier hs-var">readRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087250"><span class="hs-identifier hs-var">htRef</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (HashTable_ s k v)
-&gt; (HashTable_ s k v -&gt; ST s (HashTable_ s k v))
-&gt; ST s (HashTable_ s k v)
forall a b. ST s a -&gt; (a -&gt; ST s b) -&gt; ST s b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (HashTable_ s k v)
forall {k} {s} {v}.
Hashable k =&gt;
HashTable_ s k v -&gt; ST s (HashTable_ s k v)
</span><a href="#local-6989586621679087254"><span class="hs-identifier hs-var">work</span></a></span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><span class="annottext">HashTable s k v -&gt; HashTable_ s k v -&gt; ST s ()
forall s k v. HashTable s k v -&gt; HashTable_ s k v -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#writeRef"><span class="hs-identifier hs-var">writeRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087250"><span class="hs-identifier hs-var">htRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679087253"><span class="hs-identifier hs-var">ht'</span></a></span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-214"></span><span>    </span><span id="local-6989586621679087254"><span class="annot"><span class="annottext">work :: HashTable_ s k v -&gt; ST s (HashTable_ s k v)
</span><a href="#local-6989586621679087254"><span class="hs-identifier hs-var hs-var">work</span></a></span></span><span> </span><span id="local-6989586621679087270"><span class="annot"><span class="annottext">ht :: HashTable_ s k v
</span><a href="#local-6989586621679087270"><span class="hs-identifier hs-var">ht</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span id="local-6989586621679087271"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087271"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span id="local-6989586621679087272"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087272"><span class="hs-identifier hs-var">splitptr</span></a></span></span><span> </span><span id="local-6989586621679087273"><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087273"><span class="hs-identifier hs-var">buckets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-215"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087276"><span class="annot"><span class="annottext">h0 :: Int
</span><a href="#local-6989586621679087276"><span class="hs-identifier hs-var hs-var">h0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; k -&gt; Int
forall k. Hashable k =&gt; Int -&gt; Int -&gt; k -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#hashKey"><span class="hs-identifier hs-var">hashKey</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087271"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087272"><span class="hs-identifier hs-var">splitptr</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087251"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-216"></span><span>        </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v) -&gt; Int -&gt; k -&gt; ST s ()
forall k s v.
Eq k =&gt;
MutableArray s (Bucket s k v) -&gt; Int -&gt; k -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#delete%27"><span class="hs-identifier hs-var">delete'</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087273"><span class="hs-identifier hs-var">buckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087276"><span class="hs-identifier hs-var">h0</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087251"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-217"></span><span>        </span><span id="local-6989586621679087277"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087277"><span class="hs-identifier hs-var">bsz</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v) -&gt; Int -&gt; k -&gt; v -&gt; ST s Int
forall s k v.
MutableArray s (Bucket s k v) -&gt; Int -&gt; k -&gt; v -&gt; ST s Int
</span><a href="Data.HashTable.ST.Linear.html#primitiveInsert%27"><span class="hs-identifier hs-var">primitiveInsert'</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087273"><span class="hs-identifier hs-var">buckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087276"><span class="hs-identifier hs-var">h0</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087251"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679087252"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="Data.HashTable.ST.Linear.html#checkOverflow"><span class="hs-identifier hs-var">checkOverflow</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087277"><span class="hs-identifier hs-var">bsz</span></a></span><span>
</span><span id="line-220"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-221"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;insert: splitting&quot;</span></span><span>
</span><span id="line-222"></span><span>            </span><span id="local-6989586621679087280"><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679087280"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (HashTable_ s k v)
forall {k} {s} {v}.
Hashable k =&gt;
HashTable_ s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Linear.html#split"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679087270"><span class="hs-identifier hs-var">ht</span></a></span><span>
</span><span id="line-223"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;insert: done splitting&quot;</span></span><span>
</span><span id="line-224"></span><span>            </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (HashTable_ s k v)
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679087280"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-225"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-226"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;insert: done&quot;</span></span><span>
</span><span id="line-227"></span><span>            </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (HashTable_ s k v)
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679087270"><span class="hs-identifier hs-var">ht</span></a></span><span>
</span><span id="line-228"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#insert"><span class="hs-pragma hs-type">insert</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-232"></span><span id="local-6989586621679087282"><span id="local-6989586621679087283"><span id="local-6989586621679087284"><span id="local-6989586621679087285"><span class="annot"><a href="Data.HashTable.ST.Linear.html#mutate"><span class="hs-identifier hs-type">mutate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679087282"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679087282"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-233"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087283"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087282"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087284"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679087282"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-235"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679087284"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679087284"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679087285"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679087283"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087285"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-237"></span><span id="mutate"><span class="annot"><span class="annottext">mutate :: forall k s v a.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; (Maybe v -&gt; (Maybe v, a)) -&gt; ST s a
</span><a href="Data.HashTable.ST.Linear.html#mutate"><span class="hs-identifier hs-var hs-var">mutate</span></a></span></span><span> </span><span id="local-6989586621679087292"><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087292"><span class="hs-identifier hs-var">htRef</span></a></span></span><span> </span><span id="local-6989586621679087293"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087293"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679087294"><span class="annot"><span class="annottext">Maybe v -&gt; (Maybe v, a)
</span><a href="#local-6989586621679087294"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; k -&gt; (Maybe v -&gt; ST s (Maybe v, a)) -&gt; ST s a
forall k s v a.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; (Maybe v -&gt; ST s (Maybe v, a)) -&gt; ST s a
</span><a href="Data.HashTable.ST.Linear.html#mutateST"><span class="hs-identifier hs-var">mutateST</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087292"><span class="hs-identifier hs-var">htRef</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087293"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Maybe v, a) -&gt; ST s (Maybe v, a)
forall a. a -&gt; ST s a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((Maybe v, a) -&gt; ST s (Maybe v, a))
-&gt; (Maybe v -&gt; (Maybe v, a)) -&gt; Maybe v -&gt; ST s (Maybe v, a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe v -&gt; (Maybe v, a)
</span><a href="#local-6989586621679087294"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#mutate"><span class="hs-pragma hs-type">mutate</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-242"></span><span id="local-6989586621679087296"><span id="local-6989586621679087297"><span id="local-6989586621679087298"><span id="local-6989586621679087299"><span class="annot"><a href="Data.HashTable.ST.Linear.html#mutateST"><span class="hs-identifier hs-type">mutateST</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679087296"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679087296"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-243"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087297"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087296"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087298"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679087296"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-245"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679087298"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679087297"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679087298"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679087299"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679087297"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087299"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-247"></span><span id="mutateST"><span class="annot"><span class="annottext">mutateST :: forall k s v a.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; (Maybe v -&gt; ST s (Maybe v, a)) -&gt; ST s a
</span><a href="Data.HashTable.ST.Linear.html#mutateST"><span class="hs-identifier hs-var hs-var">mutateST</span></a></span></span><span> </span><span id="local-6989586621679087307"><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087307"><span class="hs-identifier hs-var">htRef</span></a></span></span><span> </span><span id="local-6989586621679087308"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087308"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679087309"><span class="annot"><span class="annottext">Maybe v -&gt; ST s (Maybe v, a)
</span><a href="#local-6989586621679087309"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679087310"><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679087310"><span class="hs-identifier hs-var">ht</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679087311"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679087311"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; ST s (HashTable_ s k v)
forall s k v. HashTable s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier hs-var">readRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087307"><span class="hs-identifier hs-var">htRef</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (HashTable_ s k v)
-&gt; (HashTable_ s k v -&gt; ST s (HashTable_ s k v, a))
-&gt; ST s (HashTable_ s k v, a)
forall a b. ST s a -&gt; (a -&gt; ST s b) -&gt; ST s b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (HashTable_ s k v, a)
forall {k} {v}.
Hashable k =&gt;
HashTable_ s k v -&gt; ST s (HashTable_ s k v, a)
</span><a href="#local-6989586621679087312"><span class="hs-identifier hs-var">work</span></a></span><span>
</span><span id="line-249"></span><span>    </span><span class="annot"><span class="annottext">HashTable s k v -&gt; HashTable_ s k v -&gt; ST s ()
forall s k v. HashTable s k v -&gt; HashTable_ s k v -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#writeRef"><span class="hs-identifier hs-var">writeRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087307"><span class="hs-identifier hs-var">htRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679087310"><span class="hs-identifier hs-var">ht</span></a></span><span>
</span><span id="line-250"></span><span>    </span><span class="annot"><span class="annottext">a -&gt; ST s a
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679087311"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-252"></span><span>    </span><span id="local-6989586621679087312"><span class="annot"><span class="annottext">work :: HashTable_ s k v -&gt; ST s (HashTable_ s k v, a)
</span><a href="#local-6989586621679087312"><span class="hs-identifier hs-var hs-var">work</span></a></span></span><span> </span><span id="local-6989586621679087325"><span class="annot"><span class="annottext">ht :: HashTable_ s k v
</span><a href="#local-6989586621679087325"><span class="hs-identifier hs-var">ht</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span id="local-6989586621679087326"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087326"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span id="local-6989586621679087327"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087327"><span class="hs-identifier hs-var">splitptr</span></a></span></span><span> </span><span id="local-6989586621679087328"><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087328"><span class="hs-identifier hs-var">buckets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-253"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087331"><span class="annot"><span class="annottext">h0 :: Int
</span><a href="#local-6989586621679087331"><span class="hs-identifier hs-var hs-var">h0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; k -&gt; Int
forall k. Hashable k =&gt; Int -&gt; Int -&gt; k -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#hashKey"><span class="hs-identifier hs-var">hashKey</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087326"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087327"><span class="hs-identifier hs-var">splitptr</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087308"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-254"></span><span>        </span><span id="local-6989586621679087332"><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087332"><span class="hs-identifier hs-var">bucket</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v) -&gt; Int -&gt; ST s (Bucket s k v)
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087328"><span class="hs-identifier hs-var">buckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087331"><span class="hs-identifier hs-var">h0</span></a></span><span>
</span><span id="line-255"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679087333"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087333"><span class="hs-identifier hs-var">bsz</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679087334"><span class="annot"><span class="annottext">Maybe (Bucket s k v)
</span><a href="#local-6989586621679087334"><span class="hs-identifier hs-var">mbk</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679087335"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679087335"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bucket s k v
-&gt; k
-&gt; (Maybe v -&gt; ST s (Maybe v, a))
-&gt; ST s (Int, Maybe (Bucket s k v), a)
forall k s v a.
Eq k =&gt;
Bucket s k v
-&gt; k
-&gt; (Maybe v -&gt; ST s (Maybe v, a))
-&gt; ST s (Int, Maybe (Bucket s k v), a)
</span><a href="Data.HashTable.Internal.Linear.Bucket.html#mutateST"><span class="hs-identifier hs-var">Bucket.mutateST</span></a></span><span> </span><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087332"><span class="hs-identifier hs-var">bucket</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087308"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe v -&gt; ST s (Maybe v, a)
</span><a href="#local-6989586621679087309"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-256"></span><span>        </span><span class="annot"><span class="annottext">ST s ()
-&gt; (Bucket s k v -&gt; ST s ()) -&gt; Maybe (Bucket s k v) -&gt; ST s ()
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; ST s ()
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v) -&gt; Int -&gt; Bucket s k v -&gt; ST s ()
forall s a. MutableArray s a -&gt; Int -&gt; a -&gt; ST s ()
</span><a href="Data.HashTable.Internal.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087328"><span class="hs-identifier hs-var">buckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087331"><span class="hs-identifier hs-var">h0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>              </span><span class="annot"><span class="annottext">Maybe (Bucket s k v)
</span><a href="#local-6989586621679087334"><span class="hs-identifier hs-var">mbk</span></a></span><span>
</span><span id="line-259"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="Data.HashTable.ST.Linear.html#checkOverflow"><span class="hs-identifier hs-var">checkOverflow</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087333"><span class="hs-identifier hs-var">bsz</span></a></span><span>
</span><span id="line-260"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-261"></span><span>            </span><span id="local-6989586621679087339"><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679087339"><span class="hs-identifier hs-var">ht'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (HashTable_ s k v)
forall {k} {s} {v}.
Hashable k =&gt;
HashTable_ s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Linear.html#split"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679087325"><span class="hs-identifier hs-var">ht</span></a></span><span>
</span><span id="line-262"></span><span>            </span><span class="annot"><span class="annottext">(HashTable_ s k v, a) -&gt; ST s (HashTable_ s k v, a)
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679087339"><span class="hs-identifier hs-var">ht'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679087335"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(HashTable_ s k v, a) -&gt; ST s (HashTable_ s k v, a)
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679087325"><span class="hs-identifier hs-var">ht</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679087335"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-267"></span><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- &quot;Data.HashTable.Class#v:mapM_&quot;.</span><span>
</span><span id="line-269"></span><span id="local-6989586621679087340"><span id="local-6989586621679087341"><span id="local-6989586621679087342"><span id="local-6989586621679087343"><span class="annot"><a href="Data.HashTable.ST.Linear.html#mapM_"><span class="hs-identifier hs-type">mapM_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679087340"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679087341"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679087342"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087343"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087342"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087340"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087341"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679087342"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-270"></span><span id="mapM_"><span class="annot"><span class="annottext">mapM_ :: forall k v s b. ((k, v) -&gt; ST s b) -&gt; HashTable s k v -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#mapM_"><span class="hs-identifier hs-var hs-var">mapM_</span></a></span></span><span> </span><span id="local-6989586621679087345"><span class="annot"><span class="annottext">(k, v) -&gt; ST s b
</span><a href="#local-6989586621679087345"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679087346"><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087346"><span class="hs-identifier hs-var">htRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; ST s (HashTable_ s k v)
forall s k v. HashTable s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier hs-var">readRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087346"><span class="hs-identifier hs-var">htRef</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (HashTable_ s k v) -&gt; (HashTable_ s k v -&gt; ST s ()) -&gt; ST s ()
forall a b. ST s a -&gt; (a -&gt; ST s b) -&gt; ST s b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s ()
forall {k} {v}. HashTable_ s k v -&gt; ST s ()
</span><a href="#local-6989586621679087347"><span class="hs-identifier hs-var">work</span></a></span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-272"></span><span>    </span><span id="local-6989586621679087347"><span class="annot"><span class="annottext">work :: HashTable_ s k v -&gt; ST s ()
</span><a href="#local-6989586621679087347"><span class="hs-identifier hs-var hs-var">work</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span id="local-6989586621679087348"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087348"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679087349"><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087349"><span class="hs-identifier hs-var">buckets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s ()
</span><a href="#local-6989586621679087350"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-273"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-274"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679087351"><span class="annot"><span class="annottext">sz :: Int
</span><a href="#local-6989586621679087351"><span class="hs-identifier hs-var hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087348"><span class="hs-identifier hs-var">lvl</span></a></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span>        </span><span id="local-6989586621679087350"><span class="annot"><span class="annottext">go :: Int -&gt; ST s ()
</span><a href="#local-6989586621679087350"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087358"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087358"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087358"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087351"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ST s ()
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-278"></span><span>            </span><span id="local-6989586621679087359"><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087359"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v) -&gt; Int -&gt; ST s (Bucket s k v)
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087349"><span class="hs-identifier hs-var">buckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087358"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-279"></span><span>            </span><span class="annot"><span class="annottext">((k, v) -&gt; ST s b) -&gt; Bucket s k v -&gt; ST s ()
forall k v s a. ((k, v) -&gt; ST s a) -&gt; Bucket s k v -&gt; ST s ()
</span><a href="Data.HashTable.Internal.Linear.Bucket.html#mapM_"><span class="hs-identifier hs-var">Bucket.mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">(k, v) -&gt; ST s b
</span><a href="#local-6989586621679087345"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087359"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-280"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; ST s ()
</span><a href="#local-6989586621679087350"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ST s ()) -&gt; Int -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087358"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-284"></span><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><span id="line-285"></span><span class="hs-comment">-- &quot;Data.HashTable.Class#v:foldM&quot;.</span><span>
</span><span id="line-286"></span><span id="local-6989586621679087362"><span id="local-6989586621679087363"><span id="local-6989586621679087364"><span id="local-6989586621679087365"><span class="annot"><a href="Data.HashTable.ST.Linear.html#foldM"><span class="hs-identifier hs-type">foldM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679087362"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679087363"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679087364"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679087365"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087362"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679087362"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087365"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087363"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087364"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-288"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679087365"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087362"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-289"></span><span id="foldM"><span class="annot"><span class="annottext">foldM :: forall a k v s.
(a -&gt; (k, v) -&gt; ST s a) -&gt; a -&gt; HashTable s k v -&gt; ST s a
</span><a href="Data.HashTable.ST.Linear.html#foldM"><span class="hs-identifier hs-var hs-var">foldM</span></a></span></span><span> </span><span id="local-6989586621679087367"><span class="annot"><span class="annottext">a -&gt; (k, v) -&gt; ST s a
</span><a href="#local-6989586621679087367"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679087368"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679087368"><span class="hs-identifier hs-var">seed0</span></a></span></span><span> </span><span id="local-6989586621679087369"><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087369"><span class="hs-identifier hs-var">htRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; ST s (HashTable_ s k v)
forall s k v. HashTable s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier hs-var">readRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087369"><span class="hs-identifier hs-var">htRef</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (HashTable_ s k v) -&gt; (HashTable_ s k v -&gt; ST s a) -&gt; ST s a
forall a b. ST s a -&gt; (a -&gt; ST s b) -&gt; ST s b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s a
forall {k} {v}. HashTable_ s k v -&gt; ST s a
</span><a href="#local-6989586621679087370"><span class="hs-identifier hs-var">work</span></a></span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-291"></span><span>    </span><span id="local-6989586621679087370"><span class="annot"><span class="annottext">work :: HashTable_ s k v -&gt; ST s a
</span><a href="#local-6989586621679087370"><span class="hs-identifier hs-var hs-var">work</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span id="local-6989586621679087371"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087371"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679087372"><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087372"><span class="hs-identifier hs-var">buckets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Int -&gt; ST s a
</span><a href="#local-6989586621679087373"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679087368"><span class="hs-identifier hs-var">seed0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-292"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-293"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679087374"><span class="annot"><span class="annottext">sz :: Int
</span><a href="#local-6989586621679087374"><span class="hs-identifier hs-var hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087371"><span class="hs-identifier hs-var">lvl</span></a></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span>        </span><span id="local-6989586621679087373"><span class="annot"><span class="annottext">go :: a -&gt; Int -&gt; ST s a
</span><a href="#local-6989586621679087373"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087381"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679087381"><span class="hs-identifier hs-var">seed</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087382"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087382"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087382"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087374"><span class="hs-identifier hs-var">sz</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; ST s a
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679087381"><span class="hs-identifier hs-var">seed</span></a></span><span>
</span><span id="line-296"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-297"></span><span>            </span><span id="local-6989586621679087383"><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087383"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v) -&gt; Int -&gt; ST s (Bucket s k v)
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087372"><span class="hs-identifier hs-var">buckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087382"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-298"></span><span>            </span><span class="hs-glyph">!</span><span id="local-6989586621679087384"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679087384"><span class="hs-identifier hs-var">seed'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(a -&gt; (k, v) -&gt; ST s a) -&gt; a -&gt; Bucket s k v -&gt; ST s a
forall a k v s.
(a -&gt; (k, v) -&gt; ST s a) -&gt; a -&gt; Bucket s k v -&gt; ST s a
</span><a href="Data.HashTable.Internal.Linear.Bucket.html#foldM"><span class="hs-identifier hs-var">Bucket.foldM</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; (k, v) -&gt; ST s a
</span><a href="#local-6989586621679087367"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679087381"><span class="hs-identifier hs-var">seed</span></a></span><span> </span><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087383"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-299"></span><span>            </span><span class="annot"><span class="annottext">a -&gt; Int -&gt; ST s a
</span><a href="#local-6989586621679087373"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679087384"><span class="hs-identifier hs-var">seed'</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ST s a) -&gt; Int -&gt; ST s a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087382"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><span id="line-304"></span><span class="hs-comment">-- &quot;Data.HashTable.Class#v:computeOverhead&quot;.</span><span>
</span><span id="line-305"></span><span id="local-6989586621679087386"><span id="local-6989586621679087387"><span id="local-6989586621679087388"><span class="annot"><a href="Data.HashTable.ST.Linear.html#computeOverhead"><span class="hs-identifier hs-type">computeOverhead</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087386"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087387"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087388"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679087386"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span></span></span></span><span>
</span><span id="line-306"></span><span id="computeOverhead"><span class="annot"><span class="annottext">computeOverhead :: forall s k v. HashTable s k v -&gt; ST s Double
</span><a href="Data.HashTable.ST.Linear.html#computeOverhead"><span class="hs-identifier hs-var hs-var">computeOverhead</span></a></span></span><span> </span><span id="local-6989586621679087391"><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087391"><span class="hs-identifier hs-var">htRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; ST s (HashTable_ s k v)
forall s k v. HashTable s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier hs-var">readRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087391"><span class="hs-identifier hs-var">htRef</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (HashTable_ s k v)
-&gt; (HashTable_ s k v -&gt; ST s Double) -&gt; ST s Double
forall a b. ST s a -&gt; (a -&gt; ST s b) -&gt; ST s b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s Double
forall {b} {s} {k} {v}. Fractional b =&gt; HashTable_ s k v -&gt; ST s b
</span><a href="#local-6989586621679087392"><span class="hs-identifier hs-var">work</span></a></span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-308"></span><span>    </span><span id="local-6989586621679087392"><span class="annot"><span class="annottext">work :: HashTable_ s k v -&gt; ST s b
</span><a href="#local-6989586621679087392"><span class="hs-identifier hs-var hs-var">work</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span id="local-6989586621679087404"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087404"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679087405"><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087405"><span class="hs-identifier hs-var">buckets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-309"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679087406"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087406"><span class="hs-identifier hs-var">totElems</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679087407"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087407"><span class="hs-identifier hs-var">overhead</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; ST s (Int, Int)
</span><a href="#local-6989586621679087408"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679087411"><span class="annot"><span class="annottext">n :: b
</span><a href="#local-6989586621679087411"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; b
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087406"><span class="hs-identifier hs-var">totElems</span></a></span><span>
</span><span id="line-312"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679087414"><span class="annot"><span class="annottext">o :: b
</span><a href="#local-6989586621679087414"><span class="hs-identifier hs-var hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; b
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087407"><span class="hs-identifier hs-var">overhead</span></a></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>        </span><span class="annot"><span class="annottext">b -&gt; ST s b
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(b -&gt; ST s b) -&gt; b -&gt; ST s b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; b
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087415"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679087416"><span class="hs-identifier hs-var">constOverhead</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679087414"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679087411"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-317"></span><span>        </span><span id="local-6989586621679087416"><span class="annot"><span class="annottext">constOverhead :: b
</span><a href="#local-6989586621679087416"><span class="hs-identifier hs-var hs-var">constOverhead</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-number">5.0</span></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679087415"><span class="annot"><span class="annottext">sz :: Int
</span><a href="#local-6989586621679087415"><span class="hs-identifier hs-var hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087404"><span class="hs-identifier hs-var">lvl</span></a></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span>        </span><span id="local-6989586621679087408"><span class="annot"><span class="annottext">go :: Int -&gt; Int -&gt; Int -&gt; ST s (Int, Int)
</span><a href="#local-6989586621679087408"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087425"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087425"><span class="hs-identifier hs-var">nelems</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087426"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087426"><span class="hs-identifier hs-var">overhead</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087427"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087427"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087427"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087415"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; ST s (Int, Int)
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087425"><span class="hs-identifier hs-var">nelems</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087426"><span class="hs-identifier hs-var">overhead</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>                                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-323"></span><span>            </span><span id="local-6989586621679087428"><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087428"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v) -&gt; Int -&gt; ST s (Bucket s k v)
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087405"><span class="hs-identifier hs-var">buckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087427"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-324"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679087429"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087429"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span class="hs-glyph">!</span><span id="local-6989586621679087430"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087430"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bucket s k v -&gt; ST s (Int, Int)
forall s k v. Bucket s k v -&gt; ST s (Int, Int)
</span><a href="Data.HashTable.Internal.Linear.Bucket.html#nelemsAndOverheadInWords"><span class="hs-identifier hs-var">Bucket.nelemsAndOverheadInWords</span></a></span><span> </span><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087428"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-325"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087433"><span class="annot"><span class="annottext">n' :: Int
</span><a href="#local-6989586621679087433"><span class="hs-identifier hs-var hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087429"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087425"><span class="hs-identifier hs-var">nelems</span></a></span><span>
</span><span id="line-326"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087435"><span class="annot"><span class="annottext">o' :: Int
</span><a href="#local-6989586621679087435"><span class="hs-identifier hs-var hs-var">o'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087430"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087426"><span class="hs-identifier hs-var">overhead</span></a></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; ST s (Int, Int)
</span><a href="#local-6989586621679087408"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087433"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087435"><span class="hs-identifier hs-var">o'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087427"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-332"></span><span class="hs-comment">-- Private functions follow --</span><span>
</span><span id="line-333"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-336"></span><span id="local-6989586621679086858"><span id="local-6989586621679086859"><span id="local-6989586621679086860"><span class="annot"><a href="Data.HashTable.ST.Linear.html#delete%27"><span class="hs-identifier hs-type">delete'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679086858"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-337"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">MutableArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679086859"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.Internal.Linear.Bucket.html#Bucket"><span class="hs-identifier hs-type">Bucket</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086859"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086858"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086860"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-339"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679086858"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-340"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679086859"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-341"></span><span id="delete%27"><span class="annot"><span class="annottext">delete' :: forall k s v.
Eq k =&gt;
MutableArray s (Bucket s k v) -&gt; Int -&gt; k -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#delete%27"><span class="hs-identifier hs-var hs-var">delete'</span></a></span></span><span> </span><span id="local-6989586621679087441"><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087441"><span class="hs-identifier hs-var">buckets</span></a></span></span><span> </span><span id="local-6989586621679087442"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087442"><span class="hs-identifier hs-var">h0</span></a></span></span><span> </span><span id="local-6989586621679087443"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087443"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-342"></span><span>    </span><span id="local-6989586621679087444"><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087444"><span class="hs-identifier hs-var">bucket</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v) -&gt; Int -&gt; ST s (Bucket s k v)
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087441"><span class="hs-identifier hs-var">buckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087442"><span class="hs-identifier hs-var">h0</span></a></span><span>
</span><span id="line-343"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bucket s k v -&gt; k -&gt; ST s Bool
forall k s v. Eq k =&gt; Bucket s k v -&gt; k -&gt; ST s Bool
</span><a href="Data.HashTable.Internal.Linear.Bucket.html#delete"><span class="hs-identifier hs-var">Bucket.delete</span></a></span><span> </span><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087444"><span class="hs-identifier hs-var">bucket</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087443"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-344"></span><span>    </span><span class="annot"><span class="annottext">() -&gt; ST s ()
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-348"></span><span id="local-6989586621679087446"><span id="local-6989586621679087447"><span id="local-6989586621679087448"><span class="annot"><a href="Data.HashTable.ST.Linear.html#split"><span class="hs-identifier hs-type">split</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679087446"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-349"></span><span>         </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087447"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087446"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087448"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679087447"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087447"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087446"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087448"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-351"></span><span id="split"><span class="annot"><span class="annottext">split :: forall {k} {s} {v}.
Hashable k =&gt;
HashTable_ s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Linear.html#split"><span class="hs-identifier hs-var hs-var">split</span></a></span></span><span> </span><span id="local-6989586621679087486"><span class="annot"><span class="annottext">ht :: HashTable_ s k v
</span><a href="#local-6989586621679087486"><span class="hs-identifier hs-var">ht</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span id="local-6989586621679087487"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087487"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span id="local-6989586621679087488"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087488"><span class="hs-identifier hs-var">splitptr</span></a></span></span><span> </span><span id="local-6989586621679087489"><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087489"><span class="hs-identifier hs-var">buckets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-352"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;split: start: nbuck=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087487"><span class="hs-identifier hs-var">lvl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, splitptr=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087488"><span class="hs-identifier hs-var">splitptr</span></a></span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-comment">-- grab bucket at splitPtr</span><span>
</span><span id="line-356"></span><span>    </span><span id="local-6989586621679087490"><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087490"><span class="hs-identifier hs-var">oldBucket</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v) -&gt; Int -&gt; ST s (Bucket s k v)
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087489"><span class="hs-identifier hs-var">buckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087488"><span class="hs-identifier hs-var">splitptr</span></a></span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span>    </span><span id="local-6989586621679087491"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087491"><span class="hs-identifier hs-var">nelems</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bucket s k v -&gt; ST s Int
forall s k v. Bucket s k v -&gt; ST s Int
</span><a href="Data.HashTable.Internal.Linear.Bucket.html#size"><span class="hs-identifier hs-var">Bucket.size</span></a></span><span> </span><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087490"><span class="hs-identifier hs-var">oldBucket</span></a></span><span>
</span><span id="line-359"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087499"><span class="annot"><span class="annottext">bsz :: Int
</span><a href="#local-6989586621679087499"><span class="hs-identifier hs-var hs-var">bsz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Data.HashTable.Internal.Linear.Bucket.html#newBucketSize"><span class="hs-identifier hs-var">Bucket.newBucketSize</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-360"></span><span>                   </span><span class="annot"><span class="annottext">Double -&gt; Int
forall b. Integral b =&gt; Double -&gt; b
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">ceiling</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Int) -&gt; Double -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.625</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087491"><span class="hs-identifier hs-var">nelems</span></a></span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span>    </span><span class="hs-comment">-- write an empty bucket there</span><span>
</span><span id="line-363"></span><span>    </span><span id="local-6989586621679087501"><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087501"><span class="hs-identifier hs-var">dbucket1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (Bucket s k v)
forall s k v. Int -&gt; ST s (Bucket s k v)
</span><a href="Data.HashTable.Internal.Linear.Bucket.html#emptyWithSize"><span class="hs-identifier hs-var">Bucket.emptyWithSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087499"><span class="hs-identifier hs-var">bsz</span></a></span><span>
</span><span id="line-364"></span><span>    </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v) -&gt; Int -&gt; Bucket s k v -&gt; ST s ()
forall s a. MutableArray s a -&gt; Int -&gt; a -&gt; ST s ()
</span><a href="Data.HashTable.Internal.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087489"><span class="hs-identifier hs-var">buckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087488"><span class="hs-identifier hs-var">splitptr</span></a></span><span> </span><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087501"><span class="hs-identifier hs-var">dbucket1</span></a></span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span>    </span><span class="hs-comment">-- grow the buckets?</span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679087503"><span class="annot"><span class="annottext">lvl2 :: Int
</span><a href="#local-6989586621679087503"><span class="hs-identifier hs-var hs-var">lvl2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087487"><span class="hs-identifier hs-var">lvl</span></a></span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679087506"><span class="annot"><span class="annottext">lvl1 :: Int
</span><a href="#local-6989586621679087506"><span class="hs-identifier hs-var hs-var">lvl1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087487"><span class="hs-identifier hs-var">lvl</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679087507"><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087507"><span class="hs-identifier hs-var">buckets'</span></a></span></span><span class="hs-special">,</span><span class="hs-glyph">!</span><span id="local-6989586621679087508"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087508"><span class="hs-identifier hs-var">lvl'</span></a></span></span><span class="hs-special">,</span><span class="hs-glyph">!</span><span id="local-6989586621679087509"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087509"><span class="hs-identifier hs-var">sp'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-371"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087488"><span class="hs-identifier hs-var">splitptr</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087506"><span class="hs-identifier hs-var">lvl1</span></a></span><span>
</span><span id="line-372"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-373"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;split: resizing bucket array&quot;</span></span><span>
</span><span id="line-374"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679087512"><span class="annot"><span class="annottext">lvl3 :: Int
</span><a href="#local-6989586621679087512"><span class="hs-identifier hs-var hs-var">lvl3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087503"><span class="hs-identifier hs-var">lvl2</span></a></span><span>
</span><span id="line-375"></span><span>            </span><span id="local-6989586621679087513"><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087513"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Int
-&gt; MutableArray s (Bucket s k v)
-&gt; ST s (MutableArray s (Bucket s k v))
forall s k v.
Int
-&gt; Int
-&gt; MutableArray s (Bucket s k v)
-&gt; ST s (MutableArray s (Bucket s k v))
</span><a href="Data.HashTable.Internal.Linear.Bucket.html#expandBucketArray"><span class="hs-identifier hs-var">Bucket.expandBucketArray</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087512"><span class="hs-identifier hs-var">lvl3</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087503"><span class="hs-identifier hs-var">lvl2</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087489"><span class="hs-identifier hs-var">buckets</span></a></span><span>
</span><span id="line-376"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;split: resizing bucket array: done&quot;</span></span><span>
</span><span id="line-377"></span><span>            </span><span class="annot"><span class="annottext">(MutableArray s (Bucket s k v), Int, Int)
-&gt; ST s (MutableArray s (Bucket s k v), Int, Int)
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087513"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087487"><span class="hs-identifier hs-var">lvl</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(MutableArray s (Bucket s k v), Int, Int)
-&gt; ST s (MutableArray s (Bucket s k v), Int, Int)
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087489"><span class="hs-identifier hs-var">buckets</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087487"><span class="hs-identifier hs-var">lvl</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087488"><span class="hs-identifier hs-var">splitptr</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679087515"><span class="annot"><span class="annottext">ht' :: HashTable_ s k v
</span><a href="#local-6989586621679087515"><span class="hs-identifier hs-var hs-var">ht'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; MutableArray s (Bucket s k v) -&gt; HashTable_ s k v
forall s k v.
Int -&gt; Int -&gt; MutableArray s (Bucket s k v) -&gt; HashTable_ s k v
</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087508"><span class="hs-identifier hs-var">lvl'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087509"><span class="hs-identifier hs-var">sp'</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087507"><span class="hs-identifier hs-var">buckets'</span></a></span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span>    </span><span class="hs-comment">-- make sure the other split bucket has enough room in it also</span><span>
</span><span id="line-383"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679087517"><span class="annot"><span class="annottext">splitOffs :: Int
</span><a href="#local-6989586621679087517"><span class="hs-identifier hs-var hs-var">splitOffs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087488"><span class="hs-identifier hs-var">splitptr</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087506"><span class="hs-identifier hs-var">lvl1</span></a></span><span>
</span><span id="line-384"></span><span>    </span><span id="local-6989586621679087518"><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087518"><span class="hs-identifier hs-var">db2</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v) -&gt; Int -&gt; ST s (Bucket s k v)
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087507"><span class="hs-identifier hs-var">buckets'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087517"><span class="hs-identifier hs-var">splitOffs</span></a></span><span>
</span><span id="line-385"></span><span>    </span><span id="local-6989586621679087519"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087519"><span class="hs-identifier hs-var">db2sz</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bucket s k v -&gt; ST s Int
forall s k v. Bucket s k v -&gt; ST s Int
</span><a href="Data.HashTable.Internal.Linear.Bucket.html#size"><span class="hs-identifier hs-var">Bucket.size</span></a></span><span> </span><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087518"><span class="hs-identifier hs-var">db2</span></a></span><span>
</span><span id="line-386"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679087521"><span class="annot"><span class="annottext">db2sz' :: Int
</span><a href="#local-6989586621679087521"><span class="hs-identifier hs-var hs-var">db2sz'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087519"><span class="hs-identifier hs-var">db2sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087499"><span class="hs-identifier hs-var">bsz</span></a></span><span>
</span><span id="line-387"></span><span>    </span><span id="local-6989586621679087522"><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087522"><span class="hs-identifier hs-var">db2'</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bucket s k v -&gt; ST s (Bucket s k v)
forall s k v. Int -&gt; Bucket s k v -&gt; ST s (Bucket s k v)
</span><a href="Data.HashTable.Internal.Linear.Bucket.html#growBucketTo"><span class="hs-identifier hs-var">Bucket.growBucketTo</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087521"><span class="hs-identifier hs-var">db2sz'</span></a></span><span> </span><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087518"><span class="hs-identifier hs-var">db2</span></a></span><span>
</span><span id="line-388"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;growing bucket at &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087517"><span class="hs-identifier hs-var">splitOffs</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; to size &quot;</span></span><span>
</span><span id="line-389"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087521"><span class="hs-identifier hs-var">db2sz'</span></a></span><span>
</span><span id="line-390"></span><span>    </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v) -&gt; Int -&gt; Bucket s k v -&gt; ST s ()
forall s a. MutableArray s a -&gt; Int -&gt; a -&gt; ST s ()
</span><a href="Data.HashTable.Internal.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087507"><span class="hs-identifier hs-var">buckets'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087517"><span class="hs-identifier hs-var">splitOffs</span></a></span><span> </span><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087522"><span class="hs-identifier hs-var">db2'</span></a></span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span>    </span><span class="hs-comment">-- rehash old bucket</span><span>
</span><span id="line-393"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;split: rehashing bucket&quot;</span></span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679087526"><span class="annot"><span class="annottext">f :: (k, b) -&gt; ST s Int
</span><a href="#local-6989586621679087526"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(k -&gt; b -&gt; ST s Int) -&gt; (k, b) -&gt; ST s Int
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">((k -&gt; b -&gt; ST s Int) -&gt; (k, b) -&gt; ST s Int)
-&gt; (k -&gt; b -&gt; ST s Int) -&gt; (k, b) -&gt; ST s Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k b -&gt; k -&gt; b -&gt; ST s Int
forall k s v. Hashable k =&gt; HashTable_ s k v -&gt; k -&gt; v -&gt; ST s Int
</span><a href="Data.HashTable.ST.Linear.html#primitiveInsert"><span class="hs-identifier hs-var">primitiveInsert</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k b
forall {k} {v}. HashTable_ s k v
</span><a href="#local-6989586621679087515"><span class="hs-identifier hs-var">ht'</span></a></span><span>
</span><span id="line-395"></span><span>    </span><span class="annot"><span class="annottext">((k, v) -&gt; ST s Int) -&gt; ((k, v) -&gt; ST s Int) -&gt; ST s ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; a -&gt; m ()
</span><a href="Data.HashTable.Internal.Utils.html#forceSameType"><span class="hs-identifier hs-var">forceSameType</span></a></span><span> </span><span class="annot"><span class="annottext">(k, v) -&gt; ST s Int
forall {b}. (k, b) -&gt; ST s Int
</span><a href="#local-6989586621679087526"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(k -&gt; v -&gt; ST s Int) -&gt; (k, v) -&gt; ST s Int
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">((k -&gt; v -&gt; ST s Int) -&gt; (k, v) -&gt; ST s Int)
-&gt; (k -&gt; v -&gt; ST s Int) -&gt; (k, v) -&gt; ST s Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; k -&gt; v -&gt; ST s Int
forall k s v. Hashable k =&gt; HashTable_ s k v -&gt; k -&gt; v -&gt; ST s Int
</span><a href="Data.HashTable.ST.Linear.html#primitiveInsert"><span class="hs-identifier hs-var">primitiveInsert</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679087486"><span class="hs-identifier hs-var">ht</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span>    </span><span class="annot"><span class="annottext">((k, Bucket s k v) -&gt; ST s Int) -&gt; Bucket s k v -&gt; ST s ()
forall k v s a. ((k, v) -&gt; ST s a) -&gt; Bucket s k v -&gt; ST s ()
</span><a href="Data.HashTable.Internal.Linear.Bucket.html#mapM_"><span class="hs-identifier hs-var">Bucket.mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">(k, Bucket s k v) -&gt; ST s Int
forall {b}. (k, b) -&gt; ST s Int
</span><a href="#local-6989586621679087526"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087490"><span class="hs-identifier hs-var">oldBucket</span></a></span><span>
</span><span id="line-398"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;split: done&quot;</span></span><span>
</span><span id="line-399"></span><span>    </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (HashTable_ s k v)
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
forall {k} {v}. HashTable_ s k v
</span><a href="#local-6989586621679087515"><span class="hs-identifier hs-var">ht'</span></a></span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-403"></span><span class="annot"><a href="Data.HashTable.ST.Linear.html#checkOverflow"><span class="hs-identifier hs-type">checkOverflow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-404"></span><span id="checkOverflow"><span class="annot"><span class="annottext">checkOverflow :: Int -&gt; Bool
</span><a href="Data.HashTable.ST.Linear.html#checkOverflow"><span class="hs-identifier hs-var hs-var">checkOverflow</span></a></span></span><span> </span><span id="local-6989586621679087530"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087530"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087530"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Data.HashTable.ST.Linear.html#bucketSplitSize"><span class="hs-identifier hs-var">bucketSplitSize</span></a></span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-408"></span><span class="hs-comment">-- insert w/o splitting</span><span>
</span><span id="line-409"></span><span id="local-6989586621679086967"><span id="local-6989586621679086968"><span id="local-6989586621679086969"><span class="annot"><a href="Data.HashTable.ST.Linear.html#primitiveInsert"><span class="hs-identifier hs-type">primitiveInsert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679086967"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-410"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086968"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086967"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086969"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679086967"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-412"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679086969"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-413"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679086968"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span></span></span><span>
</span><span id="line-414"></span><span id="primitiveInsert"><span class="annot"><span class="annottext">primitiveInsert :: forall k s v. Hashable k =&gt; HashTable_ s k v -&gt; k -&gt; v -&gt; ST s Int
</span><a href="Data.HashTable.ST.Linear.html#primitiveInsert"><span class="hs-identifier hs-var hs-var">primitiveInsert</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span id="local-6989586621679087536"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087536"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span id="local-6989586621679087537"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087537"><span class="hs-identifier hs-var">splitptr</span></a></span></span><span> </span><span id="local-6989586621679087538"><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087538"><span class="hs-identifier hs-var">buckets</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679087539"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087539"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679087540"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679087540"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-415"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;primitiveInsert start: nbuckets=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087536"><span class="hs-identifier hs-var">lvl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679087543"><span class="annot"><span class="annottext">h0 :: Int
</span><a href="#local-6989586621679087543"><span class="hs-identifier hs-var hs-var">h0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; k -&gt; Int
forall k. Hashable k =&gt; Int -&gt; Int -&gt; k -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#hashKey"><span class="hs-identifier hs-var">hashKey</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087536"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087537"><span class="hs-identifier hs-var">splitptr</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087539"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-417"></span><span>    </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v) -&gt; Int -&gt; k -&gt; v -&gt; ST s Int
forall s k v.
MutableArray s (Bucket s k v) -&gt; Int -&gt; k -&gt; v -&gt; ST s Int
</span><a href="Data.HashTable.ST.Linear.html#primitiveInsert%27"><span class="hs-identifier hs-var">primitiveInsert'</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087538"><span class="hs-identifier hs-var">buckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087543"><span class="hs-identifier hs-var">h0</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087539"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679087540"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-418"></span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-421"></span><span id="local-6989586621679086883"><span id="local-6989586621679086884"><span id="local-6989586621679086885"><span class="annot"><a href="Data.HashTable.ST.Linear.html#primitiveInsert%27"><span class="hs-identifier hs-type">primitiveInsert'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MutableArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679086883"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.Internal.Linear.Bucket.html#Bucket"><span class="hs-identifier hs-type">Bucket</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086883"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086884"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086885"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-423"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679086884"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-424"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679086885"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-425"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679086883"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span></span></span><span>
</span><span id="line-426"></span><span id="primitiveInsert%27"><span class="annot"><span class="annottext">primitiveInsert' :: forall s k v.
MutableArray s (Bucket s k v) -&gt; Int -&gt; k -&gt; v -&gt; ST s Int
</span><a href="Data.HashTable.ST.Linear.html#primitiveInsert%27"><span class="hs-identifier hs-var hs-var">primitiveInsert'</span></a></span></span><span> </span><span id="local-6989586621679087553"><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087553"><span class="hs-identifier hs-var">buckets</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087554"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087554"><span class="hs-identifier hs-var">h0</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087555"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087555"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087556"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679087556"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-427"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;primitiveInsert': bucket number=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087554"><span class="hs-identifier hs-var">h0</span></a></span><span>
</span><span id="line-428"></span><span>    </span><span id="local-6989586621679087557"><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087557"><span class="hs-identifier hs-var">bucket</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v) -&gt; Int -&gt; ST s (Bucket s k v)
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087553"><span class="hs-identifier hs-var">buckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087554"><span class="hs-identifier hs-var">h0</span></a></span><span>
</span><span id="line-429"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;primitiveInsert': snoccing bucket&quot;</span></span><span>
</span><span id="line-430"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679087558"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087558"><span class="hs-identifier hs-var">hw</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679087559"><span class="annot"><span class="annottext">Maybe (Bucket s k v)
</span><a href="#local-6989586621679087559"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bucket s k v -&gt; k -&gt; v -&gt; ST s (Int, Maybe (Bucket s k v))
forall s k v.
Bucket s k v -&gt; k -&gt; v -&gt; ST s (Int, Maybe (Bucket s k v))
</span><a href="Data.HashTable.Internal.Linear.Bucket.html#snoc"><span class="hs-identifier hs-var">Bucket.snoc</span></a></span><span> </span><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087557"><span class="hs-identifier hs-var">bucket</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087555"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679087556"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-431"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;primitiveInsert': bucket snoc'd&quot;</span></span><span>
</span><span id="line-432"></span><span>    </span><span class="annot"><span class="annottext">ST s ()
-&gt; (Bucket s k v -&gt; ST s ()) -&gt; Maybe (Bucket s k v) -&gt; ST s ()
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; ST s ()
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v) -&gt; Int -&gt; Bucket s k v -&gt; ST s ()
forall s a. MutableArray s a -&gt; Int -&gt; a -&gt; ST s ()
</span><a href="Data.HashTable.Internal.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087553"><span class="hs-identifier hs-var">buckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087554"><span class="hs-identifier hs-var">h0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>          </span><span class="annot"><span class="annottext">Maybe (Bucket s k v)
</span><a href="#local-6989586621679087559"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-435"></span><span>    </span><span class="annot"><span class="annottext">Int -&gt; ST s Int
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087558"><span class="hs-identifier hs-var">hw</span></a></span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-441"></span><span class="annot"><a href="Data.HashTable.ST.Linear.html#fillFactor"><span class="hs-identifier hs-type">fillFactor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-442"></span><span id="fillFactor"><span class="annot"><span class="annottext">fillFactor :: Double
</span><a href="Data.HashTable.ST.Linear.html#fillFactor"><span class="hs-identifier hs-var hs-var">fillFactor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1.3</span></span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span>
</span><span id="line-445"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-446"></span><span class="annot"><a href="Data.HashTable.ST.Linear.html#bucketSplitSize"><span class="hs-identifier hs-type">bucketSplitSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-447"></span><span id="bucketSplitSize"><span class="annot"><span class="annottext">bucketSplitSize :: Int
</span><a href="Data.HashTable.ST.Linear.html#bucketSplitSize"><span class="hs-identifier hs-var hs-var">bucketSplitSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Data.HashTable.Internal.Linear.Bucket.html#bucketSplitSize"><span class="hs-identifier hs-var">Bucket.bucketSplitSize</span></a></span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-451"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-pragma hs-type">power2</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-452"></span><span class="annot"><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-type">power2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-453"></span><span id="power2"><span class="annot"><span class="annottext">power2 :: Int -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var hs-var">power2</span></a></span></span><span> </span><span id="local-6989586621679087562"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087562"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
</span><a href="Data.HashTable.Internal.Utils.html#iShiftL"><span class="hs-operator hs-var">`iShiftL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087562"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-457"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#hashKey"><span class="hs-pragma hs-type">hashKey</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-458"></span><span id="local-6989586621679086855"><span class="annot"><a href="Data.HashTable.ST.Linear.html#hashKey"><span class="hs-identifier hs-type">hashKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679086855"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679086855"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-459"></span><span id="hashKey"><span class="annot"><span class="annottext">hashKey :: forall k. Hashable k =&gt; Int -&gt; Int -&gt; k -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#hashKey"><span class="hs-identifier hs-var hs-var">hashKey</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087566"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087566"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087567"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087567"><span class="hs-identifier hs-var">splitptr</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087568"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087568"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087569"><span class="hs-identifier hs-var">h1</span></a></span><span>
</span><span id="line-460"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-461"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679087574"><span class="annot"><span class="annottext">h0 :: Int
</span><a href="#local-6989586621679087574"><span class="hs-identifier hs-var hs-var">h0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; k -&gt; Int
forall k. Hashable k =&gt; Int -&gt; k -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#hashAtLvl"><span class="hs-identifier hs-var">hashAtLvl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087566"><span class="hs-identifier hs-var">lvl</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087568"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-462"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679087569"><span class="annot"><span class="annottext">h1 :: Int
</span><a href="#local-6989586621679087569"><span class="hs-identifier hs-var hs-var">h1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087574"><span class="hs-identifier hs-var">h0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087567"><span class="hs-identifier hs-var">splitptr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; k -&gt; Int
forall k. Hashable k =&gt; Int -&gt; k -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#hashAtLvl"><span class="hs-identifier hs-var">hashAtLvl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087566"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087568"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-464"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087574"><span class="hs-identifier hs-var">h0</span></a></span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-468"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#hashAtLvl"><span class="hs-pragma hs-type">hashAtLvl</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-469"></span><span id="local-6989586621679086982"><span class="annot"><a href="Data.HashTable.ST.Linear.html#hashAtLvl"><span class="hs-identifier hs-type">hashAtLvl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679086982"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679086982"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-470"></span><span id="hashAtLvl"><span class="annot"><span class="annottext">hashAtLvl :: forall k. Hashable k =&gt; Int -&gt; k -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#hashAtLvl"><span class="hs-identifier hs-var hs-var">hashAtLvl</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087582"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087582"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087583"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087583"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087584"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-471"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-472"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679087584"><span class="annot"><span class="annottext">h :: Int
</span><a href="#local-6989586621679087584"><span class="hs-identifier hs-var hs-var">h</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087587"><span class="hs-identifier hs-var">hashcode</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087589"><span class="hs-identifier hs-var">mask</span></a></span><span>
</span><span id="line-473"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679087587"><span class="annot"><span class="annottext">hashcode :: Int
</span><a href="#local-6989586621679087587"><span class="hs-identifier hs-var hs-var">hashcode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; Int
forall a. Hashable a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">hash</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087583"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-474"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679087589"><span class="annot"><span class="annottext">mask :: Int
</span><a href="#local-6989586621679087589"><span class="hs-identifier hs-var hs-var">mask</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087582"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-478"></span><span id="local-6989586621679086826"><span id="local-6989586621679086827"><span id="local-6989586621679086828"><span class="annot"><a href="Data.HashTable.ST.Linear.html#newRef"><span class="hs-identifier hs-type">newRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086826"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086827"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086828"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679086826"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086826"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086827"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086828"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-479"></span><span id="newRef"><span class="annot"><span class="annottext">newRef :: forall s k v. HashTable_ s k v -&gt; ST s (HashTable s k v)
</span><a href="Data.HashTable.ST.Linear.html#newRef"><span class="hs-identifier hs-var hs-var">newRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(STRef s (HashTable_ s k v) -&gt; HashTable s k v)
-&gt; ST s (STRef s (HashTable_ s k v)) -&gt; ST s (HashTable s k v)
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="annot"><span class="annottext">STRef s (HashTable_ s k v) -&gt; HashTable s k v
forall s k v. STRef s (HashTable_ s k v) -&gt; HashTable s k v
</span><a href="Data.HashTable.ST.Linear.html#HT"><span class="hs-identifier hs-var">HT</span></a></span><span> </span><span class="annot"><span class="annottext">(ST s (STRef s (HashTable_ s k v)) -&gt; ST s (HashTable s k v))
-&gt; (HashTable_ s k v -&gt; ST s (STRef s (HashTable_ s k v)))
-&gt; HashTable_ s k v
-&gt; ST s (HashTable s k v)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (STRef s (HashTable_ s k v))
forall a s. a -&gt; ST s (STRef s a)
</span><span class="hs-identifier hs-var">newSTRef</span></span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span id="local-6989586621679086879"><span id="local-6989586621679086880"><span id="local-6989586621679086881"><span class="annot"><a href="Data.HashTable.ST.Linear.html#writeRef"><span class="hs-identifier hs-type">writeRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086879"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086880"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086881"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086879"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086880"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086881"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679086879"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-482"></span><span id="writeRef"><span class="annot"><span class="annottext">writeRef :: forall s k v. HashTable s k v -&gt; HashTable_ s k v -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#writeRef"><span class="hs-identifier hs-var hs-var">writeRef</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HT"><span class="hs-identifier hs-type">HT</span></a></span><span> </span><span id="local-6989586621679087598"><span class="annot"><span class="annottext">STRef s (HashTable_ s k v)
</span><a href="#local-6989586621679087598"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679087599"><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679087599"><span class="hs-identifier hs-var">ht</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STRef s (HashTable_ s k v) -&gt; HashTable_ s k v -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s (HashTable_ s k v)
</span><a href="#local-6989586621679087598"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679087599"><span class="hs-identifier hs-var">ht</span></a></span><span>
</span><span id="line-483"></span><span>
</span><span id="line-484"></span><span id="local-6989586621679086846"><span id="local-6989586621679086847"><span id="local-6989586621679086848"><span class="annot"><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier hs-type">readRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086846"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086847"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086848"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679086846"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086846"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086847"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679086848"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-485"></span><span id="readRef"><span class="annot"><span class="annottext">readRef :: forall s k v. HashTable s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier hs-var hs-var">readRef</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HT"><span class="hs-identifier hs-type">HT</span></a></span><span> </span><span id="local-6989586621679087601"><span class="annot"><span class="annottext">STRef s (HashTable_ s k v)
</span><a href="#local-6989586621679087601"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STRef s (HashTable_ s k v) -&gt; ST s (HashTable_ s k v)
forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s (HashTable_ s k v)
</span><a href="#local-6989586621679087601"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-489"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-pragma hs-type">debug</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-490"></span><span id="local-6989586621679086856"><span class="annot"><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679086856"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span class="hs-cpp">

#ifdef DEBUG
</span><span class="hs-identifier">debug</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeIOToST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-494"></span><span>              </span><span class="hs-identifier">putStrLn</span><span> </span><span class="hs-identifier">s</span><span>
</span><span id="line-495"></span><span>              </span><span class="hs-identifier">hFlush</span><span> </span><span class="hs-identifier">stdout</span><span class="hs-cpp">
#else
</span><span class="hs-cpp">#ifdef TESTSUITE
</span><span class="hs-identifier">debug</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-499"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">s</span><span>
</span><span id="line-500"></span><span>    </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span id="debug"><span class="annot"><span class="annottext">debug :: forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var hs-var">debug</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ST s ()
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">#endif
</span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-508"></span><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><span id="line-509"></span><span class="hs-comment">-- &quot;Data.HashTable.Class#v:lookupIndex&quot;.</span><span>
</span><span id="line-510"></span><span id="local-6989586621679087604"><span id="local-6989586621679087605"><span id="local-6989586621679087606"><span class="annot"><a href="Data.HashTable.ST.Linear.html#lookupIndex"><span class="hs-identifier hs-type">lookupIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679087604"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679087604"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087605"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087604"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087606"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679087604"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679087605"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-511"></span><span id="lookupIndex"><span class="annot"><span class="annottext">lookupIndex :: forall k s v.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; ST s (Maybe Word)
</span><a href="Data.HashTable.ST.Linear.html#lookupIndex"><span class="hs-identifier hs-var hs-var">lookupIndex</span></a></span></span><span> </span><span id="local-6989586621679087610"><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087610"><span class="hs-identifier hs-var">htRef</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087611"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087611"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; ST s (HashTable_ s k v)
forall s k v. HashTable s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier hs-var">readRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087610"><span class="hs-identifier hs-var">htRef</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (HashTable_ s k v)
-&gt; (HashTable_ s k v -&gt; ST s (Maybe Word)) -&gt; ST s (Maybe Word)
forall a b. ST s a -&gt; (a -&gt; ST s b) -&gt; ST s b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (Maybe Word)
forall {s} {k} {v}. HashTable_ s k v -&gt; ST s (Maybe Word)
</span><a href="#local-6989586621679087612"><span class="hs-identifier hs-var">work</span></a></span><span>
</span><span id="line-512"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-513"></span><span>    </span><span id="local-6989586621679087612"><span class="annot"><span class="annottext">work :: HashTable_ s k v -&gt; ST s (Maybe Word)
</span><a href="#local-6989586621679087612"><span class="hs-identifier hs-var hs-var">work</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span id="local-6989586621679087619"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087619"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span id="local-6989586621679087620"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087620"><span class="hs-identifier hs-var">splitptr</span></a></span></span><span> </span><span id="local-6989586621679087621"><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087621"><span class="hs-identifier hs-var">buckets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-514"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679087624"><span class="annot"><span class="annottext">h0 :: Int
</span><a href="#local-6989586621679087624"><span class="hs-identifier hs-var hs-var">h0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; k -&gt; Int
forall k. Hashable k =&gt; Int -&gt; Int -&gt; k -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#hashKey"><span class="hs-identifier hs-var">hashKey</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087619"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087620"><span class="hs-identifier hs-var">splitptr</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087611"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-515"></span><span>        </span><span id="local-6989586621679087625"><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087625"><span class="hs-identifier hs-var">bucket</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v) -&gt; Int -&gt; ST s (Bucket s k v)
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087621"><span class="hs-identifier hs-var">buckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087624"><span class="hs-identifier hs-var">h0</span></a></span><span>
</span><span id="line-516"></span><span>        </span><span id="local-6989586621679087626"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679087626"><span class="hs-identifier hs-var">mbIx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bucket s k v -&gt; k -&gt; ST s (Maybe Int)
forall k s v. Eq k =&gt; Bucket s k v -&gt; k -&gt; ST s (Maybe Int)
</span><a href="Data.HashTable.Internal.Linear.Bucket.html#lookupIndex"><span class="hs-identifier hs-var">Bucket.lookupIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087625"><span class="hs-identifier hs-var">bucket</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679087611"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-517"></span><span>        </span><span class="annot"><span class="annottext">Maybe Word -&gt; ST s (Maybe Word)
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Word -&gt; ST s (Maybe Word))
-&gt; Maybe Word -&gt; ST s (Maybe Word)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679087629"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087629"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679087626"><span class="hs-identifier hs-var">mbIx</span></a></span><span>
</span><span id="line-518"></span><span>                     </span><span class="annot"><span class="annottext">Word -&gt; Maybe Word
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Maybe Word) -&gt; Word -&gt; Maybe Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; Word
</span><a href="Data.HashTable.ST.Linear.html#encodeIndex"><span class="hs-identifier hs-var">encodeIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087619"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087624"><span class="hs-identifier hs-var">h0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087629"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-519"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#lookupIndex"><span class="hs-pragma hs-type">lookupIndex</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span class="annot"><a href="Data.HashTable.ST.Linear.html#encodeIndex"><span class="hs-identifier hs-type">encodeIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span>
</span><span id="line-522"></span><span id="encodeIndex"><span class="annot"><span class="annottext">encodeIndex :: Int -&gt; Int -&gt; Int -&gt; Word
</span><a href="Data.HashTable.ST.Linear.html#encodeIndex"><span class="hs-identifier hs-var hs-var">encodeIndex</span></a></span></span><span> </span><span id="local-6989586621679087631"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087631"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span id="local-6989586621679087632"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087632"><span class="hs-identifier hs-var">bucketIx</span></a></span></span><span> </span><span id="local-6989586621679087633"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087633"><span class="hs-identifier hs-var">elemIx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-523"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087632"><span class="hs-identifier hs-var">bucketIx</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`Data.Bits.shiftL`</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#indexOffset"><span class="hs-identifier hs-var">indexOffset</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087631"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span>
</span><span id="line-524"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087633"><span class="hs-identifier hs-var">elemIx</span></a></span><span>
</span><span id="line-525"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#encodeIndex"><span class="hs-pragma hs-type">encodeIndex</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span class="annot"><a href="Data.HashTable.ST.Linear.html#decodeIndex"><span class="hs-identifier hs-type">decodeIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-528"></span><span id="decodeIndex"><span class="annot"><span class="annottext">decodeIndex :: Int -&gt; Word -&gt; (Int, Int)
</span><a href="Data.HashTable.ST.Linear.html#decodeIndex"><span class="hs-identifier hs-var hs-var">decodeIndex</span></a></span></span><span> </span><span id="local-6989586621679087638"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087638"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span id="local-6989586621679087639"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679087639"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-529"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679087639"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`Data.Bits.shiftR`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087641"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word
forall a. Bits a =&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">bit</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087641"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679087639"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679087641"><span class="annot"><span class="annottext">offset :: Int
</span><a href="#local-6989586621679087641"><span class="hs-identifier hs-var hs-var">offset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#indexOffset"><span class="hs-identifier hs-var">indexOffset</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087638"><span class="hs-identifier hs-var">lvl</span></a></span><span>
</span><span id="line-533"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#decodeIndex"><span class="hs-pragma hs-type">decodeIndex</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span class="annot"><a href="Data.HashTable.ST.Linear.html#indexOffset"><span class="hs-identifier hs-type">indexOffset</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-536"></span><span id="indexOffset"><span class="annot"><span class="annottext">indexOffset :: Int -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#indexOffset"><span class="hs-identifier hs-var hs-var">indexOffset</span></a></span></span><span> </span><span id="local-6989586621679087643"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087643"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int
forall b. FiniteBits b =&gt; b -&gt; Int
</span><span class="hs-identifier hs-var">finiteBitSize</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087643"><span class="hs-identifier hs-var">lvl</span></a></span><span>
</span><span id="line-537"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#indexOffset"><span class="hs-pragma hs-type">indexOffset</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span id="local-6989586621679087645"><span id="local-6989586621679087646"><span id="local-6989586621679087647"><span class="annot"><a href="Data.HashTable.ST.Linear.html#nextByIndex"><span class="hs-identifier hs-type">nextByIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087645"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087646"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679087647"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679087645"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679087646"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679087647"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-540"></span><span id="nextByIndex"><span class="annot"><span class="annottext">nextByIndex :: forall s k v. HashTable s k v -&gt; Word -&gt; ST s (Maybe (Word, k, v))
</span><a href="Data.HashTable.ST.Linear.html#nextByIndex"><span class="hs-identifier hs-var hs-var">nextByIndex</span></a></span></span><span> </span><span id="local-6989586621679087649"><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087649"><span class="hs-identifier hs-var">htRef</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087650"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679087650"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; ST s (HashTable_ s k v)
forall s k v. HashTable s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier hs-var">readRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679087649"><span class="hs-identifier hs-var">htRef</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (HashTable_ s k v)
-&gt; (HashTable_ s k v -&gt; ST s (Maybe (Word, k, v)))
-&gt; ST s (Maybe (Word, k, v))
forall a b. ST s a -&gt; (a -&gt; ST s b) -&gt; ST s b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (Maybe (Word, k, v))
forall {s} {k} {v} {b} {c}.
HashTable_ s k v -&gt; ST s (Maybe (Word, b, c))
</span><a href="#local-6989586621679087651"><span class="hs-identifier hs-var">work</span></a></span><span>
</span><span id="line-541"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-542"></span><span>    </span><span id="local-6989586621679087651"><span class="annot"><span class="annottext">work :: HashTable_ s k v -&gt; ST s (Maybe (Word, b, c))
</span><a href="#local-6989586621679087651"><span class="hs-identifier hs-var hs-var">work</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span id="local-6989586621679087652"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087652"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679087653"><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087653"><span class="hs-identifier hs-var">buckets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-543"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679087654"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087654"><span class="hs-identifier hs-var">h0</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679087655"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087655"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word -&gt; (Int, Int)
</span><a href="Data.HashTable.ST.Linear.html#decodeIndex"><span class="hs-identifier hs-var">decodeIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087652"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679087650"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-544"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; ST s (Maybe (Word, b, c))
forall {b} {c}. Int -&gt; Int -&gt; ST s (Maybe (Word, b, c))
</span><a href="#local-6989586621679087656"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087654"><span class="hs-identifier hs-var">h0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087655"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-545"></span><span>
</span><span id="line-546"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-547"></span><span>        </span><span id="local-6989586621679087657"><span class="annot"><span class="annottext">bucketN :: Int
</span><a href="#local-6989586621679087657"><span class="hs-identifier hs-var hs-var">bucketN</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087652"><span class="hs-identifier hs-var">lvl</span></a></span><span>
</span><span id="line-548"></span><span>        </span><span id="local-6989586621679087656"><span class="annot"><span class="annottext">go :: Int -&gt; Int -&gt; ST s (Maybe (Word, b, c))
</span><a href="#local-6989586621679087656"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679087668"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087668"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679087669"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087669"><span class="hs-identifier hs-var">ix</span></a></span></span><span>
</span><span id="line-549"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087668"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087657"><span class="hs-identifier hs-var">bucketN</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087668"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Word, b, c) -&gt; ST s (Maybe (Word, b, c))
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Word, b, c)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-550"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-551"></span><span>              </span><span id="local-6989586621679087672"><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087672"><span class="hs-identifier hs-var">bucket</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v) -&gt; Int -&gt; ST s (Bucket s k v)
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s (Bucket s k v)
</span><a href="#local-6989586621679087653"><span class="hs-identifier hs-var">buckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087668"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-552"></span><span>              </span><span id="local-6989586621679087673"><span class="annot"><span class="annottext">Maybe (b, c)
</span><a href="#local-6989586621679087673"><span class="hs-identifier hs-var">mb</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bucket s k v -&gt; Int -&gt; ST s (Maybe (b, c))
forall s k v. Bucket s k v -&gt; Int -&gt; ST s (Maybe (k, v))
</span><a href="Data.HashTable.Internal.Linear.Bucket.html#elemAt"><span class="hs-identifier hs-var">Bucket.elemAt</span></a></span><span> </span><span class="annot"><span class="annottext">Bucket s k v
</span><a href="#local-6989586621679087672"><span class="hs-identifier hs-var">bucket</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087669"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-553"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (b, c)
</span><a href="#local-6989586621679087673"><span class="hs-identifier hs-var">mb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-554"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679087675"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679087675"><span class="hs-identifier hs-var">k'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679087676"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679087676"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-555"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679087677"><span class="annot"><span class="annottext">ix' :: Word
</span><a href="#local-6989586621679087677"><span class="hs-identifier hs-var hs-var">ix'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; Word
</span><a href="Data.HashTable.ST.Linear.html#encodeIndex"><span class="hs-identifier hs-var">encodeIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087652"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087668"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087669"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-556"></span><span>                  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Maybe (Word, b, c) -&gt; ST s (Maybe (Word, b, c))
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Word, b, c) -&gt; Maybe (Word, b, c)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679087677"><span class="hs-identifier hs-var">ix'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679087675"><span class="hs-identifier hs-var">k'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679087676"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span>                </span><span class="annot"><span class="annottext">Maybe (b, c)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; ST s (Maybe (Word, b, c))
</span><a href="#local-6989586621679087656"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679087668"><span class="hs-identifier hs-var">h</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-558"></span><span>
</span><span id="line-559"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Linear.html#nextByIndex"><span class="hs-pragma hs-type">nextByIndex</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-560"></span></pre></body></html>