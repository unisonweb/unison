<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.HashTable.Internal.CheapPseudoRandomBitStream</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#BitStream"><span class="hs-identifier">BitStream</span></a></span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#newBitStream"><span class="hs-identifier">newBitStream</span></a></span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#getNextBit"><span class="hs-identifier">getNextBit</span></a></span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#getNBits"><span class="hs-identifier">getNBits</span></a></span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.ST</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Bits</span></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(.&amp;.)</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.STRef</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Vector.Unboxed</span></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Vector</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Unboxed</span></span><span>           </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Word32</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Word64</span></span><span class="hs-special">)</span><span class="hs-cpp">
#if !MIN_VERSION_base(4,8,0)
</span><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Word</span><span>                     </span><span class="hs-special">(</span><span class="hs-identifier">Word</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.HashTable.Internal.Utils.html"><span class="hs-identifier">Data.HashTable.Internal.Utils</span></a></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- Chosen by fair dice roll. Guaranteed random. More importantly, there are an</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- equal number of 0 and 1 bits in both of these vectors.</span><span>
</span><span id="line-29"></span><span class="annot"><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#random32s"><span class="hs-identifier hs-type">random32s</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span>
</span><span id="line-30"></span><span id="random32s"><span class="annot"><span class="annottext">random32s :: Vector Word32
</span><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#random32s"><span class="hs-identifier hs-var hs-var">random32s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Word32] -&gt; Vector Word32
forall a. Unbox a =&gt; [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">V.fromList</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0xe293c315</span></span><span>
</span><span id="line-31"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0x82e2ff62</span></span><span>
</span><span id="line-32"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0xcb1ef9ae</span></span><span>
</span><span id="line-33"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0x78850172</span></span><span>
</span><span id="line-34"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0x551ee1ce</span></span><span>
</span><span id="line-35"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0x59d6bfd1</span></span><span>
</span><span id="line-36"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0xb717ec44</span></span><span>
</span><span id="line-37"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0xe7a3024e</span></span><span>
</span><span id="line-38"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0x02bb8976</span></span><span>
</span><span id="line-39"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0x87e2f94f</span></span><span>
</span><span id="line-40"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0xfa156372</span></span><span>
</span><span id="line-41"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0xe1325b17</span></span><span>
</span><span id="line-42"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0xe005642a</span></span><span>
</span><span id="line-43"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0xc8d02eb3</span></span><span>
</span><span id="line-44"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0xe90c0a87</span></span><span>
</span><span id="line-45"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0x4cb9e6e2</span></span><span>
</span><span id="line-46"></span><span>                       </span><span class="hs-special">]</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-50"></span><span class="annot"><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#random64s"><span class="hs-identifier hs-type">random64s</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-51"></span><span id="random64s"><span class="annot"><span class="annottext">random64s :: Vector Word64
</span><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#random64s"><span class="hs-identifier hs-var hs-var">random64s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Word64] -&gt; Vector Word64
forall a. Unbox a =&gt; [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">V.fromList</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0x62ef447e007e8732</span></span><span>
</span><span id="line-52"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0x149d6acb499feef8</span></span><span>
</span><span id="line-53"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0xca7725f9b404fbf8</span></span><span>
</span><span id="line-54"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0x4b5dfad194e626a9</span></span><span>
</span><span id="line-55"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0x6d76f2868359491b</span></span><span>
</span><span id="line-56"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0x6b2284e3645dcc87</span></span><span>
</span><span id="line-57"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0x5b89b485013eaa16</span></span><span>
</span><span id="line-58"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0x6e2d4308250c435b</span></span><span>
</span><span id="line-59"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0xc31e641a659e0013</span></span><span>
</span><span id="line-60"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0xe237b85e9dc7276d</span></span><span>
</span><span id="line-61"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0x0b3bb7fa40d94f3f</span></span><span>
</span><span id="line-62"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0x4da446874d4ca023</span></span><span>
</span><span id="line-63"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0x69240623fedbd26b</span></span><span>
</span><span id="line-64"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0x76fb6810dcf894d3</span></span><span>
</span><span id="line-65"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0xa0da4e0ce57c8ea7</span></span><span>
</span><span id="line-66"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0xeb76b84453dc3873</span></span><span>
</span><span id="line-67"></span><span>                       </span><span class="hs-special">]</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-71"></span><span class="annot"><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#numRandoms"><span class="hs-identifier hs-type">numRandoms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-72"></span><span id="numRandoms"><span class="annot"><span class="annottext">numRandoms :: Int
</span><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#numRandoms"><span class="hs-identifier hs-var hs-var">numRandoms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-76"></span><span class="annot"><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#randoms"><span class="hs-identifier hs-type">randoms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span>
</span><span id="line-77"></span><span id="randoms"><span class="annot"><span class="annottext">randoms :: Vector Word
</span><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#randoms"><span class="hs-identifier hs-var hs-var">randoms</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Data.HashTable.Internal.Utils.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Word) -&gt; Vector Word32 -&gt; Vector Word
forall a b. (Unbox a, Unbox b) =&gt; (a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><span class="hs-identifier hs-var">V.map</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Vector Word32
</span><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#random32s"><span class="hs-identifier hs-var">random32s</span></a></span><span>
</span><span id="line-78"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Word) -&gt; Vector Word64 -&gt; Vector Word
forall a b. (Unbox a, Unbox b) =&gt; (a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><span class="hs-identifier hs-var">V.map</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Vector Word64
</span><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#random64s"><span class="hs-identifier hs-var">random64s</span></a></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-82"></span><span class="hs-keyword">data</span><span> </span><span id="BitStream"><span class="annot"><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#BitStream"><span class="hs-identifier hs-var">BitStream</span></a></span></span><span> </span><span id="local-6989586621679083609"><span class="annot"><a href="#local-6989586621679083609"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BitStream"><span class="annot"><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#BitStream"><span class="hs-identifier hs-var">BitStream</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-83"></span><span>      </span><span id="_curRandom"><span class="annot"><span class="annottext">forall s. BitStream s -&gt; STRef s Word
</span><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#_curRandom"><span class="hs-identifier hs-var hs-var">_curRandom</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STRef</span></span><span> </span><span class="annot"><a href="#local-6989586621679083609"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_bitsLeft"><span class="annot"><span class="annottext">forall s. BitStream s -&gt; STRef s Int
</span><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#_bitsLeft"><span class="hs-identifier hs-var hs-var">_bitsLeft</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STRef</span></span><span> </span><span class="annot"><a href="#local-6989586621679083609"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_randomPos"><span class="annot"><span class="annottext">forall s. BitStream s -&gt; STRef s Int
</span><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#_randomPos"><span class="hs-identifier hs-var hs-var">_randomPos</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STRef</span></span><span> </span><span class="annot"><a href="#local-6989586621679083609"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-90"></span><span id="local-6989586621679083615"><span class="annot"><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#newBitStream"><span class="hs-identifier hs-type">newBitStream</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679083615"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#BitStream"><span class="hs-identifier hs-type">BitStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083615"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-91"></span><span id="newBitStream"><span class="annot"><span class="annottext">newBitStream :: forall s. ST s (BitStream s)
</span><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#newBitStream"><span class="hs-identifier hs-var hs-var">newBitStream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><span class="annottext">WrappedMonad (ST s) (BitStream s) -&gt; ST s (BitStream s)
forall (m :: * -&gt; *) a. WrappedMonad m a -&gt; m a
</span><span class="hs-identifier hs-var">unwrapMonad</span></span><span> </span><span class="annot"><span class="annottext">(WrappedMonad (ST s) (BitStream s) -&gt; ST s (BitStream s))
-&gt; WrappedMonad (ST s) (BitStream s) -&gt; ST s (BitStream s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><span class="annottext">STRef s Word -&gt; STRef s Int -&gt; STRef s Int -&gt; BitStream s
forall s. STRef s Word -&gt; STRef s Int -&gt; STRef s Int -&gt; BitStream s
</span><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#BitStream"><span class="hs-identifier hs-var">BitStream</span></a></span><span> </span><span class="annot"><span class="annottext">(STRef s Word -&gt; STRef s Int -&gt; STRef s Int -&gt; BitStream s)
-&gt; WrappedMonad (ST s) (STRef s Word)
-&gt; WrappedMonad (ST s) (STRef s Int -&gt; STRef s Int -&gt; BitStream s)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ST s (STRef s Word) -&gt; WrappedMonad (ST s) (STRef s Word)
forall (m :: * -&gt; *) a. m a -&gt; WrappedMonad m a
</span><span class="hs-identifier hs-var">WrapMonad</span></span><span> </span><span class="annot"><span class="annottext">(ST s (STRef s Word) -&gt; WrappedMonad (ST s) (STRef s Word))
-&gt; ST s (STRef s Word) -&gt; WrappedMonad (ST s) (STRef s Word)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; ST s (STRef s Word)
forall a s. a -&gt; ST s (STRef s a)
</span><span class="hs-identifier hs-var">newSTRef</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; ST s (STRef s Word)) -&gt; Word -&gt; ST s (STRef s Word)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Vector Word -&gt; Int -&gt; Word
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">V.unsafeIndex</span></span><span> </span><span class="annot"><span class="annottext">Vector Word
</span><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#randoms"><span class="hs-identifier hs-var">randoms</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>              </span><span class="annot"><span class="annottext">WrappedMonad (ST s) (STRef s Int -&gt; STRef s Int -&gt; BitStream s)
-&gt; WrappedMonad (ST s) (STRef s Int)
-&gt; WrappedMonad (ST s) (STRef s Int -&gt; BitStream s)
forall a b.
WrappedMonad (ST s) (a -&gt; b)
-&gt; WrappedMonad (ST s) a -&gt; WrappedMonad (ST s) b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ST s (STRef s Int) -&gt; WrappedMonad (ST s) (STRef s Int)
forall (m :: * -&gt; *) a. m a -&gt; WrappedMonad m a
</span><span class="hs-identifier hs-var">WrapMonad</span></span><span> </span><span class="annot"><span class="annottext">(ST s (STRef s Int) -&gt; WrappedMonad (ST s) (STRef s Int))
-&gt; ST s (STRef s Int) -&gt; WrappedMonad (ST s) (STRef s Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (STRef s Int)
forall a s. a -&gt; ST s (STRef s a)
</span><span class="hs-identifier hs-var">newSTRef</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Data.HashTable.Internal.Utils.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>              </span><span class="annot"><span class="annottext">WrappedMonad (ST s) (STRef s Int -&gt; BitStream s)
-&gt; WrappedMonad (ST s) (STRef s Int)
-&gt; WrappedMonad (ST s) (BitStream s)
forall a b.
WrappedMonad (ST s) (a -&gt; b)
-&gt; WrappedMonad (ST s) a -&gt; WrappedMonad (ST s) b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ST s (STRef s Int) -&gt; WrappedMonad (ST s) (STRef s Int)
forall (m :: * -&gt; *) a. m a -&gt; WrappedMonad m a
</span><span class="hs-identifier hs-var">WrapMonad</span></span><span> </span><span class="annot"><span class="annottext">(ST s (STRef s Int) -&gt; WrappedMonad (ST s) (STRef s Int))
-&gt; ST s (STRef s Int) -&gt; WrappedMonad (ST s) (STRef s Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (STRef s Int)
forall a s. a -&gt; ST s (STRef s a)
</span><span class="hs-identifier hs-var">newSTRef</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-99"></span><span id="local-6989586621679083638"><span class="annot"><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#getNextBit"><span class="hs-identifier hs-type">getNextBit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#BitStream"><span class="hs-identifier hs-type">BitStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083638"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679083638"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span></span><span>
</span><span id="line-100"></span><span id="getNextBit"><span class="annot"><span class="annottext">getNextBit :: forall s. BitStream s -&gt; ST s Word
</span><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#getNextBit"><span class="hs-identifier hs-var hs-var">getNextBit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; BitStream s -&gt; ST s Word
forall s. Int -&gt; BitStream s -&gt; ST s Word
</span><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#getNBits"><span class="hs-identifier hs-var">getNBits</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-104"></span><span id="local-6989586621679083640"><span class="annot"><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#getNBits"><span class="hs-identifier hs-type">getNBits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#BitStream"><span class="hs-identifier hs-type">BitStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083640"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679083640"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span></span><span>
</span><span id="line-105"></span><span id="getNBits"><span class="annot"><span class="annottext">getNBits :: forall s. Int -&gt; BitStream s -&gt; ST s Word
</span><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#getNBits"><span class="hs-identifier hs-var hs-var">getNBits</span></a></span></span><span> </span><span id="local-6989586621679083738"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679083738"><span class="hs-identifier hs-var">nbits</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#BitStream"><span class="hs-identifier hs-type">BitStream</span></a></span><span> </span><span id="local-6989586621679083739"><span class="annot"><span class="annottext">STRef s Word
</span><a href="#local-6989586621679083739"><span class="hs-identifier hs-var">crRef</span></a></span></span><span> </span><span id="local-6989586621679083740"><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621679083740"><span class="hs-identifier hs-var">blRef</span></a></span></span><span> </span><span id="local-6989586621679083741"><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621679083741"><span class="hs-identifier hs-var">rpRef</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679083742"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679083742"><span class="hs-identifier hs-var">bl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STRef s Int -&gt; ST s Int
forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621679083740"><span class="hs-identifier hs-var">blRef</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679083742"><span class="hs-identifier hs-var">bl</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679083738"><span class="hs-identifier hs-var">nbits</span></a></span><span>
</span><span id="line-108"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ST s Word
</span><a href="#local-6989586621679083745"><span class="hs-identifier hs-var">newWord</span></a></span><span>
</span><span id="line-109"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s Word
</span><a href="#local-6989586621679083746"><span class="hs-identifier hs-var">nextBits</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679083742"><span class="hs-identifier hs-var">bl</span></a></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-112"></span><span>    </span><span id="local-6989586621679083745"><span class="annot"><span class="annottext">newWord :: ST s Word
</span><a href="#local-6989586621679083745"><span class="hs-identifier hs-var hs-var">newWord</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-113"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679083757"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679083757"><span class="hs-identifier hs-var">rp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STRef s Int -&gt; ST s Int
forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621679083741"><span class="hs-identifier hs-var">rpRef</span></a></span><span>
</span><span id="line-114"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679083759"><span class="annot"><span class="annottext">r :: Word
</span><a href="#local-6989586621679083759"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Word -&gt; Int -&gt; Word
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">V.unsafeIndex</span></span><span> </span><span class="annot"><span class="annottext">Vector Word
</span><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#randoms"><span class="hs-identifier hs-var">randoms</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679083757"><span class="hs-identifier hs-var">rp</span></a></span><span>
</span><span id="line-115"></span><span>        </span><span class="annot"><span class="annottext">STRef s Int -&gt; Int -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621679083740"><span class="hs-identifier hs-var">blRef</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ST s ()) -&gt; Int -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Data.HashTable.Internal.Utils.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679083738"><span class="hs-identifier hs-var">nbits</span></a></span><span>
</span><span id="line-116"></span><span>        </span><span class="annot"><span class="annottext">STRef s Int -&gt; Int -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621679083741"><span class="hs-identifier hs-var">rpRef</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ST s ()) -&gt; Int -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679083757"><span class="hs-identifier hs-var">rp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="Data.HashTable.Internal.CheapPseudoRandomBitStream.html#numRandoms"><span class="hs-identifier hs-var">numRandoms</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679083757"><span class="hs-identifier hs-var">rp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-117"></span><span>        </span><span class="annot"><span class="annottext">Word -&gt; ST s Word
</span><a href="#local-6989586621679083763"><span class="hs-identifier hs-var">extractBits</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679083759"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>    </span><span id="local-6989586621679083763"><span class="annot"><span class="annottext">extractBits :: Word -&gt; ST s Word
</span><a href="#local-6989586621679083763"><span class="hs-identifier hs-var hs-var">extractBits</span></a></span></span><span> </span><span id="local-6989586621679083766"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679083766"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-120"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679083771"><span class="annot"><span class="annottext">b :: Word
</span><a href="#local-6989586621679083771"><span class="hs-identifier hs-var hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679083766"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
</span><a href="Data.HashTable.Internal.Utils.html#shiftL"><span class="hs-operator hs-var">`shiftL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679083738"><span class="hs-identifier hs-var">nbits</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>        </span><span class="annot"><span class="annottext">STRef s Word -&gt; Word -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Word
</span><a href="#local-6989586621679083739"><span class="hs-identifier hs-var">crRef</span></a></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; ST s ()) -&gt; Word -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679083766"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
</span><a href="Data.HashTable.Internal.Utils.html#shiftRL"><span class="hs-operator hs-var">`shiftRL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679083738"><span class="hs-identifier hs-var">nbits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>        </span><span class="annot"><span class="annottext">Word -&gt; ST s Word
forall a. a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679083771"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621679083746"><span class="annot"><span class="annottext">nextBits :: Int -&gt; ST s Word
</span><a href="#local-6989586621679083746"><span class="hs-identifier hs-var hs-var">nextBits</span></a></span></span><span> </span><span id="local-6989586621679083777"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679083777"><span class="hs-identifier hs-var">bl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-125"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679083778"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679083778"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STRef s Word -&gt; ST s Word
forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Word
</span><a href="#local-6989586621679083739"><span class="hs-identifier hs-var">crRef</span></a></span><span>
</span><span id="line-126"></span><span>        </span><span class="annot"><span class="annottext">STRef s Int -&gt; Int -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621679083740"><span class="hs-identifier hs-var">blRef</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ST s ()) -&gt; Int -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679083777"><span class="hs-identifier hs-var">bl</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679083738"><span class="hs-identifier hs-var">nbits</span></a></span><span>
</span><span id="line-127"></span><span>        </span><span class="annot"><span class="annottext">Word -&gt; ST s Word
</span><a href="#local-6989586621679083763"><span class="hs-identifier hs-var">extractBits</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679083778"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-128"></span></pre></body></html>