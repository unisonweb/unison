<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="annot"><span class="hs-comment">-- | A framework for parsing HTTP media type headers.</span></span><span>
</span><span id="line-2"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.HTTP.Media</span><span>
</span><span id="line-3"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Media types</span></span><span>
</span><span id="line-4"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.MediaType.Internal.html#MediaType"><span class="hs-identifier">MediaType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-5"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.MediaType.html#%2F%2F"><span class="hs-operator">(//)</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.MediaType.html#%2F%3A"><span class="hs-operator">(/:)</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.MediaType.html#mainType"><span class="hs-identifier">mainType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.MediaType.html#subType"><span class="hs-identifier">subType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.MediaType.html#parameters"><span class="hs-identifier">parameters</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.MediaType.html#%2F%3F"><span class="hs-operator">(/?)</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.MediaType.html#%2F."><span class="hs-operator">(/.)</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Charsets</span></span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.Charset.Internal.html#Charset"><span class="hs-identifier">Charset</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Encodings</span></span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.Encoding.Internal.html#Encoding"><span class="hs-identifier">Encoding</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Languages</span></span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.Language.Internal.html#Language"><span class="hs-identifier">Language</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.Language.html#toParts"><span class="hs-identifier">toParts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Accept matching</span></span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.html#matchAccept"><span class="hs-identifier">matchAccept</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.html#mapAccept"><span class="hs-identifier">mapAccept</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.html#mapAcceptMedia"><span class="hs-identifier">mapAcceptMedia</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.html#mapAcceptCharset"><span class="hs-identifier">mapAcceptCharset</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.html#mapAcceptEncoding"><span class="hs-identifier">mapAcceptEncoding</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.html#mapAcceptLanguage"><span class="hs-identifier">mapAcceptLanguage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.html#mapAcceptBytes"><span class="hs-identifier">mapAcceptBytes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Content matching</span></span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.html#matchContent"><span class="hs-identifier">matchContent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.html#mapContent"><span class="hs-identifier">mapContent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.html#mapContentMedia"><span class="hs-identifier">mapContentMedia</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.html#mapContentCharset"><span class="hs-identifier">mapContentCharset</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.html#mapContentEncoding"><span class="hs-identifier">mapContentEncoding</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.html#mapContentLanguage"><span class="hs-identifier">mapContentLanguage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Quality values</span></span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.Quality.html#Quality"><span class="hs-identifier">Quality</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Media.Quality.html#qualityData"><span class="hs-identifier">qualityData</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.Quality.html#quality"><span class="hs-identifier">quality</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.Quality.html#QualityOrder"><span class="hs-identifier">QualityOrder</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.Quality.html#qualityOrder"><span class="hs-identifier">qualityOrder</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.Quality.html#isAcceptable"><span class="hs-identifier">isAcceptable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.Quality.html#maxQuality"><span class="hs-identifier">maxQuality</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.Quality.html#minQuality"><span class="hs-identifier">minQuality</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.html#parseQuality"><span class="hs-identifier">parseQuality</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.html#matchQuality"><span class="hs-identifier">matchQuality</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.html#mapQuality"><span class="hs-identifier">mapQuality</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Accept</span></span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.Accept.html#Accept"><span class="hs-identifier">Accept</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Rendering</span></span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><a href="Network.HTTP.Media.RenderHeader.html#RenderHeader"><span class="hs-identifier">RenderHeader</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">where</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;|&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">guard</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&gt;=&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">find</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">foldl'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">maximumBy</span></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">on</span></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Proxy</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP.Media.Accept.html"><span class="hs-identifier">Network.HTTP.Media.Accept</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Accept</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP.Media.Charset.html"><span class="hs-identifier">Network.HTTP.Media.Charset</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Charset</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP.Media.Encoding.html"><span class="hs-identifier">Network.HTTP.Media.Encoding</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Encoding</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP.Media.Language.html"><span class="hs-identifier">Network.HTTP.Media.Language</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Language</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP.Media.MediaType.html"><span class="hs-identifier">Network.HTTP.Media.MediaType</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MediaType</span></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP.Media.Quality.html"><span class="hs-identifier">Network.HTTP.Media.Quality</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP.Media.RenderHeader.html"><span class="hs-identifier">Network.HTTP.Media.RenderHeader</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP.Media.Utils.html"><span class="hs-identifier">Network.HTTP.Media.Utils</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Media.Utils.html#trimBS"><span class="hs-identifier">trimBS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-comment">-- | Matches a list of server-side resource options against a quality-marked</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- list of client-side preferences. A result of 'Nothing' means that nothing</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- matched (which should indicate a 406 error). If two or more results arise</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- with the same quality level and specificity, then the first one in the</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- server list is chosen.</span><span>
</span><span id="line-82"></span><span class="hs-comment">--</span><span>
</span><span id="line-83"></span><span class="hs-comment">-- The use of the 'Accept' type class allows the application of either</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- 'MediaType' for the standard Accept header or 'ByteString' for any other</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- Accept header which can be marked with a quality value.</span><span>
</span><span id="line-86"></span><span class="hs-comment">--</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- &gt; matchAccept [&quot;text/html&quot;, &quot;application/json&quot;] &lt;$&gt; getHeader</span><span>
</span><span id="line-88"></span><span class="hs-comment">--</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- For more information on the matching process see RFC 2616, section 14.1-4.</span><span>
</span><span id="line-90"></span><span id="local-6989586621679050687"><span class="annot"><a href="Network.HTTP.Media.html#matchAccept"><span class="hs-identifier hs-type">matchAccept</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Media.Accept.html#Accept"><span class="hs-identifier hs-type">Accept</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679050687"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The server-side options</span></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679050687"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The client-side header value</span></span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679050687"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-97"></span><span id="matchAccept"><span class="annot"><span class="annottext">matchAccept :: forall a. Accept a =&gt; [a] -&gt; ByteString -&gt; Maybe a
</span><a href="Network.HTTP.Media.html#matchAccept"><span class="hs-identifier hs-var hs-var">matchAccept</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Maybe [Quality a]
forall a. Accept a =&gt; ByteString -&gt; Maybe [Quality a]
</span><a href="Network.HTTP.Media.html#parseQuality"><span class="hs-identifier hs-var">parseQuality</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe [Quality a])
-&gt; ([Quality a] -&gt; Maybe a) -&gt; ByteString -&gt; Maybe a
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Quality a] -&gt; Maybe a) -&gt; ByteString -&gt; Maybe a)
-&gt; ([a] -&gt; [Quality a] -&gt; Maybe a) -&gt; [a] -&gt; ByteString -&gt; Maybe a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [Quality a] -&gt; Maybe a
forall a. Accept a =&gt; [a] -&gt; [Quality a] -&gt; Maybe a
</span><a href="Network.HTTP.Media.html#matchQuality"><span class="hs-identifier hs-var">matchQuality</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- | The equivalent of 'matchAccept' above, except the resulting choice is</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- mapped to another value. Convenient for specifying how to translate the</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- resource into each of its available formats.</span><span>
</span><span id="line-102"></span><span class="hs-comment">--</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- &gt; getHeader &gt;&gt;= maybe render406Error renderResource . mapAccept</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- &gt;     [ (&quot;text&quot; // &quot;html&quot;,        asHtml)</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- &gt;     , (&quot;application&quot; // &quot;json&quot;, asJson)</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- &gt;     ]</span><span>
</span><span id="line-107"></span><span id="local-6989586621679050701"><span id="local-6989586621679050702"><span class="annot"><a href="Network.HTTP.Media.html#mapAccept"><span class="hs-identifier hs-type">mapAccept</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Media.Accept.html#Accept"><span class="hs-identifier hs-type">Accept</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679050701"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The map of server-side preferences to values</span></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679050701"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679050702"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The client-side header value</span></span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-113"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679050702"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-114"></span><span id="mapAccept"><span class="annot"><span class="annottext">mapAccept :: forall a b. Accept a =&gt; [(a, b)] -&gt; ByteString -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapAccept"><span class="hs-identifier hs-var hs-var">mapAccept</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Maybe [Quality a]
forall a. Accept a =&gt; ByteString -&gt; Maybe [Quality a]
</span><a href="Network.HTTP.Media.html#parseQuality"><span class="hs-identifier hs-var">parseQuality</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe [Quality a])
-&gt; ([Quality a] -&gt; Maybe b) -&gt; ByteString -&gt; Maybe b
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Quality a] -&gt; Maybe b) -&gt; ByteString -&gt; Maybe b)
-&gt; ([(a, b)] -&gt; [Quality a] -&gt; Maybe b)
-&gt; [(a, b)]
-&gt; ByteString
-&gt; Maybe b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(a, b)] -&gt; [Quality a] -&gt; Maybe b
forall a b. Accept a =&gt; [(a, b)] -&gt; [Quality a] -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapQuality"><span class="hs-identifier hs-var">mapQuality</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">-- | A specialisation of 'mapAccept' that only takes 'MediaType' as its input,</span><span>
</span><span id="line-117"></span><span class="hs-comment">-- to avoid ambiguous-type errors when using string literal overloading.</span><span>
</span><span id="line-118"></span><span class="hs-comment">--</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- &gt; getHeader &gt;&gt;= maybe render406Error renderResource . mapAcceptMedia</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- &gt;     [ (&quot;text/html&quot;,        asHtml)</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- &gt;     , (&quot;application/json&quot;, asJson)</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- &gt;     ]</span><span>
</span><span id="line-123"></span><span id="local-6989586621679050708"><span class="annot"><a href="Network.HTTP.Media.html#mapAcceptMedia"><span class="hs-identifier hs-type">mapAcceptMedia</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-124"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The map of server-side preferences to values</span></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Media.MediaType.Internal.html#MediaType"><span class="hs-identifier hs-type">MediaType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679050708"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The client-side header value</span></span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679050708"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-129"></span><span id="mapAcceptMedia"><span class="annot"><span class="annottext">mapAcceptMedia :: forall b. [(MediaType, b)] -&gt; ByteString -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapAcceptMedia"><span class="hs-identifier hs-var hs-var">mapAcceptMedia</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(MediaType, b)] -&gt; ByteString -&gt; Maybe b
forall a b. Accept a =&gt; [(a, b)] -&gt; ByteString -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapAccept"><span class="hs-identifier hs-var">mapAccept</span></a></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="hs-comment">-- | A specialisation of 'mapAccept' that only takes 'Charset' as its input,</span><span>
</span><span id="line-132"></span><span class="hs-comment">-- to avoid ambiguous-type errors when using string literal overloading.</span><span>
</span><span id="line-133"></span><span class="hs-comment">--</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- &gt; getHeader &gt;&gt;= maybe render406Error renderResource . mapAcceptCharset</span><span>
</span><span id="line-135"></span><span class="hs-comment">-- &gt;     [ (&quot;utf-8&quot;,    inUtf8)</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- &gt;     , (&quot;us-ascii&quot;, inAscii)</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- &gt;     ]</span><span>
</span><span id="line-138"></span><span id="local-6989586621679050711"><span class="annot"><a href="Network.HTTP.Media.html#mapAcceptCharset"><span class="hs-identifier hs-type">mapAcceptCharset</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-139"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The map of server-side preferences to values</span></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Media.Charset.Internal.html#Charset"><span class="hs-identifier hs-type">Charset</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679050711"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-141"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The client-side header value</span></span><span>
</span><span id="line-142"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-143"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679050711"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-144"></span><span id="mapAcceptCharset"><span class="annot"><span class="annottext">mapAcceptCharset :: forall b. [(Charset, b)] -&gt; ByteString -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapAcceptCharset"><span class="hs-identifier hs-var hs-var">mapAcceptCharset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Charset, b)] -&gt; ByteString -&gt; Maybe b
forall a b. Accept a =&gt; [(a, b)] -&gt; ByteString -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapAccept"><span class="hs-identifier hs-var">mapAccept</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-comment">-- | A specialisation of 'mapAccept' that only takes 'Encoding' as its input,</span><span>
</span><span id="line-147"></span><span class="hs-comment">-- to avoid ambiguous-type errors when using string literal overloading.</span><span>
</span><span id="line-148"></span><span class="hs-comment">--</span><span>
</span><span id="line-149"></span><span class="hs-comment">-- &gt; getHeader &gt;&gt;= maybe render406Error renderResource . mapAcceptEncoding</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- &gt;     [ (&quot;compress&quot;, compress)</span><span>
</span><span id="line-151"></span><span class="hs-comment">-- &gt;     , (&quot;identity&quot;, id)</span><span>
</span><span id="line-152"></span><span class="hs-comment">-- &gt;     ]</span><span>
</span><span id="line-153"></span><span id="local-6989586621679050714"><span class="annot"><a href="Network.HTTP.Media.html#mapAcceptEncoding"><span class="hs-identifier hs-type">mapAcceptEncoding</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-154"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The map of server-side preferences to values</span></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Media.Encoding.Internal.html#Encoding"><span class="hs-identifier hs-type">Encoding</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679050714"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-156"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The client-side header value</span></span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679050714"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-159"></span><span id="mapAcceptEncoding"><span class="annot"><span class="annottext">mapAcceptEncoding :: forall b. [(Encoding, b)] -&gt; ByteString -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapAcceptEncoding"><span class="hs-identifier hs-var hs-var">mapAcceptEncoding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Encoding, b)] -&gt; ByteString -&gt; Maybe b
forall a b. Accept a =&gt; [(a, b)] -&gt; ByteString -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapAccept"><span class="hs-identifier hs-var">mapAccept</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-comment">-- | A specialisation of 'mapAccept' that only takes 'Language' as its input,</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- to avoid ambiguous-type errors when using string literal overloading.</span><span>
</span><span id="line-163"></span><span class="hs-comment">--</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- &gt; getHeader &gt;&gt;= maybe render406Error renderResource . mapAcceptLanguage</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- &gt;     [ (&quot;en-gb&quot;, inBritishEnglish)</span><span>
</span><span id="line-166"></span><span class="hs-comment">-- &gt;     , (&quot;fr&quot;,    inFrench)</span><span>
</span><span id="line-167"></span><span class="hs-comment">-- &gt;     ]</span><span>
</span><span id="line-168"></span><span id="local-6989586621679050717"><span class="annot"><a href="Network.HTTP.Media.html#mapAcceptLanguage"><span class="hs-identifier hs-type">mapAcceptLanguage</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-169"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The map of server-side preferences to values</span></span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Media.Language.Internal.html#Language"><span class="hs-identifier hs-type">Language</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679050717"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-171"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The client-side header value</span></span><span>
</span><span id="line-172"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-173"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679050717"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-174"></span><span id="mapAcceptLanguage"><span class="annot"><span class="annottext">mapAcceptLanguage :: forall b. [(Language, b)] -&gt; ByteString -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapAcceptLanguage"><span class="hs-identifier hs-var hs-var">mapAcceptLanguage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Language, b)] -&gt; ByteString -&gt; Maybe b
forall a b. Accept a =&gt; [(a, b)] -&gt; ByteString -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapAccept"><span class="hs-identifier hs-var">mapAccept</span></a></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-comment">-- | A specialisation of 'mapAccept' that only takes 'ByteString' as its</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- input, to avoid ambiguous-type errors when using string literal</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- overloading.</span><span>
</span><span id="line-179"></span><span class="hs-comment">--</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- &gt; getHeader &gt;&gt;= maybe render406Error encodeResourceWith . mapAcceptBytes</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- &gt;     [ (&quot;abc&quot;, abc)</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- &gt;     , (&quot;xyz&quot;, xyz)</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- &gt;     ]</span><span>
</span><span id="line-184"></span><span id="local-6989586621679050719"><span class="annot"><a href="Network.HTTP.Media.html#mapAcceptBytes"><span class="hs-identifier hs-type">mapAcceptBytes</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-185"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The map of server-side preferences to values</span></span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679050719"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The client-side header value</span></span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-189"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679050719"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-190"></span><span id="mapAcceptBytes"><span class="annot"><span class="annottext">mapAcceptBytes :: forall b. [(ByteString, b)] -&gt; ByteString -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapAcceptBytes"><span class="hs-identifier hs-var hs-var">mapAcceptBytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ByteString, b)] -&gt; ByteString -&gt; Maybe b
forall a b. Accept a =&gt; [(a, b)] -&gt; ByteString -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapAccept"><span class="hs-identifier hs-var">mapAccept</span></a></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-comment">-- | Matches a list of server-side parsing options against a the client-side</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- content value. A result of 'Nothing' means that nothing matched (which</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- should indicate a 415 error).</span><span>
</span><span id="line-195"></span><span class="hs-comment">--</span><span>
</span><span id="line-196"></span><span class="hs-comment">-- &gt; matchContent [&quot;application/json&quot;, &quot;text/plain&quot;] &lt;$&gt; getContentType</span><span>
</span><span id="line-197"></span><span class="hs-comment">--</span><span>
</span><span id="line-198"></span><span class="hs-comment">-- For more information on the matching process see RFC 2616, section 14.17.</span><span>
</span><span id="line-199"></span><span id="local-6989586621679050871"><span class="annot"><a href="Network.HTTP.Media.html#matchContent"><span class="hs-identifier hs-type">matchContent</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-200"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Media.Accept.html#Accept"><span class="hs-identifier hs-type">Accept</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679050871"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The server-side response options</span></span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679050871"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-203"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The client's request value</span></span><span>
</span><span id="line-204"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-205"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679050871"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-206"></span><span id="matchContent"><span class="annot"><span class="annottext">matchContent :: forall a. Accept a =&gt; [a] -&gt; ByteString -&gt; Maybe a
</span><a href="Network.HTTP.Media.html#matchContent"><span class="hs-identifier hs-var hs-var">matchContent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; [a] -&gt; ByteString -&gt; Maybe a
forall b a. Accept b =&gt; (a -&gt; b) -&gt; [a] -&gt; ByteString -&gt; Maybe a
</span><a href="Network.HTTP.Media.html#findMatch"><span class="hs-identifier hs-var">findMatch</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-comment">-- | The equivalent of 'matchContent' above, except the resulting choice is</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- mapped to another value.</span><span>
</span><span id="line-210"></span><span class="hs-comment">--</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- &gt; getContentType &gt;&gt;= maybe send415Error readRequestBodyWith . mapContent</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- &gt;     [ (&quot;application&quot; // &quot;json&quot;, parseJson)</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- &gt;     , (&quot;text&quot; // &quot;plain&quot;,       parseText)</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- &gt;     ]</span><span>
</span><span id="line-215"></span><span id="local-6989586621679050876"><span id="local-6989586621679050877"><span class="annot"><a href="Network.HTTP.Media.html#mapContent"><span class="hs-identifier hs-type">mapContent</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Media.Accept.html#Accept"><span class="hs-identifier hs-type">Accept</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679050876"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-217"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The map of server-side responses</span></span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679050876"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679050877"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-219"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The client request's header value</span></span><span>
</span><span id="line-220"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-221"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679050877"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-222"></span><span id="mapContent"><span class="annot"><span class="annottext">mapContent :: forall a b. Accept a =&gt; [(a, b)] -&gt; ByteString -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapContent"><span class="hs-identifier hs-var hs-var">mapContent</span></a></span></span><span> </span><span id="local-6989586621679050882"><span class="annot"><span class="annottext">[(a, b)]
</span><a href="#local-6989586621679050882"><span class="hs-identifier hs-var">options</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, b) -&gt; b) -&gt; Maybe (a, b) -&gt; Maybe b
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(a, b) -&gt; b
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (a, b) -&gt; Maybe b)
-&gt; (ByteString -&gt; Maybe (a, b)) -&gt; ByteString -&gt; Maybe b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((a, b) -&gt; a) -&gt; [(a, b)] -&gt; ByteString -&gt; Maybe (a, b)
forall b a. Accept b =&gt; (a -&gt; b) -&gt; [a] -&gt; ByteString -&gt; Maybe a
</span><a href="Network.HTTP.Media.html#findMatch"><span class="hs-identifier hs-var">findMatch</span></a></span><span> </span><span class="annot"><span class="annottext">(a, b) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(a, b)]
</span><a href="#local-6989586621679050882"><span class="hs-identifier hs-var">options</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="hs-comment">-- | A specialisation of 'mapContent' that only takes 'MediaType' as its</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- input, to avoid ambiguous-type errors when using string literal</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- overloading.</span><span>
</span><span id="line-227"></span><span class="hs-comment">--</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- &gt; getContentType &gt;&gt;=</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- &gt;     maybe send415Error readRequestBodyWith . mapContentMedia</span><span>
</span><span id="line-230"></span><span class="hs-comment">-- &gt;         [ (&quot;application/json&quot;, parseJson)</span><span>
</span><span id="line-231"></span><span class="hs-comment">-- &gt;         , (&quot;text/plain&quot;,       parseText)</span><span>
</span><span id="line-232"></span><span class="hs-comment">-- &gt;         ]</span><span>
</span><span id="line-233"></span><span id="local-6989586621679050885"><span class="annot"><a href="Network.HTTP.Media.html#mapContentMedia"><span class="hs-identifier hs-type">mapContentMedia</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-234"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The map of server-side responses</span></span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Media.MediaType.Internal.html#MediaType"><span class="hs-identifier hs-type">MediaType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679050885"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-236"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The client request's header value</span></span><span>
</span><span id="line-237"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679050885"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-239"></span><span id="mapContentMedia"><span class="annot"><span class="annottext">mapContentMedia :: forall b. [(MediaType, b)] -&gt; ByteString -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapContentMedia"><span class="hs-identifier hs-var hs-var">mapContentMedia</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(MediaType, b)] -&gt; ByteString -&gt; Maybe b
forall a b. Accept a =&gt; [(a, b)] -&gt; ByteString -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapContent"><span class="hs-identifier hs-var">mapContent</span></a></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="hs-comment">-- | A specialisation of 'mapContent' that only takes 'Charset' as its input,</span><span>
</span><span id="line-242"></span><span class="hs-comment">-- to avoid ambiguous-type errors when using string literal overloading.</span><span>
</span><span id="line-243"></span><span class="hs-comment">--</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- &gt; getContentCharset &gt;&gt;=</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- &gt;     maybe send415Error readRequestBodyWith . mapContentCharset</span><span>
</span><span id="line-246"></span><span class="hs-comment">-- &gt;         [ (&quot;utf-8&quot;,    parseUtf8)</span><span>
</span><span id="line-247"></span><span class="hs-comment">-- &gt;         , (&quot;us-ascii&quot;, parseAscii)</span><span>
</span><span id="line-248"></span><span class="hs-comment">-- &gt;         ]</span><span>
</span><span id="line-249"></span><span id="local-6989586621679050887"><span class="annot"><a href="Network.HTTP.Media.html#mapContentCharset"><span class="hs-identifier hs-type">mapContentCharset</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-250"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The map of server-side responses</span></span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Media.Charset.Internal.html#Charset"><span class="hs-identifier hs-type">Charset</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679050887"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-252"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The client request's header value</span></span><span>
</span><span id="line-253"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-254"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679050887"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-255"></span><span id="mapContentCharset"><span class="annot"><span class="annottext">mapContentCharset :: forall b. [(Charset, b)] -&gt; ByteString -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapContentCharset"><span class="hs-identifier hs-var hs-var">mapContentCharset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Charset, b)] -&gt; ByteString -&gt; Maybe b
forall a b. Accept a =&gt; [(a, b)] -&gt; ByteString -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapContent"><span class="hs-identifier hs-var">mapContent</span></a></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="hs-comment">-- | A specialisation of 'mapContent' that only takes 'Encoding' as its input,</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- to avoid ambiguous-type errors when using string literal overloading.</span><span>
</span><span id="line-259"></span><span class="hs-comment">--</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- &gt; getContentEncoding &gt;&gt;=</span><span>
</span><span id="line-261"></span><span class="hs-comment">-- &gt;     maybe send415Error readRequestBodyWith . mapContentEncoding</span><span>
</span><span id="line-262"></span><span class="hs-comment">-- &gt;         [ (&quot;compress&quot;, decompress)</span><span>
</span><span id="line-263"></span><span class="hs-comment">-- &gt;         , (&quot;identity&quot;, id)</span><span>
</span><span id="line-264"></span><span class="hs-comment">-- &gt;         ]</span><span>
</span><span id="line-265"></span><span id="local-6989586621679050889"><span class="annot"><a href="Network.HTTP.Media.html#mapContentEncoding"><span class="hs-identifier hs-type">mapContentEncoding</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-266"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The map of server-side responses</span></span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Media.Encoding.Internal.html#Encoding"><span class="hs-identifier hs-type">Encoding</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679050889"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-268"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The client request's header value</span></span><span>
</span><span id="line-269"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-270"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679050889"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-271"></span><span id="mapContentEncoding"><span class="annot"><span class="annottext">mapContentEncoding :: forall b. [(Encoding, b)] -&gt; ByteString -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapContentEncoding"><span class="hs-identifier hs-var hs-var">mapContentEncoding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Encoding, b)] -&gt; ByteString -&gt; Maybe b
forall a b. Accept a =&gt; [(a, b)] -&gt; ByteString -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapContent"><span class="hs-identifier hs-var">mapContent</span></a></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="hs-comment">-- | A specialisation of 'mapContent' that only takes 'Language' as its input,</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- to avoid ambiguous-type errors when using string literal overloading.</span><span>
</span><span id="line-275"></span><span class="hs-comment">--</span><span>
</span><span id="line-276"></span><span class="hs-comment">-- &gt; getContentLanguage &gt;&gt;=</span><span>
</span><span id="line-277"></span><span class="hs-comment">-- &gt;     maybe send415Error readRequestBodyWith . mapContentLanguage</span><span>
</span><span id="line-278"></span><span class="hs-comment">-- &gt;         [ (&quot;en-gb&quot;, parseBritishEnglish)</span><span>
</span><span id="line-279"></span><span class="hs-comment">-- &gt;         , (&quot;fr&quot;,    parseFrench)</span><span>
</span><span id="line-280"></span><span class="hs-comment">-- &gt;         ]</span><span>
</span><span id="line-281"></span><span id="local-6989586621679050891"><span class="annot"><a href="Network.HTTP.Media.html#mapContentLanguage"><span class="hs-identifier hs-type">mapContentLanguage</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-282"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The map of server-side responses</span></span><span>
</span><span id="line-283"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Media.Language.Internal.html#Language"><span class="hs-identifier hs-type">Language</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679050891"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-284"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The client request's header value</span></span><span>
</span><span id="line-285"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-286"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679050891"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-287"></span><span id="mapContentLanguage"><span class="annot"><span class="annottext">mapContentLanguage :: forall b. [(Language, b)] -&gt; ByteString -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapContentLanguage"><span class="hs-identifier hs-var hs-var">mapContentLanguage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Language, b)] -&gt; ByteString -&gt; Maybe b
forall a b. Accept a =&gt; [(a, b)] -&gt; ByteString -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapContent"><span class="hs-identifier hs-var">mapContent</span></a></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span class="annot"><span class="hs-comment">-- | Parses a full Accept header into a list of quality-valued media types.</span></span><span>
</span><span id="line-290"></span><span id="local-6989586621679050692"><span class="annot"><a href="Network.HTTP.Media.html#parseQuality"><span class="hs-identifier hs-type">parseQuality</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Media.Accept.html#Accept"><span class="hs-identifier hs-type">Accept</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679050692"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.HTTP.Media.Quality.html#Quality"><span class="hs-identifier hs-type">Quality</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679050692"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-291"></span><span id="parseQuality"><span class="annot"><span class="annottext">parseQuality :: forall a. Accept a =&gt; ByteString -&gt; Maybe [Quality a]
</span><a href="Network.HTTP.Media.html#parseQuality"><span class="hs-identifier hs-var hs-var">parseQuality</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy a -&gt; ByteString -&gt; Maybe [Quality a]
forall a. Accept a =&gt; Proxy a -&gt; ByteString -&gt; Maybe [Quality a]
</span><a href="Network.HTTP.Media.html#parseQuality%27"><span class="hs-identifier hs-var">parseQuality'</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy a
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span id="local-6989586621679050740"><span class="annot"><a href="Network.HTTP.Media.html#parseQuality%27"><span class="hs-identifier hs-type">parseQuality'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Media.Accept.html#Accept"><span class="hs-identifier hs-type">Accept</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679050740"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679050740"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.HTTP.Media.Quality.html#Quality"><span class="hs-identifier hs-type">Quality</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679050740"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-294"></span><span id="parseQuality%27"><span class="annot"><span class="annottext">parseQuality' :: forall a. Accept a =&gt; Proxy a -&gt; ByteString -&gt; Maybe [Quality a]
</span><a href="Network.HTTP.Media.html#parseQuality%27"><span class="hs-identifier hs-var hs-var">parseQuality'</span></a></span></span><span> </span><span id="local-6989586621679050907"><span class="annot"><span class="annottext">Proxy a
</span><a href="#local-6989586621679050907"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([ByteString] -&gt; Maybe [Quality a])
-&gt; (ByteString -&gt; [ByteString]) -&gt; ByteString -&gt; Maybe [Quality a]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; [ByteString] -&gt; [ByteString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="Network.HTTP.Media.Utils.html#trimBS"><span class="hs-identifier hs-var">trimBS</span></a></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; [ByteString])
-&gt; (ByteString -&gt; [ByteString]) -&gt; ByteString -&gt; [ByteString]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; ByteString -&gt; [ByteString]
</span><span class="hs-identifier hs-var">BS.split</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">','</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([ByteString] -&gt; Maybe [Quality a])
 -&gt; ByteString -&gt; Maybe [Quality a])
-&gt; ((ByteString -&gt; Maybe (Quality a))
    -&gt; [ByteString] -&gt; Maybe [Quality a])
-&gt; (ByteString -&gt; Maybe (Quality a))
-&gt; ByteString
-&gt; Maybe [Quality a]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe (Quality a))
-&gt; [ByteString] -&gt; Maybe [Quality a]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">((ByteString -&gt; Maybe (Quality a))
 -&gt; ByteString -&gt; Maybe [Quality a])
-&gt; (ByteString -&gt; Maybe (Quality a))
-&gt; ByteString
-&gt; Maybe [Quality a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679050910"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679050910"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679050911"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679050911"><span class="hs-identifier hs-var">accept</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679050912"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679050912"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ByteString, Maybe ByteString)
-&gt; Maybe (ByteString, Maybe ByteString)
-&gt; (ByteString, Maybe ByteString)
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679050910"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (ByteString, Maybe ByteString)
 -&gt; (ByteString, Maybe ByteString))
-&gt; Maybe (ByteString, Maybe ByteString)
-&gt; (ByteString, Maybe ByteString)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679050913"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (ByteString, Maybe ByteString)
</span><a href="#local-6989586621679050914"><span class="hs-identifier hs-var">findQ</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679050910"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (ByteString, Maybe ByteString)
</span><a href="#local-6989586621679050915"><span class="hs-identifier hs-var">getQ</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679050910"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-296"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Maybe (a -&gt; Quality a)
-&gt; (ByteString -&gt; Maybe (a -&gt; Quality a))
-&gt; Maybe ByteString
-&gt; Maybe (a -&gt; Quality a)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; Quality a) -&gt; Maybe (a -&gt; Quality a)
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Quality a
forall a. a -&gt; Quality a
</span><a href="Network.HTTP.Media.Quality.html#maxQuality"><span class="hs-identifier hs-var">maxQuality</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Word16 -&gt; a -&gt; Quality a)
-&gt; Maybe Word16 -&gt; Maybe (a -&gt; Quality a)
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; Word16 -&gt; Quality a) -&gt; Word16 -&gt; a -&gt; Quality a
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Word16 -&gt; Quality a
forall a. a -&gt; Word16 -&gt; Quality a
</span><a href="Network.HTTP.Media.Quality.html#Quality"><span class="hs-identifier hs-var">Quality</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Word16 -&gt; Maybe (a -&gt; Quality a))
-&gt; (ByteString -&gt; Maybe Word16)
-&gt; ByteString
-&gt; Maybe (a -&gt; Quality a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe Word16
</span><a href="Network.HTTP.Media.Quality.html#readQ"><span class="hs-identifier hs-var">readQ</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679050912"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-297"></span><span>        </span><span class="annot"><span class="annottext">Maybe (a -&gt; Quality a) -&gt; Maybe a -&gt; Maybe (Quality a)
forall a b. Maybe (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe a
forall a. Accept a =&gt; ByteString -&gt; Maybe a
</span><a href="Network.HTTP.Media.Accept.html#parseAccept"><span class="hs-identifier hs-var">parseAccept</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679050911"><span class="hs-identifier hs-var">accept</span></a></span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-299"></span><span>    </span><span id="local-6989586621679050913"><span class="annot"><span class="annottext">ext :: Bool
</span><a href="#local-6989586621679050913"><span class="hs-identifier hs-var hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy a -&gt; Bool
forall a. Accept a =&gt; Proxy a -&gt; Bool
</span><a href="Network.HTTP.Media.Accept.html#hasExtensionParameters"><span class="hs-identifier hs-var">hasExtensionParameters</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy a
</span><a href="#local-6989586621679050907"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-comment">-- Split on ';', and check if a quality value is there. A value of Nothing</span><span>
</span><span id="line-302"></span><span>    </span><span class="hs-comment">-- indicates there was no parameter, whereas a value of Nothing in the</span><span>
</span><span id="line-303"></span><span>    </span><span class="hs-comment">-- pair indicates the parameter was not a quality value.</span><span>
</span><span id="line-304"></span><span>    </span><span id="local-6989586621679050915"><span class="annot"><span class="annottext">getQ :: ByteString -&gt; Maybe (ByteString, Maybe ByteString)
</span><a href="#local-6989586621679050915"><span class="hs-identifier hs-var hs-var">getQ</span></a></span></span><span> </span><span id="local-6989586621679050928"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679050928"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-305"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679050933"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679050933"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679050934"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679050934"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="Network.HTTP.Media.Utils.html#trimBS"><span class="hs-identifier hs-var">trimBS</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (ByteString, ByteString) -&gt; (ByteString, ByteString)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; ByteString -&gt; (ByteString, ByteString)
</span><span class="hs-identifier hs-var">BS.breakEnd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">';'</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679050928"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-306"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><span class="hs-identifier hs-var">BS.null</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679050933"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-307"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe (ByteString, Maybe ByteString)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-308"></span><span>            </span><span class="hs-keyword">else</span><span>
</span><span id="line-309"></span><span>              </span><span class="annot"><span class="annottext">(ByteString, Maybe ByteString)
-&gt; Maybe (ByteString, Maybe ByteString)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-310"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; ByteString -&gt; ByteString
ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">BS.init</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679050933"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-311"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
</span><span class="hs-identifier hs-var">BS.isPrefixOf</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;q=&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679050934"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">BS.drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679050934"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-312"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-comment">-- Trawl backwards through the string, ignoring extension parameters.</span><span>
</span><span id="line-315"></span><span>    </span><span id="local-6989586621679050914"><span class="annot"><span class="annottext">findQ :: ByteString -&gt; Maybe (ByteString, Maybe ByteString)
</span><a href="#local-6989586621679050914"><span class="hs-identifier hs-var hs-var">findQ</span></a></span></span><span> </span><span id="local-6989586621679050942"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679050942"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-316"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679050943"><span class="annot"><span class="annottext">q :: Maybe (ByteString, Maybe ByteString)
</span><a href="#local-6989586621679050943"><span class="hs-identifier hs-var hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (ByteString, Maybe ByteString)
</span><a href="#local-6989586621679050915"><span class="hs-identifier hs-var">getQ</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679050942"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-317"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679050944"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679050944"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679050945"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679050945"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (ByteString, Maybe ByteString)
</span><a href="#local-6989586621679050943"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-318"></span><span>      </span><span class="annot"><span class="annottext">Maybe (ByteString, Maybe ByteString)
-&gt; (ByteString -&gt; Maybe (ByteString, Maybe ByteString))
-&gt; Maybe ByteString
-&gt; Maybe (ByteString, Maybe ByteString)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (ByteString, Maybe ByteString)
</span><a href="#local-6989586621679050914"><span class="hs-identifier hs-var">findQ</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679050944"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ByteString, Maybe ByteString)
-&gt; ByteString -&gt; Maybe (ByteString, Maybe ByteString)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Maybe (ByteString, Maybe ByteString)
</span><a href="#local-6989586621679050943"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679050945"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span class="hs-comment">-- | Matches a list of server-side resource options against a pre-parsed</span><span>
</span><span id="line-321"></span><span class="hs-comment">-- quality-marked list of client-side preferences. A result of 'Nothing' means</span><span>
</span><span id="line-322"></span><span class="hs-comment">-- that nothing matched (which should indicate a 406 error). If two or more</span><span>
</span><span id="line-323"></span><span class="hs-comment">-- results arise with the same quality level and specificity, then the first</span><span>
</span><span id="line-324"></span><span class="hs-comment">-- one in the server list is chosen.</span><span>
</span><span id="line-325"></span><span class="hs-comment">--</span><span>
</span><span id="line-326"></span><span class="hs-comment">-- The use of the 'Accept' type class allows the application of either</span><span>
</span><span id="line-327"></span><span class="hs-comment">-- 'MediaType' for the standard Accept header or 'ByteString' for any other</span><span>
</span><span id="line-328"></span><span class="hs-comment">-- Accept header which can be marked with a quality value.</span><span>
</span><span id="line-329"></span><span class="hs-comment">--</span><span>
</span><span id="line-330"></span><span class="hs-comment">-- &gt; matchQuality [&quot;text/html&quot;, &quot;application/json&quot;] &lt;$&gt; parseQuality header</span><span>
</span><span id="line-331"></span><span class="hs-comment">--</span><span>
</span><span id="line-332"></span><span class="hs-comment">-- For more information on the matching process see RFC 2616, section 14.1-4.</span><span>
</span><span id="line-333"></span><span id="local-6989586621679050700"><span class="annot"><a href="Network.HTTP.Media.html#matchQuality"><span class="hs-identifier hs-type">matchQuality</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Media.Accept.html#Accept"><span class="hs-identifier hs-type">Accept</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679050700"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-335"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The server-side options</span></span><span>
</span><span id="line-336"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679050700"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-337"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The pre-parsed client-side header value</span></span><span>
</span><span id="line-338"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Network.HTTP.Media.Quality.html#Quality"><span class="hs-identifier hs-type">Quality</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679050700"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-339"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679050700"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-340"></span><span id="matchQuality"><span class="annot"><span class="annottext">matchQuality :: forall a. Accept a =&gt; [a] -&gt; [Quality a] -&gt; Maybe a
</span><a href="Network.HTTP.Media.html#matchQuality"><span class="hs-identifier hs-var hs-var">matchQuality</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; [a] -&gt; [Quality a] -&gt; Maybe a
forall a b. Accept a =&gt; (b -&gt; a) -&gt; [b] -&gt; [Quality a] -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#findQuality"><span class="hs-identifier hs-var">findQuality</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span class="hs-comment">-- | The equivalent of 'matchQuality' above, except the resulting choice is</span><span>
</span><span id="line-343"></span><span class="hs-comment">-- mapped to another value. Convenient for specifying how to translate the</span><span>
</span><span id="line-344"></span><span class="hs-comment">-- resource into each of its available formats.</span><span>
</span><span id="line-345"></span><span class="hs-comment">--</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- &gt; parseQuality header &gt;&gt;= maybe render406Error renderResource . mapQuality</span><span>
</span><span id="line-347"></span><span class="hs-comment">-- &gt;     [ (&quot;text&quot; // &quot;html&quot;,        asHtml)</span><span>
</span><span id="line-348"></span><span class="hs-comment">-- &gt;     , (&quot;application&quot; // &quot;json&quot;, asJson)</span><span>
</span><span id="line-349"></span><span class="hs-comment">-- &gt;     ]</span><span>
</span><span id="line-350"></span><span id="local-6989586621679050705"><span id="local-6989586621679050706"><span class="annot"><a href="Network.HTTP.Media.html#mapQuality"><span class="hs-identifier hs-type">mapQuality</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-351"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Media.Accept.html#Accept"><span class="hs-identifier hs-type">Accept</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679050705"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-352"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The map of server-side preferences to values</span></span><span>
</span><span id="line-353"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679050705"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679050706"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-354"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The client-side header value</span></span><span>
</span><span id="line-355"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Network.HTTP.Media.Quality.html#Quality"><span class="hs-identifier hs-type">Quality</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679050705"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-356"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679050706"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-357"></span><span id="mapQuality"><span class="annot"><span class="annottext">mapQuality :: forall a b. Accept a =&gt; [(a, b)] -&gt; [Quality a] -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#mapQuality"><span class="hs-identifier hs-var hs-var">mapQuality</span></a></span></span><span> </span><span id="local-6989586621679050953"><span class="annot"><span class="annottext">[(a, b)]
</span><a href="#local-6989586621679050953"><span class="hs-identifier hs-var">options</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, b) -&gt; b) -&gt; Maybe (a, b) -&gt; Maybe b
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(a, b) -&gt; b
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (a, b) -&gt; Maybe b)
-&gt; ([Quality a] -&gt; Maybe (a, b)) -&gt; [Quality a] -&gt; Maybe b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((a, b) -&gt; a) -&gt; [(a, b)] -&gt; [Quality a] -&gt; Maybe (a, b)
forall a b. Accept a =&gt; (b -&gt; a) -&gt; [b] -&gt; [Quality a] -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#findQuality"><span class="hs-identifier hs-var">findQuality</span></a></span><span> </span><span class="annot"><span class="annottext">(a, b) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(a, b)]
</span><a href="#local-6989586621679050953"><span class="hs-identifier hs-var">options</span></a></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span class="hs-comment">-- | Find a match in a list of options against a ByteString using an 'Accept'</span><span>
</span><span id="line-360"></span><span class="hs-comment">-- instance obtained by mapping the options to another type.</span><span>
</span><span id="line-361"></span><span id="local-6989586621679050722"><span id="local-6989586621679050723"><span class="annot"><a href="Network.HTTP.Media.html#findMatch"><span class="hs-identifier hs-type">findMatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Media.Accept.html#Accept"><span class="hs-identifier hs-type">Accept</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679050722"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679050723"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679050722"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679050723"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679050723"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-362"></span><span id="findMatch"><span class="annot"><span class="annottext">findMatch :: forall b a. Accept b =&gt; (a -&gt; b) -&gt; [a] -&gt; ByteString -&gt; Maybe a
</span><a href="Network.HTTP.Media.html#findMatch"><span class="hs-identifier hs-var hs-var">findMatch</span></a></span></span><span> </span><span id="local-6989586621679050960"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679050960"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679050961"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679050961"><span class="hs-identifier hs-var">options</span></a></span></span><span> </span><span id="local-6989586621679050962"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679050962"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-363"></span><span>  </span><span id="local-6989586621679050963"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679050963"><span class="hs-identifier hs-var">ctype</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe b
forall a. Accept a =&gt; ByteString -&gt; Maybe a
</span><a href="Network.HTTP.Media.Accept.html#parseAccept"><span class="hs-identifier hs-var">parseAccept</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679050962"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-364"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; Bool) -&gt; [a] -&gt; Maybe a
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; b -&gt; Bool
forall a. Accept a =&gt; a -&gt; a -&gt; Bool
</span><a href="Network.HTTP.Media.Accept.html#matches"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679050963"><span class="hs-identifier hs-var">ctype</span></a></span><span> </span><span class="annot"><span class="annottext">(b -&gt; Bool) -&gt; (a -&gt; b) -&gt; a -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679050960"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679050961"><span class="hs-identifier hs-var">options</span></a></span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span class="hs-comment">-- | Find a quality match between a list of options and a quality-marked list</span><span>
</span><span id="line-367"></span><span class="hs-comment">-- of a different type, by mapping the type of the former to the latter.</span><span>
</span><span id="line-368"></span><span id="local-6989586621679050776"><span id="local-6989586621679050777"><span class="annot"><a href="Network.HTTP.Media.html#findQuality"><span class="hs-identifier hs-type">findQuality</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Media.Accept.html#Accept"><span class="hs-identifier hs-type">Accept</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679050776"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679050777"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679050776"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679050777"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Network.HTTP.Media.Quality.html#Quality"><span class="hs-identifier hs-type">Quality</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679050776"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679050777"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-369"></span><span id="findQuality"><span class="annot"><span class="annottext">findQuality :: forall a b. Accept a =&gt; (b -&gt; a) -&gt; [b] -&gt; [Quality a] -&gt; Maybe b
</span><a href="Network.HTTP.Media.html#findQuality"><span class="hs-identifier hs-var hs-var">findQuality</span></a></span></span><span> </span><span id="local-6989586621679050981"><span class="annot"><span class="annottext">b -&gt; a
</span><a href="#local-6989586621679050981"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679050982"><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621679050982"><span class="hs-identifier hs-var">options</span></a></span></span><span> </span><span id="local-6989586621679050983"><span class="annot"><span class="annottext">[Quality a]
</span><a href="#local-6989586621679050983"><span class="hs-identifier hs-var">acceptq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-370"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[b] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621679050982"><span class="hs-identifier hs-var">options</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>  </span><span id="local-6989586621679050986"><span class="annot"><span class="annottext">Quality b
</span><a href="#local-6989586621679050986"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Maybe (Quality b) -&gt; Maybe (Quality b) -&gt; Ordering)
-&gt; [Maybe (Quality b)] -&gt; Maybe (Quality b)
forall (t :: * -&gt; *) a.
Foldable t =&gt;
(a -&gt; a -&gt; Ordering) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">maximumBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe QualityOrder -&gt; Maybe QualityOrder -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">(Maybe QualityOrder -&gt; Maybe QualityOrder -&gt; Ordering)
-&gt; (Maybe (Quality b) -&gt; Maybe QualityOrder)
-&gt; Maybe (Quality b)
-&gt; Maybe (Quality b)
-&gt; Ordering
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">(Quality b -&gt; QualityOrder)
-&gt; Maybe (Quality b) -&gt; Maybe QualityOrder
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Quality b -&gt; QualityOrder
forall a. Quality a -&gt; QualityOrder
</span><a href="Network.HTTP.Media.Quality.html#qualityOrder"><span class="hs-identifier hs-var">qualityOrder</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Maybe (Quality b)]
</span><a href="#local-6989586621679050988"><span class="hs-identifier hs-var">optionsq</span></a></span><span>
</span><span id="line-372"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Quality b -&gt; Bool
forall a. Quality a -&gt; Bool
</span><a href="Network.HTTP.Media.Quality.html#isAcceptable"><span class="hs-identifier hs-var">isAcceptable</span></a></span><span> </span><span class="annot"><span class="annottext">Quality b
</span><a href="#local-6989586621679050986"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-373"></span><span>  </span><span class="annot"><span class="annottext">b -&gt; Maybe b
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(b -&gt; Maybe b) -&gt; b -&gt; Maybe b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Quality b -&gt; b
forall a. Quality a -&gt; a
</span><a href="Network.HTTP.Media.Quality.html#qualityData"><span class="hs-identifier hs-var">qualityData</span></a></span><span> </span><span class="annot"><span class="annottext">Quality b
</span><a href="#local-6989586621679050986"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-375"></span><span>    </span><span id="local-6989586621679050988"><span class="annot"><span class="annottext">optionsq :: [Maybe (Quality b)]
</span><a href="#local-6989586621679050988"><span class="hs-identifier hs-var hs-var">optionsq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe (Quality b)] -&gt; [Maybe (Quality b)]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([Maybe (Quality b)] -&gt; [Maybe (Quality b)])
-&gt; [Maybe (Quality b)] -&gt; [Maybe (Quality b)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(b -&gt; Maybe (Quality b)) -&gt; [b] -&gt; [Maybe (Quality b)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; Maybe (Quality b)
</span><a href="#local-6989586621679050990"><span class="hs-identifier hs-var">addQuality</span></a></span><span> </span><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621679050982"><span class="hs-identifier hs-var">options</span></a></span><span>
</span><span id="line-376"></span><span>    </span><span id="local-6989586621679050990"><span class="annot"><span class="annottext">addQuality :: b -&gt; Maybe (Quality b)
</span><a href="#local-6989586621679050990"><span class="hs-identifier hs-var hs-var">addQuality</span></a></span></span><span> </span><span id="local-6989586621679050993"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679050993"><span class="hs-identifier hs-var">opt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b -&gt; Quality a -&gt; Quality b
forall {a} {a}. a -&gt; Quality a -&gt; Quality a
</span><a href="#local-6989586621679050994"><span class="hs-identifier hs-var">withQValue</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679050993"><span class="hs-identifier hs-var">opt</span></a></span><span> </span><span class="annot"><span class="annottext">(Quality a -&gt; Quality b) -&gt; Maybe (Quality a) -&gt; Maybe (Quality b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Quality a) -&gt; Quality a -&gt; Maybe (Quality a))
-&gt; Maybe (Quality a) -&gt; [Quality a] -&gt; Maybe (Quality a)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; Maybe (Quality a) -&gt; Quality a -&gt; Maybe (Quality a)
</span><a href="#local-6989586621679050995"><span class="hs-identifier hs-var">mfold</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679050993"><span class="hs-identifier hs-var">opt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Quality a)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">[Quality a]
</span><a href="#local-6989586621679050983"><span class="hs-identifier hs-var">acceptq</span></a></span><span>
</span><span id="line-377"></span><span>    </span><span id="local-6989586621679050994"><span class="annot"><span class="annottext">withQValue :: a -&gt; Quality a -&gt; Quality a
</span><a href="#local-6989586621679050994"><span class="hs-identifier hs-var hs-var">withQValue</span></a></span></span><span> </span><span id="local-6989586621679050996"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679050996"><span class="hs-identifier hs-var">opt</span></a></span></span><span> </span><span id="local-6989586621679050997"><span class="annot"><span class="annottext">Quality a
</span><a href="#local-6989586621679050997"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Quality a
</span><a href="#local-6989586621679050997"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Network.HTTP.Media.Quality.html#qualityData"><span class="hs-identifier hs-var">qualityData</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679050996"><span class="hs-identifier hs-type">opt</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-378"></span><span>    </span><span id="local-6989586621679050995"><span class="annot"><span class="annottext">mfold :: b -&gt; Maybe (Quality a) -&gt; Quality a -&gt; Maybe (Quality a)
</span><a href="#local-6989586621679050995"><span class="hs-identifier hs-var hs-var">mfold</span></a></span></span><span> </span><span id="local-6989586621679051003"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679051003"><span class="hs-identifier hs-var">opt</span></a></span></span><span> </span><span id="local-6989586621679051004"><span class="annot"><span class="annottext">Maybe (Quality a)
</span><a href="#local-6989586621679051004"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span id="local-6989586621679051005"><span class="annot"><span class="annottext">Quality a
</span><a href="#local-6989586621679051005"><span class="hs-identifier hs-var">q</span></a></span></span><span>
</span><span id="line-379"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">b -&gt; a
</span><a href="#local-6989586621679050981"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679051003"><span class="hs-identifier hs-var">opt</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Accept a =&gt; a -&gt; a -&gt; Bool
</span><a href="Network.HTTP.Media.Accept.html#matches"><span class="hs-operator hs-var">`matches`</span></a></span><span> </span><span class="annot"><span class="annottext">Quality a -&gt; a
forall a. Quality a -&gt; a
</span><a href="Network.HTTP.Media.Quality.html#qualityData"><span class="hs-identifier hs-var">qualityData</span></a></span><span> </span><span class="annot"><span class="annottext">Quality a
</span><a href="#local-6989586621679051005"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Quality a -&gt; Quality a -&gt; Quality a
forall a. Accept a =&gt; Quality a -&gt; Quality a -&gt; Quality a
</span><a href="Network.HTTP.Media.Quality.html#mostSpecific"><span class="hs-identifier hs-var">mostSpecific</span></a></span><span> </span><span class="annot"><span class="annottext">Quality a
</span><a href="#local-6989586621679051005"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">(Quality a -&gt; Quality a) -&gt; Maybe (Quality a) -&gt; Maybe (Quality a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Quality a)
</span><a href="#local-6989586621679051004"><span class="hs-identifier hs-var">cur</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Quality a) -&gt; Maybe (Quality a) -&gt; Maybe (Quality a)
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Quality a -&gt; Maybe (Quality a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Quality a
</span><a href="#local-6989586621679051005"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-380"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Quality a)
</span><a href="#local-6989586621679051004"><span class="hs-identifier hs-var">cur</span></a></span><span>
</span><span id="line-381"></span></pre></body></html>